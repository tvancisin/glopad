var bE=Object.defineProperty;var Nv=S=>{throw TypeError(S)};var wE=(S,R,z)=>R in S?bE(S,R,{enumerable:!0,configurable:!0,writable:!0,value:z}):S[R]=z;var zv=(S,R,z)=>wE(S,typeof R!="symbol"?R+"":R,z),_g=(S,R,z)=>R.has(S)||Nv("Cannot "+z);var xc=(S,R,z)=>(_g(S,R,"read from private field"),z?z.call(S):R.get(S)),nf=(S,R,z)=>R.has(S)?Nv("Cannot add the same private member more than once"):R instanceof WeakSet?R.add(S):R.set(S,z),yg=(S,R,z,N)=>(_g(S,R,"write to private field"),N?N.call(S,z):R.set(S,z),z),Fv=(S,R,z)=>(_g(S,R,"access private method"),z);(function(){const R=document.createElement("link").relList;if(R&&R.supports&&R.supports("modulepreload"))return;for(const W of document.querySelectorAll('link[rel="modulepreload"]'))N(W);new MutationObserver(W=>{for(const X of W)if(X.type==="childList")for(const te of X.addedNodes)te.tagName==="LINK"&&te.rel==="modulepreload"&&N(te)}).observe(document,{childList:!0,subtree:!0});function z(W){const X={};return W.integrity&&(X.integrity=W.integrity),W.referrerPolicy&&(X.referrerPolicy=W.referrerPolicy),W.crossOrigin==="use-credentials"?X.credentials="include":W.crossOrigin==="anonymous"?X.credentials="omit":X.credentials="same-origin",X}function N(W){if(W.ep)return;W.ep=!0;const X=z(W);fetch(W.href,X)}})();const EE=!1;var Lx=Array.isArray,$g=Array.from,IE=Object.defineProperty,Mg=Object.getOwnPropertyDescriptor,Rx=Object.getOwnPropertyDescriptors,Ag=Object.getPrototypeOf;function TE(S){return S()}function Pg(S){for(var R=0;R<S.length;R++)S[R]()}const wc=2,Dx=4,gf=8,Xg=16,ou=32,_f=64,Ah=128,Ap=256,Uo=512,sh=1024,od=2048,Vu=4096,yf=8192,SE=16384,Yg=32768,CE=65536,ME=1<<18,Ox=1<<19,Pp=Symbol("$state"),AE=Symbol("legacy props");function Nx(S){return S===this.v}function PE(S,R){return S!=S?R==R:S!==R||S!==null&&typeof S=="object"||typeof S=="function"}function zx(S){return!PE(S,this.v)}function LE(S){throw new Error("effect_in_teardown")}function RE(){throw new Error("effect_in_unowned_derived")}function DE(S){throw new Error("effect_orphan")}function OE(){throw new Error("effect_update_depth_exceeded")}function NE(S){throw new Error("props_invalid_value")}function zE(){throw new Error("state_unsafe_local_read")}function FE(){throw new Error("state_unsafe_mutation")}let ad=!1;function kE(){ad=!0}function uf(S){return{f:0,v:S,reactions:null,equals:Nx,version:0}}function Fx(S,R=!1){var N;const z=uf(S);return R||(z.equals=zx),ad&&Pr!==null&&Pr.l!==null&&((N=Pr.l).s??(N.s=[])).push(z),z}function ih(S,R=!1){return BE(Fx(S,R))}function BE(S){return cr!==null&&cr.f&wc&&(Uu===null?o2([S]):Uu.push(S)),S}function qa(S,R){return cr!==null&&i_()&&cr.f&(wc|Xg)&&(Uu===null||!Uu.includes(S))&&FE(),kx(S,R)}function kx(S,R){return S.equals(R)||(S.v=R,S.version=n1(),Bx(S,sh),i_()&&Xi!==null&&Xi.f&Uo&&!(Xi.f&ou)&&(To!==null&&To.includes(S)?(au(Xi,sh),Vp(Xi)):rh===null?a2([S]):rh.push(S))),R}function Bx(S,R){var z=S.reactions;if(z!==null)for(var N=i_(),W=z.length,X=0;X<W;X++){var te=z[X],a=te.f;a&sh||!N&&te===Xi||(au(te,R),a&(Uo|Ah)&&(a&wc?Bx(te,od):Vp(te)))}}const VE=1,UE=2,GE=16,qE=1,jE=2,HE=8,ZE=2;let WE=!1;var kv,Vx,Ux;function $E(){if(kv===void 0){kv=window;var S=Element.prototype,R=Node.prototype;Vx=Mg(R,"firstChild").get,Ux=Mg(R,"nextSibling").get,S.__click=void 0,S.__className="",S.__attributes=null,S.__styles=null,S.__e=void 0,Text.prototype.__t=void 0}}function Gx(S=""){return document.createTextNode(S)}function qx(S){return Vx.call(S)}function Jg(S){return Ux.call(S)}function bc(S,R){return qx(S)}function Bu(S,R=1,z=!1){let N=S;for(;R--;)N=Jg(N);return N}function XE(S){S.textContent=""}function Kg(S){var R=wc|sh;Xi===null?R|=Ah:Xi.f|=Ox;const z={children:null,ctx:Pr,deps:null,equals:Nx,f:R,fn:S,reactions:null,v:null,version:0,parent:Xi};if(cr!==null&&cr.f&wc){var N=cr;(N.children??(N.children=[])).push(z)}return z}function YE(S){const R=Kg(S);return R.equals=zx,R}function jx(S){var R=S.children;if(R!==null){S.children=null;for(var z=0;z<R.length;z+=1){var N=R[z];N.f&wc?Qg(N):Ph(N)}}}function Hx(S){var R,z=Xi;Gu(S.parent);try{jx(S),R=i1(S)}finally{Gu(z)}return R}function Zx(S){var R=Hx(S),z=(nd||S.f&Ah)&&S.deps!==null?od:Uo;au(S,z),S.equals(R)||(S.v=R,S.version=n1())}function Qg(S){jx(S),hf(S,0),au(S,yf),S.v=S.children=S.deps=S.ctx=S.reactions=null}function Wx(S){Xi===null&&cr===null&&DE(),cr!==null&&cr.f&Ah&&RE(),n_&&LE()}function JE(S,R){var z=R.last;z===null?R.last=R.first=S:(z.next=S,S.prev=z,R.last=S)}function ld(S,R,z,N=!0){var W=(S&_f)!==0,X=Xi,te={ctx:Pr,deps:null,deriveds:null,nodes_start:null,nodes_end:null,f:S|sh,first:null,fn:R,last:null,next:null,parent:W?null:X,prev:null,teardown:null,transitions:null,version:0};if(z){var a=rd;try{Vv(!0),vf(te),te.f|=SE}catch(xe){throw Ph(te),xe}finally{Vv(a)}}else R!==null&&Vp(te);var _e=z&&te.deps===null&&te.first===null&&te.nodes_start===null&&te.teardown===null&&(te.f&Ox)===0;if(!_e&&!W&&N&&(X!==null&&JE(te,X),cr!==null&&cr.f&wc)){var me=cr;(me.children??(me.children=[])).push(te)}return te}function KE(S){const R=ld(gf,null,!1);return au(R,Uo),R.teardown=S,R}function Lg(S){Wx();var R=Xi!==null&&(Xi.f&ou)!==0&&Pr!==null&&!Pr.m;if(R){var z=Pr;(z.e??(z.e=[])).push({fn:S,effect:Xi,reaction:cr})}else{var N=kp(S);return N}}function QE(S){return Wx(),Bp(S)}function e2(S){const R=ld(_f,S,!0);return()=>{Ph(R)}}function kp(S){return ld(Dx,S,!1)}function t2(S,R){var z=Pr,N={effect:null,ran:!1};z.l.r1.push(N),N.effect=Bp(()=>{S(),!N.ran&&(N.ran=!0,qa(z.l.r2,!0),xf(R))})}function n2(){var S=Pr;Bp(()=>{if(vi(S.l.r2)){for(var R of S.l.r1){var z=R.effect;z.f&Uo&&au(z,od),ud(z)&&vf(z),R.ran=!1}S.l.r2.v=!1}})}function Bp(S){return ld(gf,S,!0)}function Bv(S){return e_(S)}function e_(S,R=0){return ld(gf|Xg|R,S,!0)}function cf(S,R=!0){return ld(gf|ou,S,!0,R)}function $x(S){var R=S.teardown;if(R!==null){const z=n_,N=cr;Uv(!0),oh(null);try{R.call(null)}finally{Uv(z),oh(N)}}}function Xx(S){var R=S.deriveds;if(R!==null){S.deriveds=null;for(var z=0;z<R.length;z+=1)Qg(R[z])}}function Yx(S,R=!1){var z=S.first;for(S.first=S.last=null;z!==null;){var N=z.next;Ph(z,R),z=N}}function i2(S){for(var R=S.first;R!==null;){var z=R.next;R.f&ou||Ph(R),R=z}}function Ph(S,R=!0){var z=!1;if((R||S.f&ME)&&S.nodes_start!==null){for(var N=S.nodes_start,W=S.nodes_end;N!==null;){var X=N===W?null:Jg(N);N.remove(),N=X}z=!0}Yx(S,R&&!z),Xx(S),hf(S,0),au(S,yf);var te=S.transitions;if(te!==null)for(const _e of te)_e.stop();$x(S);var a=S.parent;a!==null&&a.first!==null&&Jx(S),S.next=S.prev=S.teardown=S.ctx=S.deps=S.parent=S.fn=S.nodes_start=S.nodes_end=null}function Jx(S){var R=S.parent,z=S.prev,N=S.next;z!==null&&(z.next=N),N!==null&&(N.prev=z),R!==null&&(R.first===S&&(R.first=N),R.last===S&&(R.last=z))}function Rg(S,R){var z=[];t_(S,z,!0),Kx(z,()=>{Ph(S),R&&R()})}function Kx(S,R){var z=S.length;if(z>0){var N=()=>--z||R();for(var W of S)W.out(N)}else R()}function t_(S,R,z){if(!(S.f&Vu)){if(S.f^=Vu,S.transitions!==null)for(const te of S.transitions)(te.is_global||z)&&R.push(te);for(var N=S.first;N!==null;){var W=N.next,X=(N.f&Yg)!==0||(N.f&ou)!==0;t_(N,R,X?z:!1),N=W}}}function Lp(S){Qx(S,!0)}function Qx(S,R){if(S.f&Vu){ud(S)&&vf(S),S.f^=Vu;for(var z=S.first;z!==null;){var N=z.next,W=(z.f&Yg)!==0||(z.f&ou)!==0;Qx(z,W?R:!1),z=N}if(S.transitions!==null)for(const X of S.transitions)(X.is_global||R)&&X.in()}}let Dg=!1,Og=[];function r2(){Dg=!1;const S=Og.slice();Og=[],Pg(S)}function e1(S){Dg||(Dg=!0,queueMicrotask(r2)),Og.push(S)}function s2(S){throw new Error("lifecycle_outside_component")}let Rp=!1,rd=!1,n_=!1;function Vv(S){rd=S}function Uv(S){n_=S}let Ng=[],af=0;let cr=null;function oh(S){cr=S}let Xi=null;function Gu(S){Xi=S}let Uu=null;function o2(S){Uu=S}let To=null,Ga=0,rh=null;function a2(S){rh=S}let t1=0,nd=!1,Pr=null;function n1(){return++t1}function i_(){return!ad||Pr!==null&&Pr.l===null}function ud(S){var te,a;var R=S.f;if(R&sh)return!0;if(R&od){var z=S.deps,N=(R&Ah)!==0;if(z!==null){var W;if(R&Ap){for(W=0;W<z.length;W++)((te=z[W]).reactions??(te.reactions=[])).push(S);S.f^=Ap}for(W=0;W<z.length;W++){var X=z[W];if(ud(X)&&Zx(X),N&&Xi!==null&&!nd&&!((a=X==null?void 0:X.reactions)!=null&&a.includes(S))&&(X.reactions??(X.reactions=[])).push(S),X.version>S.version)return!0}}N||au(S,Uo)}return!1}function l2(S,R,z){throw S}function i1(S){var Te;var R=To,z=Ga,N=rh,W=cr,X=nd,te=Uu,a=Pr,_e=S.f;To=null,Ga=0,rh=null,cr=_e&(ou|_f)?null:S,nd=!rd&&(_e&Ah)!==0,Uu=null,Pr=S.ctx;try{var me=(0,S.fn)(),xe=S.deps;if(To!==null){var Se;if(hf(S,Ga),xe!==null&&Ga>0)for(xe.length=Ga+To.length,Se=0;Se<To.length;Se++)xe[Ga+Se]=To[Se];else S.deps=xe=To;if(!nd)for(Se=Ga;Se<xe.length;Se++)((Te=xe[Se]).reactions??(Te.reactions=[])).push(S)}else xe!==null&&Ga<xe.length&&(hf(S,Ga),xe.length=Ga);return me}finally{To=R,Ga=z,rh=N,cr=W,nd=X,Uu=te,Pr=a}}function u2(S,R){let z=R.reactions;if(z!==null){var N=z.indexOf(S);if(N!==-1){var W=z.length-1;W===0?z=R.reactions=null:(z[N]=z[W],z.pop())}}z===null&&R.f&wc&&(To===null||!To.includes(R))&&(au(R,od),R.f&(Ah|Ap)||(R.f^=Ap),hf(R,0))}function hf(S,R){var z=S.deps;if(z!==null)for(var N=R;N<z.length;N++)u2(S,z[N])}function vf(S){var R=S.f;if(!(R&yf)){au(S,Uo);var z=Xi;Xi=S;try{R&Xg?i2(S):Yx(S),Xx(S),$x(S);var N=i1(S);S.teardown=typeof N=="function"?N:null,S.version=t1}catch(W){l2(W)}finally{Xi=z}}}function c2(){af>1e3&&(af=0,OE()),af++}function h2(S){var R=S.length;if(R!==0){c2();var z=rd;rd=!0;try{for(var N=0;N<R;N++){var W=S[N];W.f&Uo||(W.f^=Uo);var X=[];r1(W,X),d2(X)}}finally{rd=z}}}function d2(S){var R=S.length;if(R!==0)for(var z=0;z<R;z++){var N=S[z];!(N.f&(yf|Vu))&&ud(N)&&(vf(N),N.deps===null&&N.first===null&&N.nodes_start===null&&(N.teardown===null?Jx(N):N.fn=null))}}function f2(){if(Rp=!1,af>1001)return;const S=Ng;Ng=[],h2(S),Rp||(af=0)}function Vp(S){Rp||(Rp=!0,queueMicrotask(f2));for(var R=S;R.parent!==null;){R=R.parent;var z=R.f;if(z&(_f|ou)){if(!(z&Uo))return;R.f^=Uo}}Ng.push(R)}function r1(S,R){var z=S.first,N=[];e:for(;z!==null;){var W=z.f,X=(W&ou)!==0,te=X&&(W&Uo)!==0;if(!te&&!(W&Vu))if(W&gf){X?z.f^=Uo:ud(z)&&vf(z);var a=z.first;if(a!==null){z=a;continue}}else W&Dx&&N.push(z);var _e=z.next;if(_e===null){let Se=z.parent;for(;Se!==null;){if(S===Se)break e;var me=Se.next;if(me!==null){z=me;continue e}Se=Se.parent}}z=_e}for(var xe=0;xe<N.length;xe++)a=N[xe],R.push(a),r1(a,R)}function vi(S){var a;var R=S.f,z=(R&wc)!==0;if(z&&R&yf){var N=Hx(S);return Qg(S),N}if(cr!==null){Uu!==null&&Uu.includes(S)&&zE();var W=cr.deps;To===null&&W!==null&&W[Ga]===S?Ga++:To===null?To=[S]:To.push(S),rh!==null&&Xi!==null&&Xi.f&Uo&&!(Xi.f&ou)&&rh.includes(S)&&(au(Xi,sh),Vp(Xi))}else if(z&&S.deps===null){var X=S,te=X.parent;te!==null&&!((a=te.deriveds)!=null&&a.includes(X))&&(te.deriveds??(te.deriveds=[])).push(X)}return z&&(X=S,ud(X)&&Zx(X)),S.v}function xf(S){const R=cr;try{return cr=null,S()}finally{cr=R}}const p2=~(sh|od|Uo);function au(S,R){S.f=S.f&p2|R}function r_(S,R=!1,z){Pr={p:Pr,c:null,e:null,m:!1,s:S,x:null,l:null},ad&&!R&&(Pr.l={s:null,u:null,r1:[],r2:uf(!1)})}function s_(S){const R=Pr;if(R!==null){const te=R.e;if(te!==null){var z=Xi,N=cr;R.e=null;try{for(var W=0;W<te.length;W++){var X=te[W];Gu(X.effect),oh(X.reaction),kp(X.fn)}}finally{Gu(z),oh(N)}}Pr=R.p,R.m=!0}return{}}function s1(S){if(!(typeof S!="object"||!S||S instanceof EventTarget)){if(Pp in S)zg(S);else if(!Array.isArray(S))for(let R in S){const z=S[R];typeof z=="object"&&z&&Pp in z&&zg(z)}}}function zg(S,R=new Set){if(typeof S=="object"&&S!==null&&!(S instanceof EventTarget)&&!R.has(S)){R.add(S),S instanceof Date&&S.getTime();for(let N in S)try{zg(S[N],R)}catch{}const z=Ag(S);if(z!==Object.prototype&&z!==Array.prototype&&z!==Map.prototype&&z!==Set.prototype&&z!==Date.prototype){const N=Rx(z);for(let W in N){const X=N[W].get;if(X)try{X.call(S)}catch{}}}}}function m2(S){var R=cr,z=Xi;oh(null),Gu(null);try{return S()}finally{oh(R),Gu(z)}}const g2=new Set,Gv=new Set;function _2(S,R,z,N){function W(X){if(N.capture||sf.call(R,X),!X.cancelBubble)return m2(()=>z.call(this,X))}return S.startsWith("pointer")||S.startsWith("touch")||S==="wheel"?e1(()=>{R.addEventListener(S,W,N)}):R.addEventListener(S,W,N),W}function td(S,R,z,N,W){var X={capture:N,passive:W},te=_2(S,R,z,X);(R===document.body||R===window||R===document)&&KE(()=>{R.removeEventListener(S,te,X)})}function sf(S){var Bt;var R=this,z=R.ownerDocument,N=S.type,W=((Bt=S.composedPath)==null?void 0:Bt.call(S))||[],X=W[0]||S.target,te=0,a=S.__root;if(a){var _e=W.indexOf(a);if(_e!==-1&&(R===document||R===window)){S.__root=R;return}var me=W.indexOf(R);if(me===-1)return;_e<=me&&(te=_e)}if(X=W[te]||S.target,X!==R){IE(S,"currentTarget",{configurable:!0,get(){return X||z}});var xe=cr,Se=Xi;oh(null),Gu(null);try{for(var Te,Qe=[];X!==null;){var Pe=X.assignedSlot||X.parentNode||X.host||null;try{var ve=X["__"+N];if(ve!==void 0&&!X.disabled)if(Lx(ve)){var[Nt,...wt]=ve;Nt.apply(X,[S,...wt])}else ve.call(X,S)}catch(je){Te?Qe.push(je):Te=je}if(S.cancelBubble||Pe===R||Pe===null)break;X=Pe}if(Te){for(let je of Qe)queueMicrotask(()=>{throw je});throw Te}}finally{S.__root=R,delete S.currentTarget,oh(xe),Gu(Se)}}}function y2(S){var R=document.createElement("template");return R.innerHTML=S,R.content}function v2(S,R){var z=Xi;z.nodes_start===null&&(z.nodes_start=S,z.nodes_end=R)}function Lh(S,R){var z=(R&ZE)!==0,N,W=!S.startsWith("<!>");return()=>{N===void 0&&(N=y2(W?S:"<!>"+S),N=qx(N));var X=z?document.importNode(N,!0):N.cloneNode(!0);return v2(X,X),X}}function Ch(S,R){S!==null&&S.before(R)}const x2=["touchstart","touchmove"];function b2(S){return x2.includes(S)}function w2(S,R){var z=R==null?"":typeof R=="object"?R+"":R;z!==(S.__t??(S.__t=S.nodeValue))&&(S.__t=z,S.nodeValue=z==null?"":z+"")}function E2(S,R){return I2(S,R)}const ed=new Map;function I2(S,{target:R,anchor:z,props:N={},events:W,context:X,intro:te=!0}){$E();var a=new Set,_e=Se=>{for(var Te=0;Te<Se.length;Te++){var Qe=Se[Te];if(!a.has(Qe)){a.add(Qe);var Pe=b2(Qe);R.addEventListener(Qe,sf,{passive:Pe});var ve=ed.get(Qe);ve===void 0?(document.addEventListener(Qe,sf,{passive:Pe}),ed.set(Qe,1)):ed.set(Qe,ve+1)}}};_e($g(g2)),Gv.add(_e);var me=void 0,xe=e2(()=>{var Se=z??R.appendChild(Gx());return cf(()=>{if(X){r_({});var Te=Pr;Te.c=X}W&&(N.$$events=W),me=S(Se,N)||{},X&&s_()}),()=>{var Pe;for(var Te of a){R.removeEventListener(Te,sf);var Qe=ed.get(Te);--Qe===0?(document.removeEventListener(Te,sf),ed.delete(Te)):ed.set(Te,Qe)}Gv.delete(_e),qv.delete(me),Se!==z&&((Pe=Se.parentNode)==null||Pe.removeChild(Se))}});return qv.set(me,xe),me}let qv=new WeakMap;function Fg(S,R,z,N=null,W=!1){var X=S,te=null,a=null,_e=null,me=W?Yg:0;e_(()=>{_e!==(_e=!!R())&&(_e?(te?Lp(te):te=cf(()=>z(X)),a&&Rg(a,()=>{a=null})):(a?Lp(a):N&&(a=cf(()=>N(X))),te&&Rg(te,()=>{te=null})))},me)}function T2(S,R){return R}function S2(S,R,z,N){for(var W=[],X=R.length,te=0;te<X;te++)t_(R[te].e,W,!0);var a=X>0&&W.length===0&&z!==null;if(a){var _e=z.parentNode;XE(_e),_e.append(z),N.clear(),th(S,R[0].prev,R[X-1].next)}Kx(W,()=>{for(var me=0;me<X;me++){var xe=R[me];a||(N.delete(xe.k),th(S,xe.prev,xe.next)),Ph(xe.e,!a)}})}function jv(S,R,z,N,W,X=null){var te=S,a={flags:R,items:new Map,first:null};{var _e=S;te=_e.appendChild(Gx())}var me=null,xe=!1;e_(()=>{var Se=z(),Te=Lx(Se)?Se:Se==null?[]:$g(Se),Qe=Te.length;if(!(xe&&Qe===0)){xe=Qe===0;{var Pe=cr;C2(Te,a,te,W,R,(Pe.f&Vu)!==0,N)}X!==null&&(Qe===0?me?Lp(me):me=cf(()=>X(te)):me!==null&&Rg(me,()=>{me=null})),z()}})}function C2(S,R,z,N,W,X,te){var a=S.length,_e=R.items,me=R.first,xe=me,Se,Te=null,Qe=[],Pe=[],ve,Nt,wt,Bt;for(Bt=0;Bt<a;Bt+=1){if(ve=S[Bt],Nt=te(ve,Bt),wt=_e.get(Nt),wt===void 0){var je=xe?xe.e.nodes_start:z;Te=A2(je,R,Te,Te===null?R.first:Te.next,ve,Nt,Bt,N,W),_e.set(Nt,Te),Qe=[],Pe=[],xe=Te.next;continue}if(M2(wt,ve,Bt),wt.e.f&Vu&&Lp(wt.e),wt!==xe){if(Se!==void 0&&Se.has(wt)){if(Qe.length<Pe.length){var Ae=Pe[0],pt;Te=Ae.prev;var en=Qe[0],ze=Qe[Qe.length-1];for(pt=0;pt<Qe.length;pt+=1)Hv(Qe[pt],Ae,z);for(pt=0;pt<Pe.length;pt+=1)Se.delete(Pe[pt]);th(R,en.prev,ze.next),th(R,Te,en),th(R,ze,Ae),xe=Ae,Te=ze,Bt-=1,Qe=[],Pe=[]}else Se.delete(wt),Hv(wt,xe,z),th(R,wt.prev,wt.next),th(R,wt,Te===null?R.first:Te.next),th(R,Te,wt),Te=wt;continue}for(Qe=[],Pe=[];xe!==null&&xe.k!==Nt;)(X||!(xe.e.f&Vu))&&(Se??(Se=new Set)).add(xe),Pe.push(xe),xe=xe.next;if(xe===null)continue;wt=xe}Qe.push(wt),Te=wt,xe=wt.next}if(xe!==null||Se!==void 0){for(var ft=Se===void 0?[]:$g(Se);xe!==null;)(X||!(xe.e.f&Vu))&&ft.push(xe),xe=xe.next;var et=ft.length;if(et>0){var ht=a===0?z:null;S2(R,ft,ht,_e)}}Xi.first=R.first&&R.first.e,Xi.last=Te&&Te.e}function M2(S,R,z,N){kx(S.v,R),S.i=z}function A2(S,R,z,N,W,X,te,a,_e){var me=(_e&VE)!==0,xe=(_e&GE)===0,Se=me?xe?Fx(W):uf(W):W,Te=_e&UE?uf(te):te,Qe={i:Te,v:Se,k:X,a:null,e:null,prev:z,next:N};try{return Qe.e=cf(()=>a(S,Se,Te),WE),Qe.e.prev=z&&z.e,Qe.e.next=N&&N.e,z===null?R.first=Qe:(z.next=Qe,z.e.next=Qe.e),N!==null&&(N.prev=Qe,N.e.prev=Qe.e),Qe}finally{}}function Hv(S,R,z){for(var N=S.next?S.next.e.nodes_start:z,W=R?R.e.nodes_start:z,X=S.e.nodes_start;X!==N;){var te=Jg(X);W.before(X),X=te}}function th(S,R,z){R===null?S.first=z:(R.next=z,R.e.next=z&&z.e),z!==null&&(z.prev=R,z.e.prev=R&&R.e)}function P2(S,R,z,N){var W=S.__attributes??(S.__attributes={});W[R]!==(W[R]=z)&&(z==null?S.removeAttribute(R):typeof z!="string"&&L2(S).includes(R)?S[R]=z:S.setAttribute(R,z))}var Zv=new Map;function L2(S){var R=Zv.get(S.nodeName);if(R)return R;Zv.set(S.nodeName,R=[]);for(var z,N=Ag(S),W=Element.prototype;W!==N;){z=Rx(N);for(var X in z)z[X].set&&R.push(X);N=Ag(N)}return R}var nh,sd,mf,zp,o1;const Fp=class Fp{constructor(R){nf(this,zp);nf(this,nh,new WeakMap);nf(this,sd);nf(this,mf);yg(this,mf,R)}observe(R,z){var N=xc(this,nh).get(R)||new Set;return N.add(z),xc(this,nh).set(R,N),Fv(this,zp,o1).call(this).observe(R,xc(this,mf)),()=>{var W=xc(this,nh).get(R);W.delete(z),W.size===0&&(xc(this,nh).delete(R),xc(this,sd).unobserve(R))}}};nh=new WeakMap,sd=new WeakMap,mf=new WeakMap,zp=new WeakSet,o1=function(){return xc(this,sd)??yg(this,sd,new ResizeObserver(R=>{for(var z of R){Fp.entries.set(z.target,z);for(var N of xc(this,nh).get(z.target)||[])N(z)}}))},zv(Fp,"entries",new WeakMap);let kg=Fp;var R2=new kg({box:"border-box"});function Bg(S,R,z){var N=R2.observe(S,()=>z(S[R]));kp(()=>(xf(()=>z(S[R])),N))}function Wv(S,R){return S===R||(S==null?void 0:S[Pp])===R}function D2(S={},R,z,N){return kp(()=>{var W,X;return Bp(()=>{W=X,X=[],xf(()=>{S!==z(...X)&&(R(S,...X),W&&Wv(z(...W),S)&&R(null,...W))})}),()=>{e1(()=>{X&&Wv(z(...X),S)&&R(null,...X)})}}),S}function a1(S=!1){const R=Pr,z=R.l.u;if(!z)return;let N=()=>s1(R.s);if(S){let W=0,X={};const te=Kg(()=>{let a=!1;const _e=R.s;for(const me in _e)_e[me]!==X[me]&&(X[me]=_e[me],a=!0);return a&&W++,W});N=()=>vi(te)}z.b.length&&QE(()=>{$v(R,N),Pg(z.b)}),Lg(()=>{const W=xf(()=>z.m.map(TE));return()=>{for(const X of W)typeof X=="function"&&X()}}),z.a.length&&Lg(()=>{$v(R,N),Pg(z.a)})}function $v(S,R){if(S.l.s)for(const z of S.l.s)vi(z);R()}function O2(S){var R=uf(0);return function(){return arguments.length===1?(qa(R,vi(R)+1),arguments[0]):(vi(R),S())}}let wp=!1;function N2(S){var R=wp;try{return wp=!1,[S(),wp]}finally{wp=R}}function z2(S){for(var R=Xi,z=Xi;R!==null&&!(R.f&(ou|_f));)R=R.parent;try{return Gu(R),S()}finally{Gu(z)}}function F2(S,R,z,N){var Nt;var W=(z&qE)!==0,X=!ad||(z&jE)!==0,te=(z&HE)!==0,a=!1,_e;[_e,a]=N2(()=>S[R]);var me=Pp in S||AE in S,xe=((Nt=Mg(S,R))==null?void 0:Nt.set)??(me&&te&&R in S?wt=>S[R]=wt:void 0),Se=N,Te=!0,Qe=()=>(Te&&(Te=!1,Se=N),Se);_e===void 0&&N!==void 0&&(xe&&X&&NE(),_e=Qe(),xe&&xe(_e));var Pe;if(X)Pe=()=>{var wt=S[R];return wt===void 0?Qe():(Te=!0,wt)};else{var ve=z2(()=>(W?Kg:YE)(()=>S[R]));ve.f|=CE,Pe=()=>{var wt=vi(ve);return wt!==void 0&&(Se=void 0),wt===void 0?Se:wt}}return Pe}function l1(S){Pr===null&&s2(),ad&&Pr.l!==null?k2(Pr).m.push(S):Lg(()=>{const R=xf(S);if(typeof R=="function")return R})}function k2(S){var R=S.l;return R.u??(R.u={a:[],b:[],m:[]})}const B2="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(B2);kE();async function V2(S){return await(await fetch("/glopad/"+S)).json()}var u1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function c1(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var h1={exports:{}};(function(S,R){(function(z,N){S.exports=N()})(u1,function(){var z,N,W;function X(a,_e){if(!z)z=_e;else if(!N)N=_e;else{var me="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+z+")(sharedChunk); ("+N+")(sharedChunk); self.onerror = null;",xe={};z(xe),W=_e(xe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(W.workerUrl=window.URL.createObjectURL(new Blob([me],{type:"text/javascript"})))}}X(["exports"],function(a){function _e(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var me,xe={},Se={};function Te(){if(me)return Se;me=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.setMatrixArrayType=function(p){Se.ARRAY_TYPE=t=p},Se.toRadian=function(p){return p*c},Se.equals=function(p,h){return Math.abs(p-h)<=l*Math.max(1,Math.abs(p),Math.abs(h))},Se.RANDOM=Se.ARRAY_TYPE=Se.EPSILON=void 0;var l=1e-6;Se.EPSILON=l;var t=typeof Float32Array<"u"?Float32Array:Array;Se.ARRAY_TYPE=t;var s=Math.random;Se.RANDOM=s;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,h=arguments.length;h--;)p+=arguments[h]*arguments[h];return Math.sqrt(p)}),Se}var Qe,Pe={};function ve(){if(Qe)return Pe;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}Qe=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.create=function(){var h=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},Pe.clone=function(h){var m=new t.ARRAY_TYPE(4);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m},Pe.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h},Pe.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},Pe.fromValues=function(h,m,x,T){var A=new t.ARRAY_TYPE(4);return A[0]=h,A[1]=m,A[2]=x,A[3]=T,A},Pe.set=function(h,m,x,T,A){return h[0]=m,h[1]=x,h[2]=T,h[3]=A,h},Pe.transpose=function(h,m){if(h===m){var x=m[1];h[1]=m[2],h[2]=x}else h[0]=m[0],h[1]=m[2],h[2]=m[1],h[3]=m[3];return h},Pe.invert=function(h,m){var x=m[0],T=m[1],A=m[2],y=m[3],I=x*y-A*T;return I?(h[0]=y*(I=1/I),h[1]=-T*I,h[2]=-A*I,h[3]=x*I,h):null},Pe.adjoint=function(h,m){var x=m[0];return h[0]=m[3],h[1]=-m[1],h[2]=-m[2],h[3]=x,h},Pe.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},Pe.multiply=c,Pe.rotate=function(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=Math.sin(x),E=Math.cos(x);return h[0]=T*E+y*M,h[1]=A*E+I*M,h[2]=T*-M+y*E,h[3]=A*-M+I*E,h},Pe.scale=function(h,m,x){var T=m[1],A=m[2],y=m[3],I=x[0],M=x[1];return h[0]=m[0]*I,h[1]=T*I,h[2]=A*M,h[3]=y*M,h},Pe.fromRotation=function(h,m){var x=Math.sin(m),T=Math.cos(m);return h[0]=T,h[1]=x,h[2]=-x,h[3]=T,h},Pe.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=m[1],h},Pe.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},Pe.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},Pe.LDU=function(h,m,x,T){return h[2]=T[2]/T[0],x[0]=T[0],x[1]=T[1],x[3]=T[3]-h[2]*x[1],[h,m,x]},Pe.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h},Pe.subtract=p,Pe.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]},Pe.equals=function(h,m){var x=h[0],T=h[1],A=h[2],y=h[3],I=m[0],M=m[1],E=m[2],C=m[3];return Math.abs(x-I)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(I))&&Math.abs(T-M)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(M))&&Math.abs(A-E)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(E))&&Math.abs(y-C)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(C))},Pe.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h},Pe.multiplyScalarAndAdd=function(h,m,x,T){return h[0]=m[0]+x[0]*T,h[1]=m[1]+x[1]*T,h[2]=m[2]+x[2]*T,h[3]=m[3]+x[3]*T,h},Pe.sub=Pe.mul=void 0;var t=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=s(void 0);if(x&&x.has(h))return x.get(h);var T={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var I=A?Object.getOwnPropertyDescriptor(h,y):null;I&&(I.get||I.set)?Object.defineProperty(T,y,I):T[y]=h[y]}return T.default=h,x&&x.set(h,T),T}(Te());function s(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(T){return T?x:m})(h)}function c(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=x[0],E=x[1],C=x[2],L=x[3];return h[0]=T*M+y*E,h[1]=A*M+I*E,h[2]=T*C+y*L,h[3]=A*C+I*L,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h}return Pe.mul=c,Pe.sub=p,Pe}var Nt,wt={};function Bt(){if(Nt)return wt;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}Nt=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=function(){var h=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},wt.clone=function(h){var m=new t.ARRAY_TYPE(6);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[4]=h[4],m[5]=h[5],m},wt.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h},wt.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},wt.fromValues=function(h,m,x,T,A,y){var I=new t.ARRAY_TYPE(6);return I[0]=h,I[1]=m,I[2]=x,I[3]=T,I[4]=A,I[5]=y,I},wt.set=function(h,m,x,T,A,y,I){return h[0]=m,h[1]=x,h[2]=T,h[3]=A,h[4]=y,h[5]=I,h},wt.invert=function(h,m){var x=m[0],T=m[1],A=m[2],y=m[3],I=m[4],M=m[5],E=x*y-T*A;return E?(h[0]=y*(E=1/E),h[1]=-T*E,h[2]=-A*E,h[3]=x*E,h[4]=(A*M-y*I)*E,h[5]=(T*I-x*M)*E,h):null},wt.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},wt.multiply=c,wt.rotate=function(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=m[4],E=m[5],C=Math.sin(x),L=Math.cos(x);return h[0]=T*L+y*C,h[1]=A*L+I*C,h[2]=T*-C+y*L,h[3]=A*-C+I*L,h[4]=M,h[5]=E,h},wt.scale=function(h,m,x){var T=m[1],A=m[2],y=m[3],I=m[4],M=m[5],E=x[0],C=x[1];return h[0]=m[0]*E,h[1]=T*E,h[2]=A*C,h[3]=y*C,h[4]=I,h[5]=M,h},wt.translate=function(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=m[4],E=m[5],C=x[0],L=x[1];return h[0]=T,h[1]=A,h[2]=y,h[3]=I,h[4]=T*C+y*L+M,h[5]=A*C+I*L+E,h},wt.fromRotation=function(h,m){var x=Math.sin(m),T=Math.cos(m);return h[0]=T,h[1]=x,h[2]=-x,h[3]=T,h[4]=0,h[5]=0,h},wt.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=m[1],h[4]=0,h[5]=0,h},wt.fromTranslation=function(h,m){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=m[0],h[5]=m[1],h},wt.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},wt.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},wt.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h[4]=m[4]+x[4],h[5]=m[5]+x[5],h},wt.subtract=p,wt.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h[4]=m[4]*x,h[5]=m[5]*x,h},wt.multiplyScalarAndAdd=function(h,m,x,T){return h[0]=m[0]+x[0]*T,h[1]=m[1]+x[1]*T,h[2]=m[2]+x[2]*T,h[3]=m[3]+x[3]*T,h[4]=m[4]+x[4]*T,h[5]=m[5]+x[5]*T,h},wt.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]&&h[4]===m[4]&&h[5]===m[5]},wt.equals=function(h,m){var x=h[0],T=h[1],A=h[2],y=h[3],I=h[4],M=h[5],E=m[0],C=m[1],L=m[2],k=m[3],V=m[4],j=m[5];return Math.abs(x-E)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(E))&&Math.abs(T-C)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(C))&&Math.abs(A-L)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(L))&&Math.abs(y-k)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))&&Math.abs(I-V)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(V))&&Math.abs(M-j)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(j))},wt.sub=wt.mul=void 0;var t=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=s(void 0);if(x&&x.has(h))return x.get(h);var T={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var I=A?Object.getOwnPropertyDescriptor(h,y):null;I&&(I.get||I.set)?Object.defineProperty(T,y,I):T[y]=h[y]}return T.default=h,x&&x.set(h,T),T}(Te());function s(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(T){return T?x:m})(h)}function c(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=m[4],E=m[5],C=x[0],L=x[1],k=x[2],V=x[3],j=x[4],Z=x[5];return h[0]=T*C+y*L,h[1]=A*C+I*L,h[2]=T*k+y*V,h[3]=A*k+I*V,h[4]=T*j+y*Z+M,h[5]=A*j+I*Z+E,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h[4]=m[4]-x[4],h[5]=m[5]-x[5],h}return wt.mul=c,wt.sub=p,wt}var je,Ae={};function pt(){if(je)return Ae;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(h)}je=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.create=function(){var h=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},Ae.fromMat4=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[4],h[4]=m[5],h[5]=m[6],h[6]=m[8],h[7]=m[9],h[8]=m[10],h},Ae.clone=function(h){var m=new t.ARRAY_TYPE(9);return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[4]=h[4],m[5]=h[5],m[6]=h[6],m[7]=h[7],m[8]=h[8],m},Ae.copy=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h[6]=m[6],h[7]=m[7],h[8]=m[8],h},Ae.fromValues=function(h,m,x,T,A,y,I,M,E){var C=new t.ARRAY_TYPE(9);return C[0]=h,C[1]=m,C[2]=x,C[3]=T,C[4]=A,C[5]=y,C[6]=I,C[7]=M,C[8]=E,C},Ae.set=function(h,m,x,T,A,y,I,M,E,C){return h[0]=m,h[1]=x,h[2]=T,h[3]=A,h[4]=y,h[5]=I,h[6]=M,h[7]=E,h[8]=C,h},Ae.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ae.transpose=function(h,m){if(h===m){var x=m[1],T=m[2],A=m[5];h[1]=m[3],h[2]=m[6],h[3]=x,h[5]=m[7],h[6]=T,h[7]=A}else h[0]=m[0],h[1]=m[3],h[2]=m[6],h[3]=m[1],h[4]=m[4],h[5]=m[7],h[6]=m[2],h[7]=m[5],h[8]=m[8];return h},Ae.invert=function(h,m){var x=m[0],T=m[1],A=m[2],y=m[3],I=m[4],M=m[5],E=m[6],C=m[7],L=m[8],k=L*I-M*C,V=-L*y+M*E,j=C*y-I*E,Z=x*k+T*V+A*j;return Z?(h[0]=k*(Z=1/Z),h[1]=(-L*T+A*C)*Z,h[2]=(M*T-A*I)*Z,h[3]=V*Z,h[4]=(L*x-A*E)*Z,h[5]=(-M*x+A*y)*Z,h[6]=j*Z,h[7]=(-C*x+T*E)*Z,h[8]=(I*x-T*y)*Z,h):null},Ae.adjoint=function(h,m){var x=m[0],T=m[1],A=m[2],y=m[3],I=m[4],M=m[5],E=m[6],C=m[7],L=m[8];return h[0]=I*L-M*C,h[1]=A*C-T*L,h[2]=T*M-A*I,h[3]=M*E-y*L,h[4]=x*L-A*E,h[5]=A*y-x*M,h[6]=y*C-I*E,h[7]=T*E-x*C,h[8]=x*I-T*y,h},Ae.determinant=function(h){var m=h[3],x=h[4],T=h[5],A=h[6],y=h[7],I=h[8];return h[0]*(I*x-T*y)+h[1]*(-I*m+T*A)+h[2]*(y*m-x*A)},Ae.multiply=c,Ae.translate=function(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=m[4],E=m[5],C=m[6],L=m[7],k=m[8],V=x[0],j=x[1];return h[0]=T,h[1]=A,h[2]=y,h[3]=I,h[4]=M,h[5]=E,h[6]=V*T+j*I+C,h[7]=V*A+j*M+L,h[8]=V*y+j*E+k,h},Ae.rotate=function(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=m[4],E=m[5],C=m[6],L=m[7],k=m[8],V=Math.sin(x),j=Math.cos(x);return h[0]=j*T+V*I,h[1]=j*A+V*M,h[2]=j*y+V*E,h[3]=j*I-V*T,h[4]=j*M-V*A,h[5]=j*E-V*y,h[6]=C,h[7]=L,h[8]=k,h},Ae.scale=function(h,m,x){var T=x[0],A=x[1];return h[0]=T*m[0],h[1]=T*m[1],h[2]=T*m[2],h[3]=A*m[3],h[4]=A*m[4],h[5]=A*m[5],h[6]=m[6],h[7]=m[7],h[8]=m[8],h},Ae.fromTranslation=function(h,m){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=m[0],h[7]=m[1],h[8]=1,h},Ae.fromRotation=function(h,m){var x=Math.sin(m),T=Math.cos(m);return h[0]=T,h[1]=x,h[2]=0,h[3]=-x,h[4]=T,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ae.fromScaling=function(h,m){return h[0]=m[0],h[1]=0,h[2]=0,h[3]=0,h[4]=m[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ae.fromMat2d=function(h,m){return h[0]=m[0],h[1]=m[1],h[2]=0,h[3]=m[2],h[4]=m[3],h[5]=0,h[6]=m[4],h[7]=m[5],h[8]=1,h},Ae.fromQuat=function(h,m){var x=m[0],T=m[1],A=m[2],y=m[3],I=x+x,M=T+T,E=A+A,C=x*I,L=T*I,k=T*M,V=A*I,j=A*M,Z=A*E,G=y*I,Y=y*M,J=y*E;return h[0]=1-k-Z,h[3]=L-J,h[6]=V+Y,h[1]=L+J,h[4]=1-C-Z,h[7]=j-G,h[2]=V-Y,h[5]=j+G,h[8]=1-C-k,h},Ae.normalFromMat4=function(h,m){var x=m[0],T=m[1],A=m[2],y=m[3],I=m[4],M=m[5],E=m[6],C=m[7],L=m[8],k=m[9],V=m[10],j=m[11],Z=m[12],G=m[13],Y=m[14],J=m[15],se=x*M-T*I,pe=x*E-A*I,ue=x*C-y*I,he=T*E-A*M,Le=T*C-y*M,ce=A*C-y*E,Me=L*G-k*Z,Fe=L*Y-V*Z,ke=L*J-j*Z,Ge=k*Y-V*G,Xe=k*J-j*G,Ye=V*J-j*Y,Ze=se*Ye-pe*Xe+ue*Ge+he*ke-Le*Fe+ce*Me;return Ze?(h[0]=(M*Ye-E*Xe+C*Ge)*(Ze=1/Ze),h[1]=(E*ke-I*Ye-C*Fe)*Ze,h[2]=(I*Xe-M*ke+C*Me)*Ze,h[3]=(A*Xe-T*Ye-y*Ge)*Ze,h[4]=(x*Ye-A*ke+y*Fe)*Ze,h[5]=(T*ke-x*Xe-y*Me)*Ze,h[6]=(G*ce-Y*Le+J*he)*Ze,h[7]=(Y*ue-Z*ce-J*pe)*Ze,h[8]=(Z*Le-G*ue+J*se)*Ze,h):null},Ae.projection=function(h,m,x){return h[0]=2/m,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/x,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},Ae.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},Ae.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},Ae.add=function(h,m,x){return h[0]=m[0]+x[0],h[1]=m[1]+x[1],h[2]=m[2]+x[2],h[3]=m[3]+x[3],h[4]=m[4]+x[4],h[5]=m[5]+x[5],h[6]=m[6]+x[6],h[7]=m[7]+x[7],h[8]=m[8]+x[8],h},Ae.subtract=p,Ae.multiplyScalar=function(h,m,x){return h[0]=m[0]*x,h[1]=m[1]*x,h[2]=m[2]*x,h[3]=m[3]*x,h[4]=m[4]*x,h[5]=m[5]*x,h[6]=m[6]*x,h[7]=m[7]*x,h[8]=m[8]*x,h},Ae.multiplyScalarAndAdd=function(h,m,x,T){return h[0]=m[0]+x[0]*T,h[1]=m[1]+x[1]*T,h[2]=m[2]+x[2]*T,h[3]=m[3]+x[3]*T,h[4]=m[4]+x[4]*T,h[5]=m[5]+x[5]*T,h[6]=m[6]+x[6]*T,h[7]=m[7]+x[7]*T,h[8]=m[8]+x[8]*T,h},Ae.exactEquals=function(h,m){return h[0]===m[0]&&h[1]===m[1]&&h[2]===m[2]&&h[3]===m[3]&&h[4]===m[4]&&h[5]===m[5]&&h[6]===m[6]&&h[7]===m[7]&&h[8]===m[8]},Ae.equals=function(h,m){var x=h[0],T=h[1],A=h[2],y=h[3],I=h[4],M=h[5],E=h[6],C=h[7],L=h[8],k=m[0],V=m[1],j=m[2],Z=m[3],G=m[4],Y=m[5],J=m[6],se=m[7],pe=m[8];return Math.abs(x-k)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(k))&&Math.abs(T-V)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(V))&&Math.abs(A-j)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(j))&&Math.abs(y-Z)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(I-G)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(G))&&Math.abs(M-Y)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(Y))&&Math.abs(E-J)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs(J))&&Math.abs(C-se)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(se))&&Math.abs(L-pe)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(pe))},Ae.sub=Ae.mul=void 0;var t=function(h,m){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var x=s(void 0);if(x&&x.has(h))return x.get(h);var T={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in h)if(y!=="default"&&Object.prototype.hasOwnProperty.call(h,y)){var I=A?Object.getOwnPropertyDescriptor(h,y):null;I&&(I.get||I.set)?Object.defineProperty(T,y,I):T[y]=h[y]}return T.default=h,x&&x.set(h,T),T}(Te());function s(h){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(T){return T?x:m})(h)}function c(h,m,x){var T=m[0],A=m[1],y=m[2],I=m[3],M=m[4],E=m[5],C=m[6],L=m[7],k=m[8],V=x[0],j=x[1],Z=x[2],G=x[3],Y=x[4],J=x[5],se=x[6],pe=x[7],ue=x[8];return h[0]=V*T+j*I+Z*C,h[1]=V*A+j*M+Z*L,h[2]=V*y+j*E+Z*k,h[3]=G*T+Y*I+J*C,h[4]=G*A+Y*M+J*L,h[5]=G*y+Y*E+J*k,h[6]=se*T+pe*I+ue*C,h[7]=se*A+pe*M+ue*L,h[8]=se*y+pe*E+ue*k,h}function p(h,m,x){return h[0]=m[0]-x[0],h[1]=m[1]-x[1],h[2]=m[2]-x[2],h[3]=m[3]-x[3],h[4]=m[4]-x[4],h[5]=m[5]-x[5],h[6]=m[6]-x[6],h[7]=m[7]-x[7],h[8]=m[8]-x[8],h}return Ae.mul=c,Ae.sub=p,Ae}var en,ze={};function ft(){if(en)return ze;function l(y){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(y)}en=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.create=function(){var y=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=0,y[12]=0,y[13]=0,y[14]=0),y[0]=1,y[5]=1,y[10]=1,y[15]=1,y},ze.clone=function(y){var I=new t.ARRAY_TYPE(16);return I[0]=y[0],I[1]=y[1],I[2]=y[2],I[3]=y[3],I[4]=y[4],I[5]=y[5],I[6]=y[6],I[7]=y[7],I[8]=y[8],I[9]=y[9],I[10]=y[10],I[11]=y[11],I[12]=y[12],I[13]=y[13],I[14]=y[14],I[15]=y[15],I},ze.copy=function(y,I){return y[0]=I[0],y[1]=I[1],y[2]=I[2],y[3]=I[3],y[4]=I[4],y[5]=I[5],y[6]=I[6],y[7]=I[7],y[8]=I[8],y[9]=I[9],y[10]=I[10],y[11]=I[11],y[12]=I[12],y[13]=I[13],y[14]=I[14],y[15]=I[15],y},ze.fromValues=function(y,I,M,E,C,L,k,V,j,Z,G,Y,J,se,pe,ue){var he=new t.ARRAY_TYPE(16);return he[0]=y,he[1]=I,he[2]=M,he[3]=E,he[4]=C,he[5]=L,he[6]=k,he[7]=V,he[8]=j,he[9]=Z,he[10]=G,he[11]=Y,he[12]=J,he[13]=se,he[14]=pe,he[15]=ue,he},ze.set=function(y,I,M,E,C,L,k,V,j,Z,G,Y,J,se,pe,ue,he){return y[0]=I,y[1]=M,y[2]=E,y[3]=C,y[4]=L,y[5]=k,y[6]=V,y[7]=j,y[8]=Z,y[9]=G,y[10]=Y,y[11]=J,y[12]=se,y[13]=pe,y[14]=ue,y[15]=he,y},ze.identity=c,ze.transpose=function(y,I){if(y===I){var M=I[1],E=I[2],C=I[3],L=I[6],k=I[7],V=I[11];y[1]=I[4],y[2]=I[8],y[3]=I[12],y[4]=M,y[6]=I[9],y[7]=I[13],y[8]=E,y[9]=L,y[11]=I[14],y[12]=C,y[13]=k,y[14]=V}else y[0]=I[0],y[1]=I[4],y[2]=I[8],y[3]=I[12],y[4]=I[1],y[5]=I[5],y[6]=I[9],y[7]=I[13],y[8]=I[2],y[9]=I[6],y[10]=I[10],y[11]=I[14],y[12]=I[3],y[13]=I[7],y[14]=I[11],y[15]=I[15];return y},ze.invert=function(y,I){var M=I[0],E=I[1],C=I[2],L=I[3],k=I[4],V=I[5],j=I[6],Z=I[7],G=I[8],Y=I[9],J=I[10],se=I[11],pe=I[12],ue=I[13],he=I[14],Le=I[15],ce=M*V-E*k,Me=M*j-C*k,Fe=M*Z-L*k,ke=E*j-C*V,Ge=E*Z-L*V,Xe=C*Z-L*j,Ye=G*ue-Y*pe,Ze=G*he-J*pe,ut=G*Le-se*pe,Et=Y*he-J*ue,ot=Y*Le-se*ue,jt=J*Le-se*he,Dt=ce*jt-Me*ot+Fe*Et+ke*ut-Ge*Ze+Xe*Ye;return Dt?(y[0]=(V*jt-j*ot+Z*Et)*(Dt=1/Dt),y[1]=(C*ot-E*jt-L*Et)*Dt,y[2]=(ue*Xe-he*Ge+Le*ke)*Dt,y[3]=(J*Ge-Y*Xe-se*ke)*Dt,y[4]=(j*ut-k*jt-Z*Ze)*Dt,y[5]=(M*jt-C*ut+L*Ze)*Dt,y[6]=(he*Fe-pe*Xe-Le*Me)*Dt,y[7]=(G*Xe-J*Fe+se*Me)*Dt,y[8]=(k*ot-V*ut+Z*Ye)*Dt,y[9]=(E*ut-M*ot-L*Ye)*Dt,y[10]=(pe*Ge-ue*Fe+Le*ce)*Dt,y[11]=(Y*Fe-G*Ge-se*ce)*Dt,y[12]=(V*Ze-k*Et-j*Ye)*Dt,y[13]=(M*Et-E*Ze+C*Ye)*Dt,y[14]=(ue*Me-pe*ke-he*ce)*Dt,y[15]=(G*ke-Y*Me+J*ce)*Dt,y):null},ze.adjoint=function(y,I){var M=I[0],E=I[1],C=I[2],L=I[3],k=I[4],V=I[5],j=I[6],Z=I[7],G=I[8],Y=I[9],J=I[10],se=I[11],pe=I[12],ue=I[13],he=I[14],Le=I[15];return y[0]=V*(J*Le-se*he)-Y*(j*Le-Z*he)+ue*(j*se-Z*J),y[1]=-(E*(J*Le-se*he)-Y*(C*Le-L*he)+ue*(C*se-L*J)),y[2]=E*(j*Le-Z*he)-V*(C*Le-L*he)+ue*(C*Z-L*j),y[3]=-(E*(j*se-Z*J)-V*(C*se-L*J)+Y*(C*Z-L*j)),y[4]=-(k*(J*Le-se*he)-G*(j*Le-Z*he)+pe*(j*se-Z*J)),y[5]=M*(J*Le-se*he)-G*(C*Le-L*he)+pe*(C*se-L*J),y[6]=-(M*(j*Le-Z*he)-k*(C*Le-L*he)+pe*(C*Z-L*j)),y[7]=M*(j*se-Z*J)-k*(C*se-L*J)+G*(C*Z-L*j),y[8]=k*(Y*Le-se*ue)-G*(V*Le-Z*ue)+pe*(V*se-Z*Y),y[9]=-(M*(Y*Le-se*ue)-G*(E*Le-L*ue)+pe*(E*se-L*Y)),y[10]=M*(V*Le-Z*ue)-k*(E*Le-L*ue)+pe*(E*Z-L*V),y[11]=-(M*(V*se-Z*Y)-k*(E*se-L*Y)+G*(E*Z-L*V)),y[12]=-(k*(Y*he-J*ue)-G*(V*he-j*ue)+pe*(V*J-j*Y)),y[13]=M*(Y*he-J*ue)-G*(E*he-C*ue)+pe*(E*J-C*Y),y[14]=-(M*(V*he-j*ue)-k*(E*he-C*ue)+pe*(E*j-C*V)),y[15]=M*(V*J-j*Y)-k*(E*J-C*Y)+G*(E*j-C*V),y},ze.determinant=function(y){var I=y[0],M=y[1],E=y[2],C=y[3],L=y[4],k=y[5],V=y[6],j=y[7],Z=y[8],G=y[9],Y=y[10],J=y[11],se=y[12],pe=y[13],ue=y[14],he=y[15];return(I*k-M*L)*(Y*he-J*ue)-(I*V-E*L)*(G*he-J*pe)+(I*j-C*L)*(G*ue-Y*pe)+(M*V-E*k)*(Z*he-J*se)-(M*j-C*k)*(Z*ue-Y*se)+(E*j-C*V)*(Z*pe-G*se)},ze.multiply=p,ze.translate=function(y,I,M){var E,C,L,k,V,j,Z,G,Y,J,se,pe,ue=M[0],he=M[1],Le=M[2];return I===y?(y[12]=I[0]*ue+I[4]*he+I[8]*Le+I[12],y[13]=I[1]*ue+I[5]*he+I[9]*Le+I[13],y[14]=I[2]*ue+I[6]*he+I[10]*Le+I[14],y[15]=I[3]*ue+I[7]*he+I[11]*Le+I[15]):(C=I[1],L=I[2],k=I[3],V=I[4],j=I[5],Z=I[6],G=I[7],Y=I[8],J=I[9],se=I[10],pe=I[11],y[0]=E=I[0],y[1]=C,y[2]=L,y[3]=k,y[4]=V,y[5]=j,y[6]=Z,y[7]=G,y[8]=Y,y[9]=J,y[10]=se,y[11]=pe,y[12]=E*ue+V*he+Y*Le+I[12],y[13]=C*ue+j*he+J*Le+I[13],y[14]=L*ue+Z*he+se*Le+I[14],y[15]=k*ue+G*he+pe*Le+I[15]),y},ze.scale=function(y,I,M){var E=M[0],C=M[1],L=M[2];return y[0]=I[0]*E,y[1]=I[1]*E,y[2]=I[2]*E,y[3]=I[3]*E,y[4]=I[4]*C,y[5]=I[5]*C,y[6]=I[6]*C,y[7]=I[7]*C,y[8]=I[8]*L,y[9]=I[9]*L,y[10]=I[10]*L,y[11]=I[11]*L,y[12]=I[12],y[13]=I[13],y[14]=I[14],y[15]=I[15],y},ze.rotate=function(y,I,M,E){var C,L,k,V,j,Z,G,Y,J,se,pe,ue,he,Le,ce,Me,Fe,ke,Ge,Xe,Ye,Ze,ut,Et,ot=E[0],jt=E[1],Dt=E[2],Ct=Math.hypot(ot,jt,Dt);return Ct<t.EPSILON?null:(ot*=Ct=1/Ct,jt*=Ct,Dt*=Ct,C=Math.sin(M),L=Math.cos(M),j=I[1],Z=I[2],G=I[3],J=I[5],se=I[6],pe=I[7],he=I[9],Le=I[10],ce=I[11],Me=ot*ot*(k=1-L)+L,Ge=ot*jt*k-Dt*C,Xe=jt*jt*k+L,Ye=Dt*jt*k+ot*C,Ze=ot*Dt*k+jt*C,ut=jt*Dt*k-ot*C,Et=Dt*Dt*k+L,y[0]=(V=I[0])*Me+(Y=I[4])*(Fe=jt*ot*k+Dt*C)+(ue=I[8])*(ke=Dt*ot*k-jt*C),y[1]=j*Me+J*Fe+he*ke,y[2]=Z*Me+se*Fe+Le*ke,y[3]=G*Me+pe*Fe+ce*ke,y[4]=V*Ge+Y*Xe+ue*Ye,y[5]=j*Ge+J*Xe+he*Ye,y[6]=Z*Ge+se*Xe+Le*Ye,y[7]=G*Ge+pe*Xe+ce*Ye,y[8]=V*Ze+Y*ut+ue*Et,y[9]=j*Ze+J*ut+he*Et,y[10]=Z*Ze+se*ut+Le*Et,y[11]=G*Ze+pe*ut+ce*Et,I!==y&&(y[12]=I[12],y[13]=I[13],y[14]=I[14],y[15]=I[15]),y)},ze.rotateX=function(y,I,M){var E=Math.sin(M),C=Math.cos(M),L=I[4],k=I[5],V=I[6],j=I[7],Z=I[8],G=I[9],Y=I[10],J=I[11];return I!==y&&(y[0]=I[0],y[1]=I[1],y[2]=I[2],y[3]=I[3],y[12]=I[12],y[13]=I[13],y[14]=I[14],y[15]=I[15]),y[4]=L*C+Z*E,y[5]=k*C+G*E,y[6]=V*C+Y*E,y[7]=j*C+J*E,y[8]=Z*C-L*E,y[9]=G*C-k*E,y[10]=Y*C-V*E,y[11]=J*C-j*E,y},ze.rotateY=function(y,I,M){var E=Math.sin(M),C=Math.cos(M),L=I[0],k=I[1],V=I[2],j=I[3],Z=I[8],G=I[9],Y=I[10],J=I[11];return I!==y&&(y[4]=I[4],y[5]=I[5],y[6]=I[6],y[7]=I[7],y[12]=I[12],y[13]=I[13],y[14]=I[14],y[15]=I[15]),y[0]=L*C-Z*E,y[1]=k*C-G*E,y[2]=V*C-Y*E,y[3]=j*C-J*E,y[8]=L*E+Z*C,y[9]=k*E+G*C,y[10]=V*E+Y*C,y[11]=j*E+J*C,y},ze.rotateZ=function(y,I,M){var E=Math.sin(M),C=Math.cos(M),L=I[0],k=I[1],V=I[2],j=I[3],Z=I[4],G=I[5],Y=I[6],J=I[7];return I!==y&&(y[8]=I[8],y[9]=I[9],y[10]=I[10],y[11]=I[11],y[12]=I[12],y[13]=I[13],y[14]=I[14],y[15]=I[15]),y[0]=L*C+Z*E,y[1]=k*C+G*E,y[2]=V*C+Y*E,y[3]=j*C+J*E,y[4]=Z*C-L*E,y[5]=G*C-k*E,y[6]=Y*C-V*E,y[7]=J*C-j*E,y},ze.fromTranslation=function(y,I){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=I[0],y[13]=I[1],y[14]=I[2],y[15]=1,y},ze.fromScaling=function(y,I){return y[0]=I[0],y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=I[1],y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=I[2],y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},ze.fromRotation=function(y,I,M){var E,C,L,k=M[0],V=M[1],j=M[2],Z=Math.hypot(k,V,j);return Z<t.EPSILON?null:(k*=Z=1/Z,V*=Z,j*=Z,E=Math.sin(I),C=Math.cos(I),y[0]=k*k*(L=1-C)+C,y[1]=V*k*L+j*E,y[2]=j*k*L-V*E,y[3]=0,y[4]=k*V*L-j*E,y[5]=V*V*L+C,y[6]=j*V*L+k*E,y[7]=0,y[8]=k*j*L+V*E,y[9]=V*j*L-k*E,y[10]=j*j*L+C,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y)},ze.fromXRotation=function(y,I){var M=Math.sin(I),E=Math.cos(I);return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=E,y[6]=M,y[7]=0,y[8]=0,y[9]=-M,y[10]=E,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},ze.fromYRotation=function(y,I){var M=Math.sin(I),E=Math.cos(I);return y[0]=E,y[1]=0,y[2]=-M,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=M,y[9]=0,y[10]=E,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},ze.fromZRotation=function(y,I){var M=Math.sin(I),E=Math.cos(I);return y[0]=E,y[1]=M,y[2]=0,y[3]=0,y[4]=-M,y[5]=E,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},ze.fromRotationTranslation=h,ze.fromQuat2=function(y,I){var M=new t.ARRAY_TYPE(3),E=-I[0],C=-I[1],L=-I[2],k=I[3],V=I[4],j=I[5],Z=I[6],G=I[7],Y=E*E+C*C+L*L+k*k;return Y>0?(M[0]=2*(V*k+G*E+j*L-Z*C)/Y,M[1]=2*(j*k+G*C+Z*E-V*L)/Y,M[2]=2*(Z*k+G*L+V*C-j*E)/Y):(M[0]=2*(V*k+G*E+j*L-Z*C),M[1]=2*(j*k+G*C+Z*E-V*L),M[2]=2*(Z*k+G*L+V*C-j*E)),h(y,I,M),y},ze.getTranslation=function(y,I){return y[0]=I[12],y[1]=I[13],y[2]=I[14],y},ze.getScaling=m,ze.getRotation=function(y,I){var M=new t.ARRAY_TYPE(3);m(M,I);var E=1/M[0],C=1/M[1],L=1/M[2],k=I[0]*E,V=I[1]*C,j=I[2]*L,Z=I[4]*E,G=I[5]*C,Y=I[6]*L,J=I[8]*E,se=I[9]*C,pe=I[10]*L,ue=k+G+pe,he=0;return ue>0?(he=2*Math.sqrt(ue+1),y[3]=.25*he,y[0]=(Y-se)/he,y[1]=(J-j)/he,y[2]=(V-Z)/he):k>G&&k>pe?(he=2*Math.sqrt(1+k-G-pe),y[3]=(Y-se)/he,y[0]=.25*he,y[1]=(V+Z)/he,y[2]=(J+j)/he):G>pe?(he=2*Math.sqrt(1+G-k-pe),y[3]=(J-j)/he,y[0]=(V+Z)/he,y[1]=.25*he,y[2]=(Y+se)/he):(he=2*Math.sqrt(1+pe-k-G),y[3]=(V-Z)/he,y[0]=(J+j)/he,y[1]=(Y+se)/he,y[2]=.25*he),y},ze.fromRotationTranslationScale=function(y,I,M,E){var C=I[0],L=I[1],k=I[2],V=I[3],j=C+C,Z=L+L,G=k+k,Y=C*j,J=C*Z,se=C*G,pe=L*Z,ue=L*G,he=k*G,Le=V*j,ce=V*Z,Me=V*G,Fe=E[0],ke=E[1],Ge=E[2];return y[0]=(1-(pe+he))*Fe,y[1]=(J+Me)*Fe,y[2]=(se-ce)*Fe,y[3]=0,y[4]=(J-Me)*ke,y[5]=(1-(Y+he))*ke,y[6]=(ue+Le)*ke,y[7]=0,y[8]=(se+ce)*Ge,y[9]=(ue-Le)*Ge,y[10]=(1-(Y+pe))*Ge,y[11]=0,y[12]=M[0],y[13]=M[1],y[14]=M[2],y[15]=1,y},ze.fromRotationTranslationScaleOrigin=function(y,I,M,E,C){var L=I[0],k=I[1],V=I[2],j=I[3],Z=L+L,G=k+k,Y=V+V,J=L*Z,se=L*G,pe=L*Y,ue=k*G,he=k*Y,Le=V*Y,ce=j*Z,Me=j*G,Fe=j*Y,ke=E[0],Ge=E[1],Xe=E[2],Ye=C[0],Ze=C[1],ut=C[2],Et=(1-(ue+Le))*ke,ot=(se+Fe)*ke,jt=(pe-Me)*ke,Dt=(se-Fe)*Ge,Ct=(1-(J+Le))*Ge,bt=(he+ce)*Ge,an=(pe+Me)*Xe,qt=(he-ce)*Xe,$t=(1-(J+ue))*Xe;return y[0]=Et,y[1]=ot,y[2]=jt,y[3]=0,y[4]=Dt,y[5]=Ct,y[6]=bt,y[7]=0,y[8]=an,y[9]=qt,y[10]=$t,y[11]=0,y[12]=M[0]+Ye-(Et*Ye+Dt*Ze+an*ut),y[13]=M[1]+Ze-(ot*Ye+Ct*Ze+qt*ut),y[14]=M[2]+ut-(jt*Ye+bt*Ze+$t*ut),y[15]=1,y},ze.fromQuat=function(y,I){var M=I[0],E=I[1],C=I[2],L=I[3],k=M+M,V=E+E,j=C+C,Z=M*k,G=E*k,Y=E*V,J=C*k,se=C*V,pe=C*j,ue=L*k,he=L*V,Le=L*j;return y[0]=1-Y-pe,y[1]=G+Le,y[2]=J-he,y[3]=0,y[4]=G-Le,y[5]=1-Z-pe,y[6]=se+ue,y[7]=0,y[8]=J+he,y[9]=se-ue,y[10]=1-Z-Y,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},ze.frustum=function(y,I,M,E,C,L,k){var V=1/(M-I),j=1/(C-E),Z=1/(L-k);return y[0]=2*L*V,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2*L*j,y[6]=0,y[7]=0,y[8]=(M+I)*V,y[9]=(C+E)*j,y[10]=(k+L)*Z,y[11]=-1,y[12]=0,y[13]=0,y[14]=k*L*2*Z,y[15]=0,y},ze.perspectiveNO=x,ze.perspectiveZO=function(y,I,M,E,C){var L,k=1/Math.tan(I/2);return y[0]=k/M,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=k,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,C!=null&&C!==1/0?(y[10]=C*(L=1/(E-C)),y[14]=C*E*L):(y[10]=-1,y[14]=-E),y},ze.perspectiveFromFieldOfView=function(y,I,M,E){var C=Math.tan(I.upDegrees*Math.PI/180),L=Math.tan(I.downDegrees*Math.PI/180),k=Math.tan(I.leftDegrees*Math.PI/180),V=Math.tan(I.rightDegrees*Math.PI/180),j=2/(k+V),Z=2/(C+L);return y[0]=j,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=Z,y[6]=0,y[7]=0,y[8]=-(k-V)*j*.5,y[9]=(C-L)*Z*.5,y[10]=E/(M-E),y[11]=-1,y[12]=0,y[13]=0,y[14]=E*M/(M-E),y[15]=0,y},ze.orthoNO=T,ze.orthoZO=function(y,I,M,E,C,L,k){var V=1/(I-M),j=1/(E-C),Z=1/(L-k);return y[0]=-2*V,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*j,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=Z,y[11]=0,y[12]=(I+M)*V,y[13]=(C+E)*j,y[14]=L*Z,y[15]=1,y},ze.lookAt=function(y,I,M,E){var C,L,k,V,j,Z,G,Y,J,se,pe=I[0],ue=I[1],he=I[2],Le=E[0],ce=E[1],Me=E[2],Fe=M[0],ke=M[1],Ge=M[2];return Math.abs(pe-Fe)<t.EPSILON&&Math.abs(ue-ke)<t.EPSILON&&Math.abs(he-Ge)<t.EPSILON?c(y):(G=pe-Fe,Y=ue-ke,J=he-Ge,C=ce*(J*=se=1/Math.hypot(G,Y,J))-Me*(Y*=se),L=Me*(G*=se)-Le*J,k=Le*Y-ce*G,(se=Math.hypot(C,L,k))?(C*=se=1/se,L*=se,k*=se):(C=0,L=0,k=0),V=Y*k-J*L,j=J*C-G*k,Z=G*L-Y*C,(se=Math.hypot(V,j,Z))?(V*=se=1/se,j*=se,Z*=se):(V=0,j=0,Z=0),y[0]=C,y[1]=V,y[2]=G,y[3]=0,y[4]=L,y[5]=j,y[6]=Y,y[7]=0,y[8]=k,y[9]=Z,y[10]=J,y[11]=0,y[12]=-(C*pe+L*ue+k*he),y[13]=-(V*pe+j*ue+Z*he),y[14]=-(G*pe+Y*ue+J*he),y[15]=1,y)},ze.targetTo=function(y,I,M,E){var C=I[0],L=I[1],k=I[2],V=E[0],j=E[1],Z=E[2],G=C-M[0],Y=L-M[1],J=k-M[2],se=G*G+Y*Y+J*J;se>0&&(G*=se=1/Math.sqrt(se),Y*=se,J*=se);var pe=j*J-Z*Y,ue=Z*G-V*J,he=V*Y-j*G;return(se=pe*pe+ue*ue+he*he)>0&&(pe*=se=1/Math.sqrt(se),ue*=se,he*=se),y[0]=pe,y[1]=ue,y[2]=he,y[3]=0,y[4]=Y*he-J*ue,y[5]=J*pe-G*he,y[6]=G*ue-Y*pe,y[7]=0,y[8]=G,y[9]=Y,y[10]=J,y[11]=0,y[12]=C,y[13]=L,y[14]=k,y[15]=1,y},ze.str=function(y){return"mat4("+y[0]+", "+y[1]+", "+y[2]+", "+y[3]+", "+y[4]+", "+y[5]+", "+y[6]+", "+y[7]+", "+y[8]+", "+y[9]+", "+y[10]+", "+y[11]+", "+y[12]+", "+y[13]+", "+y[14]+", "+y[15]+")"},ze.frob=function(y){return Math.hypot(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15])},ze.add=function(y,I,M){return y[0]=I[0]+M[0],y[1]=I[1]+M[1],y[2]=I[2]+M[2],y[3]=I[3]+M[3],y[4]=I[4]+M[4],y[5]=I[5]+M[5],y[6]=I[6]+M[6],y[7]=I[7]+M[7],y[8]=I[8]+M[8],y[9]=I[9]+M[9],y[10]=I[10]+M[10],y[11]=I[11]+M[11],y[12]=I[12]+M[12],y[13]=I[13]+M[13],y[14]=I[14]+M[14],y[15]=I[15]+M[15],y},ze.subtract=A,ze.multiplyScalar=function(y,I,M){return y[0]=I[0]*M,y[1]=I[1]*M,y[2]=I[2]*M,y[3]=I[3]*M,y[4]=I[4]*M,y[5]=I[5]*M,y[6]=I[6]*M,y[7]=I[7]*M,y[8]=I[8]*M,y[9]=I[9]*M,y[10]=I[10]*M,y[11]=I[11]*M,y[12]=I[12]*M,y[13]=I[13]*M,y[14]=I[14]*M,y[15]=I[15]*M,y},ze.multiplyScalarAndAdd=function(y,I,M,E){return y[0]=I[0]+M[0]*E,y[1]=I[1]+M[1]*E,y[2]=I[2]+M[2]*E,y[3]=I[3]+M[3]*E,y[4]=I[4]+M[4]*E,y[5]=I[5]+M[5]*E,y[6]=I[6]+M[6]*E,y[7]=I[7]+M[7]*E,y[8]=I[8]+M[8]*E,y[9]=I[9]+M[9]*E,y[10]=I[10]+M[10]*E,y[11]=I[11]+M[11]*E,y[12]=I[12]+M[12]*E,y[13]=I[13]+M[13]*E,y[14]=I[14]+M[14]*E,y[15]=I[15]+M[15]*E,y},ze.exactEquals=function(y,I){return y[0]===I[0]&&y[1]===I[1]&&y[2]===I[2]&&y[3]===I[3]&&y[4]===I[4]&&y[5]===I[5]&&y[6]===I[6]&&y[7]===I[7]&&y[8]===I[8]&&y[9]===I[9]&&y[10]===I[10]&&y[11]===I[11]&&y[12]===I[12]&&y[13]===I[13]&&y[14]===I[14]&&y[15]===I[15]},ze.equals=function(y,I){var M=y[0],E=y[1],C=y[2],L=y[3],k=y[4],V=y[5],j=y[6],Z=y[7],G=y[8],Y=y[9],J=y[10],se=y[11],pe=y[12],ue=y[13],he=y[14],Le=y[15],ce=I[0],Me=I[1],Fe=I[2],ke=I[3],Ge=I[4],Xe=I[5],Ye=I[6],Ze=I[7],ut=I[8],Et=I[9],ot=I[10],jt=I[11],Dt=I[12],Ct=I[13],bt=I[14],an=I[15];return Math.abs(M-ce)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(ce))&&Math.abs(E-Me)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs(Me))&&Math.abs(C-Fe)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(Fe))&&Math.abs(L-ke)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(ke))&&Math.abs(k-Ge)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ge))&&Math.abs(V-Xe)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs(Xe))&&Math.abs(j-Ye)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ye))&&Math.abs(Z-Ze)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ze))&&Math.abs(G-ut)<=t.EPSILON*Math.max(1,Math.abs(G),Math.abs(ut))&&Math.abs(Y-Et)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Et))&&Math.abs(J-ot)<=t.EPSILON*Math.max(1,Math.abs(J),Math.abs(ot))&&Math.abs(se-jt)<=t.EPSILON*Math.max(1,Math.abs(se),Math.abs(jt))&&Math.abs(pe-Dt)<=t.EPSILON*Math.max(1,Math.abs(pe),Math.abs(Dt))&&Math.abs(ue-Ct)<=t.EPSILON*Math.max(1,Math.abs(ue),Math.abs(Ct))&&Math.abs(he-bt)<=t.EPSILON*Math.max(1,Math.abs(he),Math.abs(bt))&&Math.abs(Le-an)<=t.EPSILON*Math.max(1,Math.abs(Le),Math.abs(an))},ze.sub=ze.mul=ze.ortho=ze.perspective=void 0;var t=function(y,I){if(y&&y.__esModule)return y;if(y===null||l(y)!=="object"&&typeof y!="function")return{default:y};var M=s(void 0);if(M&&M.has(y))return M.get(y);var E={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in y)if(L!=="default"&&Object.prototype.hasOwnProperty.call(y,L)){var k=C?Object.getOwnPropertyDescriptor(y,L):null;k&&(k.get||k.set)?Object.defineProperty(E,L,k):E[L]=y[L]}return E.default=y,M&&M.set(y,E),E}(Te());function s(y){if(typeof WeakMap!="function")return null;var I=new WeakMap,M=new WeakMap;return(s=function(E){return E?M:I})(y)}function c(y){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y}function p(y,I,M){var E=I[0],C=I[1],L=I[2],k=I[3],V=I[4],j=I[5],Z=I[6],G=I[7],Y=I[8],J=I[9],se=I[10],pe=I[11],ue=I[12],he=I[13],Le=I[14],ce=I[15],Me=M[0],Fe=M[1],ke=M[2],Ge=M[3];return y[0]=Me*E+Fe*V+ke*Y+Ge*ue,y[1]=Me*C+Fe*j+ke*J+Ge*he,y[2]=Me*L+Fe*Z+ke*se+Ge*Le,y[3]=Me*k+Fe*G+ke*pe+Ge*ce,y[4]=(Me=M[4])*E+(Fe=M[5])*V+(ke=M[6])*Y+(Ge=M[7])*ue,y[5]=Me*C+Fe*j+ke*J+Ge*he,y[6]=Me*L+Fe*Z+ke*se+Ge*Le,y[7]=Me*k+Fe*G+ke*pe+Ge*ce,y[8]=(Me=M[8])*E+(Fe=M[9])*V+(ke=M[10])*Y+(Ge=M[11])*ue,y[9]=Me*C+Fe*j+ke*J+Ge*he,y[10]=Me*L+Fe*Z+ke*se+Ge*Le,y[11]=Me*k+Fe*G+ke*pe+Ge*ce,y[12]=(Me=M[12])*E+(Fe=M[13])*V+(ke=M[14])*Y+(Ge=M[15])*ue,y[13]=Me*C+Fe*j+ke*J+Ge*he,y[14]=Me*L+Fe*Z+ke*se+Ge*Le,y[15]=Me*k+Fe*G+ke*pe+Ge*ce,y}function h(y,I,M){var E=I[0],C=I[1],L=I[2],k=I[3],V=E+E,j=C+C,Z=L+L,G=E*V,Y=E*j,J=E*Z,se=C*j,pe=C*Z,ue=L*Z,he=k*V,Le=k*j,ce=k*Z;return y[0]=1-(se+ue),y[1]=Y+ce,y[2]=J-Le,y[3]=0,y[4]=Y-ce,y[5]=1-(G+ue),y[6]=pe+he,y[7]=0,y[8]=J+Le,y[9]=pe-he,y[10]=1-(G+se),y[11]=0,y[12]=M[0],y[13]=M[1],y[14]=M[2],y[15]=1,y}function m(y,I){var M=I[4],E=I[5],C=I[6],L=I[8],k=I[9],V=I[10];return y[0]=Math.hypot(I[0],I[1],I[2]),y[1]=Math.hypot(M,E,C),y[2]=Math.hypot(L,k,V),y}function x(y,I,M,E,C){var L,k=1/Math.tan(I/2);return y[0]=k/M,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=k,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,C!=null&&C!==1/0?(y[10]=(C+E)*(L=1/(E-C)),y[14]=2*C*E*L):(y[10]=-1,y[14]=-2*E),y}function T(y,I,M,E,C,L,k){var V=1/(I-M),j=1/(E-C),Z=1/(L-k);return y[0]=-2*V,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*j,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=2*Z,y[11]=0,y[12]=(I+M)*V,y[13]=(C+E)*j,y[14]=(k+L)*Z,y[15]=1,y}function A(y,I,M){return y[0]=I[0]-M[0],y[1]=I[1]-M[1],y[2]=I[2]-M[2],y[3]=I[3]-M[3],y[4]=I[4]-M[4],y[5]=I[5]-M[5],y[6]=I[6]-M[6],y[7]=I[7]-M[7],y[8]=I[8]-M[8],y[9]=I[9]-M[9],y[10]=I[10]-M[10],y[11]=I[11]-M[11],y[12]=I[12]-M[12],y[13]=I[13]-M[13],y[14]=I[14]-M[14],y[15]=I[15]-M[15],y}return ze.perspective=x,ze.ortho=T,ze.mul=p,ze.sub=A,ze}var et,ht={},it={};function le(){if(et)return it;function l(C){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},l(C)}et=1,Object.defineProperty(it,"__esModule",{value:!0}),it.create=c,it.clone=function(C){var L=new t.ARRAY_TYPE(3);return L[0]=C[0],L[1]=C[1],L[2]=C[2],L},it.length=p,it.fromValues=function(C,L,k){var V=new t.ARRAY_TYPE(3);return V[0]=C,V[1]=L,V[2]=k,V},it.copy=function(C,L){return C[0]=L[0],C[1]=L[1],C[2]=L[2],C},it.set=function(C,L,k,V){return C[0]=L,C[1]=k,C[2]=V,C},it.add=function(C,L,k){return C[0]=L[0]+k[0],C[1]=L[1]+k[1],C[2]=L[2]+k[2],C},it.subtract=h,it.multiply=m,it.divide=x,it.ceil=function(C,L){return C[0]=Math.ceil(L[0]),C[1]=Math.ceil(L[1]),C[2]=Math.ceil(L[2]),C},it.floor=function(C,L){return C[0]=Math.floor(L[0]),C[1]=Math.floor(L[1]),C[2]=Math.floor(L[2]),C},it.min=function(C,L,k){return C[0]=Math.min(L[0],k[0]),C[1]=Math.min(L[1],k[1]),C[2]=Math.min(L[2],k[2]),C},it.max=function(C,L,k){return C[0]=Math.max(L[0],k[0]),C[1]=Math.max(L[1],k[1]),C[2]=Math.max(L[2],k[2]),C},it.round=function(C,L){return C[0]=Math.round(L[0]),C[1]=Math.round(L[1]),C[2]=Math.round(L[2]),C},it.scale=function(C,L,k){return C[0]=L[0]*k,C[1]=L[1]*k,C[2]=L[2]*k,C},it.scaleAndAdd=function(C,L,k,V){return C[0]=L[0]+k[0]*V,C[1]=L[1]+k[1]*V,C[2]=L[2]+k[2]*V,C},it.distance=T,it.squaredDistance=A,it.squaredLength=y,it.negate=function(C,L){return C[0]=-L[0],C[1]=-L[1],C[2]=-L[2],C},it.inverse=function(C,L){return C[0]=1/L[0],C[1]=1/L[1],C[2]=1/L[2],C},it.normalize=function(C,L){var k=L[0],V=L[1],j=L[2],Z=k*k+V*V+j*j;return Z>0&&(Z=1/Math.sqrt(Z)),C[0]=L[0]*Z,C[1]=L[1]*Z,C[2]=L[2]*Z,C},it.dot=I,it.cross=function(C,L,k){var V=L[0],j=L[1],Z=L[2],G=k[0],Y=k[1],J=k[2];return C[0]=j*J-Z*Y,C[1]=Z*G-V*J,C[2]=V*Y-j*G,C},it.lerp=function(C,L,k,V){var j=L[0],Z=L[1],G=L[2];return C[0]=j+V*(k[0]-j),C[1]=Z+V*(k[1]-Z),C[2]=G+V*(k[2]-G),C},it.hermite=function(C,L,k,V,j,Z){var G=Z*Z,Y=G*(2*Z-3)+1,J=G*(Z-2)+Z,se=G*(Z-1),pe=G*(3-2*Z);return C[0]=L[0]*Y+k[0]*J+V[0]*se+j[0]*pe,C[1]=L[1]*Y+k[1]*J+V[1]*se+j[1]*pe,C[2]=L[2]*Y+k[2]*J+V[2]*se+j[2]*pe,C},it.bezier=function(C,L,k,V,j,Z){var G=1-Z,Y=G*G,J=Z*Z,se=Y*G,pe=3*Z*Y,ue=3*J*G,he=J*Z;return C[0]=L[0]*se+k[0]*pe+V[0]*ue+j[0]*he,C[1]=L[1]*se+k[1]*pe+V[1]*ue+j[1]*he,C[2]=L[2]*se+k[2]*pe+V[2]*ue+j[2]*he,C},it.random=function(C,L){L=L||1;var k=2*t.RANDOM()*Math.PI,V=2*t.RANDOM()-1,j=Math.sqrt(1-V*V)*L;return C[0]=Math.cos(k)*j,C[1]=Math.sin(k)*j,C[2]=V*L,C},it.transformMat4=function(C,L,k){var V=L[0],j=L[1],Z=L[2],G=k[3]*V+k[7]*j+k[11]*Z+k[15];return C[0]=(k[0]*V+k[4]*j+k[8]*Z+k[12])/(G=G||1),C[1]=(k[1]*V+k[5]*j+k[9]*Z+k[13])/G,C[2]=(k[2]*V+k[6]*j+k[10]*Z+k[14])/G,C},it.transformMat3=function(C,L,k){var V=L[0],j=L[1],Z=L[2];return C[0]=V*k[0]+j*k[3]+Z*k[6],C[1]=V*k[1]+j*k[4]+Z*k[7],C[2]=V*k[2]+j*k[5]+Z*k[8],C},it.transformQuat=function(C,L,k){var V=k[0],j=k[1],Z=k[2],G=L[0],Y=L[1],J=L[2],se=j*J-Z*Y,pe=Z*G-V*J,ue=V*Y-j*G,he=j*ue-Z*pe,Le=Z*se-V*ue,ce=V*pe-j*se,Me=2*k[3];return pe*=Me,ue*=Me,Le*=2,ce*=2,C[0]=G+(se*=Me)+(he*=2),C[1]=Y+pe+Le,C[2]=J+ue+ce,C},it.rotateX=function(C,L,k,V){var j=[],Z=[];return j[0]=L[0]-k[0],j[1]=L[1]-k[1],j[2]=L[2]-k[2],Z[0]=j[0],Z[1]=j[1]*Math.cos(V)-j[2]*Math.sin(V),Z[2]=j[1]*Math.sin(V)+j[2]*Math.cos(V),C[0]=Z[0]+k[0],C[1]=Z[1]+k[1],C[2]=Z[2]+k[2],C},it.rotateY=function(C,L,k,V){var j=[],Z=[];return j[0]=L[0]-k[0],j[1]=L[1]-k[1],j[2]=L[2]-k[2],Z[0]=j[2]*Math.sin(V)+j[0]*Math.cos(V),Z[1]=j[1],Z[2]=j[2]*Math.cos(V)-j[0]*Math.sin(V),C[0]=Z[0]+k[0],C[1]=Z[1]+k[1],C[2]=Z[2]+k[2],C},it.rotateZ=function(C,L,k,V){var j=[],Z=[];return j[0]=L[0]-k[0],j[1]=L[1]-k[1],j[2]=L[2]-k[2],Z[0]=j[0]*Math.cos(V)-j[1]*Math.sin(V),Z[1]=j[0]*Math.sin(V)+j[1]*Math.cos(V),Z[2]=j[2],C[0]=Z[0]+k[0],C[1]=Z[1]+k[1],C[2]=Z[2]+k[2],C},it.angle=function(C,L){var k=C[0],V=C[1],j=C[2],Z=L[0],G=L[1],Y=L[2],J=Math.sqrt(k*k+V*V+j*j)*Math.sqrt(Z*Z+G*G+Y*Y),se=J&&I(C,L)/J;return Math.acos(Math.min(Math.max(se,-1),1))},it.zero=function(C){return C[0]=0,C[1]=0,C[2]=0,C},it.str=function(C){return"vec3("+C[0]+", "+C[1]+", "+C[2]+")"},it.exactEquals=function(C,L){return C[0]===L[0]&&C[1]===L[1]&&C[2]===L[2]},it.equals=function(C,L){var k=C[0],V=C[1],j=C[2],Z=L[0],G=L[1],Y=L[2];return Math.abs(k-Z)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(Z))&&Math.abs(V-G)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs(G))&&Math.abs(j-Y)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(Y))},it.forEach=it.sqrLen=it.len=it.sqrDist=it.dist=it.div=it.mul=it.sub=void 0;var t=function(C,L){if(C&&C.__esModule)return C;if(C===null||l(C)!=="object"&&typeof C!="function")return{default:C};var k=s(void 0);if(k&&k.has(C))return k.get(C);var V={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in C)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(C,Z)){var G=j?Object.getOwnPropertyDescriptor(C,Z):null;G&&(G.get||G.set)?Object.defineProperty(V,Z,G):V[Z]=C[Z]}return V.default=C,k&&k.set(C,V),V}(Te());function s(C){if(typeof WeakMap!="function")return null;var L=new WeakMap,k=new WeakMap;return(s=function(V){return V?k:L})(C)}function c(){var C=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0),C}function p(C){return Math.hypot(C[0],C[1],C[2])}function h(C,L,k){return C[0]=L[0]-k[0],C[1]=L[1]-k[1],C[2]=L[2]-k[2],C}function m(C,L,k){return C[0]=L[0]*k[0],C[1]=L[1]*k[1],C[2]=L[2]*k[2],C}function x(C,L,k){return C[0]=L[0]/k[0],C[1]=L[1]/k[1],C[2]=L[2]/k[2],C}function T(C,L){return Math.hypot(L[0]-C[0],L[1]-C[1],L[2]-C[2])}function A(C,L){var k=L[0]-C[0],V=L[1]-C[1],j=L[2]-C[2];return k*k+V*V+j*j}function y(C){var L=C[0],k=C[1],V=C[2];return L*L+k*k+V*V}function I(C,L){return C[0]*L[0]+C[1]*L[1]+C[2]*L[2]}it.sub=h,it.mul=m,it.div=x,it.dist=T,it.sqrDist=A,it.len=p,it.sqrLen=y;var M,E=(M=c(),function(C,L,k,V,j,Z){var G,Y;for(L||(L=3),k||(k=0),Y=V?Math.min(V*L+k,C.length):C.length,G=k;G<Y;G+=L)M[0]=C[G],M[1]=C[G+1],M[2]=C[G+2],j(M,M,Z),C[G]=M[0],C[G+1]=M[1],C[G+2]=M[2];return C});return it.forEach=E,it}var kt,zn,Qt={};function ri(){if(kt)return Qt;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(E)}kt=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=c,Qt.clone=function(E){var C=new t.ARRAY_TYPE(4);return C[0]=E[0],C[1]=E[1],C[2]=E[2],C[3]=E[3],C},Qt.fromValues=function(E,C,L,k){var V=new t.ARRAY_TYPE(4);return V[0]=E,V[1]=C,V[2]=L,V[3]=k,V},Qt.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E[2]=C[2],E[3]=C[3],E},Qt.set=function(E,C,L,k,V){return E[0]=C,E[1]=L,E[2]=k,E[3]=V,E},Qt.add=function(E,C,L){return E[0]=C[0]+L[0],E[1]=C[1]+L[1],E[2]=C[2]+L[2],E[3]=C[3]+L[3],E},Qt.subtract=p,Qt.multiply=h,Qt.divide=m,Qt.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E[2]=Math.ceil(C[2]),E[3]=Math.ceil(C[3]),E},Qt.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E[2]=Math.floor(C[2]),E[3]=Math.floor(C[3]),E},Qt.min=function(E,C,L){return E[0]=Math.min(C[0],L[0]),E[1]=Math.min(C[1],L[1]),E[2]=Math.min(C[2],L[2]),E[3]=Math.min(C[3],L[3]),E},Qt.max=function(E,C,L){return E[0]=Math.max(C[0],L[0]),E[1]=Math.max(C[1],L[1]),E[2]=Math.max(C[2],L[2]),E[3]=Math.max(C[3],L[3]),E},Qt.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E[2]=Math.round(C[2]),E[3]=Math.round(C[3]),E},Qt.scale=function(E,C,L){return E[0]=C[0]*L,E[1]=C[1]*L,E[2]=C[2]*L,E[3]=C[3]*L,E},Qt.scaleAndAdd=function(E,C,L,k){return E[0]=C[0]+L[0]*k,E[1]=C[1]+L[1]*k,E[2]=C[2]+L[2]*k,E[3]=C[3]+L[3]*k,E},Qt.distance=x,Qt.squaredDistance=T,Qt.length=A,Qt.squaredLength=y,Qt.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E[2]=-C[2],E[3]=-C[3],E},Qt.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E[2]=1/C[2],E[3]=1/C[3],E},Qt.normalize=function(E,C){var L=C[0],k=C[1],V=C[2],j=C[3],Z=L*L+k*k+V*V+j*j;return Z>0&&(Z=1/Math.sqrt(Z)),E[0]=L*Z,E[1]=k*Z,E[2]=V*Z,E[3]=j*Z,E},Qt.dot=function(E,C){return E[0]*C[0]+E[1]*C[1]+E[2]*C[2]+E[3]*C[3]},Qt.cross=function(E,C,L,k){var V=L[0]*k[1]-L[1]*k[0],j=L[0]*k[2]-L[2]*k[0],Z=L[0]*k[3]-L[3]*k[0],G=L[1]*k[2]-L[2]*k[1],Y=L[1]*k[3]-L[3]*k[1],J=L[2]*k[3]-L[3]*k[2],se=C[0],pe=C[1],ue=C[2],he=C[3];return E[0]=pe*J-ue*Y+he*G,E[1]=-se*J+ue*Z-he*j,E[2]=se*Y-pe*Z+he*V,E[3]=-se*G+pe*j-ue*V,E},Qt.lerp=function(E,C,L,k){var V=C[0],j=C[1],Z=C[2],G=C[3];return E[0]=V+k*(L[0]-V),E[1]=j+k*(L[1]-j),E[2]=Z+k*(L[2]-Z),E[3]=G+k*(L[3]-G),E},Qt.random=function(E,C){var L,k,V,j,Z,G;C=C||1;do Z=(L=2*t.RANDOM()-1)*L+(k=2*t.RANDOM()-1)*k;while(Z>=1);do G=(V=2*t.RANDOM()-1)*V+(j=2*t.RANDOM()-1)*j;while(G>=1);var Y=Math.sqrt((1-Z)/G);return E[0]=C*L,E[1]=C*k,E[2]=C*V*Y,E[3]=C*j*Y,E},Qt.transformMat4=function(E,C,L){var k=C[0],V=C[1],j=C[2],Z=C[3];return E[0]=L[0]*k+L[4]*V+L[8]*j+L[12]*Z,E[1]=L[1]*k+L[5]*V+L[9]*j+L[13]*Z,E[2]=L[2]*k+L[6]*V+L[10]*j+L[14]*Z,E[3]=L[3]*k+L[7]*V+L[11]*j+L[15]*Z,E},Qt.transformQuat=function(E,C,L){var k=C[0],V=C[1],j=C[2],Z=L[0],G=L[1],Y=L[2],J=L[3],se=J*k+G*j-Y*V,pe=J*V+Y*k-Z*j,ue=J*j+Z*V-G*k,he=-Z*k-G*V-Y*j;return E[0]=se*J+he*-Z+pe*-Y-ue*-G,E[1]=pe*J+he*-G+ue*-Z-se*-Y,E[2]=ue*J+he*-Y+se*-G-pe*-Z,E[3]=C[3],E},Qt.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},Qt.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},Qt.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]&&E[2]===C[2]&&E[3]===C[3]},Qt.equals=function(E,C){var L=E[0],k=E[1],V=E[2],j=E[3],Z=C[0],G=C[1],Y=C[2],J=C[3];return Math.abs(L-Z)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(Z))&&Math.abs(k-G)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(G))&&Math.abs(V-Y)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs(Y))&&Math.abs(j-J)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(J))},Qt.forEach=Qt.sqrLen=Qt.len=Qt.sqrDist=Qt.dist=Qt.div=Qt.mul=Qt.sub=void 0;var t=function(E,C){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var L=s(void 0);if(L&&L.has(E))return L.get(E);var k={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in E)if(j!=="default"&&Object.prototype.hasOwnProperty.call(E,j)){var Z=V?Object.getOwnPropertyDescriptor(E,j):null;Z&&(Z.get||Z.set)?Object.defineProperty(k,j,Z):k[j]=E[j]}return k.default=E,L&&L.set(E,k),k}(Te());function s(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,L=new WeakMap;return(s=function(k){return k?L:C})(E)}function c(){var E=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function p(E,C,L){return E[0]=C[0]-L[0],E[1]=C[1]-L[1],E[2]=C[2]-L[2],E[3]=C[3]-L[3],E}function h(E,C,L){return E[0]=C[0]*L[0],E[1]=C[1]*L[1],E[2]=C[2]*L[2],E[3]=C[3]*L[3],E}function m(E,C,L){return E[0]=C[0]/L[0],E[1]=C[1]/L[1],E[2]=C[2]/L[2],E[3]=C[3]/L[3],E}function x(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1],C[2]-E[2],C[3]-E[3])}function T(E,C){var L=C[0]-E[0],k=C[1]-E[1],V=C[2]-E[2],j=C[3]-E[3];return L*L+k*k+V*V+j*j}function A(E){return Math.hypot(E[0],E[1],E[2],E[3])}function y(E){var C=E[0],L=E[1],k=E[2],V=E[3];return C*C+L*L+k*k+V*V}Qt.sub=p,Qt.mul=h,Qt.div=m,Qt.dist=x,Qt.sqrDist=T,Qt.len=A,Qt.sqrLen=y;var I,M=(I=c(),function(E,C,L,k,V,j){var Z,G;for(C||(C=4),L||(L=0),G=k?Math.min(k*C+L,E.length):E.length,Z=L;Z<G;Z+=C)I[0]=E[Z],I[1]=E[Z+1],I[2]=E[Z+2],I[3]=E[Z+3],V(I,I,j),E[Z]=I[0],E[Z+1]=I[1],E[Z+2]=I[2],E[Z+3]=I[3];return E});return Qt.forEach=M,Qt}function Zi(){if(zn)return ht;function l(ce){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Me){return typeof Me}:function(Me){return Me&&typeof Symbol=="function"&&Me.constructor===Symbol&&Me!==Symbol.prototype?"symbol":typeof Me},l(ce)}zn=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.create=x,ht.identity=function(ce){return ce[0]=0,ce[1]=0,ce[2]=0,ce[3]=1,ce},ht.setAxisAngle=T,ht.getAxisAngle=function(ce,Me){var Fe=2*Math.acos(Me[3]),ke=Math.sin(Fe/2);return ke>t.EPSILON?(ce[0]=Me[0]/ke,ce[1]=Me[1]/ke,ce[2]=Me[2]/ke):(ce[0]=1,ce[1]=0,ce[2]=0),Fe},ht.getAngle=function(ce,Me){var Fe=L(ce,Me);return Math.acos(2*Fe*Fe-1)},ht.multiply=A,ht.rotateX=function(ce,Me,Fe){Fe*=.5;var ke=Me[0],Ge=Me[1],Xe=Me[2],Ye=Me[3],Ze=Math.sin(Fe),ut=Math.cos(Fe);return ce[0]=ke*ut+Ye*Ze,ce[1]=Ge*ut+Xe*Ze,ce[2]=Xe*ut-Ge*Ze,ce[3]=Ye*ut-ke*Ze,ce},ht.rotateY=function(ce,Me,Fe){Fe*=.5;var ke=Me[0],Ge=Me[1],Xe=Me[2],Ye=Me[3],Ze=Math.sin(Fe),ut=Math.cos(Fe);return ce[0]=ke*ut-Xe*Ze,ce[1]=Ge*ut+Ye*Ze,ce[2]=Xe*ut+ke*Ze,ce[3]=Ye*ut-Ge*Ze,ce},ht.rotateZ=function(ce,Me,Fe){Fe*=.5;var ke=Me[0],Ge=Me[1],Xe=Me[2],Ye=Me[3],Ze=Math.sin(Fe),ut=Math.cos(Fe);return ce[0]=ke*ut+Ge*Ze,ce[1]=Ge*ut-ke*Ze,ce[2]=Xe*ut+Ye*Ze,ce[3]=Ye*ut-Xe*Ze,ce},ht.calculateW=function(ce,Me){var Fe=Me[0],ke=Me[1],Ge=Me[2];return ce[0]=Fe,ce[1]=ke,ce[2]=Ge,ce[3]=Math.sqrt(Math.abs(1-Fe*Fe-ke*ke-Ge*Ge)),ce},ht.exp=y,ht.ln=I,ht.pow=function(ce,Me,Fe){return I(ce,Me),C(ce,ce,Fe),y(ce,ce),ce},ht.slerp=M,ht.random=function(ce){var Me=t.RANDOM(),Fe=t.RANDOM(),ke=t.RANDOM(),Ge=Math.sqrt(1-Me),Xe=Math.sqrt(Me);return ce[0]=Ge*Math.sin(2*Math.PI*Fe),ce[1]=Ge*Math.cos(2*Math.PI*Fe),ce[2]=Xe*Math.sin(2*Math.PI*ke),ce[3]=Xe*Math.cos(2*Math.PI*ke),ce},ht.invert=function(ce,Me){var Fe=Me[0],ke=Me[1],Ge=Me[2],Xe=Me[3],Ye=Fe*Fe+ke*ke+Ge*Ge+Xe*Xe,Ze=Ye?1/Ye:0;return ce[0]=-Fe*Ze,ce[1]=-ke*Ze,ce[2]=-Ge*Ze,ce[3]=Xe*Ze,ce},ht.conjugate=function(ce,Me){return ce[0]=-Me[0],ce[1]=-Me[1],ce[2]=-Me[2],ce[3]=Me[3],ce},ht.fromMat3=E,ht.fromEuler=function(ce,Me,Fe,ke){var Ge=.5*Math.PI/180;Me*=Ge,Fe*=Ge,ke*=Ge;var Xe=Math.sin(Me),Ye=Math.cos(Me),Ze=Math.sin(Fe),ut=Math.cos(Fe),Et=Math.sin(ke),ot=Math.cos(ke);return ce[0]=Xe*ut*ot-Ye*Ze*Et,ce[1]=Ye*Ze*ot+Xe*ut*Et,ce[2]=Ye*ut*Et-Xe*Ze*ot,ce[3]=Ye*ut*ot+Xe*Ze*Et,ce},ht.str=function(ce){return"quat("+ce[0]+", "+ce[1]+", "+ce[2]+", "+ce[3]+")"},ht.setAxes=ht.sqlerp=ht.rotationTo=ht.equals=ht.exactEquals=ht.normalize=ht.sqrLen=ht.squaredLength=ht.len=ht.length=ht.lerp=ht.dot=ht.scale=ht.mul=ht.add=ht.set=ht.copy=ht.fromValues=ht.clone=void 0;var t=m(Te()),s=m(pt()),c=m(le()),p=m(ri());function h(ce){if(typeof WeakMap!="function")return null;var Me=new WeakMap,Fe=new WeakMap;return(h=function(ke){return ke?Fe:Me})(ce)}function m(ce,Me){if(ce&&ce.__esModule)return ce;if(ce===null||l(ce)!=="object"&&typeof ce!="function")return{default:ce};var Fe=h(Me);if(Fe&&Fe.has(ce))return Fe.get(ce);var ke={},Ge=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Xe in ce)if(Xe!=="default"&&Object.prototype.hasOwnProperty.call(ce,Xe)){var Ye=Ge?Object.getOwnPropertyDescriptor(ce,Xe):null;Ye&&(Ye.get||Ye.set)?Object.defineProperty(ke,Xe,Ye):ke[Xe]=ce[Xe]}return ke.default=ce,Fe&&Fe.set(ce,ke),ke}function x(){var ce=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(ce[0]=0,ce[1]=0,ce[2]=0),ce[3]=1,ce}function T(ce,Me,Fe){Fe*=.5;var ke=Math.sin(Fe);return ce[0]=ke*Me[0],ce[1]=ke*Me[1],ce[2]=ke*Me[2],ce[3]=Math.cos(Fe),ce}function A(ce,Me,Fe){var ke=Me[0],Ge=Me[1],Xe=Me[2],Ye=Me[3],Ze=Fe[0],ut=Fe[1],Et=Fe[2],ot=Fe[3];return ce[0]=ke*ot+Ye*Ze+Ge*Et-Xe*ut,ce[1]=Ge*ot+Ye*ut+Xe*Ze-ke*Et,ce[2]=Xe*ot+Ye*Et+ke*ut-Ge*Ze,ce[3]=Ye*ot-ke*Ze-Ge*ut-Xe*Et,ce}function y(ce,Me){var Fe=Me[0],ke=Me[1],Ge=Me[2],Xe=Me[3],Ye=Math.sqrt(Fe*Fe+ke*ke+Ge*Ge),Ze=Math.exp(Xe),ut=Ye>0?Ze*Math.sin(Ye)/Ye:0;return ce[0]=Fe*ut,ce[1]=ke*ut,ce[2]=Ge*ut,ce[3]=Ze*Math.cos(Ye),ce}function I(ce,Me){var Fe=Me[0],ke=Me[1],Ge=Me[2],Xe=Me[3],Ye=Math.sqrt(Fe*Fe+ke*ke+Ge*Ge),Ze=Ye>0?Math.atan2(Ye,Xe)/Ye:0;return ce[0]=Fe*Ze,ce[1]=ke*Ze,ce[2]=Ge*Ze,ce[3]=.5*Math.log(Fe*Fe+ke*ke+Ge*Ge+Xe*Xe),ce}function M(ce,Me,Fe,ke){var Ge,Xe,Ye,Ze,ut,Et=Me[0],ot=Me[1],jt=Me[2],Dt=Me[3],Ct=Fe[0],bt=Fe[1],an=Fe[2],qt=Fe[3];return(Xe=Et*Ct+ot*bt+jt*an+Dt*qt)<0&&(Xe=-Xe,Ct=-Ct,bt=-bt,an=-an,qt=-qt),1-Xe>t.EPSILON?(Ge=Math.acos(Xe),Ye=Math.sin(Ge),Ze=Math.sin((1-ke)*Ge)/Ye,ut=Math.sin(ke*Ge)/Ye):(Ze=1-ke,ut=ke),ce[0]=Ze*Et+ut*Ct,ce[1]=Ze*ot+ut*bt,ce[2]=Ze*jt+ut*an,ce[3]=Ze*Dt+ut*qt,ce}function E(ce,Me){var Fe,ke=Me[0]+Me[4]+Me[8];if(ke>0)Fe=Math.sqrt(ke+1),ce[3]=.5*Fe,ce[0]=(Me[5]-Me[7])*(Fe=.5/Fe),ce[1]=(Me[6]-Me[2])*Fe,ce[2]=(Me[1]-Me[3])*Fe;else{var Ge=0;Me[4]>Me[0]&&(Ge=1),Me[8]>Me[3*Ge+Ge]&&(Ge=2);var Xe=(Ge+1)%3,Ye=(Ge+2)%3;Fe=Math.sqrt(Me[3*Ge+Ge]-Me[3*Xe+Xe]-Me[3*Ye+Ye]+1),ce[Ge]=.5*Fe,ce[3]=(Me[3*Xe+Ye]-Me[3*Ye+Xe])*(Fe=.5/Fe),ce[Xe]=(Me[3*Xe+Ge]+Me[3*Ge+Xe])*Fe,ce[Ye]=(Me[3*Ye+Ge]+Me[3*Ge+Ye])*Fe}return ce}ht.clone=p.clone,ht.fromValues=p.fromValues,ht.copy=p.copy,ht.set=p.set,ht.add=p.add,ht.mul=A;var C=p.scale;ht.scale=C;var L=p.dot;ht.dot=L,ht.lerp=p.lerp;var k=p.length;ht.length=k,ht.len=k;var V=p.squaredLength;ht.squaredLength=V,ht.sqrLen=V;var j=p.normalize;ht.normalize=j,ht.exactEquals=p.exactEquals,ht.equals=p.equals;var Z,G,Y,J=(Z=c.create(),G=c.fromValues(1,0,0),Y=c.fromValues(0,1,0),function(ce,Me,Fe){var ke=c.dot(Me,Fe);return ke<-.999999?(c.cross(Z,G,Me),c.len(Z)<1e-6&&c.cross(Z,Y,Me),c.normalize(Z,Z),T(ce,Z,Math.PI),ce):ke>.999999?(ce[0]=0,ce[1]=0,ce[2]=0,ce[3]=1,ce):(c.cross(Z,Me,Fe),ce[0]=Z[0],ce[1]=Z[1],ce[2]=Z[2],ce[3]=1+ke,j(ce,ce))});ht.rotationTo=J;var se,pe,ue=(se=x(),pe=x(),function(ce,Me,Fe,ke,Ge,Xe){return M(se,Me,Ge,Xe),M(pe,Fe,ke,Xe),M(ce,se,pe,2*Xe*(1-Xe)),ce});ht.sqlerp=ue;var he,Le=(he=s.create(),function(ce,Me,Fe,ke){return he[0]=Fe[0],he[3]=Fe[1],he[6]=Fe[2],he[1]=ke[0],he[4]=ke[1],he[7]=ke[2],he[2]=-Me[0],he[5]=-Me[1],he[8]=-Me[2],j(ce,E(ce,he))});return ht.setAxes=Le,ht}var dt,tn={};function Vn(){if(dt)return tn;function l(M){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},l(M)}dt=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.create=function(){var M=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[4]=0,M[5]=0,M[6]=0,M[7]=0),M[3]=1,M},tn.clone=function(M){var E=new t.ARRAY_TYPE(8);return E[0]=M[0],E[1]=M[1],E[2]=M[2],E[3]=M[3],E[4]=M[4],E[5]=M[5],E[6]=M[6],E[7]=M[7],E},tn.fromValues=function(M,E,C,L,k,V,j,Z){var G=new t.ARRAY_TYPE(8);return G[0]=M,G[1]=E,G[2]=C,G[3]=L,G[4]=k,G[5]=V,G[6]=j,G[7]=Z,G},tn.fromRotationTranslationValues=function(M,E,C,L,k,V,j){var Z=new t.ARRAY_TYPE(8);Z[0]=M,Z[1]=E,Z[2]=C,Z[3]=L;var G=.5*k,Y=.5*V,J=.5*j;return Z[4]=G*L+Y*C-J*E,Z[5]=Y*L+J*M-G*C,Z[6]=J*L+G*E-Y*M,Z[7]=-G*M-Y*E-J*C,Z},tn.fromRotationTranslation=m,tn.fromTranslation=function(M,E){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=.5*E[0],M[5]=.5*E[1],M[6]=.5*E[2],M[7]=0,M},tn.fromRotation=function(M,E){return M[0]=E[0],M[1]=E[1],M[2]=E[2],M[3]=E[3],M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},tn.fromMat4=function(M,E){var C=s.create();c.getRotation(C,E);var L=new t.ARRAY_TYPE(3);return c.getTranslation(L,E),m(M,C,L),M},tn.copy=x,tn.identity=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},tn.set=function(M,E,C,L,k,V,j,Z,G){return M[0]=E,M[1]=C,M[2]=L,M[3]=k,M[4]=V,M[5]=j,M[6]=Z,M[7]=G,M},tn.getDual=function(M,E){return M[0]=E[4],M[1]=E[5],M[2]=E[6],M[3]=E[7],M},tn.setDual=function(M,E){return M[4]=E[0],M[5]=E[1],M[6]=E[2],M[7]=E[3],M},tn.getTranslation=function(M,E){var C=E[4],L=E[5],k=E[6],V=E[7],j=-E[0],Z=-E[1],G=-E[2],Y=E[3];return M[0]=2*(C*Y+V*j+L*G-k*Z),M[1]=2*(L*Y+V*Z+k*j-C*G),M[2]=2*(k*Y+V*G+C*Z-L*j),M},tn.translate=function(M,E,C){var L=E[0],k=E[1],V=E[2],j=E[3],Z=.5*C[0],G=.5*C[1],Y=.5*C[2],J=E[4],se=E[5],pe=E[6],ue=E[7];return M[0]=L,M[1]=k,M[2]=V,M[3]=j,M[4]=j*Z+k*Y-V*G+J,M[5]=j*G+V*Z-L*Y+se,M[6]=j*Y+L*G-k*Z+pe,M[7]=-L*Z-k*G-V*Y+ue,M},tn.rotateX=function(M,E,C){var L=-E[0],k=-E[1],V=-E[2],j=E[3],Z=E[4],G=E[5],Y=E[6],J=E[7],se=Z*j+J*L+G*V-Y*k,pe=G*j+J*k+Y*L-Z*V,ue=Y*j+J*V+Z*k-G*L,he=J*j-Z*L-G*k-Y*V;return s.rotateX(M,E,C),M[4]=se*(j=M[3])+he*(L=M[0])+pe*(V=M[2])-ue*(k=M[1]),M[5]=pe*j+he*k+ue*L-se*V,M[6]=ue*j+he*V+se*k-pe*L,M[7]=he*j-se*L-pe*k-ue*V,M},tn.rotateY=function(M,E,C){var L=-E[0],k=-E[1],V=-E[2],j=E[3],Z=E[4],G=E[5],Y=E[6],J=E[7],se=Z*j+J*L+G*V-Y*k,pe=G*j+J*k+Y*L-Z*V,ue=Y*j+J*V+Z*k-G*L,he=J*j-Z*L-G*k-Y*V;return s.rotateY(M,E,C),M[4]=se*(j=M[3])+he*(L=M[0])+pe*(V=M[2])-ue*(k=M[1]),M[5]=pe*j+he*k+ue*L-se*V,M[6]=ue*j+he*V+se*k-pe*L,M[7]=he*j-se*L-pe*k-ue*V,M},tn.rotateZ=function(M,E,C){var L=-E[0],k=-E[1],V=-E[2],j=E[3],Z=E[4],G=E[5],Y=E[6],J=E[7],se=Z*j+J*L+G*V-Y*k,pe=G*j+J*k+Y*L-Z*V,ue=Y*j+J*V+Z*k-G*L,he=J*j-Z*L-G*k-Y*V;return s.rotateZ(M,E,C),M[4]=se*(j=M[3])+he*(L=M[0])+pe*(V=M[2])-ue*(k=M[1]),M[5]=pe*j+he*k+ue*L-se*V,M[6]=ue*j+he*V+se*k-pe*L,M[7]=he*j-se*L-pe*k-ue*V,M},tn.rotateByQuatAppend=function(M,E,C){var L=C[0],k=C[1],V=C[2],j=C[3],Z=E[0],G=E[1],Y=E[2],J=E[3];return M[0]=Z*j+J*L+G*V-Y*k,M[1]=G*j+J*k+Y*L-Z*V,M[2]=Y*j+J*V+Z*k-G*L,M[3]=J*j-Z*L-G*k-Y*V,M[4]=(Z=E[4])*j+(J=E[7])*L+(G=E[5])*V-(Y=E[6])*k,M[5]=G*j+J*k+Y*L-Z*V,M[6]=Y*j+J*V+Z*k-G*L,M[7]=J*j-Z*L-G*k-Y*V,M},tn.rotateByQuatPrepend=function(M,E,C){var L=E[0],k=E[1],V=E[2],j=E[3],Z=C[0],G=C[1],Y=C[2],J=C[3];return M[0]=L*J+j*Z+k*Y-V*G,M[1]=k*J+j*G+V*Z-L*Y,M[2]=V*J+j*Y+L*G-k*Z,M[3]=j*J-L*Z-k*G-V*Y,M[4]=L*(J=C[7])+j*(Z=C[4])+k*(Y=C[6])-V*(G=C[5]),M[5]=k*J+j*G+V*Z-L*Y,M[6]=V*J+j*Y+L*G-k*Z,M[7]=j*J-L*Z-k*G-V*Y,M},tn.rotateAroundAxis=function(M,E,C,L){if(Math.abs(L)<t.EPSILON)return x(M,E);var k=Math.hypot(C[0],C[1],C[2]);L*=.5;var V=Math.sin(L),j=V*C[0]/k,Z=V*C[1]/k,G=V*C[2]/k,Y=Math.cos(L),J=E[0],se=E[1],pe=E[2],ue=E[3];M[0]=J*Y+ue*j+se*G-pe*Z,M[1]=se*Y+ue*Z+pe*j-J*G,M[2]=pe*Y+ue*G+J*Z-se*j,M[3]=ue*Y-J*j-se*Z-pe*G;var he=E[4],Le=E[5],ce=E[6],Me=E[7];return M[4]=he*Y+Me*j+Le*G-ce*Z,M[5]=Le*Y+Me*Z+ce*j-he*G,M[6]=ce*Y+Me*G+he*Z-Le*j,M[7]=Me*Y-he*j-Le*Z-ce*G,M},tn.add=function(M,E,C){return M[0]=E[0]+C[0],M[1]=E[1]+C[1],M[2]=E[2]+C[2],M[3]=E[3]+C[3],M[4]=E[4]+C[4],M[5]=E[5]+C[5],M[6]=E[6]+C[6],M[7]=E[7]+C[7],M},tn.multiply=T,tn.scale=function(M,E,C){return M[0]=E[0]*C,M[1]=E[1]*C,M[2]=E[2]*C,M[3]=E[3]*C,M[4]=E[4]*C,M[5]=E[5]*C,M[6]=E[6]*C,M[7]=E[7]*C,M},tn.lerp=function(M,E,C,L){var k=1-L;return A(E,C)<0&&(L=-L),M[0]=E[0]*k+C[0]*L,M[1]=E[1]*k+C[1]*L,M[2]=E[2]*k+C[2]*L,M[3]=E[3]*k+C[3]*L,M[4]=E[4]*k+C[4]*L,M[5]=E[5]*k+C[5]*L,M[6]=E[6]*k+C[6]*L,M[7]=E[7]*k+C[7]*L,M},tn.invert=function(M,E){var C=I(E);return M[0]=-E[0]/C,M[1]=-E[1]/C,M[2]=-E[2]/C,M[3]=E[3]/C,M[4]=-E[4]/C,M[5]=-E[5]/C,M[6]=-E[6]/C,M[7]=E[7]/C,M},tn.conjugate=function(M,E){return M[0]=-E[0],M[1]=-E[1],M[2]=-E[2],M[3]=E[3],M[4]=-E[4],M[5]=-E[5],M[6]=-E[6],M[7]=E[7],M},tn.normalize=function(M,E){var C=I(E);if(C>0){C=Math.sqrt(C);var L=E[0]/C,k=E[1]/C,V=E[2]/C,j=E[3]/C,Z=E[4],G=E[5],Y=E[6],J=E[7],se=L*Z+k*G+V*Y+j*J;M[0]=L,M[1]=k,M[2]=V,M[3]=j,M[4]=(Z-L*se)/C,M[5]=(G-k*se)/C,M[6]=(Y-V*se)/C,M[7]=(J-j*se)/C}return M},tn.str=function(M){return"quat2("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+")"},tn.exactEquals=function(M,E){return M[0]===E[0]&&M[1]===E[1]&&M[2]===E[2]&&M[3]===E[3]&&M[4]===E[4]&&M[5]===E[5]&&M[6]===E[6]&&M[7]===E[7]},tn.equals=function(M,E){var C=M[0],L=M[1],k=M[2],V=M[3],j=M[4],Z=M[5],G=M[6],Y=M[7],J=E[0],se=E[1],pe=E[2],ue=E[3],he=E[4],Le=E[5],ce=E[6],Me=E[7];return Math.abs(C-J)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(J))&&Math.abs(L-se)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(se))&&Math.abs(k-pe)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(pe))&&Math.abs(V-ue)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs(ue))&&Math.abs(j-he)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(he))&&Math.abs(Z-Le)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Le))&&Math.abs(G-ce)<=t.EPSILON*Math.max(1,Math.abs(G),Math.abs(ce))&&Math.abs(Y-Me)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Me))},tn.sqrLen=tn.squaredLength=tn.len=tn.length=tn.dot=tn.mul=tn.setReal=tn.getReal=void 0;var t=h(Te()),s=h(Zi()),c=h(ft());function p(M){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(p=function(L){return L?C:E})(M)}function h(M,E){if(M&&M.__esModule)return M;if(M===null||l(M)!=="object"&&typeof M!="function")return{default:M};var C=p(E);if(C&&C.has(M))return C.get(M);var L={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in M)if(V!=="default"&&Object.prototype.hasOwnProperty.call(M,V)){var j=k?Object.getOwnPropertyDescriptor(M,V):null;j&&(j.get||j.set)?Object.defineProperty(L,V,j):L[V]=M[V]}return L.default=M,C&&C.set(M,L),L}function m(M,E,C){var L=.5*C[0],k=.5*C[1],V=.5*C[2],j=E[0],Z=E[1],G=E[2],Y=E[3];return M[0]=j,M[1]=Z,M[2]=G,M[3]=Y,M[4]=L*Y+k*G-V*Z,M[5]=k*Y+V*j-L*G,M[6]=V*Y+L*Z-k*j,M[7]=-L*j-k*Z-V*G,M}function x(M,E){return M[0]=E[0],M[1]=E[1],M[2]=E[2],M[3]=E[3],M[4]=E[4],M[5]=E[5],M[6]=E[6],M[7]=E[7],M}function T(M,E,C){var L=E[0],k=E[1],V=E[2],j=E[3],Z=C[4],G=C[5],Y=C[6],J=C[7],se=E[4],pe=E[5],ue=E[6],he=E[7],Le=C[0],ce=C[1],Me=C[2],Fe=C[3];return M[0]=L*Fe+j*Le+k*Me-V*ce,M[1]=k*Fe+j*ce+V*Le-L*Me,M[2]=V*Fe+j*Me+L*ce-k*Le,M[3]=j*Fe-L*Le-k*ce-V*Me,M[4]=L*J+j*Z+k*Y-V*G+se*Fe+he*Le+pe*Me-ue*ce,M[5]=k*J+j*G+V*Z-L*Y+pe*Fe+he*ce+ue*Le-se*Me,M[6]=V*J+j*Y+L*G-k*Z+ue*Fe+he*Me+se*ce-pe*Le,M[7]=j*J-L*Z-k*G-V*Y+he*Fe-se*Le-pe*ce-ue*Me,M}tn.getReal=s.copy,tn.setReal=s.copy,tn.mul=T;var A=s.dot;tn.dot=A;var y=s.length;tn.length=y,tn.len=y;var I=s.squaredLength;return tn.squaredLength=I,tn.sqrLen=I,tn}var xi,hr,_n={};function es(){if(xi)return _n;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(E)}xi=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.create=c,_n.clone=function(E){var C=new t.ARRAY_TYPE(2);return C[0]=E[0],C[1]=E[1],C},_n.fromValues=function(E,C){var L=new t.ARRAY_TYPE(2);return L[0]=E,L[1]=C,L},_n.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E},_n.set=function(E,C,L){return E[0]=C,E[1]=L,E},_n.add=function(E,C,L){return E[0]=C[0]+L[0],E[1]=C[1]+L[1],E},_n.subtract=p,_n.multiply=h,_n.divide=m,_n.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E},_n.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E},_n.min=function(E,C,L){return E[0]=Math.min(C[0],L[0]),E[1]=Math.min(C[1],L[1]),E},_n.max=function(E,C,L){return E[0]=Math.max(C[0],L[0]),E[1]=Math.max(C[1],L[1]),E},_n.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E},_n.scale=function(E,C,L){return E[0]=C[0]*L,E[1]=C[1]*L,E},_n.scaleAndAdd=function(E,C,L,k){return E[0]=C[0]+L[0]*k,E[1]=C[1]+L[1]*k,E},_n.distance=x,_n.squaredDistance=T,_n.length=A,_n.squaredLength=y,_n.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E},_n.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E},_n.normalize=function(E,C){var L=C[0],k=C[1],V=L*L+k*k;return V>0&&(V=1/Math.sqrt(V)),E[0]=C[0]*V,E[1]=C[1]*V,E},_n.dot=function(E,C){return E[0]*C[0]+E[1]*C[1]},_n.cross=function(E,C,L){var k=C[0]*L[1]-C[1]*L[0];return E[0]=E[1]=0,E[2]=k,E},_n.lerp=function(E,C,L,k){var V=C[0],j=C[1];return E[0]=V+k*(L[0]-V),E[1]=j+k*(L[1]-j),E},_n.random=function(E,C){C=C||1;var L=2*t.RANDOM()*Math.PI;return E[0]=Math.cos(L)*C,E[1]=Math.sin(L)*C,E},_n.transformMat2=function(E,C,L){var k=C[0],V=C[1];return E[0]=L[0]*k+L[2]*V,E[1]=L[1]*k+L[3]*V,E},_n.transformMat2d=function(E,C,L){var k=C[0],V=C[1];return E[0]=L[0]*k+L[2]*V+L[4],E[1]=L[1]*k+L[3]*V+L[5],E},_n.transformMat3=function(E,C,L){var k=C[0],V=C[1];return E[0]=L[0]*k+L[3]*V+L[6],E[1]=L[1]*k+L[4]*V+L[7],E},_n.transformMat4=function(E,C,L){var k=C[0],V=C[1];return E[0]=L[0]*k+L[4]*V+L[12],E[1]=L[1]*k+L[5]*V+L[13],E},_n.rotate=function(E,C,L,k){var V=C[0]-L[0],j=C[1]-L[1],Z=Math.sin(k),G=Math.cos(k);return E[0]=V*G-j*Z+L[0],E[1]=V*Z+j*G+L[1],E},_n.angle=function(E,C){var L=E[0],k=E[1],V=C[0],j=C[1],Z=Math.sqrt(L*L+k*k)*Math.sqrt(V*V+j*j);return Math.acos(Math.min(Math.max(Z&&(L*V+k*j)/Z,-1),1))},_n.zero=function(E){return E[0]=0,E[1]=0,E},_n.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},_n.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]},_n.equals=function(E,C){var L=E[0],k=E[1],V=C[0],j=C[1];return Math.abs(L-V)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(V))&&Math.abs(k-j)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(j))},_n.forEach=_n.sqrLen=_n.sqrDist=_n.dist=_n.div=_n.mul=_n.sub=_n.len=void 0;var t=function(E,C){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var L=s(void 0);if(L&&L.has(E))return L.get(E);var k={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in E)if(j!=="default"&&Object.prototype.hasOwnProperty.call(E,j)){var Z=V?Object.getOwnPropertyDescriptor(E,j):null;Z&&(Z.get||Z.set)?Object.defineProperty(k,j,Z):k[j]=E[j]}return k.default=E,L&&L.set(E,k),k}(Te());function s(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,L=new WeakMap;return(s=function(k){return k?L:C})(E)}function c(){var E=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function p(E,C,L){return E[0]=C[0]-L[0],E[1]=C[1]-L[1],E}function h(E,C,L){return E[0]=C[0]*L[0],E[1]=C[1]*L[1],E}function m(E,C,L){return E[0]=C[0]/L[0],E[1]=C[1]/L[1],E}function x(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1])}function T(E,C){var L=C[0]-E[0],k=C[1]-E[1];return L*L+k*k}function A(E){return Math.hypot(E[0],E[1])}function y(E){var C=E[0],L=E[1];return C*C+L*L}_n.len=A,_n.sub=p,_n.mul=h,_n.div=m,_n.dist=x,_n.sqrDist=T,_n.sqrLen=y;var I,M=(I=c(),function(E,C,L,k,V,j){var Z,G;for(C||(C=2),L||(L=0),G=k?Math.min(k*C+L,E.length):E.length,Z=L;Z<G;Z+=C)I[0]=E[Z],I[1]=E[Z+1],V(I,I,j),E[Z]=I[0],E[Z+1]=I[1];return E});return _n.forEach=M,_n}function Jt(){if(hr)return xe;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(E)}hr=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.vec4=xe.vec3=xe.vec2=xe.quat2=xe.quat=xe.mat4=xe.mat3=xe.mat2d=xe.mat2=xe.glMatrix=void 0;var t=M(Te());xe.glMatrix=t;var s=M(ve());xe.mat2=s;var c=M(Bt());xe.mat2d=c;var p=M(pt());xe.mat3=p;var h=M(ft());xe.mat4=h;var m=M(Zi());xe.quat=m;var x=M(Vn());xe.quat2=x;var T=M(es());xe.vec2=T;var A=M(le());xe.vec3=A;var y=M(ri());function I(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,L=new WeakMap;return(I=function(k){return k?L:C})(E)}function M(E,C){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var L=I(C);if(L&&L.has(E))return L.get(E);var k={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in E)if(j!=="default"&&Object.prototype.hasOwnProperty.call(E,j)){var Z=V?Object.getOwnPropertyDescriptor(E,j):null;Z&&(Z.get||Z.set)?Object.defineProperty(k,j,Z):k[j]=E[j]}return k.default=E,L&&L.set(E,k),k}return xe.vec4=y,xe}var Ur,tr,Ha,Go,Ve=Jt(),no=function(){if(tr)return Ur;function l(t,s,c,p){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=c,this.p2y=p}return tr=1,Ur=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,p=0;p<8;p++){var h=this.sampleCurveX(c)-t;if(Math.abs(h)<s)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=h/m}var x=0,T=1;for(c=t,p=0;p<20&&(h=this.sampleCurveX(c),!(Math.abs(h-t)<s));p++)t>h?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},Ur}(),bn=_e(no);function Tl(){if(Go)return Ha;function l(t,s){this.x=t,this.y=s}return Go=1,Ha=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,s){return this.clone()._rotateAround(t,s)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var s=t.x-this.x,c=t.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,s){return Math.atan2(this.x*s-this.y*t,this.x*t+this.y*s)},_matMult:function(t){var s=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var s=Math.cos(t),c=Math.sin(t),p=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=p,this},_rotateAround:function(t,s){var c=Math.cos(t),p=Math.sin(t),h=s.y+p*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-p*(this.y-s.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(t){return t instanceof l?t:Array.isArray(t)?new l(t[0],t[1]):t},Ha}var Lt=_e(Tl());function Zs(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(!Zs(l[s],t[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const s in l)if(!Zs(l[s],t[s]))return!1;return!0}return l===t}const Gr=Math.PI/180,io=180/Math.PI;function pn(l){return l*Gr}function Lr(l){return l*io}const si=[[0,0],[1,0],[1,1],[0,1]];function _s(l){if(l<=0)return 0;if(l>=1)return 1;const t=l*l,s=t*l;return 4*(l<.5?s:3*(l-t)+s-.75)}function qo(l,t,s,c){const p=new bn(l,t,s,c);return function(h){return p.solve(h)}}const Sl=qo(.25,.1,.25,1);function nn(l,t,s){return Math.min(s,Math.max(t,l))}function fa(l,t,s){return(s=nn((s-l)/(t-l),0,1))*s*(3-2*s)}function jo(l,t,s){const c=s-t,p=((l-t)%c+c)%c+t;return p===t?s:p}function dr(l,t,s){if(!l.length)return s(null,[]);let c=l.length;const p=new Array(l.length);let h=null;l.forEach((m,x)=>{t(m,(T,A)=>{T&&(h=T),p[x]=A,--c==0&&s(h,p)})})}function ir(l,...t){for(const s of t)for(const c in s)l[c]=s[c];return l}let Rt=1;function Fs(){return Rt++}function So(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function jn(l,t){l.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function fr(l,t){return l.indexOf(t,l.length-t.length)!==-1}function Ms(l,t,s){const c={};for(const p in l)c[p]=t.call(this,l[p],p,l);return c}function Za(l,t,s){const c={};for(const p in l)t.call(this,l[p],p,l)&&(c[p]=l[p]);return c}function ro(l){return Array.isArray(l)?l.map(ro):typeof l=="object"&&l?Ms(l,ro):l}const qu={};function Xn(l){qu[l]||(typeof console<"u"&&console.warn(l),qu[l]=!0)}function Ho(l,t,s){return(s.y-l.y)*(t.x-l.x)>(t.y-l.y)*(s.x-l.x)}function Ic(l){let t=0;for(let s,c,p=0,h=l.length,m=h-1;p<h;m=p++)s=l[p],c=l[m],t+=(c.x-s.x)*(s.y+c.y);return t}function Ws([l,t,s]){const c=pn(t+90),p=pn(s);return{x:l*Math.cos(c)*Math.sin(p),y:l*Math.sin(c)*Math.sin(p),z:l*Math.cos(p),azimuthal:t,polar:s}}function Rr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yi(l){const t={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,h)=>{const m=p||h;return t[c]=!m||m.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let Fn=null;function pa(l,t){return[l[4*t],l[4*t+1],l[4*t+2],l[4*t+3]]}function Fi(l,t,s,c){for(;t<s;){const p=t+s>>1;l[p]<c?t=p+1:s=p}return t}function Ke(l,t,s,c){for(;t<s;){const p=t+s>>1;l[p]<=c?t=p+1:s=p}return t}function ne(l){return l>0?1/(1.001-l):1+l}function oe(l){return l>0?1-1/(1.001-l):-l}const ge={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ge.API_URL)return null;try{const l=new URL(ge.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Oe(l){return ge.API_URL_REGEX.test(l)}function Ce(l){return ge.API_SPRITE_REGEX.test(l)}let qe,tt,We,nt,st,lt;function Tt(){return qe==null&&(qe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),qe}const Vt={now:()=>nt!==void 0?nt:performance.now(),setNow(l){nt=l},restoreNow(){nt=void 0},frame(l){const t=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(l,t=0){const{width:s,height:c}=l;st||(st=document.createElement("canvas"));const p=st.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(s>st.width||c>st.height)&&(st.width=s,st.height=c),p.clearRect(-t,-t,s+2*t,c+2*t),p.drawImage(l,0,0,s,c),p.getImageData(-t,-t,s+2*t,c+2*t)},resolveURL:l=>(tt||(tt=document.createElement("a")),tt.href=l,tt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(We==null&&(We=window.matchMedia("(prefers-reduced-motion: reduce)")),We.matches)},hasCanvasFingerprintNoise(){if(lt!==void 0)return lt;if(!Tt())return lt=!1,!1;const l=new OffscreenCanvas(85,1),t=l.getContext("2d",{willReadFrequently:!0});let s=0;for(let p=0;p<l.width;++p)t.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,t.fillRect(p,0,1,1);const c=t.getImageData(0,0,l.width,l.height);s=0;for(let p=0;p<c.data.length;++p)if(p%4!=3&&s++!==c.data[p])return lt=!0,!0;return lt=!1,!1}};function Xt(l,t){const s=l.indexOf("?");if(s<0)return`${l}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(l.slice(s));for(const p in t)c.set(p,t[p]);return`${l.slice(0,s)}?${c.toString()}`}function yn(l,t={persistentParams:[]}){const s=l.indexOf("?");if(s<0)return l;const c=new URLSearchParams,p=new URLSearchParams(l.slice(s));for(const m of t.persistentParams){const x=p.get(m);x&&c.set(m,x)}const h=c.toString();return`${l.slice(0,s)}${h.length>0?`?${h}`:""}`}const En="mapbox-tiles";let In=500,vn=50;const ui=["language","worldview","jobid"];let Yn,Dn;function bi(){try{return caches}catch{}}function ki(){const l=bi();l&&Yn==null&&(Yn=l.open(En))}let vr=1/0;const ts={supported:!1,testSupport:function(l){!oi&&Ji&&(Dr?uu(l):xr=l)}};let xr,Ji,oi=!1,Dr=!1;const Zn=typeof self<"u"?self:{};function uu(l){const t=l.createTexture();l.bindTexture(l.TEXTURE_2D,t);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Ji),l.isContextLost())return;ts.supported=!0}catch{}l.deleteTexture(t),oi=!0}Zn.document&&(Ji=Zn.document.createElement("img"),Ji.onload=function(){xr&&uu(xr),xr=null,Dr=!0},Ji.onerror=function(){oi=!0,xr=null},Ji.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Er={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Er);class Si extends Error{constructor(t,s,c){s===401&&Oe(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pr=Rr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,so=function(l,t){if(!(/^file:/.test(s=l.url)||/^file:/.test(pr())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,p){const h=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:pr(),referrerPolicy:c.referrerPolicy,signal:h.signal});let x=!1,T=!1;const A=(y=m.url).indexOf("sku=")>0&&Oe(y);var y;c.type==="json"&&m.headers.set("Accept","application/json");const I=(E,C,L)=>{if(T)return;if(E&&E.message!=="SecurityError"&&Xn(E.toString()),C&&L)return M(C);const k=Date.now();fetch(m).then(V=>{if(V.ok){const j=A?V.clone():null;return M(V,j,k)}return p(new Si(V.statusText,V.status,c.url))}).catch(V=>{V.name!=="AbortError"&&p(new Error(`${V.message} ${c.url}`))})},M=(E,C,L)=>{(c.type==="arrayBuffer"?E.arrayBuffer():c.type==="json"?E.json():E.text()).then(k=>{T||(C&&L&&function(V,j,Z){if(ki(),Yn==null)return;const G=Yi(j.headers.get("Cache-Control")||"");if(G["no-store"])return;const Y={status:j.status,statusText:j.statusText,headers:new Headers};j.headers.forEach((pe,ue)=>Y.headers.set(ue,pe)),G["max-age"]&&Y.headers.set("Expires",new Date(Z+1e3*G["max-age"]).toUTCString());const J=Y.headers.get("Expires");if(!J||new Date(J).getTime()-Z<42e4)return;let se=yn(V.url,{persistentParams:ui});if(j.status===206){const pe=V.headers.get("Range");if(!pe)return;Y.status=200,se=Xt(se,{range:pe})}(function(pe,ue){if(Dn===void 0)try{new Response(new ReadableStream),Dn=!0}catch{Dn=!1}Dn?ue(pe.body):pe.blob().then(ue)})(j,pe=>{const ue=new Response((he=j.status)!==200&&he!==404&&[101,103,204,205,304].includes(he)?null:pe,Y);var he;ki(),Yn!=null&&Yn.then(Le=>Le.put(se,ue)).catch(Le=>Xn(Le.message))})}(m,C,L),x=!0,p(null,k,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(k=>{T||p(new Error(k.message))})};return A?function(E,C){if(ki(),Yn==null)return C(null);Yn.then(L=>{let k=yn(E.url,{persistentParams:ui});const V=E.headers.get("Range");V&&(k=Xt(k,{range:V})),L.match(k).then(j=>{const Z=function(G){if(!G)return!1;const Y=new Date(G.headers.get("Expires")||0),J=Yi(G.headers.get("Cache-Control")||"");return Y>Date.now()&&!J["no-cache"]}(j);L.delete(k),Z&&L.put(k,j.clone()),C(null,j,Z)}).catch(C)}).catch(C)}(m,I):I(null,null),{cancel:()=>{T=!0,x||h.abort()}}}(l,t);if(Rr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,t,void 0,!0)}var s;return function(c,p){const h=new XMLHttpRequest;h.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const m in c.headers)h.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=c.credentials==="include",h.onerror=()=>{p(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let m=h.response;if(c.type==="json")try{m=JSON.parse(h.response)}catch(x){return p(x)}p(null,m,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else p(new Si(h.statusText,h.status,c.url))},h.send(c.body),{cancel:()=>h.abort()}}(l,t)},oo=function(l,t){return so(ir(l,{type:"arrayBuffer"}),t)};function zt(l){const t=document.createElement("a");return t.href=l,t.protocol===location.protocol&&t.host===location.host}const Sn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Jn,mr;Jn=[],mr=0;const $s=function(l,t){if(ts.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),mr>=ge.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:l,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Jn.push(h),h}mr++;let s=!1;const c=()=>{if(!s)for(s=!0,mr--;Jn.length&&mr<ge.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Jn.shift(),{requestParameters:m,callback:x,cancelled:T}=h;T||(h.cancel=$s(m,x).cancel)}},p=oo(l,(h,m,x,T)=>{c(),h?t(h):m&&(self.createImageBitmap?function(A,y){const I=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(I).then(M=>{y(null,M)}).catch(M=>{y(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(A,y)=>t(A,y,x,T)):function(A,y){const I=new Image;I.onload=()=>{y(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Sn})},I.onerror=()=>y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(A)],{type:"image/png"});I.src=A.byteLength?URL.createObjectURL(M):Sn}(m,(A,y)=>t(A,y,x,T)))});return{cancel:()=>{p.cancel(),c()}}};var Ir,Wa,ao,As={exports:{}},qr={exports:{}},Cl={exports:{}},us=function(){if(ao)return As.exports;ao=1;var l=(Ir||(Ir=1,qr.exports=function(s,c){var p,h,m,x,T,A,y,I;for(h=s.length-(p=3&s.length),m=c,T=3432918353,A=461845907,I=0;I<h;)y=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24,++I,m=27492+(65535&(x=5*(65535&(m=(m^=y=(65535&(y=(y=(65535&y)*T+(((y>>>16)*T&65535)<<16)&4294967295)<<15|y>>>17))*A+(((y>>>16)*A&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(y=0,p){case 3:y^=(255&s.charCodeAt(I+2))<<16;case 2:y^=(255&s.charCodeAt(I+1))<<8;case 1:m^=y=(65535&(y=(y=(65535&(y^=255&s.charCodeAt(I)))*T+(((y>>>16)*T&65535)<<16)&4294967295)<<15|y>>>17))*A+(((y>>>16)*A&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),qr.exports),t=(Wa||(Wa=1,Cl.exports=function(s,c){for(var p,h=s.length,m=c^h,x=0;h>=4;)p=1540483477*(65535&(p=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(p>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:m^=(255&s.charCodeAt(x+2))<<16;case 2:m^=(255&s.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Cl.exports);return As.exports=l,As.exports.murmur3=l,As.exports.murmur2=t,As.exports}(),ns=_e(us);class Tr{constructor(t,...s){ir(this,s[0]||{}),this.type=t}}class ma extends Tr{constructor(t,s={}){super("error",ir({error:t},s))}}function ga(l,t,s){s[l]&&s[l].indexOf(t)!==-1||(s[l]=s[l]||[],s[l].push(t))}function Ml(l,t,s){if(s&&s[l]){const c=s[l].indexOf(t);c!==-1&&s[l].splice(c,1)}}class lo{on(t,s){return this._listeners=this._listeners||{},ga(t,s,this._listeners),this}off(t,s){return Ml(t,s,this._listeners),Ml(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},ga(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){const c=typeof t=="string"?new Tr(t,s):t,p=c.type;if(this.listens(p)){c.target=this;const h=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const T of h)T.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const T of m)Ml(p,T,this._oneTimeListeners),T.call(this,c);const x=this._eventedParent;x&&(ir(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(c))}else c instanceof ma&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var _a,Un={},Al=function(){if(_a)return Un;_a=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(h){return(h=Math.round(h))<0?0:h>255?255:h}function s(h){return t(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function c(h){return(m=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:m>1?1:m;var m}function p(h,m,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?h+(m-h)*x*6:2*x<1?m:3*x<2?h+(m-h)*(2/3-x)*6:h}try{Un.parseCSSColor=function(h){var m,x=h.replace(/ /g,"").toLowerCase();if(x in l)return l[x].slice();if(x[0]==="#")return x.length===4?(m=parseInt(x.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:x.length===7&&(m=parseInt(x.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var T=x.indexOf("("),A=x.indexOf(")");if(T!==-1&&A+1===x.length){var y=x.substr(0,T),I=x.substr(T+1,A-(T+1)).split(","),M=1;switch(y){case"rgba":if(I.length!==4)return null;M=c(I.pop());case"rgb":return I.length!==3?null:[s(I[0]),s(I[1]),s(I[2]),M];case"hsla":if(I.length!==4)return null;M=c(I.pop());case"hsl":if(I.length!==3)return null;var E=(parseFloat(I[0])%360+360)%360/360,C=c(I[1]),L=c(I[2]),k=L<=.5?L*(C+1):L+C-L*C,V=2*L-k;return[t(255*p(V,k,E+1/3)),t(255*p(V,k,E)),t(255*p(V,k,E-1/3)),M];default:return null}}return null}}catch{}return Un}();class ai{constructor(t,s,c,p=1){this.r=t,this.g=s,this.b=c,this.a=p}static parse(t){if(!t)return;if(t instanceof ai)return t;if(typeof t!="string")return;const s=Al.parseCSSColor(t);return s?new ai(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[t,s,c,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(c)},${p})`}toRenderColor(t){const{r:s,g:c,b:p,a:h}=this;return new Tc(t,s,c,p,h)}}class Tc{constructor(t,s,c,p,h){if(t){const m=t.image.height,x=m*m;s=h===0?0:s/h*(m-1),c=h===0?0:c/h*(m-1),p=h===0?0:p/h*(m-1);const T=Math.floor(s),A=Math.floor(c),y=Math.floor(p),I=Math.ceil(s),M=Math.ceil(c),E=Math.ceil(p),C=s-T,L=c-A,k=p-y,V=t.image.data,j=4*(T+A*x+y*m),Z=4*(T+A*x+E*m),G=4*(T+M*x+y*m),Y=4*(T+M*x+E*m),J=4*(I+A*x+y*m),se=4*(I+A*x+E*m),pe=4*(I+M*x+y*m),ue=4*(I+M*x+E*m);if(j<0||ue>=V.length)throw new Error("out of range");this.r=ln(ln(ln(V[j],V[Z],k),ln(V[G],V[Y],k),L),ln(ln(V[J],V[se],k),ln(V[pe],V[ue],k),L),C)/255*h,this.g=ln(ln(ln(V[j+1],V[Z+1],k),ln(V[G+1],V[Y+1],k),L),ln(ln(V[J+1],V[se+1],k),ln(V[pe+1],V[ue+1],k),L),C)/255*h,this.b=ln(ln(ln(V[j+2],V[Z+2],k),ln(V[G+2],V[Y+2],k),L),ln(ln(V[J+2],V[se+2],k),ln(V[pe+2],V[ue+2],k),L),C)/255*h,this.a=h}else this.r=s,this.g=c,this.b=p,this.a=h}toArray(){const{r:t,g:s,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*t/p,255*s/p,255*c/p,p]}toArray01(){const{r:t,g:s,b:c,a:p}=this;return p===0?[0,0,0,0]:[t/p,s/p,c/p,p]}toArray01Scaled(t){const{r:s,g:c,b:p,a:h}=this;return h===0?[0,0,0]:[s/h*t,c/h*t,p/h*t]}toArray01PremultipliedAlpha(){const{r:t,g:s,b:c,a:p}=this;return[t,s,c,p]}toArray01Linear(){const{r:t,g:s,b:c,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(t/p,2.2),Math.pow(s/p,2.2),Math.pow(c/p,2.2),p]}}function ln(l,t,s){return l*(1-s)+t*s}function Pl(l,t,s){return l.map((c,p)=>ln(c,t[p],s))}ai.black=new ai(0,0,0,1),ai.white=new ai(1,1,1,1),ai.transparent=new ai(0,0,0,0),ai.red=new ai(1,0,0,1),ai.blue=new ai(0,0,1,1);var ks=Object.freeze({__proto__:null,array:Pl,color:function(l,t,s){return new ai(ln(l.r,t.r,s),ln(l.g,t.g,s),ln(l.b,t.b,s),ln(l.a,t.a,s))},number:ln});function ya(l,...t){for(const s of t)for(const c in s)l[c]=s[c];return l}class Ki extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class jr{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(t){return new jr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Ci={kind:"null"},Wt={kind:"number"},Gn={kind:"string"},cn={kind:"boolean"},is={kind:"color"},Vi={kind:"object"},Wn={kind:"value"},cu={kind:"collator"},Ll={kind:"formatted"},$a={kind:"resolvedImage"};function rr(l,t){return{kind:"array",itemType:l,N:t}}function Wi(l){if(l.kind==="array"){const t=Wi(l.itemType);return typeof l.N=="number"?`array<${t}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${t}>`}return l.kind}const Sc=[Ci,Wt,Gn,cn,is,Ll,Vi,rr(Wn),$a];function Qn(l,t){if(t.kind==="error")return null;if(l.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Qn(l.itemType,t.itemType))&&(typeof l.N!="number"||l.N===t.N))return null}else{if(l.kind===t.kind)return null;if(l.kind==="value"){for(const s of Sc)if(!Qn(s,t))return null}}return`Expected ${Wi(l)} but found ${Wi(t)} instead.`}function cs(l,t){return t.some(s=>s.kind===l.kind)}function Bs(l,t){return t.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}class Rl{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Or{constructor(t,s,c,p,h){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=c,this.fontStack=p,this.textColor=h}}class Nr{constructor(t){this.sections=t}static fromString(t){return new Nr([new Or(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof Nr?t:Nr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){t.push(["image",s.image.namePrimary]);continue}t.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),t.push(c)}return t}}class $i{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,s){return t?new $i({namePrimary:t,nameSecondary:s,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function hu(l,t,s,c){return typeof l=="number"&&l>=0&&l<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[l,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[l,t,s,c]:[l,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ys(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof ai||l instanceof Rl||l instanceof Nr||l instanceof $i)return!0;if(Array.isArray(l)){for(const t of l)if(!ys(t))return!1;return!0}if(typeof l=="object"){for(const t in l)if(!ys(l[t]))return!1;return!0}return!1}function Qi(l){if(l===null)return Ci;if(typeof l=="string")return Gn;if(typeof l=="boolean")return cn;if(typeof l=="number")return Wt;if(l instanceof ai)return is;if(l instanceof Rl)return cu;if(l instanceof Nr)return Ll;if(l instanceof $i)return $a;if(Array.isArray(l)){const t=l.length;let s;for(const c of l){const p=Qi(c);if(s){if(s===p)continue;s=Wn;break}s=p}return rr(s||Wn,t)}return Vi}function Sr(l){const t=typeof l;return l===null?"":t==="string"||t==="number"||t==="boolean"?String(l):l instanceof ai||l instanceof Nr||l instanceof $i?l.toString():JSON.stringify(l)}class vs{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ys(t[1]))return s.error("invalid value");const c=t[1];let p=Qi(c);const h=s.expectedType;return p.kind!=="array"||p.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(p=h),new vs(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ai?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Nr?this.value.serialize():this.value}}class At{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const hs={string:Gn,number:Wt,boolean:cn,object:Vi};class Mi{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,p=1;const h=t[0];if(h==="array"){let x,T;if(t.length>2){const A=t[1];if(typeof A!="string"||!(A in hs)||A==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=hs[A],p++}else x=Wn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=t[2],p++}c=rr(x,T)}else c=hs[h];const m=[];for(;p<t.length;p++){const x=s.parse(t[p],p,Wn);if(!x)return null;m.push(x)}return new Mi(c,m)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!Qn(this.type,Qi(c)))return c;if(s===this.args.length-1)throw new At(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Wi(Qi(c))} but was expected to be of type ${Wi(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const p=t.N;(typeof p=="number"||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(c=>c.serialize()))}}class Co{constructor(t){this.type=Ll,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const p=[];let h=!1;for(let m=1;m<=t.length-1;++m){const x=t[m];if(h&&typeof x=="object"&&!Array.isArray(x)){h=!1;let T=null;if(x["font-scale"]&&(T=s.parseObjectValue(x["font-scale"],m,"font-scale",Wt),!T))return null;let A=null;if(x["text-font"]&&(A=s.parseObjectValue(x["text-font"],m,"text-font",rr(Gn)),!A))return null;let y=null;if(x["text-color"]&&(y=s.parseObjectValue(x["text-color"],m,"text-color",is),!y))return null;const I=p[p.length-1];I.scale=T,I.font=A,I.textColor=y}else{const T=s.parse(t[m],m,Wn);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new Co(p)}evaluate(t){return new Nr(this.sections.map(s=>{const c=s.content.evaluate(t);return Qi(c)===$a?new Or("",c,null,null,null):new Or(Sr(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),t.push(c)}return t}}class Zo{constructor(t,s){this.type=$a,this.inputPrimary=t,this.inputSecondary=s}static parse(t,s){if(t.length<2)return s.error("Expected two or more arguments.");const c=s.parse(t[1],1,Gn);if(!c)return s.error("No image name provided.");if(t.length===2)return new Zo(c);const p=s.parse(t[2],1,Gn);return p?new Zo(c,p):s.error("Secondary image variant is not a string.")}evaluate(t){const s=$i.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&t.availableImages&&(s.available=t.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Mo(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const Ao={"to-boolean":cn,"to-color":is,"to-number":Wt,"to-string":Gn};class rs{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0],p=[];let h=Ci;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const m=t[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);h=rr(s.expectedType.itemType,m)}else{if(!(m>0&&ys(t[1][0])))return null;h=rr(Qi(t[1][0]),m)}for(let x=0;x<m;x++){const T=t[1][x];let A;if(Mo(T)==="array")A=s.parse(T,void 0,h.itemType);else{const y=Mo(T);if(y!==h.itemType.kind)return s.error(`Expected ${h.itemType.kind} but found ${y}.`);A=s.registry.literal.parse(["literal",T===void 0?null:T],s)}if(!A)return null;p.push(A)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");h=Ao[c];for(let m=1;m<t.length;m++){const x=s.parse(t[m],m,Wn);if(!x)return null;p.push(x)}}return new rs(h,p)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let s,c;for(const p of this.args){if(s=p.evaluate(t),c=null,s instanceof ai)return s;if(typeof s=="string"){const h=t.parseColor(s);if(h)return h}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:hu(s[0],s[1],s[2],s[3]),!c))return new ai(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new At(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new At(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Nr.fromString(Sr(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?$i.fromString(Sr(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(s=>s.evaluate(t)):Sr(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Co([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zo(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}const du=["Unknown","Point","LineString","Polygon"];class uo{constructor(t,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?du[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-t[0])+this.featureDistanceData.bearing[1]*(p*s-t[1])}return 0}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=ai.parse(t)),s}getConfig(t){return this.options?this.options.get(t):null}}class zr{constructor(t,s,c,p,h){this.name=t,this.type=s,this._evaluate=c,this.args=p,this._overloadIndex=h}evaluate(t){if(!this._evaluate){const s=zr.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const c=t[0],p=zr.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(p)?p[0]:p.type,m=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=[];let T=null,A=-1;for(const[y,I]of m){if(Array.isArray(y)&&y.length!==t.length-1)continue;x.push(y),A++,T=new Xu(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const M=[];let E=!1;for(let C=1;C<t.length;C++){const L=t[C],k=Array.isArray(y)?y[C-1]:y.type,V=T.parse(L,1+M.length,k);if(!V){E=!0;break}M.push(V)}if(!E)if(Array.isArray(y)&&y.length!==M.length)T.error(`Expected ${y.length} arguments, but found ${M.length} instead.`);else{for(let C=0;C<M.length;C++){const L=Array.isArray(y)?y[C]:y.type,k=M[C];T.concat(C+1).checkSubtype(L,k.type)}if(T.errors.length===0)return new zr(c,h,I,M,A)}}if(x.length===1)s.errors.push(...T.errors);else{const y=(x.length?x:m.map(([M])=>M)).map(Dl).join(" | "),I=[];for(let M=1;M<t.length;M++){const E=s.parse(t[M],1+I.length);if(!E)return null;I.push(Wi(E.type))}s.error(`Expected arguments of type ${y}, but found (${I.join(", ")}) instead.`)}return null}static register(t,s){zr.definitions=s;for(const c in s)t[c]=zr}}function Dl(l){return Array.isArray(l)?`(${l.map(Wi).join(", ")})`:`(${Wi(l.type)}...)`}class Vs{constructor(t,s,c){this.type=cu,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=c["case-sensitive"]===void 0?s.parse(!1,1,cn):s.parseObjectValue(c["case-sensitive"],1,"case-sensitive",cn);if(!p)return null;const h=c["diacritic-sensitive"]===void 0?s.parse(!1,1,cn):s.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",cn);if(!h)return null;let m=null;return c.locale&&(m=s.parseObjectValue(c.locale,1,"locale",Gn),!m)?null:new Vs(p,h,m)}evaluate(t){return new Rl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function ju(l,t,s=0,c=l.length-1,p=Ya){for(;c>s;){if(c-s>600){const T=c-s+1,A=t-s+1,y=Math.log(T),I=.5*Math.exp(2*y/3),M=.5*Math.sqrt(y*I*(T-I)/T)*(A-T/2<0?-1:1);ju(l,t,Math.max(s,Math.floor(t-A*I/T+M)),Math.min(c,Math.floor(t+(T-A)*I/T+M)),p)}const h=l[t];let m=s,x=c;for(Xa(l,s,t),p(l[c],h)>0&&Xa(l,s,c);m<x;){for(Xa(l,m,x),m++,x--;p(l[m],h)<0;)m++;for(;p(l[x],h)>0;)x--}p(l[s],h)===0?Xa(l,s,x):(x++,Xa(l,x,c)),x<=t&&(s=x+1),t<=x&&(c=x-1)}}function Xa(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}function Ya(l,t){return l<t?-1:l>t?1:0}function Cc(l){let t=0;for(let s,c,p=0,h=l.length,m=h-1;p<h;m=p++)s=l[p],c=l[m],t+=(c.x-s.x)*(s.y+c.y);return t}function ss(l,t){l[0]=Math.min(l[0],t[0]),l[1]=Math.min(l[1],t[1]),l[2]=Math.max(l[2],t[0]),l[3]=Math.max(l[3],t[1])}function Xs(l,t){return!(l[0]<=t[0]||l[2]>=t[2]||l[1]<=t[1]||l[3]>=t[3])}function Mc(l,t,s){const c=l[0]-t[0],p=l[1]-t[1],h=l[0]-s[0],m=l[1]-s[1];return c*m-h*p==0&&c*h<=0&&p*m<=0}function Po(l,t,s=!1){let c=!1;for(let x=0,T=t.length;x<T;x++){const A=t[x];for(let y=0,I=A.length,M=I-1;y<I;M=y++){const E=A[M],C=A[y];if(Mc(l,E,C))return s;(h=E)[1]>(p=l)[1]!=(m=C)[1]>p[1]&&p[0]<(m[0]-h[0])*(p[1]-h[1])/(m[1]-h[1])+h[0]&&(c=!c)}}var p,h,m;return c}function Ac(l,t,s,c){const p=c[0]-s[0],h=c[1]-s[1],m=(l[0]-s[0])*h-p*(l[1]-s[1]),x=(t[0]-s[0])*h-p*(t[1]-s[1]);return m>0&&x<0||m<0&&x>0}function Ys(l,t,s,c){return(p=[c[0]-s[0],c[1]-s[1]])[0]*(h=[t[0]-l[0],t[1]-l[1]])[1]-p[1]*h[0]!=0&&!(!Ac(l,t,s,c)||!Ac(s,c,l,t));var p,h}const xs=8192;function An(l,t){const s=(180+l[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(s*p*xs),Math.round(c*p*xs)]}function rn(l,t){for(let s=0;s<t.length;s++)if(Po(l,t[s]))return!0;return!1}function va(l,t,s){for(const c of s)for(let p=0,h=c.length,m=h-1;p<h;m=p++)if(Ys(l,t,c[m],c[p]))return!0;return!1}function xn(l,t){for(let s=0;s<l.length;++s)if(!Po(l[s],t))return!1;for(let s=0;s<l.length-1;++s)if(va(l[s],l[s+1],t))return!1;return!0}function fu(l,t){for(let s=0;s<t.length;s++)if(xn(l,t[s]))return!0;return!1}function Ja(l,t,s){const c=[];for(let p=0;p<l.length;p++){const h=[];for(let m=0;m<l[p].length;m++){const x=An(l[p][m],s);ss(t,x),h.push(x)}c.push(h)}return c}function mn(l,t,s){const c=[];for(let p=0;p<l.length;p++){const h=Ja(l[p],t,s);c.push(h)}return c}function Fr(l,t,s,c){if(l[0]<s[0]||l[0]>s[2]){const p=.5*c;let h=l[0]-s[0]>p?-c:s[0]-l[0]>p?c:0;h===0&&(h=l[0]-s[2]>p?-c:s[2]-l[0]>p?c:0),l[0]+=h}ss(t,l)}function Ol(l,t,s,c){const p=Math.pow(2,c.z)*xs,h=[c.x*xs,c.y*xs],m=[];if(!l)return m;for(const x of l)for(const T of x){const A=[T.x+h[0],T.y+h[1]];Fr(A,t,s,p),m.push(A)}return m}function Nl(l,t,s,c){const p=Math.pow(2,c.z)*xs,h=[c.x*xs,c.y*xs],m=[];if(!l)return m;for(const T of l){const A=[];for(const y of T){const I=[y.x+h[0],y.y+h[1]];ss(t,I),A.push(I)}m.push(A)}if(t[2]-t[0]<=p/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of m)for(const A of T)Fr(A,t,s,p)}var x;return m}class Lo{constructor(t,s){this.type=cn,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ys(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const h=c.features[p].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Lo(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Lo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Lo(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=Ja(c.coordinates,h,m),T=Ol(s.geometry(),p,h,m);if(!Xs(p,h))return!1;for(const A of T)if(!Po(A,x))return!1}if(c.type==="MultiPolygon"){const x=mn(c.coordinates,h,m),T=Ol(s.geometry(),p,h,m);if(!Xs(p,h))return!1;for(const A of T)if(!rn(A,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=Ja(c.coordinates,h,m),T=Nl(s.geometry(),p,h,m);if(!Xs(p,h))return!1;for(const A of T)if(!xn(A,x))return!1}if(c.type==="MultiPolygon"){const x=mn(c.coordinates,h,m),T=Nl(s.geometry(),p,h,m);if(!Xs(p,h))return!1;for(const A of T)if(!fu(A,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Wo={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Hr=1/298.257223563,pu=Hr*(2-Hr),$o=Math.PI/180;class Ka{static fromTile(t,s,c){const p=Math.PI*(1-2*(t+.5)/Math.pow(2,s)),h=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/$o;return new Ka(h,c)}static get units(){return Wo}constructor(t,s){if(t===void 0)throw new Error("No latitude given.");if(s&&!Wo[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Wo).join(", ")}`);const c=6378.137*$o*(s?Wo[s]:1),p=Math.cos(t*$o),h=1/(1-pu*(1-p*p)),m=Math.sqrt(h);this.kx=c*m*p,this.ky=c*m*h*(1-pu)}distance(t,s){const c=li(t[0]-s[0])*this.kx,p=(t[1]-s[1])*this.ky;return Math.sqrt(c*c+p*p)}bearing(t,s){const c=li(s[0]-t[0])*this.kx;return Math.atan2(c,(s[1]-t[1])*this.ky)/$o}destination(t,s,c){const p=c*$o;return this.offset(t,Math.sin(p)*s,Math.cos(p)*s)}offset(t,s,c){return[t[0]+s/this.kx,t[1]+c/this.ky]}lineDistance(t){let s=0;for(let c=0;c<t.length-1;c++)s+=this.distance(t[c],t[c+1]);return s}area(t){let s=0;for(let c=0;c<t.length;c++){const p=t[c];for(let h=0,m=p.length,x=m-1;h<m;x=h++)s+=li(p[h][0]-p[x][0])*(p[h][1]+p[x][1])*(c?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(t,s){let c=0;if(s<=0)return t[0];for(let p=0;p<t.length-1;p++){const h=t[p],m=t[p+1],x=this.distance(h,m);if(c+=x,c>s)return Cr(h,m,(s-(c-x))/x)}return t[t.length-1]}pointToSegmentDistance(t,s,c){let[p,h]=s,m=li(c[0]-p)*this.kx,x=(c[1]-h)*this.ky;if(m!==0||x!==0){const T=(li(t[0]-p)*this.kx*m+(t[1]-h)*this.ky*x)/(m*m+x*x);T>1?(p=c[0],h=c[1]):T>0&&(p+=m/this.kx*T,h+=x/this.ky*T)}return m=li(t[0]-p)*this.kx,x=(t[1]-h)*this.ky,Math.sqrt(m*m+x*x)}pointOnLine(t,s){let c=1/0,p=t[0][0],h=t[0][1],m=0,x=0;for(let T=0;T<t.length-1;T++){let A=t[T][0],y=t[T][1],I=li(t[T+1][0]-A)*this.kx,M=(t[T+1][1]-y)*this.ky,E=0;I===0&&M===0||(E=(li(s[0]-A)*this.kx*I+(s[1]-y)*this.ky*M)/(I*I+M*M),E>1?(A=t[T+1][0],y=t[T+1][1]):E>0&&(A+=I/this.kx*E,y+=M/this.ky*E)),I=li(s[0]-A)*this.kx,M=(s[1]-y)*this.ky;const C=I*I+M*M;C<c&&(c=C,p=A,h=y,m=T,x=E)}return{point:[p,h],index:m,t:Math.max(0,Math.min(1,x))}}lineSlice(t,s,c){let p=this.pointOnLine(c,t),h=this.pointOnLine(c,s);if(p.index>h.index||p.index===h.index&&p.t>h.t){const A=p;p=h,h=A}const m=[p.point],x=p.index+1,T=h.index;!Ps(c[x],m[0])&&x<=T&&m.push(c[x]);for(let A=x+1;A<=T;A++)m.push(c[A]);return Ps(c[T],h.point)||m.push(h.point),m}lineSliceAlong(t,s,c){let p=0;const h=[];for(let m=0;m<c.length-1;m++){const x=c[m],T=c[m+1],A=this.distance(x,T);if(p+=A,p>t&&h.length===0&&h.push(Cr(x,T,(t-(p-A))/A)),p>=s)return h.push(Cr(x,T,(s-(p-A))/A)),h;p>t&&h.push(T)}return h}bufferPoint(t,s){const c=s/this.ky,p=s/this.kx;return[t[0]-p,t[1]-c,t[0]+p,t[1]+c]}bufferBBox(t,s){const c=s/this.ky,p=s/this.kx;return[t[0]-p,t[1]-c,t[2]+p,t[3]+c]}insideBBox(t,s){return li(t[0]-s[0])>=0&&li(t[0]-s[2])<=0&&t[1]>=s[1]&&t[1]<=s[3]}}function Ps(l,t){return l[0]===t[0]&&l[1]===t[1]}function Cr(l,t,s){const c=li(t[0]-l[0]);return[l[0]+c*s,l[1]+(t[1]-l[1])*s]}function li(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Xo{constructor(t=[],s=(c,p)=>c<p?-1:c>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,p=s[t];for(;t>0;){const h=t-1>>1,m=s[h];if(c(p,m)>=0)break;s[t]=m,t=h}s[t]=p}_down(t){const{data:s,compare:c}=this,p=this.length>>1,h=s[t];for(;t<p;){let m=1+(t<<1);const x=m+1;if(x<this.length&&c(s[x],s[m])<0&&(m=x),c(s[m],h)>=0)break;s[t]=s[m],t=m}s[t]=h}}var Mt=8192;function Hu(l,t){return t.dist-l.dist}const fn=100,bs=50;function or(l){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==l.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==l[s])return!1;return!0}function Ls(l){return l[1]-l[0]+1}function Us(l,t){const s=l[1]>=l[0]&&l[1]<t;return s||console.warn("Distance Expression: Index is out of range"),s}function mu(l,t){if(l[0]>l[1])return[null,null];const s=Ls(l);if(t){if(s===2)return[l,null];const c=Math.floor(s/2);return[[l[0],l[0]+c],[l[0]+c,l[1]]]}{if(s===1)return[l,null];const c=Math.floor(s/2)-1;return[[l[0],l[0]+c],[l[0]+c+1,l[1]]]}}function ws(l,t){const s=[1/0,1/0,-1/0,-1/0];if(!Us(t,l.length))return s;for(let c=t[0];c<=t[1];++c)ss(s,l[c]);return s}function On(l){const t=[1/0,1/0,-1/0,-1/0];for(let s=0;s<l.length;++s)for(let c=0;c<l[s].length;++c)ss(t,l[s][c]);return t}function Ii(l,t,s){if(or(l)||or(t))return NaN;let c=0,p=0;return l[2]<t[0]&&(c=t[0]-l[2]),l[0]>t[2]&&(c=l[0]-t[2]),l[1]>t[3]&&(p=l[1]-t[3]),l[3]<t[1]&&(p=t[1]-l[3]),s.distance([0,0],[c,p])}function Yo(l){return 360*l-180}function Zr(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function kr(l,t){const s=Math.pow(2,t.z),c=(l.y/Mt+t.y)/s;return[Yo((l.x/Mt+t.x)/s),Zr(c)]}function gu(l,t){const s=[];for(let c=0;c<l.length;++c)s.push(kr(l[c],t));return s}function co(l,t,s){const c=s.pointOnLine(t,l).point;return s.distance(l,c)}function ds(l,t,s,c,p){const h=s.slice(c[0],c[1]+1);let m=1/0;for(let x=t[0];x<=t[1];++x)if((m=Math.min(m,co(l[x],h,p)))===0)return 0;return m}function xa(l,t,s,c,p){const h=Math.min(p.pointToSegmentDistance(l,s,c),p.pointToSegmentDistance(t,s,c)),m=Math.min(p.pointToSegmentDistance(s,l,t),p.pointToSegmentDistance(c,l,t));return Math.min(h,m)}function Zu(l,t,s,c,p){if(!Us(t,l.length)||!Us(c,s.length))return NaN;let h=1/0;for(let m=t[0];m<t[1];++m)for(let x=c[0];x<c[1];++x){if(Ys(l[m],l[m+1],s[x],s[x+1]))return 0;h=Math.min(h,xa(l[m],l[m+1],s[x],s[x+1],p))}return h}function Wu(l,t,s,c,p){if(!Us(t,l.length)||!Us(c,s.length))return NaN;let h=1/0;for(let m=t[0];m<=t[1];++m)for(let x=c[0];x<=c[1];++x)if((h=Math.min(h,p.distance(l[m],s[x])))===0)return h;return h}function _u(l,t,s){if(Po(l,t,!0))return 0;let c=1/0;for(const p of t){const h=p.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[h-1]&&(c=Math.min(c,s.pointToSegmentDistance(l,p[h-1],p[0])))===0||(c=Math.min(c,co(l,p,s)))===0)return c}return c}function ho(l,t,s,c){if(!Us(t,l.length))return NaN;for(let h=t[0];h<=t[1];++h)if(Po(l[h],s,!0))return 0;let p=1/0;for(let h=t[0];h<t[1];++h)for(const m of s)for(let x=0,T=m.length,A=T-1;x<T;A=x++){if(Ys(l[h],l[h+1],m[A],m[x]))return 0;p=Math.min(p,xa(l[h],l[h+1],m[A],m[x],c))}return p}function ba(l,t){for(const s of l)for(let c=0;c<=s.length-1;++c)if(Po(s[c],t,!0))return!0;return!1}function Rh(l,t,s,c=1/0){const p=On(l),h=On(t);if(c!==1/0&&Ii(p,h,s)>=c)return c;if(Xs(p,h)){if(ba(l,t))return 0}else if(ba(t,l))return 0;let m=c;for(const x of l)for(let T=0,A=x.length,y=A-1;T<A;y=T++)for(const I of t)for(let M=0,E=I.length,C=E-1;M<E;C=M++){if(Ys(x[y],x[T],I[C],I[M]))return 0;m=Math.min(m,xa(x[y],x[T],I[C],I[M],s))}return m}function wa(l,t,s,c,p,h,m){if(h===null||m===null)return;const x=Ii(ws(c,h),ws(p,m),s);x<t&&l.push({dist:x,range1:h,range2:m})}function fo(l,t,s,c,p=1/0){let h=Math.min(c.distance(l[0],s[0][0]),p);if(h===0)return h;const m=new Xo([{dist:0,range1:[0,l.length-1],range2:[0,0]}],Hu),x=t?bs:fn,T=On(s);for(;m.length;){const A=m.pop();if(A.dist>=h)continue;const y=A.range1;if(Ls(y)<=x){if(!Us(y,l.length))return NaN;if(t){const I=ho(l,y,s,c);if((h=Math.min(h,I))===0)return h}else for(let I=y[0];I<=y[1];++I){const M=_u(l[I],s,c);if((h=Math.min(h,M))===0)return h}}else{const I=mu(y,t);if(I[0]!==null){const M=Ii(ws(l,I[0]),T,c);M<h&&m.push({dist:M,range1:I[0],range2:[0,0]})}if(I[1]!==null){const M=Ii(ws(l,I[1]),T,c);M<h&&m.push({dist:M,range1:I[1],range2:[0,0]})}}}return h}function po(l,t,s,c,p,h=1/0){let m=Math.min(h,p.distance(l[0],s[0]));if(m===0)return m;const x=new Xo([{dist:0,range1:[0,l.length-1],range2:[0,s.length-1]}],Hu),T=t?bs:fn,A=c?bs:fn;for(;x.length;){const y=x.pop();if(y.dist>=m)continue;const I=y.range1,M=y.range2;if(Ls(I)<=T&&Ls(M)<=A){if(!Us(I,l.length)||!Us(M,s.length))return NaN;if(t&&c?m=Math.min(m,Zu(l,I,s,M,p)):t||c?t&&!c?m=Math.min(m,ds(s,M,l,I,p)):!t&&c&&(m=Math.min(m,ds(l,I,s,M,p))):m=Math.min(m,Wu(l,I,s,M,p)),m===0)return m}else{const E=mu(I,t),C=mu(M,c);wa(x,m,p,l,s,E[0],C[0]),wa(x,m,p,l,s,E[0],C[1]),wa(x,m,p,l,s,E[1],C[0]),wa(x,m,p,l,s,E[1],C[1])}}return m}function mo(l,t,s,c,p=1/0){let h=p;const m=ws(l,[0,l.length-1]);for(const x of s)if(!(h!==1/0&&Ii(m,ws(x,[0,x.length-1]),c)>=h)&&(h=Math.min(h,po(l,t,x,!0,c,h)),h===0))return h;return h}function go(l,t,s,c,p=1/0){let h=p;const m=ws(l,[0,l.length-1]);for(const x of s){if(h!==1/0&&Ii(m,On(x),c)>=h)continue;const T=fo(l,t,x,c,h);if(isNaN(T))return T;if((h=Math.min(h,T))===0)return h}return h}function yu(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Ea{constructor(t,s){this.type=Wt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(ys(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let p=0;p<c.features.length;++p)if(yu(c.features[p].geometry.type))return new Ea(c,c.features[p].geometry)}else if(c.type==="Feature"){if(yu(c.geometry.type))return new Ea(c,c.geometry)}else if(yu(c.type))return new Ea(c,c)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const s=t.geometry(),c=t.canonicalID();if(s!=null&&c!=null){if(t.geometryType()==="Point")return function(p,h,m){const x=[];for(const A of p)for(const y of A)x.push(kr(y,h));const T=new Ka(x[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?po(x,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",T):m.type==="MultiLineString"?mo(x,!1,m.coordinates,T):m.type==="Polygon"||m.type==="MultiPolygon"?go(x,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,T):null}(s,c,this.geometries);if(t.geometryType()==="LineString")return function(p,h,m){const x=[];for(const A of p){const y=[];for(const I of A)y.push(kr(I,h));x.push(y)}const T=new Ka(x[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return mo(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,T);if(m.type==="MultiLineString"){let A=1/0;for(let y=0;y<m.coordinates.length;y++){const I=mo(m.coordinates[y],!0,x,T,A);if(isNaN(I))return I;if((A=Math.min(A,I))===0)return A}return A}if(m.type==="Polygon"||m.type==="MultiPolygon"){let A=1/0;for(let y=0;y<x.length;y++){const I=go(x[y],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,T,A);if(isNaN(I))return I;if((A=Math.min(A,I))===0)return A}return A}return null}(s,c,this.geometries);if(t.geometryType()==="Polygon")return function(p,h,m){const x=[];for(const A of function(y,I){const M=y.length;if(M<=1)return[y];const E=[];let C,L;for(let k=0;k<M;k++){const V=Cc(y[k]);V!==0&&(y[k].area=Math.abs(V),L===void 0&&(L=V<0),L===V<0?(C&&E.push(C),C=[y[k]]):C.push(y[k]))}return C&&E.push(C),E}(p)){const y=[];for(let I=0;I<A.length;++I)y.push(gu(A[I],h));x.push(y)}const T=new Ka(x[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return go(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,T);if(m.type==="MultiLineString"){let A=1/0;for(let y=0;y<m.coordinates.length;y++){const I=go(m.coordinates[y],!0,x,T,A);if(isNaN(I))return I;if((A=Math.min(A,I))===0)return A}return A}return m.type==="Polygon"||m.type==="MultiPolygon"?function(A,y,I){let M=1/0;for(const E of A)for(const C of y){const L=Rh(E,C,I,M);if(isNaN(L))return L;if((M=Math.min(M,L))===0)return M}return M}(m.type==="Polygon"?[m.coordinates]:m.coordinates,x,T):null}(s,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ia(l,t){switch(l){case"string":return Sr(t);case"number":return+t;case"boolean":return!!t;case"color":return ai.parse(t);case"formatted":return Nr.fromString(Sr(t));case"resolvedImage":return $i.fromString(Sr(t))}return t}function qn(l,t,s,c){return c!==void 0&&(l=c*Math.round(l/c)),t!==void 0&&l<t&&(l=t),s!==void 0&&l>s&&(l=s),l}class Jo{constructor(t,s,c){this.type=t,this.key=s,this.scope=c}static parse(t,s){let c=s.expectedType;if(c==null&&(c=Wn),t.length<2||t.length>3)return s.error("Invalid number of arguments for 'config' expression.");const p=s.parse(t[1],1);if(!(p instanceof vs))return s.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const h=s.parse(t[2],2);return h instanceof vs?new Jo(c,Sr(p.value),Sr(h.value)):s.error("Scope of 'config' expression must be a string literal.")}return new Jo(c,Sr(p.value))}evaluate(t){const s=[this.key,this.scope,t.scope].filter(Boolean).join(""),c=t.getConfig(s);if(!c)return null;const{type:p,value:h,values:m,minValue:x,maxValue:T,stepValue:A}=c,y=c.default.evaluate(t);let I=y;if(h){const M=t.scope;t.scope=(M||"").split("").slice(1).join(""),I=h.evaluate(t),t.scope=M}return p&&(I=Ia(p,I)),I===void 0||x===void 0&&T===void 0&&A===void 0||(typeof I=="number"?I=qn(I,x,T,A):Array.isArray(I)&&(I=I.map(M=>typeof M=="number"?qn(M,x,T,A):M))),h!==void 0&&I!==void 0&&m&&!m.includes(I)&&(I=y,p&&(I=Ia(p,I))),(p&&p!==this.type||I!==void 0&&Qi(I)!==this.type)&&(I=Ia(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function vu(l){if(l instanceof zr&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Lo||l instanceof Ea)return!1;let t=!0;return l.eachChild(s=>{t&&!vu(s)&&(t=!1)}),t}function Qa(l){if(l instanceof zr&&l.name==="feature-state")return!1;let t=!0;return l.eachChild(s=>{t&&!Qa(s)&&(t=!1)}),t}function Ta(l){if(l instanceof Jo)return new Set([l.key]);let t=new Set;return l.eachChild(s=>{t=new Set([...t,...Ta(s)])}),t}function Sa(l,t){if(l instanceof zr&&t.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(c=>{s&&!Sa(c,t)&&(s=!1)}),s}class dn{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new dn(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class $u{constructor(t,s=[],c,p=new jr,h=[],m,x){this.registry=t,this.path=s,this.key=s.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=p,this.errors=h,this.expectedType=c,this._scope=m,this.options=x}parse(t,s,c,p,h={}){return s||c?this.concat(s,null,c,p)._parse(t,h):this._parse(t,h)}parseObjectValue(t,s,c,p,h,m={}){return this.concat(s,c,p,h)._parse(t,m)}_parse(t,s){function c(p,h,m){return m==="assert"?new Mi(h,[p]):m==="coerce"?new rs(h,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(p){let h=p.parse(t,this);if(!h)return null;if(this.expectedType){const m=this.expectedType,x=h.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(m,x))return null}else h=c(h,m,s.typeAnnotation||"coerce");else h=c(h,m,s.typeAnnotation||"assert")}if(!(h instanceof vs)&&h.type.kind!=="resolvedImage"&&Yu(h)){const m=new uo(this._scope,this.options);try{h=new vs(h.type,h.evaluate(m))}catch(x){return this.error(x.message),null}}return h}return rs.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c,p){let h=typeof t=="number"?this.path.concat(t):this.path;h=typeof s=="string"?h.concat(s):h;const m=p?this.scope.concat(p):this.scope;return new $u(this.registry,h,c||null,m,this.errors,this._scope,this.options)}error(t,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ki(c,t))}checkSubtype(t,s){const c=Qn(t,s);return c&&this.error(c),c}}var Xu=$u;function Yu(l){if(l instanceof dn)return Yu(l.boundExpression);if(l instanceof zr&&l.name==="error"||l instanceof Vs||l instanceof Lo||l instanceof Ea||l instanceof Jo)return!1;const t=l instanceof rs||l instanceof Mi;let s=!0;return l.eachChild(c=>{s=t?s&&Yu(c):s&&c instanceof vs}),!!s&&vu(l)&&Sa(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function br(l,t){const s=l.length-1;let c,p,h=0,m=s,x=0;for(;h<=m;)if(x=Math.floor((h+m)/2),c=l[x],p=l[x+1],c<=t){if(x===s||t<p)return x;h=x+1}else{if(!(c>t))throw new At("Input is not a number.");m=x-1}return 0}class Ca{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[p,h]of c)this.labels.push(p),this.outputs.push(h)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,Wt);if(!c)return null;const p=[];let h=null;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);for(let m=1;m<t.length;m+=2){const x=m===1?-1/0:t[m],T=t[m+1],A=m,y=m+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const I=s.parse(T,y,h);if(!I)return null;h=h||I.type,p.push([x,I])}return new Ca(h,c,p)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return c[0].evaluate(t);const h=s.length;return p>=s[h-1]?c[h-1].evaluate(t):c[br(s,p)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}const _o=.95047,xu=1.08883,Ju=4/29,Ma=6/29,Pc=3*Ma*Ma,Ku=Ma*Ma*Ma,el=Math.PI/180,Qu=180/Math.PI;function tl(l){return l>Ku?Math.pow(l,1/3):l/Pc+Ju}function Ko(l){return l>Ma?l*l*l:Pc*(l-Ju)}function bu(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function zl(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Lc(l){const t=zl(l.r),s=zl(l.g),c=zl(l.b),p=tl((.4124564*t+.3575761*s+.1804375*c)/_o),h=tl((.2126729*t+.7151522*s+.072175*c)/1);return{l:116*h-16,a:500*(p-h),b:200*(h-tl((.0193339*t+.119192*s+.9503041*c)/xu)),alpha:l.a}}function Rc(l){let t=(l.l+16)/116,s=isNaN(l.a)?t:t+l.a/500,c=isNaN(l.b)?t:t-l.b/200;return t=1*Ko(t),s=_o*Ko(s),c=xu*Ko(c),new ai(bu(3.2404542*s-1.5371385*t-.4985314*c),bu(-.969266*s+1.8760108*t+.041556*c),bu(.0556434*s-.2040259*t+1.0572252*c),l.alpha)}function Wr(l,t,s){const c=t-l;return l+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Ro={forward:Lc,reverse:Rc,interpolate:function(l,t,s){return{l:ln(l.l,t.l,s),a:ln(l.a,t.a,s),b:ln(l.b,t.b,s),alpha:ln(l.alpha,t.alpha,s)}}},$r={forward:function(l){const{l:t,a:s,b:c}=Lc(l),p=Math.atan2(c,s)*Qu;return{h:p<0?p+360:p,c:Math.sqrt(s*s+c*c),l:t,alpha:l.a}},reverse:function(l){const t=l.h*el,s=l.c;return Rc({l:l.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:l.alpha})},interpolate:function(l,t,s){return{h:Wr(l.h,t.h,s),c:ln(l.c,t.c,s),l:ln(l.l,t.l,s),alpha:ln(l.alpha,t.alpha,s)}}};var nl=Object.freeze({__proto__:null,hcl:$r,lab:Ro});class fs{constructor(t,s,c,p,h){this.type=t,this.operator=s,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[m,x]of h)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(t,s,c,p){let h=0;if(t.name==="exponential")h=Gs(s,t.base,c,p);else if(t.name==="linear")h=Gs(s,1,c,p);else if(t.name==="cubic-bezier"){const m=t.controlPoints;h=new bn(m[0],m[1],m[2],m[3]).solve(Gs(s,1,c,p))}return h}static parse(t,s){let[c,p,h,...m]=t;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const A=p[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:A}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const A=p.slice(1);if(A.length!==4||A.some(y=>typeof y!="number"||y<0||y>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:A}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(h=s.parse(h,2,Wt),!h)return null;const x=[];let T=null;c==="interpolate-hcl"||c==="interpolate-lab"?T=is:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let A=0;A<m.length;A+=2){const y=m[A],I=m[A+1],M=A+3,E=A+4;if(typeof y!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(x.length&&x[x.length-1][0]>=y)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const C=s.parse(I,E,T);if(!C)return null;T=T||C.type,x.push([y,C])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new fs(T,c,p,h,x):s.error(`Type ${Wi(T)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return c[0].evaluate(t);const h=s.length;if(p>=s[h-1])return c[h-1].evaluate(t);const m=br(s,p),x=fs.interpolationFactor(this.interpolation,p,s[m],s[m+1]),T=c[m].evaluate(t),A=c[m+1].evaluate(t);return this.operator==="interpolate"?ks[this.type.kind.toLowerCase()](T,A,x):this.operator==="interpolate-hcl"?$r.reverse($r.interpolate($r.forward(T),$r.forward(A),x)):Ro.reverse(Ro.interpolate(Ro.forward(T),Ro.forward(A),x))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Gs(l,t,s,c){const p=c-s,h=l-s;return p===0?0:t===1?h/p:(Math.pow(t,h)-1)/(Math.pow(t,p)-1)}class wu{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&p.kind!=="value"&&(c=p);const h=[];for(const x of t.slice(1)){const T=s.parse(x,1+h.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,h.push(T)}const m=p&&h.some(x=>Qn(p,x.type));return new wu(m?Wn:c,h)}evaluate(t){let s,c=null,p=0;for(const h of this.args){if(p++,c=h.evaluate(t),c&&c instanceof $i&&!c.available&&(s||(s=c),c=null,p===this.args.length))return s;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class Es{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let h=1;h<t.length-1;h+=2){const m=t[h];if(typeof m!="string")return s.error(`Expected string, but found ${typeof m} instead.`,h);if(/[^a-zA-Z0-9_]/.test(m))return s.error("Variable names must contain only alphanumeric characters or '_'.",h);const x=s.parse(t[h+1],h+1);if(!x)return null;c.push([m,x])}const p=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return p?new Es(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,c]of this.bindings)t.push(s,c.serialize());return t.push(this.result.serialize()),t}}class Is{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Wt),p=s.parse(t[2],2,rr(s.expectedType||Wn));return c&&p?new Is(p.type.itemType,c,p):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new At(`Array index out of bounds: ${s} < 0.`);if(s>c.length-1)throw new At(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s===Math.floor(s))return c[s];const p=Math.floor(s),h=Math.ceil(s),m=c[p],x=c[h];if(typeof m!="number"||typeof x!="number")throw new At(`Cannot interpolate between non-number values at index ${s}.`);const T=s-p;return m*(1-T)+x*T}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fl{constructor(t,s){this.type=cn,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Wn),p=s.parse(t[2],2,Wn);return c&&p?cs(c.type,[cn,Gn,Wt,Ci,Wn])?new Fl(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!Bs(s,["boolean","string","number","null"]))throw new At(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(Qi(s))} instead.`);if(!Bs(c,["string","array"]))throw new At(`Expected second argument to be of type array or string, but found ${Wi(Qi(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qs{constructor(t,s,c){this.type=Wt,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Wn),p=s.parse(t[2],2,Wn);if(!c||!p)return null;if(!cs(c.type,[cn,Gn,Wt,Ci,Wn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(c.type)} instead`);if(t.length===4){const h=s.parse(t[3],3,Wt);return h?new qs(c,p,h):null}return new qs(c,p)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Bs(s,["boolean","string","number","null"]))throw new At(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(Qi(s))} instead.`);if(!Bs(c,["string","array"]))throw new At(`Expected second argument to be of type array or string, but found ${Wi(Qi(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ec{constructor(t,s,c,p,h,m){this.inputType=t,this.type=s,this.input=c,this.cases=p,this.outputs=h,this.otherwise=m}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const h={},m=[];for(let A=2;A<t.length-1;A+=2){let y=t[A];const I=t[A+1];Array.isArray(y)||(y=[y]);const M=s.concat(A);if(y.length===0)return M.error("Expected at least one branch label.");for(const C of y){if(typeof C!="number"&&typeof C!="string")return M.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return M.error("Numeric branch labels must be integer values.");if(c){if(M.checkSubtype(c,Qi(C)))return null}else c=Qi(C);if(h[String(C)]!==void 0)return M.error("Branch labels must be unique.");h[String(C)]=m.length}const E=s.parse(I,A,p);if(!E)return null;p=p||E.type,m.push(E)}const x=s.parse(t[1],1,Wn);if(!x)return null;const T=s.parse(t[t.length-1],t.length-1,p);return T?x.type.kind!=="value"&&s.concat(1).checkSubtype(c,x.type)?null:new ec(c,p,x,h,m,T):null}evaluate(t){const s=this.input.evaluate(t);return(Qi(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],p={};for(const m of s){const x=p[this.cases[m]];x===void 0?(p[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[x][1].push(m)}const h=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of c)t.push(x.length===1?h(x[0]):x.map(h)),t.push(this.outputs[m].serialize());return t.push(this.otherwise.serialize()),t}}class js{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const p=[];for(let m=1;m<t.length-1;m+=2){const x=s.parse(t[m],m,cn);if(!x)return null;const T=s.parse(t[m+1],m+1,c);if(!T)return null;p.push([x,T]),c=c||T.type}const h=s.parse(t[t.length-1],t.length-1,c);return h?new js(c,p,h):null}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class kl{constructor(t,s,c,p){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Wn),p=s.parse(t[2],2,Wt);if(!c||!p)return null;if(!cs(c.type,[rr(Wn),Gn,Wn]))return s.error(`Expected first argument to be of type array or string, but found ${Wi(c.type)} instead`);if(t.length===4){const h=s.parse(t[3],3,Wt);return h?new kl(c.type,c,p,h):null}return new kl(c.type,c,p)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!Bs(s,["string","array"]))throw new At(`Expected first argument to be of type array or string, but found ${Wi(Qi(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return s.slice(c,p)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function tc(l,t){return l==="=="||l==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Bl(l,t,s,c){return c.compare(t,s)===0}function Aa(l,t,s){const c=l!=="=="&&l!=="!=";return class d1{constructor(h,m,x){this.type=cn,this.lhs=h,this.rhs=m,this.collator=x,this.hasUntypedArgument=h.type.kind==="value"||m.type.kind==="value"}static parse(h,m){if(h.length!==3&&h.length!==4)return m.error("Expected two or three arguments.");const x=h[0];let T=m.parse(h[1],1,Wn);if(!T)return null;if(!tc(x,T.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${Wi(T.type)}'.`);let A=m.parse(h[2],2,Wn);if(!A)return null;if(!tc(x,A.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${Wi(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return m.error(`Cannot compare types '${Wi(T.type)}' and '${Wi(A.type)}'.`);c&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new Mi(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new Mi(T.type,[A])));let y=null;if(h.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(y=m.parse(h[3],3,cu),!y)return null}return new d1(T,A,y)}evaluate(h){const m=this.lhs.evaluate(h),x=this.rhs.evaluate(h);if(c&&this.hasUntypedArgument){const T=Qi(m),A=Qi(x);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new At(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=Qi(m),A=Qi(x);if(T.kind!=="string"||A.kind!=="string")return t(h,m,x)}return this.collator?s(h,m,x,this.collator.evaluate(h)):t(h,m,x)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[l];return this.eachChild(m=>{h.push(m.serialize())}),h}}}const uh=Aa("==",function(l,t,s){return t===s},Bl),Eu=Aa("!=",function(l,t,s){return t!==s},function(l,t,s,c){return!Bl(0,t,s,c)}),nc=Aa("<",function(l,t,s){return t<s},function(l,t,s,c){return c.compare(t,s)<0}),ps=Aa(">",function(l,t,s){return t>s},function(l,t,s,c){return c.compare(t,s)>0}),Dc=Aa("<=",function(l,t,s){return t<=s},function(l,t,s,c){return c.compare(t,s)<=0}),gr=Aa(">=",function(l,t,s){return t>=s},function(l,t,s,c){return c.compare(t,s)>=0});class ms{constructor(t,s,c,p,h,m){this.type=Gn,this.number=t,this.locale=s,this.currency=c,this.unit=p,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,Wt);if(!c)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let h=null;if(p.locale&&(h=s.parseObjectValue(p.locale,2,"locale",Gn),!h))return null;let m=null;if(p.currency&&(m=s.parseObjectValue(p.currency,2,"currency",Gn),!m))return null;let x=null;if(p.unit&&(x=s.parseObjectValue(p.unit,2,"unit",Gn),!x))return null;let T=null;if(p["min-fraction-digits"]&&(T=s.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",Wt),!T))return null;let A=null;return p["max-fraction-digits"]&&(A=s.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",Wt),!A)?null:new ms(c,h,m,x,T,A)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class il{constructor(t){this.type=Wt,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Wi(c.type)} instead.`):new il(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new At(`Expected value to be of type string or array, but found ${Wi(Qi(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}function Vl(l){return function(){l=1831565813+(l|=0)|0;let t=Math.imul(l^l>>>15,1|l);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Qo={"==":uh,"!=":Eu,">":ps,"<":nc,">=":gr,"<=":Dc,array:Mi,at:Is,boolean:Mi,case:js,coalesce:wu,collator:Vs,format:Co,image:Zo,in:Fl,"index-of":qs,interpolate:fs,"interpolate-hcl":fs,"interpolate-lab":fs,length:il,let:Es,literal:vs,match:ec,number:Mi,"number-format":ms,object:Mi,slice:kl,step:Ca,string:Mi,"to-boolean":rs,"to-color":rs,"to-number":rs,"to-string":rs,var:dn,within:Lo,distance:Ea,config:Jo};function ic(l,[t,s,c,p]){t=t.evaluate(l),s=s.evaluate(l),c=c.evaluate(l);const h=p?p.evaluate(l):1,m=hu(t,s,c,h);if(m)throw new At(m);return new ai(t/255*h,s/255*h,c/255*h,h)}function Iu(l,[t,s,c,p]){t=t.evaluate(l),s=s.evaluate(l),c=c.evaluate(l);const h=p?p.evaluate(l):1,m=function(A,y,I,M){return typeof A=="number"&&A>=0&&A<=360?typeof y=="number"&&y>=0&&y<=100&&typeof I=="number"&&I>=0&&I<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[A,y,I,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[A,y,I,M]:[A,y,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[A,y,I,M]:[A,y,I]).join(", ")}]: 'h' must be between 0 and 360.`}(t,s,c,h);if(m)throw new At(m);const x=`hsla(${t}, ${s}%, ${c}%, ${h})`,T=ai.parse(x);if(!T)throw new At(`Failed to parse HSLA color: ${x}`);return T}function Ul(l,t){return l in t}function Tu(l,t){const s=t[l];return s===void 0?null:s}function Do(l){return{type:l}}function Oc(l){return{result:"success",value:l}}function Ts(l){return{result:"error",value:l}}function Pa(l,t){return!!l&&!!l.parameters&&l.parameters.indexOf(t)>-1}function ea(l){return l["property-type"]==="data-driven"}function rc(l){return Pa(l.expression,"measure-light")}function Su(l){return Pa(l.expression,"zoom")}function ci(l){return!!l.expression&&l.expression.interpolated}function Ss(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Cu(l){return l}function ta(l,t){const s=t.type==="color",c=l.stops&&typeof l.stops[0][0]=="object",p=c||!(c||l.property!==void 0),h=l.type||(ci(t)?"exponential":"interval");if(s&&((l=ya({},l)).stops&&(l.stops=l.stops.map(A=>[A[0],ai.parse(A[1])])),l.default=ai.parse(l.default?l.default:t.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!nl[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let m,x,T;if(h==="exponential")m=Js;else if(h==="interval")m=sc;else if(h==="categorical"){m=rl,x=Object.create(null);for(const A of l.stops)x[A[0]]=A[1];T=typeof l.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=na}if(c){const A={},y=[];for(let E=0;E<l.stops.length;E++){const C=l.stops[E],L=C[0].zoom;A[L]===void 0&&(A[L]={zoom:L,type:l.type,property:l.property,default:l.default,stops:[]},y.push(L)),A[L].stops.push([C[0].value,C[1]])}const I=[];for(const E of y)I.push([A[E].zoom,ta(A[E],t)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:fs.interpolationFactor.bind(void 0,M),zoomStops:I.map(E=>E[0]),evaluate:({zoom:E},C)=>Js({stops:I,base:l.base},t,E).evaluate(E,C)}}if(p){const A=h==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:fs.interpolationFactor.bind(void 0,A),zoomStops:l.stops.map(y=>y[0]),evaluate:({zoom:y})=>m(l,t,y,x,T)}}return{kind:"source",evaluate(A,y){const I=y&&y.properties?y.properties[l.property]:void 0;return I===void 0?gs(l.default,t.default):m(l,t,I,x,T)}}}function gs(l,t,s){return l!==void 0?l:t!==void 0?t:s!==void 0?s:void 0}function rl(l,t,s,c,p){return gs(typeof s===p?c[s]:void 0,l.default,t.default)}function sc(l,t,s){if(Mo(s)!=="number")return gs(l.default,t.default);const c=l.stops.length;if(c===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[c-1][0])return l.stops[c-1][1];const p=br(l.stops.map(h=>h[0]),s);return l.stops[p][1]}function Js(l,t,s){const c=l.base!==void 0?l.base:1;if(Mo(s)!=="number")return gs(l.default,t.default);const p=l.stops.length;if(p===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[p-1][0])return l.stops[p-1][1];const h=br(l.stops.map(y=>y[0]),s),m=function(y,I,M,E){const C=E-M,L=y-M;return C===0?0:I===1?L/C:(Math.pow(I,L)-1)/(Math.pow(I,C)-1)}(s,c,l.stops[h][0],l.stops[h+1][0]),x=l.stops[h][1],T=l.stops[h+1][1];let A=ks[t.type]||Cu;if(l.colorSpace&&l.colorSpace!=="rgb"){const y=nl[l.colorSpace];A=(I,M)=>y.reverse(y.interpolate(y.forward(I),y.forward(M),m))}return typeof x.evaluate=="function"?{evaluate(...y){const I=x.evaluate.apply(void 0,y),M=T.evaluate.apply(void 0,y);if(I!==void 0&&M!==void 0)return A(I,M,m)}}:A(x,T,m)}function na(l,t,s){return t.type==="color"?s=ai.parse(s):t.type==="formatted"?s=Nr.fromString(s.toString()):t.type==="resolvedImage"?s=$i.fromString(s.toString()):Mo(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0),gs(s,l.default,t.default)}zr.register(Qo,{error:[{kind:"error"},[Gn],(l,[t])=>{throw new At(t.evaluate(l))}],typeof:[Gn,[Wn],(l,[t])=>Wi(Qi(t.evaluate(l)))],"to-rgba":[rr(Wt,4),[is],(l,[t])=>t.evaluate(l).toRenderColor(null).toArray()],rgb:[is,[Wt,Wt,Wt],ic],rgba:[is,[Wt,Wt,Wt,Wt],ic],hsl:[is,[Wt,Wt,Wt],Iu],hsla:[is,[Wt,Wt,Wt,Wt],Iu],has:{type:cn,overloads:[[[Gn],(l,[t])=>Ul(t.evaluate(l),l.properties())],[[Gn,Vi],(l,[t,s])=>Ul(t.evaluate(l),s.evaluate(l))]]},get:{type:Wn,overloads:[[[Gn],(l,[t])=>Tu(t.evaluate(l),l.properties())],[[Gn,Vi],(l,[t,s])=>Tu(t.evaluate(l),s.evaluate(l))]]},"feature-state":[Wn,[Gn],(l,[t])=>Tu(t.evaluate(l),l.featureState||{})],properties:[Vi,[],l=>l.properties()],"geometry-type":[Gn,[],l=>l.geometryType()],id:[Wn,[],l=>l.id()],zoom:[Wt,[],l=>l.globals.zoom],pitch:[Wt,[],l=>l.globals.pitch||0],"distance-from-center":[Wt,[],l=>l.distanceFromCenter()],"measure-light":[Wt,[Gn],(l,[t])=>l.measureLight(t.evaluate(l))],"heatmap-density":[Wt,[],l=>l.globals.heatmapDensity||0],"line-progress":[Wt,[],l=>l.globals.lineProgress||0],"raster-value":[Wt,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[Wt,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[Wt,[],l=>l.globals.skyRadialProgress||0],accumulated:[Wn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Wt,Do(Wt),(l,t)=>{let s=0;for(const c of t)s+=c.evaluate(l);return s}],"*":[Wt,Do(Wt),(l,t)=>{let s=1;for(const c of t)s*=c.evaluate(l);return s}],"-":{type:Wt,overloads:[[[Wt,Wt],(l,[t,s])=>t.evaluate(l)-s.evaluate(l)],[[Wt],(l,[t])=>-t.evaluate(l)]]},"/":[Wt,[Wt,Wt],(l,[t,s])=>t.evaluate(l)/s.evaluate(l)],"%":[Wt,[Wt,Wt],(l,[t,s])=>t.evaluate(l)%s.evaluate(l)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(l,[t,s])=>Math.pow(t.evaluate(l),s.evaluate(l))],sqrt:[Wt,[Wt],(l,[t])=>Math.sqrt(t.evaluate(l))],log10:[Wt,[Wt],(l,[t])=>Math.log(t.evaluate(l))/Math.LN10],ln:[Wt,[Wt],(l,[t])=>Math.log(t.evaluate(l))],log2:[Wt,[Wt],(l,[t])=>Math.log(t.evaluate(l))/Math.LN2],sin:[Wt,[Wt],(l,[t])=>Math.sin(t.evaluate(l))],cos:[Wt,[Wt],(l,[t])=>Math.cos(t.evaluate(l))],tan:[Wt,[Wt],(l,[t])=>Math.tan(t.evaluate(l))],asin:[Wt,[Wt],(l,[t])=>Math.asin(t.evaluate(l))],acos:[Wt,[Wt],(l,[t])=>Math.acos(t.evaluate(l))],atan:[Wt,[Wt],(l,[t])=>Math.atan(t.evaluate(l))],min:[Wt,Do(Wt),(l,t)=>Math.min(...t.map(s=>s.evaluate(l)))],max:[Wt,Do(Wt),(l,t)=>Math.max(...t.map(s=>s.evaluate(l)))],abs:[Wt,[Wt],(l,[t])=>Math.abs(t.evaluate(l))],round:[Wt,[Wt],(l,[t])=>{const s=t.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[Wt,[Wt],(l,[t])=>Math.floor(t.evaluate(l))],ceil:[Wt,[Wt],(l,[t])=>Math.ceil(t.evaluate(l))],"filter-==":[cn,[Gn,Wn],(l,[t,s])=>l.properties()[t.value]===s.value],"filter-id-==":[cn,[Wn],(l,[t])=>l.id()===t.value],"filter-type-==":[cn,[Gn],(l,[t])=>l.geometryType()===t.value],"filter-<":[cn,[Gn,Wn],(l,[t,s])=>{const c=l.properties()[t.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[cn,[Wn],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[cn,[Gn,Wn],(l,[t,s])=>{const c=l.properties()[t.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[cn,[Wn],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[cn,[Gn,Wn],(l,[t,s])=>{const c=l.properties()[t.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[cn,[Wn],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[cn,[Gn,Wn],(l,[t,s])=>{const c=l.properties()[t.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[cn,[Wn],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[cn,[Wn],(l,[t])=>t.value in l.properties()],"filter-has-id":[cn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[cn,[rr(Gn)],(l,[t])=>t.value.indexOf(l.geometryType())>=0],"filter-id-in":[cn,[rr(Wn)],(l,[t])=>t.value.indexOf(l.id())>=0],"filter-in-small":[cn,[Gn,rr(Wn)],(l,[t,s])=>s.value.indexOf(l.properties()[t.value])>=0],"filter-in-large":[cn,[Gn,rr(Wn)],(l,[t,s])=>function(c,p,h,m){for(;h<=m;){const x=h+m>>1;if(p[x]===c)return!0;p[x]>c?m=x-1:h=x+1}return!1}(l.properties()[t.value],s.value,0,s.value.length-1)],all:{type:cn,overloads:[[[cn,cn],(l,[t,s])=>t.evaluate(l)&&s.evaluate(l)],[Do(cn),(l,t)=>{for(const s of t)if(!s.evaluate(l))return!1;return!0}]]},any:{type:cn,overloads:[[[cn,cn],(l,[t,s])=>t.evaluate(l)||s.evaluate(l)],[Do(cn),(l,t)=>{for(const s of t)if(s.evaluate(l))return!0;return!1}]]},"!":[cn,[cn],(l,[t])=>!t.evaluate(l)],"is-supported-script":[cn,[Gn],(l,[t])=>{const s=l.globals&&l.globals.isSupportedScript;return!s||s(t.evaluate(l))}],upcase:[Gn,[Gn],(l,[t])=>t.evaluate(l).toUpperCase()],downcase:[Gn,[Gn],(l,[t])=>t.evaluate(l).toLowerCase()],concat:[Gn,Do(Wn),(l,t)=>t.map(s=>Sr(s.evaluate(l))).join("")],"resolved-locale":[Gn,[cu],(l,[t])=>t.evaluate(l).resolvedLocale()],random:[Wt,[Wt,Wt,Wn],(l,t)=>{const[s,c,p]=t.map(m=>m.evaluate(l));if(s>c||s===c)return s;let h;if(typeof p=="string")h=function(m){let x=0;if(m.length===0)return x;for(let T=0;T<m.length;T++)x=(x<<5)-x+m.charCodeAt(T),x|=0;return x}(p);else{if(typeof p!="number")throw new At(`Invalid seed input: ${p}`);h=p}return s+Vl(h)()*(c-s)}]});class Gl{constructor(t,s,c,p){this.expression=t,this._warningHistory={},this._evaluator=new uo(c,p),this._defaultValue=s?function(h){return h.type==="color"&&(Ss(h.default)||Array.isArray(h.default))?new ai(0,0,0,0):h.type==="color"?ai.parse(h.default)||null:h.default===void 0?null:h.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=Ta(t)}evaluateWithoutErrorHandling(t,s,c,p,h,m,x,T){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,p,h,m,x,T){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new At(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function yo(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Qo}function Oo(l,t,s,c){const p=new Xu(Qo,[],t?function(m){const x={color:is,string:Gn,number:Wt,enum:Gn,boolean:cn,formatted:Ll,resolvedImage:$a};return m.type==="array"?rr(x[m.value]||Wn,m.length):x[m.type]}(t):void 0,void 0,void 0,s,c),h=p.parse(l,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Oc(new Gl(h,t,s,c)):Ts(p.errors)}class La{constructor(t,s,c){this.kind=t,this._styleExpression=s,this.isLightConstant=c,this.isStateDependent=t!=="constant"&&!Qa(s.expression),this.configDependencies=Ta(s.expression)}evaluateWithoutErrorHandling(t,s,c,p,h,m){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,p,h,m)}evaluate(t,s,c,p,h,m){return this._styleExpression.evaluate(t,s,c,p,h,m)}}class ql{constructor(t,s,c,p,h){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Qa(s.expression),this.isLightConstant=h,this.configDependencies=Ta(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,s,c,p,h,m){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,p,h,m)}evaluate(t,s,c,p,h,m){return this._styleExpression.evaluate(t,s,c,p,h,m)}interpolationFactor(t,s,c){return this.interpolationType?fs.interpolationFactor(this.interpolationType,t,s,c):0}}function ia(l,t,s,c){if((l=Oo(l,t,s,c)).result==="error")return l;const p=l.value.expression,h=vu(p);if(!h&&!ea(t))return Ts([new Ki("","data expressions not supported")]);const m=Sa(p,["zoom","pitch","distance-from-center"]);if(!m&&!Su(t))return Ts([new Ki("","zoom expressions not supported")]);const x=Sa(p,["measure-light"]);if(!x&&!rc(t))return Ts([new Ki("","measure-light expression not supported")]);const T=Sa(p,["line-progress"]);if(!T&&!function(I){return Pa(I.expression,"line-progress")}(t))return Ts([new Ki("","line-progress expression not supported")]);const A=t.expression&&t.expression.relaxZoomRestriction,y=Mu(p);return y||m||A?y instanceof Ki?Ts([y]):y instanceof fs&&!ci(t)?Ts([new Ki("",'"interpolate" expressions cannot be used with this property')]):Oc(y?new ql(h&&T?"camera":"composite",l.value,y.labels,y instanceof fs?y.interpolation:void 0,x):new La(h&&T?"constant":"source",l.value,x)):Ts([new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class sl{constructor(t,s){this._parameters=t,this._specification=s,ya(this,ta(this._parameters,this._specification))}static deserialize(t){return new sl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Mu(l){let t=null;if(l instanceof Es)t=Mu(l.result);else if(l instanceof wu){for(const s of l.args)if(t=Mu(s),t)break}else(l instanceof Ca||l instanceof fs)&&l.input instanceof zr&&l.input.name==="zoom"&&(t=l);return t instanceof Ki||l.eachChild(s=>{const c=Mu(s);c instanceof Ki?t=c:t&&c&&t!==c&&(t=new Ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var oc,ac,hi=function(){if(ac)return oc;ac=1,oc=t;var l=3;function t(s,c,p){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(c=m[1])+2*(p=m[2]);for(var x=0;x<this.d*this.d;x++){var T=m[l+x],A=m[l+x+1];h.push(T===A?null:m.subarray(T,A))}var y=m[l+h.length+1];this.keys=m.subarray(m[l+h.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=c+2*p;for(var I=0;I<this.d*this.d;I++)h.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=s,this.padding=p,this.scale=c/s,this.uid=0;var M=p/c*s;this.min=-M,this.max=s+M}return t.prototype.insert=function(s,c,p,h,m){this._forEachCell(c,p,h,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(h),this.bboxes.push(m)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(s,c,p,h,m,x){this.cells[m].push(x)},t.prototype.query=function(s,c,p,h,m){var x=this.min,T=this.max;if(s<=x&&c<=x&&T<=p&&T<=h&&!m)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(s,c,p,h,this._queryCell,A,{},m),A},t.prototype._queryCell=function(s,c,p,h,m,x,T,A){var y=this.cells[m];if(y!==null)for(var I=this.keys,M=this.bboxes,E=0;E<y.length;E++){var C=y[E];if(T[C]===void 0){var L=4*C;(A?A(M[L+0],M[L+1],M[L+2],M[L+3]):s<=M[L+2]&&c<=M[L+3]&&p>=M[L+0]&&h>=M[L+1])?(T[C]=!0,x.push(I[C])):T[C]=!1}}},t.prototype._forEachCell=function(s,c,p,h,m,x,T,A){for(var y=this._convertToCellCoord(s),I=this._convertToCellCoord(c),M=this._convertToCellCoord(p),E=this._convertToCellCoord(h),C=y;C<=M;C++)for(var L=I;L<=E;L++){var k=this.d*L+C;if((!A||A(this._convertFromCellCoord(C),this._convertFromCellCoord(L),this._convertFromCellCoord(C+1),this._convertFromCellCoord(L+1)))&&m.call(this,s,c,p,h,k,x,T,A))return}},t.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},t.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,c=l+this.cells.length+1+1,p=0,h=0;h<this.cells.length;h++)p+=this.cells[h].length;var m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=c,T=0;T<s.length;T++){var A=s[T];m[l+T]=x,m.set(A,x),x+=A.length}return m[l+s.length]=x,m.set(this.keys,x),m[l+s.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer},oc}(),Xr=_e(hi);const al={};function Gt(l,t,s={}){Object.defineProperty(l,"_classRegistryKey",{value:t,writable:!1}),al[t]={klass:l,omit:s.omit||[]}}Gt(Object,"Object"),Xr.serialize=function(l,t){const s=l.toArrayBuffer();return t&&t.add(s),{buffer:s}},Xr.deserialize=function(l){return new Xr(l.buffer)},Object.defineProperty(Xr,"name",{value:"Grid"}),Gt(Xr,"Grid"),Gt(ai,"Color"),Gt(Error,"Error"),Gt(Nr,"Formatted"),Gt(Or,"FormattedSection"),Gt(Si,"AJAXError"),Gt($i,"ResolvedImage"),Gt(sl,"StylePropertyFunction"),Gt(Gl,"StyleExpression",{omit:["_evaluator"]}),Gt(ql,"ZoomDependentExpression"),Gt(La,"ZoomConstantExpression"),Gt(zr,"CompoundExpression",{omit:["_evaluate"]});for(const l in Qo)al[Qo[l]._classRegistryKey]||Gt(Qo[l],`Expression${l}`);function ll(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function ul(l){return self.ImageBitmap&&l instanceof ImageBitmap}function No(l,t){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(ll(l)||ul(l))return t&&t.add(l),l;if(ArrayBuffer.isView(l)){const s=l;return t&&t.add(s.buffer),s}if(l instanceof ImageData)return t&&t.add(l.data.buffer),l;if(Array.isArray(l)){const s=[];for(const c of l)s.push(No(c,t));return s}if(l instanceof Map){const s={$name:"Map"};for(const[c,p]of l.entries())s[c]=No(p);return s}if(l instanceof Set){const s={$name:"Set"};let c=0;for(const p of l.values())s[++c]=No(p);return s}if(typeof l=="object"){const s=l.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=s.serialize?s.serialize(l,t):{};if(!s.serialize){for(const h in l)l.hasOwnProperty(h)&&(al[c].omit.indexOf(h)>=0||(p[h]=No(l[h],t)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof l)}function os(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||ll(l)||ul(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(os);if(typeof l=="object"){const t=l.$name||"Object";if(t==="Map"){const p=new Map;for(const h of Object.keys(l))h!=="$name"&&p.set(h,os(l[h]));return p}if(t==="Set"){const p=new Set;for(const h of Object.keys(l))h!=="$name"&&p.add(os(l[h]));return p}const{klass:s}=al[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(l);const c=Object.create(s.prototype);for(const p of Object.keys(l))p!=="$name"&&(c[p]=os(l[p]));return c}throw new Error("can't deserialize object of type "+typeof l)}const Yt={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function cl(l){for(const t of l)if(hl(t.charCodeAt(0)))return!0;return!1}function Nc(l){for(const t of l)if(!lc(t.charCodeAt(0)))return!1;return!0}function lc(l){return!(Yt.Arabic(l)||Yt["Arabic Supplement"](l)||Yt["Arabic Extended-A"](l)||Yt["Arabic Presentation Forms-A"](l)||Yt["Arabic Presentation Forms-B"](l))}function hl(l){return!(l!==746&&l!==747&&(l<4352||!(Yt["Bopomofo Extended"](l)||Yt.Bopomofo(l)||Yt["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Yt["CJK Compatibility Ideographs"](l)||Yt["CJK Compatibility"](l)||Yt["CJK Radicals Supplement"](l)||Yt["CJK Strokes"](l)||!(!Yt["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Yt["CJK Unified Ideographs Extension A"](l)||Yt["CJK Unified Ideographs"](l)||Yt["Enclosed CJK Letters and Months"](l)||Yt["Hangul Compatibility Jamo"](l)||Yt["Hangul Jamo Extended-A"](l)||Yt["Hangul Jamo Extended-B"](l)||Yt["Hangul Jamo"](l)||Yt["Hangul Syllables"](l)||Yt.Hiragana(l)||Yt["Ideographic Description Characters"](l)||Yt.Kanbun(l)||Yt["Kangxi Radicals"](l)||Yt["Katakana Phonetic Extensions"](l)||Yt.Katakana(l)&&l!==12540||!(!Yt["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Yt["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Yt["Unified Canadian Aboriginal Syllabics"](l)||Yt["Unified Canadian Aboriginal Syllabics Extended"](l)||Yt["Vertical Forms"](l)||Yt["Yijing Hexagram Symbols"](l)||Yt["Yi Syllables"](l)||Yt["Yi Radicals"](l))))}function Ra(l){return!(hl(l)||function(t){return!!(Yt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Yt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Yt["Letterlike Symbols"](t)||Yt["Number Forms"](t)||Yt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Yt["Control Pictures"](t)&&t!==9251||Yt["Optical Character Recognition"](t)||Yt["Enclosed Alphanumerics"](t)||Yt["Geometric Shapes"](t)||Yt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Yt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Yt["CJK Symbols and Punctuation"](t)||Yt.Katakana(t)||Yt["Private Use Area"](t)||Yt["CJK Compatibility Forms"](t)||Yt["Small Form Variants"](t)||Yt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(l))}function Da(l){return l>=1424&&l<=2303||Yt["Arabic Presentation Forms-A"](l)||Yt["Arabic Presentation Forms-B"](l)}function uc(l,t){return!(!t&&Da(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Yt.Khmer(l))}function Au(l){for(const t of l)if(Da(t.charCodeAt(0)))return!0;return!1}const cc="deferred",Oa="loading",Ri="loaded";let wi=null,ar="unavailable",pi=null;const Pu=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(ar="error"),wi&&wi(l)};function hc(){Lu.fire(new Tr("pluginStateChange",{pluginStatus:ar,pluginURL:pi}))}const Lu=new lo,dl=function(){return ar},jl=function(){if(ar!==cc||!pi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ar=Oa,hc(),pi&&oo({url:pi},l=>{l?Pu(l):(ar=Ri,hc())})},nr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ar===Ri||nr.applyArabicShaping!=null,isLoading:()=>ar===Oa,setState(l){ar=l.pluginStatus,pi=l.pluginURL},isParsed:()=>nr.applyArabicShaping!=null&&nr.processBidirectionalText!=null&&nr.processStyledBidirectionalText!=null,getPluginURL:()=>pi};class Ui{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(s,c){for(const p of s)if(!uc(p.charCodeAt(0),c))return!1;return!0}(t,nr.isLoaded())}}class Hl{constructor(t,s,c,p){this.property=t,this.value=s,this.expression=function(h,m,x,T){if(Ss(h))return new sl(h,m);if(yo(h)||Array.isArray(h)&&h.length>0){const A=ia(h,m,x,T);if(A.result==="error")throw new Error(A.value.map(y=>`${y.key}: ${y.message}`).join(", "));return A.value}{let A=h;return typeof h=="string"&&m.type==="color"&&(A=ai.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}}(s===void 0?t.specification.default:s,t.specification,c,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class Ru{constructor(t,s,c){this.property=t,this.value=new Hl(t,void 0,s,c)}transitioned(t,s){return new fl(this.property,this.value,s,ir({},t.transition,this.transition),t.now)}untransitioned(){return new fl(this.property,this.value,null,{},0)}}class dc{constructor(t,s,c){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(t){return ro(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new Ru(this._values[t].property,this._scope,this._options)),this._values[t].value=new Hl(this._values[t].property,s===null?void 0:ro(s),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,s){s&&(this._options=s);const c=this._properties.properties;if(t)for(const p in t){const h=t[p];if(fr(p,"-transition")){const m=p.slice(0,-11);c[m]&&this.setTransition(m,h)}else c.hasOwnProperty(p)&&this.setValue(p,h)}}getTransition(t){return ro(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new Ru(this._values[t].property)),this._values[t].transition=ro(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const p=this.getTransition(s);p!==void 0&&(t[`${s}-transition`]=p)}return t}transitioned(t,s){const c=new Du(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(t,s._values[p]);return c}untransitioned(){const t=new Du(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class fl{constructor(t,s,c,p,h){const m=p.delay||0,x=p.duration||0;h=h||0,this.property=t,this.value=s,this.begin=h+m,this.end=this.begin+x,t.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const p=t.now||0,h=this.value.possiblyEvaluate(t,s,c),m=this.prior;if(m){if(p>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(p<this.begin)return m.possiblyEvaluate(t,s,c);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,s,c),h,_s(x))}}return h}}class Du{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const p=new Na(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(t,s,c);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class zc{constructor(t,s,c){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(t){return ro(this._values[t].value)}setValue(t,s){this._values[t]=new Hl(this._values[t].property,s===null?void 0:ro(s),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const p=new Na(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(t,s,c);return p}}class vo{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,p){return this.property.evaluate(this.value,this.parameters,t,s,c,p)}}class Na{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class It{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,c){const p=ks[this.specification.type];return p?p(t,s,c):t}}class Ht{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,p){return new vo(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,p)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new vo(this,{kind:"constant",value:void 0},t.parameters);const p=ks[this.specification.type];return p?new vo(this,{kind:"constant",value:p(t.value.value,s.value.value,c)},t.parameters):t}evaluate(t,s,c,p,h,m){return t.kind==="constant"?t.value:t.evaluate(s,c,p,h,m)}}class zo{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,p){return!!t.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class Ei{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new Ui(0,{});for(const c in t){const p=t[c];p.specification.overridable&&this.overridableProperties.push(c);const h=this.defaultPropertyValues[c]=new Hl(p,void 0),m=this.defaultTransitionablePropertyValues[c]=new Ru(p);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=h.possiblyEvaluate(s)}}}Gt(Ht,"DataDrivenProperty"),Gt(It,"DataConstantProperty"),Gt(zo,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Zl(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function ra(l){if(Array.isArray(l))return l.map(ra);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const t={};for(const s in l)t[s]=ra(l[s]);return t}return Zl(l)}function xo(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const t of l.slice(1))if(!xo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Fo(l,t="",s=null,c="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xo(l)||(l=eo(l));const p=l;let h=!0;try{h=function(y){if(!ko(y))return y;let I=ra(y);return Ks(I),I=bo(I),I}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let m=null,x=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){x=$e[`filter_${c}`];const y=Oo(h,x,t,s);if(y.result==="error")throw new Error(y.value.map(I=>`${I.key}: ${I.message}`).join(", "));m=(I,M,E)=>y.value.evaluate(I,M,{},E)}let T=null,A=null;if(h!==p){const y=Oo(p,x,t,s);if(y.result==="error")throw new Error(y.value.map(I=>`${I.key}: ${I.message}`).join(", "));T=(I,M,E,C,L)=>y.value.evaluate(I,M,{},E,void 0,void 0,C,L),A=!vu(y.value.expression)}return{filter:m,dynamicFilter:T||void 0,needGeometry:Qs(h),needFeature:!!A}}function bo(l){if(!Array.isArray(l))return l;const t=function(s){if(dd.has(s[0])){for(let c=1;c<s.length;c++)if(ko(s[c]))return!0}return s}(l);return t===!0?t:t.map(s=>bo(s))}function Ks(l){let t=!1;const s=[];if(l[0]==="case"){for(let c=1;c<l.length-1;c+=2)t=t||ko(l[c]),s.push(l[c+1]);s.push(l[l.length-1])}else if(l[0]==="match"){t=t||ko(l[1]);for(let c=2;c<l.length-1;c+=2)s.push(l[c+1]);s.push(l[l.length-1])}else if(l[0]==="step"){t=t||ko(l[1]);for(let c=1;c<l.length-1;c+=2)s.push(l[c+1])}t&&(l.length=0,l.push("any",...s));for(let c=1;c<l.length;c++)Ks(l[c])}function ko(l){if(!Array.isArray(l))return!1;if((t=l[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let s=1;s<l.length;s++)if(ko(l[s]))return!0;return!1}const dd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fd(l,t){return l<t?-1:l>t?1:0}function Qs(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let t=1;t<l.length;t++)if(Qs(l[t]))return!0;return!1}function eo(l){if(!l)return!0;const t=l[0];return l.length<=1?t!=="any":t==="=="?pl(l[1],l[2],"=="):t==="!="?Wl(pl(l[1],l[2],"==")):t==="<"||t===">"||t==="<="||t===">="?pl(l[1],l[2],t):t==="any"?(s=l.slice(1),["any"].concat(s.map(eo))):t==="all"?["all"].concat(l.slice(1).map(eo)):t==="none"?["all"].concat(l.slice(1).map(eo).map(Wl)):t==="in"?ch(l[1],l.slice(2)):t==="!in"?Wl(ch(l[1],l.slice(2))):t==="has"?Hs(l[1]):t!=="!has"||Wl(Hs(l[1]));var s}function pl(l,t,s){switch(l){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,l,t]}}function ch(l,t){if(t.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",l,["literal",t.sort(fd)]]:["filter-in-small",l,["literal",t]]}}function Hs(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Wl(l){return["!",l]}const fc="";function Fc(l,t){return t?`${l}${fc}${t}`:l}const Dh="-transition",sa=new Set(["fill","line","background","hillshade","raster"]);class Rs extends lo{constructor(t,s,c,p,h){if(super(),this.id=t.id,this.fqid=Fc(this.id,c),this.type=t.type,this.scope=c,this.lut=p,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const m=Oo(this.filter,$e[`filter_${t.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),s.layout&&(this._unevaluatedLayout=new zc(s.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new dc(s.paint,this.scope,h);for(const m in t.paint)this.setPaintProperty(m,t.paint[m]);for(const m in t.layout)this.setLayoutProperty(m,t.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Na(s.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D()&&sa.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s){if(this.type==="custom"&&t==="visibility")return void(this.visibility=s);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return fr(t,Dh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s){const c=this._transitionablePaint,p=c._properties.properties;if(fr(t,Dh)){const I=t.slice(0,-11);return p[I]&&c.setTransition(I,s||void 0),!1}if(!p[t])return!1;const h=c._values[t],m=h.value.isDataDriven(),x=h.value;c.setValue(t,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const T=c._values[t].value,A=T.isDataDriven(),y=fr(t,"pattern")||t==="line-dasharray";return A||m||y||this._handleOverridablePaintPropertyUpdate(t,x,T)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,s,c){return null}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){return Za({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,s)=>!(t===void 0||s==="layout"&&!Object.keys(t).length||s==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof vo&&ea(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=Fo(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,s,c,p,h,m,x,T,A){}queryIntersectsMatchingFeature(t,s,c,p){}}const Oh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cs{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ni{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ei(l,t=1){let s=0,c=0;return{members:l.map(p=>{const h=Oh[p.type].BYTES_PER_ELEMENT,m=s=Nh(s,Math.max(t,h)),x=p.components||1;return c=Math.max(c,h),s+=h*x,{name:p.name,type:p.type,components:x,offset:m}}),size:Nh(s,Math.max(c,t)),alignment:t}}function Nh(l,t){return Math.ceil(l/t)*t}class ml extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.int16[p+0]=s,this.int16[p+1]=c,t}}ml.prototype.bytesPerElement=4,Gt(ml,"StructArrayLayout2i4");class kc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const h=3*t;return this.int16[h+0]=s,this.int16[h+1]=c,this.int16[h+2]=p,t}}kc.prototype.bytesPerElement=6,Gt(kc,"StructArrayLayout3i6");class Ou extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,p)}emplace(t,s,c,p,h){const m=4*t;return this.int16[m+0]=s,this.int16[m+1]=c,this.int16[m+2]=p,this.int16[m+3]=h,t}}Ou.prototype.bytesPerElement=8,Gt(Ou,"StructArrayLayout4i8");class hh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,p,h)}emplace(t,s,c,p,h,m){const x=5*t;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=h,this.int16[x+4]=m,t}}hh.prototype.bytesPerElement=10,Gt(hh,"StructArrayLayout5i10");class pc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,p,h,m,x)}emplace(t,s,c,p,h,m,x,T){const A=6*t,y=12*t,I=3*t;return this.int16[A+0]=s,this.int16[A+1]=c,this.uint8[y+4]=p,this.uint8[y+5]=h,this.uint8[y+6]=m,this.uint8[y+7]=x,this.float32[I+2]=T,t}}pc.prototype.bytesPerElement=12,Gt(pc,"StructArrayLayout2i4ub1f12");class za extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,p)}emplace(t,s,c,p,h){const m=4*t;return this.float32[m+0]=s,this.float32[m+1]=c,this.float32[m+2]=p,this.float32[m+3]=h,t}}za.prototype.bytesPerElement=16,Gt(za,"StructArrayLayout4f16");class gl extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const h=3*t;return this.float32[h+0]=s,this.float32[h+1]=c,this.float32[h+2]=p,t}}gl.prototype.bytesPerElement=12,Gt(gl,"StructArrayLayout3f12");class Fa extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,p,h)}emplace(t,s,c,p,h,m){const x=6*t,T=3*t;return this.uint16[x+0]=s,this.uint16[x+1]=c,this.uint16[x+2]=p,this.uint16[x+3]=h,this.float32[T+2]=m,t}}Fa.prototype.bytesPerElement=12,Gt(Fa,"StructArrayLayout4ui1f12");class Bc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,p)}emplace(t,s,c,p,h){const m=4*t;return this.uint16[m+0]=s,this.uint16[m+1]=c,this.uint16[m+2]=p,this.uint16[m+3]=h,t}}Bc.prototype.bytesPerElement=8,Gt(Bc,"StructArrayLayout4ui8");class mc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,p,h,m)}emplace(t,s,c,p,h,m,x){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+3]=h,this.int16[T+4]=m,this.int16[T+5]=x,t}}mc.prototype.bytesPerElement=12,Gt(mc,"StructArrayLayout6i12");class Nu extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x,T,A,y,I,M){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,c,p,h,m,x,T,A,y,I,M)}emplace(t,s,c,p,h,m,x,T,A,y,I,M,E){const C=12*t;return this.int16[C+0]=s,this.int16[C+1]=c,this.int16[C+2]=p,this.int16[C+3]=h,this.uint16[C+4]=m,this.uint16[C+5]=x,this.uint16[C+6]=T,this.uint16[C+7]=A,this.int16[C+8]=y,this.int16[C+9]=I,this.int16[C+10]=M,this.int16[C+11]=E,t}}Nu.prototype.bytesPerElement=24,Gt(Nu,"StructArrayLayout4i4ui4i24");class dh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,p,h,m)}emplace(t,s,c,p,h,m,x){const T=10*t,A=5*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=p,this.float32[A+2]=h,this.float32[A+3]=m,this.float32[A+4]=x,t}}dh.prototype.bytesPerElement=20,Gt(dh,"StructArrayLayout3i3f20");class fh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}fh.prototype.bytesPerElement=4,Gt(fh,"StructArrayLayout1ul4");class e extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.uint16[p+0]=s,this.uint16[p+1]=c,t}}e.prototype.bytesPerElement=4,Gt(e,"StructArrayLayout2ui4");class r extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x,T,A,y,I,M,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,s,c,p,h,m,x,T,A,y,I,M,E)}emplace(t,s,c,p,h,m,x,T,A,y,I,M,E,C){const L=20*t,k=10*t;return this.int16[L+0]=s,this.int16[L+1]=c,this.int16[L+2]=p,this.int16[L+3]=h,this.int16[L+4]=m,this.float32[k+3]=x,this.float32[k+4]=T,this.float32[k+5]=A,this.float32[k+6]=y,this.int16[L+14]=I,this.uint32[k+8]=M,this.uint16[L+18]=E,this.uint16[L+19]=C,t}}r.prototype.bytesPerElement=40,Gt(r,"StructArrayLayout5i4f1i1ul2ui40");class u extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,p,h,m,x)}emplace(t,s,c,p,h,m,x,T){const A=8*t;return this.int16[A+0]=s,this.int16[A+1]=c,this.int16[A+2]=p,this.int16[A+4]=h,this.int16[A+5]=m,this.int16[A+6]=x,this.int16[A+7]=T,t}}u.prototype.bytesPerElement=16,Gt(u,"StructArrayLayout3i2i2i16");class g extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,p,h)}emplace(t,s,c,p,h,m){const x=4*t,T=8*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[T+6]=h,this.int16[T+7]=m,t}}g.prototype.bytesPerElement=16,Gt(g,"StructArrayLayout2f1f2i16");class w extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,p,h,m)}emplace(t,s,c,p,h,m,x){const T=20*t,A=5*t;return this.uint8[T+0]=s,this.uint8[T+1]=c,this.float32[A+1]=p,this.float32[A+2]=h,this.float32[A+3]=m,this.float32[A+4]=x,t}}w.prototype.bytesPerElement=20,Gt(w,"StructArrayLayout2ub4f20");class O extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,c)}emplace(t,s,c,p){const h=3*t;return this.uint16[h+0]=s,this.uint16[h+1]=c,this.uint16[h+2]=p,t}}O.prototype.bytesPerElement=6,Gt(O,"StructArrayLayout3ui6");class H extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V,j,Z,G,Y){const J=this.length;return this.resize(J+1),this.emplace(J,t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V,j,Z,G,Y)}emplace(t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V,j,Z,G,Y,J){const se=30*t,pe=15*t,ue=60*t;return this.int16[se+0]=s,this.int16[se+1]=c,this.int16[se+2]=p,this.float32[pe+2]=h,this.float32[pe+3]=m,this.uint16[se+8]=x,this.uint16[se+9]=T,this.uint32[pe+5]=A,this.uint32[pe+6]=y,this.uint32[pe+7]=I,this.uint16[se+16]=M,this.uint16[se+17]=E,this.uint16[se+18]=C,this.float32[pe+10]=L,this.float32[pe+11]=k,this.uint8[ue+48]=V,this.uint8[ue+49]=j,this.uint8[ue+50]=Z,this.uint32[pe+13]=G,this.int16[se+28]=Y,this.uint8[ue+58]=J,t}}H.prototype.bytesPerElement=60,Gt(H,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Q extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V,j,Z,G,Y,J,se,pe,ue,he,Le,ce,Me,Fe,ke,Ge){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V,j,Z,G,Y,J,se,pe,ue,he,Le,ce,Me,Fe,ke,Ge)}emplace(t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V,j,Z,G,Y,J,se,pe,ue,he,Le,ce,Me,Fe,ke,Ge,Xe){const Ye=20*t,Ze=40*t,ut=80*t;return this.float32[Ye+0]=s,this.float32[Ye+1]=c,this.int16[Ze+4]=p,this.int16[Ze+5]=h,this.int16[Ze+6]=m,this.int16[Ze+7]=x,this.int16[Ze+8]=T,this.int16[Ze+9]=A,this.int16[Ze+10]=y,this.int16[Ze+11]=I,this.int16[Ze+12]=M,this.uint16[Ze+13]=E,this.uint16[Ze+14]=C,this.uint16[Ze+15]=L,this.uint16[Ze+16]=k,this.uint16[Ze+17]=V,this.uint16[Ze+18]=j,this.uint16[Ze+19]=Z,this.uint16[Ze+20]=G,this.uint16[Ze+21]=Y,this.uint16[Ze+22]=J,this.uint16[Ze+23]=se,this.uint16[Ze+24]=pe,this.uint16[Ze+25]=ue,this.uint16[Ze+26]=he,this.uint16[Ze+27]=Le,this.uint32[Ye+14]=ce,this.float32[Ye+15]=Me,this.float32[Ye+16]=Fe,this.float32[Ye+17]=ke,this.float32[Ye+18]=Ge,this.uint8[ut+76]=Xe,t}}Q.prototype.bytesPerElement=80,Gt(Q,"StructArrayLayout2f9i15ui1ul4f1ub80");class ye extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}ye.prototype.bytesPerElement=4,Gt(ye,"StructArrayLayout1f4");class Ue extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,p,h)}emplace(t,s,c,p,h,m){const x=5*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=h,this.float32[x+4]=m,t}}Ue.prototype.bytesPerElement=20,Gt(Ue,"StructArrayLayout5f20");class ct extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,p,h,m,x)}emplace(t,s,c,p,h,m,x,T){const A=7*t;return this.float32[A+0]=s,this.float32[A+1]=c,this.float32[A+2]=p,this.float32[A+3]=h,this.float32[A+4]=m,this.float32[A+5]=x,this.float32[A+6]=T,t}}ct.prototype.bytesPerElement=28,Gt(ct,"StructArrayLayout7f28");class yt extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x,T,A,y,I){const M=this.length;return this.resize(M+1),this.emplace(M,t,s,c,p,h,m,x,T,A,y,I)}emplace(t,s,c,p,h,m,x,T,A,y,I,M){const E=11*t;return this.float32[E+0]=s,this.float32[E+1]=c,this.float32[E+2]=p,this.float32[E+3]=h,this.float32[E+4]=m,this.float32[E+5]=x,this.float32[E+6]=T,this.float32[E+7]=A,this.float32[E+8]=y,this.float32[E+9]=I,this.float32[E+10]=M,t}}yt.prototype.bytesPerElement=44,Gt(yt,"StructArrayLayout11f44");class Ft extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x,T,A){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,c,p,h,m,x,T,A)}emplace(t,s,c,p,h,m,x,T,A,y){const I=9*t;return this.float32[I+0]=s,this.float32[I+1]=c,this.float32[I+2]=p,this.float32[I+3]=h,this.float32[I+4]=m,this.float32[I+5]=x,this.float32[I+6]=T,this.float32[I+7]=A,this.float32[I+8]=y,t}}Ft.prototype.bytesPerElement=36,Gt(Ft,"StructArrayLayout9f36");class sn extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,p)}emplace(t,s,c,p,h){const m=6*t;return this.uint32[3*t+0]=s,this.uint16[m+2]=c,this.uint16[m+3]=p,this.uint16[m+4]=h,t}}sn.prototype.bytesPerElement=12,Gt(sn,"StructArrayLayout1ul3ui12");class Tn extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Tn.prototype.bytesPerElement=2,Gt(Tn,"StructArrayLayout1ui2");class Pn extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const p=2*t;return this.float32[p+0]=s,this.float32[p+1]=c,t}}Pn.prototype.bytesPerElement=8,Gt(Pn,"StructArrayLayout2f8");class Ai extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k){const V=this.length;return this.resize(V+1),this.emplace(V,t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k)}emplace(t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V){const j=16*t;return this.float32[j+0]=s,this.float32[j+1]=c,this.float32[j+2]=p,this.float32[j+3]=h,this.float32[j+4]=m,this.float32[j+5]=x,this.float32[j+6]=T,this.float32[j+7]=A,this.float32[j+8]=y,this.float32[j+9]=I,this.float32[j+10]=M,this.float32[j+11]=E,this.float32[j+12]=C,this.float32[j+13]=L,this.float32[j+14]=k,this.float32[j+15]=V,t}}Ai.prototype.bytesPerElement=64,Gt(Ai,"StructArrayLayout16f64");class er extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,p,h,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,p,h,m,x)}emplace(t,s,c,p,h,m,x,T){const A=10*t,y=5*t;return this.uint16[A+0]=s,this.uint16[A+1]=c,this.uint16[A+2]=p,this.uint16[A+3]=h,this.float32[y+2]=m,this.float32[y+3]=x,this.float32[y+4]=T,t}}er.prototype.bytesPerElement=20,Gt(er,"StructArrayLayout4ui3f20");class Ds extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.int16[1*t+0]=s,t}}Ds.prototype.bytesPerElement=2,Gt(Ds,"StructArrayLayout1i2");class oa extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint8[1*t+0]=s,t}}oa.prototype.bytesPerElement=1,Gt(oa,"StructArrayLayout1ub1");class gc extends Cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gc.prototype.size=40;class $l extends r{get(t){return new gc(this,t)}}Gt($l,"CollisionBoxArray");class _l extends Cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}_l.prototype.size=60;class pd extends H{get(t){return new _l(this,t)}}Gt(pd,"PlacedSymbolArray");class If extends Cs{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}If.prototype.size=80;class md extends Q{get(t){return new If(this,t)}}Gt(md,"SymbolInstanceArray");class Tf extends ye{getoffsetX(t){return this.float32[1*t+0]}}Gt(Tf,"GlyphOffsetArray");class zh extends ml{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Gt(zh,"SymbolLineVertexArray");class Sf extends Cs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Sf.prototype.size=12;class Cf extends sn{get(t){return new Sf(this,t)}}Gt(Cf,"FeatureIndexArray");class Mf extends e{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Gt(Mf,"FillExtrusionCentroidArray");class Af extends Cs{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Af.prototype.size=6;class gd extends kc{get(t){return new Af(this,t)}}Gt(gd,"FillExtrusionWallArray");const Yp=ei([{name:"a_pos",components:2,type:"Int16"}],4),Jp=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class lr{constructor(t=[]){this.segments=t}_prepareSegment(t,s,c,p){let h=this.segments[this.segments.length-1];return t>lr.MAX_VERTEX_ARRAY_LENGTH&&Xn(`Max vertices per segment is ${lr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!h||h.vertexLength+t>lr.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==p)&&(h={vertexOffset:s,primitiveOffset:c,vertexLength:0,primitiveLength:0},p!==void 0&&(h.sortKey=p),this.segments.push(h)),h}prepareSegment(t,s,c,p){return this._prepareSegment(t,s.length,c.length,p)}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,p){return new lr([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function Pf(l,t){return 256*(l=nn(Math.floor(l),0,255))+nn(Math.floor(t),0,255)}lr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt(lr,"SegmentVector");const Kp=ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Qp=ei([{name:"a_dash",components:4,type:"Uint16"}]);class ph{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,s,c,p){this.ids.push(Lf(t)),this.positions.push(s,c,p)}eachPosition(t,s){const c=Lf(t);let p=0,h=this.ids.length-1;for(;p<h;){const m=p+h>>1;this.ids[m]>=c?h=m:p=m+1}for(;this.ids[p]===c;)s(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(t,s){const c=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Vc(c,p,0,c.length-1),s&&(s.add(c.buffer),s.add(p.buffer)),{ids:c,positions:p}}static deserialize(t){const s=new ph;let c;s.ids=t.ids,s.positions=t.positions;for(const p of s.ids)p!==c&&s.uniqueIds.push(p),c=p;return s.indexed=!0,s}}function Lf(l){const t=+l;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:ns(String(l))}function Vc(l,t,s,c){for(;s<c;){const p=l[s+c>>1];let h=s-1,m=c+1;for(;;){do h++;while(l[h]<p);do m--;while(l[m]>p);if(h>=m)break;Fh(l,h,m),Fh(t,3*h,3*m),Fh(t,3*h+1,3*m+1),Fh(t,3*h+2,3*m+2)}m-s<c-m?(Vc(l,t,s,m),s=m+1):(Vc(l,t,m+1,c),c=m)}}function Fh(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}Gt(ph,"FeaturePositionMap");class Xl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,s),this.initialized=!0),!!this.location}set(t,s,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _c extends Xl{constructor(t){super(t),this.current=0}set(t,s,c){this.fetchUniformLocation(t,s)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Yr extends Xl{constructor(t){super(t),this.current=0}set(t,s,c){this.fetchUniformLocation(t,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class yl extends Xl{constructor(t){super(t),this.current=[0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class _d extends Xl{constructor(t){super(t),this.current=[0,0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class kh extends Xl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class yd extends Xl{constructor(t){super(t),this.current=ai.transparent.toRenderColor(null)}set(t,s,c){this.fetchUniformLocation(t,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Rf=new Float32Array(16);class mh extends Xl{constructor(t){super(t),this.current=Rf}set(t,s,c){if(this.fetchUniformLocation(t,s)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let p=1;p<16;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const em=new Float32Array(9),Df=new Float32Array(4);class Bh extends Xl{constructor(t){super(t),this.current=Df}set(t,s,c){if(this.fetchUniformLocation(t,s)){for(let p=0;p<4;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function vd(l){return[Pf(255*l.r,255*l.g),Pf(255*l.b,255*l.a)]}class gh{constructor(t,s,c,p){this.value=t,this.uniformNames=s.map(h=>`u_${h}`),this.type=c,this.context=p}setUniform(t,s,c,p,h){const m=p.constantOr(this.value);s.set(t,h,m instanceof ai?m.toRenderColor(this.context.lut):m)}getBinding(t,s){return this.type==="color"?new yd(t):new Yr(t)}}class Uc{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,s,c,p,h){const m=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;m&&s.set(t,h,m)}getBinding(t,s){return s==="u_pattern"||s==="u_dash"?new kh(t):new Yr(t)}}class Yl{constructor(t,s,c,p){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(h=>({name:`a_${h}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,s,c,p,h,m,x){const T=this.paintVertexArray.length,A=this.expression.evaluate(new Ui(0,{brightness:m}),s,{},h,p,x);this.paintVertexArray.resize(t),this._setPaintValue(T,t,A,this.context)}updatePaintArray(t,s,c,p,h,m,x){const T=this.expression.evaluate({zoom:0,brightness:x},c,p,void 0,h);this._setPaintValue(t,s,T,this.context)}_setPaintValue(t,s,c,p){if(this.type==="color"){const h=vd(c.toRenderColor(p.lut));for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=t;h<s;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ka{constructor(t,s,c,p,h,m){this.expression=t,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.context=h,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,s,c,p,h,m,x){const T=this.expression.evaluate(new Ui(this.context.zoom,{brightness:m}),s,{},h,p,x),A=this.expression.evaluate(new Ui(this.context.zoom+1,{brightness:m}),s,{},h,p,x),y=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(y,t,T,A,this.context)}updatePaintArray(t,s,c,p,h,m,x){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:x},c,p,void 0,h),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},c,p,void 0,h);this._setPaintValue(t,s,T,A,this.context)}_setPaintValue(t,s,c,p,h){if(this.type==="color"){const m=vd(c.toRenderColor(h.lut)),x=vd(c.toRenderColor(h.lut));for(let T=t;T<s;T++)this.paintVertexArray.emplace(T,m[0],m[1],x[0],x[1])}else{for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s,c,p,h){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=nn(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);s.set(t,h,x)}getBinding(t,s){return new Yr(t)}}class Jl{constructor(t,s,c,p,h){this.expression=t,this.layerId=h,this.paintVertexAttributes=(c==="array"?Qp:Kp).members;for(let m=0;m<s.length;++m);this.paintVertexArray=new p}populatePaintArray(t,s,c,p){const h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(h,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,p,h,m,x){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(t,s,c,p){if(!p||!c)return;const h=p[c];if(!h)return;const{tl:m,br:x,pixelRatio:T}=h;for(let A=t;A<s;A++)this.paintVertexArray.emplace(A,m[0],m[1],x[0],x[1],T)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kl{constructor(t,s,c=()=>!0){this.binders={},this._buffers=[],this.context=s;const p=[];for(const h in t.paint._values){const m=t.paint.get(h);if(!c(h)||!(m instanceof vo&&ea(m.property.specification)))continue;const x=nm(h,t.type),T=m.value,A=m.property.specification.type,y=!!m.property.useIntegerZoom,I=h==="line-dasharray"||h.endsWith("pattern"),M=h==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||M)if(T.kind==="source"||M||I){const E=Of(h,A,"source");this.binders[h]=I?new Jl(T,x,A,E,t.id):new Yl(T,x,A,E),p.push(`/a_${h}`)}else{const E=Of(h,A,"composite");this.binders[h]=new ka(T,x,A,y,s,E),p.push(`/z_${h}`)}else this.binders[h]=I?new Uc(T.value,x):new gh(T.value,x,A,s),p.push(`/u_${h}`)}this.cacheKey=p.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Yl||s instanceof ka?s.maxValue:0}populatePaintArrays(t,s,c,p,h,m,x){for(const T in this.binders){const A=this.binders[T];A.context=this.context,(A instanceof Yl||A instanceof ka||A instanceof Jl)&&A.populatePaintArray(t,s,c,p,h,m,x)}}setConstantPatternPositions(t){for(const s in this.binders){const c=this.binders[s];c instanceof Uc&&c.setConstantPatternPositions(t)}}updatePaintArrays(t,s,c,p,h,m,x,T){let A=!1;const y=Object.keys(t),I=y.length!==0,M=I?y:s.uniqueIds;this.context.lut=h.lut;for(const E in this.binders){const C=this.binders[E];if(C.context=this.context,(C instanceof Yl||C instanceof ka||C instanceof Jl)&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){const L=h.paint.get(E);C.expression=L.value;for(const k of M){const V=t[k.toString()];s.eachPosition(k,(j,Z,G)=>{const Y=p.feature(j);C.updatePaintArray(Z,G,Y,V,m,x,T)})}if(!I)for(const k of c.uniqueIds){const V=t[k.toString()];c.eachPosition(k,(j,Z,G)=>{const Y=p.feature(j);C.updatePaintArray(Z,G,Y,V,m,x,T)})}A=!0}}return A}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof gh||c instanceof Uc)&&t.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Yl||c instanceof ka||c instanceof Jl)for(let p=0;p<c.paintVertexAttributes.length;p++)t.push(c.paintVertexAttributes[p].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof gh||c instanceof Uc||c instanceof ka)for(const p of c.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const s=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof gh||p instanceof Uc||p instanceof ka)for(const h of p.uniformNames)s.push({name:h,property:c,binding:p.getBinding(t,h)})}return s}setUniforms(t,s,c,p,h){for(const{name:m,property:x,binding:T}of c)this.binders[x].setUniform(t,T,h,p.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const s=this.binders[t];(s instanceof Yl||s instanceof ka||s instanceof Jl)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof Yl||c instanceof ka||c instanceof Jl)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Yl||s instanceof ka||s instanceof Jl)&&s.destroy()}}}class vl{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Kl(p,s,c);this.needsUpload=!1,this._featureMap=new ph,this._featureMapWithoutIds=new ph,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,s,c,p,h,m,x,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(t,s,p,h,m,x,T);s.id!==void 0?this._featureMap.add(s.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,p,h,m){for(const x of c)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,s,x,p,h,m||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const tm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function nm(l,t){return tm[l]||[l.replace(`${t}-`,"").replace(/-/g,"_")]}const im={"line-pattern":{source:Fa,composite:Fa},"fill-pattern":{source:Fa,composite:Fa},"fill-extrusion-pattern":{source:Fa,composite:Fa},"line-dasharray":{source:Bc,composite:Bc}},rm={color:{source:Pn,composite:za},number:{source:ye,composite:Pn}};function Of(l,t,s){const c=im[l];return c&&c[s]||rm[t][s]}Gt(gh,"ConstantBinder"),Gt(Uc,"PatternConstantBinder"),Gt(Yl,"SourceExpressionBinder"),Gt(Jl,"PatternCompositeBinder"),Gt(ka,"CompositeExpressionBinder"),Gt(Kl,"ProgramConfiguration",{omit:["_buffers"]}),Gt(vl,"ProgramConfigurationSet");const Os=Mt/Math.PI/2,Nf=5,d=6,n=16383,o=64,f=[o,32,16],_=-Os,v=Os;function b(l,t,s,c=Os){return s=pn(s),[l*Math.sin(s)*c,-t*c,l*Math.cos(s)*c]}function P(l,t,s){return b(Math.cos(pn(l)),Math.sin(pn(l)),t,s)}const D=63710088e-1,B=2*Math.PI*D;class F{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new F(jo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,p=t.lat*s,h=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((t.lng-this.lng)*s);return D*Math.acos(Math.min(h,1))}toBounds(t=0){const s=360*t/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new U({lng:this.lng-c,lat:this.lat-s},{lng:this.lng+c,lat:this.lat+s})}toEcef(t){return P(this.lat,this.lng,Os+t*Os/D)}static convert(t){if(t instanceof F)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new F(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new F(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class U{constructor(t,s){if(t)if(s)this.setSouthWest(t).setNorthEast(s);else if(t.length===4){const c=t;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=t;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(t){return this._ne=t instanceof F?new F(t.lng,t.lat):F.convert(t),this}setSouthWest(t){return this._sw=t instanceof F?new F(t.lng,t.lat):F.convert(t),this}extend(t){const s=this._sw,c=this._ne;let p,h;if(t instanceof F)p=t,h=t;else{if(!(t instanceof U))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(U.convert(t)):this.extend(F.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(F.convert(t)):this;if(p=t._sw,h=t._ne,!p||!h)return this}return s||c?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),c.lng=Math.max(h.lng,c.lng),c.lat=Math.max(h.lat,c.lat)):(this._sw=new F(p.lng,p.lat),this._ne=new F(h.lng,h.lat)),this}getCenter(){return new F((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new F(this.getWest(),this.getNorth())}getSouthEast(){return new F(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:c}=F.convert(t);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(t){if(t)return t instanceof U?t:new U(t)}}const q=0,$=25.5;function ee(l){return B*Math.cos(l*Math.PI/180)}function K(l){return(180+l)/360}function re(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function ie(l,t){return l/ee(t)}function ae(l){return 360*l-180}function de(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function fe(l,t){return l*ee(de(t))}const be=85.051129;function Ee(l){return Math.cos(pn(nn(l,-be,be)))}function we(l,t){const s=nn(t,q,$),c=Math.pow(2,s);return Ee(l)*B/(512*c)}function Ie(l){return 1/Math.cos(l*Math.PI/180)}function Re(l,t=0){const s=Math.exp(Math.PI*(1-(l.y+t/Mt)/(1<<l.z)*2));return 80150034*s/(s*s+1)/Mt/(1<<l.z)}class Be{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=F.convert(t);return new Be(K(c.lng),re(c.lat),ie(s,c.lat))}toLngLat(){return new F(ae(this.x),de(this.y))}toAltitude(){return fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/B*Ie(de(this.y))}}function Ne(l,t,s,c,p,h,m,x,T){const A=(t+c)/2,y=(s+p)/2,I=new Lt(A,y);x(I),function(M,E,C,L,k,V){const j=C-k,Z=L-V;return Math.abs((L-E)*j-(C-M)*Z)/Math.hypot(j,Z)}(I.x,I.y,h.x,h.y,m.x,m.y)>=T?(Ne(l,t,s,A,y,h,I,x,T),Ne(l,A,y,c,p,I,m,x,T)):l.push(m)}function De(l,t,s){let c=l[0],p=c.x,h=c.y;t(c);const m=[c];for(let x=1;x<l.length;x++){const T=l[x],{x:A,y}=T;t(T),Ne(m,p,h,A,y,c,T,t,s),p=A,h=y,c=T}return m}function Je(l,t,s,c){if(c(t,s)){const p=t.add(s)._mult(.5);Je(l,t,p,c),Je(l,p,s,c)}else l.push(s)}function at(l,t){let s=l[0];const c=[s];for(let p=1;p<l.length;p++){const h=l[p];Je(c,s,h,t),s=h}return c}const vt=Math.pow(2,14)-1,St=-vt-1;function Pt(l,t){const s=Math.round(l.x*t),c=Math.round(l.y*t);return l.x=nn(s,St,vt),l.y=nn(c,St,vt),(s<l.x||s>l.x+1||c<l.y||c>l.y+1)&&Xn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function He(l,t,s){const c=l.loadGeometry(),p=l.extent,h=Mt/p;if(t&&s&&s.projection.isReprojectedInTileSpace){const m=1<<t.z,{scale:x,x:T,y:A,projection:y}=s,I=M=>{const E=ae((t.x+M.x/p)/m),C=de((t.y+M.y/p)/m),L=y.project(E,C);M.x=(L.x*x-T)*p,M.y=(L.y*x-A)*p};for(let M=0;M<c.length;M++)if(l.type!==1)c[M]=De(c[M],I,1);else{const E=[];for(const C of c[M])C.x<0||C.x>=p||C.y<0||C.y>=p||(I(C),E.push(C));c[M]=E}}for(const m of c)for(const x of m)Pt(x,h);return c}function gt(l,t){return{type:l.type,id:l.id,properties:l.properties,geometry:t?He(l):[]}}function rt(l,t,s,c,p){l.emplaceBack(2*t+(c+1)/2,2*s+(p+1)/2)}function _t(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class xt{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ml,this.indexArray=new O,this.segments=new lr,this.programConfigurations=new vl(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(t,s){}populate(t,s,c,p){const h=this.layers[0],m=[];let x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(const{feature:A,id:y,index:I,sourceLayerIndex:M}of t){const E=this.layers[0]._featureFilter.needGeometry,C=gt(A,E);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),C,c))continue;const L=x?x.evaluate(C,{},c):void 0,k={id:y,properties:A.properties,type:A.type,sourceLayerIndex:M,index:I,geometry:E?C.geometry:He(A,c,p),patterns:{},sortKey:L};m.push(k)}x&&m.sort((A,y)=>A.sortKey-y.sortKey);let T=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new mc,T=p.projection);for(const A of m){const{geometry:y,index:I,sourceLayerIndex:M}=A,E=t[I].feature;this.addFeature(A,y,I,s.availableImages,c,T,s.brightness),s.featureIndex.insert(E,y,I,M,this.index)}}update(t,s,c,p,h){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,s,m?this.stateDependentLayers:this.layers,c,p,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Jp.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,s,c,p,h,m,x){for(const T of s)for(const A of T){const y=A.x,I=A.y;if(y<0||y>=Mt||I<0||I>=Mt)continue;if(m){const C=m.projectTilePoint(y,I,h),L=m.upVector(h,y,I),k=this.globeExtVertexArray;_t(k,C,L),_t(k,C,L),_t(k,C,L),_t(k,C,L)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=M.vertexLength;rt(this.layoutVertexArray,y,I,-1,-1),rt(this.layoutVertexArray,y,I,1,-1),rt(this.layoutVertexArray,y,I,1,1),rt(this.layoutVertexArray,y,I,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},p,h,x)}}function mt(l,t){for(let s=0;s<l.length;s++)if(Hn(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Hn(l,t[s]))return!0;return!!Zt(l,t)}function Ot(l,t,s){return!!Hn(l,t)||!!Ut(t,l,s)}function Kt(l,t){if(l.length===1)return Cn(t,l[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let p=0;p<c.length;p++)if(Hn(l,c[p]))return!0}for(let s=0;s<l.length;s++)if(Cn(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Zt(l,t[s]))return!0;return!1}function on(l,t,s){if(l.length>1){if(Zt(l,t))return!0;for(let c=0;c<t.length;c++)if(Ut(t[c],l,s))return!0}for(let c=0;c<l.length;c++)if(Ut(l[c],t,s))return!0;return!1}function Zt(l,t){if(l.length===0||t.length===0)return!1;for(let s=0;s<l.length-1;s++){const c=l[s],p=l[s+1];for(let h=0;h<t.length-1;h++)if(un(c,p,t[h],t[h+1]))return!0}return!1}function un(l,t,s,c){return Ho(l,s,c)!==Ho(t,s,c)&&Ho(l,t,s)!==Ho(l,t,c)}function Ut(l,t,s){const c=s*s;if(t.length===1)return l.distSqr(t[0])<c;for(let p=1;p<t.length;p++)if(hn(l,t[p-1],t[p])<c)return!0;return!1}function hn(l,t,s){const c=t.distSqr(s);if(c===0)return l.distSqr(t);const p=((l.x-t.x)*(s.x-t.x)+(l.y-t.y)*(s.y-t.y))/c;return l.distSqr(p<0?t:p>1?s:s.sub(t)._mult(p)._add(t))}function Cn(l,t){let s,c,p,h=!1;for(let m=0;m<l.length;m++){s=l[m];for(let x=0,T=s.length-1;x<s.length;T=x++)c=s[x],p=s[T],c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(h=!h)}return h}function Hn(l,t){let s=!1;for(let c=0,p=l.length-1;c<l.length;p=c++){const h=l[c],m=l[p];h.y>t.y!=m.y>t.y&&t.x<(m.x-h.x)*(t.y-h.y)/(m.y-h.y)+h.x&&(s=!s)}return s}function Di(l,t,s,c,p){for(const m of l)if(t<=m.x&&s<=m.y&&c>=m.x&&p>=m.y)return!0;const h=[new Lt(t,s),new Lt(t,p),new Lt(c,p),new Lt(c,s)];if(l.length>2){for(const m of h)if(Hn(l,m))return!0}for(let m=0;m<l.length-1;m++)if(ti(l[m],l[m+1],h))return!0;return!1}function ti(l,t,s){const c=s[0],p=s[2];if(l.x<c.x&&t.x<c.x||l.x>p.x&&t.x>p.x||l.y<c.y&&t.y<c.y||l.y>p.y&&t.y>p.y)return!1;const h=Ho(l,t,s[0]);return h!==Ho(l,t,s[1])||h!==Ho(l,t,s[2])||h!==Ho(l,t,s[3])}function Bi(l,t,s,c,p,h){let m=t.y-l.y,x=l.x-t.x;if(h=h||0){const T=m*m+x*x;if(T===0)return!0;const A=Math.sqrt(T);m/=A,x/=A}return!((s.x-l.x)*m+(s.y-l.y)*x-h<0||(c.x-l.x)*m+(c.y-l.y)*x-h<0||(p.x-l.x)*m+(p.y-l.y)*x-h<0)}function di(l,t,s,c,p,h,m){return!(Bi(l,t,c,p,h,m)||Bi(t,s,c,p,h,m)||Bi(s,l,c,p,h,m)||Bi(c,p,l,t,s,m)||Bi(p,h,l,t,s,m)||Bi(h,c,l,t,s,m))}function Oi(l,t,s){const c=t.paint.get(l).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(l)}function kn(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Pi(l,t,s,c,p){if(!t[0]&&!t[1])return l;const h=Lt.convert(t)._mult(p);s==="viewport"&&h._rotate(-c);const m=[];for(let x=0;x<l.length;x++)m.push(l[x].sub(h));return m}function Ti(l,t,s,c){const p=Lt.convert(l)._mult(c);return t==="viewport"&&p._rotate(-s),p}let mi,qi;Gt(xt,"CircleBucket",{omit:["layers"]});var Br,Bo={exports:{}},aa=(Br||(Br=1,function(l,t){(function(s){function c(h,m,x){var T=p(256*h,256*(m=Math.pow(2,x)-m-1),x),A=p(256*(h+1),256*(m+1),x);return T[0]+","+T[1]+","+A[0]+","+A[1]}function p(h,m,x){var T=2*Math.PI*6378137/256/Math.pow(2,x);return[h*T-2*Math.PI*6378137/2,m*T-2*Math.PI*6378137/2]}s.getURL=function(h,m,x,T,A,y){return y=y||{},h+"?"+["bbox="+c(x,T,A),"format="+(y.format||"image/png"),"service="+(y.service||"WMS"),"version="+(y.version||"1.1.1"),"request="+(y.request||"GetMap"),"srs="+(y.srs||"EPSG:3857"),"width="+(y.width||256),"height="+(y.height||256),"layers="+m].join("&")},s.getTileBBox=c,s.getMercCoords=p,Object.defineProperty(s,"__esModule",{value:!0})})(t)}(0,Bo.exports)),Bo.exports);class Jr{constructor(t,s,c){this.z=t,this.x=s,this.y=c,this.key=fi(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s){const c=aa.getTileBBox(this.x,this.y,this.z),p=function(h,m,x){let T,A="";for(let y=h;y>0;y--)T=1<<y-1,A+=(m&T?1:0)+(x&T?2:0);return A}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kn{constructor(t,s){this.wrap=t,this.canonical=s,this.key=fi(t,s.z,s.z,s.x,s.y)}}class $n{constructor(t,s,c,p,h){this.overscaledZ=t,this.wrap=s,this.canonical=new Jr(c,+p,+h),this.key=s===0&&t===c?this.canonical.key:fi(s,t,c,p,h)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new $n(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $n(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return fi(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return fi(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new $n(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new $n(s,this.wrap,s,c,p),new $n(s,this.wrap,s,c+1,p),new $n(s,this.wrap,s,c,p+1),new $n(s,this.wrap,s,c+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new $n(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new $n(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fi(l,t,s,c,p){const h=1<<Math.min(s,22);let m=h*(p%h)+c%h;return l&&s<22&&(m+=h*h*((l<0?-2*l-1:2*l)%(1<<2*(22-s)))),16*(32*m+s)+(t-s)}const Ni=[l=>{let t=l.canonical.x-1,s=l.wrap;return t<0&&(t=(1<<l.canonical.z)-1,s--),new $n(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>{let t=l.canonical.x+1,s=l.wrap;return t===1<<l.canonical.z&&(t=0,s++),new $n(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>new $n(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new $n(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Gt(Jr,"CanonicalTileID"),Gt($n,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ur=ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ji}=ur,as=ei([{name:"a_pos_3",components:3,type:"Int16"}]);var xl=ei([{name:"a_pos",type:"Int16",components:2}]);class wo{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,c){const p=Ve.vec3.dot(s,this.dir);if(Math.abs(p)<1e-6)return!1;const h=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1]+(t[2]-this.pos[2])*s[2])/p;return c[0]=this.pos[0]+this.dir[0]*h,c[1]=this.pos[1]+this.dir[1]*h,c[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(t,s,c){if(Ve.vec3.equals(this.pos,t)||s===0)return c[0]=c[1]=c[2]=0,!1;const[p,h,m]=this.dir,x=this.pos[0]-t[0],T=this.pos[1]-t[1],A=this.pos[2]-t[2],y=p*p+h*h+m*m,I=2*(x*p+T*h+A*m),M=I*I-4*y*(x*x+T*T+A*A-s*s);if(M<0){const E=Math.max(-I/2,0),C=x+p*E,L=T+h*E,k=A+m*E,V=Math.hypot(C,L,k);return c[0]=C*s/V,c[1]=L*s/V,c[2]=k*s/V,!1}{const E=(-I-Math.sqrt(M))/(2*y);if(E<0){const C=Math.hypot(x,T,A);return c[0]=x*s/C,c[1]=T*s/C,c[2]=A*s/C,!1}return c[0]=x+p*E,c[1]=T+h*E,c[2]=A+m*E,!0}}}class Eo{constructor(t,s,c,p,h){this.TL=t,this.TR=s,this.BR=c,this.BL=p,this.horizon=h}static fromInvProjectionMatrix(t,s,c){const p=[-1,1,1],h=[1,1,1],m=[1,-1,1],x=[-1,-1,1],T=Ve.vec3.transformMat4(p,p,t),A=Ve.vec3.transformMat4(h,h,t),y=Ve.vec3.transformMat4(m,m,t),I=Ve.vec3.transformMat4(x,x,t);return new Eo(T,A,y,I,s/c)}}function la(l,t,s){let c=1/0,p=-1/0;const h=[];for(const m of l){Ve.vec3.sub(h,m,t);const x=Ve.vec3.dot(h,s);c=Math.min(c,x),p=Math.max(p,x)}return[c,p]}function Ba(l,t){let s=!0;for(let c=0;c<l.planes.length;c++){const p=l.planes[c];let h=0;for(let m=0;m<t.length;m++)h+=Ve.vec3.dot(p,t[m])+p[3]>=0;if(h===0)return 0;h!==t.length&&(s=!1)}return s?2:1}function Io(l,t){for(const s of l.projections){const c=la(t,l.points[0],s.axis);if(s.projection[1]<c[0]||s.projection[0]>c[1])return 0}return 1}function Ql(l,t){let s=0;const c=[0,0,0,0];for(let p=0;p<l.length;p++)c[0]=l[p][0],c[1]=l[p][1],c[2]=l[p][2],c[3]=1,Ve.vec4.dot(c,t)>=0&&s++;return s}class ua{constructor(t,s){this.points=t||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=_i.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ve.vec3.sub([],this.points[2],this.points[3]),Ve.vec3.sub([],this.points[0],this.points[3]),Ve.vec3.sub([],this.points[4],this.points[0]),Ve.vec3.sub([],this.points[5],this.points[1]),Ve.vec3.sub([],this.points[6],this.points[2]),Ve.vec3.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const p=[0,-c[2],c[1]],h=[c[2],0,-c[0]];this.projections.push({axis:p,projection:la(this.points,this.points[0],p)}),this.projections.push({axis:h,projection:la(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(t,s,c,p){const h=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const y=Ve.vec4.transformMat4([],A,t),I=1/y[3]/s*h;return Ve.vec4.mul(y,y,[I,I,p?1/y[3]:I,I])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const y=Ve.vec3.sub([],m[A[0]],m[A[1]]),I=Ve.vec3.sub([],m[A[2]],m[A[1]]),M=Ve.vec3.normalize([],Ve.vec3.cross([],y,I)),E=-Ve.vec3.dot(M,m[A[1]]);return M.concat(E)}),T=[];for(let A=0;A<m.length;A++)T.push([m[A][0],m[A][1],m[A][2]]);return new ua(T,x)}intersectsPrecise(t,s,c){for(let p=0;p<s.length;p++)if(!Ql(t,s[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Ql(t,this.planes[p]))return 0;for(const p of c)for(const h of this.frustumEdges){const m=Ve.vec3.cross([],p,h),x=Ve.vec3.length(m);if(x===0)continue;Ve.vec3.scale(m,m,1/x);const T=la(this.points,this.points[0],m),A=la(t,this.points[0],m);if(T[0]>A[1]||A[0]>T[1])return 0}return 1}containsPoint(t){for(const s of this.planes){const c=s[3];if(Ve.vec3.dot([s[0],s[1],s[2]],t)+c<0)return!1}return!0}}class _i{static fromPoints(t){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of t)Ve.vec3.min(s,s,p),Ve.vec3.max(c,c,p);return new _i(s,c)}static fromTileIdAndHeight(t,s,c){const p=1<<t.canonical.z,h=t.canonical.x,m=t.canonical.y;return new _i([h/p,m/p,s],[(h+1)/p,(m+1)/p,c])}static applyTransform(t,s){const c=t.getCorners();for(let p=0;p<c.length;++p)Ve.vec3.transformMat4(c[p],c[p],s);return _i.fromPoints(c)}static applyTransformFast(t,s){const c=[s[12],s[13],s[14]],p=[...c];for(let h=0;h<3;h++)for(let m=0;m<3;m++){const x=s[4*m+h],T=x*t.min[m],A=x*t.max[m];c[h]+=Math.min(T,A),p[h]+=Math.max(T,A)}return new _i(c,p)}static projectAabbCorners(t,s){const c=t.getCorners();for(let p=0;p<c.length;++p)Ve.vec3.transformMat4(c[p],c[p],s);return c}constructor(t,s){this.min=t,this.max=s,this.center=Ve.vec3.scale([],Ve.vec3.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=Ve.vec3.clone(this.min),p=Ve.vec3.clone(this.max);for(let h=0;h<s.length;h++)c[h]=s[h]?this.min[h]:this.center[h],p[h]=s[h]?this.center[h]:this.max[h];return p[2]=this.max[2],new _i(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Ba(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Ba(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,s){return s||this.intersects(t)?Io(t,this.getCorners()):0}intersectsPreciseFlat(t,s){return s||this.intersectsFlat(t)?Io(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let s=0;s<3;++s)if(this.min[s]>t.max[s]||t.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t.min[s]),this.max[s]=Math.max(this.max[s],t.max[s])}encapsulatePoint(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t[s]),this.max[s]=Math.max(this.max[s],t[s])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function Gc(l){return l*Os/D}Gt(_i,"Aabb");const xd=[new _i([_,_,_],[v,v,v]),new _i([_,_,_],[0,0,v]),new _i([0,_,_],[v,0,v]),new _i([_,0,_],[0,v,v]),new _i([0,0,_],[v,v,v])];function qc(l,t,s,c=!0){const p=Ve.vec3.scale([],l._camera.position,l.worldSize),h=[t,s,1,1];Ve.vec4.transformMat4(h,h,l.pixelMatrixInverse),Ve.vec4.scale(h,h,1/h[3]);const m=Ve.vec3.sub([],h,p),x=Ve.vec3.normalize([],m),T=l.globeMatrix,A=[T[12],T[13],T[14]],y=Ve.vec3.sub([],A,p),I=Ve.vec3.length(y),M=Ve.vec3.normalize([],y),E=l.worldSize/(2*Math.PI),C=Ve.vec3.dot(M,x),L=Math.asin(E/I);if(L<Math.acos(C)){if(!c)return null;const Le=[],ce=[];Ve.vec3.scale(Le,x,I/C),Ve.vec3.normalize(ce,Ve.vec3.sub(ce,Le,y)),Ve.vec3.normalize(x,Ve.vec3.add(x,y,Ve.vec3.scale(x,ce,Math.tan(L)*I)))}const k=[];new wo(p,x).closestPointOnSphere(A,E,k);const V=Ve.vec3.normalize([],pa(T,0)),j=Ve.vec3.normalize([],pa(T,1)),Z=Ve.vec3.normalize([],pa(T,2)),G=Ve.vec3.dot(V,k),Y=Ve.vec3.dot(j,k),J=Ve.vec3.dot(Z,k),se=Lr(Math.asin(-Y/E));let pe=Lr(Math.atan2(G,J));pe=l.center.lng+function(Le,ce){const Me=(ce-Le+180)%360-180;return Me<-180?Me+360:Me}(l.center.lng,pe);const ue=K(pe),he=nn(re(se),0,1);return new Be(ue,he)}class bd{constructor(t,s,c){this.a=Ve.vec3.sub([],t,c),this.b=Ve.vec3.sub([],s,c),this.center=c;const p=Ve.vec3.normalize([],this.a),h=Ve.vec3.normalize([],this.b);this.angle=Math.acos(Ve.vec3.dot(p,h))}}function _h(l,t){if(l.angle===0)return null;let s;return s=l.a[t]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[t]/l.a[t]/Math.sin(l.angle)-1/Math.tan(l.angle)),s<0||s>1?null:function(c,p,h,m){const x=Math.sin(h);return c*(Math.sin((1-m)*h)/x)+p*(Math.sin(m*h)/x)}(l.a[t],l.b[t],l.angle,nn(s,0,1))+l.center[t]}function zu(l){if(l.z<=1)return xd[l.z+2*l.y+l.x];const t=sm(zf(l));return _i.fromPoints(t)}function yc(l,t,s){return Ve.vec3.scale(l,l,1-s),Ve.vec3.scaleAndAdd(l,l,t,s)}function __(l,t,s){for(const c of l)Ve.vec3.transformMat4(c,c,t),Ve.vec3.scale(c,c,s)}function y_(l,t,s,c){const p=t/l.worldSize,h=l.globeMatrix;if(s.z<=1){const ue=zu(s).getCorners();return __(ue,h,p),_i.fromPoints(ue)}const m=zf(s,c),x=sm(m,Os+Gc(l._tileCoverLift));__(x,h,p);const T=Number.MAX_VALUE,A=[-T,-T,-T],y=[T,T,T];if(m.contains(l.center)){for(const Le of x)Ve.vec3.min(y,y,Le),Ve.vec3.max(A,A,Le);A[2]=0;const ue=l.point,he=[ue.x*p,ue.y*p,0];return Ve.vec3.min(y,y,he),Ve.vec3.max(A,A,he),new _i(y,A)}if(l._tileCoverLift>0){for(const ue of x)Ve.vec3.min(y,y,ue),Ve.vec3.max(A,A,ue);return new _i(y,A)}const I=[h[12]*p,h[13]*p,h[14]*p],M=m.getCenter(),E=nn(l.center.lat,-be,be),C=nn(M.lat,-be,be),L=K(l.center.lng),k=re(E);let V=L-K(M.lng);const j=k-re(C);V>.5?V-=1:V<-.5&&(V+=1);let Z=0;if(Math.abs(V)>Math.abs(j))Z=V>=0?1:3;else{Z=j>=0?0:2;const ue=[h[4]*p,h[5]*p,h[6]*p],he=-Math.sin(pn(j>=0?m.getSouth():m.getNorth()))*Os;Ve.vec3.scaleAndAdd(I,I,ue,he)}const G=x[Z],Y=x[(Z+1)%4],J=new bd(G,Y,I),se=[_h(J,0)||G[0],_h(J,1)||G[1],_h(J,2)||G[2]],pe=jc(l.zoom);if(pe>0){const ue=function({x:Le,y:ce,z:Me},Fe,ke,Ge,Xe){const Ye=1/(1<<Me);let Ze=Le*Ye,ut=Ze+Ye,Et=ce*Ye,ot=Et+Ye,jt=0;const Dt=(Ze+ut)/2-Ge;return Dt>.5?jt=-1:Dt<-.5&&(jt=1),Ze=((Ze+jt)*Fe-(Ge*=Fe))*ke+Ge,ut=((ut+jt)*Fe-Ge)*ke+Ge,Et=(Et*Fe-(Xe*=Fe))*ke+Xe,ot=(ot*Fe-Xe)*ke+Xe,[[Ze,ot,0],[ut,ot,0],[ut,Et,0],[Ze,Et,0]]}(s,t,l._pixelsPerMercatorPixel,L,k);for(let Le=0;Le<x.length;Le++)yc(x[Le],ue[Le],pe);const he=Ve.vec3.add([],ue[Z],ue[(Z+1)%4]);Ve.vec3.scale(he,he,.5),yc(se,he,pe)}for(const ue of x)Ve.vec3.min(y,y,ue),Ve.vec3.max(A,A,ue);return y[2]=Math.min(G[2],Y[2]),Ve.vec3.min(y,y,se),Ve.vec3.max(A,A,se),new _i(y,A)}function zf({x:l,y:t,z:s},c=!1){const p=1/(1<<s),h=new F(ae(l*p),t===(1<<s)-1&&c?-90:de((t+1)*p)),m=new F(ae((l+1)*p),t===0&&c?90:de(t*p));return new U(h,m)}function sm(l,t=Os){const s=pn(l.getNorth()),c=pn(l.getSouth()),p=Math.cos(s),h=Math.cos(c),m=Math.sin(s),x=Math.sin(c),T=l.getWest(),A=l.getEast();return[b(h,x,T,t),b(h,x,A,t),b(p,m,A,t),b(p,m,T,t)]}function wd(l,t,s,c){const p=1<<s.z,h=(l/Mt+s.x)/p;return P(de((t/Mt+s.y)/p),ae(h),c)}function Ff({min:l,max:t}){return n/Math.max(t[0]-l[0],t[1]-l[1],t[2]-l[2])}const v_=new Float64Array(16);function kf(l){const t=Ff(l),s=Ve.mat4.fromScaling(v_,[t,t,t]);return Ve.mat4.translate(s,s,Ve.vec3.negate([],l.min))}function om(l){const t=Ve.mat4.fromTranslation(v_,l.min),s=1/Ff(l);return Ve.mat4.scale(t,t,[s,s,s])}function am(l){const t=Mt/(2*Math.PI);return l/(2*Math.PI)/t}function x_(l,t){return Mt/(512*Math.pow(2,l))*Ff(zu(t))}function b_(l,t,s,c,p){const h=am(s),m=[l,t,-s/(2*Math.PI)],x=Ve.mat4.identity(new Float64Array(16));return Ve.mat4.translate(x,x,m),Ve.mat4.scale(x,x,[h,h,h]),Ve.mat4.rotateX(x,x,pn(-p)),Ve.mat4.rotateY(x,x,pn(-c)),x}function jc(l){return fa(Nf,d,l)}function w_(l,t){const s=P(t.lat,t.lng),c=function(h){const m=P(h._center.lat,h._center.lng),x=Ve.vec3.fromValues(0,1,0);let T=Ve.vec3.cross([],x,m);const A=Ve.mat4.fromRotation([],-h.angle,m);T=Ve.vec3.transformMat4(T,T,A),Ve.mat4.fromRotation(A,-h._pitch,T);const y=Ve.vec3.normalize([],m);return Ve.vec3.scale(y,y,Gc(h.cameraToCenterDistance/h.pixelsPerMeter)),Ve.vec3.transformMat4(y,y,A),Ve.vec3.add([],m,y)}(l),p=Ve.vec3.subtract([],c,s);return Ve.vec3.angle(p,s)}function lm(l,t){return w_(l,t)>Math.PI/2*1.01}const E_=pn(85),q1=Math.cos(E_),j1=Math.sin(E_),H1=Ve.mat4.create(),I_=l=>{const t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function T_(l,t,s,c,p,h,m,x,T){if(h&&l.queryGeometry.isAboveHorizon)return!1;h&&(T*=l.pixelToTileUnitsFactor);const A=l.tileID.canonical,y=s.projection.upVectorScale(A,s.center.lat,s.worldSize).metersToTile;for(const I of t)for(const M of I){const E=M.add(x),C=p&&s.elevation?s.elevation.exaggeration()*p.getElevationAt(E.x,E.y,!0):0,L=s.projection.projectTilePoint(E.x,E.y,A);if(C>0){const Z=s.projection.upVector(A,E.x,E.y);L.x+=Z[0]*y*C,L.y+=Z[1]*y*C,L.z+=Z[2]*y*C}const k=h?E:Z1(L.x,L.y,L.z,c),V=h?l.tilespaceRays.map(Z=>$1(Z,C)):l.queryGeometry.screenGeometry,j=Ve.vec4.transformMat4([],[L.x,L.y,L.z,1],c);if(!m&&h?T*=j[3]/s.cameraToCenterDistance:m&&!h&&(T*=s.cameraToCenterDistance/j[3]),h){const Z=de((M.y/Mt+A.y)/(1<<A.z));T/=s.projection.pixelsPerMeter(Z,1)/ie(1,Z)}if(Ot(V,k,T))return!0}return!1}function Z1(l,t,s,c){const p=Ve.vec4.transformMat4([],[l,t,s,1],c);return new Lt(p[0]/p[3],p[1]/p[3])}const S_=Ve.vec3.fromValues(0,0,0),W1=Ve.vec3.fromValues(0,0,1);function $1(l,t){const s=Ve.vec3.create();return S_[2]=t,l.intersectsPlane(S_,W1,s),new Lt(s[0],s[1])}class C_ extends xt{}let M_,A_,P_,L_;function R_(l,{width:t,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*s*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(t*s*c);return l.width=t,l.height=s,l.data=p,l}function D_(l,t,s){const{width:c,height:p}=t;c===l.width&&p===l.height||(um(l,t,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,c),height:Math.min(l.height,p)},s,null),l.width=c,l.height=p,l.data=t.data)}function um(l,t,s,c,p,h,m,x){if(p.width===0||p.height===0)return t;if(p.width>l.width||p.height>l.height||s.x>l.width-p.width||s.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||c.x>t.width-p.width||c.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const T=l.data,A=t.data,y=h===4&&x;for(let I=0;I<p.height;I++){const M=((s.y+I)*l.width+s.x)*h,E=((c.y+I)*t.width+c.x)*h;if(y)for(let C=0;C<p.width;C++){const L=M+C*h+3,k=E+C*h;A[k+0]=255,A[k+1]=255,A[k+2]=255,A[k+3]=T[L]}else if(m)for(let C=0;C<p.width;C++){const L=M+C*h,k=E+C*h,V=T[L+3],j=new ai(T[L+0]/255*V,T[L+1]/255*V,T[L+2]/255*V,V).toRenderColor(m).toArray();A[k+0]=j[0],A[k+1]=j[1],A[k+2]=j[2],A[k+3]=j[3]}else for(let C=0;C<p.width*h;C++)A[E+C]=T[M+C]}return t}Gt(C_,"HeatmapBucket",{omit:["layers"]});class Hc{constructor(t,s){R_(this,t,1,s)}resize(t){D_(this,new Hc(t),1)}clone(){return new Hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,p,h){um(t,s,c,p,h,1,null)}}class to{constructor(t,s){R_(this,t,4,s)}resize(t){D_(this,new to(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new to({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,p,h,m,x){um(t,s,c,p,h,4,m,x)}}class O_{constructor(t,s){this.width=t.width,this.height=t.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function Ed(l){const t={},s=l.resolution||256,c=l.clips?l.clips.length:1,p=l.image||new to({width:s,height:c}),h=(m,x,T)=>{t[l.evaluationKey]=T;const A=l.expression.evaluate(t);A&&(p.data[m+x+0]=Math.floor(255*A.r/A.a),p.data[m+x+1]=Math.floor(255*A.g/A.a),p.data[m+x+2]=Math.floor(255*A.b/A.a),p.data[m+x+3]=Math.floor(255*A.a))};if(l.clips)for(let m=0,x=0;m<c;++m,x+=4*s)for(let T=0,A=0;T<s;T++,A+=4){const y=T/(s-1),{start:I,end:M}=l.clips[m];h(x,A,I*(1-y)+M*y)}else for(let m=0,x=0;m<s;m++,x+=4)h(0,x,m/(s-1));return p}Gt(Hc,"AlphaImage"),Gt(to,"RGBAImage");const X1=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:Y1}=X1;function Id(l,t,s=2){const c=t&&t.length,p=c?t[0]*s:l.length;let h=N_(l,0,p,s,!0);const m=[];if(!h||h.next===h.prev)return m;let x,T,A;if(c&&(h=function(y,I,M,E){const C=[];for(let L=0,k=I.length;L<k;L++){const V=N_(y,I[L]*E,L<k-1?I[L+1]*E:y.length,E,!1);V===V.next&&(V.steiner=!0),C.push(rb(V))}C.sort(tb);for(let L=0;L<C.length;L++)M=nb(C[L],M);return M}(l,t,h,s)),l.length>80*s){x=1/0,T=1/0;let y=-1/0,I=-1/0;for(let M=s;M<p;M+=s){const E=l[M],C=l[M+1];E<x&&(x=E),C<T&&(T=C),E>y&&(y=E),C>I&&(I=C)}A=Math.max(y-x,I-T),A=A!==0?32767/A:0}return Td(h,m,s,x,T,A,0),m}function N_(l,t,s,c,p){let h;if(p===function(m,x,T,A){let y=0;for(let I=x,M=T-A;I<T;I+=A)y+=(m[M]-m[I])*(m[I+1]+m[M+1]),M=I;return y}(l,t,s,c)>0)for(let m=t;m<s;m+=c)h=k_(m/c|0,l[m],l[m+1],h);else for(let m=s-c;m>=t;m-=c)h=k_(m/c|0,l[m],l[m+1],h);return h&&Bf(h,h.next)&&(Cd(h),h=h.next),h}function yh(l,t){if(!l)return l;t||(t=l);let s,c=l;do if(s=!1,c.steiner||!Bf(c,c.next)&&Kr(c.prev,c,c.next)!==0)c=c.next;else{if(Cd(c),c=t=c.prev,c===c.next)break;s=!0}while(s||c!==t);return t}function Td(l,t,s,c,p,h,m){if(!l)return;!m&&h&&function(T,A,y,I){let M=T;do M.z===0&&(M.z=cm(M.x,M.y,A,y,I)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==T);M.prevZ.nextZ=null,M.prevZ=null,function(E){let C,L=1;do{let k,V=E;E=null;let j=null;for(C=0;V;){C++;let Z=V,G=0;for(let J=0;J<L&&(G++,Z=Z.nextZ,Z);J++);let Y=L;for(;G>0||Y>0&&Z;)G!==0&&(Y===0||!Z||V.z<=Z.z)?(k=V,V=V.nextZ,G--):(k=Z,Z=Z.nextZ,Y--),j?j.nextZ=k:E=k,k.prevZ=j,j=k;V=Z}j.nextZ=null,L*=2}while(C>1)}(M)}(l,c,p,h);let x=l;for(;l.prev!==l.next;){const T=l.prev,A=l.next;if(h?K1(l,c,p,h):J1(l))t.push(T.i,l.i,A.i),Cd(l),l=A.next,x=A.next;else if((l=A)===x){m?m===1?Td(l=Q1(yh(l),t),t,s,c,p,h,2):m===2&&eb(l,t,s,c,p,h):Td(yh(l),t,s,c,p,h,1);break}}}function J1(l){const t=l.prev,s=l,c=l.next;if(Kr(t,s,c)>=0)return!1;const p=t.x,h=s.x,m=c.x,x=t.y,T=s.y,A=c.y,y=p<h?p<m?p:m:h<m?h:m,I=x<T?x<A?x:A:T<A?T:A,M=p>h?p>m?p:m:h>m?h:m,E=x>T?x>A?x:A:T>A?T:A;let C=c.next;for(;C!==t;){if(C.x>=y&&C.x<=M&&C.y>=I&&C.y<=E&&Vh(p,x,h,T,m,A,C.x,C.y)&&Kr(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function K1(l,t,s,c){const p=l.prev,h=l,m=l.next;if(Kr(p,h,m)>=0)return!1;const x=p.x,T=h.x,A=m.x,y=p.y,I=h.y,M=m.y,E=x<T?x<A?x:A:T<A?T:A,C=y<I?y<M?y:M:I<M?I:M,L=x>T?x>A?x:A:T>A?T:A,k=y>I?y>M?y:M:I>M?I:M,V=cm(E,C,t,s,c),j=cm(L,k,t,s,c);let Z=l.prevZ,G=l.nextZ;for(;Z&&Z.z>=V&&G&&G.z<=j;){if(Z.x>=E&&Z.x<=L&&Z.y>=C&&Z.y<=k&&Z!==p&&Z!==m&&Vh(x,y,T,I,A,M,Z.x,Z.y)&&Kr(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,G.x>=E&&G.x<=L&&G.y>=C&&G.y<=k&&G!==p&&G!==m&&Vh(x,y,T,I,A,M,G.x,G.y)&&Kr(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;Z&&Z.z>=V;){if(Z.x>=E&&Z.x<=L&&Z.y>=C&&Z.y<=k&&Z!==p&&Z!==m&&Vh(x,y,T,I,A,M,Z.x,Z.y)&&Kr(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;G&&G.z<=j;){if(G.x>=E&&G.x<=L&&G.y>=C&&G.y<=k&&G!==p&&G!==m&&Vh(x,y,T,I,A,M,G.x,G.y)&&Kr(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function Q1(l,t){let s=l;do{const c=s.prev,p=s.next.next;!Bf(c,p)&&z_(c,s,s.next,p)&&Sd(c,p)&&Sd(p,c)&&(t.push(c.i,s.i,p.i),Cd(s),Cd(s.next),s=l=p),s=s.next}while(s!==l);return yh(s)}function eb(l,t,s,c,p,h){let m=l;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&sb(m,x)){let T=F_(m,x);return m=yh(m,m.next),T=yh(T,T.next),Td(m,t,s,c,p,h,0),void Td(T,t,s,c,p,h,0)}x=x.next}m=m.next}while(m!==l)}function tb(l,t){return l.x-t.x}function nb(l,t){const s=function(p,h){let m=h;const x=p.x,T=p.y;let A,y=-1/0;do{if(T<=m.y&&T>=m.next.y&&m.next.y!==m.y){const L=m.x+(T-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(L<=x&&L>y&&(y=L,A=m.x<m.next.x?m:m.next,L===x))return A}m=m.next}while(m!==h);if(!A)return null;const I=A,M=A.x,E=A.y;let C=1/0;m=A;do{if(x>=m.x&&m.x>=M&&x!==m.x&&Vh(T<E?x:y,T,M,E,T<E?y:x,T,m.x,m.y)){const L=Math.abs(T-m.y)/(x-m.x);Sd(m,p)&&(L<C||L===C&&(m.x>A.x||m.x===A.x&&ib(A,m)))&&(A=m,C=L)}m=m.next}while(m!==I);return A}(l,t);if(!s)return t;const c=F_(s,l);return yh(c,c.next),yh(s,s.next)}function ib(l,t){return Kr(l.prev,l,t.prev)<0&&Kr(t.next,l,l.next)<0}function cm(l,t,s,c,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function rb(l){let t=l,s=l;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==l);return s}function Vh(l,t,s,c,p,h,m,x){return(p-m)*(t-x)>=(l-m)*(h-x)&&(l-m)*(c-x)>=(s-m)*(t-x)&&(s-m)*(h-x)>=(p-m)*(c-x)}function sb(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!function(s,c){let p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&z_(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(l,t)&&(Sd(l,t)&&Sd(t,l)&&function(s,c){let p=s,h=!1;const m=(s.x+c.x)/2,x=(s.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&m<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(h=!h),p=p.next;while(p!==s);return h}(l,t)&&(Kr(l.prev,l,t.prev)||Kr(l,t.prev,t))||Bf(l,t)&&Kr(l.prev,l,l.next)>0&&Kr(t.prev,t,t.next)>0)}function Kr(l,t,s){return(t.y-l.y)*(s.x-t.x)-(t.x-l.x)*(s.y-t.y)}function Bf(l,t){return l.x===t.x&&l.y===t.y}function z_(l,t,s,c){const p=Uf(Kr(l,t,s)),h=Uf(Kr(l,t,c)),m=Uf(Kr(s,c,l)),x=Uf(Kr(s,c,t));return p!==h&&m!==x||!(p!==0||!Vf(l,s,t))||!(h!==0||!Vf(l,c,t))||!(m!==0||!Vf(s,l,c))||!(x!==0||!Vf(s,t,c))}function Vf(l,t,s){return t.x<=Math.max(l.x,s.x)&&t.x>=Math.min(l.x,s.x)&&t.y<=Math.max(l.y,s.y)&&t.y>=Math.min(l.y,s.y)}function Uf(l){return l>0?1:l<0?-1:0}function Sd(l,t){return Kr(l.prev,l,l.next)<0?Kr(l,t,l.next)>=0&&Kr(l,l.prev,t)>=0:Kr(l,t,l.prev)<0||Kr(l,l.next,t)<0}function F_(l,t){const s=hm(l.i,l.x,l.y),c=hm(t.i,t.x,t.y),p=l.next,h=t.prev;return l.next=t,t.prev=l,s.next=p,p.prev=s,c.next=s,s.prev=c,h.next=c,c.prev=h,c}function k_(l,t,s,c){const p=hm(l,t,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Cd(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function hm(l,t,s){return{i:l,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Gf(l,t){const s=l.length;if(s<=1)return[l];const c=[];let p,h;for(let m=0;m<s;m++){const x=Ic(l[m]);x!==0&&(l[m].area=Math.abs(x),h===void 0&&(h=x<0),h===x<0?(p&&c.push(p),p=[l[m]]):p.push(l[m]))}if(p&&c.push(p),t>1)for(let m=0;m<c.length;m++)c[m].length<=t||(ju(c[m],t,1,c[m].length-1,ob),c[m]=c[m].slice(0,t));return c}function ob(l,t){return t.area-l.area}function dm(l,t,s){const c=s.patternDependencies;let p=!1;for(const h of t){const m=h.paint.get(`${l}-pattern`);m.isConstant()||(p=!0);const x=m.constantOr(null);x&&(p=!0,c[x]=!0)}return p}function fm(l,t,s,c,p){const h=p.patternDependencies;for(const m of t){const x=m.paint.get(`${l}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:c},s,{},p.availableImages);T=T&&T.name?T.name:T,h[T]=!0,s.patterns[m.id]=T}}return s}class pm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ml,this.indexArray=new O,this.indexArray2=new e,this.programConfigurations=new vl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new lr,this.segments2=new lr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection}updateFootprints(t,s){}populate(t,s,c,p){this.hasPattern=dm("fill",this.layers,s);const h=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:T,index:A,sourceLayerIndex:y}of t){const I=this.layers[0]._featureFilter.needGeometry,M=gt(x,I);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),M,c))continue;const E=h?h.evaluate(M,{},c,s.availableImages):void 0,C={id:T,properties:x.properties,type:x.type,sourceLayerIndex:y,index:A,geometry:I?M.geometry:He(x,c,p),patterns:{},sortKey:E};m.push(C)}h&&m.sort((x,T)=>x.sortKey-T.sortKey);for(const x of m){const{geometry:T,index:A,sourceLayerIndex:y}=x;if(this.hasPattern){const I=fm("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(I)}else this.addFeature(x,T,A,c,{},s.availableImages,s.brightness);s.featureIndex.insert(t[A].feature,T,A,y,this.index)}}update(t,s,c,p,h){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,s,m?this.stateDependentLayers:this.layers,c,p,h)}addFeatures(t,s,c,p,h,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Y1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,p,h,m=[],x){for(const T of Gf(s,500)){let A=0;for(const L of T)A+=L.length;const y=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),I=y.vertexLength,M=[],E=[];for(const L of T){if(L.length===0)continue;L!==T[0]&&E.push(M.length/2);const k=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),V=k.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(V+L.length-1,V),M.push(L[0].x),M.push(L[0].y);for(let j=1;j<L.length;j++)this.layoutVertexArray.emplaceBack(L[j].x,L[j].y),this.indexArray2.emplaceBack(V+j-1,V+j),M.push(L[j].x),M.push(L[j].y);k.vertexLength+=L.length,k.primitiveLength+=L.length}const C=Id(M,E);for(let L=0;L<C.length;L+=3)this.indexArray.emplaceBack(I+C[L],I+C[L+1],I+C[L+2]);y.vertexLength+=A,y.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,m,p,x)}}let B_,V_,U_,G_;Gt(pm,"FillBucket",{omit:["layers","patternFeatures"]});class mm{constructor(t,s,c,p){if(this.triangleCount=s.length/3,this.min=new Lt(0,0),this.max=new Lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[h,m]=[t[0].clone(),t[0].clone()];for(let I=1;I<t.length;++I){const M=t[I];h.x=Math.min(h.x,M.x),h.y=Math.min(h.y,M.y),m.x=Math.max(m.x,M.x),m.y=Math.max(m.y,M.y)}if(p){const I=Math.ceil(Math.max(m.x-h.x,m.y-h.y)/p);c=Math.max(c,I)}if(c===0)return;this.min=h,this.max=m;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const T=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/T)),this.cellsY=Math.max(1,Math.ceil(x.y/T)),this.xScale=1/T,this.yScale=1/T;const A=[];for(let I=0;I<this.triangleCount;I++){const M=t[s[3*I+0]].sub(this.min),E=t[s[3*I+1]].sub(this.min),C=t[s[3*I+2]].sub(this.min),L=Fu(Math.floor(Math.min(M.x,E.x,C.x)),this.xScale,this.cellsX),k=Fu(Math.floor(Math.max(M.x,E.x,C.x)),this.xScale,this.cellsX),V=Fu(Math.floor(Math.min(M.y,E.y,C.y)),this.yScale,this.cellsY),j=Fu(Math.floor(Math.max(M.y,E.y,C.y)),this.yScale,this.cellsY),Z=new Lt(0,0),G=new Lt(0,0),Y=new Lt(0,0),J=new Lt(0,0);for(let se=V;se<=j;++se){Z.y=G.y=se*T,Y.y=J.y=(se+1)*T;for(let pe=L;pe<=k;++pe)Z.x=Y.x=pe*T,G.x=J.x=(pe+1)*T,(di(M,E,C,Z,G,J)||di(M,E,C,Z,J,Y))&&A.push({cellIdx:se*this.cellsX+pe,triIdx:I})}}if(A.length===0)return;A.sort((I,M)=>I.cellIdx-M.cellIdx||I.triIdx-M.triIdx);let y=0;for(;y<A.length;){const I=A[y].cellIdx,M={start:this.payload.length,len:0};for(;y<A.length&&A[y].cellIdx===I;)++M.len,this.payload.push(A[y++].triIdx);this.cells[I]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,s){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=Fu(t.x-this.min.x,this.xScale,this.cellsX),p=Fu(t.y-this.min.y,this.yScale,this.cellsY),h=this.cells[p*this.cellsX+c];if(h){this._lazyInitLookup();for(let m=0;m<h.len;m++){const x=this.payload[h.start+m],T=Math.floor(x/8),A=1<<x%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,s.push(x),s.length===this.triangleCount))return}}}query(t,s,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>s.x||t.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const p=Fu(t.x-this.min.x,this.xScale,this.cellsX),h=Fu(s.x-this.min.x,this.xScale,this.cellsX),m=Fu(t.y-this.min.y,this.yScale,this.cellsY),x=Fu(s.y-this.min.y,this.yScale,this.cellsY);for(let T=m;T<=x;T++)for(let A=p;A<=h;A++){const y=this.cells[T*this.cellsX+A];if(y)for(let I=0;I<y.len;I++){const M=this.payload[y.start+I],E=Math.floor(M/8),C=1<<M%8;if(!(this.lookup[E]&C)&&(this.lookup[E]|=C,c.push(M),c.length===this.triangleCount))return}}}}function Fu(l,t,s){return Math.max(0,Math.min(s-1,Math.floor(l*t)))}Gt(mm,"TriangleGridIndex");class q_{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(t,s){for(const c of this.footprints)s.push({footprint:c,id:t})}populate(t,s,c,p){const h=[];for(const{feature:m,id:x,index:T,sourceLayerIndex:A}of t){const y=this.layers[0]._featureFilter.needGeometry,I=gt(m,y);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),I,c))continue;const M={id:x,properties:m.properties,type:m.type,sourceLayerIndex:A,index:T,geometry:y?I.geometry:He(m,c,p),patterns:{}};h.push(M)}for(const m of h){const{geometry:x,index:T,sourceLayerIndex:A}=m;this.addFeature(m,x,T,c,{},s.availableImages,s.brightness),s.featureIndex.insert(t[T].feature,x,T,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,s,c,p,h){}destroy(){}addFeature(t,s,c,p,h,m=[],x){for(const T of Gf(s,2)){const A=[],y=[],I=[],M=new Lt(1/0,1/0),E=new Lt(-1/0,-1/0);for(const k of T)if(k.length!==0){k!==T[0]&&I.push(y.length/2);for(let V=0;V<k.length;V++)y.push(k[V].x),y.push(k[V].y),A.push(k[V]),M.x=Math.min(M.x,k[V].x),M.y=Math.min(M.y,k[V].y),E.x=Math.max(E.x,k[V].x),E.y=Math.max(E.y,k[V].y)}const C=Id(y,I),L=new mm(A,C,8,256);this.footprints.push({vertices:A,indices:C,grid:L,min:M,max:E})}}}Gt(q_,"ClipBucket",{omit:["layers"]});const ab=ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),lb=ei([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ub=ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cb=ei([{name:"a_join_normal_inside",components:3,type:"Int16"}]),hb=ei([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),db=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:fb}=ab;var gm,j_,_m,H_,ym,Z_,W_,qf={};function $_(){if(j_)return gm;j_=1;var l=Tl();function t(p,h,m,x,T){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=x,this._values=T,p.readFields(s,this,h)}function s(p,h,m){p==1?h.id=m.readVarint():p==2?function(x,T){for(var A=x.readVarint()+x.pos;x.pos<A;){var y=T._keys[x.readVarint()],I=T._values[x.readVarint()];T.properties[y]=I}}(m,h):p==3?h.type=m.readVarint():p==4&&(h._geometry=m.pos)}function c(p){for(var h,m,x=0,T=0,A=p.length,y=A-1;T<A;y=T++)x+=((m=p[y]).x-(h=p[T]).x)*(h.y+m.y);return x}return gm=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var h,m=p.readVarint()+p.pos,x=1,T=0,A=0,y=0,I=[];p.pos<m;){if(T<=0){var M=p.readVarint();x=7&M,T=M>>3}if(T--,x===1||x===2)A+=p.readSVarint(),y+=p.readSVarint(),x===1&&(h&&I.push(h),h=[]),h.push(new l(A,y));else{if(x!==7)throw new Error("unknown command "+x);h&&h.push(h[0].clone())}}return h&&I.push(h),I},t.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var h=p.readVarint()+p.pos,m=1,x=0,T=0,A=0,y=1/0,I=-1/0,M=1/0,E=-1/0;p.pos<h;){if(x<=0){var C=p.readVarint();m=7&C,x=C>>3}if(x--,m===1||m===2)(T+=p.readSVarint())<y&&(y=T),T>I&&(I=T),(A+=p.readSVarint())<M&&(M=A),A>E&&(E=A);else if(m!==7)throw new Error("unknown command "+m)}return[y,M,I,E]},t.prototype.toGeoJSON=function(p,h,m){var x,T,A=this.extent*Math.pow(2,m),y=this.extent*p,I=this.extent*h,M=this.loadGeometry(),E=t.types[this.type];function C(V){for(var j=0;j<V.length;j++){var Z=V[j];V[j]=[360*(Z.x+y)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+I)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(x=0;x<M.length;x++)L[x]=M[x][0];C(M=L);break;case 2:for(x=0;x<M.length;x++)C(M[x]);break;case 3:for(M=function(V){var j=V.length;if(j<=1)return[V];for(var Z,G,Y=[],J=0;J<j;J++){var se=c(V[J]);se!==0&&(G===void 0&&(G=se<0),G===se<0?(Z&&Y.push(Z),Z=[V[J]]):Z.push(V[J]))}return Z&&Y.push(Z),Y}(M),x=0;x<M.length;x++)for(T=0;T<M[x].length;T++)C(M[x][T])}M.length===1?M=M[0]:E="Multi"+E;var k={type:"Feature",geometry:{type:E,coordinates:M},properties:this.properties};return"id"in this&&(k.id=this.id),k},gm}function X_(){if(H_)return _m;H_=1;var l=$_();function t(c,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(s,this,p),this.length=this._features.length}function s(c,p,h){c===15?p.version=h.readVarint():c===1?p.name=h.readString():c===5?p.extent=h.readVarint():c===2?p._features.push(h.pos):c===3?p._keys.push(h.readString()):c===4&&p._values.push(function(m){for(var x=null,T=m.readVarint()+m.pos;m.pos<T;){var A=m.readVarint()>>3;x=A===1?m.readString():A===2?m.readFloat():A===3?m.readDouble():A===4?m.readVarint64():A===5?m.readVarint():A===6?m.readSVarint():A===7?m.readBoolean():null}return x}(h))}return _m=t,t.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var p=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,p,this.extent,this._keys,this._values)},_m}function Y_(){return W_||(W_=1,qf.VectorTile=function(){if(Z_)return ym;Z_=1;var l=X_();function t(s,c,p){if(s===3){var h=new l(p,p.readVarint()+p.pos);h.length&&(c[h.name]=h)}}return ym=function(s,c){this.layers=s.readFields(t,{},c)},ym}(),qf.VectorTileFeature=$_(),qf.VectorTileLayer=X_()),qf}var Uh=Y_();class vh extends Lt{constructor(t,s,c){super(t,s),this.z=c}}class J_ extends vh{constructor(t,s,c,p){super(t,s,c),this.w=p}}function jf(l,t,s,c){const p=[],h=c===0?(m,x,T,A,y,I)=>{m.push(new Lt(I,T+(I-x)/(A-x)*(y-T)))}:(m,x,T,A,y,I)=>{m.push(new Lt(x+(I-T)/(y-T)*(A-x),I))};for(const m of l){const x=[];for(const T of m){if(T.length<=2)continue;const A=[];for(let M=0;M<T.length-1;M++){const E=T[M].x,C=T[M].y,L=T[M+1].x,k=T[M+1].y,V=c===0?E:C,j=c===0?L:k;V<t?j>t&&h(A,E,C,L,k,t):V>s?j<s&&h(A,E,C,L,k,s):A.push(T[M]),j<t&&V>=t&&h(A,E,C,L,k,t),j>s&&V<=s&&h(A,E,C,L,k,s)}let y=T[T.length-1];const I=c===0?y.x:y.y;I>=t&&I<=s&&A.push(y),A.length&&(y=A[A.length-1],A[0].x===y.x&&A[0].y===y.y||A.push(A[0]),x.push(A))}x.length&&p.push(x)}return p}function K_(l,t,s,c){const p=s==="x"?"y":"x",h=(c-l[s])/(t[s]-l[s]);l[p]=l[p]+(t[p]-l[p])*h,l[s]=c,l.hasOwnProperty("z")&&(l.z=ln(l.z,t.z,h)),l.hasOwnProperty("w")&&(l.w=ln(l.w,t.w,h))}function Q_(l,t,s,c){const p=s,h=c;for(const m of["x","y"]){let x=l,T=t;x[m]>=T[m]&&(x=t,T=l),x[m]<p&&T[m]>p&&K_(x,T,m,p),x[m]<h&&T[m]>h&&K_(T,x,m,h)}}const Hf=Number.MAX_SAFE_INTEGER;function ey(l,t,s,c){return l.order<t||l.order===Hf||!(l.clipMask&s)||function(p,h){return h.length!==0&&h.find(m=>m===p)===void 0}(c,l.clipScope)}function Zf(l,t){return l.x-t.x||l.y-t.y}function ty(l,t){return Zf(l.min,t.min)===0&&Zf(l.max,t.max)===0}function vm(l,t){return!(l.min.x>t.max.x||l.max.x<t.min.x||l.min.y>t.max.y||l.max.y<t.min.y)}function xm(l,t){if(l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(l[s].sourceId!==t[s].sourceId||!ty(l[s],t[s])||l[s].order!==t[s].order||l[s].clipMask!==t[s].clipMask||!Zs(l[s].clipScope,t[s].clipScope))return!1;return!0}function ny(l,t,s){const c=1/Mt,p=1/(1<<s.canonical.z),h=(t.x*c+s.canonical.x)*p+s.wrap,m=(t.y*c+s.canonical.y)*p;return{min:new Lt((l.x*c+s.canonical.x)*p+s.wrap,(l.y*c+s.canonical.y)*p),max:new Lt(h,m)}}function pb(l,t,s){const c=1<<s.canonical.z,p=((t.x-s.wrap)*c-s.canonical.x)*Mt,h=(t.y*c-s.canonical.y)*Mt;return{min:new Lt(((l.x-s.wrap)*c-s.canonical.x)*Mt,(l.y*c-s.canonical.y)*Mt),max:new Lt(p,h)}}function iy(l,t,s,c,p,h,m){const x=l.indices,T=l.vertices,A=[];for(let y=c;y<c+p;y+=3){const I=t[s[y+0]+h],M=t[s[y+1]+h],E=t[s[y+2]+h],C=Math.min(I.x,M.x,E.x),L=Math.max(I.x,M.x,E.x),k=Math.min(I.y,M.y,E.y),V=Math.max(I.y,M.y,E.y);A.length=0,l.grid.query(new Lt(C,k),new Lt(L,V),A);for(let j=0;j<A.length;j++){const Z=A[j];if(di(T[x[3*Z+0]],T[x[3*Z+1]],T[x[3*Z+2]],I,M,E,m))return!0}}return!1}function ry(l,t,s,c){if(!l||!s)return!1;let p=l.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(s.vertices.length<l.vertices.length)return ry(s,c,l,t);const h=t.canonical,m=c.canonical,x=Math.pow(2,m.z-h.z);p=l.vertices.map(T=>new Lt((T.x+h.x*Mt)*x-m.x*Mt,(T.y+h.y*Mt)*x-m.y*Mt))}return iy(s,p,l.indices,0,l.indices.length,0,0)}function sy(l,t,s,c){const p=Math.pow(2,c.z-s.z);return new Lt((l+s.x*Mt)*p-c.x*Mt,(t+s.y*Mt)*p-c.y*Mt)}function oy(l,t){const s=[];t.grid.queryPoint(l,s);const c=t.indices,p=t.vertices;for(let h=0;h<s.length;h++){const m=s[h];if(Hn([p[c[3*m+0]],p[c[3*m+1]],p[c[3*m+2]]],l))return!0}return!1}const bm=[new Lt(0,0),new Lt(Mt,0),new Lt(Mt,Mt),new Lt(0,Mt)];function ay(l,t){const s=[];let c=[];if(!t||l.length<2)return[l];if(l.length===2)return ti(l[0],l[1],bm)?[l]:[];for(let p=0;p<l.length+2;p++){const h=l[p%l.length],m=l[(p+1)%l.length],x=ti(p===0?l[l.length-1]:l[(p-1)%l.length],h,bm),T=ti(h,m,bm),A=x||T;A&&c.push(h),A&&T||c.length>0&&(c.length>1&&s.push(c),c=[])}return c.length>1&&s.push(c),s}const wm=Uh.VectorTileFeature.types,mb=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],gb=["fill-extrusion-flood-light-ground-radius"],_b=Math.pow(2,13),yb=Math.pow(2,15)-1,ly=new Lt(0,1),Zc=2147483648;function Md(l,t,s,c,p,h,m,x){l.emplaceBack((t<<1)+m,(s<<1)+h,(Math.floor(c*_b)<<1)+p,Math.round(x))}function Ad(l,t,s){l.emplaceBack(t.x*Mt,t.y*Mt,s?1:0)}function Wf(l,t,s,c,p,h){l.emplaceBack(t.x,t.y,(s.x<<1)+c,(s.y<<1)+p,h)}function Pd(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class uy{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cy{constructor(){this.centroidXY=new Lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class hy{constructor(){this.acc=new Lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,s){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=s.x,t.min.y=t.max.y=s.y)}appendEdge(t,s,c){this.accCount++,this.acc._add(s);let p=!!this.borders;s.x<t.min.x?(t.min.x=s.x,p=!0):s.x>t.max.x&&(t.max.x=s.x,p=!0),s.y<t.min.y?(t.min.y=s.y,p=!0):s.y>t.max.y&&(t.max.y=s.y,p=!0),((s.x===0||s.x===Mt)&&s.x===c.x)!=((s.y===0||s.y===Mt)&&s.y===c.y)&&this.processBorderOverlap(s,c),p&&this.checkBorderIntersection(s,c)}checkBorderIntersection(t,s){s.x<0!=t.x<0&&this.addBorderIntersection(0,ln(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>Mt!=t.x>Mt&&this.addBorderIntersection(1,ln(s.y,t.y,(Mt-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,ln(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>Mt!=t.y>Mt&&this.addBorderIntersection(3,ln(s.x,t.x,(Mt-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new Lt(0,0):new Lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0):0}}function dy(l,t){const s=l.add(t)._unit(),c=nn(l.x*s.x+l.y*s.y,-1,1);var p,h,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*yb*((p=l).x*(h=t).y-p.y*h.x<0?-1:1)}const vb=[l=>l.x<0,l=>l.x>Mt,l=>l.y<0,l=>l.y>Mt];function xb(l,t,s,c){const p=[4];if(c===0)return p;s._mult(c);const h=l.sub(s),m=t.sub(s),x=[l,t,h,m];for(let T=0;T<4;T++)for(const A of x)if(vb[T](A)){p.push(T);break}return p}class fy{constructor(t){this.vertexArray=new hh,this.indexArray=new O,this.programConfigurations=new vl(t.layers,{zoom:t.zoom,lut:t.lut},s=>gb.includes(s)),this._segments=new lr,this.hiddenByLandmarkVertexArray=new oa,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new lr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,s,c,p=!1){const h=t.length;if(h>2){let m=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let T;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const A=t[0],y=t[1];T=dy(A.sub(t[h-1])._perp()._unit(),y.sub(A)._perp()._unit())}for(let A=0;A<h;A++){const y=A===h-1?0:A+1,I=t[A],M=t[y],E=t[y===h-1?0:y+1],C=M.sub(I)._perp()._unit(),L=dy(C,E.sub(M)._perp()._unit()),k=T,V=L;if(Em(I,M,s)||p&&gy(I,s)&&gy(M,s)){T=L;continue}const j=x.vertexLength;Wf(this.vertexArray,I,M,1,1,k),Wf(this.vertexArray,I,M,1,0,k),Wf(this.vertexArray,I,M,0,1,V),Wf(this.vertexArray,I,M,0,0,V),x.vertexLength+=4;const Z=xb(I,M,C,c);for(const G of Z)this._segmentToGroundQuads[m].push({id:j,region:G}),this._segmentToRegionTriCounts[m][G]+=2,x.primitiveLength+=2;T=L}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),s=t.length;for(let c=0;c<s;c++)this._segmentToGroundQuads[c].sort((p,h)=>p.region-h.region);for(let c=0;c<s;c++){const p=this._segmentToGroundQuads[c],h=t[c],m=this._segmentToRegionTriCounts[c];m.reduce((T,A)=>T+A,0);let x=0;for(let T=0;T<=4;T++){const A=m[T];if(A!==0){let y=this.regionSegments[T];y||(y=this.regionSegments[T]=new lr);const I={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+x,vertexLength:h.vertexLength,primitiveLength:A};y.get().push(I)}x+=A}for(let T=0;T<p.length;T++){const A=p[T].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,s,c,p,h,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,s,c,p,h,m)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,lb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,s,c,p,h,m){this.hasData()&&this.programConfigurations.updatePaintArrays(t,s,c,p,h,m)}updateHiddenByLandmark(t){if(!this.hasData())return;const s=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const c=t.flags&Zc?1:0;for(let p=t.groundVertexArrayOffset;p<s;++p)this.hiddenByLandmarkVertexArray.emplace(p,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,hb.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const s=this.regionSegments[t];s&&s.destroy()}}}}class $f{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new O,this.footprintVertices=new ml,this.footprintSegments=[],this.layoutVertexArray=new Ou,this.centroidVertexArray=new Mf,this.wallVertexArray=new gd,this.indexArray=new O,this.programConfigurations=new vl(t.layers,{zoom:t.zoom,lut:t.lut},s=>mb.includes(s)),this.segments=new lr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new fy(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,s){}populate(t,s,c,p){this.features=[],this.hasPattern=dm("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Re(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:m,index:x,sourceLayerIndex:T}of t){const A=this.layers[0]._featureFilter.needGeometry,y=gt(h,A);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),y,c))continue;const I={id:m,sourceLayerIndex:T,index:x,geometry:A?y.geometry:He(h,c,p),properties:h.properties,type:h.type,patterns:{}},M=this.layoutVertexArray.length,E=wm[I.type]==="Polygon";if(this.hasPattern)this.features.push(fm("fill-extrusion",this.layers,I,this.zoom,s));else if(this.wallMode)for(const C of I.geometry)for(const L of ay(C,E))this.addFeature(I,[L],x,c,{},s.availableImages,p,s.brightness);else this.addFeature(I,I.geometry,x,c,{},s.availableImages,p,s.brightness);s.featureIndex.insert(h,I.geometry,x,T,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,s,c,p,h,m){for(const x of this.features){const T=wm[x.type]==="Polygon",{geometry:A}=x;if(this.wallMode)for(const y of A)for(const I of ay(y,T))this.addFeature(x,[I],x.index,s,c,p,h,m);else this.addFeature(x,A,x.index,s,c,p,h,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,s,c,p,h){const m=Object.keys(t).length!==0;if(m&&!this.stateDependentLayers.length)return;const x=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,s,x,c,p,h),this.groundEffect.update(t,s,x,c,p,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fb),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,cb.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,db.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ub.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,p,h,m,x,T){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,y=[new Lt(0,0),new Lt(Mt,Mt)],I=x.projection,M=I.name==="globe",E=this.wallMode||wm[t.type]==="Polygon",C=new hy;C.centroidDataIndex=this.centroidData.length;const L=new cy,k=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},p)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},p);let j;if(L.height=V,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new mc),this.wallMode){if(M)return void Xn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;j=function(he){const Le=he[0].x===he[he.length-1].x&&he[0].y===he[he.length-1].y;(function(Ct){let bt=0;const an=Ct.length;for(let qt=0;qt<an;qt++)bt+=(Ct[(qt+1)%an].x-Ct[qt].x)*(Ct[(qt+1)%an].y+Ct[qt].y);return bt>=0})(he)||(he=he.reverse());const Me={geometry:[],joinNormals:[],indices:[]},Fe=[],ke=[],Ge=[];let Xe=he.length;if(Xe<(Le?3:2))return Me;for(;Xe>=2&&he[Xe-1].equals(he[Xe-2]);)Xe--;let Ye,Ze,ut,Et,ot,jt=0;for(;jt<Xe-1&&he[jt].equals(he[jt+1]);)jt++;Le&&(Ye=he[Xe-2],ot=he[jt].sub(Ye)._unit()._perp());for(let Ct=jt;Ct<Xe;Ct++){if(ut=Ct===Xe-1?Le?he[jt+1]:void 0:he[Ct+1],ut&&he[Ct].equals(ut))continue;ot&&(Et=ot),Ye&&(Ze=Ye),Ye=he[Ct],ot=ut?ut.sub(Ye)._unit()._perp():Et,Et=Et||ot;let bt=Et.add(ot);bt.x===0&&bt.y===0||bt._unit();const an=bt.x*ot.x+bt.y*ot.y,qt=an!==0?1/an:1/0,$t=Et.x*ot.y-Et.y*ot.x>0;let wn="miter";const Ln=2;wn==="miter"&&qt>Ln&&(wn="bevel"),wn==="bevel"&&(qt>100&&(wn="flipbevel"),qt<Ln&&(wn="miter"));const Rn=(Mn,Bn,Nn,zi)=>{const Li=new Lt(Mn.x,Mn.y),gn=new Lt(Mn.x,Mn.y);Li.x+=Bn.x*zi,Li.y+=Bn.y*zi,gn.x-=Bn.x*Math.max(Nn,1),gn.y-=Bn.y*Math.max(Nn,1),Ge.push(Bn),Fe.push(Li),ke.push(gn)};if(wn==="miter")bt._mult(qt),Rn(Ye,bt,0,0);else if(wn==="flipbevel")bt=ot.mult(-1),Rn(Ye,bt,0,0),Rn(Ye,bt.mult(-1),0,0);else{const Mn=-Math.sqrt(qt*qt-1),Bn=$t?Mn:0,Nn=$t?0:Mn;Ze&&Rn(Ye,Et,Bn,Nn),ut&&Rn(Ye,ot,Bn,Nn)}}Me.geometry=[...Fe,...ke.reverse(),Fe[0]],Me.joinNormals=[...Ge,...Ge.reverse(),Ge[Ge.length-1]];const Dt=Me.geometry.length-1;for(let Ct=0;Ct<Dt/2;Ct++)if(Ct+1<Dt/2){let bt=Ct,an=Ct+1,qt=Dt-1-Ct,$t=Dt-2-Ct;bt=bt===0?Dt-1:bt-1,an=an===0?Dt-1:an-1,qt=qt===0?Dt-1:qt-1,$t=$t===0?Dt-1:$t-1,Me.indices.push(qt),Me.indices.push(an),Me.indices.push(bt),Me.indices.push(qt),Me.indices.push($t),Me.indices.push(an)}return Me}(s[0]),s=[j.geometry]}const Z=(he,Le)=>he<(Le.length-1)/2||he===Le.length-1,G=this.wallMode?[s]:Gf(s,500);for(let he=G.length-1;he>=0;he--){const Le=G[he];(Le.length===0||(Y=Le[0]).every(ce=>ce.x<=0)||Y.every(ce=>ce.x>=Mt)||Y.every(ce=>ce.y<=0)||Y.every(ce=>ce.y>=Mt))&&G.splice(he,1)}var Y;let J;if(M)J=xy(G,y,p);else{J=[];for(const he of G)J.push({polygon:he,bounds:y})}const se=E?this.edgeRadius:0,pe=se>0&&this.zoom<17,ue=(he,Le)=>{if(he.length===0)return!1;const ce=he[he.length-1];return Le.x===ce.x&&Le.y===ce.y};for(const{polygon:he,bounds:Le}of J){let ce=0,Me=0;for(const Xe of he)E&&!Xe[0].equals(Xe[Xe.length-1])&&Xe.push(Xe[0]),Me+=E?Xe.length-1:Xe.length;const Fe=this.segments.prepareSegment((E?5:4)*Me,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);const ke={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ge=new uy;if(Ge.vertexOffset=this.footprintVertices.length,Ge.indexOffset=3*this.footprintIndices.length,Ge.ringIndices=[],E){const Xe=[],Ye=[];ce=Fe.vertexLength;for(let ut=0;ut<he.length;ut++){const Et=he[ut];Et.length&&ut!==0&&Ye.push(Xe.length/2);const ot=[];let jt,Dt;jt=Et[1].sub(Et[0])._perp()._unit(),Ge.ringIndices.push(Et.length-1);for(let Ct=1;Ct<Et.length;Ct++){const bt=Et[Ct],an=Et[Ct===Et.length-1?1:Ct+1],qt=bt.clone();if(se){Dt=an.sub(bt)._perp()._unit();const $t=jt.add(Dt)._unit(),wn=se*Math.min(4,1/(jt.x*$t.x+jt.y*$t.y));qt.x+=wn*$t.x,qt.y+=wn*$t.y,qt.x=Math.round(qt.x),qt.y=Math.round(qt.y),jt=Dt}if(!k||se!==0&&!pe||ue(ot,qt)||ot.push(qt),Md(this.layoutVertexArray,qt.x,qt.y,0,0,1,1,0),this.wallMode){const $t=Z(Ct,Et);Ad(this.wallVertexArray,j.joinNormals[Ct],!$t)}Fe.vertexLength++,this.footprintVertices.emplaceBack(bt.x,bt.y),Xe.push(bt.x,bt.y),M&&Pd(this.layoutVertexExtArray,I.projectTilePoint(qt.x,qt.y,p),I.upVector(p,qt.x,qt.y))}k&&(se===0||pe)&&(ot.length!==0&&ue(ot,ot[0])&&ot.pop(),this.groundEffect.addData(ot,Le,A))}const Ze=this.wallMode?j.indices:Id(Xe,Ye);for(let ut=0;ut<Ze.length;ut+=3)this.footprintIndices.emplaceBack(Ge.vertexOffset+Ze[ut+0],Ge.vertexOffset+Ze[ut+1],Ge.vertexOffset+Ze[ut+2]),this.indexArray.emplaceBack(ce+Ze[ut],ce+Ze[ut+2],ce+Ze[ut+1]),Fe.primitiveLength++;Ge.indexCount+=Ze.length,Ge.vertexCount+=this.footprintVertices.length-Ge.vertexOffset}for(let Xe=0;Xe<he.length;Xe++){const Ye=he[Xe];C.startRing(L,Ye[0]);let Ze=Ye.length>4&&_y(Ye[Ye.length-2],Ye[0],Ye[1]),ut=se?bb(Ye[Ye.length-2],Ye[0],Ye[1],se):0;const Et=[];let ot,jt,Dt;jt=Ye[1].sub(Ye[0])._perp()._unit();let Ct=!0;for(let bt=1,an=0;bt<Ye.length;bt++){let qt=Ye[bt-1],$t=Ye[bt];const wn=Ye[bt===Ye.length-1?1:bt+1];if(C.appendEdge(L,$t,qt),Em($t,qt,Le)){se&&(jt=wn.sub($t)._perp()._unit(),Ct=!Ct);continue}const Ln=$t.sub(qt)._perp(),Rn=Ln.x/(Math.abs(Ln.x)+Math.abs(Ln.y)),Mn=Ln.y>0?1:0,Bn=qt.dist($t);if(an+Bn>32768&&(an=0),se){Dt=wn.sub($t)._perp()._unit();let gn=my(qt,$t,wn,py(jt,Dt),se);isNaN(gn)&&(gn=0);const gi=$t.sub(qt)._unit();qt=qt.add(gi.mult(ut))._round(),$t=$t.add(gi.mult(-gn))._round(),ut=gn,jt=Dt,k&&this.zoom>=17&&(ue(Et,qt)||Et.push(qt),ue(Et,$t)||Et.push($t))}const Nn=Fe.vertexLength,zi=Ye.length>4&&_y(qt,$t,wn);let Li=yy(an,Ze,Ct);if(Md(this.layoutVertexArray,qt.x,qt.y,Rn,Mn,0,0,Li),Md(this.layoutVertexArray,qt.x,qt.y,Rn,Mn,0,1,Li),this.wallMode){const gn=Z(bt-1,Ye),gi=j.joinNormals[bt-1];Ad(this.wallVertexArray,gi,gn),Ad(this.wallVertexArray,gi,gn)}if(an+=Bn,Li=yy(an,zi,!Ct),Ze=zi,Md(this.layoutVertexArray,$t.x,$t.y,Rn,Mn,0,0,Li),Md(this.layoutVertexArray,$t.x,$t.y,Rn,Mn,0,1,Li),this.wallMode){const gn=Z(bt,Ye),gi=j.joinNormals[bt];Ad(this.wallVertexArray,gi,gn),Ad(this.wallVertexArray,gi,gn)}if(Fe.vertexLength+=4,this.indexArray.emplaceBack(Nn+0,Nn+1,Nn+2),this.indexArray.emplaceBack(Nn+1,Nn+3,Nn+2),Fe.primitiveLength+=2,se){const gn=ce+(bt===1?Ye.length-2:bt-2),gi=bt===1?ce:gn+1;if(this.indexArray.emplaceBack(Nn+1,gn,Nn+3),this.indexArray.emplaceBack(gn,gi,Nn+3),Fe.primitiveLength+=2,ot===void 0&&(ot=Nn),!Em(wn,Ye[bt],Le)){const yi=bt===Ye.length-1?ot:Fe.vertexLength;this.indexArray.emplaceBack(Nn+2,Nn+3,yi),this.indexArray.emplaceBack(Nn+3,yi+1,yi),this.indexArray.emplaceBack(Nn+3,gi,yi+1),Fe.primitiveLength+=3}Ct=!Ct}if(M){const gn=this.layoutVertexExtArray,gi=I.projectTilePoint(qt.x,qt.y,p),yi=I.projectTilePoint($t.x,$t.y,p),Hi=I.upVector(p,qt.x,qt.y),_r=I.upVector(p,$t.x,$t.y);Pd(gn,gi,Hi),Pd(gn,gi,Hi),Pd(gn,yi,_r),Pd(gn,yi,_r)}}E&&(ce+=Ye.length-1),k&&se&&this.zoom>=17&&(Et.length!==0&&ue(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,Le,A,se>0))}this.footprintSegments.push(Ge),ke.triangleCount=this.indexArray.length-ke.triangleArrayOffset,this.polygonSegments.push(ke),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,L.vertexCount!==0){if(L.centroidXY=C.borders?ly:this.encodeCentroid(C,L),this.centroidData.push(L),C.borders){this.featuresOnBorder.push(C);const he=this.featuresOnBorder.length-1;for(let Le=0;Le<C.borders.length;Le++)C.borders[Le][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Le].push(he)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,m,p,T),this.groundEffect.addPaintPropertiesData(t,c,h,m,p,T),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((s,c)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let x=0;x<this.centroidData.length;x++){const T=this.centroidData[x],A=+(T.min.y+T.max.y>Mt),y=2*A+(+(T.min.x+T.max.x>Mt)^A);for(let I=0;I<T.polygonSegLen;I++){const M=T.polygonSegIdx+I;t.push({centroidIdx:x,subtile:y,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const s=new O;t.sort((x,T)=>x.triangleSegmentIdx===T.triangleSegmentIdx?x.subtile-T.subtile:x.triangleSegmentIdx-T.triangleSegmentIdx);let c=0,p=0,h=0;for(const x of t){if(x.triangleSegmentIdx!==c)break;h++}const m=t.length;for(;p!==t.length;){c=t[p].triangleSegmentIdx;let x=0,T=p,A=p;for(let y=T;y<h&&t[y].subtile===x;y++)A++;for(;T!==h;){const y=t[T];x=y.subtile;const I=this.centroidData[y.centroidIdx].min.clone(),M=this.centroidData[y.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let C=T;C<A;C++){const L=t[C],k=this.polygonSegments[L.polygonSegmentIdx],V=this.centroidData[L.centroidIdx].min,j=this.centroidData[L.centroidIdx].max,Z=this.indexArray.uint16;for(let G=k.triangleArrayOffset;G<k.triangleArrayOffset+k.triangleCount;G++)s.emplaceBack(Z[3*G],Z[3*G+1],Z[3*G+2]);E.primitiveLength+=k.triangleCount,I.x=Math.min(I.x,V.x),I.y=Math.min(I.y,V.y),M.x=Math.max(M.x,j.x),M.y=Math.max(M.y,j.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:I,max:M}),T=A;for(let C=T;C<h&&t[C].subtile===t[T].subtile;C++)A++}p=h;for(let y=p;y<m&&t[y].triangleSegmentIdx===t[p].triangleSegmentIdx;y++)h++}s._trim(),this.indexArray=s}getVisibleSegments(t,s,c){const p=new lr;if(this.wallMode){for(const L of this.triangleSubSegments)p.segments.push(L.segment);return p}let h=0,m=0;const x=1<<t.canonical.z;if(s){const L=s.getMinMaxForTile(t);L&&(h=L.min,m=L.max)}m+=this.maxHeight;const T=t.toUnwrapped();let A;const y=[T.canonical.x/x+T.wrap,T.canonical.y/x],I=[(T.canonical.x+1)/x+T.wrap,(T.canonical.y+1)/x],M=(L,k,V)=>[L[0]*(1-V[0])+k[0]*V[0],L[1]*(1-V[1])+k[1]*V[1]],E=[],C=[];for(const L of this.triangleSubSegments){E[0]=L.min.x/Mt,E[1]=L.min.y/Mt,C[0]=L.max.x/Mt,C[1]=L.max.y/Mt;const k=M(y,I,E),V=M(y,I,C);if(new _i([k[0],k[1],h],[V[0],V[1],m]).intersectsPrecise(c)===0){A&&(p.segments.push(A),A=void 0);continue}const j=L.segment;A&&A.vertexOffset!==j.vertexOffset&&(p.segments.push(A),A=void 0),A?(A.vertexLength+=j.vertexLength,A.primitiveLength+=j.primitiveLength):A={vertexOffset:j.vertexOffset,primitiveLength:j.primitiveLength,vertexLength:j.vertexLength,primitiveOffset:j.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&p.segments.push(A),p}encodeCentroid(t,s){const c=t.centroid(),p=s.span(),h=Math.min(7,Math.round(p.x*this.tileToMeter/10)),m=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Lt(nn(c.x,1,Mt-1)<<3|h,nn(c.y,1,Mt-1)<<3|m)}encodeBorderCentroid(t){if(!t.borders)return new Lt(0,0);const s=t.borders,c=Number.MAX_VALUE;if(s[0][0]!==c||s[1][0]!==c){const p=s[0][0]!==c?0:1;return new Lt(6|(s[0][0]!==c?0:65528),(s[p][0]+s[p][1])/2<<3|6)}{const p=s[2][0]!==c?2:3;return new Lt((s[p][0]+s[p][1])/2<<3|6,6|(s[2][0]!==c?0:65528))}}showCentroid(t){const s=this.centroidData[t.centroidDataIndex];s.flags&=Zc,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const s=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,p=t.flags&Zc?ly:t.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==p.y||h!==p.x){for(let m=s;m<c;++m)this.centroidVertexArray.emplace(m,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,s,c){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const p=s.getReplacementRegionsForTile(t.toUnwrapped());if(xm(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const h=[];for(const m of this.activeReplacements){if(m.order<c)continue;const x=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-t.canonical.z));for(const T of this.centroidData)if(!(T.flags&Zc||m.min.x>T.max.x||T.min.x>m.max.x||m.min.y>T.max.y||T.min.y>m.max.y))for(let A=0;A<T.footprintSegLen;A++){const y=this.footprintSegments[T.footprintSegIdx+A];if(h.length=0,wb(this.footprintVertices,y.vertexOffset,y.vertexCount,m.footprintTileId.canonical,t.canonical,h),iy(m.footprint,h,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-x)){T.flags|=Zc;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,s,c){let p=!1;for(let h=0;h<c.footprintSegLen;h++){const m=this.footprintSegments[c.footprintSegIdx+h];let x=0;for(const T of m.ringIndices){for(let A=x,y=T+x-1;A<T+x;y=A++){const I=this.footprintVertices.int16[2*(A+m.vertexOffset)+0],M=this.footprintVertices.int16[2*(A+m.vertexOffset)+1],E=this.footprintVertices.int16[2*(y+m.vertexOffset)+1];M>s!=E>s&&t<(this.footprintVertices.int16[2*(y+m.vertexOffset)+0]-I)*(s-M)/(E-M)+I&&(p=!p)}x=T}}return p}getHeightAtTileCoord(t,s){let c=Number.NEGATIVE_INFINITY,p=!0;const h=4*(t+Mt)*Mt+(s+Mt);if(this.partLookup.hasOwnProperty(h)){const m=this.partLookup[h];return m?{height:m.height,hidden:!!(m.flags&Zc)}:void 0}for(const m of this.centroidData)t>m.max.x||m.min.x>t||s>m.max.y||m.min.y>s||this.footprintContainsPoint(t,s,m)&&m&&m.height>c&&(c=m.height,this.partLookup[h]=m,p=!!(m.flags&Zc));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:p};this.partLookup[h]=void 0}}function py(l,t){const s=l.add(t)._unit();return l.x*s.x+l.y*s.y}function bb(l,t,s,c){const p=t.sub(l)._perp()._unit(),h=s.sub(t)._perp()._unit();return my(l,t,s,py(p,h),c)}function my(l,t,s,c,p){const h=Math.sqrt(1-c*c);return Math.min(l.dist(t)/3,t.dist(s)/3,p*h/c)}function Em(l,t,s){return l.x<s[0].x&&t.x<s[0].x||l.x>s[1].x&&t.x>s[1].x||l.y<s[0].y&&t.y<s[0].y||l.y>s[1].y&&t.y>s[1].y}function gy(l,t){return l.x<t[0].x||l.x>t[1].x||l.y<t[0].y||l.y>t[1].y}function _y(l,t,s){if(l.x<0||l.x>=Mt||t.x<0||t.x>=Mt||s.x<0||s.x>=Mt)return!1;const c=s.sub(t),p=c.perp(),h=l.sub(t);return(c.x*h.x+c.y*h.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(h.x*h.x+h.y*h.y))>-.866&&p.x*h.x+p.y*h.y<0}function yy(l,t,s){const c=t?2|l:-3&l;return s?1|c:-2&c}function vy(){const l=Math.PI/32,t=Math.tan(l),s=D;return s*Math.sqrt(1+2*t*t)-s}function xy(l,t,s){const c=1<<s.z,p=ae(s.x/c),h=ae((s.x+1)/c),m=de(s.y/c),x=de((s.y+1)/c);return function(T,A,y,I,M=0,E){const C=[];if(!T.length||!y||!I)return C;const L=(J,se)=>{for(const pe of J)C.push({polygon:pe,bounds:se})},k=Math.ceil(Math.log2(y)),V=Math.ceil(Math.log2(I)),j=k-V,Z=[];for(let J=0;J<Math.abs(j);J++)Z.push(j>0?0:1);for(let J=0;J<Math.min(k,V);J++)Z.push(0),Z.push(1);let G=T;if(G=jf(G,A[0].y-M,A[1].y+M,1),G=jf(G,A[0].x-M,A[1].x+M,0),!G.length)return C;const Y=[];for(Z.length?Y.push({polygons:G,bounds:A,depth:0}):L(G,A);Y.length;){const J=Y.pop(),se=J.depth,pe=Z[se],ue=J.bounds[0],he=J.bounds[1],Le=pe===0?ue.x:ue.y,ce=pe===0?he.x:he.y,Me=E?E(pe,Le,ce):.5*(Le+ce),Fe=jf(J.polygons,Le-M,Me+M,pe),ke=jf(J.polygons,Me-M,ce+M,pe);if(Fe.length){const Ge=[ue,new Lt(pe===0?Me:he.x,pe===1?Me:he.y)];Z.length>se+1?Y.push({polygons:Fe,bounds:Ge,depth:se+1}):L(Fe,Ge)}if(ke.length){const Ge=[new Lt(pe===0?Me:ue.x,pe===1?Me:ue.y),he];Z.length>se+1?Y.push({polygons:ke,bounds:Ge,depth:se+1}):L(ke,Ge)}}return C}(l,t,Math.ceil((h-p)/11.25),Math.ceil((m-x)/11.25),1,(T,A,y)=>{if(T===0)return .5*(A+y);{const I=de((s.y+A/Mt)/c);return(re(.5*(de((s.y+y/Mt)/c)+I))*c-s.y)*Mt}})}function wb(l,t,s,c,p,h){const m=Math.pow(2,c.z-p.z);for(let x=0;x<s;x++){let T=l.int16[2*(x+t)+0],A=l.int16[2*(x+t)+1];T=(T+p.x*Mt)*m-c.x*Mt,A=(A+p.y*Mt)*m-c.y*Mt,h.push(new Lt(T,A))}}let by,wy;function Ld(l,t){return l.x*t.x+l.y*t.y}function Ey(l,t){if(l.length===1){let s=0;const c=t[s++];let p;for(;!p||c.equals(p);)if(p=t[s++],!p)return 1/0;for(;s<t.length;s++){const h=t[s],m=l[0],x=p.sub(c),T=h.sub(c),A=m.sub(c),y=Ld(x,x),I=Ld(x,T),M=Ld(T,T),E=Ld(A,x),C=Ld(A,T),L=y*M-I*I,k=(M*E-I*C)/L,V=(y*C-I*E)/L,j=c.z*(1-k-V)+p.z*k+h.z*V;if(isFinite(j))return j}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}function Iy(l,t,s,c,p,h,m,x){const T=m*p.getElevationAt(l,t,!0,!0),A=h[0]!==0,y=A?h[1]===0?m*(h[0]/7-450):m*function(I,M,E){const C=Math.floor(M[0]/8),L=Math.floor(M[1]/8),k=10*(M[0]-8*C),V=10*(M[1]-8*L),j=I.getElevationAt(C,L,!0,!0),Z=I.getMeterToDEM(E),G=Math.floor(.5*(k*Z-1)),Y=Math.floor(.5*(V*Z-1)),J=I.tileCoordToPixel(C,L),se=2*G+1,pe=2*Y+1,ue=function(ke,Ge,Xe,Ye,Ze){return[ke.getElevationAtPixel(Ge,Xe,!0),ke.getElevationAtPixel(Ge+Ze,Xe,!0),ke.getElevationAtPixel(Ge,Xe+Ze,!0),ke.getElevationAtPixel(Ge+Ye,Xe+Ze,!0)]}(I,J.x-G,J.y-Y,se,pe),he=Math.abs(ue[0]-ue[1]),Le=Math.abs(ue[2]-ue[3]),ce=Math.abs(ue[0]-ue[2])+Math.abs(ue[1]-ue[3]),Me=Math.min(.25,.5*Z*(he+Le)/se),Fe=Math.min(.25,.5*Z*ce/pe);return j+Math.max(Me*k,Fe*V)}(p,h,x):T;return{base:T+(s===0?-1:s),top:A?Math.max(y+c,T+s+2):T+c}}Gt($f,"FillExtrusionBucket",{omit:["layers","features"]}),Gt(cy,"PartData"),Gt(uy,"FootprintSegment"),Gt(hy,"BorderCentroidData"),Gt(fy,"GroundEffect");const Eb=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Ib=ei([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:Tb}=Eb,Sb=ei([{name:"a_packed",components:4,type:"Float32"}]),{members:Cb}=Sb,Mb=ei([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Ab}=Mb;class Ty{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new Hc({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){const c=this.getKey(t,s);return this.positions[c]}trim(){const t=this.width,s=this.height=So(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,c){const p=[];let h=t.length%2==1?-t[t.length-1]*c:0,m=t[0]*c,x=!0;p.push({left:h,right:m,isDash:x,zeroLength:t[0]===0});let T=t[0];for(let A=1;A<t.length;A++){x=!x;const y=t[A];h=T*c,T+=y,m=T*c,p.push({left:h,right:m,isDash:x,zeroLength:y===0})}return p}addRoundDash(t,s,c){const p=s/2;for(let h=-c;h<=c;h++){const m=this.width*(this.nextRow+c+h);let x=0,T=t[x];for(let A=0;A<this.width;A++){A/T.right>1&&(T=t[++x]);const y=Math.abs(A-T.left),I=Math.abs(A-T.right),M=Math.min(y,I);let E;const C=h/c*(p+1);if(T.isDash){const L=p-Math.abs(C);E=Math.sqrt(M*M+L*L)}else E=p-Math.sqrt(M*M+C*C);this.image.data[m+A]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(t,s){for(let T=t.length-1;T>=0;--T){const A=t[T],y=t[T+1];A.zeroLength?t.splice(T,1):y&&y.isDash===A.isDash&&(y.left=A.left,t.splice(T,1))}const c=t[0],p=t[t.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const h=this.width*this.nextRow;let m=0,x=t[m];for(let T=0;T<this.width;T++){T/x.right>1&&(x=t[++m]);const A=Math.abs(T-x.left),y=Math.abs(T-x.right),I=Math.min(A,y);this.image.data[h+T]=Math.max(0,Math.min(255,(x.isDash?I:-I)+s+128))}}addDash(t,s){const c=this.getKey(t,s);if(this.positions[c])return this.positions[c];const p=s==="round",h=p?7:0,m=2*h+1;if(this.nextRow+m>this.height)return Xn("LineAtlas out of space"),null;t.length===0&&t.push(1);let x=0;for(let y=0;y<t.length;y++)t[y]<0&&(Xn("Negative value is found in line dasharray, replacing values with 0"),t[y]=0),x+=t[y];if(x!==0){const y=this.width/x,I=this.getDashRanges(t,this.width,y);p?this.addRoundDash(I,y,h):this.addRegularDash(I,s==="square"?.5*y:0)}const T=this.nextRow+h;this.nextRow+=m;const A={tl:[T,h],br:[x,0]};return this.positions[c]=A,A}}Gt(Ty,"LineAtlas");const Pb=Uh.VectorTileFeature.types,Lb=Math.cos(Math.PI/180*37.5),Rb=Math.cos(Math.PI/180*5);class Im{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new pc,this.layoutVertexArray2=new za,this.patternVertexArray=new gl,this.indexArray=new O,this.programConfigurations=new vl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new lr,this.maxLineLength=0,this.zOffsetVertexArray=new ye,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:Mt/64}updateFootprints(t,s){}populate(t,s,c,p){this.hasPattern=dm("line",this.layers,s);const h=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();const m=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&m==="none"&&Xn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&x!==void 0;const T=[];for(const{feature:M,id:E,index:C,sourceLayerIndex:L}of t){const k=this.layers[0]._featureFilter.needGeometry,V=gt(M,k);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),V,c))continue;const j=h?h.evaluate(V,{},c):void 0,Z={id:E,properties:M.properties,type:M.type,sourceLayerIndex:L,index:C,geometry:k?V.geometry:He(M,c,p),patterns:{},sortKey:j};T.push(Z)}h&&T.sort((M,E)=>M.sortKey-E.sortKey);const{lineAtlas:A,featureIndex:y}=s,I=this.addConstantDashes(A);for(const M of T){const{geometry:E,index:C,sourceLayerIndex:L}=M;if(I&&this.addFeatureDashes(M,A),this.hasPattern){const k=fm("line",this.layers,M,this.zoom,s);this.patternFeatures.push(k)}else this.addFeature(M,E,C,c,A.positions,s.availableImages,s.brightness);y.insert(t[C].feature,E,C,L,this.index)}}addConstantDashes(t){let s=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,h=c.layout.get("line-cap").value;if(p.kind!=="constant"||h.kind!=="constant")s=!0;else{const m=h.value,x=p.value;if(!x)continue;t.addDash(x,m)}}return s}addFeatureDashes(t,s){const c=this.zoom;for(const p of this.layers){const h=p.paint.get("line-dasharray").value,m=p.layout.get("line-cap").value;if(h.kind==="constant"&&m.kind==="constant")continue;let x,T;if(h.kind==="constant"){if(x=h.value,!x)continue}else x=h.evaluate({zoom:c},t);T=m.kind==="constant"?m.value:m.evaluate({zoom:c},t),s.addDash(x,T),t.patterns[p.id]=s.getKey(x,T)}}update(t,s,c,p,h){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,s,m?this.stateDependentLayers:this.layers,c,p,h)}addFeatures(t,s,c,p,h,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Cb)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,Ab)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Ib.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tb),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,p,h,m,x){const T=this.layers[0].layout,A=T.get("line-join").evaluate(t,{}),y=T.get("line-cap").evaluate(t,{}),I=T.get("line-miter-limit"),M=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=T.get("line-z-offset").value;for(const E of s)this.addLine(E,t,p,A,y,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,m,p,x)}addLine(t,s,c,p,h,m,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=p==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Z=0;Z<t.length-1;Z++)this.totalDistance+=t[Z].dist(t[Z+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=Pb[s.type]==="Polygon";let y=t.length;for(;y>=2&&t[y-1].equals(t[y-2]);)y--;let I=0;for(;I<y-1&&t[I].equals(t[I+1]);)I++;if(y<(A?3:2))return;p==="bevel"&&(m=1.05);const M=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let E,C,L,k,V,j;this.e1=this.e2=-1,A&&(E=t[y-2],V=t[I].sub(E)._unit()._perp());for(let Z=I;Z<y;Z++){if(L=Z===y-1?A?t[I+1]:void 0:t[Z+1],L&&t[Z].equals(L))continue;V&&(k=V),E&&(C=E),E=t[Z],j=this.hasZOffset?this.evaluateElevationValue(C?C.dist(E):0):null,V=L?L.sub(E)._unit()._perp():k,k=k||V;const G=C&&L;let Y=G?p:A||T?"butt":h;const J=k.x*V.x+k.y*V.y;if(T){const Fe=function(ke){if(ke.patternJoinNone){const Ge=ke.segmentPoints.length/2,Xe=ke.lineSoFar-ke.segmentStart;for(let Ye=0;Ye<Ge;++Ye){const Ze=ke.segmentPoints[2*Ye+1],ut=Math.round(ke.segmentPoints[2*Ye])+.5+.25*Ze;ke.patternVertexArray.emplaceBack(ut,Xe,ke.segmentStart),ke.patternVertexArray.emplaceBack(ut,Xe,ke.segmentStart)}ke.segmentPoints.length=0}ke.e1=ke.e2=-1};if(G&&J<Rb){this.updateDistance(C,E),this.addCurrentVertex(E,k,1,1,M,j),Fe(this),this.addCurrentVertex(E,V,-1,-1,M,j);continue}if(C){if(!L){this.updateDistance(C,E),this.addCurrentVertex(E,k,1,1,M,j),Fe(this);continue}Y="miter"}}let se=k.add(V);se.x===0&&se.y===0||se._unit();const pe=se.x*V.x+se.y*V.y,ue=pe!==0?1/pe:1/0,he=2*Math.sqrt(2-2*pe),Le=pe<Lb&&C&&L,ce=k.x*V.y-k.y*V.x>0,Me=this.overscaling<=16?15*Mt/(512*this.overscaling):0;if(G&&Y==="round"){if(ue<x)Y="miter";else if(ue<=2){const Fe=Tm(E,-10,Mt+10);Y=this.hasZOffset&&(Fe||this.hasCrossSlope)?"miter":"fakeround"}}if(Y==="miter"&&ue>m&&(Y="bevel"),Y==="bevel"&&(ue>2&&(Y="flipbevel"),ue<m&&(Y="miter")),C&&!(Y==="miter"&&Le)&&this.updateDistance(C,E),Y==="miter")if(Le){const Fe=E.dist(C);if(Fe>2*Me){const Ge=E.sub(E.sub(C)._mult(Me/Fe)._round());this.updateDistance(C,Ge),this.addCurrentVertex(Ge,k,0,0,M,j),C=Ge}this.updateDistance(C,E),se._mult(ue),this.addCurrentVertex(E,se,0,0,M,j);const ke=E.dist(L);if(ke>2*Me){const Ge=E.add(L.sub(E)._mult(Me/ke)._round());this.updateDistance(E,Ge),this.addCurrentVertex(Ge,V,0,0,M,j),E=Ge}}else se._mult(ue),this.addCurrentVertex(E,se,0,0,M,j);else if(Y==="flipbevel"){if(ue>100)se=V.mult(-1);else{const Fe=ue*k.add(V).mag()/k.sub(V).mag();se._perp()._mult(Fe*(ce?-1:1))}this.addCurrentVertex(E,se,0,0,M,j),this.addCurrentVertex(E,se.mult(-1),0,0,M,j)}else if(Y==="bevel"||Y==="fakeround"){j!=null&&C&&this.addCurrentVertex(E,k,-1,-1,M,j);const Fe=E.dist(C)<=2*Me&&Y!=="bevel",ke=se.mult(ce?1:-1);ke._mult(ue);const Ge=V.mult(ce?-1:1),Xe=k.mult(ce?-1:1),Ye=this.evaluateElevationValue(this.distance);if(j==null&&(this.addHalfVertex(E,ke.x,ke.y,!1,!ce,0,M,Ye),Fe||this.addHalfVertex(E,ke.x+2*Xe.x,ke.y+2*Xe.y,!1,ce,0,M,Ye)),Y==="fakeround"){const Ze=Math.round(180*he/Math.PI/20);this.addHalfVertex(E,Xe.x,Xe.y,!1,ce,0,M,Ye);for(let ut=0;ut<Ze;ut++){let Et=ut/Ze;if(Et!==.5){const jt=Et-.5;Et+=Et*jt*(Et-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*jt*jt+(.848013+J*(.215638*J-1.06021)))}const ot=Ge.sub(Xe)._mult(Et)._add(Xe)._unit();this.addHalfVertex(E,ot.x,ot.y,!1,ce,0,M,Ye)}this.addHalfVertex(E,Ge.x,Ge.y,!1,ce,0,M,Ye)}Fe||j!=null||this.addHalfVertex(E,ke.x+2*Ge.x,ke.y+2*Ge.y,!1,ce,0,M,Ye),j!=null&&L&&this.addCurrentVertex(E,V,1,1,M,j)}else Y==="butt"?this.addCurrentVertex(E,se,0,0,M,j):Y==="square"?(C||this.addCurrentVertex(E,se,-1,-1,M,j),this.addCurrentVertex(E,se,0,0,M,j),C&&this.addCurrentVertex(E,se,1,1,M,j)):Y==="round"&&(C&&(this.addCurrentVertex(E,k,0,0,M,j),this.addCurrentVertex(E,k,1,1,M,j,!0)),L&&(this.addCurrentVertex(E,V,-1,-1,M,j,!0),this.addCurrentVertex(E,V,0,0,M,j)))}}addVerticesTo(t,s,c,p,h,m,x,T,A,y){const I=(s.w-t.w)/this.tessellationStep|0;let M=0;const E=this.scaledDistance;if(I>1){this.lineSoFar=t.w;const L=(s.x-t.x)/I,k=(s.y-t.y)/I,V=(s.z-t.z)/I,j=(s.w-t.w)/I;for(let Z=1;Z<I;++Z){t.x+=L,t.y+=k,t.z+=V,this.lineSoFar+=j,M+=j;const G=this.evaluateElevationValue(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(t,c,p,y,!1,x,A,G),this.addHalfVertex(t,h,m,y,!0,-T,A,G)}}this.lineSoFar=s.w,this.scaledDistance=E;const C=this.evaluateElevationValue(this.distance);this.addHalfVertex(s,c,p,y,!1,x,A,C),this.addHalfVertex(s,h,m,y,!0,-T,A,C)}evaluateElevationValue(t){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Xn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(t,s,c,p,h,m,x=!1){const T=s.x+s.y*c,A=s.y-s.x*c,y=s.y*p-s.x,I=-s.y-s.x*p;if(m!=null){const E=Mt+10,C=m,L=new J_(t.x,t.y,C,this.lineSoFar),k=Tm(t,-10,E),V=this.lineSoFar,j=this.distance;if(this.currentVertex)if(k){const Z=this.currentVertexIsOutside,G=this.currentVertex,Y=new J_(t.x,t.y,C,this.lineSoFar);if(Q_(G,Y,-10,E),!Tm(Y,-10,E)){if(Z){this.e1=this.e2=-1,this.distance-=G.dist(L),this.lineSoFar=G.w;const J=this.evaluateElevationValue(G.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(G,T,A,x,!1,c,h,J),this.addHalfVertex(G,y,I,x,!0,-p,h,J),this.prevDistance=this.distance}this.distance=this.prevDistance+G.dist(Y),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(G,Y,T,A,y,I,c,p,h,x),this.distance=j,this.scaledDistance=this.distance/this.totalDistance}}else{const Z=this.currentVertex;if(this.currentVertexIsOutside){Q_(Z,L,-10,E),this.e1=this.e2=-1,this.distance-=Z.dist(L),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Z.w;const G=this.evaluateElevationValue(Z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Z,T,A,x,!1,c,h,G),this.addHalfVertex(Z,y,I,x,!0,-p,h,G),this.prevDistance=this.distance,this.distance=j,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Z,L,T,A,y,I,c,p,h,x)}else k||(this.addHalfVertex(t,T,A,x,!1,c,h,m),this.addHalfVertex(t,y,I,x,!0,-p,h,m));this.currentVertex=L,this.currentVertexIsOutside=k,this.lineSoFar=V}else this.addHalfVertex(t,T,A,x,!1,c,h,m),this.addHalfVertex(t,y,I,x,!0,-p,h,m)}addHalfVertex({x:t,y:s},c,p,h,m,x,T,A){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(s<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const y=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),T.primitiveLength++),m?this.e2=y:this.e1=y,A!=null&&this.zOffsetVertexArray.emplaceBack(A)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,s){this.prevDistance=this.distance,this.distance+=t.dist(s),this.updateScaledDistance()}}function Tm(l,t,s){return l.x<t||l.x>s||l.y<t||l.y>s}let Sy,Cy;function My(l,t,s){return t*(Mt/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Gt(Im,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ay=(l,t,s)=>(1-s)*l+s*t;function Py(l,t){return 1/My(l,1,t.tileZoom)}function Ly(l,t,s,c){return l.translatePosMatrix(c||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Ry=l=>{const t=[];Dy(l)&&t.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const s=l.paint.get("line-trim-offset");s[0]===0&&s[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=l.layout.get("line-join").constantOr("miter")==="none",p=!!l.paint.get("line-pattern").constantOr(1);return c&&p&&t.push("LINE_JOIN_NONE"),t};function Dy(l){const t=l.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let Sm;const Oy=()=>Sm||(Sm={layout:Sy||(Sy=new Ei({"line-cap":new Ht($e.layout_line["line-cap"]),"line-join":new Ht($e.layout_line["line-join"]),"line-miter-limit":new It($e.layout_line["line-miter-limit"]),"line-round-limit":new It($e.layout_line["line-round-limit"]),"line-sort-key":new Ht($e.layout_line["line-sort-key"]),"line-z-offset":new Ht($e.layout_line["line-z-offset"]),"line-elevation-reference":new It($e.layout_line["line-elevation-reference"]),"line-cross-slope":new It($e.layout_line["line-cross-slope"]),visibility:new It($e.layout_line.visibility)})),paint:Cy||(Cy=new Ei({"line-opacity":new Ht($e.paint_line["line-opacity"]),"line-color":new Ht($e.paint_line["line-color"]),"line-translate":new It($e.paint_line["line-translate"]),"line-translate-anchor":new It($e.paint_line["line-translate-anchor"]),"line-width":new Ht($e.paint_line["line-width"]),"line-gap-width":new Ht($e.paint_line["line-gap-width"]),"line-offset":new Ht($e.paint_line["line-offset"]),"line-blur":new Ht($e.paint_line["line-blur"]),"line-dasharray":new Ht($e.paint_line["line-dasharray"]),"line-pattern":new Ht($e.paint_line["line-pattern"]),"line-gradient":new zo($e.paint_line["line-gradient"]),"line-trim-offset":new It($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new It($e.paint_line["line-trim-fade-range"]),"line-trim-color":new It($e.paint_line["line-trim-color"]),"line-emissive-strength":new It($e.paint_line["line-emissive-strength"]),"line-border-width":new Ht($e.paint_line["line-border-width"]),"line-border-color":new Ht($e.paint_line["line-border-color"]),"line-occlusion-opacity":new It($e.paint_line["line-occlusion-opacity"])}))},Sm);class Db extends Ht{possiblyEvaluate(t,s){return s=new Ui(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,c,p){return s=ir({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,c,p)}}let Rd;function Ny(l,t){return t>0?t+2*l:l}const Ob=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nb=ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zb=ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fb=ei([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),kb=ei([{name:"a_texb",components:2,type:"Uint16"}]),Bb=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Vb=ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zy=ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ub=ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ei([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ns=24;const eu=128;function Cm(l,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ui(l+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let h=0;for(;h<c.length&&c[h]<=l;)h++;h=Math.max(0,h-1);let m=h;for(;m<c.length&&c[m]<l+1;)m++;m=Math.min(c.length-1,m);const x=c[h],T=c[m];return s.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:T,minSize:s.evaluate(new Ui(x)),maxSize:s.evaluate(new Ui(T)),interpolationType:p}}}function Xf(l,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:p}){return l.kind==="source"?c/eu:l.kind==="composite"?ln(c/eu,p/eu,s):t}function Gh(l,t,s=1){let c=0,p=0;if(l.kind==="constant")p=l.layoutSize*s;else if(l.kind!=="source"){const{interpolationType:h,minZoom:m,maxZoom:x}=l,T=h?nn(fs.interpolationFactor(h,t,m,x),0,1):0;l.kind==="camera"?p=ln(l.minSize,l.maxSize,T)*s:c=T*s}return{uSizeT:c,uSize:p}}var Gb=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:eu,evaluateSizeForFeature:Xf,evaluateSizeForZoom:Gh,getSizeData:Cm});function qb(l,t,s){return l.sections.forEach(c=>{c.text=function(p,h,m){const x=h.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),nr.applyArabicShaping&&(p=nr.applyArabicShaping(p)),p}(c.text,t,s)}),l}const Dd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function jb(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function Hb(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}var Fy,Mm,ky,Am={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Zb(){return Fy||(Fy=1,Am.read=function(l,t,s,c,p){var h,m,x=8*p-c-1,T=(1<<x)-1,A=T>>1,y=-7,I=s?p-1:0,M=s?-1:1,E=l[t+I];for(I+=M,h=E&(1<<-y)-1,E>>=-y,y+=x;y>0;h=256*h+l[t+I],I+=M,y-=8);for(m=h&(1<<-y)-1,h>>=-y,y+=c;y>0;m=256*m+l[t+I],I+=M,y-=8);if(h===0)h=1-A;else{if(h===T)return m?NaN:1/0*(E?-1:1);m+=Math.pow(2,c),h-=A}return(E?-1:1)*m*Math.pow(2,h-c)},Am.write=function(l,t,s,c,p,h){var m,x,T,A=8*h-p-1,y=(1<<A)-1,I=y>>1,M=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=c?0:h-1,C=c?1:-1,L=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,m=y):(m=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-m))<1&&(m--,T*=2),(t+=m+I>=1?M/T:M*Math.pow(2,1-I))*T>=2&&(m++,T/=2),m+I>=y?(x=0,m=y):m+I>=1?(x=(t*T-1)*Math.pow(2,p),m+=I):(x=t*Math.pow(2,I-1)*Math.pow(2,p),m=0));p>=8;l[s+E]=255&x,E+=C,x/=256,p-=8);for(m=m<<p|x,A+=p;A>0;l[s+E]=255&m,E+=C,m/=256,A-=8);l[s+E-C]|=128*L}),Am}function By(){if(ky)return Mm;ky=1,Mm=t;var l=Zb();function t(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var s=4294967296,c=1/s,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(G){return G.type===t.Bytes?G.readVarint()+G.pos:G.pos+1}function m(G,Y,J){return J?4294967296*Y+(G>>>0):4294967296*(Y>>>0)+(G>>>0)}function x(G,Y,J){var se=Y<=16383?1:Y<=2097151?2:Y<=268435455?3:Math.floor(Math.log(Y)/(7*Math.LN2));J.realloc(se);for(var pe=J.pos-1;pe>=G;pe--)J.buf[pe+se]=J.buf[pe]}function T(G,Y){for(var J=0;J<G.length;J++)Y.writeVarint(G[J])}function A(G,Y){for(var J=0;J<G.length;J++)Y.writeSVarint(G[J])}function y(G,Y){for(var J=0;J<G.length;J++)Y.writeFloat(G[J])}function I(G,Y){for(var J=0;J<G.length;J++)Y.writeDouble(G[J])}function M(G,Y){for(var J=0;J<G.length;J++)Y.writeBoolean(G[J])}function E(G,Y){for(var J=0;J<G.length;J++)Y.writeFixed32(G[J])}function C(G,Y){for(var J=0;J<G.length;J++)Y.writeSFixed32(G[J])}function L(G,Y){for(var J=0;J<G.length;J++)Y.writeFixed64(G[J])}function k(G,Y){for(var J=0;J<G.length;J++)Y.writeSFixed64(G[J])}function V(G,Y){return(G[Y]|G[Y+1]<<8|G[Y+2]<<16)+16777216*G[Y+3]}function j(G,Y,J){G[J]=Y,G[J+1]=Y>>>8,G[J+2]=Y>>>16,G[J+3]=Y>>>24}function Z(G,Y){return(G[Y]|G[Y+1]<<8|G[Y+2]<<16)+(G[Y+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(G,Y,J){for(J=J||this.length;this.pos<J;){var se=this.readVarint(),pe=se>>3,ue=this.pos;this.type=7&se,G(pe,Y,this),this.pos===ue&&this.skip(se)}return Y},readMessage:function(G,Y){return this.readFields(G,Y,this.readVarint()+this.pos)},readFixed32:function(){var G=V(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=Z(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=V(this.buf,this.pos)+V(this.buf,this.pos+4)*s;return this.pos+=8,G},readSFixed64:function(){var G=V(this.buf,this.pos)+Z(this.buf,this.pos+4)*s;return this.pos+=8,G},readFloat:function(){var G=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var Y,J,se=this.buf;return Y=127&(J=se[this.pos++]),J<128?Y:(Y|=(127&(J=se[this.pos++]))<<7,J<128?Y:(Y|=(127&(J=se[this.pos++]))<<14,J<128?Y:(Y|=(127&(J=se[this.pos++]))<<21,J<128?Y:function(pe,ue,he){var Le,ce,Me=he.buf;if(Le=(112&(ce=Me[he.pos++]))>>4,ce<128||(Le|=(127&(ce=Me[he.pos++]))<<3,ce<128)||(Le|=(127&(ce=Me[he.pos++]))<<10,ce<128)||(Le|=(127&(ce=Me[he.pos++]))<<17,ce<128)||(Le|=(127&(ce=Me[he.pos++]))<<24,ce<128)||(Le|=(1&(ce=Me[he.pos++]))<<31,ce<128))return m(pe,Le,ue);throw new Error("Expected varint not more than 10 bytes")}(Y|=(15&(J=se[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,Y=this.pos;return this.pos=G,G-Y>=12&&p?function(J,se,pe){return p.decode(J.subarray(se,pe))}(this.buf,Y,G):function(J,se,pe){for(var ue="",he=se;he<pe;){var Le,ce,Me,Fe=J[he],ke=null,Ge=Fe>239?4:Fe>223?3:Fe>191?2:1;if(he+Ge>pe)break;Ge===1?Fe<128&&(ke=Fe):Ge===2?(192&(Le=J[he+1]))==128&&(ke=(31&Fe)<<6|63&Le)<=127&&(ke=null):Ge===3?(ce=J[he+2],(192&(Le=J[he+1]))==128&&(192&ce)==128&&((ke=(15&Fe)<<12|(63&Le)<<6|63&ce)<=2047||ke>=55296&&ke<=57343)&&(ke=null)):Ge===4&&(ce=J[he+2],Me=J[he+3],(192&(Le=J[he+1]))==128&&(192&ce)==128&&(192&Me)==128&&((ke=(15&Fe)<<18|(63&Le)<<12|(63&ce)<<6|63&Me)<=65535||ke>=1114112)&&(ke=null)),ke===null?(ke=65533,Ge=1):ke>65535&&(ke-=65536,ue+=String.fromCharCode(ke>>>10&1023|55296),ke=56320|1023&ke),ue+=String.fromCharCode(ke),he+=Ge}return ue}(this.buf,Y,G)},readBytes:function(){var G=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,G);return this.pos=G,Y},readPackedVarint:function(G,Y){if(this.type!==t.Bytes)return G.push(this.readVarint(Y));var J=h(this);for(G=G||[];this.pos<J;)G.push(this.readVarint(Y));return G},readPackedSVarint:function(G){if(this.type!==t.Bytes)return G.push(this.readSVarint());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==t.Bytes)return G.push(this.readBoolean());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==t.Bytes)return G.push(this.readFloat());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==t.Bytes)return G.push(this.readDouble());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==t.Bytes)return G.push(this.readFixed32());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==t.Bytes)return G.push(this.readSFixed32());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==t.Bytes)return G.push(this.readFixed64());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==t.Bytes)return G.push(this.readSFixed64());var Y=h(this);for(G=G||[];this.pos<Y;)G.push(this.readSFixed64());return G},skip:function(G){var Y=7&G;if(Y===t.Varint)for(;this.buf[this.pos++]>127;);else if(Y===t.Bytes)this.pos=this.readVarint()+this.pos;else if(Y===t.Fixed32)this.pos+=4;else{if(Y!==t.Fixed64)throw new Error("Unimplemented type: "+Y);this.pos+=8}},writeTag:function(G,Y){this.writeVarint(G<<3|Y)},realloc:function(G){for(var Y=this.length||16;Y<this.pos+G;)Y*=2;if(Y!==this.length){var J=new Uint8Array(Y);J.set(this.buf),this.buf=J,this.length=Y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),j(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),j(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),j(this.buf,-1&G,this.pos),j(this.buf,Math.floor(G*c),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),j(this.buf,-1&G,this.pos),j(this.buf,Math.floor(G*c),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(Y,J){var se,pe;if(Y>=0?(se=Y%4294967296|0,pe=Y/4294967296|0):(pe=~(-Y/4294967296),4294967295^(se=~(-Y%4294967296))?se=se+1|0:(se=0,pe=pe+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");J.realloc(10),function(ue,he,Le){Le.buf[Le.pos++]=127&ue|128,ue>>>=7,Le.buf[Le.pos++]=127&ue|128,ue>>>=7,Le.buf[Le.pos++]=127&ue|128,ue>>>=7,Le.buf[Le.pos++]=127&ue|128,Le.buf[Le.pos]=127&(ue>>>=7)}(se,0,J),function(ue,he){var Le=(7&ue)<<4;he.buf[he.pos++]|=Le|((ue>>>=3)?128:0),ue&&(he.buf[he.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(he.buf[he.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(he.buf[he.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(he.buf[he.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(he.buf[he.pos++]=127&ue)))))}(pe,J)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var Y=this.pos;this.pos=function(se,pe,ue){for(var he,Le,ce=0;ce<pe.length;ce++){if((he=pe.charCodeAt(ce))>55295&&he<57344){if(!Le){he>56319||ce+1===pe.length?(se[ue++]=239,se[ue++]=191,se[ue++]=189):Le=he;continue}if(he<56320){se[ue++]=239,se[ue++]=191,se[ue++]=189,Le=he;continue}he=Le-55296<<10|he-56320|65536,Le=null}else Le&&(se[ue++]=239,se[ue++]=191,se[ue++]=189,Le=null);he<128?se[ue++]=he:(he<2048?se[ue++]=he>>6|192:(he<65536?se[ue++]=he>>12|224:(se[ue++]=he>>18|240,se[ue++]=he>>12&63|128),se[ue++]=he>>6&63|128),se[ue++]=63&he|128)}return ue}(this.buf,G,this.pos);var J=this.pos-Y;J>=128&&x(Y,J,this),this.pos=Y-1,this.writeVarint(J),this.pos+=J},writeFloat:function(G){this.realloc(4),l.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),l.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var Y=G.length;this.writeVarint(Y),this.realloc(Y);for(var J=0;J<Y;J++)this.buf[this.pos++]=G[J]},writeRawMessage:function(G,Y){this.pos++;var J=this.pos;G(Y,this);var se=this.pos-J;se>=128&&x(J,se,this),this.pos=J-1,this.writeVarint(se),this.pos+=se},writeMessage:function(G,Y,J){this.writeTag(G,t.Bytes),this.writeRawMessage(Y,J)},writePackedVarint:function(G,Y){Y.length&&this.writeMessage(G,T,Y)},writePackedSVarint:function(G,Y){Y.length&&this.writeMessage(G,A,Y)},writePackedBoolean:function(G,Y){Y.length&&this.writeMessage(G,M,Y)},writePackedFloat:function(G,Y){Y.length&&this.writeMessage(G,y,Y)},writePackedDouble:function(G,Y){Y.length&&this.writeMessage(G,I,Y)},writePackedFixed32:function(G,Y){Y.length&&this.writeMessage(G,E,Y)},writePackedSFixed32:function(G,Y){Y.length&&this.writeMessage(G,C,Y)},writePackedFixed64:function(G,Y){Y.length&&this.writeMessage(G,L,Y)},writePackedSFixed64:function(G,Y){Y.length&&this.writeMessage(G,k,Y)},writeBytesField:function(G,Y){this.writeTag(G,t.Bytes),this.writeBytes(Y)},writeFixed32Field:function(G,Y){this.writeTag(G,t.Fixed32),this.writeFixed32(Y)},writeSFixed32Field:function(G,Y){this.writeTag(G,t.Fixed32),this.writeSFixed32(Y)},writeFixed64Field:function(G,Y){this.writeTag(G,t.Fixed64),this.writeFixed64(Y)},writeSFixed64Field:function(G,Y){this.writeTag(G,t.Fixed64),this.writeSFixed64(Y)},writeVarintField:function(G,Y){this.writeTag(G,t.Varint),this.writeVarint(Y)},writeSVarintField:function(G,Y){this.writeTag(G,t.Varint),this.writeSVarint(Y)},writeStringField:function(G,Y){this.writeTag(G,t.Bytes),this.writeString(Y)},writeFloatField:function(G,Y){this.writeTag(G,t.Fixed32),this.writeFloat(Y)},writeDoubleField:function(G,Y){this.writeTag(G,t.Fixed64),this.writeDouble(Y)},writeBooleanField:function(G,Y){this.writeVarintField(G,!!Y)}},Mm}var Yf=_e(By());const Pm=3;function Wb(l,t,s){t.glyphs=[],l===1&&s.readMessage($b,t)}function $b(l,t,s){if(l===3){const{id:c,bitmap:p,width:h,height:m,left:x,top:T,advance:A}=s.readMessage(Xb,{});t.glyphs.push({id:c,bitmap:new Hc({width:h+2*Pm,height:m+2*Pm},p),metrics:{width:h,height:m,left:x,top:T,advance:A}})}else l===4?t.ascender=s.readSVarint():l===5&&(t.descender=s.readSVarint())}function Xb(l,t,s){l===1?t.id=s.readVarint():l===2?t.bitmap=s.readBytes():l===3?t.width=s.readVarint():l===4?t.height=s.readVarint():l===5?t.left=s.readSVarint():l===6?t.top=s.readSVarint():l===7&&(t.advance=s.readVarint())}const Vy=Pm,Va={horizontal:1,vertical:2,horizontalOnly:3};class Od{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const c=new Od;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new Od;return s.imageName=t,s}}class qh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new qh;for(let p=0;p<t.sections.length;p++){const h=t.sections[p];h.image?c.addImageSection(h):c.addTextSection(h,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(s,c){let p="";for(let h=0;h<s.length;h++){const m=s.charCodeAt(h+1)||null,x=s.charCodeAt(h-1)||null;p+=!c&&(m&&Ra(m)&&!Dd[s[h+1]]||x&&Ra(x)&&!Dd[s[h-1]])||!Dd[s[h]]?s[h]:Dd[s[h]]}return p}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&Jf[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Jf[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new qh;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Od.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(c)}addImageSection(t){const s=t.image?t.image.namePrimary:"";if(s.length===0)return void Xn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Od.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lm(l,t,s,c,p,h,m,x,T,A,y,I,M,E,C){const L=qh.fromFeature(l,p);I===Va.vertical&&L.verticalizePunctuation(M);let k=[];const V=function(J,se,pe,ue,he,Le){if(!J)return[];const ce=[],Me=function(Xe,Ye,Ze,ut,Et,ot){let jt=0;for(let Dt=0;Dt<Xe.length();Dt++){const Ct=Xe.getSection(Dt);jt+=Uy(Xe.getCodePoint(Dt),Ct,ut,Et,Ye,ot)}return jt/Math.max(1,Math.ceil(jt/Ze))}(J,se,pe,ue,he,Le),Fe=J.text.indexOf("")>=0;let ke=0;for(let Xe=0;Xe<J.length();Xe++){const Ye=J.getSection(Xe),Ze=J.getCodePoint(Xe);if(Jf[Ze]||(ke+=Uy(Ze,Ye,ue,he,se,Le)),Xe<J.length()-1){const ut=!((Ge=Ze)<11904||!(Yt["Bopomofo Extended"](Ge)||Yt.Bopomofo(Ge)||Yt["CJK Compatibility Forms"](Ge)||Yt["CJK Compatibility Ideographs"](Ge)||Yt["CJK Compatibility"](Ge)||Yt["CJK Radicals Supplement"](Ge)||Yt["CJK Strokes"](Ge)||Yt["CJK Symbols and Punctuation"](Ge)||Yt["CJK Unified Ideographs Extension A"](Ge)||Yt["CJK Unified Ideographs"](Ge)||Yt["Enclosed CJK Letters and Months"](Ge)||Yt["Halfwidth and Fullwidth Forms"](Ge)||Yt.Hiragana(Ge)||Yt["Ideographic Description Characters"](Ge)||Yt["Kangxi Radicals"](Ge)||Yt["Katakana Phonetic Extensions"](Ge)||Yt.Katakana(Ge)||Yt["Vertical Forms"](Ge)||Yt["Yi Radicals"](Ge)||Yt["Yi Syllables"](Ge)));(Yb[Ze]||ut||Ye.imageName)&&ce.push(qy(Xe+1,ke,Me,ce,Jb(Ze,J.getCodePoint(Xe+1),ut&&Fe),!1))}}var Ge;return jy(qy(J.length(),ke,Me,ce,0,!0))}(L,A,h,t,c,E),{processBidirectionalText:j,processStyledBidirectionalText:Z}=nr;if(j&&L.sections.length===1){const J=j(L.toString(),V);for(const se of J){const pe=new qh;pe.text=se,pe.sections=L.sections;for(let ue=0;ue<se.length;ue++)pe.sectionIndex.push(0);k.push(pe)}}else if(Z){const J=Z(L.text,L.sectionIndex,V);for(const se of J){const pe=new qh;pe.text=se[0],pe.sectionIndex=se[1],pe.sections=L.sections,k.push(pe)}}else k=function(J,se){const pe=[],ue=J.text;let he=0;for(const Le of se)pe.push(J.substring(he,Le)),he=Le;return he<ue.length&&pe.push(J.substring(he,ue.length)),pe}(L,V);const G=[],Y={positionedLines:G,text:L.toString(),top:y[1],bottom:y[1],left:y[0],right:y[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(J,se,pe,ue,he,Le,ce,Me,Fe,ke,Ge,Xe){let Ye=0,Ze=0,ut=0;const Et=Me==="right"?1:Me==="left"?0:.5;let ot=!1;for(const qt of he){const $t=qt.getSections();for(const wn of $t){if(wn.imageName)continue;const Ln=se[wn.fontStack];if(Ln&&(ot=Ln.ascender!==void 0&&Ln.descender!==void 0,!ot))break}if(!ot)break}let jt=0;for(const qt of he){qt.trim();const $t=qt.getMaxScale(),wn=($t-1)*Ns,Ln={positionedGlyphs:[],lineOffset:0};J.positionedLines[jt]=Ln;const Rn=Ln.positionedGlyphs;let Mn=0;if(!qt.length()){Ze+=Le,++jt;continue}let Bn=0,Nn=0;for(let Li=0;Li<qt.length();Li++){const gn=qt.getSection(Li),gi=qt.getSectionIndex(Li),yi=qt.getCodePoint(Li);let Hi=gn.scale,_r=null,Ar=null,yr=null,sr=Ns,wr=0;const Vr=!(Fe===Va.horizontal||!Ge&&!hl(yi)||Ge&&(Jf[yi]||(Dt=yi,Yt.Arabic(Dt)||Yt["Arabic Supplement"](Dt)||Yt["Arabic Extended-A"](Dt)||Yt["Arabic Presentation Forms-A"](Dt)||Yt["Arabic Presentation Forms-B"](Dt))));if(gn.imageName){const zs=ue[gn.imageName];if(!zs)continue;yr=gn.imageName,J.iconsInText=J.iconsInText||!0,Ar=zs.paddedRect;const Gi=zs.displaySize;Hi=Hi*Ns/Xe,_r={width:Gi[0],height:Gi[1],left:0,top:-Vy,advance:Vr?Gi[1]:Gi[0],localGlyph:!1},wr=ot?-_r.height*Hi:$t*Ns-17-Gi[1]*Hi,sr=_r.advance;const Vo=(Vr?Gi[0]:Gi[1])*Hi-Ns*$t;Vo>0&&Vo>Mn&&(Mn=Vo)}else{const zs=pe[gn.fontStack];if(!zs)continue;zs[yi]&&(Ar=zs[yi]);const Gi=se[gn.fontStack];if(!Gi)continue;const Vo=Gi.glyphs[yi];if(!Vo)continue;if(_r=Vo.metrics,sr=yi!==8203?Ns:0,ot){const su=Gi.ascender!==void 0?Math.abs(Gi.ascender):0,wl=Gi.descender!==void 0?Math.abs(Gi.descender):0,El=(su+wl)*Hi;Bn<El&&(Bn=El,Nn=(su-wl)/2*Hi),wr=-su*Hi}else wr=($t-Hi)*Ns-17}Vr?(J.verticalizable=!0,Rn.push({glyph:yi,imageName:yr,x:Ye,y:Ze+wr,vertical:Vr,scale:Hi,localGlyph:_r.localGlyph,fontStack:gn.fontStack,sectionIndex:gi,metrics:_r,rect:Ar}),Ye+=sr*Hi+ke):(Rn.push({glyph:yi,imageName:yr,x:Ye,y:Ze+wr,vertical:Vr,scale:Hi,localGlyph:_r.localGlyph,fontStack:gn.fontStack,sectionIndex:gi,metrics:_r,rect:Ar}),Ye+=_r.advance*Hi+ke)}Rn.length!==0&&(ut=Math.max(Ye-ke,ut),ot?Hy(Rn,Et,Mn,Nn,Le*$t/2):Hy(Rn,Et,Mn,0,Le/2)),Ye=0;const zi=Le*$t+Mn;Ln.lineOffset=Math.max(Mn,wn),Ze+=zi,++jt}var Dt;const Ct=Ze,{horizontalAlign:bt,verticalAlign:an}=Rm(ce);(function(qt,$t,wn,Ln,Rn,Mn){const Bn=($t-wn)*Rn,Nn=-Mn*Ln;for(const zi of qt)for(const Li of zi.positionedGlyphs)Li.x+=Bn,Li.y+=Nn})(J.positionedLines,Et,bt,an,ut,Ct),J.top+=-an*Ct,J.bottom=J.top+Ct,J.left+=-bt*ut,J.right=J.left+ut,J.hasBaseline=ot}(Y,t,s,c,k,m,x,T,I,A,M,C),!function(J){for(const se of J)if(se.positionedGlyphs.length!==0)return!1;return!0}(G)&&Y}const Jf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Uy(l,t,s,c,p,h){if(t.imageName){const m=c[t.imageName];return m?m.displaySize[0]*t.scale*Ns/h+p:0}{const m=s[t.fontStack],x=m&&m.glyphs[l];return x?x.metrics.advance*t.scale+p:0}}function Gy(l,t,s,c){const p=Math.pow(l-t,2);return c?l<t?p/2:2*p:p+Math.abs(s)*s}function Jb(l,t,s){let c=0;return l===10&&(c-=1e4),s&&(c+=150),l!==40&&l!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function qy(l,t,s,c,p,h){let m=null,x=Gy(t,s,p,h);for(const T of c){const A=Gy(t-T.x,s,p,h)+T.badness;A<=x&&(m=T,x=A)}return{index:l,x:t,priorBreak:m,badness:x}}function jy(l){return l?jy(l.priorBreak).concat(l.index):[]}function Rm(l){let t=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function Hy(l,t,s,c,p){if(!(t||s||c||p))return;const h=l.length-1,m=l[h],x=(m.x+m.metrics.advance*m.scale)*t;for(let T=0;T<=h;T++)l[T].x-=x,l[T].y+=s+c+p}function Kb(l,t,s,c){const{horizontalAlign:p,verticalAlign:h}=Rm(c),m=s[0]-l.displaySize[0]*p,x=s[1]-l.displaySize[1]*h;return{imagePrimary:l,imageSecondary:t,top:x,bottom:x+l.displaySize[1],left:m,right:m+l.displaySize[0]}}function Zy(l,t,s,c,p,h){const m=l.imagePrimary;let x;if(m.content){const k=m.content,V=m.pixelRatio||1;x=[k[0]/V,k[1]/V,m.displaySize[0]-k[2]/V,m.displaySize[1]-k[3]/V]}const T=t.left*h,A=t.right*h;let y,I,M,E;s==="width"||s==="both"?(E=p[0]+T-c[3],I=p[0]+A+c[1]):(E=p[0]+(T+A-m.displaySize[0])/2,I=E+m.displaySize[0]);const C=t.top*h,L=t.bottom*h;return s==="height"||s==="both"?(y=p[1]+C-c[0],M=p[1]+L+c[2]):(y=p[1]+(C+L-m.displaySize[1])/2,M=y+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:y,right:I,bottom:M,left:E,collisionPadding:x}}class vc extends Lt{constructor(t,s,c,p,h){super(t,s),this.angle=p,this.z=c,h!==void 0&&(this.segment=h)}clone(){return new vc(this.x,this.y,this.z,this.angle,this.segment)}}function Wy(l,t,s,c,p){if(t.segment===void 0)return!0;let h=t,m=t.segment+1,x=0;for(;x>-s/2;){if(m--,m<0)return!1;x-=l[m].dist(h),h=l[m]}x+=l[m].dist(l[m+1]),m++;const T=[];let A=0;for(;x<s/2;){const y=l[m],I=l[m+1];if(!I)return!1;let M=l[m-1].angleTo(y)-y.angleTo(I);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:M}),A+=M;x-T[0].distance>c;)A-=T.shift().angleDelta;if(A>p)return!1;m++,x+=y.dist(I)}return!0}function $y(l){let t=0;for(let s=0;s<l.length-1;s++)t+=l[s].dist(l[s+1]);return t}function Xy(l,t,s){return l?.6*t*s:0}function Yy(l,t){return Math.max(l?l.right-l.left:0,t?t.right-t.left:0)}function Qb(l,t,s,c,p,h){const m=Xy(s,p,h),x=Yy(s,c)*h;let T=0;const A=$y(l)/2;for(let y=0;y<l.length-1;y++){const I=l[y],M=l[y+1],E=I.dist(M);if(T+E>A){const C=(A-T)/E,L=ln(I.x,M.x,C),k=ln(I.y,M.y,C),V=new vc(L,k,0,M.angleTo(I),y);return!m||Wy(l,V,x,m,t)?V:void 0}T+=E}}function ew(l,t,s,c,p,h,m,x,T){const A=Xy(c,h,m),y=Yy(c,p),I=y*m,M=l[0].x===0||l[0].x===T||l[0].y===0||l[0].y===T;return t-I<t/4&&(t=I+t/4),Jy(l,M?t/2*x%t:(y/2+2*h)*m*x%t,t,A,s,I,M,!1,T)}function Jy(l,t,s,c,p,h,m,x,T){const A=h/2,y=$y(l);let I=0,M=t-s,E=[];for(let C=0;C<l.length-1;C++){const L=l[C],k=l[C+1],V=L.dist(k),j=k.angleTo(L);for(;M+s<I+V;){M+=s;const Z=(M-I)/V,G=ln(L.x,k.x,Z),Y=ln(L.y,k.y,Z);if(G>=0&&G<T&&Y>=0&&Y<T&&M-A>=0&&M+A<=y){const J=new vc(G,Y,0,j,C);c&&!Wy(l,J,h,c,p)||E.push(J)}}I+=V}return x||E.length||m||(E=Jy(l,I/2,s,c,p,h,m,!0,T)),E}function Ky(l,t,s,c,p){const h=[];for(let m=0;m<l.length;m++){const x=l[m];let T;for(let A=0;A<x.length-1;A++){let y=x[A],I=x[A+1];y.x<t&&I.x<t||(y.x<t?y=new Lt(t,y.y+(t-y.x)/(I.x-y.x)*(I.y-y.y))._round():I.x<t&&(I=new Lt(t,y.y+(t-y.x)/(I.x-y.x)*(I.y-y.y))._round()),y.y<s&&I.y<s||(y.y<s?y=new Lt(y.x+(s-y.y)/(I.y-y.y)*(I.x-y.x),s)._round():I.y<s&&(I=new Lt(y.x+(s-y.y)/(I.y-y.y)*(I.x-y.x),s)._round()),y.x>=c&&I.x>=c||(y.x>=c?y=new Lt(c,y.y+(c-y.x)/(I.x-y.x)*(I.y-y.y))._round():I.x>=c&&(I=new Lt(c,y.y+(c-y.x)/(I.x-y.x)*(I.y-y.y))._round()),y.y>=p&&I.y>=p||(y.y>=p?y=new Lt(y.x+(p-y.y)/(I.y-y.y)*(I.x-y.x),p)._round():I.y>=p&&(I=new Lt(y.x+(p-y.y)/(I.y-y.y)*(I.x-y.x),p)._round()),T&&y.equals(T[T.length-1])||(T=[y],h.push(T)),T.push(I)))))}}return h}function Qy(l){let t=0,s=0;for(const m of l)t+=m.w*m.h,s=Math.max(s,m.w);l.sort((m,x)=>x.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let p=0,h=0;for(const m of l)for(let x=c.length-1;x>=0;x--){const T=c[x];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,h=Math.max(h,m.y+m.h),p=Math.max(p,m.x+m.w),m.w===T.w&&m.h===T.h){const A=c.pop();x<c.length&&(c[x]=A)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(c.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:p,h,fill:t/(p*h)||0}}Gt(vc,"Anchor");const Nd=1;class Dm{constructor(t,{pixelRatio:s,version:c,stretchX:p,stretchY:h,content:m},x){this.paddedRect=t,this.pixelRatio=s,this.stretchX=p,this.stretchY=h,this.content=m,this.version=c,this.padding=x}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class e0{constructor(t,s,c){const p={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,p,Nd,m),this.addImages(s,h,2,m);const{w:x,h:T}=Qy(m),A=new to({width:x||1,height:T||1});for(const y in t){const I=t[y],M=p[y].paddedRect;to.copy(I.data,A,{x:0,y:0},{x:M.x+Nd,y:M.y+Nd},I.data,c,I.sdf)}for(const y in s){const I=s[y],M=h[y].paddedRect;let E=h[y].padding;const C=M.x+E,L=M.y+E,k=I.data.width,V=I.data.height;E=E>1?E-1:E,to.copy(I.data,A,{x:0,y:0},{x:C,y:L},I.data,c),to.copy(I.data,A,{x:0,y:V-E},{x:C,y:L-E},{width:k,height:E},c),to.copy(I.data,A,{x:0,y:0},{x:C,y:L+V},{width:k,height:E},c),to.copy(I.data,A,{x:k-E,y:0},{x:C-E,y:L},{width:E,height:V},c),to.copy(I.data,A,{x:0,y:0},{x:C+k,y:L},{width:E,height:V},c),to.copy(I.data,A,{x:k-E,y:V-E},{x:C-E,y:L-E},{width:E,height:E},c),to.copy(I.data,A,{x:0,y:V-E},{x:C+k,y:L-E},{width:E,height:E},c),to.copy(I.data,A,{x:0,y:0},{x:C+k,y:L+V},{width:E,height:E},c),to.copy(I.data,A,{x:k-E,y:0},{x:C-E,y:L+V},{width:E,height:E},c)}this.image=A,this.iconPositions=p,this.patternPositions=h}addImages(t,s,c,p){for(const h in t){const m=t[h],x={x:0,y:0,w:m.data.width+2*c,h:m.data.height+2*c};p.push(x),s[h]=new Dm(x,m,c),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,s,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>t.hasImage(p,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const p in t.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[p],t.getImage(p,c),s),this.patchUpdatedImage(this.patternPositions[p],t.getImage(p,c),s)}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[p,h]=t.tl;c.update(s.data,{position:{x:p,y:h}})}}Gt(Dm,"ImagePosition"),Gt(e0,"ImageAtlas");const zd=1e20;function t0(l,t,s,c,p,h,m,x,T){for(let A=t;A<t+c;A++)n0(l,s*h+A,h,p,m,x,T);for(let A=s;A<s+p;A++)n0(l,A*h+t,1,c,m,x,T)}function n0(l,t,s,c,p,h,m){h[0]=0,m[0]=-zd,m[1]=zd,p[0]=l[t];for(let x=1,T=0,A=0;x<c;x++){p[x]=l[t+x*s];const y=x*x;do{const I=h[T];A=(p[x]-p[I]+y-I*I)/(x-I)/2}while(A<=m[T]&&--T>-1);T++,h[T]=x,m[T]=A,m[T+1]=zd}for(let x=0,T=0;x<c;x++){for(;m[T+1]<x;)T++;const A=h[T],y=x-A;l[t+x*s]=p[A]+y*y}}const tu=2,Om={none:0,ideographs:1,all:2};class jh{constructor(t,s,c){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,s){this.urls[s]=t}getGlyphs(t,s,c){const p=[],h=this.urls[s]||ge.GLYPHS_URL;for(const m in t)for(const x of t[m])p.push({stack:m,id:x});dr(p,({stack:m,id:x},T)=>{let A=this.entries[m];A||(A=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=A.glyphs[x];if(y!==void 0)return void T(null,{stack:m,id:x,glyph:y});if(y=this._tinySDF(A,m,x),y)return A.glyphs[x]=y,void T(null,{stack:m,id:x,glyph:y});const I=Math.floor(x/256);if(256*I>65535)return Xn("glyphs > 65535 not supported"),void T(null,{stack:m,id:x,glyph:y});if(A.ranges[I])return void T(null,{stack:m,id:x,glyph:y});let M=A.requests[I];M||(M=A.requests[I]=[],jh.loadGlyphRange(m,I,h,this.requestManager,(E,C)=>{if(C){A.ascender=C.ascender,A.descender=C.descender;for(const L in C.glyphs)this._doesCharSupportLocalGlyph(+L)||(A.glyphs[+L]=C.glyphs[+L]);A.ranges[I]=!0}for(const L of M)L(E,C);delete A.requests[I]})),M.push((E,C)=>{E?T(E):C&&T(null,{stack:m,id:x,glyph:C.glyphs[x]||null})})},(m,x)=>{if(m)c(m);else if(x){const T={};for(const{stack:A,id:y,glyph:I}of x)T[A]===void 0&&(T[A]={}),T[A].glyphs===void 0&&(T[A].glyphs={}),T[A].glyphs[y]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},T[A].ascender=this.entries[A].ascender,T[A].descender=this.entries[A].descender;c(null,T)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Om.none&&(this.localGlyphMode===Om.all?!!this.localFontFamily:!!this.localFontFamily&&(Yt["CJK Unified Ideographs"](t)||Yt["Hangul Syllables"](t)||Yt.Hiragana(t)||Yt.Katakana(t)||Yt["CJK Symbols and Punctuation"](t)||Yt["CJK Unified Ideographs Extension A"](t)||Yt["CJK Unified Ideographs Extension B"](t)||Yt.Osage(t)))}_tinySDF(t,s,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let h=t.tinySDF;if(!h){let L="400";/bold/i.test(s)?L="900":/medium/i.test(s)?L="500":/light/i.test(s)&&(L="200"),h=t.tinySDF=new jh.TinySDF({fontFamily:p,fontWeight:L,fontSize:24*tu,buffer:3*tu,radius:8*tu}),h.fontWeight=L}if(this.localGlyphs[h.fontWeight][c])return this.localGlyphs[h.fontWeight][c];const m=String.fromCodePoint(c),{data:x,width:T,height:A,glyphWidth:y,glyphHeight:I,glyphLeft:M,glyphTop:E,glyphAdvance:C}=h.draw(m);return this.localGlyphs[h.fontWeight][c]={id:c,bitmap:new Hc({width:T,height:A},x),metrics:{width:y/tu,height:I/tu,left:M/tu,top:E/tu-27,advance:C/tu,localGlyph:!0}}}}jh.loadGlyphRange=function(l,t,s,c,p){const h=256*t,m=h+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",l).replace("{range}",`${h}-${m}`),Er.Glyphs);oo(x,(T,A)=>{if(T)p(T);else if(A){const y={},I=function(M){return new Yf(M).readFields(Wb,{})}(A);for(const M of I.glyphs)y[M.id]=M;p(null,{glyphs:y,ascender:I.ascender,descender:I.descender})}})},jh.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:h="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const x=this.size=l+4*t,T=this._createCanvas(x),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${m} ${h} ${l}px ${p}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(l){const t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:h}=this.ctx.measureText(l),m=Math.ceil(s),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-p))),T=Math.min(this.size-this.buffer,m+Math.ceil(c)),A=x+2*this.buffer,y=T+2*this.buffer,I=Math.max(A*y,0),M=new Uint8ClampedArray(I),E={data:M,width:A,height:y,glyphWidth:x,glyphHeight:T,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(x===0||T===0)return E;const{ctx:C,buffer:L,gridInner:k,gridOuter:V}=this;C.clearRect(L,L,x,T),C.fillText(l,L,L+m);const j=C.getImageData(L,L,x,T);V.fill(zd,0,I),k.fill(0,0,I);for(let Z=0;Z<T;Z++)for(let G=0;G<x;G++){const Y=j.data[4*(Z*x+G)+3]/255;if(Y===0)continue;const J=(Z+L)*A+G+L;if(Y===1)V[J]=0,k[J]=zd;else{const se=.5-Y;V[J]=se>0?se*se:0,k[J]=se<0?se*se:0}}t0(V,0,0,A,y,A,this.f,this.v,this.z),t0(k,L,L,x,T,A,this.f,this.v,this.z);for(let Z=0;Z<I;Z++){const G=Math.sqrt(V[Z])-Math.sqrt(k[Z]);M[Z]=Math.round(255-255*(G/this.radius+this.cutoff))}return E}};const Wc=Nd;function i0(l,t,s,c,p=1){const h=[],m=l.imagePrimary,x=m.pixelRatio,T=m.paddedRect.w-2*Wc,A=m.paddedRect.h-2*Wc,y=(l.right-l.left)*p,I=(l.bottom-l.top)*p,M=m.stretchX||[[0,T]],E=m.stretchY||[[0,A]],C=(ce,Me)=>ce+Me[1]-Me[0],L=M.reduce(C,0),k=E.reduce(C,0),V=T-L,j=A-k;let Z=0,G=L,Y=0,J=k,se=0,pe=V,ue=0,he=j;if(m.content&&c){const ce=m.content;Z=Kf(M,0,ce[0]),Y=Kf(E,0,ce[1]),G=Kf(M,ce[0],ce[2]),J=Kf(E,ce[1],ce[3]),se=ce[0]-Z,ue=ce[1]-Y,pe=ce[2]-ce[0]-G,he=ce[3]-ce[1]-J}const Le=(ce,Me,Fe,ke)=>{const Ge=Qf(ce.stretch-Z,G,y,l.left*p),Xe=ep(ce.fixed-se,pe,ce.stretch,L),Ye=Qf(Me.stretch-Y,J,I,l.top*p),Ze=ep(Me.fixed-ue,he,Me.stretch,k),ut=Qf(Fe.stretch-Z,G,y,l.left*p),Et=ep(Fe.fixed-se,pe,Fe.stretch,L),ot=Qf(ke.stretch-Y,J,I,l.top*p),jt=ep(ke.fixed-ue,he,ke.stretch,k),Dt=new Lt(Ge,Ye),Ct=new Lt(ut,Ye),bt=new Lt(ut,ot),an=new Lt(Ge,ot),qt=new Lt(Xe/x,Ze/x),$t=new Lt(Et/x,jt/x),wn=t*Math.PI/180;if(wn){const zi=Math.sin(wn),Li=Math.cos(wn),gn=[Li,-zi,zi,Li];Dt._matMult(gn),Ct._matMult(gn),an._matMult(gn),bt._matMult(gn)}const Ln=ce.stretch+ce.fixed,Rn=Fe.stretch+Fe.fixed,Mn=Me.stretch+Me.fixed,Bn=ke.stretch+ke.fixed,Nn=l.imageSecondary;return{tl:Dt,tr:Ct,bl:an,br:bt,texPrimary:{x:m.paddedRect.x+Wc+Ln,y:m.paddedRect.y+Wc+Mn,w:Rn-Ln,h:Bn-Mn},texSecondary:Nn?{x:Nn.paddedRect.x+Wc+Ln,y:Nn.paddedRect.y+Wc+Mn,w:Rn-Ln,h:Bn-Mn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qt,pixelOffsetBR:$t,minFontScaleX:pe/x/y,minFontScaleY:he/x/I,isSDF:s}};if(c&&(m.stretchX||m.stretchY)){const ce=r0(M,V,L),Me=r0(E,j,k);for(let Fe=0;Fe<ce.length-1;Fe++){const ke=ce[Fe],Ge=ce[Fe+1];for(let Xe=0;Xe<Me.length-1;Xe++)h.push(Le(ke,Me[Xe],Ge,Me[Xe+1]))}}else h.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return h}function Kf(l,t,s){let c=0;for(const p of l)c+=Math.max(t,Math.min(s,p[1]))-Math.max(t,Math.min(s,p[0]));return c}function r0(l,t,s){const c=[{fixed:-Wc,stretch:0}];for(const[p,h]of l){const m=c[c.length-1];c.push({fixed:p-m.stretch,stretch:m.stretch}),c.push({fixed:p-m.stretch,stretch:m.stretch+(h-p)})}return c.push({fixed:t+Wc,stretch:s}),c}function Qf(l,t,s,c){return l/t*s+c}function ep(l,t,s,c){return l-t*s/c}function tw(l,t,s,c){const p=t+l.positionedLines[c].lineOffset;return c===0?s+p/2:s+(p+(t+l.positionedLines[c-1].lineOffset))/2}function nw(l,t=1,s=!1){let c=1/0,p=1/0,h=-1/0,m=-1/0;const x=l[0];for(let E=0;E<x.length;E++){const C=x[E];(!E||C.x<c)&&(c=C.x),(!E||C.y<p)&&(p=C.y),(!E||C.x>h)&&(h=C.x),(!E||C.y>m)&&(m=C.y)}const T=Math.min(h-c,m-p);let A=T/2;const y=new Xo([],iw);if(T===0)return new Lt(c,p);for(let E=c;E<h;E+=T)for(let C=p;C<m;C+=T)y.push(new Hh(E+A,C+A,A,l));let I=function(E){let C=0,L=0,k=0;const V=E[0];for(let j=0,Z=V.length,G=Z-1;j<Z;G=j++){const Y=V[j],J=V[G],se=Y.x*J.y-J.x*Y.y;L+=(Y.x+J.x)*se,k+=(Y.y+J.y)*se,C+=3*se}return new Hh(L/C,k/C,0,E)}(l),M=y.length;for(;y.length;){const E=y.pop();(E.d>I.d||!I.d)&&(I=E,s&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,M)),E.max-I.d<=t||(A=E.h/2,y.push(new Hh(E.p.x-A,E.p.y-A,A,l)),y.push(new Hh(E.p.x+A,E.p.y-A,A,l)),y.push(new Hh(E.p.x-A,E.p.y+A,A,l)),y.push(new Hh(E.p.x+A,E.p.y+A,A,l)),M+=4)}return s&&(console.log(`num probes: ${M}`),console.log(`best distance: ${I.d}`)),I.p}function iw(l,t){return t.max-l.max}class Hh{constructor(t,s,c,p){this.p=new Lt(t,s),this.h=c,this.d=function(h,m){let x=!1,T=1/0;for(let A=0;A<m.length;A++){const y=m[A];for(let I=0,M=y.length,E=M-1;I<M;E=I++){const C=y[I],L=y[E];C.y>h.y!=L.y>h.y&&h.x<(L.x-C.x)*(h.y-C.y)/(L.y-C.y)+C.x&&(x=!x),T=Math.min(T,hn(h,C,L))}}return(x?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Nm=Number.POSITIVE_INFINITY,rw=Math.sqrt(2);function s0(l,[t,s]){let c=0,p=0;if(s===Nm){t<0&&(t=0);const h=t/rw;switch(l){case"top-right":case"top-left":p=h-7;break;case"bottom-right":case"bottom-left":p=7-h;break;case"bottom":p=7-t;break;case"top":p=t-7}switch(l){case"top-right":case"bottom-right":c=-h;break;case"top-left":case"bottom-left":c=h;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),s=Math.abs(s),l){case"top-right":case"top-left":case"top":p=s-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-s}switch(l){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,p]}function zm(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sw(l,t,s,c,p,h,m,x,T,A,y,I,M,E,C){let L=h.textMaxSize.evaluate(t,{},I);L===void 0?L=m*h.textScaleFactor:L*=h.textScaleFactor;const k=l.layers[0].layout,V=k.get("icon-offset").evaluate(t,{},I),j=a0(s.horizontal)||s.vertical,Z=M.name==="globe",G=Ns,Y=m*h.textScaleFactor/G,J=l.tilePixelRatio*L/G,se=(ke=l.overscaling,l.zoom>18&&ke>2&&(ke>>=1),Math.max(Mt/(512*ke),1)*k.get("symbol-spacing")),pe=k.get("text-padding")*l.tilePixelRatio,ue=k.get("icon-padding")*l.tilePixelRatio,he=pn(k.get("text-max-angle")),Le=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",ce=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Me=k.get("symbol-placement"),Fe=se/2;var ke;const Ge=k.get("icon-text-fit").evaluate(t,{},I),Xe=k.get("icon-text-fit-padding").evaluate(t,{},I),Ye=Ge!=="none";let Ze;l.hasAnyIconTextFit===!1&&Ye&&(l.hasAnyIconTextFit=!0),c&&Ye&&(l.allowVerticalPlacement&&s.vertical&&(Ze=Zy(c,s.vertical,Ge,Xe,V,Y)),j&&(c=Zy(c,j,Ge,Xe,V,Y)));const ut=(Et,ot,jt)=>{if(ot.x<0||ot.x>=Mt||ot.y<0||ot.y>=Mt)return;let Dt=null;if(Z){const{x:Ct,y:bt,z:an}=M.projectTilePoint(ot.x,ot.y,jt);Dt={anchor:new vc(Ct,bt,an,0,void 0),up:M.upVector(jt,ot.x,ot.y)}}(function(Ct,bt,an,qt,$t,wn,Ln,Rn,Mn,Bn,Nn,zi,Li,gn,gi,yi,Hi,_r,Ar,yr,sr,wr,Vr,zs,Gi,Vo,su){const wl=Ct.addToLineVertexArray(bt,qt);let El,Eh,Kc,Ih,tf,Cv,Mv,Av=0,Pv=0,Lv=0,Rv=0,hg=-1,dg=-1;const ku={};let Dv=ns("");const Th=an?an.anchor:bt,fg=Mn.layout.get("icon-text-fit").evaluate(sr,{},Gi)!=="none";let pg=0,mg=0;if(Mn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[pg,mg]=Mn.layout.get("text-offset").evaluate(sr,{},Gi).map(ca=>ca*Ns):(pg=Mn.layout.get("text-radial-offset").evaluate(sr,{},Gi)*Ns,mg=Nm),Ct.allowVerticalPlacement&&$t.vertical){const ca=$t.vertical;if(gi)Cv=Fm(ca),Rn&&(Mv=Fm(Rn));else{const ha=Mn.layout.get("text-rotate").evaluate(sr,{},Gi)+90;Kc=tp(Bn,Th,bt,Nn,zi,Li,ca,gn,ha,yi),Rn&&(Ih=tp(Bn,Th,bt,Nn,zi,Li,Rn,_r,ha))}}if(wn){const ca=Mn.layout.get("icon-rotate").evaluate(sr,{},Gi),ha=i0(wn,ca,Vr,fg,wr.iconScaleFactor),Qh=Rn?i0(Rn,ca,Vr,fg,wr.iconScaleFactor):void 0;Eh=tp(Bn,Th,bt,Nn,zi,Li,wn,_r,ca),Av=4*ha.length;const Ov=Ct.iconSizeData;let Sh=null;Ov.kind==="source"?(Sh=[eu*Mn.layout.get("icon-size").evaluate(sr,{},Gi)*wr.iconScaleFactor],Sh[0]>$c&&Xn(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${Fd}. Reduce your "icon-size".`)):Ov.kind==="composite"&&(Sh=[eu*wr.compositeIconSizes[0].evaluate(sr,{},Gi)*wr.iconScaleFactor,eu*wr.compositeIconSizes[1].evaluate(sr,{},Gi)*wr.iconScaleFactor],(Sh[0]>$c||Sh[1]>$c)&&Xn(`${Ct.layerIds[0]}: Value for "icon-size" is >= ${Fd}. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,ha,Sh,yr,Ar,sr,!1,an,bt,wl.lineStartIndex,wl.lineLength,-1,zs,Gi,Vo,su),hg=Ct.icon.placedSymbolArray.length-1,Qh&&(Pv=4*Qh.length,Ct.addSymbols(Ct.icon,Qh,Sh,yr,Ar,sr,Va.vertical,an,bt,wl.lineStartIndex,wl.lineLength,-1,zs,Gi,Vo,su),dg=Ct.icon.placedSymbolArray.length-1)}for(const ca in $t.horizontal){const ha=$t.horizontal[ca];El||(Dv=ns(ha.text),gi?tf=Fm(ha):El=tp(Bn,Th,bt,Nn,zi,Li,ha,gn,Mn.layout.get("text-rotate").evaluate(sr,{},Gi),yi));const Qh=ha.positionedLines.length===1;if(Lv+=o0(Ct,an,bt,ha,Ln,Mn,gi,sr,yi,wl,$t.vertical?Va.horizontal:Va.horizontalOnly,Qh?Object.keys($t.horizontal):[ca],ku,hg,wr,zs,Gi,Vo),Qh)break}$t.vertical&&(Rv+=o0(Ct,an,bt,$t.vertical,Ln,Mn,gi,sr,yi,wl,Va.vertical,["vertical"],ku,dg,wr,zs,Gi,Vo));let Qc=-1;const gg=(ca,ha)=>ca?Math.max(ca,ha):ha;Qc=gg(tf,Qc),Qc=gg(Cv,Qc),Qc=gg(Mv,Qc);const xE=Qc>-1?1:0;Ct.glyphOffsetArray.length>=65535&&Xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sr.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,sr.sortKey),Ct.symbolInstances.emplaceBack(bt.x,bt.y,Th.x,Th.y,Th.z,ku.right>=0?ku.right:-1,ku.center>=0?ku.center:-1,ku.left>=0?ku.left:-1,ku.vertical>=0?ku.vertical:-1,hg,dg,Dv,El!==void 0?El:Ct.collisionBoxArray.length,El!==void 0?El+1:Ct.collisionBoxArray.length,Kc!==void 0?Kc:Ct.collisionBoxArray.length,Kc!==void 0?Kc+1:Ct.collisionBoxArray.length,Eh!==void 0?Eh:Ct.collisionBoxArray.length,Eh!==void 0?Eh+1:Ct.collisionBoxArray.length,Ih||Ct.collisionBoxArray.length,Ih?Ih+1:Ct.collisionBoxArray.length,Nn,Lv,Rv,Av,Pv,xE,0,pg,mg,Qc,0,fg?1:0)})(l,ot,Dt,Et,s,c,p,Ze,l.layers[0],l.collisionBoxArray,t.index,t.sourceLayerIndex,l.index,pe,Le,T,0,ue,ce,V,t,h,A,y,I,E,C)};if(Me==="line")for(const Et of Ky(t.geometry,0,0,Mt,Mt)){const ot=ew(Et,se,he,s.vertical||j,c,G,J,l.overscaling,Mt);for(const jt of ot)j&&ow(l,j.text,Fe,jt)||ut(Et,jt,I)}else if(Me==="line-center"){for(const Et of t.geometry)if(Et.length>1){const ot=Qb(Et,he,s.vertical||j,c,G,J);ot&&ut(Et,ot,I)}}else if(t.type==="Polygon")for(const Et of Gf(t.geometry,0)){const ot=nw(Et,16);ut(Et[0],new vc(ot.x,ot.y,0,0,void 0),I)}else if(t.type==="LineString")for(const Et of t.geometry)ut(Et,new vc(Et[0].x,Et[0].y,0,0,void 0),I);else if(t.type==="Point")for(const Et of t.geometry)for(const ot of Et)ut([ot],new vc(ot.x,ot.y,0,0,void 0),I)}const Fd=255,$c=Fd*eu;function o0(l,t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k,V){const j=function(Y,J,se,pe,ue,he,Le,ce){const Me=[];if(J.positionedLines.length===0)return Me;const Fe=pe.layout.get("text-rotate").evaluate(he,{})*Math.PI/180,ke=function(ut){const Et=ut[0],ot=ut[1],jt=Et*ot;return jt>0?[Et,-ot]:jt<0?[-Et,ot]:Et===0?[ot,Et]:[ot,-Et]}(se);let Ge=Math.abs(J.top-J.bottom);for(const ut of J.positionedLines)Ge-=ut.lineOffset;const Xe=J.positionedLines.length,Ye=Ge/Xe;let Ze=J.top-se[1];for(let ut=0;ut<Xe;++ut){const Et=J.positionedLines[ut];Ze=tw(J,Ye,Ze,ut);for(const ot of Et.positionedGlyphs){if(!ot.rect)continue;const jt=ot.rect||{};let Dt=Vy+1,Ct=!0,bt=1,an=0;if(ot.imageName){const yr=Le[ot.imageName];if(!yr)continue;if(yr.sdf){Xn("SDF images are not supported in formatted text and will be ignored.");continue}Ct=!1,bt=yr.pixelRatio,Dt=Nd/bt}const qt=(ue||ce)&&ot.vertical,$t=ot.metrics.advance*ot.scale/2,wn=ot.metrics,Ln=ot.rect;if(Ln===null)continue;ce&&J.verticalizable&&(an=ot.imageName?$t-ot.metrics.width*ot.scale/2:0);const Rn=ue?[ot.x+$t,ot.y]:[0,0];let Mn=[0,0],Bn=[0,0],Nn=!1;ue||(qt?(Bn=[ot.x+$t+ke[0],ot.y+ke[1]-an],Nn=!0):Mn=[ot.x+$t+se[0],ot.y+se[1]-an]);const zi=Ln.w*ot.scale/(bt*(ot.localGlyph?tu:1)),Li=Ln.h*ot.scale/(bt*(ot.localGlyph?tu:1));let gn,gi,yi,Hi;if(qt){const yr=ot.y-Ze,sr=new Lt(-$t,$t-yr),wr=-Math.PI/2,Vr=new Lt(...Bn);gn=new Lt(-$t+Mn[0],Mn[1]),gn._rotateAround(wr,sr)._add(Vr),gn.x+=-yr+$t,gn.y-=(wn.left-Dt)*ot.scale;const zs=ot.imageName?wn.advance*ot.scale:Ns*ot.scale,Gi=String.fromCodePoint(ot.glyph);jb(Gi)?gn.x+=(1-Dt)*ot.scale:Hb(Gi)?gn.x+=zs-wn.height*ot.scale+(-Dt-1)*ot.scale:gn.x+=ot.imageName||wn.width+2*Dt===Ln.w&&wn.height+2*Dt===Ln.h?(zs-Li)/2:(zs-(wn.height+2*Dt)*ot.scale)/2,gi=new Lt(gn.x,gn.y-zi),yi=new Lt(gn.x+Li,gn.y),Hi=new Lt(gn.x+Li,gn.y-zi)}else{const yr=(wn.left-Dt)*ot.scale-$t+Mn[0],sr=(-wn.top-Dt)*ot.scale+Mn[1],wr=yr+zi,Vr=sr+Li;gn=new Lt(yr,sr),gi=new Lt(wr,sr),yi=new Lt(yr,Vr),Hi=new Lt(wr,Vr)}if(Fe){let yr;yr=ue?new Lt(0,0):Nn?new Lt(ke[0],ke[1]):new Lt(se[0],se[1]),gn._rotateAround(Fe,yr),gi._rotateAround(Fe,yr),yi._rotateAround(Fe,yr),Hi._rotateAround(Fe,yr)}const _r=new Lt(0,0),Ar=new Lt(0,0);Me.push({tl:gn,tr:gi,bl:yi,br:Hi,texPrimary:jt,texSecondary:void 0,writingMode:J.writingMode,glyphOffset:Rn,sectionIndex:ot.sectionIndex,isSDF:Ct,pixelOffsetTL:_r,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}}return Me}(0,c,T,h,m,x,p,l.allowVerticalPlacement),Z=l.textSizeData;let G=null;Z.kind==="source"?(G=[eu*h.layout.get("text-size").evaluate(x,{},k)*C.textScaleFactor],G[0]>$c&&Xn(`${l.layerIds[0]}: Value for "text-size" is >= ${Fd}. Reduce your "text-size".`)):Z.kind==="composite"&&(G=[eu*C.compositeTextSizes[0].evaluate(x,{},k)*C.textScaleFactor,eu*C.compositeTextSizes[1].evaluate(x,{},k)*C.textScaleFactor],(G[0]>$c||G[1]>$c)&&Xn(`${l.layerIds[0]}: Value for "text-size" is >= ${Fd}. Reduce your "text-size".`)),l.addSymbols(l.text,j,G,T,m,x,y,t,s,A.lineStartIndex,A.lineLength,E,L,k,V,!1);for(const Y of I)M[Y]=l.text.placedSymbolArray.length-1;return 4*j.length}function a0(l){for(const t in l)return l[t];return null}function tp(l,t,s,c,p,h,m,x,T,A){let y=m.top,I=m.bottom,M=m.left,E=m.right;const C=m.collisionPadding;if(C&&(M-=C[0],y-=C[1],E+=C[2],I+=C[3]),T){const L=new Lt(M,y),k=new Lt(E,y),V=new Lt(M,I),j=new Lt(E,I),Z=pn(T);let G=new Lt(0,0);A&&(G=new Lt(A[0],A[1])),L._rotateAround(Z,G),k._rotateAround(Z,G),V._rotateAround(Z,G),j._rotateAround(Z,G),M=Math.min(L.x,k.x,V.x,j.x),E=Math.max(L.x,k.x,V.x,j.x),y=Math.min(L.y,k.y,V.y,j.y),I=Math.max(L.y,k.y,V.y,j.y)}return l.emplaceBack(t.x,t.y,t.z,s.x,s.y,M,y,E,I,x,c,p,h),l.length-1}function Fm(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const t=l.bottom-l.top;return t>0?Math.max(10,t):null}function ow(l,t,s,c){const p=l.compareText;if(t in p){const h=p[t];for(let m=h.length-1;m>=0;m--)if(c.dist(h[m])<s)return!0}else p[t]=[];return p[t].push(c),!1}function l0(l,t){const s=l.fovAboveCenter,c=l.elevation?l.elevation.getMinElevationBelowMSL()*t:0,p=(l._camera.position[2]*l.worldSize-c)/Math.cos(l._pitch),h=Math.sin(s)*p/Math.sin(Math.max(Math.PI/2-l._pitch-s,.01));let m=Math.sin(l._pitch)*h+p;const x=p*(1/l._horizonShift);return l.elevation&&l.elevation.exaggeration()!==0||(m*=1+Math.max(l.zoom-17,0)),Math.min(1.01*m,x)}function kd(l,t){if(!t.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:t};const s=Math.pow(2,-l.z),c=l.x*s,p=(l.x+1)*s,h=l.y*s,m=(l.y+1)*s,x=ae(c),T=ae(p),A=de(h),y=de(m),I=t.project(x,A),M=t.project(T,A),E=t.project(T,y),C=t.project(x,y);let L=Math.min(I.x,M.x,E.x,C.x),k=Math.min(I.y,M.y,E.y,C.y),V=Math.max(I.x,M.x,E.x,C.x),j=Math.max(I.y,M.y,E.y,C.y);const Z=s/16;function G(J,se,pe,ue,he,Le){const ce=(pe+he)/2,Me=(ue+Le)/2,Fe=t.project(ae(ce),de(Me)),ke=Math.max(0,L-Fe.x,k-Fe.y,Fe.x-V,Fe.y-j);L=Math.min(L,Fe.x),V=Math.max(V,Fe.x),k=Math.min(k,Fe.y),j=Math.max(j,Fe.y),ke>Z&&(G(J,Fe,pe,ue,ce,Me),G(Fe,se,ce,Me,he,Le))}G(I,M,c,h,p,h),G(M,E,p,h,p,m),G(E,C,p,m,c,m),G(C,I,c,m,c,h),L-=Z,k-=Z,V+=Z,j+=Z;const Y=1/Math.max(V-L,j-k);return{scale:Y,x:L*Y,y:k*Y,x2:V*Y,y2:j*Y,projection:t}}function u0(l,{x:t,y:s},c=0){return new Lt(((t-c)*l.scale-l.x)*Mt,(s*l.scale-l.y)*Mt)}const aw=Ve.mat4.identity(new Float32Array(16));class Xc{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new F(0,0)}projectTilePoint(t,s,c){return{x:t,y:s,z:0}}locationPoint(t,s,c=!0){return t._coordinatePoint(t.locationCoordinate(s),c)}pixelsPerMeter(t,s){return ie(1,t)*s}pixelSpaceConversion(t,s,c){return 1}farthestPixelDistance(t){return l0(t,t.pixelsPerMeter)}pointCoordinate(t,s,c,p){const h=t.horizonLineFromTop(!1),m=new Lt(s,Math.max(h,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(m,p))}pointCoordinate3D(t,s,c){const p=new Lt(s,c);if(t.elevation)return t.elevation.pointCoordinate(p);{const h=this.pointCoordinate(t,p.x,p.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(t,s){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,s.x,s.y);const c=t.horizonLineFromTop();return s.y<c}createInversionMatrix(t,s){return aw}createTileMatrix(t,s,c){let p,h,m;const x=c.canonical,T=Ve.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=kd(x,this);p=1,h=A.x+c.wrap*A.scale,m=A.y,Ve.mat4.scale(T,T,[p/A.scale,p/A.scale,t.pixelsPerMeter/s])}else p=s/t.zoomScale(x.z),h=(x.x+Math.pow(2,x.z)*c.wrap)*p,m=x.y*p;return Ve.mat4.translate(T,T,[h,m,0]),Ve.mat4.scale(T,T,[p/Mt,p/Mt,1]),T}upVector(t,s,c){return[0,0,1]}upVectorScale(t,s,c){return{metersToTile:1}}}class lw extends Xc{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[s,c]=this.parallels=t.parallels||[29.5,45.5],p=Math.sin(pn(s));this.n=(p+Math.sin(pn(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(t,s){const{n:c,c:p,r0:h}=this,m=pn(t-this.center[0]),x=pn(s),T=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:T*Math.sin(m*c),y:T*Math.cos(m*c)-h,z:0}}unproject(t,s){const{n:c,c:p,r0:h}=this,m=h+s;let x=Math.atan2(t,Math.abs(m))*Math.sign(m);m*c<0&&(x-=Math.PI*Math.sign(t)*Math.sign(m));const T=pn(this.center[0])*c;x=jo(x,-Math.PI-T,Math.PI-T);const A=nn(Lr(x/c)+this.center[0],-180,180),y=Math.asin(nn((p-(t*t+m*m)*c*c)/(2*c),-1,1)),I=nn(Lr(y),-be,be);return new F(A,I)}}const Bd=1.340264,Vd=-.081106,Ud=893e-6,Gd=.003796,np=Math.sqrt(3)/2;class uw extends Xc{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(np*Math.sin(s)),p=c*c,h=p*p*p;return{x:.5*(t*Math.cos(c)/(np*(Bd+3*Vd*p+h*(7*Ud+9*Gd*p)))/Math.PI+.5),y:1-.5*(c*(Bd+Vd*p+h*(Ud+Gd*p))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=c*c,h=p*p*p;for(let y,I,M,E=0;E<12&&(I=c*(Bd+Vd*p+h*(Ud+Gd*p))-s,M=Bd+3*Vd*p+h*(7*Ud+9*Gd*p),y=I/M,c=nn(c-y,-Math.PI/3,Math.PI/3),p=c*c,h=p*p*p,!(Math.abs(y)<1e-12));++E);const m=np*t*(Bd+3*Vd*p+h*(7*Ud+9*Gd*p))/Math.cos(c),x=Math.asin(Math.sin(c)/np),T=nn(180*m/Math.PI,-180,180),A=nn(180*x/Math.PI,-be,be);return new F(T,A)}}class cw extends Xc{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){const c=360*(t-.5),p=nn(360*(.5-s),-be,be);return new F(c,p)}}const Zh=Math.PI/2;function ip(l){return Math.tan((Zh+l)/2)}class hw extends Xc{constructor(t){super(t),this.center=t.center||[0,30];const[s,c]=this.parallels=t.parallels||[30,30];let p=pn(s),h=pn(c);this.southernCenter=p+h<0,this.southernCenter&&(p=-p,h=-h);const m=Math.cos(p),x=ip(p);this.n=p===h?Math.sin(p):Math.log(m/Math.cos(h))/Math.log(ip(h)/x),this.f=m*Math.pow(ip(p),this.n)/this.n}project(t,s){s=pn(s),this.southernCenter&&(s=-s),t=pn(t-this.center[0]);const c=1e-6,{n:p,f:h}=this;h>0?s<-Zh+c&&(s=-Zh+c):s>Zh-c&&(s=Zh-c);const m=h/Math.pow(ip(s),p);let x=m*Math.sin(p*t),T=h-m*Math.cos(p*t);return x=.5*(x/Math.PI+.5),T=.5*(T/Math.PI+.5),{x,y:this.southernCenter?T:1-T,z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:p}=this,h=p-s,m=Math.sign(h),x=Math.sign(c)*Math.sqrt(t*t+h*h);let T=Math.atan2(t,Math.abs(h))*m;h*c<0&&(T-=Math.PI*Math.sign(t)*m);const A=nn(Lr(T/c)+this.center[0],-180,180),y=nn(Lr(2*Math.atan(Math.pow(p/x,1/c))-Zh),-be,be);return new F(A,this.southernCenter?-y:y)}}class c0 extends Xc{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:K(t),y:re(s),z:0}}unproject(t,s){const c=ae(t),p=de(s);return new F(c,p)}}const h0=pn(be);class dw extends Xc{project(t,s){const c=(s=pn(s))*s,p=c*c;return{x:.5*((t=pn(t))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=25,h=0,m=c*c;do{m=c*c;const A=m*m;h=(c*(1.007226+m*(.015085+A*(.028874*m-.044475-.005916*A)))-s)/(1.007226+m*(.045255+A*(.259866*m-.311325-.005916*11*A))),c=nn(c-h,-h0,h0)}while(Math.abs(h)>1e-6&&--p>0);m=c*c;const x=nn(Lr(t/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),T=Lr(c);return new F(x,T)}}const d0=pn(be);class fw extends Xc{project(t,s){s=pn(s),t=pn(t);const c=Math.cos(s),p=2/Math.PI,h=Math.acos(c*Math.cos(t/2)),m=Math.sin(h)/h,x=.5*(t*p+2*c*Math.sin(t/2)/m)||0,T=.5*(s+Math.sin(s)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(t,s){let c=t=(2*t-.5)*Math.PI,p=s=(2*(1-s)-1)*Math.PI,h=25;const m=1e-6;let x=0,T=0;do{const A=Math.cos(p),y=Math.sin(p),I=2*y*A,M=y*y,E=A*A,C=Math.cos(c/2),L=Math.sin(c/2),k=2*C*L,V=L*L,j=1-E*C*C,Z=j?1/j:0,G=j?Math.acos(A*C)*Math.sqrt(1/j):0,Y=.5*(2*G*A*L+2*c/Math.PI)-t,J=.5*(G*y+p)-s,se=.5*Z*(E*V+G*A*C*M)+1/Math.PI,pe=Z*(k*I/4-G*y*L),ue=.125*Z*(I*L-G*y*E*k),he=.5*Z*(M*C+G*V*A)+.5,Le=pe*ue-he*se;x=(J*pe-Y*he)/Le,T=(Y*ue-J*se)/Le,c=nn(c-x,-Math.PI,Math.PI),p=nn(p-T,-d0,d0)}while((Math.abs(x)>m||Math.abs(T)>m)&&--h>0);return new F(Lr(c),Lr(p))}}class f0 extends Xc{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){const{scale:c,cosPhi:p}=this;return{x:pn(t)*p*c+.5,y:-Math.sin(pn(s))/p*c+.5,z:0}}unproject(t,s){const{scale:c,cosPhi:p}=this,h=-(s-.5)/c,m=nn(Lr((t-.5)/c)/p,-180,180),x=Math.asin(nn(h*p,-1,1)),T=nn(Lr(x),-be,be);return new F(m,T)}}class pw extends c0{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,s,c){const p=wd(t,s,c),h=kf(zu(c));return Ve.vec3.transformMat4(p,p,h),{x:p[0],y:p[1],z:p[2]}}locationPoint(t,s){const c=P(s.lat,s.lng),p=Ve.vec3.normalize([],c),h=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(s),t._centerAltitude):t._centerAltitude,m=ie(1,0)*Mt*h;Ve.vec3.scaleAndAdd(c,c,p,m);const x=Ve.mat4.identity(new Float64Array(16));return Ve.mat4.multiply(x,t.pixelMatrix,t.globeMatrix),Ve.vec3.transformMat4(c,c,x),new Lt(c[0],c[1])}pixelsPerMeter(t,s){return ie(1,0)*s}pixelSpaceConversion(t,s,c){const p=ie(1,t)*s,h=ln(ie(1,45)*s,p,c);return this.pixelsPerMeter(t,s)/h}createTileMatrix(t,s,c){const p=om(zu(c.canonical));return Ve.mat4.multiply(new Float64Array(16),t.globeMatrix,p)}createInversionMatrix(t,s){const{center:c}=t,p=kf(zu(s));return Ve.mat4.rotateY(p,p,pn(c.lng)),Ve.mat4.rotateX(p,p,pn(c.lat)),Ve.mat4.scale(p,p,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(t,s,c,p){return qc(t,s,c,!0)||new Be(0,0)}pointCoordinate3D(t,s,c){const p=this.pointCoordinate(t,s,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(t,s){return!qc(t,s.x,s.y,!1)}farthestPixelDistance(t){const s=function(p,h){const m=p.cameraToCenterDistance,x=p._centerAltitude*h,T=p._camera,A=p._camera.forward(),y=Ve.vec3.add([],Ve.vec3.scale([],A,-m),[0,0,x]),I=p.worldSize/(2*Math.PI),M=[0,0,-I],E=p.width/p.height,C=Math.tan(p.fovAboveCenter),L=Ve.vec3.scale([],T.up(),C),k=Ve.vec3.scale([],T.right(),C*E),V=Ve.vec3.normalize([],Ve.vec3.add([],Ve.vec3.add([],A,L),k)),j=[];let Z;if(new wo(y,V).closestPointOnSphere(M,I,j)){const G=Ve.vec3.add([],j,M),Y=Ve.vec3.sub([],G,y);Z=Math.cos(p.fovAboveCenter)*Ve.vec3.length(Y)}else{const G=Ve.vec3.sub([],y,M),Y=Ve.vec3.sub([],M,y);Ve.vec3.normalize(Y,Y);const J=Ve.vec3.length(G)-I;Z=Math.sqrt(J*(J+2*I));const se=Math.acos(Z/(I+J))-Math.acos(Ve.vec3.dot(A,Y));Z*=Math.cos(se)}return 1.01*Z}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=jc(t.zoom);if(c>0){const p=l0(t,ie(1,t.center.lat)*t.worldSize),h=t.worldSize/(2*Math.PI),m=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ln(s,p+h*(1-Math.cos(m)),Math.pow(c,10))}return s}upVector(t,s,c){return wd(s,c,t,1)}upVectorScale(t){return{metersToTile:Gc(Ff(zu(t)))}}}function p0(l){const t=l.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(l.name){case"mercator":return new c0(l);case"equirectangular":return new cw(l);case"naturalEarth":return new dw(l);case"equalEarth":return new uw(l);case"winkelTripel":return new fw(l);case"albers":return s?new f0(l):new lw(l);case"lambertConformalConic":return s?new f0(l):new hw(l);case"globe":return new pw(l)}throw new Error(`Invalid projection name: ${l.name}`)}const mw=Uh.VectorTileFeature.types,gw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rp(l,t,s,c,p,h,m,x,T,A,y,I,M){const E=x?Math.min($c,Math.round(x[0])):0,C=x?Math.min($c,Math.round(x[1])):0;l.emplaceBack(t,s,Math.round(32*c),Math.round(32*p),h,m,(E<<1)+(T?1:0),C,16*A,16*y,256*I,256*M)}function sp(l,t,s){l.emplaceBack(t,s)}function op(l,t,s,c,p,h,m){l.emplaceBack(t,s,c,p,h,m)}function ap(l,t,s,c,p){l.emplaceBack(t,s,c,p),l.emplaceBack(t,s,c,p),l.emplaceBack(t,s,c,p),l.emplaceBack(t,s,c,p)}function _w(l){for(const t of l.sections)if(Au(t.text))return!0;return!1}class km{constructor(t){this.layoutVertexArray=new Nu,this.indexArray=new O,this.programConfigurations=t,this.segments=new lr,this.dynamicLayoutVertexArray=new za,this.opacityVertexArray=new fh,this.placedSymbolArray=new pd,this.iconTransitioningVertexArray=new e,this.globeExtVertexArray=new dh,this.zOffsetVertexArray=new ye}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,s,c,p,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ob.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,zb.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,gw,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,kb.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Nb.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Fb.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Gt(km,"SymbolBuffers");class Bm{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new lr,this.collisionVertexArray=new w,this.collisionVertexArrayExt=new za}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Bb.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Vb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gt(Bm,"CollisionBuffers");class lp{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ve.mat4.identity([]),this.placementViewportMatrix=Ve.mat4.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cm(this.zoom,s["text-size"]),this.iconSizeData=Cm(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),h=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Va[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new km(new vl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new km(new vl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Tf,this.lineVertexArray=new zh,this.symbolInstances=new md}calculateGlyphDependencies(t,s,c,p,h){for(const m of t){const x=m.codePointAt(0);if(x===void 0)break;if(s[x]=!0,p&&h&&x<=65535){const T=Dd[m];T&&(s[T.charCodeAt(0)]=!0)}}}updateFootprints(t,s){}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!xm(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(t,s,c,p){const h=this.layers[0],m=h.layout,x=this.projection.name==="globe",T=m.get("text-font"),A=m.get("text-field"),y=m.get("icon-image"),I=(A.value.kind!=="constant"||A.value.value instanceof Nr&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),M=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,E=m.get("symbol-sort-key");if(this.features=[],!I&&!M)return;const C=s.iconDependencies,L=s.glyphDependencies,k=s.availableImages,V=new Ui(this.zoom);for(const{feature:j,id:Z,index:G,sourceLayerIndex:Y}of t){const J=h._featureFilter.needGeometry,se=gt(j,J);if(!h._featureFilter.filter(V,se,c))continue;if(J||(se.geometry=He(j,c,p)),x&&j.type!==1&&c.z<=5){const Le=se.geometry,ce=.98078528056,Me=(Fe,ke)=>{const Ge=wd(Fe.x,Fe.y,c,1),Xe=wd(ke.x,ke.y,c,1);return Ve.vec3.dot(Ge,Xe)<ce};for(let Fe=0;Fe<Le.length;Fe++)Le[Fe]=at(Le[Fe],Me)}let pe,ue;if(I){const Le=h.getValueAndResolveTokens("text-field",se,c,k),ce=Nr.factory(Le);_w(ce)&&(this.hasRTLText=!0),(!this.hasRTLText||dl()==="unavailable"||this.hasRTLText&&nr.isParsed())&&(pe=qb(ce,h,se))}if(M){const Le=h.getValueAndResolveTokens("icon-image",se,c,k);ue=Le instanceof $i?Le:$i.fromString(Le)}if(!pe&&!ue)continue;const he=this.sortFeaturesByKey?E.evaluate(se,{},c):void 0;if(this.features.push({id:Z,text:pe,icon:ue,index:G,sourceLayerIndex:Y,geometry:se.geometry,properties:j.properties,type:mw[j.type],sortKey:he}),ue&&(C[ue.namePrimary]=!0,ue.nameSecondary&&(C[ue.nameSecondary]=!0)),pe){const Le=T.evaluate(se,{},c).join(","),ce=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Va.vertical)>=0;for(const Me of pe.sections)if(Me.image)C[Me.image.namePrimary]=!0;else{const Fe=cl(pe.toString()),ke=Me.fontStack||Le,Ge=L[ke]=L[ke]||{};this.calculateGlyphDependencies(Me.text,Ge,ce,this.allowVerticalPlacement,Fe)}}}m.get("symbol-placement")==="line"&&(this.features=function(j){const Z={},G={},Y=[];let J=0;function se(Le){Y.push(j[Le]),J++}function pe(Le,ce,Me){const Fe=G[Le];return delete G[Le],G[ce]=Fe,Y[Fe].geometry[0].pop(),Y[Fe].geometry[0]=Y[Fe].geometry[0].concat(Me[0]),Fe}function ue(Le,ce,Me){const Fe=Z[ce];return delete Z[ce],Z[Le]=Fe,Y[Fe].geometry[0].shift(),Y[Fe].geometry[0]=Me[0].concat(Y[Fe].geometry[0]),Fe}function he(Le,ce,Me){const Fe=Me?ce[0][ce[0].length-1]:ce[0][0];return`${Le}:${Fe.x}:${Fe.y}`}for(let Le=0;Le<j.length;Le++){const ce=j[Le],Me=ce.geometry,Fe=ce.text?ce.text.toString():null;if(!Fe){se(Le);continue}const ke=he(Fe,Me),Ge=he(Fe,Me,!0);if(ke in G&&Ge in Z&&G[ke]!==Z[Ge]){const Xe=ue(ke,Ge,Me),Ye=pe(ke,Ge,Y[Xe].geometry);delete Z[ke],delete G[Ge],G[he(Fe,Y[Ye].geometry,!0)]=Ye,Y[Xe].geometry=null}else ke in G?pe(ke,Ge,Me):Ge in Z?ue(ke,Ge,Me):(se(Le),Z[ke]=J-1,G[Ge]=J-1)}return Y.filter(Le=>Le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((j,Z)=>j.sortKey-Z.sortKey)}update(t,s,c,p,h){const m=Object.keys(t).length!==0;if(m&&!this.stateDependentLayers.length)return;const x=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,s,x,c,p,h),this.icon.programConfigurations.updatePaintArrays(t,s,x,c,p,h)}updateZOffset(){const t=(h,m,x)=>{c+=m,c>h.length&&h.resize(c);for(let T=-m;T<0;T++)h.emplace(T+c,x)},s=(h,m,x)=>{p+=m,p>h.length&&h.resize(p);for(let T=-m;T<0;T++)h.emplace(T+p,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,p=0;for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:T,numIconVertices:A}=m,y=m.zOffset,I=A>0;if((x>0||T>0)&&(t(this.text.zOffsetVertexArray,x,y),t(this.text.zOffsetVertexArray,T,y)),I){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:E}=m;M>=0&&s(this.icon.zOffsetVertexArray,A,y),E>=0&&s(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,y)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=p0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:p,y:h}of s)this.lineVertexArray.emplaceBack(p,h);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,p,h,m,x,T,A,y,I,M,E,C,L,k){const V=t.indexArray,j=t.layoutVertexArray,Z=t.globeExtVertexArray,G=t.segments.prepareSegment(4*s.length,j,V,this.canOverlap?m.sortKey:void 0),Y=this.glyphOffsetArray.length,J=G.vertexLength,se=this.allowVerticalPlacement&&x===Va.vertical?Math.PI/2:0,pe=m.text&&m.text.sections;for(let he=0;he<s.length;he++){const{tl:Le,tr:ce,bl:Me,br:Fe,texPrimary:ke,texSecondary:Ge,pixelOffsetTL:Xe,pixelOffsetBR:Ye,minFontScaleX:Ze,minFontScaleY:ut,glyphOffset:Et,isSDF:ot,sectionIndex:jt}=s[he],Dt=G.vertexLength,Ct=Et[1];if(rp(j,A.x,A.y,Le.x,Ct+Le.y,ke.x,ke.y,c,ot,Xe.x,Xe.y,Ze,ut),rp(j,A.x,A.y,ce.x,Ct+ce.y,ke.x+ke.w,ke.y,c,ot,Ye.x,Xe.y,Ze,ut),rp(j,A.x,A.y,Me.x,Ct+Me.y,ke.x,ke.y+ke.h,c,ot,Xe.x,Ye.y,Ze,ut),rp(j,A.x,A.y,Fe.x,Ct+Fe.y,ke.x+ke.w,ke.y+ke.h,c,ot,Ye.x,Ye.y,Ze,ut),T){const{x:bt,y:an,z:qt}=T.anchor,[$t,wn,Ln]=T.up;op(Z,bt,an,qt,$t,wn,Ln),op(Z,bt,an,qt,$t,wn,Ln),op(Z,bt,an,qt,$t,wn,Ln),op(Z,bt,an,qt,$t,wn,Ln),ap(t.dynamicLayoutVertexArray,bt,an,qt,se)}else ap(t.dynamicLayoutVertexArray,A.x,A.y,A.z,se);if(k){const bt=Ge||ke;sp(t.iconTransitioningVertexArray,bt.x,bt.y),sp(t.iconTransitioningVertexArray,bt.x+bt.w,bt.y),sp(t.iconTransitioningVertexArray,bt.x,bt.y+bt.h),sp(t.iconTransitioningVertexArray,bt.x+bt.w,bt.y+bt.h)}V.emplaceBack(Dt,Dt+1,Dt+2),V.emplaceBack(Dt+1,Dt+2,Dt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),he!==s.length-1&&jt===s[he+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,m,m.index,{},E,C,L,pe&&pe[jt])}const ue=T?T.anchor:A;t.placedSymbolArray.emplaceBack(ue.x,ue.y,ue.z,A.x,A.y,Y,this.glyphOffsetArray.length-Y,J,y,I,A.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,M,0)}_commitLayoutVertex(t,s,c,p,h,m,x){t.emplaceBack(s,c,p,h,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(t,s,c,p,h,m,x){const T=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),A=T.vertexLength,y=x.tileAnchorX,I=x.tileAnchorY;for(let E=0;E<4;E++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,s,t.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,I,new Lt(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,I,new Lt(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,I,new Lt(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,h,m,y,I,new Lt(t.x1,t.y2)),T.vertexLength+=4;const M=c.indexArray;M.emplaceBack(A,A+1),M.emplaceBack(A+1,A+2),M.emplaceBack(A+2,A+3),M.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,c,p,h,m){for(let x=p;x<h;x++){const T=c.get(x),A=this.getSymbolInstanceTextSize(t,m,s,x);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(t,s,c,p,h,m){for(let x=p;x<h;x++){const T=c.get(x),A=this.getSymbolInstanceIconSize(t,s,m.placedIconSymbolIndex);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}generateCollisionDebugBuffers(t,s,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bm(u,zy.members,e),this.iconCollisionBox=new Bm(u,zy.members,e);const p=Gh(this.iconSizeData,t),h=Gh(this.textSizeData,t,c);for(let m=0;m<this.symbolInstances.length;m++){const x=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,t,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(h,t,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(p,t,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(p,t,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(t,s,c,p){const h=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:p),m=Xf(this.textSizeData,t,h)/Ns;return this.tilePixelRatio*m}getSymbolInstanceIconSize(t,s,c){const p=this.icon.placedSymbolArray.get(c),h=Xf(this.iconSizeData,t,p);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(t,s,c,p){t.emplaceBack(s,-c,-c,p),t.emplaceBack(s,c,-c,p),t.emplaceBack(s,c,c,p),t.emplaceBack(s,-c,c,p)}_updateTextDebugCollisionBoxes(t,s,c,p,h,m,x){for(let T=p;T<h;T++){const A=c.get(T),y=this.getSymbolInstanceTextSize(t,m,s,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,A.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(t,s,c,p,h,m,x){for(let T=p;T<h;T++){const A=c.get(T),y=this.getSymbolInstanceIconSize(t,s,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,A.padding,m.zOffset)}}updateCollisionDebugBuffers(t,s,c,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Gh(this.iconSizeData,t,p),m=Gh(this.textSizeData,t,c);for(let x=0;x<this.symbolInstances.length;x++){const T=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(m,t,s,T.textBoxStartIndex,T.textBoxEndIndex,T,c),this._updateTextDebugCollisionBoxes(m,t,s,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,c),this._updateIconDebugCollisionBoxes(h,t,s,T.iconBoxStartIndex,T.iconBoxEndIndex,T,p),this._updateIconDebugCollisionBoxes(h,t,s,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,c,p,h,m,x,T,A){const y={};if(s<c){const{x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G,featureIndex:Y}=t.get(s);y.textBox={x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G},y.textFeatureIndex=Y}if(p<h){const{x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G,featureIndex:Y}=t.get(p);y.verticalTextBox={x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G},y.verticalTextFeatureIndex=Y}if(m<x){const{x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G,featureIndex:Y}=t.get(m);y.iconBox={x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G},y.iconFeatureIndex=Y}if(T<A){const{x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G,featureIndex:Y}=t.get(T);y.verticalIconBox={x1:I,y1:M,x2:E,y2:C,padding:L,projectedAnchorX:k,projectedAnchorY:V,projectedAnchorZ:j,tileAnchorX:Z,tileAnchorY:G},y.verticalIconFeatureIndex=Y}return y}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let h=c.vertexStartIndex;h<p;h+=4)t.indexArray.emplaceBack(h,h+1,h+2),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),p=[],h=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const T=this.symbolInstances.get(x);p.push(0|Math.round(s*T.tileAnchorX+c*T.tileAnchorY)),h.push(T.featureIndex)}return m.sort((x,T)=>p[x]-p[T]||h[T]-h[x]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:A}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),h>=0&&h!==p&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let m0,g0,Vm;Gt(lp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),lp.addDynamicAttributes=ap;class _0{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ci,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt(_0,"FormatSectionOverride",{omit:["defaultValue"]});const Um=()=>Vm||(Vm={layout:m0||(m0=new Ei({"symbol-placement":new It($e.layout_symbol["symbol-placement"]),"symbol-spacing":new It($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new It($e.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new It($e.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new It($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new It($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht($e.layout_symbol["icon-size"]),"icon-size-scale-range":new It($e.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ht($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ht($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht($e.layout_symbol["icon-image"]),"icon-rotate":new Ht($e.layout_symbol["icon-rotate"]),"icon-padding":new It($e.layout_symbol["icon-padding"]),"icon-keep-upright":new It($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht($e.layout_symbol["icon-offset"]),"icon-anchor":new Ht($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It($e.layout_symbol["text-rotation-alignment"]),"text-field":new Ht($e.layout_symbol["text-field"]),"text-font":new Ht($e.layout_symbol["text-font"]),"text-size":new Ht($e.layout_symbol["text-size"]),"text-size-scale-range":new It($e.layout_symbol["text-size-scale-range"]),"text-max-width":new Ht($e.layout_symbol["text-max-width"]),"text-line-height":new Ht($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht($e.layout_symbol["text-letter-spacing"]),"text-justify":new Ht($e.layout_symbol["text-justify"]),"text-radial-offset":new Ht($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It($e.layout_symbol["text-variable-anchor"]),"text-anchor":new Ht($e.layout_symbol["text-anchor"]),"text-max-angle":new It($e.layout_symbol["text-max-angle"]),"text-writing-mode":new It($e.layout_symbol["text-writing-mode"]),"text-rotate":new Ht($e.layout_symbol["text-rotate"]),"text-padding":new It($e.layout_symbol["text-padding"]),"text-keep-upright":new It($e.layout_symbol["text-keep-upright"]),"text-transform":new Ht($e.layout_symbol["text-transform"]),"text-offset":new Ht($e.layout_symbol["text-offset"]),"text-allow-overlap":new It($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It($e.layout_symbol["text-ignore-placement"]),"text-optional":new It($e.layout_symbol["text-optional"]),visibility:new It($e.layout_symbol.visibility)})),paint:g0||(g0=new Ei({"icon-opacity":new Ht($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ht($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ht($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ht($e.paint_symbol["text-emissive-strength"]),"icon-color":new Ht($e.paint_symbol["icon-color"]),"icon-halo-color":new Ht($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht($e.paint_symbol["icon-halo-blur"]),"icon-translate":new It($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new It($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ht($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ht($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ht($e.paint_symbol["text-occlusion-opacity"]),"text-color":new Ht($e.paint_symbol["text-color"],{runtimeType:is,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ht($e.paint_symbol["text-halo-color"]),"text-halo-width":new Ht($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht($e.paint_symbol["text-halo-blur"]),"text-translate":new It($e.paint_symbol["text-translate"]),"text-translate-anchor":new It($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new It($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new It($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new It($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new It($e.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ht($e.paint_symbol["symbol-z-offset"])}))},Vm);class up extends Rs{constructor(t,s,c,p){super(t,Um(),s,c,p),this._colorAdjustmentMatrix=Ve.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,s){super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const h of c)p.indexOf(h)<0&&p.push(h);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,s,c,p){return this._saturation===t&&this._contrast===s&&this._brightnessMin===c&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(h,m,x,T){h=oe(h),m=ne(m);const A=Ve.mat4.create(),y=h/3,I=1-2*y,M=[I,y,y,0,y,I,y,0,y,y,I,0,0,0,0,1],E=.5-.5*m,C=T-x;return Ve.mat4.multiply(A,[C,0,0,0,0,C,0,0,0,0,C,0,x,x,x,1],[m,0,0,0,0,m,0,0,0,0,m,0,E,E,E,1]),Ve.mat4.multiply(A,A,M),A}(t,s,c,p),this._saturation=t,this._contrast=s,this._brightnessMin=c,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,s,c,p){const h=this.layout.get(t).evaluate(s,{},c,p),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||yo(m.value)||!h?h:function(x,T){return T.replace(/{([^{}]+)}/g,(A,y)=>y in x?String(x[y]):"")}(s.properties,h)}createBucket(t){return new lp(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Um().paint.overridableProperties){if(!up.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new _0(s),p=new Gl(c,s.property.specification,this.scope,this.options);let h=null;h=s.value.kind==="constant"||s.value.kind==="source"?new La("source",p):new ql("composite",p,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new vo(s.property,h,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&up.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),p=Um().paint.properties[s];let h=!1;const m=x=>{for(const T of x)if(p.overrides&&p.overrides.hasOverride(T))return void(h=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Nr)m(c.value.value.sections);else if(c.value.kind==="source"){const x=A=>{h||(A instanceof vs&&Qi(A.value)===Ll?m(A.value.sections):A instanceof Co?m(A.sections):A.eachChild(x))},T=c.value;T._styleExpression&&x(T._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,s,c){return{config:new Kl(this,{zoom:s,lut:c}),overrideFog:!1}}}let y0,v0,x0,b0;var Gm=ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function qm(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function jm(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Hm{constructor(t,s,c,p){this.context=t,this.format=c,this.useMipmap=p&&p.useMipmap,this.texture=t.gl.createTexture(),this.update(s,{premultiply:p&&p.premultiply})}update(t,s){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,p=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:h}=this,{gl:m}=h,{x,y:T}=s&&s.position?s.position:{x:0,y:0},A=Math.max(x+c,this.size?this.size[0]:0),y=Math.max(T+p,this.size?this.size[1]:0);!this.size||this.size[0]===A&&this.size[1]===y||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!s||s.premultiply!==!1));const I=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&A>0&&y>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(A,y)))+1:1;m.texStorage2D(m.TEXTURE_2D,M,this.format,A,y),this.size=[A,y]}if(this.size)if(I)m.texSubImage2D(m.TEXTURE_2D,0,x,T,qm(this.format),jm(this.format),t);else{const M=t.data;M&&m.texSubImage2D(m.TEXTURE_2D,0,x,T,c,p,qm(this.format),jm(this.format),M)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(t,s,c=!1){const{context:p}=this,{gl:h}=p;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(t,s,c,p){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),this.magFilter=s),t!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),p!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class cp{constructor(t,s){this.context=t,this.texture=s}bind(t,s){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),t!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,t),this.minFilter=t),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrapS=s)}}function hp(l,t,s,c,p,h,m,x){const T=[l,t,1,s,c,1,p,h,1],A=[m,x,1],y=Ve.mat3.adjoint([],T),[I,M,E]=Ve.vec3.transformMat3(A,A,y);return Ve.mat3.multiply(T,T,[I,0,0,0,M,0,0,0,E])}function w0(l,t,s,c,p,h,m,x){const T=function(A,y,I,M,E,C,L,k){const V=hp(0,0,1,0,1,1,0,1),j=hp(A,y,I,M,E,C,L,k),Z=Ve.mat3.adjoint([],V);return Ve.mat3.multiply(j,j,Z)}(l,t,s,c,p,h,m,x);return[T[2]/T[8]/Mt,T[5]/T[8]/Mt]}function dp(l){return[l[0],Math.min(Math.max(l[1],-be),be)]}class E0 extends lo{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=s,this._dirty=!1}load(t,s){if(this._loaded=s||!1,this.fire(new Tr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=$s(this.map._requestManager.transformRequest(this.url,Er.Image),(c,p)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new ma(c)):p&&(this.image=p instanceof HTMLImageElement?Vt.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new cp(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Tr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof cp||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=t[0][1],c=t[0][1];for(const h of t)h[1]>c&&(c=h[1]),h[1]<s&&(s=h[1]);const p=(c+s)/2;if(p>be?this.onNorthPole=!0:p<-be&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=t.map(Be.fromLngLat);this.tileID=function(m){let x=1/0,T=1/0,A=-1/0,y=-1/0;for(const L of m)x=Math.min(x,L.x),T=Math.min(T,L.y),A=Math.max(A,L.x),y=Math.max(y,L.y);const I=Math.max(A-x,y-T),M=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),E=Math.pow(2,M);let C=Math.floor((x+A)/2*E);return C>1&&(C-=1),new Jr(M,C,Math.floor((T+y)/2*E))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Tr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const V in this.tiles){const j=this.tiles[V];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=kd(new Jr(0,0,0),this.map.transform.projection),c=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const j=V[1].x-V[0].x,Z=V[1].y-V[0].y,G=V[2].x-V[1].x,Y=V[2].y-V[1].y,J=V[3].x-V[2].x,se=V[3].y-V[2].y,pe=V[0].x-V[3].x,ue=V[0].y-V[3].y,he=j*Y-G*Z,Le=G*se-J*Y,ce=J*ue-pe*se,Me=pe*Z-j*ue;return he>0&&Le>0&&ce>0&&Me>0||he<0&&Le<0&&ce<0&&Me<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=kd(this.tileID,this.map.transform.projection),[h,m,x,T]=this.coordinates.map(V=>{const j=p.projection.project(V[0],V[1]);return u0(p,j)._round()});this.perspectiveTransform=w0(h.x,h.y,m.x,m.y,x.x,x.y,T.x,T.y);const A=this._boundsArray=new Ou;A.emplaceBack(h.x,h.y,0,0),A.emplaceBack(m.x,m.y,Mt,0),A.emplaceBack(T.x,T.y,0,Mt),A.emplaceBack(x.x,x.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(A,Gm.members),this.boundsSegments=lr.simpleSegment(0,0,4,2);const y=[],I=[dp((M=this.coordinates)[0]),dp(M[1]),dp(M[2]),dp(M[3])];var M;const[E,C,L,k]=function(V){let j=V[0][0],Z=j,G=V[0][1],Y=G;for(let J=1;J<V.length;J++)V[J][0]<j?j=V[J][0]:V[J][0]>Z&&(Z=V[J][0]),V[J][1]<G?G=V[J][1]:V[J][1]>Y&&(Y=V[J][1]);return[j,G,Z-j,Y-G]}(I);{const V=new Ou,[j,Z,G,Y]=function(Xe){let Ye=Xe[0].x,Ze=Ye,ut=Xe[0].y,Et=ut;for(let ot=1;ot<Xe.length;ot++)Xe[ot].x<Ye?Ye=Xe[ot].x:Xe[ot].x>Ze&&(Ze=Xe[ot].x),Xe[ot].y<ut?ut=Xe[ot].y:Xe[ot].y>Et&&(Et=Xe[ot].y);return[Ye,ut,Ze-Ye,Et-ut]}(c),J=Xe=>[(Xe.x-j)/G,(Xe.y-Z)/Y],[se,pe,ue,he]=c.map(J),Le=function(Xe,Ye,Ze,ut,Et,ot,jt,Dt){const Ct=hp(0,0,1,0,1,1,0,1),bt=hp(Xe,Ye,Ze,ut,Et,ot,jt,Dt),an=Ve.mat3.adjoint([],bt);return Ve.mat3.multiply(Ct,Ct,an)}(se[0],se[1],pe[0],pe[1],ue[0],ue[1],he[0],he[1]);this.elevatedGlobePerspectiveTransform=w0(se[0],se[1],pe[0],pe[1],ue[0],ue[1],he[0],he[1]);const ce=(Xe,Ye)=>{y.push(Xe.lng);const Ze=Math.round((Xe.lng-E)/L*Mt),ut=Math.round((Xe.lat-C)/k*Mt),Et=J(Ye),ot=Ve.vec3.transformMat3([],[Et[0],Et[1],1],Le),jt=Math.round(ot[0]/ot[2]*Mt),Dt=Math.round(ot[1]/ot[2]*Mt);V.emplaceBack(Ze,ut,jt,Dt)},Me=c[3].x-c[0].x,Fe=c[3].y-c[0].y,ke=c[2].x-c[1].x,Ge=c[2].y-c[1].y;for(let Xe=0;Xe<65;Xe++){const Ye=Xe/64,Ze=[c[0].x+Ye*Me,c[0].y+Ye*Fe],ut=[c[1].x+Ye*ke,c[1].y+Ye*Ge],Et=ut[0]-Ze[0],ot=ut[1]-Ze[1];for(let jt=0;jt<65;jt++){const Dt=jt/64,Ct={x:Ze[0]+Et*Dt,y:Ze[1]+ot*Dt,z:0};ce(s.projection.unproject(Ct.x,Ct.y),Ct)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(V,Gm.members)}{this.maxLongitudeTriangleSize=0;let V=[],j=new O;const Z=(G,Y,J)=>{j.emplaceBack(G,Y,J);const se=y[G],pe=y[Y],ue=y[J],he=Math.min(Math.min(se,pe),ue),Le=Math.max(Math.max(se,pe),ue)-he;Le>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Le),V.push(he+Le/2)};for(let G=0;G<64;G++)for(let Y=0;Y<64;Y++){const J=65*G+Y,se=J+1,pe=J+65,ue=pe+1;Z(J,pe,se),Z(se,pe,ue)}[V,j]=function(G,Y){const J=Array.from({length:G.length},(ue,he)=>he);J.sort((ue,he)=>G[ue]-G[he]);const se=[],pe=new O;for(let ue=0;ue<J.length;ue++){const he=J[ue];se.push(G[he]);const Le=3*he,ce=Le+1;pe.emplaceBack(Y.uint16[Le],Y.uint16[ce],Y.uint16[ce+1])}return[se,pe]}(V,j),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(j)}this.elevatedGlobeSegments=lr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/Mt,0,k/Mt,0,0,C,E,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const s=this.map.painter.context,c=s.gl;!this._dirty||this.texture instanceof cp||(this.texture?this.texture.update(this.image):(this.texture=new Hm(s,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(s)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let p=(h=t+180)+360*Math.round((c[0]-h)/360);var h;const m=new lr,x=(I,M)=>{m.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:s.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-p)<=T){const I=Ke(c,0,c.length,p+T);return I===c.length||x(I,Fi(c,I+1,c.length,p+360-T)-I),m}p<c[0]&&(p+=360);const A=Fi(c,0,c.length,p-T);if(A===c.length)return x(0,c.length),m;x(0,A-0);const y=Ke(c,A+1,c.length,p+T);return y!==c.length&&x(y,c.length-y),m}}const yw=(Math.pow(256,2)-1)/16907520;class I0 extends Rs{constructor(t,s,c,p){super(t,{layout:x0||(x0=new Ei({visibility:new It($e.layout_raster.visibility)})),paint:b0||(b0=new Ei({"raster-opacity":new It($e.paint_raster["raster-opacity"]),"raster-color":new zo($e.paint_raster["raster-color"]),"raster-color-mix":new It($e.paint_raster["raster-color-mix"]),"raster-color-range":new It($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new It($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It($e.paint_raster["raster-brightness-max"]),"raster-saturation":new It($e.paint_raster["raster-saturation"]),"raster-contrast":new It($e.paint_raster["raster-contrast"]),"raster-resampling":new It($e.paint_raster["raster-resampling"]),"raster-fade-duration":new It($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new It($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new It($e.paint_raster["raster-array-band"]),"raster-elevation":new It($e.paint_raster["raster-elevation"])}))},s,c,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof E0&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[c,p]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(p)||c===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Ed({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,p])}}let T0,S0,C0,M0,A0;class P0 extends Rs{constructor(t,s,c,p){super(t,{layout:T0||(T0=new Ei({visibility:new It($e["layout_raster-particle"].visibility)})),paint:S0||(S0=new Ei({"raster-particle-array-band":new It($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new It($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new zo($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new It($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new It($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new It($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new It($e["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new It($e["paint_raster-particle"]["raster-particle-elevation"])}))},s,c,p),this._updateColorRamp(),this.lastInvalidatedAt=Vt.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ed({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Vt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class vw extends Rs{constructor(t,s){super(t,{},s,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function Zm(l,t,s){const c=[0,0,1],p=Ve.quat.identity([]);return Ve.quat.rotateY(p,p,s?-pn(l)+Math.PI:pn(l)),Ve.quat.rotateX(p,p,-pn(t)),Ve.vec3.transformQuat(c,c,p),Ve.vec3.normalize(c,c)}function L0(l,t){const s=fp(l.projection,l.zoom,l.width,l.height),c=function(h,m,x,T,A){const y=new F(x.lng-180*Yc,x.lat),I=new F(x.lng+180*Yc,x.lat),M=h.project(y.lng,y.lat),E=h.project(I.lng,I.lat),C=-Math.atan2(E.y-M.y,E.x-M.x),L=Be.fromLngLat(x);L.y=nn(L.y,-1+Yc,1-Yc);const k=L.toLngLat(),V=h.project(k.lng,k.lat),j=Be.fromLngLat(k);j.x+=Yc;const Z=j.toLngLat(),G=h.project(Z.lng,Z.lat),Y=D0(G.x-V.x,G.y-V.y,C),J=Be.fromLngLat(k);J.y+=Yc;const se=J.toLngLat(),pe=h.project(se.lng,se.lat),ue=D0(pe.x-V.x,pe.y-V.y,C),he=Math.abs(Y.x)/Math.abs(ue.y),Le=Ve.mat4.identity([]);Ve.mat4.rotateZ(Le,Le,-C*(1-(A?0:T)));const ce=Ve.mat4.identity([]);return Ve.mat4.scale(ce,ce,[1,1-(1-he)*T,1]),ce[4]=-ue.x/ue.y*T,Ve.mat4.rotateZ(ce,ce,C),Ve.mat4.multiply(ce,Le,ce),ce}(l.projection,0,l.center,s,t),p=R0(l);return Ve.mat4.scale(c,c,[p,p,1]),c}function R0(l){const t=l.projection,s=fp(l.projection,l.zoom,l.width,l.height),c=Wm(t,l.center),p=Wm(t,F.convert(t.center));return Math.pow(2,c*s+(1-s)*p)}function fp(l,t,s,c,p=1/0){const h=l.range;if(!h)return 0;const m=Math.min(p,Math.max(s,c)),x=Math.log(m/1024)/Math.LN2;return fa(h[0]+x,h[1]+x,t)}const Yc=1/4e4;function Wm(l,t){const s=nn(t.lat,-be,be),c=new F(t.lng-180*Yc,s),p=new F(t.lng+180*Yc,s),h=l.project(c.lng,s),m=l.project(p.lng,s),x=Be.fromLngLat(c),T=Be.fromLngLat(p),A=m.x-h.x,y=m.y-h.y,I=T.x-x.x,M=T.y-x.y,E=Math.sqrt((I*I+M*M)/(A*A+y*y));return Math.log(E)/Math.LN2}function D0(l,t,s){const c=Math.cos(s),p=Math.sin(s);return{x:l*c-t*p,y:l*p+t*c}}function O0(l,t,s){Ve.mat4.identity(l),Ve.mat4.rotateZ(l,l,pn(t[2])),Ve.mat4.rotateX(l,l,pn(t[0])),Ve.mat4.rotateY(l,l,pn(t[1])),Ve.mat4.scale(l,l,s),Ve.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function pp(l,t,s,c,p,h,m,x){const T=[s[0]-t[0],s[1]-t[1],0],A=[c[0]-t[0],c[1]-t[1],0];if(Ve.vec3.length(T)<1e-12||Ve.vec3.length(A)<1e-12)return Ve.quat.identity(l);const y=Ve.vec3.cross([],T,A);Ve.vec3.normalize(y,y),Ve.vec3.subtract(A,c,t),T[2]=(h-p)*x,A[2]=(m-p)*x;const I=T;return Ve.vec3.cross(I,T,A),Ve.vec3.normalize(I,I),Ve.quat.rotationTo(l,y,I)}function $m(l,t,s=!1){const c=jc(t.zoom),p=function(h,m,x){const T=m.worldSize,A=[h[12],h[13],h[14]],y=de(A[1]/T),I=ae(A[0]/T),M=Ve.mat4.identity([]),E=ie(1,y)*T,C=ie(1,0)*T*we(y,m.zoom),L=1/am(T);let k=C*L;if(x){const G=fp(m.projection,m.zoom,m.width,m.height,1024);k=L*m.projection.pixelSpaceConversion(m.center.lat,T,G)}const V=P(y,I);Ve.vec3.add(V,V,Ve.vec3.scale([],Ve.vec3.normalize([],V),E*k*A[2]));const j=function(G){const Y=[G[0],G[1],G[2]];let J=[0,1,0];const se=Ve.vec3.cross([],J,Y);return Ve.vec3.cross(J,Y,se),Ve.vec3.squaredLength(J)===0&&(J=[0,1,0],Ve.vec3.cross(se,Y,J)),Ve.vec3.normalize(se,se),Ve.vec3.normalize(J,J),Ve.vec3.normalize(Y,Y),[se[0],se[1],se[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,G[0],G[1],G[2],1]}(V);Ve.mat4.scale(M,M,[k,k,k*E]),Ve.mat4.translate(M,M,[-A[0],-A[1],-A[2]]);const Z=Ve.mat4.multiply([],m.globeMatrix,j);return Ve.mat4.multiply(Z,Z,M),Ve.mat4.multiply(Z,Z,h),Z}(l,t,s);if(c>0){const h=function(m,x){const T=x.worldSize,A=ie(1,0)*T*we(x.center.lat,x.zoom)/am(T),y=ie(1,x.center.lat)*T,I=Ve.mat4.identity([]);return Ve.mat4.rotateY(I,I,pn(x.center.lng)),Ve.mat4.rotateX(I,I,pn(x.center.lat)),Ve.mat4.translate(I,I,[0,0,Os]),Ve.mat4.scale(I,I,[A,A,A*y]),Ve.mat4.translate(I,I,[x.point.x-.5*T,x.point.y-.5*T,0]),Ve.mat4.multiply(I,I,m),Ve.mat4.multiply(I,x.globeMatrix,I)}(l,t);return function(m,x,T){const A=(C,L,k)=>{const V=Ve.vec3.length(C),j=Ve.vec3.length(L),Z=yc(C,L,k);return Ve.vec3.scale(Z,Z,1/Ve.vec3.length(Z)*ln(V,j,k))},y=A([m[0],m[1],m[2]],[x[0],x[1],x[2]],T),I=A([m[4],m[5],m[6]],[x[4],x[5],x[6]],T),M=A([m[8],m[9],m[10]],[x[8],x[9],x[10]],T),E=yc([m[12],m[13],m[14]],[x[12],x[13],x[14]],T);return[y[0],y[1],y[2],0,I[0],I[1],I[2],0,M[0],M[1],M[2],0,E[0],E[1],E[2],1]}(p,h,c)}return p}function N0(l,t,s,c){const p=_i.projectAabbCorners(c,s);let h=Number.MAX_VALUE,m=-1;for(let A=0;A<p.length;++A){const y=p[A];y[0]=(.5*y[0]+.5)*t.width,y[1]=(.5-.5*y[1])*t.height,y[2]<h&&(m=A,h=y[2])}const x=A=>new Lt(p[A][0],p[A][1]);let T;switch(m){case 0:case 6:T=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:T=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:T=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:T=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(mt(l,T))return h}const xw=ei([{name:"a_pos_3f",components:3,type:"Float32"}]),bw=ei([{name:"a_color_3f",components:3,type:"Float32"}]),ww=ei([{name:"a_color_4f",components:4,type:"Float32"}]),Ew=ei([{name:"a_uv_2f",components:2,type:"Float32"}]),Iw=ei([{name:"a_normal_3f",components:3,type:"Float32"}]),Tw=ei([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Sw=ei([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),z0={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class mp{constructor(t,s,c,p){this.message=(t?`${t}: `:"")+c,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function F0(l,t){const s=l.indexOf("://")===-1;try{return new URL(l,s&&t?"http://example.com":void 0),!0}catch{return!1}}class k0{constructor(t,s){this.feature=t,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class B0{constructor(){this.instancedDataArray=new Ai,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Xm{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,s){}populate(t,s,c,p){this.tileToMeter=Re(c);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:x,index:T,sourceLayerIndex:A}of t){const y=x??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),I=gt(m,h);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),I,c))continue;const M={id:y,sourceLayerIndex:A,index:T,geometry:h?I.geometry:He(m,c,p),properties:m.properties,type:m.type,patterns:{}},E=this.addFeature(M,M.geometry,I);E&&s.featureIndex.insert(m,M.geometry,T,A,this.index,this.instancesPerModel[E].instancedDataArray.length,Mt/32)}this.lookup=null}update(t,s,c,p){for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];for(const x in t)m.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(m.features[m.idToFeaturesIndex[x]],t[x],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];for(const p of c.features){const h=this.layers[0],m=p.feature,x=this.canonical,T=h.paint.get("model-rotation").evaluate(m,{},x),A=h.paint.get("model-scale").evaluate(m,{},x),y=h.paint.get("model-translation").evaluate(m,{},x);Ve.vec3.exactEquals(p.rotation,T)&&Ve.vec3.exactEquals(p.scale,A)&&Ve.vec3.exactEquals(p.translation,y)||(this.evaluate(p,p.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,s,c,p){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(xm(this.activeReplacements,h))return!1;this.activeReplacements=h;let m=!1;for(const x in this.instancesPerModel){const T=this.instancesPerModel[x],A=T.instancedDataArray;for(const y of T.features){const I=y.instancedDataOffset,M=y.instancedDataCount;for(let E=0;E<M;E++){const C=16*(E+I);let L=A.float32[C+0];const k=L>Mt;L=k?L-Mt:L;const V=Math.floor(L),j=A.float32[C+1];let Z=!1;for(const G of this.activeReplacements)if(!ey(G,c,z0.Model,p)&&!(G.min.x>V||V>G.max.x||G.min.y>j||j>G.max.y)&&(Z=oy(sy(V,j,t.canonical,G.footprintTileId.canonical),G.footprint),Z))break;A.float32[C]=Z?L+Mt:L,m=m||Z!==k}}}return m}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,Tw.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const s of this.modelUris)t.removeModel(s,"")}addFeature(t,s,c){const p=this.layers[0],h=p.layout.get("model-id").evaluate(c,{},this.canonical);if(!h)return Xn(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),h;F0(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new B0);const m=this.instancesPerModel[h],x=m.instancedDataArray,T=new k0(c,x.length);for(const A of s)for(const y of A){if(y.x<0||y.x>=Mt||y.y<0||y.y>=Mt)continue;const I=(this.lookupDim-1)/Mt,M=this.lookupDim*(y.y*I|0)+y.x*I|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const E=x.length;x.resize(E+1),m.instancesEvaluatedElevation.push(0),x.float32[16*E]=y.x,x.float32[16*E+1]=y.y}return T.instancedDataCount=m.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(t.id&&(m.idToFeaturesIndex[t.id]=m.features.length),m.features.push(T),this.evaluate(T,{},m,!1)),h}getModelUris(){return this.modelUris}evaluate(t,s,c,p){const h=this.layers[0],m=t.feature,x=this.canonical,T=t.rotation=h.paint.get("model-rotation").evaluate(m,s,x),A=t.scale=h.paint.get("model-scale").evaluate(m,s,x),y=t.translation=h.paint.get("model-translation").evaluate(m,s,x),I=h.paint.get("model-color").evaluate(m,s,x);I.a=h.paint.get("model-color-mix-intensity").evaluate(m,s,x);const M=[];this.maxVerticalOffset<y[2]&&(this.maxVerticalOffset=y[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),O0(M,T,A);const E=Math.round(100*I.a)+I.b/1.05;for(let C=0;C<t.instancedDataCount;++C){const L=t.instancedDataOffset+C,k=16*L,V=c.instancedDataArray.float32;let j=0;p&&(j=V[k+6]-c.instancesEvaluatedElevation[L]);const Z=0|V[k+1];V[k]=(0|V[k])+I.r/1.05,V[k+1]=Z+I.g/1.05,V[k+2]=E,V[k+3]=1/(x.z>10?this.tileToMeter:Re(x,Z)),V[k+4]=y[0],V[k+5]=y[1],V[k+6]=y[2]+j,V[k+7]=M[0],V[k+8]=M[1],V[k+9]=M[2],V[k+10]=M[4],V[k+11]=M[5],V[k+12]=M[6],V[k+13]=M[8],V[k+14]=M[9],V[k+15]=M[10],c.instancesEvaluatedElevation[L]=y[2]}}}let V0,U0;Gt(Xm,"ModelBucket",{omit:["layers"]}),Gt(B0,"PerModelAttributes"),Gt(k0,"ModelFeature");const xh=64,Wh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function G0(l,t,s,c,p,h,m,x,T,A=!1){const y=s.zoom,I=s.project(c),M=we(c.lat,y),E=1/M;Ve.mat4.identity(l),Ve.mat4.translate(l,l,[I.x+m[0]*E,I.y+m[1]*E,m[2]]);let C=1,L=1;const k=s.worldSize;if(A){if(s.projection.name==="mercator"){let G=0;s.elevation&&(G=s.elevation.getAtPointOrZero(new Be(I.x/k,I.y/k),0));const Y=Ve.vec4.transformMat4([],[I.x,I.y,G,1],s.projMatrix)[3]/s.cameraToCenterDistance;C=Y,L=Y*we(s.center.lat,y)}else if(s.projection.name==="globe"){const G=$m(l,s),Y=Ve.mat4.multiply([],s.projMatrix,G),J=[0,0,0,1];Ve.vec4.transformMat4(J,J,Y);const se=J[3]/s.cameraToCenterDistance,pe=jc(y),ue=s.projection.pixelsPerMeter(c.lat,k)*we(c.lat,y),he=s.projection.pixelsPerMeter(s.center.lat,k)*we(s.center.lat,y);C=se/ln(ue,Ee(s.center.lat),pe),L=se*M/ue,C*=he,L*=he}}else C=E;Ve.mat4.scale(l,l,[C,C,L]);const V=[...l],j=t.orientation,Z=[];if(O0(Z,[j[0]+p[0],j[1]+p[1],j[2]+p[2]],h),Ve.mat4.multiply(l,V,Z),x&&s.elevation){let G=0;const Y=[];if(T&&s.elevation){G=function(pe,ue,he,Le,ce){const Me=ue.elevation;if(!Me)return 0;const Fe=_i.projectAabbCorners(he,Le),ke=ie(1,ce.lat)*ue.worldSize,Ge=function(an,qt){const $t=[0,0,1],wn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ln of wn){const Rn=an[Ln.corners[0]],Mn=an[Ln.corners[1]],Bn=an[Ln.corners[2]],Nn=[Mn[0]-Rn[0],Mn[1]-Rn[1],qt*(Mn[2]-Rn[2])],zi=Ve.vec3.cross(Nn,Nn,[Bn[0]-Rn[0],Bn[1]-Rn[1],qt*(Bn[2]-Rn[2])]);Ve.vec3.normalize(zi,zi),Ln.dotProductWithUp=Ve.vec3.dot(zi,$t)}return wn.sort((Ln,Rn)=>Ln.dotProductWithUp-Rn.dotProductWithUp),wn[0].corners}(Fe,ke),Xe=Fe[Ge[0]],Ye=Fe[Ge[1]],Ze=Fe[Ge[2]],ut=Fe[Ge[3]],Et=Me.getAtPointOrZero(new Be(Xe[0]/ue.worldSize,Xe[1]/ue.worldSize),0),ot=Me.getAtPointOrZero(new Be(Ye[0]/ue.worldSize,Ye[1]/ue.worldSize),0),jt=Me.getAtPointOrZero(new Be(Ze[0]/ue.worldSize,Ze[1]/ue.worldSize),0),Dt=Me.getAtPointOrZero(new Be(ut[0]/ue.worldSize,ut[1]/ue.worldSize),0),Ct=(Et+Dt)/2,bt=(ot+jt)/2;return Ct>bt?ot<jt?pp(pe,Ye,ut,Xe,ot,Dt,Et,ke):pp(pe,Ze,Xe,ut,jt,Et,Dt,ke):Et<Dt?pp(pe,Xe,Ye,Ze,Et,ot,jt,ke):pp(pe,ut,Ze,Ye,Dt,jt,ot,ke),Math.max(Ct,bt)}(Y,s,t.aabb,l,c);const J=Ve.mat4.fromQuat([],Y),se=Ve.mat4.multiply([],J,Z);Ve.mat4.multiply(l,V,se)}else G=s.elevation.getAtPointOrZero(new Be(I.x/k,I.y/k),0);G!==0&&(l[14]+=G)}}function qd(l,t,s=!1){l.uploaded||(l.gfxTexture=new Hm(t,l.image,s?t.gl.R8:t.gl.RGBA8,{useMipmap:l.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function Cw(l,t,s){l.indexBuffer=t.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=t.createVertexBuffer(l.vertexArray,xw.members,!1,!0),l.normalArray&&(l.normalBuffer=t.createVertexBuffer(l.normalArray,Iw.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=t.createVertexBuffer(l.texcoordArray,Ew.members,!1,!0)),l.colorArray&&(l.colorBuffer=t.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?bw:ww).members,!1,!0)),l.featureArray&&(l.pbrBuffer=t.createVertexBuffer(l.featureArray,Sw.members,!0)),l.segments=lr.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const c=l.material;c.pbrMetallicRoughness.baseColorTexture&&qd(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&qd(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&qd(c.normalTexture,t),c.occlusionTexture&&qd(c.occlusionTexture,t,s),c.emissionTexture&&qd(c.emissionTexture,t)}function Ym(l,t,s){if(l.meshes)for(const c of l.meshes)Cw(c,t,s);if(l.children)for(const c of l.children)Ym(c,t,s)}function gp(l){if(l.meshes)for(const t of l.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(l.children)for(const t of l.children)gp(t)}function Jm(l){if(l.meshes)for(const s of l.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((t=s.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(l.children)for(const s of l.children)Jm(s)}class $h{constructor(t,s,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(t,s,c){const p=c||t.findDEMTileFor(s);if(!p||!p.dem)return;const h=p.dem,m=p.tileID,x=1<<s.canonical.z-m.canonical.z;return new $h(p,h.dim/Mt/x,[(s.canonical.x/x-m.canonical.x)*h.dim,(s.canonical.y/x-m.canonical.y)*h.dim])}tileCoordToPixel(t,s){const c=s*this._scale+this._offset[1],p=Math.floor(t*this._scale+this._offset[0]),h=Math.floor(c);return new Lt(p,h)}getElevationAt(t,s,c,p){const h=t*this._scale+this._offset[0],m=s*this._scale+this._offset[1],x=Math.floor(h),T=Math.floor(m),A=this._dem;return p=!!p,c?ln(ln(A.get(x,T,p),A.get(x,T+1,p),m-T),ln(A.get(x+1,T,p),A.get(x+1,T+1,p),m-T),h-x):A.get(x,T,p)}getElevationAtPixel(t,s,c){return this._dem.get(t,s,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ie(1,t)*this._dem.stride}}const Km=new Float32Array(262144),bh=new Uint8Array(262144);function q0(l){let t=0;if(l.meshes)for(const s of l.meshes)t=Math.max(t,s.aabb.max[2]);if(l.children)for(const s of l.children)t=Math.max(t,q0(s));return t}function j0(l,t,s){if(l.meshes)for(const c of l.meshes){if(c.aabb.min[0]===1/0)continue;const p=_i.applyTransform(c.aabb,l.matrix);s.insert(t,p.min[0],p.min[1],p.max[0],p.max[1])}if(l.children)for(const c of l.children)j0(c,t,s)}const H0=["","wall","door","roof","window","lamp","logo"];class Z0{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:q0(t)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new _i([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const s=new _i([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=_i.applyTransformFast(c.aabb,this.node.matrix),s.encapsulate(c.transformedAabb)),t++;this.aabb=s}return this.aabb}}class _p{constructor(t,s,c,p,h,m,x){this.id=c,this.layers=t,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Wh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=Wh.HasMapboxMeshFeatures),h&&(this.modelTraits|=Wh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const T of s)this.nodesInfo.push(new Z0(T)),j0(T,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0)}updateFootprints(t,s){for(const c of this.getNodesInfo()){const p=c.node;p.footprint&&s.push({footprint:p.footprint,id:t})}}update(t){const s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;const c=s?this.stateDependentLayers:this.layers;for(const p of c)this.evaluate(p,t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const c of s){const p=c.node;this.uploaded?this.updatePbrBuffer(p):Ym(p,t,!0)}for(const c of s)gp(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let s=!1;if(!t.meshes)return s;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),s=!0);return s}needsReEvaluation(t,s,c){const p=t.transform.projectionOptions,h=t.style.getBrightness(),m=this.brightness!==h;return!!(!this.uploaded||this.dirty||p.name!==this.projection.name||jd(c.paint.get("model-color").value,m)||jd(c.paint.get("model-color-mix-intensity").value,m)||jd(c.paint.get("model-roughness").value,m)||jd(c.paint.get("model-emissive-strength").value,m)||jd(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=p,this.brightness=h,!0)}evaluateScale(t,s){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),p=this.id.canonical;for(const h of c){const m=h.feature;h.evaluatedScale=s.paint.get("model-scale").evaluate(m,{},p)}}evaluate(t,s){const c=this.getNodesInfo();for(const p of c){if(!p.node.meshes)continue;const h=p.feature,m=s&&s[h.id],x=p.node.meshes&&p.node.meshes[0].featureData,T=p.evaluatedColor[2],A=p.evaluatedRMEA[2],y=this.id.canonical;if(p.hasTranslucentParts=!1,x){for(let I=0;I<H0.length;I++){const M=H0[I];M.length&&(h.properties.part=M);const E=t.paint.get("model-color").evaluate(h,m,y).toRenderColor(null),C=t.paint.get("model-color-mix-intensity").evaluate(h,m,y);p.evaluatedColor[I]=[E.r,E.g,E.b,C],p.evaluatedRMEA[I][0]=t.paint.get("model-roughness").evaluate(h,m,y),p.evaluatedRMEA[I][2]=t.paint.get("model-emissive-strength").evaluate(h,m,y),p.evaluatedRMEA[I][3]=E.a,p.emissionHeightBasedParams[I]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,m,y),!p.hasTranslucentParts&&E.a<1&&(p.hasTranslucentParts=!0)}delete h.properties.part,Aw(p,T!==p.evaluatedColor[2]||A!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(h,m,y);p.evaluatedScale=t.paint.get("model-scale").evaluate(h,m,y),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,s,c,p){const h=t.findDEMTileFor(c);if(h&&(h.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const m=$h.create(t,c,h);if(!m)return;this.modelTraits&Wh.HasMapboxMeshFeatures&&this.updateDEM(t,m,c,p);for(const x of this.getNodesInfo()){const T=x.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const A=T.footprint.vertices;let y=m.getElevationAt(A[0].x,A[0].y,!0,!0);for(let I=1;I<A.length;I++)y=Math.min(y,m.getElevationAt(A[I].x,A[I].y,!0,!0));T.elevation=y}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=s}}updateDEM(t,s,c,p){let h=s._dem._modifiedForSources[p];if(h===void 0&&(s._dem._modifiedForSources[p]=[],h=s._dem._modifiedForSources[p]),h.includes(c.canonical))return;const m=s._dem.dim;h.push(c.canonical);let x=!1;for(const T of this.getNodesInfo()){const A=T.node;if(!A.footprint||!A.footprint.grid)continue;const y=A.footprint.grid,I=s.tileCoordToPixel(y.min.x,y.min.y),M=s.tileCoordToPixel(y.max.x,y.max.y),E=Math.min(Math.min(m-M.y,I.x),Math.min(I.y,m-M.x));if(E<0)continue;const C=nn(E,2,5);let L=Math.max(0,I.x-C),k=Math.max(0,I.y-C),V=Math.min(M.x+C,m-1),j=Math.min(M.y+C,m-1);for(let J=k;J<=j;++J)for(let se=L;se<=V;++se)bh[J*m+se]=255;let Z=0,G=0;for(let J=0;J<y.cellsY;++J)for(let se=0;se<y.cellsX;++se){if(!y.cells[J*y.cellsX+se])continue;const pe=s.tileCoordToPixel(y.min.x+se/y.xScale,y.min.y+J/y.yScale),ue=s.tileCoordToPixel(y.min.x+(se+1)/y.xScale,y.min.y+(J+1)/y.yScale);for(let he=pe.y;he<=Math.min(ue.y+1,m-1);++he)for(let Le=pe.x;Le<=Math.min(ue.x+1,m-1);++Le)bh[he*m+Le]===255&&(bh[he*m+Le]=0,Z+=s.getElevationAtPixel(Le,he),G++)}const Y=Z/G;L=Math.max(1,I.x-C),k=Math.max(1,I.y-C),V=Math.min(M.x+C,m-2),j=Math.min(M.y+C,m-2),x=!0;for(let J=k;J<=j;++J)for(let se=L;se<=V;++se)bh[J*m+se]===0&&(Km[J*m+se]=s._dem.set(se,J,Y));for(let J=1;J<C;++J){L=Math.max(1,I.x-J),k=Math.max(1,I.y-J),V=Math.min(M.x+J,m-2),j=Math.min(M.y+J,m-2);for(let se=k;se<=j;++se)for(let pe=L;pe<=V;++pe){const ue=se*m+pe;if(bh[ue]===255){let he=0,Le=0,ce=-1,Me=-1;for(let Fe=-1;Fe<=1;++Fe)for(let ke=-1;ke<=1;++ke){const Ge=(se+Fe)*m+pe+ke;if(bh[Ge]>=J)continue;const Xe=Km[Ge],Ye=Math.abs(Xe);Ye>Le&&(he=Xe,Le=Ye,ce=ke,Me=Fe)}if(Le>.1){const Fe=1-(J+.5*Math.abs(ce*Me))/C;let ke=s._dem.get(pe,se)+he*Fe;const Ge=s._dem.get(pe+ce,se+Me),Xe=s._dem.get(pe-ce,se-Me,!0);(ke-Ge)*(ke-Xe)>0&&(ke=(Ge+Xe)/2),Km[ue]=s._dem.set(pe,se,ke),bh[ue]=J}}}}}x&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Vt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const s of t)gp(s.node),Jm(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(t.toUnwrapped()),p=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const m=p[h].node;p[h].hiddenByReplacement=!!m.footprint&&!c.find(x=>x.footprint===m.footprint)}}getHeightAtTileCoord(t,s){const c=this.getNodesInfo(),p=[],h=[0,0,0],m=Ve.mat4.identity([]);for(let x=0;x<this.nodesInfo.length;x++){const T=c[x],A=T.node.meshes[0],y=A.transformedAabb;if(t<y.min[0]||s<y.min[1]||t>y.max[0]||s>y.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};Ve.mat4.invert(m,T.node.matrix),h[0]=t,h[1]=s,Ve.vec3.transformMat4(h,h,m);const I=(h[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*xh|0,M=Math.min(63,(h[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*xh|0)*xh+Math.min(63,I),E=A.heightmap[M];if(!(E<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:E,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new Lt(t,s),new Lt(t,s),p),p.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function jd(l,t){return!l.isLightConstant&&t}function Mw(l,t,s,c,p,h,m,x){let T=(61440&t|(61440&t)>>4)>>8,A=(3840&t|(3840&t)>>4)>>4,y=240&t|(240&t)>>4;s[3]>0&&(T=ln(T,255*s[0],s[3]),A=ln(A,255*s[1],s[3]),y=ln(y,255*s[2],s[3]));const I=T<<8|A,M=y<<8|Math.floor(255*c[3]),E=function(J){const se=nn(J,0,2);return Math.min(Math.round(.5*se*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],C=nn(p[0],0,1),L=nn(p[1],0,1),k=nn(p[2],0,1),V=nn(p[3],0,1);let j,Z,G,Y;if(C!==L&&m!==h&&L!==C){const J=m-h;Z=1/(J*(L-C)),G=-(h+J*C)/(J*(L-C));const se=nn(p[4],-1,1);Y=Math.pow(10,se),j=255*k<<8|255*V}else j=65535,Z=0,G=1,Y=1;if(l.emplaceBack(I,M,E,j,Z,G,Y),x){const J=x.length;x.clear();for(let se=0;se<J;se++)x.emplaceBack(I,M,E,j,Z,G,Y)}}function Aw(l,t,s){const c=l.node;let p=0;const h=s&Wh.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===p||!m.featureData)continue;m.featureArray=new er,m.featureArray.reserve(m.featureData.length);let x=t;for(const T of m.featureData){const A=h?65535&T:T>>16&65535,y=h?T>>16&65535:65535&T,I=(15&y)<8?15&y:0,M=l.evaluatedRMEA[I],E=l.evaluatedColor[I],C=l.emissionHeightBasedParams[I];let L;if(x&&I===2&&c.lights&&(L=new er,L.resize(10*c.lights.length)),Mw(m.featureArray,A,E,M,C,m.aabb.min[2],m.aabb.max[2],L),L&&x){x=!1;const k=c.meshes[c.lightMeshIndex];k.featureArray=L,k.featureArray._trim()}}m.featureArray._trim(),p++}}Gt(_p,"Tiled3dModelBucket",{omit:["layers"]}),Gt(Z0,"Tiled3dModelFeature");const Pw=["id","tile","layer","source","sourceLayer","state"];class Hd{constructor(t,s,c,p,h){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=c,this._y=p,this.properties=t.properties,this.id=h}clone(){const t=new Hd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state={...this.state}),this.layer&&(t.layer={...this.layer}),this.namespace&&(t.namespace=this.namespace),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of Pw)this[s]!==void 0&&(t[s]=this[s]);return t}}function W0(l,t,s,c){const p=1<<l.z;t.lat=de((c/Mt+l.y)/p),t.lng=ae((s/Mt+l.x)/p)}const Lw={circle:class extends Rs{constructor(l,t,s,c){super(l,{layout:mi||(mi=new Ei({"circle-sort-key":new Ht($e.layout_circle["circle-sort-key"]),visibility:new It($e.layout_circle.visibility)})),paint:qi||(qi=new Ei({"circle-radius":new Ht($e.paint_circle["circle-radius"]),"circle-color":new Ht($e.paint_circle["circle-color"]),"circle-blur":new Ht($e.paint_circle["circle-blur"]),"circle-opacity":new Ht($e.paint_circle["circle-opacity"]),"circle-translate":new It($e.paint_circle["circle-translate"]),"circle-translate-anchor":new It($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new It($e.paint_circle["circle-emissive-strength"])}))},t,s,c)}createBucket(l){return new xt(l)}queryRadius(l){const t=l;return Oi("circle-radius",this,t)+Oi("circle-stroke-width",this,t)+kn(this.paint.get("circle-translate"))}queryIntersectsFeature(l,t,s,c,p,h,m,x){const T=Ti(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return T_(l,c,h,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,t,s){const c=I_(this);return{config:new Kl(this,{zoom:t,lut:s}),defines:c,overrideFog:!1}}},heatmap:class extends Rs{createBucket(l){return new C_(l)}constructor(l,t,s,c){super(l,{layout:M_||(M_=new Ei({visibility:new It($e.layout_heatmap.visibility)})),paint:A_||(A_=new Ei({"heatmap-radius":new Ht($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zo($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It($e.paint_heatmap["heatmap-opacity"])}))},t,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ed({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return Oi("heatmap-radius",this,l)}queryIntersectsFeature(l,t,s,c,p,h,m,x){const T=this.paint.get("heatmap-radius").evaluate(t,s);return T_(l,c,h,m,x,!0,!0,new Lt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,t,s){return l==="heatmap"?{config:new Kl(this,{zoom:t,lut:s}),overrideFog:!1}:{}}},hillshade:class extends Rs{constructor(l,t,s,c){super(l,{layout:P_||(P_=new Ei({visibility:new It($e.layout_hillshade.visibility)})),paint:L_||(L_=new Ei({"hillshade-illumination-direction":new It($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new It($e.paint_hillshade["hillshade-emissive-strength"])}))},t,s,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}},fill:class extends Rs{constructor(l,t,s,c){super(l,{layout:B_||(B_=new Ei({"fill-sort-key":new Ht($e.layout_fill["fill-sort-key"]),visibility:new It($e.layout_fill.visibility),"fill-elevation-reference":new It($e.layout_fill["fill-elevation-reference"])})),paint:V_||(V_=new Ei({"fill-antialias":new It($e.paint_fill["fill-antialias"]),"fill-opacity":new Ht($e.paint_fill["fill-opacity"]),"fill-color":new Ht($e.paint_fill["fill-color"]),"fill-outline-color":new Ht($e.paint_fill["fill-outline-color"]),"fill-translate":new It($e.paint_fill["fill-translate"]),"fill-translate-anchor":new It($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ht($e.paint_fill["fill-pattern"]),"fill-emissive-strength":new It($e.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ht($e.paint_fill["fill-z-offset"])}))},t,s,c)}getProgramIds(){const l=this.paint.get("fill-pattern"),t=l&&l.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(l,t,s){return{config:new Kl(this,{zoom:t,lut:s}),overrideFog:!1}}recalculate(l,t){super.recalculate(l,t);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new pm(l)}queryRadius(){return kn(this.paint.get("fill-translate"))}queryIntersectsFeature(l,t,s,c,p,h){return!l.queryGeometry.isAboveHorizon&&Kt(Pi(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Rs{constructor(l,t,s,c){super(l,{layout:by||(by=new Ei({visibility:new It($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new It($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:wy||(wy=new Ei({"fill-extrusion-opacity":new It($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ht($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new It($e["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new It($e["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new It($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new It($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new It($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new It($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ht($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ht($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new It($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new It($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new It($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new It($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ht($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ht($e["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new It($e["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},t,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new $f(l)}queryRadius(){return kn(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,t,s,c,p,h,m,x,T){const A=Ti(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),y=this.paint.get("fill-extrusion-height").evaluate(t,s),I=this.paint.get("fill-extrusion-base").evaluate(t,s),M=[0,0],E=x&&h.elevation,C=h.elevation?h.elevation.exaggeration():1,L=l.tile.getBucket(this);if(E&&L instanceof $f){const G=L.centroidVertexArray,Y=T+1;Y<G.length&&(M[0]=G.geta_centroid_pos0(Y),M[1]=G.geta_centroid_pos1(Y))}if(M[0]===0&&M[1]===1)return!1;h.projection.name==="globe"&&(c=xy([c],[new Lt(0,0),new Lt(Mt,Mt)],l.tileID.canonical).map(G=>G.polygon).flat());const k=E?x:null,[V,j]=function(G,Y,J,se,pe,ue,he,Le,ce,Me,Fe){return G.projection.name==="globe"?function(ke,Ge,Xe,Ye,Ze,ut,Et,ot,jt,Dt,Ct){const bt=[],an=[],qt=ke.projection.upVectorScale(Ct,ke.center.lat,ke.worldSize).metersToTile,$t=[0,0,0,1],wn=[0,0,0,1],Ln=(Mn,Bn,Nn,zi)=>{Mn[0]=Bn,Mn[1]=Nn,Mn[2]=zi,Mn[3]=1},Rn=vy();Xe>0&&(Xe+=Rn),Ye+=Rn;for(const Mn of Ge){const Bn=[],Nn=[];for(const zi of Mn){const Li=zi.x+Ze.x,gn=zi.y+Ze.y,gi=ke.projection.projectTilePoint(Li,gn,Ct),yi=ke.projection.upVector(Ct,zi.x,zi.y);let Hi=Xe,_r=Ye;if(Et){const Ar=Iy(Li,gn,Xe,Ye,Et,ot,jt,Dt);Hi+=Ar.base,_r+=Ar.top}Xe!==0?Ln($t,gi.x+yi[0]*qt*Hi,gi.y+yi[1]*qt*Hi,gi.z+yi[2]*qt*Hi):Ln($t,gi.x,gi.y,gi.z),Ln(wn,gi.x+yi[0]*qt*_r,gi.y+yi[1]*qt*_r,gi.z+yi[2]*qt*_r),Ve.vec3.transformMat4($t,$t,ut),Ve.vec3.transformMat4(wn,wn,ut),Bn.push(new vh($t[0],$t[1],$t[2])),Nn.push(new vh(wn[0],wn[1],wn[2]))}bt.push(Bn),an.push(Nn)}return[bt,an]}(G,Y,J,se,pe,ue,he,Le,ce,Me,Fe):he?function(ke,Ge,Xe,Ye,Ze,ut,Et,ot,jt){const Dt=[],Ct=[],bt=[0,0,0,1];for(const an of ke){const qt=[],$t=[];for(const wn of an){const Ln=wn.x+Ye.x,Rn=wn.y+Ye.y,Mn=Iy(Ln,Rn,Ge,Xe,ut,Et,ot,jt);bt[0]=Ln,bt[1]=Rn,bt[2]=Mn.base,bt[3]=1,Ve.vec4.transformMat4(bt,bt,Ze),bt[3]=Math.max(bt[3],1e-5);const Bn=new vh(bt[0]/bt[3],bt[1]/bt[3],bt[2]/bt[3]);bt[0]=Ln,bt[1]=Rn,bt[2]=Mn.top,bt[3]=1,Ve.vec4.transformMat4(bt,bt,Ze),bt[3]=Math.max(bt[3],1e-5);const Nn=new vh(bt[0]/bt[3],bt[1]/bt[3],bt[2]/bt[3]);qt.push(Bn),$t.push(Nn)}Dt.push(qt),Ct.push($t)}return[Dt,Ct]}(Y,J,se,pe,ue,he,Le,ce,Me):function(ke,Ge,Xe,Ye,Ze){const ut=[],Et=[],ot=Ze[8]*Ge,jt=Ze[9]*Ge,Dt=Ze[10]*Ge,Ct=Ze[11]*Ge,bt=Ze[8]*Xe,an=Ze[9]*Xe,qt=Ze[10]*Xe,$t=Ze[11]*Xe;for(const wn of ke){const Ln=[],Rn=[];for(const Mn of wn){const Bn=Mn.x+Ye.x,Nn=Mn.y+Ye.y,zi=Ze[0]*Bn+Ze[4]*Nn+Ze[12],Li=Ze[1]*Bn+Ze[5]*Nn+Ze[13],gn=Ze[2]*Bn+Ze[6]*Nn+Ze[14],gi=Ze[3]*Bn+Ze[7]*Nn+Ze[15],yi=zi+ot,Hi=Li+jt,_r=gn+Dt,Ar=Math.max(gi+Ct,1e-5),yr=zi+bt,sr=Li+an,wr=gn+qt,Vr=Math.max(gi+$t,1e-5);Ln.push(new vh(yi/Ar,Hi/Ar,_r/Ar)),Rn.push(new vh(yr/Vr,sr/Vr,wr/Vr))}ut.push(Ln),Et.push(Rn)}return[ut,Et]}(Y,J,se,pe,ue)}(h,c,I,y,A,m,k,M,C,h.center.lat,l.tileID.canonical),Z=l.queryGeometry;return function(G,Y,J){let se=1/0;Kt(J,Y)&&(se=Ey(J,Y[0]));for(let pe=0;pe<Y.length;pe++){const ue=Y[pe],he=G[pe];for(let Le=0;Le<ue.length-1;Le++){const ce=ue[Le],Me=[ce,ue[Le+1],he[Le+1],he[Le],ce];mt(J,Me)&&(se=Math.min(se,Ey(J,Me)))}}return se!==1/0&&se}(V,j,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends Rs{constructor(l,t,s,c){const p=Oy();super(l,p,t,s,c),p.layout&&(this.layout=new Na(p.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Ca,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,t){super.recalculate(l,t),this.paint._values["line-floorwidth"]=(()=>{if(Rd)return Rd;const s=Oy();return Rd=new Db(s.paint.properties["line-width"].specification),Rd.useIntegerZoom=!0,Rd})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Im(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,t,s){const c=Ry(this);return{config:new Kl(this,{zoom:t,lut:s}),defines:c,overrideFog:!1}}queryRadius(l){const t=l,s=Ny(Oi("line-width",this,t),Oi("line-gap-width",this,t)),c=Oi("line-offset",this,t);return s/2+Math.abs(c)+kn(this.paint.get("line-translate"))}queryIntersectsFeature(l,t,s,c,p,h){if(l.queryGeometry.isAboveHorizon)return!1;const m=Pi(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),x=l.pixelToTileUnitsFactor/2*Ny(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),T=this.paint.get("line-offset").evaluate(t,s);return T&&(c=function(A,y){const I=[],M=new Lt(0,0);for(let E=0;E<A.length;E++){const C=A[E],L=[];for(let k=0;k<C.length;k++){const V=C[k],j=C[k+1],Z=k===0?M:V.sub(C[k-1])._unit()._perp(),G=k===C.length-1?M:j.sub(V)._unit()._perp(),Y=Z._add(G)._unit();Y._mult(1/(Y.x*G.x+Y.y*G.y)),L.push(Y._mult(y)._add(V))}I.push(L)}return I}(c,T*l.pixelToTileUnitsFactor)),function(A,y,I){for(let M=0;M<y.length;M++){const E=y[M];if(A.length>=3){for(let C=0;C<E.length;C++)if(Hn(A,E[C]))return!0}if(on(A,E,I))return!0}return!1}(m,c,x)}isTileClipped(){return!0}isDraped(l){const t=this.layout.get("line-z-offset"),s=t.isConstant()&&!t.constantOr(0),c=this.layout.get("line-elevation-reference");return!(c==="sea"||c==="ground")&&(s||c!=="none")}},symbol:up,background:class extends Rs{constructor(l,t,s,c){super(l,{layout:y0||(y0=new Ei({visibility:new It($e.layout_background.visibility)})),paint:v0||(v0=new Ei({"background-pitch-alignment":new It($e.paint_background["background-pitch-alignment"]),"background-color":new It($e.paint_background["background-color"]),"background-pattern":new It($e.paint_background["background-pattern"]),"background-opacity":new It($e.paint_background["background-opacity"]),"background-emissive-strength":new It($e.paint_background["background-emissive-strength"])}))},t,s,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:I0,"raster-particle":P0,sky:class extends Rs{constructor(l,t,s,c){super(l,{layout:C0||(C0=new Ei({visibility:new It($e.layout_sky.visibility)})),paint:M0||(M0=new Ei({"sky-type":new It($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new It($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new It($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new It($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new It($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new zo($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new It($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new It($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new It($e.paint_sky["sky-opacity"])}))},t,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ed({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(l,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,h=l.style.light,m=h.properties.get("position");return p&&h.properties.get("anchor")==="viewport"&&Xn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Zm(m.azimuthal,90-m.polar,t):Zm(c[0],90-c[1],t)}const s=this.paint.get("sky-gradient-center");return Zm(s[0],90-s[1],t)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Rs{constructor(l,t,s,c){super(l,{paint:A0||(A0=new Ei({}))},t,null)}},model:class extends Rs{constructor(l,t,s,c){super(l,{layout:V0||(V0=new Ei({visibility:new It($e.layout_model.visibility),"model-id":new Ht($e.layout_model["model-id"])})),paint:U0||(U0=new Ei({"model-opacity":new It($e.paint_model["model-opacity"]),"model-rotation":new Ht($e.paint_model["model-rotation"]),"model-scale":new Ht($e.paint_model["model-scale"]),"model-translation":new Ht($e.paint_model["model-translation"]),"model-color":new Ht($e.paint_model["model-color"]),"model-color-mix-intensity":new Ht($e.paint_model["model-color-mix-intensity"]),"model-type":new It($e.paint_model["model-type"]),"model-cast-shadows":new It($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new It($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new It($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ht($e.paint_model["model-emissive-strength"]),"model-roughness":new Ht($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ht($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new It($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new It($e.paint_model["model-front-cutoff"])}))},t,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Xm(l)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof _p?Mt-1:0}queryIntersectsFeature(l,t,s,c,p,h){if(!this.modelManager)return!1;const m=this.modelManager,x=l.tile.getBucket(this);if(!(x&&x instanceof Xm))return!1;const T=x;for(const A in T.instancesPerModel){const y=T.instancesPerModel[A],I=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(y.idToFeaturesIndex.hasOwnProperty(I)){const M=y.features[y.idToFeaturesIndex[I]],E=m.getModel(A,this.scope);if(!E)return!1;let C=Ve.mat4.create();const L=new F(0,0),k=T.canonical;let V=Number.MAX_VALUE;for(let j=0;j<M.instancedDataCount;++j){const Z=16*(M.instancedDataOffset+j),G=y.instancedDataArray.float32,Y=[G[Z+4],G[Z+5],G[Z+6]];W0(k,L,G[Z],0|G[Z+1]),G0(C,E,h,L,M.rotation,M.scale,Y,!1,!1,!1),h.projection.name==="globe"&&(C=$m(C,h));const J=Ve.mat4.multiply([],h.projMatrix,C),se=l.queryGeometry,pe=N0(se.isPointQuery()?se.screenBounds:se.screenGeometry,h,J,E.aabb);pe!=null&&(V=Math.min(pe,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(l,t,s){return!(!this.layout||t.isDataDriven()||s.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const t=this._transitionablePaint._values[l];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof ql}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(l,t,s,c){const p=l.tile,h=p.getBucket(this);let m=null,x=Number.MAX_VALUE;if(!(h&&h instanceof _p))return{queryFeature:m,intersectionZ:x};const T=h.getNodesInfo()[t];if(T.hiddenByReplacement||!T.node.meshes||!s.filter(new Ui(p.tileID.overscaledZ),T.feature,p.tileID.canonical))return{queryFeature:m,intersectionZ:x};const A=T.node,y=c.calculatePosMatrix(p.tileID.toUnwrapped(),c.worldSize),I=T.evaluatedScale;let M=0;c.elevation&&A.elevation&&(M=A.elevation*c.elevation.exaggeration()),Ve.mat4.translate(y,y,[(A.anchor?A.anchor[0]:0)*(I[0]-1),(A.anchor?A.anchor[1]:0)*(I[1]-1),M]),Ve.mat4.scale(y,y,I);const E=l.queryGeometry,C=E.isPointQuery()?E.screenBounds:E.screenGeometry,L=function(G){const Y=Ve.mat4.multiply([],y,G.matrix);Ve.mat4.multiply(Y,c.expandedFarZProjMatrix,Y);for(let J=0;J<G.meshes.length;++J){const se=G.meshes[J];if(J===G.lightMeshIndex)continue;const pe=N0(C,c,Y,se.aabb);pe!=null&&(x=Math.min(pe,x))}if(G.children)for(const J of G.children)L(J)};if(L(A),x===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:x};const k=new F(0,0);W0(p.tileID.canonical,k,T.node.anchor[0],T.node.anchor[1]);const{z:V,x:j,y:Z}=p.tileID.canonical;return m=new Hd({},V,j,Z,T.feature.id),m.properties=T.feature.properties,m.geometry={type:"Point",coordinates:[k.lng,k.lat]},m.layer={...this.serialize(),id:this.fqid},m.state={},m.tile=p.tileID.canonical,{queryFeature:m,intersectionZ:x}}},clip:class extends Rs{constructor(l,t,s,c){super(l,{layout:U_||(U_=new Ei({"clip-layer-types":new It($e.layout_clip["clip-layer-types"]),"clip-layer-scope":new It($e.layout_clip["clip-layer-scope"])})),paint:G_||(G_=new Ei({}))},t,s,c)}recalculate(l,t){super.recalculate(l,t)}createBucket(l){return new q_(l)}isTileClipped(){return!0}is3D(){return!0}}};class Rw{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Dw{constructor(){this.tasks={},this.taskQueue=[],jn(["process"],this),this.invoker=new Rw(this.process),this.nextId=0}add(t,s){const c=this.nextId++,p=function({type:h,isSymbolTile:m,zoom:x}){return x=x||0,h==="message"?0:h!=="maybePrepare"||m?h!=="parseTile"||m?h==="parseTile"&&m?300-x:h==="maybePrepare"&&m?400-x:500:200-x:100-x}(s);if(p===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:s,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let p=0;p<this.taskQueue.length;p++){const h=this.tasks[this.taskQueue[p]];h.priority<s&&(s=h.priority,t=p)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class $0{constructor(t,s,c){this.target=t,this.parent=s,this.mapId=c,this.callbacks={},this.cancelCallbacks={},jn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Dw}send(t,s,c,p,h=!1,m){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[x]=c);const T=new Set;return this.target.postMessage({id:x,type:t,hasCallback:!!c,targetMapId:p,mustQueue:h,sourceMapId:this.mapId,data:No(s,T)},T),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(t){const s=t.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const p=this.cancelCallbacks[c];delete this.cancelCallbacks[c],p&&p.cancel()}else if(s.mustQueue||Rr()){const p=this.callbacks[c],h=this.scheduler.add(()=>this.processTask(c,s),p&&p.metadata||{type:"message"});h&&(this.cancelCallbacks[c]=h)}else this.processTask(c,s)}processTask(t,s){if(delete this.cancelCallbacks[t],s.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(s.error?c(os(s.error)):c(null,os(s.data)))}else{const c=new Set,p=s.hasCallback?(m,x)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:m?No(m):null,data:No(x,c)},c)}:()=>{},h=os(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,h,p);else if(this.parent.getWorkerSource){const m=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,m[0],h.source,h.scope)[m[1]](h,p)}else p(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Xh{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Fs();const c=this.workerPool.acquire(this.id);for(let p=0;p<c.length;p++){const h=new Xh.Actor(c[p],s,this.id);h.name=`Worker ${p}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,c){dr(this.actors,(p,h)=>{p.send(t,s,h)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}Xh.Actor=$0;class X0{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){const c=this.toIdx(t,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function Y0(l,t,s,c){let p=0,h=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(s[m]<l[m]||s[m]>t[m])return null}else{const x=1/c[m];let T=(l[m]-s[m])*x,A=(t[m]-s[m])*x;if(T>A){const y=T;T=A,A=y}if(T>p&&(p=T),A<h&&(h=A),p>h)return null}return p}function J0(l,t,s,c,p,h,m,x,T,A,y){const I=c-l,M=p-t,E=h-s,C=m-l,L=x-t,k=T-s,V=y[1]*k-y[2]*L,j=y[2]*C-y[0]*k,Z=y[0]*L-y[1]*C,G=I*V+M*j+E*Z;if(Math.abs(G)<1e-15)return null;const Y=1/G,J=A[0]-l,se=A[1]-t,pe=A[2]-s,ue=(J*V+se*j+pe*Z)*Y;if(ue<0||ue>1)return null;const he=se*E-pe*M,Le=pe*I-J*E,ce=J*M-se*I,Me=(y[0]*he+y[1]*Le+y[2]*ce)*Y;return Me<0||ue+Me>1?null:(C*he+L*Le+k*ce)*Y}function K0(l,t,s){return(l-t)/(s-t)}function Q0(l,t,s,c,p,h,m,x,T){const A=1<<s,y=h-c,I=m-p,M=(l+1)/A*y+c,E=(t+0)/A*I+p,C=(t+1)/A*I+p;x[0]=(l+0)/A*y+c,x[1]=E,T[0]=M,T[1]=C}class ev{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(h){const m=Math.ceil(Math.log2(h.dim/8)),x=[];let T=Math.ceil(Math.pow(2,m));const A=1/T,y=(E,C,L,k,V)=>{const j=k?1:0,Z=(E+1)*L-j,G=C*L,Y=(C+1)*L-j;V[0]=E*L,V[1]=G,V[2]=Z,V[3]=Y};let I=new X0(T);const M=[];for(let E=0;E<T*T;E++){y(E%T,Math.floor(E/T),A,!1,M);const C=Jc(M[0],M[1],h),L=Jc(M[2],M[1],h),k=Jc(M[2],M[3],h),V=Jc(M[0],M[3],h);I.minimums.push(Math.min(C,L,k,V)),I.maximums.push(Math.max(C,L,k,V)),I.leaves.push(1)}for(x.push(I),T/=2;T>=1;T/=2){const E=x[x.length-1];I=new X0(T);for(let C=0;C<T*T;C++){y(C%T,Math.floor(C/T),2,!0,M);const L=E.getElevation(M[0],M[1]),k=E.getElevation(M[2],M[1]),V=E.getElevation(M[2],M[3]),j=E.getElevation(M[0],M[3]),Z=E.isLeaf(M[0],M[1]),G=E.isLeaf(M[2],M[1]),Y=E.isLeaf(M[2],M[3]),J=E.isLeaf(M[0],M[3]),se=Math.min(L.min,k.min,V.min,j.min),pe=Math.max(L.max,k.max,V.max,j.max),ue=Z&&G&&Y&&J;I.maximums.push(pe),I.minimums.push(se),I.leaves.push(pe-se<=5&&ue?1:0)}x.push(I)}return x}(this.dem),c=s.length-1,p=s[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(t,s,c,p,h,m,x=1){return Y0([t,s,-100],[c,p,this.maximums[0]*x],h,m)}raycast(t,s,c,p,h,m,x=1){if(!this.nodeCount)return null;const T=this.raycastRoot(t,s,c,p,h,m,x);if(T==null)return null;const A=[],y=[],I=[],M=[],E=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:C,t:L,nodex:k,nodey:V,depth:j}=E.pop();if(this.leaves[C]){Q0(k,V,j,t,s,c,p,I,M);const G=1<<j,Y=(k+0)/G,J=(k+1)/G,se=(V+0)/G,pe=(V+1)/G,ue=Jc(Y,se,this.dem)*x,he=Jc(J,se,this.dem)*x,Le=Jc(J,pe,this.dem)*x,ce=Jc(Y,pe,this.dem)*x,Me=J0(I[0],I[1],ue,M[0],I[1],he,M[0],M[1],Le,h,m),Fe=J0(M[0],M[1],Le,I[0],M[1],ce,I[0],I[1],ue,h,m),ke=Math.min(Me!==null?Me:Number.MAX_VALUE,Fe!==null?Fe:Number.MAX_VALUE);if(ke!==Number.MAX_VALUE)return ke;{const Ge=Ve.vec3.scaleAndAdd([],h,m,L);if(tv(ue,he,ce,Le,K0(Ge[0],I[0],M[0]),K0(Ge[1],I[1],M[1]))>=Ge[2])return L}continue}let Z=0;for(let G=0;G<this._siblingOffset.length;G++){Q0((k<<1)+this._siblingOffset[G][0],(V<<1)+this._siblingOffset[G][1],j+1,t,s,c,p,I,M),I[2]=-100,M[2]=this.maximums[this.childOffsets[C]+G]*x;const Y=Y0(I,M,h,m);if(Y!=null){const J=Y;A[G]=J;let se=!1;for(let pe=0;pe<Z&&!se;pe++)J>=A[y[pe]]&&(y.splice(pe,0,G),se=!0);se||(y[Z]=G),Z++}}for(let G=0;G<Z;G++){const Y=y[G];E.push({idx:this.childOffsets[C]+Y,t:A[Y],nodex:(k<<1)+this._siblingOffset[Y][0],nodey:(V<<1)+this._siblingOffset[Y][1],depth:j+1})}}return null}_addNode(t,s,c){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,c,p,h){if(t[p].isLeaf(s,c)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const m=p-1,x=t[m];let T=0,A=0;for(let y=0;y<this._siblingOffset.length;y++){const I=2*s+this._siblingOffset[y][0],M=2*c+this._siblingOffset[y][1],E=x.getElevation(I,M),C=x.isLeaf(I,M),L=this._addNode(E.min,E.max,C);C&&(T|=1<<y),A||(A=L)}for(let y=0;y<this._siblingOffset.length;y++)T&1<<y||this._construct(t,2*s+this._siblingOffset[y][0],2*c+this._siblingOffset[y][1],m,A+y)}}function tv(l,t,s,c,p,h){return ln(ln(l,s,h),ln(t,c,h),p)}function Jc(l,t,s){const c=s.dim,p=nn(l*c-.5,0,c-1),h=nn(t*c-.5,0,c-1),m=Math.floor(p),x=Math.floor(h),T=Math.min(m+1,c-1),A=Math.min(x+1,c-1);return tv(s.get(m,x),s.get(T,x),s.get(m,A),s.get(T,A),p-m,h-x)}const Ow={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Nw(l,t,s){return(256*l*256+256*t+s)/10-1e4}function zw(l,t,s){return 256*l+t+s/256-32768}class yp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,c,p=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void Xn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const h=this.dim=s.height-2,m=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let T=0;T<h;T++)m[this._idx(-1,T)]=m[this._idx(0,T)],m[this._idx(h,T)]=m[this._idx(h-1,T)],m[this._idx(T,-1)]=m[this._idx(T,0)],m[this._idx(T,h)]=m[this._idx(T,h-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(h,-1)]=m[this._idx(h-1,0)],m[this._idx(-1,h)]=m[this._idx(0,h-1)],m[this._idx(h,h)]=m[this._idx(h-1,h-1)]}const x=c==="terrarium"?zw:Nw;for(let T=0;T<m.length;++T){const A=4*T;this.floatView[T]=x(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=Vt.now()}_buildQuadTree(){this._tree=new ev(this)}get(t,s,c=!1){c&&(t=nn(t,-1,this.dim),s=nn(s,-1,this.dim));const p=this._idx(t,s);return this.floatView[p]}set(t,s,c){const p=this._idx(t,s),h=this.floatView[p];return this.floatView[p]=c,c-h}static getUnpackVector(t){return Ow[t]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}static pack(t,s){const c=[0,0,0,0],p=yp.getUnpackVector(s);let h=Math.floor((t+p[3])/p[2]);return c[2]=h%256,h=Math.floor(h/256),c[1]=h%256,h=Math.floor(h/256),c[0]=h,c}getPixels(){return new O_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,h=s*this.dim+this.dim,m=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:p=h-1;break;case 1:h=p+1}switch(c){case-1:m=x-1;break;case 1:x=m+1}const T=-s*this.dim,A=-c*this.dim;for(let y=m;y<x;y++)for(let I=p;I<h;I++){const M=4*this._idx(I,y),E=4*this._idx(I+T,y+A);this.pixels[M+0]=t.pixels[E+0],this.pixels[M+1]=t.pixels[E+1],this.pixels[M+2]=t.pixels[E+2],this.pixels[M+3]=t.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Fw(l,t,s){l===1?t.headerLength=s.readFixed32():l===2?t.x=s.readVarint():l===3?t.y=s.readVarint():l===4?t.z=s.readVarint():l===5&&t.layers.push(function(c,p){return c.readFields(Gw,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(s,s.readVarint()+s.pos))}function kw(l,t,s){l===1?(t.delta_filter=function(c,p){return c.readFields(Bw,{blockSize:0},p)}(s,s.readVarint()+s.pos),t.filter="delta_filter"):l===2?(s.readVarint(),t.filter="zigzag_filter"):l===3?(s.readVarint(),t.filter="bitshuffle_filter"):l===4&&(s.readVarint(),t.filter="byteshuffle_filter")}function Bw(l,t,s){l===1&&(t.blockSize=s.readVarint())}function Vw(l,t,s){l===1?(s.readVarint(),t.codec="gzip_data"):l===2?(s.readVarint(),t.codec="jpeg_image"):l===3?(s.readVarint(),t.codec="webp_image"):l===4&&(s.readVarint(),t.codec="png_image")}function Uw(l,t,s){let c=0,p=0;l===1?t.firstByte=s.readFixed64():l===2?t.lastByte=s.readFixed64():l===3?t.filters.push(function(h,m){return h.readFields(kw,{},m)}(s,s.readVarint()+s.pos)):l===4?t.codec=function(h,m){return h.readFields(Vw,{},m)}(s,s.readVarint()+s.pos):l===5?p=s.readFloat():l===6?c=s.readFloat():l===7?t.bands.push(s.readString()):l===8?t.offset=s.readDouble():l===9&&(t.scale=s.readDouble()),t.offset===0&&(t.offset=p),t.scale===0&&(t.scale=c)}function Gw(l,t,s){l===1?t.version=s.readVarint():l===2?t.name=s.readString():l===3?t.units=s.readString():l===4?t.tileSize=s.readVarint():l===5?t.buffer=s.readVarint():l===6?t.pixelFormat=s.readVarint():l===7&&t.dataIndex.push(function(c,p){return c.readFields(Uw,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(s,s.readVarint()+s.pos))}function qw(l,t,s){if(l===2)(function(c,p,h){c.readFields(jw,h,p)})(s,s.readVarint()+s.pos,t);else if(l===3)throw new Error("Not implemented")}function jw(l,t,s){if(l===1){let c=0;const p=s.readVarint()+s.pos;for(;s.pos<p;)t[c++]=s.readVarint()}}Gt(yp,"DEMData"),Gt(ev,"DemMinMaxQuadTree",{omit:["dem"]});class Hw{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const s=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,s),s}put(t,s){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,s)}}function Zw(l,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let s=t[3];for(let c=2;c>=1;c--){const p=c===1?1:0,h=c===2?1:0;for(let m=0;m<t[0];m++){const x=t[1]*m;for(let T=p;T<t[1];T++){const A=t[2]*(T+x);for(let y=h;y<t[2];y++){const I=t[3]*(y+A);for(let M=0;M<t[3];M++){const E=I+M;l[E]+=l[E-s]}}}}s*=t[c]}return l}function Ww(l){for(let t=0,s=l.length;t<s;t++)l[t]=l[t]>>>1^-(1&l[t]);return l}function $w(l,t){switch(t){case"uint32":return l;case"uint16":for(let s=0;s<l.length;s+=2){const c=l[s],p=l[s+1];l[s]=(240&c)>>4|(61440&c)>>8|(240&p)<<4|61440&p,l[s+1]=15&c|(3840&c)>>4|(15&p)<<8|(3840&p)<<4}return l;case"uint8":for(let s=0;s<l.length;s+=4){const c=l[s],p=l[s+1],h=l[s+2],m=l[s+3];l[s+0]=(192&c)>>6|(192&p)>>4|(192&h)>>2|192&m,l[s+1]=(48&c)>>4|(48&p)>>2|48&h|(48&m)<<2,l[s+2]=(12&c)>>2|12&p|(12&h)<<2|(12&m)<<4,l[s+3]=3&c|(3&p)<<2|(3&h)<<4|(3&m)<<6}return l;default:throw new Error(`Invalid pixel format, "${t}"`)}}var Ua=Uint8Array,Zd=Uint16Array,Xw=Int32Array,nv=new Ua([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),iv=new Ua([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Yw=new Ua([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rv=function(l,t){for(var s=new Zd(31),c=0;c<31;++c)s[c]=t+=1<<l[c-1];var p=new Xw(s[30]);for(c=1;c<30;++c)for(var h=s[c];h<s[c+1];++h)p[h]=h-s[c]<<5|c;return{b:s,r:p}},sv=rv(nv,2),ov=sv.b,Jw=sv.r;ov[28]=258,Jw[258]=28;for(var Kw=rv(iv,0).b,av=new Zd(32768),Mr=0;Mr<32768;++Mr){var Yh=(43690&Mr)>>1|(21845&Mr)<<1;av[Mr]=((65280&(Yh=(61680&(Yh=(52428&Yh)>>2|(13107&Yh)<<2))>>4|(3855&Yh)<<4))>>8|(255&Yh)<<8)>>1}var Wd=function(l,t,s){for(var c=l.length,p=0,h=new Zd(t);p<c;++p)l[p]&&++h[l[p]-1];var m,x=new Zd(t);for(p=1;p<t;++p)x[p]=x[p-1]+h[p-1]<<1;m=new Zd(1<<t);var T=15-t;for(p=0;p<c;++p)if(l[p])for(var A=p<<4|l[p],y=t-l[p],I=x[l[p]-1]++<<y,M=I|(1<<y)-1;I<=M;++I)m[av[I]>>T]=A;return m},$d=new Ua(288);for(Mr=0;Mr<144;++Mr)$d[Mr]=8;for(Mr=144;Mr<256;++Mr)$d[Mr]=9;for(Mr=256;Mr<280;++Mr)$d[Mr]=7;for(Mr=280;Mr<288;++Mr)$d[Mr]=8;var lv=new Ua(32);for(Mr=0;Mr<32;++Mr)lv[Mr]=5;var Qw=Wd($d,9),eE=Wd(lv,5),Qm=function(l){for(var t=l[0],s=1;s<l.length;++s)l[s]>t&&(t=l[s]);return t},nu=function(l,t,s){var c=t/8|0;return(l[c]|l[c+1]<<8)>>(7&t)&s},eg=function(l,t){var s=t/8|0;return(l[s]|l[s+1]<<8|l[s+2]<<16)>>(7&t)},tE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],iu=function(l,t,s){var c=new Error(t||tE[l]);if(c.code=l,Error.captureStackTrace&&Error.captureStackTrace(c,iu),!s)throw c;return c},nE=new Ua(0),iE=typeof TextDecoder<"u"&&new TextDecoder;try{iE.decode(nE,{stream:!0})}catch{}const rE={gzip_data:"gzip"};class bl extends Error{constructor(t){super(t),this.name="MRTError"}}const sE={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},uv={uint32:1,uint16:2,uint8:4},oE={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let tg;class ng{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const s=this.layers[t];if(!s)throw new bl(`Layer '${t}' not found`);return s}getHeaderLength(t){const s=new Uint8Array(t),c=new DataView(t);if(s[0]!==13)throw new bl("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const s=new Uint8Array(t),c=this.getHeaderLength(t);if(s.length<c)throw new bl(`Expected header with length >= ${c} but got buffer of length ${s.length}`);const p=function(h,m){return h.readFields(Fw,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new tg(s.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new bl(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const h of p.layers)this.layers[h.name]=new aE(h,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const s=[],c=this.getLayer(t.layerName);for(let p of t.blockIndices){const h=c.dataIndex[p],m=h.firstByte-t.firstByte,x=h.lastByte-t.firstByte;if(c._blocksInProgress.has(p))continue;const T={layerName:c.name,firstByte:m,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:p,blockShape:[h.bands.length].concat(c.bandShape),buffer:c.buffer,codec:h.codec.codec,filters:h.filters.map(A=>A.filter)};c._blocksInProgress.add(p),s.push(T)}return new cv(s,()=>{s.forEach(p=>c._blocksInProgress.delete(p.blockIndex))},(p,h)=>{if(s.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),p)throw p;h.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class aE{constructor({version:t,name:s,units:c,tileSize:p,pixelFormat:h,buffer:m,dataIndex:x},T){if(this.version=t,this.version!==1)throw new bl(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=s,this.units=c,this.tileSize=p,this.buffer=m,this.pixelFormat=sE[h],this.dataIndex=x,this.bandShape=[p+2*m,p+2*m,uv[this.pixelFormat]],this._decodedBlocks=new Hw(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return uv[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const s=t.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,t.data)}getBlockForBand(t){let s=0;switch(typeof t){case"string":for(const[c,p]of this.dataIndex.entries()){for(const[h,m]of p.bands.entries())if(m===t)return{bandIndex:s+h,blockIndex:c,blockBandIndex:h};s+=p.bands.length}break;case"number":for(const[c,p]of this.dataIndex.entries()){if(t>=s&&t<s+p.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-s};s+=p.bands.length}break;default:throw new bl(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new bl(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let s=1/0,c=-1/0;const p=[],h=new Set;for(const m of t){const{blockIndex:x}=this.getBlockForBand(m);if(x<0)throw new bl(`Invalid band: ${JSON.stringify(m)}`);const T=this.dataIndex[x];p.includes(x)||p.push(x),h.add(x),s=Math.min(s,T.firstByte),c=Math.max(c,T.lastByte)}if(h.size>this.cacheSize)throw new bl(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:c,blockIndices:p}}hasBand(t){const{blockIndex:s}=this.getBlockForBand(t);return s>=0}hasDataForBand(t){const{blockIndex:s}=this.getBlockForBand(t);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(t){const{blockIndex:s,blockBandIndex:c}=this.getBlockForBand(t),p=this._decodedBlocks.get(s.toString());if(!p)throw new bl(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[s],m=this.bandShape.reduce((A,y)=>A*y,1),x=c*m,T=p.subarray(x,x+m);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}ng.setPbf=function(l){tg=l};class cv{constructor(t,s,c){this.tasks=t,this._onCancel=s,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,s){this._finalized||(this._onComplete(t,s),this._finalized=!0)}}ng.performDecoding=function(l,t){const s=new Uint8Array(l);return Promise.all(t.tasks.map(c=>{const{layerName:p,firstByte:h,lastByte:m,pixelFormat:x,blockShape:T,blockIndex:A,filters:y,codec:I}=c,M=s.subarray(h,m+1),E=new Uint32Array(T[0]*T[1]*T[2]);let C;if(I!=="gzip_data")throw new bl(`Unhandled codec: ${I}`);return C=function(L,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((G=function(se){se[0]==31&&se[1]==139&&se[2]==8||iu(6,"invalid gzip data");var pe=se[3],ue=10;4&pe&&(ue+=2+(se[10]|se[11]<<8));for(var he=(pe>>3&1)+(pe>>4&1);he>0;he-=!se[ue++]);return ue+(2&pe)}(Z=L))+8>Z.length&&iu(6,"invalid gzip data"),function(se,pe,ue,he){var Le=se.length;if(!Le||pe.f&&!pe.l)return ue||new Ua(0);var ce=!ue,Me=ce||pe.i!=2,Fe=pe.i;ce&&(ue=new Ua(3*Le));var ke,Ge,Xe=function(Kc){var Ih=ue.length;if(Kc>Ih){var tf=new Ua(Math.max(2*Ih,Kc));tf.set(ue),ue=tf}},Ye=pe.f||0,Ze=pe.p||0,ut=pe.b||0,Et=pe.l,ot=pe.d,jt=pe.m,Dt=pe.n,Ct=8*Le;do{if(!Et){Ye=nu(se,Ze,1);var bt=nu(se,Ze+1,3);if(Ze+=3,!bt){var an=se[(gn=4+((Ze+7)/8|0))-4]|se[gn-3]<<8,qt=gn+an;if(qt>Le){Fe&&iu(0);break}Me&&Xe(ut+an),ue.set(se.subarray(gn,qt),ut),pe.b=ut+=an,pe.p=Ze=8*qt,pe.f=Ye;continue}if(bt==1)Et=Qw,ot=eE,jt=9,Dt=5;else if(bt==2){var $t=nu(se,Ze,31)+257,wn=nu(se,Ze+10,15)+4,Ln=$t+nu(se,Ze+5,31)+1;Ze+=14;for(var Rn=new Ua(Ln),Mn=new Ua(19),Bn=0;Bn<wn;++Bn)Mn[Yw[Bn]]=nu(se,Ze+3*Bn,7);Ze+=3*wn;var Nn=Qm(Mn),zi=(1<<Nn)-1,Li=Wd(Mn,Nn);for(Bn=0;Bn<Ln;){var gn,gi=Li[nu(se,Ze,zi)];if(Ze+=15&gi,(gn=gi>>4)<16)Rn[Bn++]=gn;else{var yi=0,Hi=0;for(gn==16?(Hi=3+nu(se,Ze,3),Ze+=2,yi=Rn[Bn-1]):gn==17?(Hi=3+nu(se,Ze,7),Ze+=3):gn==18&&(Hi=11+nu(se,Ze,127),Ze+=7);Hi--;)Rn[Bn++]=yi}}var _r=Rn.subarray(0,$t),Ar=Rn.subarray($t);jt=Qm(_r),Dt=Qm(Ar),Et=Wd(_r,jt),ot=Wd(Ar,Dt)}else iu(1);if(Ze>Ct){Fe&&iu(0);break}}Me&&Xe(ut+131072);for(var yr=(1<<jt)-1,sr=(1<<Dt)-1,wr=Ze;;wr=Ze){var Vr=(yi=Et[eg(se,Ze)&yr])>>4;if((Ze+=15&yi)>Ct){Fe&&iu(0);break}if(yi||iu(2),Vr<256)ue[ut++]=Vr;else{if(Vr==256){wr=Ze,Et=null;break}var zs=Vr-254;Vr>264&&(zs=nu(se,Ze,(1<<(su=nv[Bn=Vr-257]))-1)+ov[Bn],Ze+=su);var Gi=ot[eg(se,Ze)&sr],Vo=Gi>>4;if(Gi||iu(3),Ze+=15&Gi,Ar=Kw[Vo],Vo>3){var su=iv[Vo];Ar+=eg(se,Ze)&(1<<su)-1,Ze+=su}if(Ze>Ct){Fe&&iu(0);break}Me&&Xe(ut+131072);var wl=ut+zs;if(ut<Ar){var El=0-Ar,Eh=Math.min(Ar,wl);for(El+ut<0&&iu(3);ut<Eh;++ut)ue[ut]=(void 0)[El+ut]}for(;ut<wl;++ut)ue[ut]=ue[ut-Ar]}}pe.l=Et,pe.p=wr,pe.b=ut,pe.f=Ye,Et&&(Ye=1,pe.m=jt,pe.d=ot,pe.n=Dt)}while(!Ye);return ut!=ue.length&&ce?(ke=ue,((Ge=ut)==null||Ge>ke.length)&&(Ge=ke.length),new Ua(ke.subarray(0,Ge))):ue.subarray(0,ut)}(Z.subarray(G,-8),{i:2},new Ua(((V=Z)[(j=V.length)-4]|V[j-3]<<8|V[j-2]<<16|V[j-1]<<24)>>>0))));var V,j,Z,G;const Y=rE[k];if(!Y)throw new Error(`Unhandled codec: ${k}`);const J=new globalThis.DecompressionStream(Y);return new Response(new Blob([L]).stream().pipeThrough(J)).arrayBuffer().then(se=>new Uint8Array(se))}(M,I).then(L=>(function(k,V){k.readFields(qw,V)}(new tg(L),E),new oE[x](E.buffer))),C.then(L=>{for(let k=y.length-1;k>=0;k--)switch(y[k]){case"delta_filter":Zw(L,T);break;case"zigzag_filter":Ww(L);break;case"bitshuffle_filter":$w(L,x);break;default:throw new bl(`Unhandled filter "${y[k]}"`)}return{layerName:p,blockIndex:A,data:L}}).catch(L=>{throw L})}))},Gt(cv,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var Xd={workerUrl:"",workerClass:null,workerParams:void 0};const ig="mapboxgl_preloaded_worker_pool";class Yd{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Yd.workerCount;)this.workers.push(Xd.workerClass!=null?new Xd.workerClass:new self.Worker(Xd.workerUrl,Xd.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ig]}numActive(){return Object.keys(this.active).length}}let Jd;function vp(){return Jd||(Jd=new Yd),Jd}Yd.workerCount=2;let Kd,rg,ru,Jh,sg,Kh=null;function hv(){return Rr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:rg||ge.DRACO_URL}function dv(){if(Rr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Jh)return Jh;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Jh=WebAssembly.validate(l)?ge.MESHOPT_SIMD_URL:ge.MESHOPT_URL,Jh}const xp={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Qd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function fv(l,t,s){const c=s.json.bufferViews.length,p=s.buffers.length;t.bufferView=c,s.json.bufferViews[c]={buffer:p,byteLength:l.byteLength},s.buffers[p]=l}const og="KHR_draco_mesh_compression";function uE(l,t){const s=l.extensions&&l.extensions[og];if(!s)return;const c=new ru.Decoder,p=_v(t,s.bufferView),h=new ru.Mesh;if(!c.DecodeArrayToMesh(p,p.byteLength,h))throw new Error("Failed to decode Draco mesh");const m=t.json.accessors[l.indices],x=xp[m.componentType],T=m.count*x.BYTES_PER_ELEMENT,A=ru._malloc(T);x===Uint16Array?c.GetTrianglesUInt16Array(h,T,A):c.GetTrianglesUInt32Array(h,T,A),fv(ru.memory.buffer.slice(A,A+T),m,t),ru._free(A);for(const y of Object.keys(s.attributes)){const I=c.GetAttributeByUniqueId(h,s.attributes[y]),M=t.json.accessors[l.attributes[y]],E=lE[M.componentType],C=M.count*Qd[M.type]*xp[M.componentType].BYTES_PER_ELEMENT,L=ru._malloc(C);c.GetAttributeDataArrayForAllPoints(h,I,ru[E],C,L),fv(ru.memory.buffer.slice(L,L+C),M,t),ru._free(L)}c.destroy(),h.destroy(),delete l.extensions[og]}const bp="EXT_meshopt_compression";function cE(l,t){if(!l.extensions||!l.extensions[bp])return;const s=l.extensions[bp],c=new Uint8Array(t.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),p=new Uint8Array(s.count*s.byteStride);sg.decodeGltfBuffer(p,s.count,s.byteStride,c,s.mode,s.filter),l.buffer=t.buffers.length,l.byteOffset=0,t.buffers[l.buffer]=p.buffer,delete l.extensions[bp]}const pv=1179937895,mv=new TextDecoder("utf8");function gv(l,t){return new URL(l,t).href}function hE(l,t,s,c){return fetch(gv(l.uri,c)).then(p=>p.arrayBuffer()).then(p=>{t.buffers[s]=p})}function _v(l,t){const s=l.json.bufferViews[t];return new Uint8Array(l.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function dE(l,t,s,c){if(l.uri){const p=gv(l.uri,c);return fetch(p).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{t.images[s]=h})}if(l.bufferView!==void 0){const p=_v(t,l.bufferView),h=new Blob([p],{type:l.mimeType});return createImageBitmap(h).then(m=>{t.images[s]=m})}}function yv(l,t=0,s){const c={json:null,images:[],buffers:[]};if(new Uint32Array(l,t,1)[0]===pv){const y=new Uint32Array(l,t);let I=2;const M=(y[I++]>>2)-3,E=y[I++]>>2;if(I++,c.json=JSON.parse(mv.decode(y.subarray(I,I+E))),I+=E,I<M){const C=y[I++];I++;const L=t+(I<<2);c.buffers[0]=l.slice(L,L+C)}}else c.json=JSON.parse(mv.decode(new Uint8Array(l,t)));const{buffers:p,images:h,meshes:m,extensionsUsed:x,bufferViews:T}=c.json;let A=Promise.resolve();if(p){const y=[];for(let I=0;I<p.length;I++){const M=p[I];M.uri?y.push(hE(M,c,I,s)):c.buffers[I]||(c.buffers[I]=null)}A=Promise.all(y)}return A.then(()=>{const y=[],I=x&&x.includes(og),M=x&&x.includes(bp);if(I&&y.push(function(){if(!ru)return Kd??(Kd=function(E){let C,L=null;function k(){C=new Uint8Array(L.buffer)}function V(){throw new Error("Unexpected Draco error.")}const j={a:{a:V,d:function(Z,G,Y){return C.copyWithin(Z,G,G+Y)},c:function(Z){const G=C.length,Y=Math.max(Z>>>0,Math.ceil(1.2*G)),J=Math.ceil((Y-G)/65536);try{return L.grow(J),k(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,j):E.then(Z=>Z.arrayBuffer()).then(Z=>WebAssembly.instantiate(Z,j))).then(Z=>{const{Rb:G,Qb:Y,P:J,T:se,X:pe,Ja:ue,La:he,Qa:Le,Va:ce,Wa:Me,eb:Fe,jb:ke,f:Ge,e:Xe,yb:Ye,zb:Ze,Ab:ut,Bb:Et,Db:ot,Gb:jt}=Z.instance.exports;L=Xe;const Dt=(()=>{let Ct=0,bt=0,an=0,qt=0;return $t=>{an&&(G(qt),G(Ct),bt+=an,an=Ct=0),Ct||(bt+=128,Ct=Y(bt));const wn=$t.length+7&-8;let Ln=Ct;wn>=bt&&(an=wn,Ln=qt=Y(wn));for(let Rn=0;Rn<$t.length;Rn++)C[Ln+Rn]=$t[Rn];return Ln}})();return k(),Ge(),{memory:Xe,_free:G,_malloc:Y,Mesh:class{constructor(){this.ptr=J()}destroy(){se(this.ptr)}},Decoder:class{constructor(){this.ptr=ue()}destroy(){ke(this.ptr)}DecodeArrayToMesh(Ct,bt,an){const qt=Dt(Ct),$t=he(this.ptr,qt,bt,an.ptr);return!!pe($t)}GetAttributeByUniqueId(Ct,bt){return{ptr:Le(this.ptr,Ct.ptr,bt)}}GetTrianglesUInt16Array(Ct,bt,an){ce(this.ptr,Ct.ptr,bt,an)}GetTrianglesUInt32Array(Ct,bt,an){Me(this.ptr,Ct.ptr,bt,an)}GetAttributeDataArrayForAllPoints(Ct,bt,an,qt,$t){Fe(this.ptr,Ct.ptr,bt.ptr,an,qt,$t)}},DT_INT8:Ye(),DT_UINT8:Ze(),DT_INT16:ut(),DT_UINT16:Et(),DT_UINT32:ot(),DT_FLOAT32:jt()}})}(fetch(hv())),Kd.then(E=>{ru=E,Kd=void 0}))}()),M&&y.push(function(){if(sg)return;const E=function(C){let L;const k=WebAssembly.instantiateStreaming(C,{}).then(Z=>{L=Z.instance,L.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},j={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:k,supported:!0,decodeGltfBuffer(Z,G,Y,J,se,pe){(function(ue,he,Le,ce,Me,Fe,ke){const Ge=ue.exports.sbrk,Xe=ce+3&-4,Ye=Ge(Xe*Me),Ze=Ge(Fe.length),ut=new Uint8Array(ue.exports.memory.buffer);ut.set(Fe,Ze);const Et=he(Ye,ce,Me,Ze,Fe.length);if(Et===0&&ke&&ke(Ye,Xe,Me),Le.set(ut.subarray(Ye,Ye+ce*Me)),Ge(Ye-Ge(0)),Et!==0)throw new Error(`Malformed buffer data: ${Et}`)})(L,L.exports[j[se]],Z,G,Y,J,L.exports[V[pe]])}}}(fetch(dv()));return E.ready.then(()=>{sg=E})}()),h)for(let E=0;E<h.length;E++)y.push(dE(h[E],c,E,s));return(y.length?Promise.all(y):Promise.resolve()).then(()=>{if(I&&m)for(const{primitives:E}of m)for(const C of E)uE(C,c);if(M&&m&&T)for(const E of T)cE(E,c);return c})})}function wh(l,t){const s=l.json.bufferViews[t.bufferView],c=xp[t.componentType];return new c(l.buffers[s.buffer],(t.byteOffset||0)+(s.byteOffset||0),t.count*(s.byteStride&&s.byteStride!==Qd[t.type]*c.BYTES_PER_ELEMENT?s.byteStride/c.BYTES_PER_ELEMENT:Qd[t.type]))}function ag(l,t,s,c){const p=xp[t.componentType],h=function(y){switch(y){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),m=l.json.bufferViews[t.bufferView],x=m.byteStride?m.byteStride/p.BYTES_PER_ELEMENT:Qd[t.type],T=s.float32,A=T.length/s.capacity;for(let y=0,I=0;y<t.count*x;y+=x,I+=A)for(let M=0;M<A;M++)T[I+M]=c[y+M]*h;s._trim()}function fE(l,t,s){const c=l.indices,p=l.attributes,h={};h.indexArray=new O;const m=t.json.accessors[c],x=m.count/3;h.indexArray.reserve(x);const T=wh(t,m);for(let M=0;M<x;M++)h.indexArray.emplaceBack(T[3*M],T[3*M+1],T[3*M+2]);h.indexArray._trim(),h.vertexArray=new gl;const A=t.json.accessors[p.POSITION];h.vertexArray.reserve(A.count);const y=wh(t,A);for(let M=0;M<A.count;M++)h.vertexArray.emplaceBack(y[3*M],y[3*M+1],y[3*M+2]);if(h.vertexArray._trim(),h.aabb=new _i(A.min,A.max),h.centroid=function(M,E){const C=[0,0,0],L=M.length;if(L>0){for(let k=0;k<L;k++){const V=3*M[k];C[0]+=E[V],C[1]+=E[V+1],C[2]+=E[V+2]}C[0]/=L,C[1]/=L,C[2]/=L}return C}(T,y),p.COLOR_0!==void 0){const M=t.json.accessors[p.COLOR_0],E=Qd[M.type],C=wh(t,M);h.colorArray=E===3?new gl:new za,h.colorArray.resize(M.count),ag(t,M,h.colorArray,C)}if(p.NORMAL!==void 0){h.normalArray=new gl;const M=t.json.accessors[p.NORMAL];h.normalArray.resize(M.count);const E=wh(t,M);ag(t,M,h.normalArray,E)}if(p.TEXCOORD_0!==void 0&&s.length>0){h.texcoordArray=new Pn;const M=t.json.accessors[p.TEXCOORD_0];h.texcoordArray.resize(M.count);const E=wh(t,M);ag(t,M,h.texcoordArray,E)}if(p._FEATURE_ID_RGBA4444!==void 0){const M=t.json.accessors[p._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=wh(t,M))}p._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(wh(t,t.json.accessors[p._FEATURE_RGBA4444]).buffer));const I=l.material;return h.material=function(M,E){const{emissiveFactor:C=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:k=.5,normalTexture:V,occlusionTexture:j,emissiveTexture:Z,doubleSided:G}=M,{baseColorFactor:Y=[1,1,1,1],metallicFactor:J=1,roughnessFactor:se=1,baseColorTexture:pe,metallicRoughnessTexture:ue}=M.pbrMetallicRoughness||{},he=j?E[j.index]:void 0;if(j&&j.extensions&&j.extensions.KHR_texture_transform&&he){const Le=j.extensions.KHR_texture_transform;he.offsetScale=[Le.offset[0],Le.offset[1],Le.scale[0],Le.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ai(...Y),metallicFactor:J,roughnessFactor:se,baseColorTexture:pe?E[pe.index]:void 0,metallicRoughnessTexture:ue?E[ue.index]:void 0},doubleSided:G,emissiveFactor:C,alphaMode:L,alphaCutoff:k,normalTexture:V?E[V.index]:void 0,occlusionTexture:he,emissionTexture:Z?E[Z.index]:void 0,defined:M.defined===void 0}}(I!==void 0?t.json.materials[I]:{defined:!1},s),h}function vv(l,t,s){const{matrix:c,rotation:p,translation:h,scale:m,mesh:x,extras:T,children:A}=l,y={};if(y.matrix=c||Ve.mat4.fromRotationTranslationScale([],p||[0,0,0,1],h||[0,0,0],m||[1,1,1]),x!==void 0){y.meshes=s[x];const I=y.anchor=[0,0];for(const M of y.meshes){const{min:E,max:C}=M.aabb;I[0]+=E[0]+C[0],I[1]+=E[1]+C[1]}I[0]=Math.floor(I[0]/y.meshes.length/2),I[1]=Math.floor(I[1]/y.meshes.length/2)}if(T&&(T.id&&(y.id=T.id),T.lights&&(y.lights=function(I){if(!I.length)return[];const M=function(V){const j=atob(V),Z=new Uint8Array(j.length);for(let G=0;G<j.length;G++)Z[G]=j.codePointAt(G);return Z}(I),E=[],C=M.length/24,L=new Uint16Array(M.buffer),k=new Float32Array(M.buffer);for(let V=0;V<C;V++){const j=L[2*V*6]/30,Z=L[2*V*6+1]/30,G=L[2*V*6+10]/100,Y=k[6*V+1],J=k[6*V+2],se=k[6*V+3],pe=k[6*V+4],ue=se-Y,he=pe-J,Le=Math.hypot(ue,he);E.push({pos:[Y+.5*ue,J+.5*he,Z],normal:[he/Le,-ue/Le,0],width:Le,height:j,depth:G,points:[Y,J,se,pe]})}return E}(T.lights))),A){const I=[];for(const M of A)I.push(vv(t.json.nodes[M],t,s));y.children=I}return y}function pE(l){if(l.vertices.length===0||l.indices.length===0)return null;const t=new mm(l.vertices,l.indices,8,256),[s,c]=[t.min.clone(),t.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:t,min:s,max:c}}function mE(l){if(!l.extras||!l.extras.ground)return null;const t=l.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const s=t[0];if(!s||!Array.isArray(s)||s.length===0)return null;const c=[];for(const m of s){if(!Array.isArray(m)||m.length!==2)continue;const x=m[0],T=m[1];typeof x=="number"&&typeof T=="number"&&c.push(new Lt(x,T))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let p=0;for(let m=0;m<c.length;m++){const x=c[m],T=c[(m+1)%c.length],A=c[(m+2)%c.length];p+=(x.x-T.x)*(A.y-T.y)-(A.x-T.x)*(x.y-T.y)}p>0&&c.reverse();const h=Id(c.flatMap(m=>[m.x,m.y]),[]);return h.length===0?null:{vertices:c,indices:h}}function gE(l,t){const s=[],c=[];let p=0;const h=[];for(const m of l){p=s.length;const x=m.vertexArray.float32,T=m.indexArray.uint16;for(let A=0;A<m.vertexArray.length;A++)h[0]=x[3*A+0],h[1]=x[3*A+1],h[2]=x[3*A+2],Ve.vec3.transformMat4(h,h,t),s.push(new Lt(h[0],h[1]));for(let A=0;A<3*m.indexArray.length;A++)c.push(T[A]+p)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const x=s[c[m+0]],T=s[c[m+1]],A=s[c[m+2]];(x.x-T.x)*(A.y-T.y)-(A.x-T.x)*(x.y-T.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:s,indices:c}}function xv(l){const t=function(T,A){const y=[],I=WebGL2RenderingContext;if(T.json.textures)for(const M of T.json.textures){const E={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};M.sampler!==void 0&&Object.assign(E,T.json.samplers[M.sampler]),y.push({image:A[M.source],sampler:E,uploaded:!1})}return y}(l,l.images),s=function(T,A){const y=[];for(const I of T.json.meshes){const M=[];for(const E of I.primitives)M.push(fE(E,T,A));y.push(M)}return y}(l,t),{scenes:c,scene:p,nodes:h}=l.json,m=c?c[p||0].nodes:h,x=[];for(const T of m)x.push(vv(h[T],l,s));return function(T,A,y){const I={},M=new Set;for(let E=0;E<T.length;E++){const C=y[A[E]];if(!C.extras)continue;const L=C.extras["mapbox:footprint:version"],k=C.extras["mapbox:footprint:id"];(L||k)&&M.add(E),L==="1.0.0"&&k&&(I[k]=E)}for(let E=0;E<T.length;E++){if(M.has(E))continue;const C=T[E],L=y[A[E]];if(!L.extras)continue;let k=null;C.id in I&&(k=gE(T[I[C.id]].meshes,C.matrix)),k||(k=mE(L)),k&&(C.footprint=pE(k))}if(M.size>0){const E=Array.from(M.values()).sort((C,L)=>C-L);for(let C=E.length-1;C>=0;C--)T.splice(E[C],1)}}(x,m,l.json.nodes),x}function _E(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const t=l.vertexArray.float32,s=l.aabb.min[0]-1,c=l.aabb.min[1]-1,p=xh/(l.aabb.max[0]-s+2),h=xh/(l.aabb.max[1]-c+2);for(let m=0;m<t.length;m+=3){const x=t[m+2],T=(t[m+0]-s)*p|0,A=(t[m+1]-c)*h|0;x>l.heightmap[A*xh+T]&&(l.heightmap[A*xh+T]=x)}}function yE(l,t){const s={};s.indexArray=new O,s.indexArray.reserve(4*l.length),s.vertexArray=new gl,s.vertexArray.reserve(10*l.length),s.colorArray=new za,s.vertexArray.reserve(10*l.length);let c=0;for(const m of l){const x=Math.min(10,Math.max(4,1.3*m.height))*t,T=[-m.normal[1],m.normal[0],0],A=Math.min(.29,.1*m.width/m.depth),y=m.width-2*m.depth*t*(A+.01),I=Ve.vec3.scaleAndAdd([],m.pos,T,y/2),M=Ve.vec3.scaleAndAdd([],m.pos,T,-y/2),E=[I[0],I[1],I[2]+m.height],C=[M[0],M[1],M[2]+m.height],L=Ve.vec3.scaleAndAdd([],m.normal,T,A);Ve.vec3.scale(L,L,x);const k=Ve.vec3.scaleAndAdd([],m.normal,T,-A);Ve.vec3.scale(k,k,x),Ve.vec3.add(L,I,L),Ve.vec3.add(k,M,k),I[2]+=.1,M[2]+=.1,s.vertexArray.emplaceBack(L[0],L[1],L[2]),s.vertexArray.emplaceBack(k[0],k[1],k[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(E[0],E[1],E[2]),s.vertexArray.emplaceBack(C[0],C[1],C[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(L[0],L[1],L[2]),s.vertexArray.emplaceBack(k[0],k[1],k[2]);const V=y/x/2;s.colorArray.emplaceBack(-V-A,-1,V,.8),s.colorArray.emplaceBack(V+A,-1,V,.8),s.colorArray.emplaceBack(-V,0,V,1.3),s.colorArray.emplaceBack(V,0,V,1.3),s.colorArray.emplaceBack(V+A,-.8,V,.7),s.colorArray.emplaceBack(V+A,-.8,V,.7),s.colorArray.emplaceBack(0,0,V,1.3),s.colorArray.emplaceBack(0,0,V,1.3),s.colorArray.emplaceBack(V+A,-1.2,V,.8),s.colorArray.emplaceBack(V+A,-1.2,V,.8),s.indexArray.emplaceBack(6+c,4+c,8+c),s.indexArray.emplaceBack(7+c,9+c,5+c),s.indexArray.emplaceBack(0+c,1+c,2+c),s.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const p={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=ai.white,p.pbrMetallicRoughness=h,s.material=p,s.aabb=new _i([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}class bv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class wv{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Xr(Mt,16,0),this.featureIndexArray=new Cf,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,s,c,p,h,m=0,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,h,m);const A=this.grid;for(let y=0;y<s.length;y++){const I=s[y],M=[1/0,1/0,-1/0,-1/0];for(let E=0;E<I.length;E++){const C=I[E];M[0]=Math.min(M[0],C.x),M[1]=Math.min(M[1],C.y),M[2]=Math.max(M[2],C.x),M[3]=Math.max(M[3],C.y)}x!==0&&(M[0]-=x,M[1]-=x,M[2]+=x,M[3]+=x),M[0]<Mt&&M[1]<Mt&&M[2]>=0&&M[3]>=0&&A.insert(T,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Uh.VectorTile(new Yf(this.rawTileData)).layers,this.sourceLayerCoder=new bv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s,c){this.loadVTLayers(),this.serializedLayersCache.clear();const p=Fo(t.filter),h=t.tileResult,m=t.transform,x=h.bufferedTilespaceBounds,T=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(M,E,C,L)=>Di(h.bufferedTilespaceGeometry,M,E,C,L));T.sort(vE);let A=null;m.elevation&&T.length>0&&(A=$h.create(m.elevation,this.tileID));const y={};let I;for(let M=0;M<T.length;M++){const E=T[M];if(E===I)continue;I=E;const C=this.featureIndexArray.get(E);let L=null;if(this.is3DTile){const k=this.bucketLayerIDs[0][0],V=s[k];if(V.type!=="model")continue;const{queryFeature:j,intersectionZ:Z}=V.queryIntersectsMatchingFeature(h,C.featureIndex,p,m);j&&this.appendToResult(y,k,C.featureIndex,j,Z)}else this.loadMatchingFeature(y,C,p,t.layers,t.availableImages,s,c,(k,V,j,Z=0)=>(L||(L=He(k,this.tileID.canonical,t.tileTransform)),V.queryIntersectsFeature(h,k,j,L,this.z,t.transform,t.pixelPosMatrix,A,Z)))}return y}loadMatchingFeature(t,s,c,p,h,m,x,T){const{featureIndex:A,bucketIndex:y,sourceLayerIndex:I,layoutVertexArrayOffset:M}=s,E=this.bucketLayerIDs[y];if(p.length&&!function(V,j){for(let Z=0;Z<V.length;Z++)if(j.indexOf(V[Z])>=0)return!0;return!1}(p,E))return;const C=this.sourceLayerCoder.decode(I),L=this.vtLayers[C].feature(A);if(c.needGeometry){const V=gt(L,!0);if(!c.filter(new Ui(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!c.filter(new Ui(this.tileID.overscaledZ),L))return;const k=this.getId(L,C);for(let V=0;V<E.length;V++){const j=E[V];if(p.length&&p.indexOf(j)<0)continue;const Z=m[j];if(!Z)continue;let G={};k!==void 0&&x&&(G=x.getState(Z.sourceLayer||"_geojsonTileLayer",k));const Y=!T||T(L,Z,G,M);if(!Y)continue;const J=new Hd(L,this.z,this.x,this.y,k);let se=this.serializedLayersCache.get(j);se||(se=Z.serialize(),se.id=j,this.serializedLayersCache.set(j,se)),J.layer=ir({},se),J.tile=this.tileID.canonical,J.layer.paint=Ev(se.paint,Z.paint,L,G,h),J.layer.layout=Ev(se.layout,Z.layout,L,G,h),this.appendToResult(t,j,A,J,Y)}}appendToResult(t,s,c,p,h){let m=t[s];m===void 0&&(m=t[s]=[]),m.push({featureIndex:c,feature:p,intersectionZ:h})}lookupSymbolFeatures(t,s,c,p,h,m,x){const T={};this.loadVTLayers();const A=Fo(p);for(const y of t)this.loadMatchingFeature(T,{bucketIndex:s,sourceLayerIndex:c,featureIndex:y,layoutVertexArrayOffset:0},A,h,m,x);return T}loadFeature(t){const{featureIndex:s,sourceLayerIndex:c}=t;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),h=this.vtFeatures[p];if(h[s])return h[s];const m=this.vtLayers[p].feature(s);return h[s]=m,m}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];p!=null&&(c=t.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function Ev(l,t,s,c,p){return Ms(l,(h,m)=>{const x=t instanceof Na?t.get(m):null;return x&&x.evaluate?x.evaluate(s,c,p):x})}function vE(l,t){return t-l}Gt(wv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Iv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class lg{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const h=Iv[15&c];if(!h)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new lg(x,m,h,t)}constructor(t,s=64,c=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=Iv.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=s,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return ug(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:x}=this,T=[0,h.length-1,0],A=[];for(;T.length;){const y=T.pop()||0,I=T.pop()||0,M=T.pop()||0;if(I-M<=x){for(let k=M;k<=I;k++){const V=m[2*k],j=m[2*k+1];V>=t&&V<=c&&j>=s&&j<=p&&A.push(h[k])}continue}const E=M+I>>1,C=m[2*E],L=m[2*E+1];C>=t&&C<=c&&L>=s&&L<=p&&A.push(h[E]),(y===0?t<=C:s<=L)&&(T.push(M),T.push(E-1),T.push(1-y)),(y===0?c>=C:p>=L)&&(T.push(E+1),T.push(I),T.push(1-y))}return A}within(t,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:h,nodeSize:m}=this,x=[0,p.length-1,0],T=[],A=c*c;for(;x.length;){const y=x.pop()||0,I=x.pop()||0,M=x.pop()||0;if(I-M<=m){for(let k=M;k<=I;k++)Sv(h[2*k],h[2*k+1],t,s)<=A&&T.push(p[k]);continue}const E=M+I>>1,C=h[2*E],L=h[2*E+1];Sv(C,L,t,s)<=A&&T.push(p[E]),(y===0?t-c<=C:s-c<=L)&&(x.push(M),x.push(E-1),x.push(1-y)),(y===0?t+c>=C:s+c>=L)&&(x.push(E+1),x.push(I),x.push(1-y))}return T}}function ug(l,t,s,c,p,h){if(p-c<=s)return;const m=c+p>>1;Tv(l,t,m,c,p,h),ug(l,t,s,c,m-1,1-h),ug(l,t,s,m+1,p,1-h)}function Tv(l,t,s,c,p,h){for(;p>c;){if(p-c>600){const A=p-c+1,y=s-c+1,I=Math.log(A),M=.5*Math.exp(2*I/3),E=.5*Math.sqrt(I*M*(A-M)/A)*(y-A/2<0?-1:1);Tv(l,t,s,Math.max(c,Math.floor(s-y*M/A+E)),Math.min(p,Math.floor(s+(A-y)*M/A+E)),h)}const m=t[2*s+h];let x=c,T=p;for(ef(l,t,c,s),t[2*p+h]>m&&ef(l,t,c,p);x<T;){for(ef(l,t,x,T),x++,T--;t[2*x+h]<m;)x++;for(;t[2*T+h]>m;)T--}t[2*c+h]===m?ef(l,t,c,T):(T++,ef(l,t,T,p)),T<=s&&(c=T+1),s<=T&&(p=T-1)}}function ef(l,t,s,c){cg(l,s,c),cg(t,2*s,2*c),cg(t,2*s+1,2*c+1)}function cg(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}function Sv(l,t,s,c){const p=l-s,h=t-c;return p*p+h*h}a.$=dc,a.A=class extends mp{},a.B=Mo,a.C=ya,a.D=Zl,a.E=lo,a.F=ci,a.G=ea,a.H=Su,a.I=Dm,a.J=yo,a.K=ra,a.L=ia,a.M=Oo,a.N=Qa,a.O=Sa,a.P=Lt,a.Q=vu,a.R=Er,a.S=zr,a.T=Hm,a.U=Al,a.V=mp,a.W=xo,a.X=Ss,a.Y=rc,a.Z=function(l){const t=l.value;let s=[];if(!t)return s;const c=Mo(t);return c!=="string"?(s=s.concat([new mp(l.key,t,`string expected, "${c}" found`)]),s):(F0(t,!0)||(s=s.concat([new mp(l.key,t,`invalid url "${t}"`)])),s)},a._=$e,a.a=function(l){return ge.API_CDN_URL_REGEX.test(l)},a.a$=ml,a.a0=Ei,a.a1=It,a.a2=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return Ws(l.expression.evaluate(t))}interpolate(l,t,s){return{x:ln(l.x,t.x,s),y:ln(l.y,t.y,s),z:ln(l.z,t.z,s),azimuthal:ln(l.azimuthal,t.azimuthal,s),polar:ln(l.polar,t.polar,s)}}},a.a3=Ui,a.a4=ql,a.a5=Be,a.a6=Ve,a.a7=fa,a.a8=Na,a.a9=jc,a.aA=$n,a.aB=I0,a.aC=P0,a.aD=E0,a.aE=function(l,t){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let c=0;c<l.length;c++){const p=document.createElement("source");zt(l[c])||(s.crossOrigin="Anonymous"),p.src=l[c],s.appendChild(p)}return{cancel:()=>{}}},a.aF=cp,a.aG=function(l){return fetch(l).then(t=>t.arrayBuffer()).then(t=>yv(t,0,l))},a.aH=xv,a.aI=class{constructor(l,t,s,c){this.id=l,this.position=t!=null?new F(t[0],t[1]):new F(0,0),this.orientation=s??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new _i([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,t){if(Ve.mat4.multiply(l.matrix,t,l.matrix),l.meshes)for(const s of l.meshes){const c=_i.applyTransformFast(s.aabb,l.matrix);this.aabb.encapsulate(c)}if(l.children)for(const s of l.children)this._applyTransformations(s,l.matrix)}computeBoundsAndApplyParent(){const l=Ve.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,l)}computeModelMatrix(l,t,s,c,p,h,m=!1){G0(this.matrix,this,l.transform,this.position,t,s,c,p,h,m)}upload(l){if(!this.uploaded){for(const t of this.nodes)Ym(t,l);for(const t of this.nodes)gp(t);this.uploaded=!0}}destroy(){for(const l of this.nodes)Jm(l)}},a.aJ=jn,a.aK=function(l){return l.indexOf(fc)>=0},a.aL=kd,a.aM=ae,a.aN=de,a.aO=Ou,a.aP=O,a.aQ=Fs,a.aR=$l,a.aS=lp,a.aT=function(){nr.isLoading()||nr.isLoaded()||dl()!=="deferred"||jl()},a.aU=Fo,a.aV=gt,a.aW=Hd,a.aX=Yi,a.aY=Im,a.aZ=pm,a.a_=He,a.aa=ln,a.ab=Mt,a.ac=Pl,a.ad=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return function([s,c]){const p=Ws([1,s,c]);return{x:p.x,y:p.y,z:p.z}}(l.expression.evaluate(t))}interpolate(l,t,s){return{x:ln(l.x,t.x,s),y:ln(l.y,t.y,s),z:ln(l.z,t.z,s)}}},a.ae=function(l,t,s=0,c=!0){const p=new Lt(s,s),h=l.sub(p),m=t.add(p),x=[h,new Lt(m.x,h.y),m,new Lt(h.x,m.y)];return c&&x.push(h.clone()),x},a.af=function(l,t){const s=[];for(let c=0;c<l.length;c++){const p=jo(c-1,-1,l.length-1),h=jo(c+1,-1,l.length-1),m=l[c],x=l[h],T=l[p].sub(m).unit(),A=x.sub(m).unit(),y=A.angleWithSep(T.x,T.y),I=T.add(A).unit().mult(-1*t/Math.sin(y/2));s.push(m.add(I))}return s},a.ag=u0,a.ah=Di,a.ai=function(l,t,s=0){return Ve.vec3.fromValues(((t.x-s)*l.scale-l.x)*Mt,(t.y*l.scale-l.y)*Mt,fe(t.z,t.y))},a.aj=wo,a.ak=My,a.al=function(l){let t=1/0,s=1/0,c=-1/0,p=-1/0;for(const h of l)t=Math.min(t,h.x),s=Math.min(s,h.y),c=Math.max(c,h.x),p=Math.max(p,h.y);return{min:new Lt(t,s),max:new Lt(c,p)}},a.am=K,a.an=Hn,a.ao=De,a.ap=nn,a.aq=Os,a.ar=function(l,t){const s={};for(let c=0;c<t.length;c++){const p=t[c];p in l&&(s[p]=l[p])}return s},a.as=U,a.at=re,a.au=class{constructor(l){this.entries={},this.scheduler=l}request(l,t,s,c){const p=this.entries[l]=this.entries[l]||{callbacks:[]};if(p.result){const[h,m]=p.result;return this.scheduler?this.scheduler.add(()=>{c(h,m)},t):c(h,m),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=s((h,m)=>{p.result=[h,m];for(const x of p.callbacks)this.scheduler?this.scheduler.add(()=>{x(h,m)},t):x(h,m);setTimeout(()=>delete this.entries[l],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(h=>h!==c),p.callbacks.length||(p.cancel(),delete this.entries[l]))}}},a.av=Fc,a.aw=function(l,t,s){const c=JSON.stringify(l.request);return l.data&&(this.deduped.entries[c]={result:[null,l.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{const h=oo(l.request,(m,x,T,A)=>{m?p(m):x&&p(null,{vectorTile:s?void 0:new Uh.VectorTile(new Yf(x)),rawData:x,cacheControl:T,expires:A})});return()=>{h.cancel(),p()}},t)},a.ax=function(l){vr++,vr>vn&&(l.getActor().send("enforceCacheSizeLimit",In),vr=0)},a.ay=Tt,a.az=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},a.b=function(l){return ge.API_FONTS_REGEX.test(l)},a.b$=Eo,a.b0=Tn,a.b1=xl,a.b2=lr,a.b3=Id,a.b4=Gm,a.b5=function(l,t){const s=jc(t.zoom);if(s===0)return zu(l);const c=zf(l),p=sm(c),h=K(c.getWest())*t.worldSize,m=K(c.getEast())*t.worldSize,x=re(c.getNorth())*t.worldSize,T=re(c.getSouth())*t.worldSize,A=[h,x,0],y=[m,x,0],I=[h,T,0],M=[m,T,0],E=Ve.mat4.invert([],t.globeMatrix);return Ve.vec3.transformMat4(A,A,E),Ve.vec3.transformMat4(y,y,E),Ve.vec3.transformMat4(I,I,E),Ve.vec3.transformMat4(M,M,E),p[0]=yc(p[0],I,s),p[1]=yc(p[1],M,s),p[2]=yc(p[2],y,s),p[3]=yc(p[3],A,s),_i.fromPoints(p)},a.b6=kf,a.b7=wd,a.b8=yc,a.b9=kc,a.bA=ai,a.bB=jo,a.bC=pn,a.bD=pa,a.bE=ie,a.bF=function(l,t,s){l[4*t+0]=s[0],l[4*t+1]=s[1],l[4*t+2]=s[2],l[4*t+3]=s[3]},a.bG=mh,a.bH=yl,a.bI=_d,a.bJ=Yr,a.bK=_c,a.bL=F,a.bM=p0,a.bN=Kn,a.bO=ua,a.bP=R0,a.bQ=Jr,a.bR=y_,a.bS=function(l,t,s,c,p,h,m,x,T){if(T.name==="globe")return y_(l,t,new Jr(s,c,p),!1);const A=kd({z:s,x:c,y:p},T);return new _i([(h+A.x/A.scale)*t,t*(A.y/A.scale),m],[(h+A.x2/A.scale)*t,t*(A.y2/A.scale),x])},a.bT=function(l,t,s){let c=0;for(let p=0;p<2;++p)l[p]>0&&(c+=(l[p]-0)*(l[p]-0)),t[p]<0&&(c+=(0-t[p])*(0-t[p]));return c},a.bU=be,a.bV=d,a.bW=function(l){const t=Ve.mat4.identity(new Float64Array(16));Ve.mat4.multiply(t,l.pixelMatrix,l.globeMatrix);const s=[0,_,0],c=[0,v,0];return Ve.vec3.transformMat4(s,s,t),Ve.vec3.transformMat4(c,c,t),[s[0]>0&&s[0]<=l.width&&s[1]>0&&s[1]<=l.height&&!lm(l,new F(l.center.lat,90)),c[0]>0&&c[0]<=l.width&&c[1]>0&&c[1]<=l.height&&!lm(l,new F(l.center.lat,-90))]},a.bX=function(l,t){const{scale:s}=l.tileTransform,c=s*Mt/(l.tileSize*Math.pow(2,t.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return Ve.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},a.bY=fp,a.bZ=L0,a.b_=function(l){const t=L0(l,!0);return Ve.mat2.invert([],[t[0],t[1],t[4],t[5]])},a.ba=as,a.bb=ng,a.bc=Yf,a.bd=oo,a.be=function(l){const t=[];for(const s in l)t.push(l[s]);return t},a.bf=function(l,t){const s=[];for(const c in l)c in t||s.push(c);return s},a.bg=dr,a.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bi=Zs,a.bj=function(l,t){const{x:s,y:c}=l.point,p=b_(s,c,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Ve.mat4.multiply(p,p,om(zu(t)))},a.bk=Gh,a.bl=Va,a.bm=Xf,a.bn=function(l,t,s,c,p){const h=5*t+2;l.float32[h+0]=s,l.float32[h+1]=c,l.float32[h+2]=p},a.bo=ap,a.bp=Ky,a.bq=mt,a.br=Ns,a.bs=ey,a.bt=z0,a.bu=sy,a.bv=oy,a.bw=zm,a.bx=s0,a.by=Rm,a.bz=lg,a.c=Ce,a.c$=Ni,a.c0=function(l){const{x:t,y:s}=l.point,{lng:c,lat:p}=l._center;return b_(t,s,l.worldSize,c,p)},a.c1=Lr,a.c2=fi,a.c3=Nf,a.c4=function(l){const t=Math.round((l+45+360)%360/90)%4;return si[t]},a.c5=45,a.c6=ee,a.c7=kh,a.c8=function(l,t,s){const c=Math.sqrt(l*l+t*t+s*s),p=c>0?Math.acos(s/c)*io:0;let h=l!==0||t!==0?Math.atan2(-t,-l)*io+90:0;return h<0&&(h+=360),[c,h,p]},a.c9=Re,a.cA=function(l){const t=be-5;l=nn(l,-t,t)/t*90;const s=Math.pow(Math.abs(Math.sin(pn(l))),3);return Math.round(s*(f.length-1))},a.cB=function(l,t,s,c){const p=t.getNorth(),h=t.getSouth(),m=t.getWest(),x=t.getEast(),T=1<<l.z,A=x-m,y=p-h,I=A/o,M=-y/f[s],E=[0,I,0,M,0,0,p,m,0];if(l.z>0){const C=180/c;Ve.mat3.multiply(E,E,[C/A+1,0,0,0,C/y+1,0,-.5*C/I,.5*C/M,1])}return E[2]=T,E[5]=l.x,E[8]=l.y,E},a.cC=zu,a.cD=function(l,t,s){const c=Ve.mat4.identity(new Float64Array(16)),p=(t/(1<<l)-.5)*Math.PI*2;return Ve.mat4.rotateY(c,s.globeMatrix,p),Float32Array.from(c)},a.cE=class{isDataAvailableAtPoint(l){const t=this._source();if(this.isUsingMockSource()||!t||l.y<0||l.y>1)return!1;const s=t.getSource().maxzoom,c=1<<s,p=Math.floor(l.x),h=Math.floor((l.x-p)*c),m=Math.floor(l.y*c),x=this.findDEMTileFor(new $n(s,p,s,h,m));return!(!x||!x.dem)}getAtPointOrZero(l,t=0){return this.getAtPoint(l,t)||0}getAtPoint(l,t,s=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||l.y<0||l.y>1)return t;const p=c.getSource().maxzoom,h=1<<p,m=Math.floor(l.x),x=l.x-m,T=new $n(p,m,p,Math.floor(x*h),Math.floor(l.y*h)),A=this.findDEMTileFor(T);if(!A||!A.dem)return t;const y=A.dem,I=1<<A.tileID.canonical.z,M=(x*I-A.tileID.canonical.x)*y.dim,E=(l.y*I-A.tileID.canonical.y)*y.dim,C=Math.floor(M),L=Math.floor(E);return(s?this.exaggeration():1)*ln(ln(y.get(C,L),y.get(C,L+1),E-L),ln(y.get(C+1,L),y.get(C+1,L+1),E-L),M-C)}getAtTileOffset(l,t,s){const c=1<<l.canonical.z;return this.getAtPointOrZero(new Be(l.wrap+(l.canonical.x+t/Mt)/c,(l.canonical.y+s/Mt)/c))}getAtTileOffsetFunc(l,t,s,c){return p=>{const h=this.getAtTileOffset(l,p.x,p.y),m=c.upVector(l.canonical,p.x,p.y),x=c.upVectorScale(l.canonical,t,s).metersToTile;return Ve.vec3.scale(m,m,h*x),m}}getForTilePoints(l,t,s,c){if(this.isUsingMockSource())return!1;const p=$h.create(this,l,c);return!!p&&(t.forEach(h=>{h[2]=this.exaggeration()*p.getElevationAt(h[0],h[1],s)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(l);if(!t||!t.dem)return null;const s=t.dem.tree,c=t.tileID,p=1<<l.canonical.z-c.canonical.z;let h=l.canonical.x/p-c.canonical.x,m=l.canonical.y/p-c.canonical.y,x=0;for(let T=0;T<l.canonical.z-c.canonical.z&&!s.leaves[x];T++){h*=2,m*=2;const A=2*Math.floor(m)+Math.floor(h);x=s.childOffsets[x]+A,h%=1,m%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let t=!1,s=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const p of l){const h=this.getMinMaxForTile(p.tileID);h&&(s=Math.min(s,h.min),c=Math.max(c,h.max),t=!0)}return t?{min:s,max:c}:null}},a.cF=O_,a.cG=Gc,a.cH=function(l,t){return[Math.pow(l[0],2.2)*t,Math.pow(l[1],2.2)*t,Math.pow(l[2],2.2)*t]},a.cI=x_,a.cJ=oe,a.cK=ne,a.cL=256,a.cM=function(l,t){const s=[0,0,0],c=kf(zu(t.canonical));return Ve.vec3.transformMat4(s,s,c),Ve.vec3.transformMat4(s,s,l),s},a.cN=l=>({u_camera_to_center_distance:new Yr(l),u_extrude_scale:new Bh(l),u_device_pixel_ratio:new Yr(l),u_matrix:new mh(l),u_inv_rot_matrix:new mh(l),u_merc_center:new yl(l),u_tile_id:new _d(l),u_zoom_transition:new Yr(l),u_up_dir:new _d(l),u_emissive_strength:new Yr(l)}),a.cO=l=>({u_matrix:new mh(l),u_pixels_to_tile_units:new Bh(l),u_device_pixel_ratio:new Yr(l),u_units_to_pixels:new yl(l),u_dash_image:new _c(l),u_gradient_image:new _c(l),u_image_height:new Yr(l),u_texsize:new yl(l),u_tile_units_to_pixels:new Yr(l),u_alpha_discard_threshold:new Yr(l),u_trim_offset:new yl(l),u_trim_fade_range:new yl(l),u_trim_color:new kh(l),u_emissive_strength:new Yr(l),u_zbias_factor:new Yr(l),u_tile_to_meter:new Yr(l)}),a.cP=l=>({u_matrix:new mh(l),u_texsize:new yl(l),u_pixels_to_tile_units:new Bh(l),u_device_pixel_ratio:new Yr(l),u_image:new _c(l),u_units_to_pixels:new yl(l),u_tile_units_to_pixels:new Yr(l),u_alpha_discard_threshold:new Yr(l),u_trim_offset:new yl(l),u_emissive_strength:new Yr(l),u_zbias_factor:new Yr(l),u_tile_to_meter:new Yr(l)}),a.cQ=g,a.cR=Ub,a.cS=Gb,a.cT=I_,a.cU=(l,t,s,c,p,h)=>{const m=l.transform,x=m.projection.name==="globe";let T;if(h.paint.get("circle-pitch-alignment")==="map")if(x){const y=x_(m.zoom,t.canonical)*m._pixelsPerMercatorPixel;T=Float32Array.from([y,0,0,y])}else T=m.calculatePixelsToTileUnitsMatrix(s);else T=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(m.projection),u_matrix:l.translatePosMatrix(t.projMatrix,s,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Vt.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:H1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(x){A.u_inv_rot_matrix=c,A.u_merc_center=p,A.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],A.u_zoom_transition=jc(m.zoom);const y=p[0]*Mt,I=p[1]*Mt;A.u_up_dir=m.projection.upVector(new Jr(0,0,0),y,I)}return A},a.cV=Ry,a.cW=(l,t,s,c,p,h)=>{const m=l.transform,x=m.pitch<15?Ay(.07,.7,nn((14-m.zoom)/5,0,1)):.07;return{u_matrix:Ly(l,t,s,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:Py(t,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:x,u_tile_to_meter:Re(t.tileID.canonical,0)}},a.cX=(l,t,s,c,p,h,m)=>{const x=l.transform,T=x.calculatePixelsToTileUnitsMatrix(t),A=x.pitch<15?Ay(.07,.7,nn((14-x.zoom)/5,0,1)):.07;return{u_matrix:Ly(l,t,s,c),u_pixels_to_tile_units:T,u_device_pixel_ratio:h,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:Dy(s)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Py(t,l.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:Re(t.tileID.canonical,0)}},a.cY=So,a.cZ=Ed,a.c_=vy,a.ca=_i,a.cb=Ws,a.cc=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},a.cd=function(l){return l({pluginStatus:ar,pluginURL:pi}),Lu.on("pluginStateChange",l),l},a.ce=Xh,a.cf=vp,a.cg=jh,a.ch=Om,a.ci=pr,a.cj=Pu,a.ck=yn,a.cl=ns,a.cm=ro,a.cn=function(l){const t=l.indexOf(fc);return t>=0?l.slice(0,t):l},a.co=function(l){const t=l.indexOf(fc);return t>=0?l.slice(t+1):""},a.cp=function(l){const t=[],s=l.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},a.cq=function(l,t,s,c){return l.type==="custom"?new vw(l,t):new Lw[l.type](l,t,s,c)},a.cr=Za,a.cs=Lu,a.ct=so,a.cu=yd,a.cv=class extends Xl{constructor(l){super(l),this.current=em}set(l,t,s){if(this.fetchUniformLocation(l,t)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},a.cw=_s,a.cx=function(l,t,s){const c=jc(s.zoom),p=l.style.map._antialias,h=t.options.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return c===0&&!p&&!h},a.cy=function(l){const t=l.pixelsPerMeter,s=t/ie(1,l.center.lat),c=Ve.mat4.identity(new Float64Array(16));return Ve.mat4.translate(c,c,[l.point.x,l.point.y,0]),Ve.mat4.scale(c,c,[s,s,t]),Float32Array.from(c)},a.cz=zf,a.d=function(l){return ge.API_TILEJSON_REGEX.test(l)},a.d$=_e,a.d0=$f,a.d1=Zc,a.d2=450,a.d3=7,a.d4=yw,a.d5=ei,a.d6=Ds,a.d7=256,a.d8=om,a.d9=gl,a.dA=w_,a.dB=function(l){const t=[0,0,0],s=Ve.mat4.identity(new Float64Array(16));return Ve.mat4.multiply(s,l.pixelMatrix,l.globeMatrix),Ve.vec3.transformMat4(t,t,s),new Lt(t[0],t[1])},a.dC=function(l,t,s=!1){if(ar===cc||ar===Oa||ar===Ri)throw new Error("setRTLTextPlugin cannot be called multiple times.");pi=Vt.resolveURL(l),ar=cc,wi=t,hc(),s||jl()},a.dD=dl,a.dE=function(){vp().acquire(ig)},a.dF=function(){const l=Jd;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(ig),Jd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dG=Yd,a.dH=function(l){const t=bi();if(!t)return;const s=t.delete(En);l&&s.catch(l).then(()=>l())},a.dI=Xd,a.dJ=hv,a.dK=function(l){rg=Vt.resolveURL(l),Kh||(Kh=new Xh(vp(),new lo)),Kh.broadcast("setDracoUrl",rg)},a.dL=dv,a.dM=function(l){Jh=Vt.resolveURL(l),Kh||(Kh=new Xh(vp(),new lo)),Kh.broadcast("setMeshoptUrl",Jh)},a.dN=Gt,a.dO=Hc,a.dP=tu,a.dQ=bv,a.dR=wv,a.dS=Ty,a.dT=Ms,a.dU=e0,a.dV=function(l,t,s,c,p,h,m,x,T,A,y=1,I){l.createArrays(),l.tilePixelRatio=Mt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const M=l.layers[0].layout,E=l.layers[0]._unevaluatedLayout._values,C={};if(C.scaleFactor=y,C.textSizeScaleRange=M.get("text-size-scale-range"),C.iconSizeScaleRange=M.get("icon-size-scale-range"),C.textScaleFactor=nn(C.scaleFactor,C.textSizeScaleRange[0],C.textSizeScaleRange[1]),C.iconScaleFactor=nn(C.scaleFactor,C.iconSizeScaleRange[0],C.iconSizeScaleRange[1]),l.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:Z}=l.textSizeData;C.compositeTextSizes=[E["text-size"].possiblyEvaluate(new Ui(j),x),E["text-size"].possiblyEvaluate(new Ui(Z),x)]}if(l.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:Z}=l.iconSizeData;C.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new Ui(j),x),E["icon-size"].possiblyEvaluate(new Ui(Z),x)]}C.layoutTextSize=E["text-size"].possiblyEvaluate(new Ui(T+1),x),C.layoutIconSize=E["icon-size"].possiblyEvaluate(new Ui(T+1),x),C.textMaxSize=E["text-size"].possiblyEvaluate(new Ui(18),x);const L=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",k=M.get("text-size");let V=!1;for(const j of l.features)if(j.icon&&j.icon.nameSecondary){V=!0;break}for(const j of l.features){const Z=M.get("text-font").evaluate(j,{},x).join(","),G=k.evaluate(j,{},x)*C.textScaleFactor,Y=C.layoutTextSize.evaluate(j,{},x)*C.textScaleFactor,J=(C.layoutIconSize.evaluate(j,{},x),{horizontal:{},vertical:void 0}),se=j.text;let pe,ue=[0,0];if(se){const ce=se.toString(),Me=M.get("text-letter-spacing").evaluate(j,{},x)*Ns,Fe=M.get("text-line-height").evaluate(j,{},x)*Ns,ke=Nc(ce)?Me:0,Ge=M.get("text-anchor").evaluate(j,{},x),Xe=M.get("text-variable-anchor");if(!Xe){const ot=M.get("text-radial-offset").evaluate(j,{},x);ue=ot?s0(Ge,[ot*Ns,Nm]):M.get("text-offset").evaluate(j,{},x).map(jt=>jt*Ns)}let Ye=L?"center":M.get("text-justify").evaluate(j,{},x);const Ze=M.get("symbol-placement")==="point",ut=Ze?M.get("text-max-width").evaluate(j,{},x)*Ns:1/0,Et=ot=>{l.allowVerticalPlacement&&cl(ce)&&(J.vertical=Lm(se,t,s,p,Z,ut,Fe,Ge,ot,ke,ue,Va.vertical,!0,Y,G))};if(!L&&Xe){const ot=Ye==="auto"?Xe.map(Dt=>zm(Dt)):[Ye];let jt=!1;for(let Dt=0;Dt<ot.length;Dt++){const Ct=ot[Dt];if(!J.horizontal[Ct])if(jt)J.horizontal[Ct]=J.horizontal[0];else{const bt=Lm(se,t,s,p,Z,ut,Fe,"center",Ct,ke,ue,Va.horizontal,!1,Y,G);bt&&(J.horizontal[Ct]=bt,jt=bt.positionedLines.length===1)}}Et("left")}else{if(Ye==="auto"&&(Ye=zm(Ge)),Ze||M.get("text-writing-mode").indexOf("horizontal")>=0||!cl(ce)){const ot=Lm(se,t,s,p,Z,ut,Fe,Ge,Ye,ke,ue,Va.horizontal,!1,Y,G);ot&&(J.horizontal[Ye]=ot)}Et(Ze?"left":Ye)}}let he=!1;if(j.icon&&j.icon.namePrimary){const ce=c[j.icon.namePrimary];ce&&(pe=Kb(p[j.icon.namePrimary],j.icon.nameSecondary?p[j.icon.nameSecondary]:void 0,M.get("icon-offset").evaluate(j,{},x),M.get("icon-anchor").evaluate(j,{},x)),he=ce.sdf,l.sdfIcons===void 0?l.sdfIcons=ce.sdf:l.sdfIcons!==ce.sdf&&Xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==l.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}const Le=a0(J.horizontal)||J.vertical;l.iconsInText||(l.iconsInText=!!Le&&Le.iconsInText),(Le||pe)&&sw(l,j,J,pe,c,C,Y,0,ue,he,m,x,A,I,V)}h&&l.generateCollisionDebugBuffers(T,l.collisionBoxArray,C.textScaleFactor)},a.dW=Uh,a.dX=yp,a.dY=Tl,a.dZ=Y_,a.d_=By,a.da=Ue,a.db=ct,a.dc=function(l,t,s,c,p){return nn((l-t)/(s-t)*(p-c)+c,c,p)},a.dd=Vl,a.de=we,a.df=class{constructor(l,t,s,c){this.context=l,this.format=c,this.size=s,this.texture=l.gl.createTexture();const[p,h,m]=this.size,{gl:x}=l;x.bindTexture(x.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,p,h,m,0,qm(this.format),jm(this.format),t.data)}bind(l,t){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_3D,this.texture),l!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,l),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,l),this.minFilter=l),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},a.dg=$m,a.dh=[1,1,1],a.di=$h,a.dj=Wh,a.dk=e,a.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Lt(1/0,1/0),max:new Lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,t=!1){const s=ny(new Lt(0,0),new Lt(Mt,Mt),l),c=[];if(t&&!vm(s,this._globalClipBounds))return c;for(const p of this._activeRegions){if(p.hiddenByOverlap||!vm(s,p))continue;const h=pb(p.min,p.max,l);c.push({min:h.min,max:h.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return c}setSources(l){this._setSources(l.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const s=[];for(const c of t.cache.getVisibleCoordinates()){const p=t.cache.getTile(c).buckets[t.layer];p&&p.updateFootprints(c.toUnwrapped(),s)}return s},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(l){const t=l.getFootprints();if(t.length===0)return;const s=l.getOrder(),c=l.getClipMask(),p=l.getClipScope();for(const h of t){if(!h.footprint)continue;const m=ny(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:s,clipMask:c,clipScope:p})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,s)=>t.priority-s.priority||Zf(t.min,s.min)||Zf(t.max,s.max)||t.order-s.order||t.clipMask-s.clipMask||function(c,p){const h=(m,x)=>m+x;return c.length-p.length||c.reduce(h,"").localeCompare(p.reduce(h,""))}(t.clipScope,s.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let t=0;for(;!l&&t!==this._activeRegions.length;){const s=this._activeRegions[t],c=this._prevRegions[t];l=s.priority!==c.priority||!ty(s,c)||s.order!==c.order||s.clipMask!==c.clipMask||!Zs(s.clipScope,c.clipScope),++t}}if(l){++this._updateTime;for(const s of this._activeRegions)s.order!==Hf&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const t=s=>{const c=this._activeRegions;if(s>=c.length)return s;const p=c[s].priority;for(;s<c.length&&c[s].priority===p;)++s;return s};if(this._sourceIds.length>1){let s=0,c=t(s);for(;s!==c;){let p=s;const h=s;for(;p!==c;){const m=this._activeRegions[p];m.hiddenByOverlap=!1;for(let x=0;x<h;x++){const T=this._activeRegions[x];if(!T.hiddenByOverlap&&m.order===Hf&&vm(m,T)&&(m.hiddenByOverlap=ry(m.footprint,m.tileId,T.footprint,T.tileId),m.hiddenByOverlap))break}++p}s=c,c=t(s)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=l.length-1;t>=0;t--)this._addSource(l[t]);this._computeReplacement()}},a.dm=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,t){const s=new ml,c=new O,p=[],h=l+1+2,m=t[0]+1,x=t[0]+1+(1+t.length),T=(A,y,I)=>{let M=A===h-1?A-2:A===0?A:A-1;return M+=I?24575:0,[M,y]};for(let A=0;A<h;++A)s.emplaceBack(...T(A,0,!0));for(let A=0;A<m;++A)for(let y=0;y<h;++y)s.emplaceBack(...T(y,A,(y===0||y===h-1)&&!0));for(let A=0;A<t.length;++A){const y=t[A];for(let I=0;I<h;++I)s.emplaceBack(...T(I,y,!0))}for(let A=0;A<t.length;++A){const y=c.length,I=t[A]+1+2,M=new O;for(let L=0;L<I-1;L++){const k=L===I-2,V=k?h*(x-t.length+A-L):h;for(let j=0;j<h-1;j++){const Z=L*h+j;L===0||k||j===0||j===h-2?(M.emplaceBack(Z+1,Z,Z+V),M.emplaceBack(Z+V,Z+V+1,Z+1)):(c.emplaceBack(Z+1,Z,Z+V),c.emplaceBack(Z+V,Z+V+1,Z+1))}}const E=lr.simpleSegment(0,y,s.length,c.length-y);for(let L=0;L<M.uint16.length;L+=3)c.emplaceBack(M.uint16[L],M.uint16[L+1],M.uint16[L+2]);const C=lr.simpleSegment(0,y,s.length,c.length-y);p.push({withoutSkirts:E,withSkirts:C})}return{vertices:s,indices:c,segments:p}}_createGrid(l){const t=this._fillGridMeshWithLods(o,f);this._gridSegments=t.segments,this._gridBuffer=l.createVertexBuffer(t.vertices,xl.members),this._gridIndexBuffer=l.createIndexBuffer(t.indices,!0)}_createPoles(l){const t=new O;for(let m=0;m<=o;m++)t.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=l.createIndexBuffer(t,!0);const s=new Ue,c=new Ue,p=new Ue,h=new Ue;this._poleSegments=[];for(let m=0,x=0;m<Nf;m++){const T=360/(1<<m);s.emplaceBack(0,-Os,0,.5,0),c.emplaceBack(0,-Os,0,.5,1),p.emplaceBack(0,-Os,0,.5,.5),h.emplaceBack(0,-Os,0,.5,.5);for(let A=0;A<=o;A++){let y=A/o,I=0;const M=ln(0,T,y),[E,C,L]=b(q1,j1,M,Os);s.emplaceBack(E,C,L,y,I),c.emplaceBack(E,C,L,y,1-I);const k=pn(M);y=.5+.5*Math.sin(k),I=.5+.5*Math.cos(k),p.emplaceBack(E,C,L,y,I),h.emplaceBack(E,C,L,y,1-I)}this._poleSegments.push(lr.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(s,ji,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(c,ji,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(p,ji,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(h,ji,!1)}getGridBuffers(l,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},a.dn=Hf,a.dp=qo,a.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.dr=Sl,a.ds=Ie,a.dt=P,a.du=function([l,t,s]){const c=Math.hypot(l,t,s),p=Math.atan2(l,s),h=.5*Math.PI-Math.acos(-t/c);return new F(Lr(p),Lr(h))},a.dv=Wm,a.dw=D,a.dx=function(l){const t=l.navigator?l.navigator.userAgent:null;return!!function(s){if(Fn==null){const c=s.navigator?s.navigator.userAgent:null;Fn=!!s.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Fn}(l)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.dy=function(l,t){In=l,vn=t},a.dz=lm,a.e=ge,a.e0=function(l){let t=0;if(new Uint32Array(l,0,1)[0]!==pv){const s=new Uint32Array(l,0,7),[,,c,p,h,m]=s;t=s.byteLength+p+h+m+h,(c!==l.byteLength||t>=l.byteLength)&&Xn("Invalid b3dm header information.")}return yv(l,t)},a.e1=function(l,t){const s=xv(l);for(const c of s){for(const p of c.meshes)_E(p);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(yE(c.lights,t)))}return s},a.e2=_p,a.e3=$0,a.e4=nr,a.e5=function(l){ki(),Yn!=null&&Yn.then(t=>{t.keys().then(s=>{for(let c=0;c<s.length-l;c++)t.delete(s[c])})})},a.f=function(l){return l.indexOf("mapbox:")===0},a.g=function(l,t){return so(ir(l,{method:"GET"}),t)},a.h=Oe,a.i=function(l){return ge.API_STYLE_REGEX.test(l)&&!Ce(l)},a.j=function(l){return decodeURIComponent(atob(l).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(t,s)=>String.fromCharCode(+("0x"+s))))},a.l=ir,a.m=ts,a.n=function(l,t){return so(ir(l,{type:"json"}),t)},a.o=$s,a.p=function(l,t){return so(ir(l,{method:"POST"}),t)},a.q=Vt,a.r=to,a.s=function(l){try{const t=self[l];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=ma,a.u=function(){return function l(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},a.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},a.w=Xn,a.x=Tr,a.y=2,a.z=Qy}),X(["./shared"],function(a){function _e(Ke){const ne=Ke?Ke.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function me(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let oe="[";for(const ge of Ke)oe+=`${me(ge)},`;return`${oe}]`}let ne="{";for(const oe of Object.keys(Ke).sort())ne+=`${oe}:${me(Ke[oe])},`;return`${ne}}`}function xe(Ke){let ne="";for(const oe of a.bh)ne+=`/${me(Ke[oe])}`;return ne}class Se{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,oe){this._layerConfigs={},this._layers={},this.update(ne,[],oe)}update(ne,oe,ge){this._options=ge;for(const Ce of ne)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=a.cq(Ce,this.scope,null,this._options)).compileFilter(ge),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(const Ce of oe)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Oe=function(Ce,qe){const tt={};for(let nt=0;nt<Ce.length;nt++){const st=qe&&qe[Ce[nt].id]||xe(Ce[nt]);qe&&(qe[Ce[nt].id]=st);let lt=tt[st];lt||(lt=tt[st]=[]),lt.push(Ce[nt])}const We=[];for(const nt in tt)We.push(tt[nt]);return We}(a.be(this._layerConfigs),this.keyCache);for(const Ce of Oe){const qe=Ce.map(Tt=>this._layers[Tt.id]),tt=qe[0];if(tt.visibility==="none")continue;const We=tt.source||"";let nt=this.familiesBySource[We];nt||(nt=this.familiesBySource[We]={});const st=tt.sourceLayer||"_geojsonTileLayer";let lt=nt[st];lt||(lt=nt[st]=[]),lt.push(qe)}}}const Te=1*a.dP;class Qe{constructor(ne){const oe={},ge=[];for(const tt in ne){const We=ne[tt],nt=oe[tt]={};for(const st in We.glyphs){const lt=We.glyphs[+st];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Tt=lt.metrics.localGlyph?Te:1,Vt={x:0,y:0,w:lt.bitmap.width+2*Tt,h:lt.bitmap.height+2*Tt};ge.push(Vt),nt[st]=Vt}}const{w:Oe,h:Ce}=a.z(ge),qe=new a.dO({width:Oe||1,height:Ce||1});for(const tt in ne){const We=ne[tt];for(const nt in We.glyphs){const st=We.glyphs[+nt];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const lt=oe[tt][nt],Tt=st.metrics.localGlyph?Te:1;a.dO.copy(st.bitmap,qe,{x:0,y:0},{x:lt.x+Tt,y:lt.y+Tt},st.bitmap)}}this.image=qe,this.positions=oe}}a.dN(Qe,"GlyphAtlas");class Pe{constructor(ne){this.tileID=new a.aA(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=a.aL(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor}parse(ne,oe,ge,Oe,Ce){this.status="parsing",this.data=ne,this.collisionBoxArray=new a.aR;const qe=new a.dQ(Object.keys(ne.layers).sort()),tt=new a.dR(this.tileID,this.promoteId);tt.bucketLayerIDs=[];const We={},nt=new a.dS(256,256),st={featureIndex:tt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:nt,availableImages:ge,brightness:this.brightness},lt=oe.familiesBySource[this.source];for(const vn in lt){const ui=ne.layers[vn];if(!ui)continue;let Yn=!1,Dn=!1,bi=!1;for(const ts of lt[vn])ts[0].type==="symbol"?Yn=!0:Dn=!0,ts[0].is3D()&&ts[0].type!=="model"&&(bi=!0);if(this.extraShadowCaster&&!bi||this.isSymbolTile===!0&&!Yn||this.isSymbolTile===!1&&!Dn)continue;ui.version===1&&a.w(`Vector tile source "${this.source}" layer "${vn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ki=qe.encode(vn),vr=[];for(let ts=0,xr=0;ts<ui.length;ts++){const Ji=ui.feature(ts),oi=tt.getId(Ji,vn);if(this.localizableLayerIds&&this.localizableLayerIds.has(vn)){const Dr=Ji.properties?Ji.properties.worldview:null;if(this.worldview&&typeof Dr=="string")if(Dr==="all")Ji.properties.$localized=!0;else{if(!Dr.split(",").includes(this.worldview))continue;Ji.properties.$localized=!0,Ji.properties.worldview=this.worldview}}vr.push({feature:Ji,id:oi,index:xr,sourceLayerIndex:ki}),xr++}for(const ts of lt[vn]){const xr=ts[0];(!this.extraShadowCaster||xr.is3D()&&xr.type!=="model")&&(this.isSymbolTile!==void 0&&xr.type==="symbol"!==this.isSymbolTile||xr.minzoom&&this.zoom<Math.floor(xr.minzoom)||xr.maxzoom&&this.zoom>=xr.maxzoom||xr.visibility!=="none"&&(ve(ts,this.zoom,st.brightness,ge),(We[xr.id]=xr.createBucket({index:tt.bucketLayerIDs.length,layers:ts,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ki,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(vr,st,this.tileID.canonical,this.tileTransform),tt.bucketLayerIDs.push(ts.map(Ji=>a.av(Ji.id,Ji.scope)))))}}let Tt,Vt,Xt,yn;nt.trim();const En={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},In=()=>{if(Tt)return this.status="done",Ce(Tt);if(this.extraShadowCaster)this.status="done",Ce(null,{buckets:a.be(We).filter(vn=>!vn.isEmpty()),featureIndex:tt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Vt&&Xt&&yn){const vn=new Qe(Vt),ui=new a.dU(Xt,yn,this.lut);for(const Yn in We){const Dn=We[Yn];Dn instanceof a.aS?(ve(Dn.layers,this.zoom,st.brightness,ge),a.dV(Dn,Vt,vn.positions,Xt,ui.iconPositions,this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):Dn.hasPattern&&(Dn instanceof a.aY||Dn instanceof a.aZ||Dn instanceof a.d0)&&(ve(Dn.layers,this.zoom,st.brightness,ge),Dn.addFeatures(st,this.tileID.canonical,ui.patternPositions,ge,this.tileTransform,this.brightness))}this.status="done",Ce(null,{buckets:a.be(We).filter(Yn=>!Yn.isEmpty()),featureIndex:tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vn.image,lineAtlas:nt,imageAtlas:ui,brightness:st.brightness})}};if(!this.extraShadowCaster){const vn=a.dT(st.glyphDependencies,Dn=>Object.keys(Dn).map(Number));Object.keys(vn).length?Oe.send("getGlyphs",{uid:this.uid,stacks:vn,scope:this.scope},(Dn,bi)=>{Tt||(Tt=Dn,Vt=bi,In())},void 0,!1,En):Vt={};const ui=Object.keys(st.iconDependencies);ui.length?Oe.send("getImages",{icons:ui,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Dn,bi)=>{Tt||(Tt=Dn,Xt=bi,In())},void 0,!1,En):Xt={};const Yn=Object.keys(st.patternDependencies);Yn.length?Oe.send("getImages",{icons:Yn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Dn,bi)=>{Tt||(Tt=Dn,yn=bi,In())},void 0,!1,En):yn={}}In()}}function ve(Ke,ne,oe,ge){const Oe=new a.a3(ne,{brightness:oe});for(const Ce of Ke)Ce.recalculate(Oe,ge)}class Nt extends a.E{constructor(ne,oe,ge,Oe,Ce,qe){super(),this.actor=ne,this.layerIndex=oe,this.availableImages=ge,this.loadVectorData=Ce||a.aw,this.loading={},this.loaded={},this.deduped=new a.au(ne.scheduler),this.isSpriteLoaded=Oe,this.scheduler=ne.scheduler,this.brightness=qe}loadTile(ne,oe){const ge=ne.uid,Oe=ne&&ne.request,Ce=Oe&&Oe.collectResourceTiming,qe=this.loading[ge]=new Pe(ne);qe.abort=this.loadVectorData(ne,(tt,We)=>{const nt=!this.loading[ge];if(delete this.loading[ge],nt||tt||!We)return qe.status="done",nt||(this.loaded[ge]=qe),oe(tt);const st=We.rawData,lt={};We.expires&&(lt.expires=We.expires),We.cacheControl&&(lt.cacheControl=We.cacheControl),qe.vectorTile=We.vectorTile||new a.dW.VectorTile(new a.bc(st));const Tt=()=>{qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Vt,Xt)=>{if(Vt||!Xt)return oe(Vt);const yn={};if(Ce){const En=_e(Oe);En.length>0&&(yn.resourceTiming=JSON.parse(JSON.stringify(En)))}oe(null,a.l({rawTileData:st.slice(0)},Xt,lt,yn))})};this.isSpriteLoaded?Tt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Tt,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):Tt()}),this.loaded=this.loaded||{},this.loaded[ge]=qe})}reloadTile(ne,oe){const ge=this.loaded,Oe=ne.uid;if(ge&&ge[Oe]){const Ce=ge[Oe];Ce.scaleFactor=ne.scaleFactor,Ce.showCollisionBoxes=ne.showCollisionBoxes,Ce.projection=ne.projection,Ce.brightness=ne.brightness,Ce.tileTransform=a.aL(ne.tileID.canonical,ne.projection),Ce.extraShadowCaster=ne.extraShadowCaster,Ce.lut=ne.lut;const qe=(tt,We)=>{const nt=Ce.reloadCallback;nt&&(delete Ce.reloadCallback,Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,nt)),oe(tt,We)};Ce.status==="parsing"?Ce.reloadCallback=qe:Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,qe):qe())}else oe(null,void 0)}abortTile(ne,oe){const ge=ne.uid,Oe=this.loading[ge];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[ge]),oe()}removeTile(ne,oe){const ge=this.loaded,Oe=ne.uid;ge&&ge[Oe]&&delete ge[Oe],oe()}}class wt{loadTile(ne,oe){const{uid:ge,encoding:Oe,rawImageData:Ce,padding:qe}=ne,tt=ImageBitmap&&Ce instanceof ImageBitmap?this.getImageData(Ce,qe):Ce;oe(null,new a.dX(ge,tt,Oe,qe<1))}getImageData(ne,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ge=this.offscreenCanvasContext.getImageData(-oe,-oe,ne.width+2*oe,ne.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}a.bb.setPbf(a.bc);class Bt{decodeRasterArray({task:ne,buffer:oe},ge){a.bb.performDecoding(oe,ne).then(Oe=>{ge(null,Oe)},Oe=>{ge(Oe)})}}const je=a.dW.VectorTileFeature.prototype.toGeoJSON;class Ae{constructor(ne){this._feature=ne,this.extent=a.ab,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const oe of this._feature.geometry)ne.push([new a.P(oe[0],oe[1])]);return ne}{const ne=[];for(const oe of this._feature.geometry){const ge=[];for(const Oe of oe)ge.push(new a.P(Oe[0],Oe[1]));ne.push(ge)}return ne}}toGeoJSON(ne,oe,ge){return je.call(this,ne,oe,ge)}}class pt{constructor(ne){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.ab,this.length=ne.length,this._features=ne}feature(ne){return new Ae(this._features[ne])}}const en=64/4096,ze=128;class ft{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],oe){for(const ge of ne){const Oe=ge.id;if(Oe==null)continue;let Ce=this.features.get(Oe);Ce&&this.updateCache(Ce,oe),ge.geometry?(Ce=ht(ge),this.updateCache(Ce,oe),this.features.set(Oe,Ce)):this.features.delete(Oe),this.updateCache(Ce,oe)}}updateCache(ne,oe){for(const{canonical:ge,uid:Oe}of Object.values(oe)){const{z:Ce,x:qe,y:tt}=ge;et(ne,Math.pow(2,Ce),qe,tt)&&delete oe[Oe]}}getTile(ne,oe,ge){const Oe=Math.pow(2,ne),Ce=[];for(const qe of this.features.values())et(qe,Oe,oe,ge)&&Ce.push(zn(qe,Oe,oe,ge));return{features:Ce}}getFeatures(){return[...this.features.values()]}}function et({minX:Ke,minY:ne,maxX:oe,maxY:ge},Oe,Ce,qe){return Ke<(Ce+1+en)/Oe&&ne<(qe+1+en)/Oe&&oe>(Ce-en)/Oe&&ge>(qe-en)/Oe}function ht(Ke){const{id:ne,geometry:oe,properties:ge}=Ke;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Oe,coordinates:Ce}=oe,qe={id:ne,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},tt=qe.geometry;if(Oe==="Point")it(Ce,tt,qe);else if(Oe==="MultiPoint")for(const We of Ce)it(We,tt,qe);else if(Oe==="LineString")qe.type=2,le(Ce,tt,qe);else if(Oe==="MultiLineString")qe.type=2,kt(Ce,tt,qe);else if(Oe==="Polygon")qe.type=3,kt(Ce,tt,qe,!0);else{if(Oe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");qe.type=3;for(const We of Ce)kt(We,tt,qe,!0)}return qe}function it([Ke,ne],oe,ge){const Oe=a.am(Ke);let Ce=a.at(ne);Ce=Ce<0?0:Ce>1?1:Ce,oe.push(Oe,Ce),ge.minX=Math.min(ge.minX,Oe),ge.minY=Math.min(ge.minY,Ce),ge.maxX=Math.max(ge.maxX,Oe),ge.maxY=Math.max(ge.maxY,Ce)}function le(Ke,ne,oe,ge=!1,Oe=!1){const Ce=[];for(const qe of Ke)it(qe,Ce,oe);ne.push(Ce),ge&&function(qe,tt){let We=0;for(let nt=0,st=qe.length,lt=st-2;nt<st;lt=nt,nt+=2)We+=(qe[nt]-qe[lt])*(qe[nt+1]+qe[lt+1]);if(We>0===tt)for(let nt=0,st=qe.length;nt<st/2;nt+=2){const lt=qe[nt],Tt=qe[nt+1];qe[nt]=qe[st-2-nt],qe[nt+1]=qe[st-1-nt],qe[st-2-nt]=lt,qe[st-1-nt]=Tt}}(Ce,Oe)}function kt(Ke,ne,oe,ge=!1){for(let Oe=0;Oe<Ke.length;Oe++)le(Ke[Oe],ne,oe,ge,Oe===0)}function zn(Ke,ne,oe,ge){const{id:Oe,type:Ce,geometry:qe,tags:tt}=Ke,We=[];if(Ce===1)(function(nt,st,lt,Tt,Vt){for(let Xt=0;Xt<nt.length;Xt+=2){const yn=Math.round(a.ab*(nt[Xt+0]*st-lt)),En=Math.round(a.ab*(nt[Xt+1]*st-Tt));Vt.push([yn,En])}})(qe,ne,oe,ge,We);else for(const nt of qe)Qt(nt,ne,oe,ge,We);return{id:Oe,type:Ce,geometry:We,tags:tt}}function Qt(Ke,ne,oe,ge,Oe){const Ce=-ze,qe=a.ab+ze;let tt;for(let We=0;We<Ke.length-2;We+=2){let nt=Math.round(a.ab*(Ke[We+0]*ne-oe)),st=Math.round(a.ab*(Ke[We+1]*ne-ge)),lt=Math.round(a.ab*(Ke[We+2]*ne-oe)),Tt=Math.round(a.ab*(Ke[We+3]*ne-ge));const Vt=lt-nt,Xt=Tt-st;nt<Ce&&lt<Ce||(nt<Ce?(st+=Math.round(Xt*((Ce-nt)/Vt)),nt=Ce):lt<Ce&&(Tt=st+Math.round(Xt*((Ce-nt)/Vt)),lt=Ce),st<Ce&&Tt<Ce||(st<Ce?(nt+=Math.round(Vt*((Ce-st)/Xt)),st=Ce):Tt<Ce&&(lt=nt+Math.round(Vt*((Ce-st)/Xt)),Tt=Ce),nt>=qe&&lt>=qe||(nt>=qe?(st+=Math.round(Xt*((qe-nt)/Vt)),nt=qe):lt>=qe&&(Tt=st+Math.round(Xt*((qe-nt)/Vt)),lt=qe),st>=qe&&Tt>=qe||(st>=qe?(nt+=Math.round(Vt*((qe-st)/Xt)),st=qe):Tt>=qe&&(lt=nt+Math.round(Vt*((qe-st)/Xt)),Tt=qe),tt&&nt===tt[tt.length-1][0]&&st===tt[tt.length-1][1]||(tt=[[nt,st]],Oe.push(tt)),tt.push([lt,Tt])))))}}var ri,Zi,dt,tn={exports:{}},Vn=function(){if(dt)return tn.exports;dt=1;var Ke=a.d_(),ne=function(){if(Zi)return ri;Zi=1;var st=a.dY(),lt=a.dZ().VectorTileFeature;function Tt(Xt,yn){this.options=yn||{},this.features=Xt,this.length=Xt.length}function Vt(Xt,yn){this.id=typeof Xt.id=="number"?Xt.id:void 0,this.type=Xt.type,this.rawGeometry=Xt.type===1?[Xt.geometry]:Xt.geometry,this.properties=Xt.tags,this.extent=yn||4096}return ri=Tt,Tt.prototype.feature=function(Xt){return new Vt(this.features[Xt],this.options.extent)},Vt.prototype.loadGeometry=function(){var Xt=this.rawGeometry;this.geometry=[];for(var yn=0;yn<Xt.length;yn++){for(var En=Xt[yn],In=[],vn=0;vn<En.length;vn++)In.push(new st(En[vn][0],En[vn][1]));this.geometry.push(In)}return this.geometry},Vt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Xt=this.geometry,yn=1/0,En=-1/0,In=1/0,vn=-1/0,ui=0;ui<Xt.length;ui++)for(var Yn=Xt[ui],Dn=0;Dn<Yn.length;Dn++){var bi=Yn[Dn];yn=Math.min(yn,bi.x),En=Math.max(En,bi.x),In=Math.min(In,bi.y),vn=Math.max(vn,bi.y)}return[yn,In,En,vn]},Vt.prototype.toGeoJSON=lt.prototype.toGeoJSON,ri}();function oe(st){var lt=new Ke;return function(Tt,Vt){for(var Xt in Tt.layers)Vt.writeMessage(3,ge,Tt.layers[Xt])}(st,lt),lt.finish()}function ge(st,lt){var Tt;lt.writeVarintField(15,st.version||1),lt.writeStringField(1,st.name||""),lt.writeVarintField(5,st.extent||4096);var Vt={keys:[],values:[],keycache:{},valuecache:{}};for(Tt=0;Tt<st.length;Tt++)Vt.feature=st.feature(Tt),lt.writeMessage(2,Oe,Vt);var Xt=Vt.keys;for(Tt=0;Tt<Xt.length;Tt++)lt.writeStringField(3,Xt[Tt]);var yn=Vt.values;for(Tt=0;Tt<yn.length;Tt++)lt.writeMessage(4,nt,yn[Tt])}function Oe(st,lt){var Tt=st.feature;Tt.id!==void 0&&lt.writeVarintField(1,Tt.id),lt.writeMessage(2,Ce,st),lt.writeVarintField(3,Tt.type),lt.writeMessage(4,We,Tt)}function Ce(st,lt){var Tt=st.feature,Vt=st.keys,Xt=st.values,yn=st.keycache,En=st.valuecache;for(var In in Tt.properties){var vn=Tt.properties[In],ui=yn[In];if(vn!==null){ui===void 0&&(Vt.push(In),yn[In]=ui=Vt.length-1),lt.writeVarint(ui);var Yn=typeof vn;Yn!=="string"&&Yn!=="boolean"&&Yn!=="number"&&(vn=JSON.stringify(vn));var Dn=Yn+":"+vn,bi=En[Dn];bi===void 0&&(Xt.push(vn),En[Dn]=bi=Xt.length-1),lt.writeVarint(bi)}}}function qe(st,lt){return(lt<<3)+(7&st)}function tt(st){return st<<1^st>>31}function We(st,lt){for(var Tt=st.loadGeometry(),Vt=st.type,Xt=0,yn=0,En=Tt.length,In=0;In<En;In++){var vn=Tt[In],ui=1;Vt===1&&(ui=vn.length),lt.writeVarint(qe(1,ui));for(var Yn=Vt===3?vn.length-1:vn.length,Dn=0;Dn<Yn;Dn++){Dn===1&&Vt!==1&&lt.writeVarint(qe(2,Yn-1));var bi=vn[Dn].x-Xt,ki=vn[Dn].y-yn;lt.writeVarint(tt(bi)),lt.writeVarint(tt(ki)),Xt+=bi,yn+=ki}Vt===3&&lt.writeVarint(qe(7,1))}}function nt(st,lt){var Tt=typeof st;Tt==="string"?lt.writeStringField(1,st):Tt==="boolean"?lt.writeBooleanField(7,st):Tt==="number"&&(st%1!=0?lt.writeDoubleField(3,st):st<0?lt.writeSVarintField(6,st):lt.writeVarintField(5,st))}return tn.exports=oe,tn.exports.fromVectorTileJs=oe,tn.exports.fromGeojsonVt=function(st,lt){lt=lt||{};var Tt={};for(var Vt in st)Tt[Vt]=new ne(st[Vt].features,lt),Tt[Vt].name=Vt,Tt[Vt].version=lt.version,Tt[Vt].extent=lt.extent;return oe({layers:Tt})},tn.exports.GeoJSONWrapper=ne,tn.exports}(),xi=a.d$(Vn);const hr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},_n=Math.fround||(es=new Float32Array(1),Ke=>(es[0]=+Ke,es[0]));var es;const Jt=3,Ur=5,tr=6;class Ha{constructor(ne){this.options=Object.assign(Object.create(hr),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:oe,minZoom:ge,maxZoom:Oe}=this.options;oe&&console.time("total time");const Ce=`prepare ${ne.length} points`;oe&&console.time(Ce),this.points=ne;const qe=[];for(let We=0;We<ne.length;We++){const nt=ne[We];if(!nt.geometry)continue;const[st,lt]=nt.geometry.coordinates,Tt=_n(no(st)),Vt=_n(bn(lt));qe.push(Tt,Vt,1/0,We,-1,1),this.options.reduce&&qe.push(0)}let tt=this.trees[Oe+1]=this._createTree(qe);oe&&console.timeEnd(Ce);for(let We=Oe;We>=ge;We--){const nt=+Date.now();tt=this.trees[We]=this._createTree(this._cluster(tt,We)),oe&&console.log("z%d: %d clusters in %dms",We,tt.numItems,+Date.now()-nt)}return oe&&console.timeEnd("total time"),this}getClusters(ne,oe){let ge=((ne[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,ne[1]));let Ce=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ge=-180,Ce=180;else if(ge>Ce){const lt=this.getClusters([ge,Oe,180,qe],oe),Tt=this.getClusters([-180,Oe,Ce,qe],oe);return lt.concat(Tt)}const tt=this.trees[this._limitZoom(oe)],We=tt.range(no(ge),bn(qe),no(Ce),bn(Oe)),nt=tt.data,st=[];for(const lt of We){const Tt=this.stride*lt;st.push(nt[Tt+Ur]>1?Go(nt,Tt,this.clusterProps):this.points[nt[Tt+Jt]])}return st}getChildren(ne){const oe=this._getOriginId(ne),ge=this._getOriginZoom(ne),Oe="No cluster with the specified id.",Ce=this.trees[ge];if(!Ce)throw new Error(Oe);const qe=Ce.data;if(oe*this.stride>=qe.length)throw new Error(Oe);const tt=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),We=Ce.within(qe[oe*this.stride],qe[oe*this.stride+1],tt),nt=[];for(const st of We){const lt=st*this.stride;qe[lt+4]===ne&&nt.push(qe[lt+Ur]>1?Go(qe,lt,this.clusterProps):this.points[qe[lt+Jt]])}if(nt.length===0)throw new Error(Oe);return nt}getLeaves(ne,oe,ge){const Oe=[];return this._appendLeaves(Oe,ne,oe=oe||10,ge=ge||0,0),Oe}getTile(ne,oe,ge){const Oe=this.trees[this._limitZoom(ne)],Ce=Math.pow(2,ne),{extent:qe,radius:tt}=this.options,We=tt/qe,nt=(ge-We)/Ce,st=(ge+1+We)/Ce,lt={features:[]};return this._addTileFeatures(Oe.range((oe-We)/Ce,nt,(oe+1+We)/Ce,st),Oe.data,oe,ge,Ce,lt),oe===0&&this._addTileFeatures(Oe.range(1-We/Ce,nt,1,st),Oe.data,Ce,ge,Ce,lt),oe===Ce-1&&this._addTileFeatures(Oe.range(0,nt,We/Ce,st),Oe.data,-1,ge,Ce,lt),lt.features.length?lt:null}getClusterExpansionZoom(ne){let oe=this._getOriginZoom(ne)-1;for(;oe<=this.options.maxZoom;){const ge=this.getChildren(ne);if(oe++,ge.length!==1)break;ne=ge[0].properties.cluster_id}return oe}_appendLeaves(ne,oe,ge,Oe,Ce){const qe=this.getChildren(oe);for(const tt of qe){const We=tt.properties;if(We&&We.cluster?Ce+We.point_count<=Oe?Ce+=We.point_count:Ce=this._appendLeaves(ne,We.cluster_id,ge,Oe,Ce):Ce<Oe?Ce++:ne.push(tt),ne.length===ge)break}return Ce}_createTree(ne){const oe=new a.bz(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ne.length;ge+=this.stride)oe.add(ne[ge],ne[ge+1]);return oe.finish(),oe.data=ne,oe}_addTileFeatures(ne,oe,ge,Oe,Ce,qe){for(const tt of ne){const We=tt*this.stride,nt=oe[We+Ur]>1;let st,lt,Tt;if(nt)st=Ve(oe,We,this.clusterProps),lt=oe[We],Tt=oe[We+1];else{const yn=this.points[oe[We+Jt]];st=yn.properties;const[En,In]=yn.geometry.coordinates;lt=no(En),Tt=bn(In)}const Vt={type:1,geometry:[[Math.round(this.options.extent*(lt*Ce-ge)),Math.round(this.options.extent*(Tt*Ce-Oe))]],tags:st};let Xt;Xt=nt||this.options.generateId?oe[We+Jt]:this.points[oe[We+Jt]].id,Xt!==void 0&&(Vt.id=Xt),qe.features.push(Vt)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,oe){const{radius:ge,extent:Oe,reduce:Ce,minPoints:qe}=this.options,tt=ge/(Oe*Math.pow(2,oe)),We=ne.data,nt=[],st=this.stride;for(let lt=0;lt<We.length;lt+=st){if(We[lt+2]<=oe)continue;We[lt+2]=oe;const Tt=We[lt],Vt=We[lt+1],Xt=ne.within(We[lt],We[lt+1],tt),yn=We[lt+Ur];let En=yn;for(const In of Xt){const vn=In*st;We[vn+2]>oe&&(En+=We[vn+Ur])}if(En>yn&&En>=qe){let In,vn=Tt*yn,ui=Vt*yn,Yn=-1;const Dn=(lt/st<<5)+(oe+1)+this.points.length;for(const bi of Xt){const ki=bi*st;if(We[ki+2]<=oe)continue;We[ki+2]=oe;const vr=We[ki+Ur];vn+=We[ki]*vr,ui+=We[ki+1]*vr,We[ki+4]=Dn,Ce&&(In||(In=this._map(We,lt,!0),Yn=this.clusterProps.length,this.clusterProps.push(In)),Ce(In,this._map(We,ki)))}We[lt+4]=Dn,nt.push(vn/En,ui/En,1/0,Dn,-1,En),Ce&&nt.push(Yn)}else{for(let In=0;In<st;In++)nt.push(We[lt+In]);if(En>1)for(const In of Xt){const vn=In*st;if(!(We[vn+2]<=oe)){We[vn+2]=oe;for(let ui=0;ui<st;ui++)nt.push(We[vn+ui])}}}}return nt}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,oe,ge){if(ne[oe+Ur]>1){const qe=this.clusterProps[ne[oe+tr]];return ge?Object.assign({},qe):qe}const Oe=this.points[ne[oe+Jt]].properties,Ce=this.options.map(Oe);return ge&&Ce===Oe?Object.assign({},Ce):Ce}}function Go(Ke,ne,oe){return{type:"Feature",id:Ke[ne+Jt],properties:Ve(Ke,ne,oe),geometry:{type:"Point",coordinates:[(ge=Ke[ne],360*(ge-.5)),Tl(Ke[ne+1])]}};var ge}function Ve(Ke,ne,oe){const ge=Ke[ne+Ur],Oe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ce=Ke[ne+tr],qe=Ce===-1?{}:Object.assign({},oe[Ce]);return Object.assign(qe,{cluster:!0,cluster_id:Ke[ne+Jt],point_count:ge,point_count_abbreviated:Oe})}function no(Ke){return Ke/360+.5}function bn(Ke){const ne=Math.sin(Ke*Math.PI/180),oe=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return oe<0?0:oe>1?1:oe}function Tl(Ke){const ne=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Lt(Ke,ne,oe,ge){let Oe=ge;const Ce=ne+(oe-ne>>1);let qe,tt=oe-ne;const We=Ke[ne],nt=Ke[ne+1],st=Ke[oe],lt=Ke[oe+1];for(let Tt=ne+3;Tt<oe;Tt+=3){const Vt=Zs(Ke[Tt],Ke[Tt+1],We,nt,st,lt);if(Vt>Oe)qe=Tt,Oe=Vt;else if(Vt===Oe){const Xt=Math.abs(Tt-Ce);Xt<tt&&(qe=Tt,tt=Xt)}}Oe>ge&&(qe-ne>3&&Lt(Ke,ne,qe,ge),Ke[qe+2]=Oe,oe-qe>3&&Lt(Ke,qe,oe,ge))}function Zs(Ke,ne,oe,ge,Oe,Ce){let qe=Oe-oe,tt=Ce-ge;if(qe!==0||tt!==0){const We=((Ke-oe)*qe+(ne-ge)*tt)/(qe*qe+tt*tt);We>1?(oe=Oe,ge=Ce):We>0&&(oe+=qe*We,ge+=tt*We)}return qe=Ke-oe,tt=ne-ge,qe*qe+tt*tt}function Gr(Ke,ne,oe,ge){const Oe={id:Ke??null,type:ne,geometry:oe,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")io(Oe,oe);else if(ne==="Polygon")io(Oe,oe[0]);else if(ne==="MultiLineString")for(const Ce of oe)io(Oe,Ce);else if(ne==="MultiPolygon")for(const Ce of oe)io(Oe,Ce[0]);return Oe}function io(Ke,ne){for(let oe=0;oe<ne.length;oe+=3)Ke.minX=Math.min(Ke.minX,ne[oe]),Ke.minY=Math.min(Ke.minY,ne[oe+1]),Ke.maxX=Math.max(Ke.maxX,ne[oe]),Ke.maxY=Math.max(Ke.maxY,ne[oe+1])}function pn(Ke,ne,oe,ge){if(!ne.geometry)return;const Oe=ne.geometry.coordinates;if(Oe&&Oe.length===0)return;const Ce=ne.geometry.type,qe=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let tt=[],We=ne.id;if(oe.promoteId?We=ne.properties[oe.promoteId]:oe.generateId&&(We=ge||0),Ce==="Point")Lr(Oe,tt);else if(Ce==="MultiPoint")for(const nt of Oe)Lr(nt,tt);else if(Ce==="LineString")si(Oe,tt,qe,!1);else if(Ce==="MultiLineString"){if(oe.lineMetrics){for(const nt of Oe)tt=[],si(nt,tt,qe,!1),Ke.push(Gr(We,"LineString",tt,ne.properties));return}_s(Oe,tt,qe,!1)}else if(Ce==="Polygon")_s(Oe,tt,qe,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const nt of ne.geometry.geometries)pn(Ke,{id:We,geometry:nt,properties:ne.properties},oe,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of Oe){const st=[];_s(nt,st,qe,!0),tt.push(st)}}Ke.push(Gr(We,Ce,tt,ne.properties))}function Lr(Ke,ne){ne.push(qo(Ke[0]),Sl(Ke[1]),0)}function si(Ke,ne,oe,ge){let Oe,Ce,qe=0;for(let We=0;We<Ke.length;We++){const nt=qo(Ke[We][0]),st=Sl(Ke[We][1]);ne.push(nt,st,0),We>0&&(qe+=ge?(Oe*st-nt*Ce)/2:Math.sqrt(Math.pow(nt-Oe,2)+Math.pow(st-Ce,2))),Oe=nt,Ce=st}const tt=ne.length-3;ne[2]=1,Lt(ne,0,tt,oe),ne[tt+2]=1,ne.size=Math.abs(qe),ne.start=0,ne.end=ne.size}function _s(Ke,ne,oe,ge){for(let Oe=0;Oe<Ke.length;Oe++){const Ce=[];si(Ke[Oe],Ce,oe,ge),ne.push(Ce)}}function qo(Ke){return Ke/360+.5}function Sl(Ke){const ne=Math.sin(Ke*Math.PI/180),oe=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return oe<0?0:oe>1?1:oe}function nn(Ke,ne,oe,ge,Oe,Ce,qe,tt){if(ge/=ne,Ce>=(oe/=ne)&&qe<ge)return Ke;if(qe<oe||Ce>=ge)return null;const We=[];for(const nt of Ke){const st=nt.geometry;let lt=nt.type;const Tt=Oe===0?nt.minX:nt.minY,Vt=Oe===0?nt.maxX:nt.maxY;if(Tt>=oe&&Vt<ge){We.push(nt);continue}if(Vt<oe||Tt>=ge)continue;let Xt=[];if(lt==="Point"||lt==="MultiPoint")fa(st,Xt,oe,ge,Oe);else if(lt==="LineString")jo(st,Xt,oe,ge,Oe,!1,tt.lineMetrics);else if(lt==="MultiLineString")ir(st,Xt,oe,ge,Oe,!1);else if(lt==="Polygon")ir(st,Xt,oe,ge,Oe,!0);else if(lt==="MultiPolygon")for(const yn of st){const En=[];ir(yn,En,oe,ge,Oe,!0),En.length&&Xt.push(En)}if(Xt.length){if(tt.lineMetrics&&lt==="LineString"){for(const yn of Xt)We.push(Gr(nt.id,lt,yn,nt.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(Xt.length===1?(lt="LineString",Xt=Xt[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=Xt.length===3?"Point":"MultiPoint"),We.push(Gr(nt.id,lt,Xt,nt.tags))}}return We.length?We:null}function fa(Ke,ne,oe,ge,Oe){for(let Ce=0;Ce<Ke.length;Ce+=3){const qe=Ke[Ce+Oe];qe>=oe&&qe<=ge&&Rt(ne,Ke[Ce],Ke[Ce+1],Ke[Ce+2])}}function jo(Ke,ne,oe,ge,Oe,Ce,qe){let tt=dr(Ke);const We=Oe===0?Fs:So;let nt,st,lt=Ke.start;for(let En=0;En<Ke.length-3;En+=3){const In=Ke[En],vn=Ke[En+1],ui=Ke[En+2],Yn=Ke[En+3],Dn=Ke[En+4],bi=Oe===0?In:vn,ki=Oe===0?Yn:Dn;let vr=!1;qe&&(nt=Math.sqrt(Math.pow(In-Yn,2)+Math.pow(vn-Dn,2))),bi<oe?ki>oe&&(st=We(tt,In,vn,Yn,Dn,oe),qe&&(tt.start=lt+nt*st)):bi>ge?ki<ge&&(st=We(tt,In,vn,Yn,Dn,ge),qe&&(tt.start=lt+nt*st)):Rt(tt,In,vn,ui),ki<oe&&bi>=oe&&(st=We(tt,In,vn,Yn,Dn,oe),vr=!0),ki>ge&&bi<=ge&&(st=We(tt,In,vn,Yn,Dn,ge),vr=!0),!Ce&&vr&&(qe&&(tt.end=lt+nt*st),ne.push(tt),tt=dr(Ke)),qe&&(lt+=nt)}let Tt=Ke.length-3;const Vt=Ke[Tt],Xt=Ke[Tt+1],yn=Oe===0?Vt:Xt;yn>=oe&&yn<=ge&&Rt(tt,Vt,Xt,Ke[Tt+2]),Tt=tt.length-3,Ce&&Tt>=3&&(tt[Tt]!==tt[0]||tt[Tt+1]!==tt[1])&&Rt(tt,tt[0],tt[1],tt[2]),tt.length&&ne.push(tt)}function dr(Ke){const ne=[];return ne.size=Ke.size,ne.start=Ke.start,ne.end=Ke.end,ne}function ir(Ke,ne,oe,ge,Oe,Ce){for(const qe of Ke)jo(qe,ne,oe,ge,Oe,Ce,!1)}function Rt(Ke,ne,oe,ge){Ke.push(ne,oe,ge)}function Fs(Ke,ne,oe,ge,Oe,Ce){const qe=(Ce-ne)/(ge-ne);return Rt(Ke,Ce,oe+(Oe-oe)*qe,1),qe}function So(Ke,ne,oe,ge,Oe,Ce){const qe=(Ce-oe)/(Oe-oe);return Rt(Ke,ne+(ge-ne)*qe,Ce,1),qe}function jn(Ke,ne){const oe=[];for(let ge=0;ge<Ke.length;ge++){const Oe=Ke[ge],Ce=Oe.type;let qe;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")qe=fr(Oe.geometry,ne);else if(Ce==="MultiLineString"||Ce==="Polygon"){qe=[];for(const tt of Oe.geometry)qe.push(fr(tt,ne))}else if(Ce==="MultiPolygon"){qe=[];for(const tt of Oe.geometry){const We=[];for(const nt of tt)We.push(fr(nt,ne));qe.push(We)}}oe.push(Gr(Oe.id,Ce,qe,Oe.tags))}return oe}function fr(Ke,ne){const oe=[];oe.size=Ke.size,Ke.start!==void 0&&(oe.start=Ke.start,oe.end=Ke.end);for(let ge=0;ge<Ke.length;ge+=3)oe.push(Ke[ge]+ne,Ke[ge+1],Ke[ge+2]);return oe}function Ms(Ke,ne){if(Ke.transformed)return Ke;const oe=1<<Ke.z,ge=Ke.x,Oe=Ke.y;for(const Ce of Ke.features){const qe=Ce.geometry,tt=Ce.type;if(Ce.geometry=[],tt===1)for(let We=0;We<qe.length;We+=2)Ce.geometry.push(Za(qe[We],qe[We+1],ne,oe,ge,Oe));else for(let We=0;We<qe.length;We++){const nt=[];for(let st=0;st<qe[We].length;st+=2)nt.push(Za(qe[We][st],qe[We][st+1],ne,oe,ge,Oe));Ce.geometry.push(nt)}}return Ke.transformed=!0,Ke}function Za(Ke,ne,oe,ge,Oe,Ce){return[Math.round(oe*(Ke*ge-Oe)),Math.round(oe*(ne*ge-Ce))]}function ro(Ke,ne,oe,ge,Oe){const Ce=ne===Oe.maxZoom?0:Oe.tolerance/((1<<ne)*Oe.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:oe,y:ge,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of Ke)qu(qe,tt,Ce,Oe);return qe}function qu(Ke,ne,oe,ge){const Oe=ne.geometry,Ce=ne.type,qe=[];if(Ke.minX=Math.min(Ke.minX,ne.minX),Ke.minY=Math.min(Ke.minY,ne.minY),Ke.maxX=Math.max(Ke.maxX,ne.maxX),Ke.maxY=Math.max(Ke.maxY,ne.maxY),Ce==="Point"||Ce==="MultiPoint")for(let tt=0;tt<Oe.length;tt+=3)qe.push(Oe[tt],Oe[tt+1]),Ke.numPoints++,Ke.numSimplified++;else if(Ce==="LineString")Xn(qe,Oe,Ke,oe,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let tt=0;tt<Oe.length;tt++)Xn(qe,Oe[tt],Ke,oe,Ce==="Polygon",tt===0);else if(Ce==="MultiPolygon")for(let tt=0;tt<Oe.length;tt++){const We=Oe[tt];for(let nt=0;nt<We.length;nt++)Xn(qe,We[nt],Ke,oe,!0,nt===0)}if(qe.length){let tt=ne.tags||null;if(Ce==="LineString"&&ge.lineMetrics){tt={};for(const nt in ne.tags)tt[nt]=ne.tags[nt];tt.mapbox_clip_start=Oe.start/Oe.size,tt.mapbox_clip_end=Oe.end/Oe.size}const We={geometry:qe,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:tt};ne.id!==null&&(We.id=ne.id),Ke.features.push(We)}}function Xn(Ke,ne,oe,ge,Oe,Ce){const qe=ge*ge;if(ge>0&&ne.size<(Oe?qe:ge))return void(oe.numPoints+=ne.length/3);const tt=[];for(let We=0;We<ne.length;We+=3)(ge===0||ne[We+2]>qe)&&(oe.numSimplified++,tt.push(ne[We],ne[We+1])),oe.numPoints++;Oe&&function(We,nt){let st=0;for(let lt=0,Tt=We.length,Vt=Tt-2;lt<Tt;Vt=lt,lt+=2)st+=(We[lt]-We[Vt])*(We[lt+1]+We[Vt+1]);if(st>0===nt)for(let lt=0,Tt=We.length;lt<Tt/2;lt+=2){const Vt=We[lt],Xt=We[lt+1];We[lt]=We[Tt-2-lt],We[lt+1]=We[Tt-1-lt],We[Tt-2-lt]=Vt,We[Tt-1-lt]=Xt}}(tt,Ce),Ke.push(tt)}const Ho={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ic{constructor(ne,oe){const ge=(oe=this.options=function(Ce,qe){for(const tt in qe)Ce[tt]=qe[tt];return Ce}(Object.create(Ho),oe)).debug;if(ge&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Oe=function(Ce,qe){const tt=[];if(Ce.type==="FeatureCollection")for(let We=0;We<Ce.features.length;We++)pn(tt,Ce.features[We],qe,We);else pn(tt,Ce.type==="Feature"?Ce:{geometry:Ce},qe);return tt}(ne,oe);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=function(Ce,qe){const tt=qe.buffer/qe.extent;let We=Ce;const nt=nn(Ce,1,-1-tt,tt,0,-1,2,qe),st=nn(Ce,1,1-tt,2+tt,0,-1,2,qe);return(nt||st)&&(We=nn(Ce,1,-tt,1+tt,0,-1,2,qe)||[],nt&&(We=jn(nt,1).concat(We)),st&&(We=We.concat(jn(st,-1)))),We}(Oe,oe),Oe.length&&this.splitTile(Oe,0,0,0),ge&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,oe,ge,Oe,Ce,qe,tt){const We=[ne,oe,ge,Oe],nt=this.options,st=nt.debug;for(;We.length;){Oe=We.pop(),ge=We.pop(),oe=We.pop(),ne=We.pop();const lt=1<<oe,Tt=Ws(oe,ge,Oe);let Vt=this.tiles[Tt];if(!Vt&&(st>1&&console.time("creation"),Vt=this.tiles[Tt]=ro(ne,oe,ge,Oe,nt),this.tileCoords.push({z:oe,x:ge,y:Oe}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,ge,Oe,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));const vr=`z${oe}`;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if(Vt.source=ne,Ce==null){if(oe===nt.indexMaxZoom||Vt.numPoints<=nt.indexMaxPoints)continue}else{if(oe===nt.maxZoom||oe===Ce)continue;if(Ce!=null){const vr=Ce-oe;if(ge!==qe>>vr||Oe!==tt>>vr)continue}}if(Vt.source=null,ne.length===0)continue;st>1&&console.time("clipping");const Xt=.5*nt.buffer/nt.extent,yn=.5-Xt,En=.5+Xt,In=1+Xt;let vn=null,ui=null,Yn=null,Dn=null,bi=nn(ne,lt,ge-Xt,ge+En,0,Vt.minX,Vt.maxX,nt),ki=nn(ne,lt,ge+yn,ge+In,0,Vt.minX,Vt.maxX,nt);ne=null,bi&&(vn=nn(bi,lt,Oe-Xt,Oe+En,1,Vt.minY,Vt.maxY,nt),ui=nn(bi,lt,Oe+yn,Oe+In,1,Vt.minY,Vt.maxY,nt),bi=null),ki&&(Yn=nn(ki,lt,Oe-Xt,Oe+En,1,Vt.minY,Vt.maxY,nt),Dn=nn(ki,lt,Oe+yn,Oe+In,1,Vt.minY,Vt.maxY,nt),ki=null),st>1&&console.timeEnd("clipping"),We.push(vn||[],oe+1,2*ge,2*Oe),We.push(ui||[],oe+1,2*ge,2*Oe+1),We.push(Yn||[],oe+1,2*ge+1,2*Oe),We.push(Dn||[],oe+1,2*ge+1,2*Oe+1)}}getTile(ne,oe,ge){ne=+ne,oe=+oe,ge=+ge;const Oe=this.options,{extent:Ce,debug:qe}=Oe;if(ne<0||ne>24)return null;const tt=1<<ne,We=Ws(ne,oe=oe+tt&tt-1,ge);if(this.tiles[We])return Ms(this.tiles[We],Ce);qe>1&&console.log("drilling down to z%d-%d-%d",ne,oe,ge);let nt,st=ne,lt=oe,Tt=ge;for(;!nt&&st>0;)st--,lt>>=1,Tt>>=1,nt=this.tiles[Ws(st,lt,Tt)];return nt&&nt.source?(qe>1&&(console.log("found parent tile z%d-%d-%d",st,lt,Tt),console.time("drilling down")),this.splitTile(nt.source,st,lt,Tt,ne,oe,ge),qe>1&&console.timeEnd("drilling down"),this.tiles[We]?Ms(this.tiles[We],Ce):null):null}}function Ws(Ke,ne,oe){return 32*((1<<Ke)*oe+ne)+Ke}function Rr(Ke,ne){const oe=Ke.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ge=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ge)return void ne(null,null);const Oe=new pt(ge.features);let Ce=xi(Oe);Ce.byteOffset===0&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),ne(null,{vectorTile:Oe,rawData:Ce.buffer})}class Yi extends Nt{constructor(ne,oe,ge,Oe,Ce,qe){super(ne,oe,ge,Oe,Rr,qe),Ce&&(this.loadGeoJSON=Ce),this._dynamicIndex=new ft}loadData(ne,oe){const ge=ne&&ne.request,Oe=ge&&ge.collectResourceTiming;this.loadGeoJSON(ne,(Ce,qe)=>{if(Ce||!qe)return oe(Ce);if(typeof qe!="object")return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const We=a.M(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(We.result==="error")throw new Error(We.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));qe.features=qe.features.filter(nt=>We.value.evaluate({zoom:0},nt))}ne.dynamic?(qe.type==="Feature"&&(qe={type:"FeatureCollection",features:[qe]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(qe.features,this.loaded),ne.cluster&&(qe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new Ha(function({superclusterOptions:We,clusterProperties:nt}){if(!nt||!We)return We;const st={},lt={},Tt={accumulated:null,zoom:0},Vt={properties:null},Xt=Object.keys(nt);for(const yn of Xt){const[En,In]=nt[yn],vn=a.M(In),ui=a.M(typeof En=="string"?[En,["accumulated"],["get",yn]]:En);st[yn]=vn.value,lt[yn]=ui.value}return We.map=yn=>{Vt.properties=yn;const En={};for(const In of Xt)En[In]=st[In].evaluate(Tt,Vt);return En},We.reduce=(yn,En)=>{Vt.properties=En;for(const In of Xt)Tt.accumulated=yn[In],yn[In]=lt[In].evaluate(Tt,Vt)},We}(ne)).load(qe.features):ne.dynamic?this._dynamicIndex:function(We,nt){return new Ic(We,nt)}(qe,ne.geojsonVtOptions)}catch(We){return oe(We)}const tt={};if(Oe){const We=_e(ge);We&&(tt.resourceTiming={},tt.resourceTiming[ne.source]=JSON.parse(JSON.stringify(We)))}oe(null,tt)}})}reloadTile(ne,oe){const ge=this.loaded;return ge&&ge[ne.uid]?ne.partial?oe(null,void 0):super.reloadTile(ne,oe):this.loadTile(ne,oe)}loadGeoJSON(ne,oe){if(ne.request)a.n(ne.request,oe);else{if(typeof ne.data!="string")return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(ne.data))}catch{return oe(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ne,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ge){oe(ge)}}getClusterChildren(ne,oe){try{oe(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ge){oe(ge)}}getClusterLeaves(ne,oe){try{oe(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ge){oe(ge)}}}class Fn{constructor(ne,oe){this.tileID=new a.aA(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=oe}parse(ne,oe,ge,Oe){this.status="parsing";const Ce=new a.aA(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),qe=[],tt=oe.familiesBySource[ge.source],We=new a.dR(Ce,ge.promoteId);return We.bucketLayerIDs=[],We.is3DTile=!0,a.e0(ne).then(nt=>{if(!nt)return Oe(new Error("Could not parse tile"));const st=a.e1(nt,1/a.c9(ge.tileID.canonical)),lt=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("MAPBOX_mesh_features")||nt.json.asset.extras&&nt.json.asset.extras.MAPBOX_mesh_features,Tt=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("EXT_meshopt_compression"),Vt=new a.a3(this.zoom,{brightness:this.brightness});for(const Xt in tt)for(const yn of tt[Xt]){const En=yn[0];We.bucketLayerIDs.push(yn.map(vn=>a.av(vn.id,vn.scope))),En.recalculate(Vt,[]);const In=new a.e2(yn,st,Ce,lt,Tt,this.brightness,We);lt||(In.needsUpload=!0),qe.push(In),In.evaluate(En)}this.status="done",Oe(null,{buckets:qe,featureIndex:We,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(nt=>Oe(new Error(nt.message)))}}class pa{constructor(ne,oe,ge,Oe,Ce,qe){this.actor=ne,this.layerIndex=oe,this.availableImages=ge,this.brightness=qe,this.loading={},this.loaded={}}loadTile(ne,oe){const ge=ne.uid,Oe=this.loading[ge]=new Fn(ne,this.brightness);a.bd(ne.request,(Ce,qe)=>{const tt=!this.loading[ge];return delete this.loading[ge],tt||Ce?(Oe.status="done",tt||(this.loaded[ge]=Oe),oe(Ce)):qe&&qe.byteLength!==0?void Oe.parse(qe,this.layerIndex,ne,(We,nt)=>{Oe.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Oe,We||!nt?oe(We):oe(null,nt)}):(Oe.status="done",this.loaded[ge]=Oe,oe())})}reloadTile(ne,oe){const ge=this.loaded,Oe=ne.uid;if(ge&&ge[Oe]){const Ce=ge[Oe];Ce.projection=ne.projection,Ce.brightness=ne.brightness;const qe=(tt,We)=>{Ce.reloadCallback&&(delete Ce.reloadCallback,this.loadTile(ne,oe)),oe(tt,We)};Ce.status==="parsing"?Ce.reloadCallback=qe:Ce.status==="done"&&this.loadTile(ne,oe)}}abortTile(ne,oe){const ge=ne.uid;this.loading[ge]&&delete this.loading[ge],oe()}removeTile(ne,oe){const ge=this.loaded,Oe=ne.uid;ge&&ge[Oe]&&delete ge[Oe],oe()}}class Fi{constructor(ne){this.self=ne,this.actor=new a.e3(ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.bM({name:"mercator"}),this.workerSourceTypes={vector:Nt,geojson:Yi,"batched-model":pa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(oe,ge)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=ge},this.self.registerRTLTextPlugin=oe=>{if(a.e4.isParsed())throw new Error("RTL text plugin already registered.");a.e4.applyArabicShaping=oe.applyArabicShaping,a.e4.processBidirectionalText=oe.processBidirectionalText,a.e4.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(ne,oe,ge){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne],delete this.rasterArrayWorkerSource,ge()}checkIfReady(ne,oe,ge){ge()}setReferrer(ne,oe){this.referrer=oe}spriteLoaded(ne,{scope:oe,isLoaded:ge}){if(this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.isSpriteLoaded[ne][oe]=ge,this.workerSources[ne]&&this.workerSources[ne][oe])for(const Oe in this.workerSources[ne][oe]){const Ce=this.workerSources[ne][oe][Oe];for(const qe in Ce){const tt=Ce[qe];tt instanceof Nt&&(tt.isSpriteLoaded=ge,tt.fire(new a.x("isSpriteLoaded")))}}}setImages(ne,{scope:oe,images:ge},Oe){if(this.availableImages[ne]||(this.availableImages[ne]={}),this.availableImages[ne][oe]=ge,this.workerSources[ne]&&this.workerSources[ne][oe]){for(const Ce in this.workerSources[ne][oe]){const qe=this.workerSources[ne][oe][Ce];for(const tt in qe)qe[tt].availableImages=ge}Oe()}else Oe()}setProjection(ne,oe){this.projections[ne]=a.bM(oe)}setBrightness(ne,oe,ge){this.brightness=oe,ge()}setLayers(ne,oe,ge){this.getLayerIndex(ne,oe.scope).replace(oe.layers,oe.options),ge()}updateLayers(ne,oe,ge){this.getLayerIndex(ne,oe.scope).update(oe.layers,oe.removedIds,oe.options),ge()}loadTile(ne,oe,ge){oe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,oe.type,oe.source,oe.scope).loadTile(oe,ge)}loadDEMTile(ne,oe,ge){this.getDEMWorkerSource(ne,oe.source,oe.scope).loadTile(oe,ge)}decodeRasterArray(ne,oe,ge){this.getRasterArrayWorkerSource().decodeRasterArray(oe,ge)}reloadTile(ne,oe,ge){oe.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,oe.type,oe.source,oe.scope).reloadTile(oe,ge)}abortTile(ne,oe,ge){this.getWorkerSource(ne,oe.type,oe.source,oe.scope).abortTile(oe,ge)}removeTile(ne,oe,ge){this.getWorkerSource(ne,oe.type,oe.source,oe.scope).removeTile(oe,ge)}removeSource(ne,oe,ge){if(!(this.workerSources[ne]&&this.workerSources[ne][oe.scope]&&this.workerSources[ne][oe.scope][oe.type]&&this.workerSources[ne][oe.scope][oe.type][oe.source]))return;const Oe=this.workerSources[ne][oe.scope][oe.type][oe.source];delete this.workerSources[ne][oe.scope][oe.type][oe.source],Oe.removeSource!==void 0?Oe.removeSource(oe,ge):ge()}loadWorkerSource(ne,oe,ge){try{this.self.importScripts(oe.url),ge()}catch(Oe){ge(Oe.toString())}}syncRTLPluginState(ne,oe,ge){try{a.e4.setState(oe);const Oe=a.e4.getPluginURL();if(a.e4.isLoaded()&&!a.e4.isParsed()&&Oe!=null){this.self.importScripts(Oe);const Ce=a.e4.isParsed();ge(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oe}`),Ce)}}catch(Oe){ge(Oe.toString())}}setDracoUrl(ne,oe){this.dracoUrl=oe}getAvailableImages(ne,oe){this.availableImages[ne]||(this.availableImages[ne]={});let ge=this.availableImages[ne][oe];return ge||(ge=[]),ge}getLayerIndex(ne,oe){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ge=this.layerIndexes[ne][oe];return ge||(ge=this.layerIndexes[ne][oe]=new Se,ge.scope=oe),ge}getWorkerSource(ne,oe,ge,Oe){return this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][Oe]||(this.workerSources[ne][Oe]={}),this.workerSources[ne][Oe][oe]||(this.workerSources[ne][Oe][oe]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.workerSources[ne][Oe][oe][ge]||(this.workerSources[ne][Oe][oe][ge]=new this.workerSourceTypes[oe]({send:(Ce,qe,tt,We,nt,st)=>{this.actor.send(Ce,qe,tt,ne,nt,st)},scheduler:this.actor.scheduler},this.getLayerIndex(ne,Oe),this.getAvailableImages(ne,Oe),this.isSpriteLoaded[ne][Oe],void 0,this.brightness)),this.workerSources[ne][Oe][oe][ge]}getDEMWorkerSource(ne,oe,ge){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][ge]||(this.demWorkerSources[ne][ge]={}),this.demWorkerSources[ne][ge][oe]||(this.demWorkerSources[ne][ge][oe]=new wt),this.demWorkerSources[ne][ge][oe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Bt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ne,oe){a.e5(oe)}getWorkerPerformanceMetrics(ne,oe,ge){ge(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fi(self)),Fi}),X(["./shared"],function(a){var _e="3.8.0";const me={create:"create",load:"load",fullLoad:"fullLoad"},xe={mark(d){performance.mark(d)},measure(d,n,o){performance.measure(d,n,o)}};function Se(d){const n=d.name.split("?")[0];return a.a(n)&&n.includes("mapbox-gl.js")?"javascript":a.a(n)&&n.includes("mapbox-gl.css")?"css":a.b(n)?"fontRange":a.c(n)?"sprite":a.i(n)?"style":a.d(n)?"tilejson":"other"}var Te,Qe={},Pe=function(){if(Te)return Qe;function d(f){return!n(f)}function n(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,b,P=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(P);try{b=new Worker(D),v=!0}catch{v=!1}return b&&b.terminate(),URL.revokeObjectURL(D),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var b=v.getContext("2d");if(!b)return!1;var P=b.getImageData(0,0,1,1);return P&&P.width===v.width}()?(o[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(o[_]=function(v){var b,P=function(D){var B=document.createElement("canvas"),F=Object.create(d.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=D,B.getContext("webgl2",F)}(v);if(!P)return!1;try{b=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!b||P.isContextLost())&&(P.shaderSource(b,"void main() {}"),P.compileShader(b),P.getShaderParameter(b,P.COMPILE_STATUS)===!0)}(_)),o[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}Te=1,Qe.supported=d,Qe.notSupportedReason=n;var o={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Qe}();function ve(d,n,o){const f=document.createElement(d);return n!=null&&(f.className=n),o&&o.appendChild(f),f}function Nt(d,n,o){const f=document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(n))f.setAttributeNS(null,_,String(n[_]));return o&&o.appendChild(f),f}const wt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Bt=wt&&wt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let je;function Ae(){wt&&Bt&&(je=wt[Bt],wt[Bt]="none")}function pt(){wt&&Bt&&(wt[Bt]=je)}function en(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",en,!0)}function ze(){window.addEventListener("click",en,!0),window.setTimeout(()=>{window.removeEventListener("click",en,!0)},0)}function ft(d,n){const o=d.getBoundingClientRect();return it(d,o,n)}function et(d,n){const o=d.getBoundingClientRect(),f=[];for(let _=0;_<n.length;_++)f.push(it(d,o,n[_]));return f}function ht(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function it(d,n,o){const f=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new a.P((o.clientX-n.left)*f,(o.clientY-n.top)*f)}const le="01",kt="NO_ACCESS_TOKEN";class zn{constructor(n,o,f){this._transformRequestFn=n,this._customAccessToken=o,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const n=function(){let o="";for(let f=0;f<10;f++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",le,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,o){return this._transformRequestFn&&this._transformRequestFn(n,o)||{url:n}}normalizeStyleURL(n,o){if(!a.f(n))return n;const f=ri(n);return f.params.push(`sdk=js-${_e}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeGlyphsURL(n,o){if(!a.f(n))return n;const f=ri(n);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeModelURL(n,o){if(!a.f(n))return n;const f=ri(n);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeSourceURL(n,o,f,_){if(!a.f(n))return n;const v=ri(n);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),f&&v.params.push(`language=${f}`),_&&v.params.push(`worldview=${_}`),this._makeAPIURL(v,this._customAccessToken||o)}normalizeSpriteURL(n,o,f,_){const v=ri(n);return a.f(n)?(v.path=`/styles/v1${v.path}/sprite${o}${f}`,this._makeAPIURL(v,this._customAccessToken||_)):(v.path+=`${o}${f}`,Zi(v))}normalizeTileURL(n,o,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!a.f(n))return n;const _=ri(n);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||f&&_.authority!=="raster"&&f===512?"@2x":""}${a.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${a.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${a.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${a.e.TILE_URL_VERSION}${_.path}`);const v=this._customAccessToken||function(b){for(const P of b){const D=P.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(_.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,v)}canonicalizeTileURL(n,o){const f=ri(n);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return n;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let v=f.params;return o&&(v=v.filter(b=>!b.match(/^access_token=/))),v.length&&(_+=`?${v.join("&")}`),_}canonicalizeTileset(n,o){const f=!!o&&a.f(o),_=[];for(const v of n.tiles||[])a.h(v)?_.push(this.canonicalizeTileURL(v,f)):_.push(v);return _}_makeAPIURL(n,o){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=ri(a.e.API_URL);if(n.protocol=_.protocol,n.authority=_.authority,n.protocol==="http"){const v=n.params.indexOf("secure");v>=0&&n.params.splice(v,1)}if(_.path!=="/"&&(n.path=`${_.path}${n.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return Zi(n);if(o=o||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return n.params=n.params.filter(v=>v.indexOf("access_token")===-1),n.params.push(`access_token=${o||""}`),Zi(n)}}const Qt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ri(d){const n=d.match(Qt);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Zi(d){const n=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${n}`}const dt="mapbox.eventData";function tn(d){if(!d)return null;const n=d.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(a.j(n[1]))}catch{return null}}class Vn{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=tn(a.e.ACCESS_TOKEN);let f="";return f=o&&o.u?a.k(o.u):a.e.ACCESS_TOKEN||"",n?`${dt}.${n}:${f}`:`${dt}:${f}`}fetchEventData(){const n=a.s("localStorage"),o=this.getStorageKey(),f=this.getStorageKey("uuid");if(n)try{const _=localStorage.getItem(o);_&&(this.eventData=JSON.parse(_));const v=localStorage.getItem(f);v&&(this.anonId=v)}catch{a.w("Unable to read from LocalStorage")}}saveEventData(){const n=a.s("localStorage"),o=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.anonId;if(n&&_)try{localStorage.setItem(f,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{a.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,f,_){if(!a.e.EVENTS_URL)return;const v=ri(a.e.EVENTS_URL);v.params.push(`access_token=${_||a.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(n).toISOString()},P=o?a.l(b,o):b,D={url:Zi(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=a.p(D,B=>{this.pendingRequest=null,f(B),this.saveEventData(),this.processRequests(_)})}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const xi=new class extends Vn{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,n){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(o=>a.f(o)||a.h(o))&&this.queueRequest(Date.now(),n)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=tn(a.e.ACCESS_TOKEN),o=n?n.u:a.e.ACCESS_TOKEN;let f=o!==this.eventData.tokenU;a.v(this.anonId)||(this.anonId=a.u(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),b=new Date(_),P=(_-this.eventData.lastSuccess)/864e5;f=f||P>=1||P<-1||v.getDate()!==b.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_e,skuId:le,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=_,this.eventData.tokenU=o)},d):this.processRequests()}},hr=xi.postTurnstileEvent.bind(xi),_n=new class extends Vn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,n,o,f){this.skuToken=n,this.errorCb=f,a.e.EVENTS_URL&&(o||a.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(kt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),a.v(this.anonId)||(this.anonId=a.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_e,skuId:le,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):n&&(this.success[n]=!0)},d))}remove(){this.errorCb=null}},es=_n.postMapLoadEvent.bind(_n),Jt=new class extends Vn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let n=this.mapInstanceIdMap.get(d);return n||(n=a.u(),this.mapInstanceIdMap.set(d,n)),n}getEventId(d){const n=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,n+1),n}postStyleLoadEvent(d,n){const{map:o,style:f,importedStyles:_}=n;if(!a.e.EVENTS_URL||!d&&!a.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(o),b={mapInstanceId:v,eventId:this.getEventId(v),style:f};_.length&&(b.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:b},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:o}=this.queue.shift();this.postEvent(n,o,()=>{},d)}},Ur=Jt.postStyleLoadEvent.bind(Jt),tr=new class extends Vn{constructor(){super("gljs.performance")}postPerformanceEvent(d,n){a.e.EVENTS_URL&&(d||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),f=function(_){const v=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),P=function($){const ee={};if($){for(const K in $)if(K!=="other")for(const re of $[K]){const ie=`${K}ResolveRangeMin`,ae=`${K}ResolveRangeMax`,de=`${K}RequestCount`,fe=`${K}RequestCachedCount`;ee[ie]=Math.min(ee[ie]||1/0,re.startTime),ee[ae]=Math.max(ee[ae]||-1/0,re.responseEnd);const be=Ee=>{ee[Ee]===void 0&&(ee[Ee]=0),++ee[Ee]};re.transferSize!==void 0&&re.transferSize===0&&be(fe),be(de)}}return ee}(function($,ee){const K={};if($)for(const re of $){const ie=ee(re);K[ie]===void 0&&(K[ie]=[]),K[ie].push(re)}return K}(v,Se)),D=window.devicePixelRatio,B=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=B?B.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},q=($,ee,K)=>{K!=null&&$.push({name:ee,value:K.toString()})};for(const $ in P)q(U.counters,$,P[$]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(q(U.counters,"interactionRangeMin",_.interactionRange[0]),q(U.counters,"interactionRangeMax",_.interactionRange[1])),b)for(const $ of Object.keys(me)){const ee=me[$],K=b.find(re=>re.name===ee);K&&q(U.counters,ee,K.startTime)}return q(U.counters,"visibilityHidden",_.visibilityHidden),q(U.attributes,"style",function($){if($)for(const ee of $){const K=ee.name.split("?")[0];if(a.i(K)){const re=K.split("/").slice(-2);if(re.length===2)return`mapbox://styles/${re[0]}/${re[1]}`}}}(v)),q(U.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),q(U.attributes,"fogEnabled",_.fogEnabled?"true":"false"),q(U.attributes,"projection",_.projection),q(U.attributes,"zoom",_.zoom),q(U.metadata,"devicePixelRatio",D),q(U.metadata,"connectionEffectiveType",F),q(U.metadata,"navigatorUserAgent",navigator.userAgent),q(U.metadata,"screenWidth",window.screen.width),q(U.metadata,"screenHeight",window.screen.height),q(U.metadata,"windowWidth",window.innerWidth),q(U.metadata,"windowHeight",window.innerHeight),q(U.metadata,"mapWidth",_.width/D),q(U.metadata,"mapHeight",_.height/D),q(U.metadata,"webglRenderer",_.renderer),q(U.metadata,"webglVendor",_.vendor),q(U.metadata,"sdkVersion",_e),q(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(o);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(n,f,()=>{},d)}},Ha=tr.postPerformanceEvent.bind(tr),Go=new class extends Vn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,n,o,f){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const _=ri(a.e.API_URL+a.e.SESSION_PATH);_.params.push(`sku=${n||""}`),_.params.push(`access_token=${f||a.e.ACCESS_TOKEN||""}`);const v={url:Zi(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(v,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(f)})}getSessionAPI(d,n,o,f){this.skuToken=n,this.errorCb=f,a.e.SESSION_PATH&&a.e.API_URL&&(o||a.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(kt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,f=>{f?this.errorCb(f):n&&(this.success[n]=!0)},d)}remove(){this.errorCb=null}},Ve=Go.getSessionAPI.bind(Go),no=new Set;function bn(d,n){n?no.add(d):no.delete(d)}class Tl{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,o){this._updatedSourceCaches[n]=o,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const o=n.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(n.id),this.setDirty()}removeLayer(n){const o=n.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][n.id]=n,this._updatedLayers[o].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const o in this._updatedLayers)n[o]=n[o]||{},n[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)n[o]=n[o]||{},n[o].removedIds=Object.keys(this._removedLayers[o]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Lt(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class Zs extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new a.r({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,o){if(this.loaded[o]!==n&&(this.loaded[o]=n,n)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,o,_);this.requestors=[]}}hasImage(n,o){return!!this.getImage(n,o)}getImage(n,o){return this.images[o][n]}addImage(n,o,f){this._validate(n,f)&&(this.images[o][n]=f)}_validate(n,o){let f=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new a.t(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new a.t(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(o.content,o)||(this.fire(new a.t(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,o){if(!n)return!0;let f=0;for(const _ of n){if(_[0]<f||_[1]<_[0]||o<_[1])return!1;f=_[1]}return!0}_validateContent(n,o){return!(n&&(n.length!==4||n[0]<0||o.data.width<n[0]||n[1]<0||o.data.height<n[1]||n[2]<0||o.data.width<n[2]||n[3]<0||o.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,o,f){f.version=this.images[o][n].version+1,this.images[o][n]=f,this.updatedImages[o][n]=!0}removeImage(n,o){const f=this.images[o][n];delete this.images[o][n],delete this.patterns[o][n],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,o,f){let _=!0;const v=!!this.loaded[o];if(!v)for(const b of n)this.images[o][b]||(_=!1);v||_?this._notify(n,o,f):this.requestors.push({ids:n,scope:o,callback:f})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,o,f){const _={};for(const v of n){this.images[o][v]||this.fire(new a.x("styleimagemissing",{id:v}));const b=this.images[o][v];b?_[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(n){const{width:o,height:f}=this.atlasImage[n];return{width:o,height:f}}getPattern(n,o,f){const _=this.patterns[o][n],v=this.getImage(n,o);if(!v)return null;if(_&&_.position.version===v.version)return _.position;if(_)_.position.version=v.version;else{const b={w:v.data.width+2*a.y,h:v.data.height+2*a.y,x:0,y:0},P=new a.I(b,v,a.y);this.patterns[o][n]={bin:b,position:P}}return this._updatePatternAtlas(o,f),this.patterns[o][n].position}bind(n,o){const f=n.gl;let _=this.atlasTexture[o];_?this.dirty&&(_.update(this.atlasImage[o]),this.dirty=!1):(_=new a.T(n,this.atlasImage[o],f.RGBA8),this.atlasTexture[o]=_),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(n,o){const f=[];for(const P in this.patterns[n])f.push(this.patterns[n][P].bin);const{w:_,h:v}=a.z(f),b=this.atlasImage[n];b.resize({width:_||1,height:v||1});for(const P in this.patterns[n]){const{bin:D,position:B}=this.patterns[n][P];let F=B.padding;const U=D.x+F,q=D.y+F,$=this.images[n][P].data,ee=$.width,K=$.height;F=F>1?F-1:F,a.r.copy($,b,{x:0,y:0},{x:U,y:q},{width:ee,height:K},o),a.r.copy($,b,{x:0,y:K-F},{x:U,y:q-F},{width:ee,height:F},o),a.r.copy($,b,{x:0,y:0},{x:U,y:q+K},{width:ee,height:F},o),a.r.copy($,b,{x:ee-F,y:0},{x:U-F,y:q},{width:F,height:K},o),a.r.copy($,b,{x:0,y:0},{x:U+ee,y:q},{width:F,height:K},o),a.r.copy($,b,{x:ee-F,y:K-F},{x:U-F,y:q-F},{width:F,height:F},o),a.r.copy($,b,{x:0,y:K-F},{x:U+ee,y:q-F},{width:F,height:F},o),a.r.copy($,b,{x:0,y:0},{x:U+ee,y:q+K},{width:F,height:F},o),a.r.copy($,b,{x:ee-F,y:0},{x:U-F,y:q+K},{width:F,height:F},o)}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,o){for(const f of n){if(this.callbackDispatchedThisFrame[o][f])continue;this.callbackDispatchedThisFrame[o][f]=!0;const _=this.images[o][f];Lt(_)&&this.updateImage(f,o,_)}}}function Gr(d){const n=d.key,o=d.value,f=d.valueSpec||{},_=d.objectElementValidators||{},v=d.style,b=d.styleSpec;let P=[];const D=a.B(o);if(D!=="object")return[new a.V(n,o,`object expected, ${D} found`)];for(const B in o){const F=B.split(".")[0];let U;_[F]?U=_[F]:f[F]?U=Xn:_["*"]?U=_["*"]:f["*"]&&(U=Xn),U?P=P.concat(U({key:(n&&`${n}.`)+B,value:o[B],valueSpec:f[F]||f["*"],style:v,styleSpec:b,object:o,objectKey:B},o)):P.push(new a.A(n,o[B],`unknown property "${B}"`))}for(const B in f)_[B]||f[B].required&&f[B].default===void 0&&o[B]===void 0&&P.push(new a.V(n,o,`missing required property "${B}"`));return P}function io(d){const n=d.value,o=d.valueSpec,f=d.style,_=d.styleSpec,v=d.key,b=d.arrayElementValidator||Xn;if(a.B(n)!=="array")return[new a.V(v,n,`array expected, ${a.B(n)} found`)];if(o.length&&n.length!==o.length)return[new a.V(v,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new a.V(v,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let P={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};_.$version<7&&(P.function=o.function),a.B(o.value)==="object"&&(P=o.value);let D=[];for(let B=0;B<n.length;B++)D=D.concat(b({array:n,arrayIndex:B,value:n[B],valueSpec:P,style:f,styleSpec:_,key:`${v}[${B}]`},!0));return D}function pn(d){const n=d.key,o=d.value,f=d.valueSpec;let _=a.B(o);if(_==="number"&&o!=o&&(_="NaN"),_!=="number")return[new a.V(n,o,`number expected, ${_} found`)];if("minimum"in f){let v=f.minimum;if(a.B(f.minimum)==="array"&&(v=f.minimum[d.arrayIndex]),o<v)return[new a.V(n,o,`${o} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(a.B(f.maximum)==="array"&&(v=f.maximum[d.arrayIndex]),o>v)return[new a.V(n,o,`${o} is greater than the maximum value ${v}`)]}return[]}function Lr(d){const n=d.valueSpec,o=a.D(d.value.type);let f,_,v,b={};const P=o!=="categorical"&&d.value.property===void 0,D=!P,B=a.B(d.value.stops)==="array"&&a.B(d.value.stops[0])==="array"&&a.B(d.value.stops[0][0])==="object",F=Gr({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function($){if(o==="identity")return[new a.V($.key,$.value,'identity function may not have a "stops" property')];let ee=[];const K=$.value;return ee=ee.concat(io({key:$.key,value:K,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:U})),a.B(K)==="array"&&K.length===0&&ee.push(new a.V($.key,K,"array must have at least one stop")),ee},default:function($){return Xn({key:$.key,value:$.value,valueSpec:n,style:$.style,styleSpec:$.styleSpec})}}});return o==="identity"&&P&&F.push(new a.V(d.key,d.value,'missing required property "property"')),o==="identity"||d.value.stops||F.push(new a.V(d.key,d.value,'missing required property "stops"')),o==="exponential"&&d.valueSpec.expression&&!a.F(d.valueSpec)&&F.push(new a.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(D&&!a.G(d.valueSpec)?F.push(new a.V(d.key,d.value,"property functions not supported")):P&&!a.H(d.valueSpec)&&F.push(new a.V(d.key,d.value,"zoom functions not supported"))),o!=="categorical"&&!B||d.value.property!==void 0||F.push(new a.V(d.key,d.value,'"property" property is required')),F;function U($){let ee=[];const K=$.value,re=$.key;if(a.B(K)!=="array")return[new a.V(re,K,`array expected, ${a.B(K)} found`)];if(K.length!==2)return[new a.V(re,K,`array length 2 expected, length ${K.length} found`)];if(B){if(a.B(K[0])!=="object")return[new a.V(re,K,`object expected, ${a.B(K[0])} found`)];if(K[0].zoom===void 0)return[new a.V(re,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new a.V(re,K,"object stop key must have value")];const ie=a.D(K[0].zoom);if(typeof ie!="number")return[new a.V(re,K[0].zoom,"stop zoom values must be numbers")];if(v&&v>ie)return[new a.V(re,K[0].zoom,"stop zoom values must appear in ascending order")];ie!==v&&(v=ie,_=void 0,b={}),ee=ee.concat(Gr({key:`${re}[0]`,value:K[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:pn,value:q}}))}else ee=ee.concat(q({key:`${re}[0]`,value:K[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},K));return a.J(a.K(K[1]))?ee.concat([new a.V(`${re}[1]`,K[1],"expressions are not allowed in function stops.")]):ee.concat(Xn({key:`${re}[1]`,value:K[1],valueSpec:n,style:$.style,styleSpec:$.styleSpec}))}function q($,ee){const K=a.B($.value),re=a.D($.value),ie=$.value!==null?$.value:ee;if(f){if(K!==f)return[new a.V($.key,ie,`${K} stop domain type must match previous stop domain type ${f}`)]}else f=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new a.V($.key,ie,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&o!=="categorical"){let ae=`number expected, ${K} found`;return a.G(n)&&o===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V($.key,ie,ae)]}return o!=="categorical"||K!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?o!=="categorical"&&K==="number"&&typeof re=="number"&&typeof _=="number"&&_!==void 0&&re<_?[new a.V($.key,ie,"stop domain values must appear in ascending order")]:(_=re,o==="categorical"&&re in b?[new a.V($.key,ie,"stop domain values must be unique")]:(b[re]=!0,[])):[new a.V($.key,ie,`integer expected, found ${String(re)}`)]}}function si(d){const n=(d.expressionContext==="property"?a.L:a.M)(a.K(d.value),d.valueSpec);if(n.result==="error")return n.value.map(f=>new a.V(`${d.key}${f.key}`,d.value,f.message));const o=n.value.expression||n.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!o.outputDefined())return[new a.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!a.N(o))return[new a.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return _s(o,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!a.O(o,["zoom","feature-state"]))return[new a.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!a.Q(o))return[new a.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _s(d,n){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const _ of n.valueSpec.expression.parameters)o.delete(_);if(o.size===0)return[];const f=[];return d instanceof a.S&&o.has(d.name)?[new a.V(n.key,n.value,`["${d.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(d.eachChild(_=>{f.push(..._s(_,n))}),f)}function qo(d){const n=d.key,o=d.value,f=d.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(a.D(o))===-1&&_.push(new a.V(n,o,`expected one of [${f.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(f.values).indexOf(a.D(o))===-1&&_.push(new a.V(n,o,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(o)} found`)),_}function Sl(d){return a.W(a.K(d.value))?si(a.C({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):nn(d)}function nn(d){const n=d.value,o=d.key;if(a.B(n)!=="array")return[new a.V(o,n,`array expected, ${a.B(n)} found`)];const f=d.styleSpec;let _,v=[];if(n.length<1)return[new a.V(o,n,"filter array must have at least 1 element")];switch(v=v.concat(qo({key:`${o}[0]`,value:n[0],valueSpec:f.filter_operator,style:d.style,styleSpec:d.styleSpec})),a.D(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&a.D(n[1])==="$type"&&v.push(new a.V(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&v.push(new a.V(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=a.B(n[1]),_!=="string"&&v.push(new a.V(`${o}[1]`,n[1],`string expected, ${_} found`)));for(let b=2;b<n.length;b++)_=a.B(n[b]),a.D(n[1])==="$type"?v=v.concat(qo({key:`${o}[${b}]`,value:n[b],valueSpec:f.geometry_type,style:d.style,styleSpec:d.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new a.V(`${o}[${b}]`,n[b],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)v=v.concat(nn({key:`${o}[${b}]`,value:n[b],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":_=a.B(n[1]),n.length!==2?v.push(new a.V(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new a.V(`${o}[1]`,n[1],`string expected, ${_} found`))}return v}function fa(d,n){const o=d.key,f=d.style,_=d.layer,v=d.styleSpec,b=d.value,P=d.objectKey,D=v[`${n}_${d.layerType}`];if(!D)return[];const B=P.match(/^(.*)-transition$/);if(n==="paint"&&B&&D[B[1]]&&D[B[1]].transition)return Xn({key:o,value:b,valueSpec:v.transition,style:f,styleSpec:v});const F=d.valueSpec||D[P];if(!F)return[new a.A(o,b,`unknown property "${P}"`)];let U;if(a.B(b)==="string"&&a.G(F)&&!F.tokens&&(U=/^{([^}]+)}$/.exec(b))){const $=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new a.V(o,b,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const q=[];if(d.layerType==="symbol")P!=="text-field"||!f||f.glyphs||f.imports||q.push(new a.V(o,b,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&a.X(a.K(b))&&a.D(b.type)==="identity"&&q.push(new a.V(o,b,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&n==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&a.G(F)&&(a.Y(F)||a.H(F))){const $=a.L(a.K(b),F),ee=$.value.expression||$.value._styleExpression.expression;ee&&!a.O(ee,["measure-light"])&&(P==="model-emissive-strength"&&a.Q(ee)&&a.N(ee)||q.push(new a.V(o,b,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Xn({key:d.key,value:b,valueSpec:F,style:f,styleSpec:v,expressionContext:"property",propertyType:n,propertyKey:P}))}function jo(d){return fa(d,"paint")}function dr(d){return fa(d,"layout")}function ir(d){let n=[];const o=d.value,f=d.key,_=d.style,v=d.styleSpec;o.type||o.ref||n.push(new a.V(f,o,'either "type" or "ref" is required'));let b=a.D(o.type);const P=a.D(o.ref);if(o.id){const D=a.D(o.id);for(let B=0;B<d.arrayIndex;B++){const F=_.layers[B];a.D(F.id)===D&&n.push(new a.V(f,o.id,`duplicate layer id "${o.id}", previously used at line ${F.id.__line__}`))}}if("ref"in o){let D;["type","source","source-layer","filter","layout"].forEach(B=>{B in o&&n.push(new a.V(f,o[B],`"${B}" is prohibited for ref layers`))}),_.layers.forEach(B=>{a.D(B.id)===P&&(D=B)}),D?D.ref?n.push(new a.V(f,o.ref,"ref cannot reference another ref layer")):b=a.D(D.type):typeof P=="string"&&n.push(new a.V(f,o.ref,`ref layer "${P}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(o.source){const D=_.sources&&_.sources[o.source],B=D&&a.D(D.type);D?B==="vector"&&b==="raster"?n.push(new a.V(f,o.source,`layer "${o.id}" requires a raster source`)):B==="raster"&&b!=="raster"?n.push(new a.V(f,o.source,`layer "${o.id}" requires a vector source`)):B!=="vector"||o["source-layer"]?B==="raster-dem"&&b!=="hillshade"?n.push(new a.V(f,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):B!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||B==="geojson"&&D.lineMetrics?b==="raster-particle"&&B!=="raster-array"&&n.push(new a.V(f,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):n.push(new a.V(f,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new a.V(f,o.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new a.V(f,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new a.V(f,o.source,`source "${o.source}" not found`))}else n.push(new a.V(f,o,'missing required property "source"'));return n=n.concat(Gr({key:f,value:o,valueSpec:v.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xn({key:`${f}.type`,value:o.type,valueSpec:v.layer.type,style:d.style,styleSpec:d.styleSpec,object:o,objectKey:"type"}),filter:D=>Sl(a.C({layerType:b},D)),layout:D=>Gr({layer:o,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":B=>dr(a.C({layerType:b},B))}}),paint:D=>Gr({layer:o,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":B=>jo(a.C({layerType:b,layer:o},B))}})}})),n}function Rt(d){const n=d.value,o=d.key,f=a.B(n);return f!=="string"?[new a.V(o,n,`string expected, ${f} found`)]:[]}const Fs={promoteId:function({key:d,value:n}){if(a.B(n)==="string")return Rt({key:d,value:n});{const o=[];for(const f in n)o.push(...Rt({key:`${d}.${f}`,value:n[f]}));return o}}};function So(d){const n=d.value,o=d.key,f=d.styleSpec,_=d.style;if(!n.type)return[new a.V(o,n,'"type" is required')];const v=a.D(n.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(n.url||n.tiles||b.push(new a.A(o,n,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Gr({key:o,value:n,valueSpec:f[`source_${v.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:Fs})),b;case"geojson":if(b=Gr({key:o,value:n,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Fs}),n.cluster)for(const P in n.clusterProperties){const[D,B]=n.clusterProperties[P],F=typeof D=="string"?[D,["accumulated"],["get",P]]:D;b.push(...si({key:`${o}.${P}.map`,value:B,expressionContext:"cluster-map"})),b.push(...si({key:`${o}.${P}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return b;case"video":return Gr({key:o,value:n,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return Gr({key:o,value:n,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new a.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qo({key:`${o}.type`,value:n.type,valueSpec:{values:jn(f)},style:_,styleSpec:f})}}function jn(d){return d.source.reduce((n,o)=>{const f=d[o];return f.type.type==="enum"&&(n=n.concat(Object.keys(f.type.values))),n},[])}function fr(d){const n=d.value,o=d.styleSpec,f=o.light,_=d.style;let v=[];const b=a.B(n);if(n===void 0)return v;if(b!=="object")return v=v.concat([new a.V("light",n,`object expected, ${b} found`)]),v;for(const P in n){const D=P.match(/^(.*)-transition$/);v=v.concat(D&&f[D[1]]&&f[D[1]].transition?Xn({key:P,value:n[P],valueSpec:o.transition,style:_,styleSpec:o}):f[P]?Xn({key:P,value:n[P],valueSpec:f[P],style:_,styleSpec:o}):[new a.V(P,n[P],`unknown property "${P}"`)])}return v}function Ms(d){const n=d.value;let o=[];if(!n)return o;const f=a.B(n);if(f!=="object")return o=o.concat([new a.V("light-3d",n,`object expected, ${f} found`)]),o;const _=d.styleSpec,v=_["light-3d"],b=d.key,P=d.style,D=d.style.lights;for(const U of["type","id"])if(!(U in n))return o=o.concat([new a.V("light-3d",n,`missing property ${U} on light`)]),o;if(n.type&&D)for(let U=0;U<d.arrayIndex;U++){const q=a.D(n.type),$=D[U];a.D($.type)===q&&o.push(new a.V(b,n.id,`duplicate light type "${n.type}", previously defined at line ${$.id.__line__}`))}const B=`properties_light_${n.type}`;if(!(B in _))return o=o.concat([new a.V("light-3d",n,`Invalid light type ${n.type}`)]),o;const F=_[B];for(const U in n)if(U==="properties"){const q=n[U],$=a.B(q);if($!=="object")return o=o.concat([new a.V("properties",q,`object expected, ${$} found`)]),o;for(const ee in q)o=o.concat(F[ee]?Xn({key:ee,value:q[ee],valueSpec:F[ee],style:P,styleSpec:_}):[new a.A(d.key,q[ee],`unknown property "${ee}"`)])}else{const q=U.match(/^(.*)-transition$/);o=o.concat(q&&v[q[1]]&&v[q[1]].transition?Xn({key:U,value:n[U],valueSpec:_.transition,style:P,styleSpec:_}):v[U]?Xn({key:U,value:n[U],valueSpec:v[U],style:P,styleSpec:_}):[new a.A(U,n[U],`unknown property "${U}"`)])}return o}function Za(d){const n=d.value,o=d.key,f=d.style,_=d.styleSpec,v=_.terrain;let b=[];const P=a.B(n);if(n===void 0||P==="null")return b;if(P!=="object")return b=b.concat([new a.V("terrain",n,`object expected, ${P} found`)]),b;for(const D in n){const B=D.match(/^(.*)-transition$/);b=b.concat(B&&v[B[1]]&&v[B[1]].transition?Xn({key:D,value:n[D],valueSpec:_.transition,style:f,styleSpec:_}):v[D]?Xn({key:D,value:n[D],valueSpec:v[D],style:f,styleSpec:_}):[new a.A(D,n[D],`unknown property "${D}"`)])}if(n.source){const D=f.sources&&f.sources[n.source],B=D&&a.D(D.type);D?B!=="raster-dem"&&b.push(new a.V(o,n.source,`terrain cannot be used with a source of type ${String(B)}, it only be used with a "raster-dem" source type`)):b.push(new a.V(o,n.source,`source "${n.source}" not found`))}else b.push(new a.V(o,n,'terrain is missing required property "source"'));return b}function ro(d){const n=d.value,o=d.style,f=d.styleSpec,_=f.fog;let v=[];const b=a.B(n);if(n===void 0)return v;if(b!=="object")return v=v.concat([new a.V("fog",n,`object expected, ${b} found`)]),v;for(const P in n){const D=P.match(/^(.*)-transition$/);v=v.concat(D&&_[D[1]]&&_[D[1]].transition?Xn({key:P,value:n[P],valueSpec:f.transition,style:o,styleSpec:f}):_[P]?Xn({key:P,value:n[P],valueSpec:_[P],style:o,styleSpec:f}):[new a.A(P,n[P],`unknown property "${P}"`)])}return v}const qu={"*":()=>[],array:io,boolean:function(d){const n=d.value,o=d.key,f=a.B(n);return f!=="boolean"?[new a.V(o,n,`boolean expected, ${f} found`)]:[]},number:pn,color:function(d){const n=d.key,o=d.value,f=a.B(o);return f!=="string"?[new a.V(n,o,`color expected, ${f} found`)]:a.U.parseCSSColor(o)===null?[new a.V(n,o,`color expected, "${o}" found`)]:[]},enum:qo,filter:Sl,function:Lr,layer:ir,object:Gr,source:So,model:a.Z,light:fr,"light-3d":Ms,terrain:Za,fog:ro,string:Rt,formatted:function(d){return Rt(d).length===0?[]:si(d)},resolvedImage:function(d){return Rt(d).length===0?[]:si(d)},projection:function(d){const n=d.value,o=d.styleSpec,f=o.projection,_=d.style;let v=[];const b=a.B(n);if(b==="object")for(const P in n)v=v.concat(Xn({key:P,value:n[P],valueSpec:f[P],style:_,styleSpec:o}));else b!=="string"&&(v=v.concat([new a.V("projection",n,`object or string expected, ${b} found`)]));return v},import:function(d){const{value:n,styleSpec:o}=d,{data:f,..._}=n;Object.defineProperty(_,"__line__",{value:n.__line__,enumerable:!1});let v=Gr(a.C({},d,{value:_,valueSpec:o.import}));return a.D(_.id)===""&&v.push(new a.V(`${d.key}.id`,_,"import id can't be an empty string")),f&&(v=v.concat(Ic(f,o,{key:`${d.key}.data`}))),v}};function Xn(d,n=!1){const o=d.value,f=d.valueSpec,_=d.styleSpec;if(f.expression&&a.X(a.D(o)))return Lr(d);if(f.expression&&a.J(a.K(o)))return si(d);if(f.type&&qu[f.type]){const v=qu[f.type](d);return n===!0&&v.length>0&&a.B(d.value)==="array"?si(d):v}return Gr(a.C({},d,{valueSpec:f.type?_[f.type]:f}))}function Ho(d){const n=d.value,o=d.key,f=Rt(d);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new a.V(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new a.V(o,n,'"glyphs" url must include a "{range}" token'))),f}function Ic(d,n=a._,o={}){return Xn({key:o.key||"",value:d,valueSpec:n.$root,styleSpec:n,style:d,objectElementValidators:{glyphs:Ho,"*":()=>[]}})}function Ws(d,n=a._){return Ce(Ic(d,n))}const Rr=d=>Ce(So(d)),Yi=d=>Ce(fr(d)),Fn=d=>Ce(Ms(d)),pa=d=>Ce(Za(d)),Fi=d=>Ce(ro(d)),Ke=d=>Ce(ir(d)),ne=d=>Ce(Sl(d)),oe=d=>Ce(jo(d)),ge=d=>Ce(dr(d)),Oe=d=>Ce(a.Z(d));function Ce(d){return d.slice().sort((n,o)=>n.line&&o.line?n.line-o.line:0)}function qe(d,n){let o=!1;if(n&&n.length)for(const f of n)f instanceof a.A?a.w(f.message):(d.fire(new a.t(new Error(f.message))),o=!0);return o}let tt;class We extends a.E{constructor(n,o="flat"){super(),this._transitionable=new a.$(tt||(tt=new a.a0({anchor:new a.a1(a._.light.anchor),position:new a.a2(a._.light.position),color:new a.a1(a._.light.color),intensity:new a.a1(a._.light.intensity)}))),this.setLight(n,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,o,f={}){this._validate(Yi,n,f)||(this._transitionable.setTransitionOrValue(n),this.id=o)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&qe(this,n.call(Ws,a.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a._})))}}let nt=class extends a.E{constructor(d,n,o,f){super(),this.scope=o,this._transitionable=new a.$(new a.a0({source:new a.a1(a._.terrain.source),exaggeration:new a.a1(a._.terrain.exaggeration)}),o,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(d,n){this._transitionable.setTransitionOrValue(d,n)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new a.a3(d)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const n=d.value.expression;if(!n)return null;let o=-1,f=-1,_=1;for(const v of n.zoomStops)_=n.evaluate(new a.a3(v)),_>.01?(o=v,f=-1):f=v;return _<.01&&o>0&&f>o?[o,f]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof a.a4}};const st=45,lt=65,Tt=.05;function Vt(d,n,o,f){const _=a.a7(st,lt,o),[v,b]=Xt(d,f);let P=1-Math.min(1,Math.exp((n-v)/(b-v)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*_*d.alpha}function Xt(d,n){const o=.5/Math.tan(.5*n);return[d.range[0]+o,d.range[1]+o]}function yn(d,n,o,f,_){const v=a.a6.vec3.transformMat4([],[n,o,f],_.mercatorFogMatrix);return Vt(d,a.a6.vec3.length(v),_.pitch,_._fov)}function En(d,n,o,f,_,v,b){const P=[[o,f,0],[_,f,0],[_,v,0],[o,v,0]];let D=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const F of P){const U=a.a6.vec3.transformMat4([],F,n),q=a.a6.vec3.length(U);D=Math.min(D,q),B=Math.max(B,q)}return[Vt(d,D,b.pitch,b._fov),Vt(d,B,b.pitch,b._fov)]}class In extends a.E{constructor(n,o,f,_){super();const v=new a.a0({range:new a.a1(a._.fog.range),color:new a.a1(a._.fog.color),"high-color":new a.a1(a._.fog["high-color"]),"space-color":new a.a1(a._.fog["space-color"]),"horizon-blend":new a.a1(a._.fog["horizon-blend"]),"star-intensity":new a.a1(a._.fog["star-intensity"]),"vertical-range":new a.a1(a._.fog["vertical-range"])});this._transitionable=new a.$(v,f,new Map(_)),this.set(n,_),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new a.a8(v),this.scope=f}get state(){const n=this._transform,o=n.projection.name==="globe",f=a.a9(n.zoom),_=this.properties.get("range"),v=[.5,3];return{range:o?[a.aa(v[0],_[0],f),a.aa(v[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,o,f={}){if(this._validate(Fi,n,f))return;const _=a.l({},n);for(const v of Object.keys(a._.fog))_[v]===void 0&&(_[v]=a._.fog[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.a7(st,lt,n))*o.a}getOpacityAtLatLng(n,o){return this._transform.projection.supportsFog?function(f,_,v){const b=a.a5.fromLngLat(_),P=v.elevation?v.elevation.getAtPointOrZero(b):0;return yn(f,b.x,b.y,P,v)}(this.state,n,o):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(n.toUnwrapped());return En(this.state,o,0,0,a.ab,a.ab,this._transform)}getOpacityForBounds(n,o,f,_,v){return this._transform.projection.supportsFog?En(this.state,n,o,f,_,v,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Xt(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const f of o){const _=n.points[f];let v;if(_[2]>=0)v=_;else{const b=n.points[f-4];v=a.ac(b,_,b[2]/(b[2]-_[2]))}if(yn(this.state,v[0],v[1],0,this._transform)>=Tt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&qe(this,n.call(Ws,a.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a._})))}}class vn extends a.E{constructor(n,o,f,_){super(),this.scope=f,this._options=n,this.properties=new a.a8(o),this._transitionable=new a.$(o,f,new Map(_)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,o){this._options=n,this._transitionable.setTransitionOrValue(n.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let ui,Yn;class Dn{constructor(n,o,f,_){this.screenBounds=n,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,o){let f,_;if(n instanceof a.P||typeof n[0]=="number"){const v=a.P.convert(n);f=[v],_=o.isPointAboveHorizon(v)}else{const v=a.P.convert(n[0]),b=a.P.convert(n[1]);f=[v,b],_=a.ae(v,b).every(P=>o.isPointAboveHorizon(P))}return new Dn(f,o.getCameraPoint(),_,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return a.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ae(o,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(_[3]=this.cameraPoint)),a.af(_,n)}bufferedCameraGeometryGlobe(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ae(o,f,n),v=this.cameraPoint.clone();switch(3*((v.y>o.y)+(v.y>f.y))+((v.x>o.x)+(v.x>f.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(n,o,f,_=0){const v=n.queryPadding/o._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(v,o):this._bufferedScreenMercator(v,o);let P=n.tileID.wrap+(b.unwrapped?_:0);const D=b.polygon.map(re=>a.ag(n.tileTransform,re,P));if(!a.ah(D,0,0,a.ab,a.ab))return;P=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const B=this.screenGeometryMercator.polygon.map(re=>a.ai(n.tileTransform,re,P)),F=B.map(re=>new a.P(re[0],re[1])),U=o.getFreeCameraOptions().position||new a.a5(0,0,0),q=a.ai(n.tileTransform,U,P),$=B.map(re=>{const ie=a.a6.vec3.sub(re,re,q);return a.a6.vec3.normalize(ie,ie),new a.aj(q,ie)}),ee=a.ak(n,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:$,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(K=a.al(D),K.min.x=a.ap(K.min.x,0,a.ab),K.min.y=a.ap(K.min.y,0,a.ab),K.max.x=a.ap(K.max.x,0,a.ab),K.max.y=a.ap(K.max.y,0,a.ab),K),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:ee};var K}_bufferedScreenMercator(n,o){const f=vr(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),o):{polygon:this.bufferedScreenGeometry(n).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(n,o){const f=vr(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),o):{polygon:this.bufferedCameraGeometry(n).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(n,o){const f=function(v,b){const P=a.a6.mat4.multiply([],b.pixelMatrix,b.globeMatrix),D=[0,-a.aq,0,1],B=[0,a.aq,0,1],F=[0,0,0,1];a.a6.vec4.transformMat4(D,D,P),a.a6.vec4.transformMat4(B,B,P),a.a6.vec4.transformMat4(F,F,P);const U=new a.P(D[0]/D[3],D[1]/D[3]),q=new a.P(B[0]/B[3],B[1]/B[3]),$=a.an(v,U)&&D[3]<F[3],ee=a.an(v,q)&&B[3]<F[3];if(!$&&!ee)return null;const K=function(we,Ie,Re){for(let Be=1;Be<we.length;Be++){const Ne=ki(Ie.pointCoordinate3D(we[Be-1]).x),De=ki(Ie.pointCoordinate3D(we[Be]).x);if(Re<0){if(Ne<De)return{idx:Be,t:-Ne/(De-1-Ne)}}else if(De<Ne)return{idx:Be,t:(1-Ne)/(De+1-Ne)}}return null}(v,b,$?-1:1);if(!K)return null;const{idx:re,t:ie}=K;let ae=re>1?bi(v.slice(0,re),b):[],de=re<v.length?bi(v.slice(re),b):[];ae=ae.map(we=>new a.P(ki(we.x),we.y)),de=de.map(we=>new a.P(ki(we.x),we.y));const fe=[...ae];fe.length===0&&fe.push(de[de.length-1]);const be=a.aa(fe[fe.length-1].y,(de.length===0?ae[0]:de[0]).y,ie);let Ee;return Ee=$?[new a.P(0,be),new a.P(0,0),new a.P(1,0),new a.P(1,be)]:[new a.P(1,be),new a.P(1,1),new a.P(0,1),new a.P(0,be)],fe.push(...Ee),de.length===0?fe.push(ae[0]):fe.push(...de),{polygon:fe.map(we=>new a.a5(we.x,we.y)),unwrapped:!1}}(n,o);if(f)return f;const _=function(v,b){let P=!1,D=-1/0,B=0;for(let U=0;U<v.length-1;U++)v[U].x>D&&(D=v[U].x,B=U);for(let U=0;U<v.length-1;U++){const q=(B+U)%(v.length-1),$=v[q],ee=v[q+1];Math.abs($.x-ee.x)>.5&&($.x<ee.x?($.x+=1,q===0&&(v[v.length-1].x+=1)):(ee.x+=1,q+1===v.length-1&&(v[0].x+=1)),P=!0)}const F=a.am(b.center.lng);return P&&F<Math.abs(F-1)&&v.forEach(U=>{U.x-=1}),{polygon:v,unwrapped:P}}(bi(n,o).map(v=>new a.P(ki(v.x),v.y)),o);return{polygon:_.polygon.map(v=>new a.a5(v.x,v.y)),unwrapped:_.unwrapped}}}function bi(d,n){return a.ao(d,o=>{const f=n.pointCoordinate3D(o);o.x=f.x,o.y=f.y},1/256)}function ki(d){return d<0?1+d%1:d%1}function vr(d){return 100*d|0}function ts(d,n,o,f,_){const v=function(P,D){if(P)return _(P);if(D){if(d.url&&D.tiles&&d.tiles&&delete d.tiles,D.variants){if(!Array.isArray(D.variants))return _(new Error("variants must be an array"));for(const F of D.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return _(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){D=a.l(D,F);break}}}const B=a.ar(a.l({},D,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);B.tiles=n.canonicalizeTileset(B,d.url),_(null,B)}},b=function(P,D,B){if(!P)return null;if(!D&&!B)return P;B=B||P.worldview_default;const F=Object.values(P.language||{});if(F.length===0)return null;const U=Object.values(P.worldview||{});if(U.length===0)return null;const q=F.every(ee=>ee===D),$=U.every(ee=>ee===B);return q&&$?P:D in(P.language_options||{})||B in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(d.data,o,f);return b?a.q.frame(()=>v(null,b)):d.url?a.n(n.transformRequest(n.normalizeSourceURL(d.url,null,o,f),a.R.Source),v):a.q.frame(()=>{const{data:P,...D}=d;v(null,D)})}class xr{constructor(n,o,f){this.bounds=a.as.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const o=Math.pow(2,n.z),f=Math.floor(a.am(this.bounds.getWest())*o),_=Math.floor(a.at(this.bounds.getNorth())*o),v=Math.ceil(a.am(this.bounds.getEast())*o),b=Math.ceil(a.at(this.bounds.getSouth())*o);return n.x>=f&&n.x<v&&n.y>=_&&n.y<b}}class Ji extends a.E{constructor(n,o,f,_){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.l(this,a.ar(o,["url","scheme","tileSize","promoteId"])),this._options=a.l({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new a.au}load(n){this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=ts(this._options,this.map._requestManager,o,f,(_,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new a.t(_));else if(v){if(a.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of v.vector_layers)this.vectorLayerIds.push(b.id),v.worldview&&v.worldview[b.source]&&this.localizableLayerIds.add(b.id)}v.bounds&&(this.tileBounds=new xr(v.bounds,this.minzoom,this.maxzoom)),hr(v.tiles,this.map._requestManager._customAccessToken),this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))}n&&n(_)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=a.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return a.l({},this._options)}loadTile(n,o){const f=n.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),v=this.map._requestManager.transformRequest(_,a.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,P=b?{image:b.image.clone()}:null,D={request:v,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&a.f(f)&&(D.worldview=this.map.getWorldview()||this.worldviewDefault,D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=o:n.request=n.actor.send("reloadTile",D,B.bind(this));else if(n.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",D,B.bind(this),void 0,!0);else{const F=a.aw.call({deduped:this._deduped},D,(U,q)=>{U||!q?B.call(this,U):(D.data={cacheControl:q.cacheControl,expires:q.expires,rawData:q.rawData.slice(0)},n.actor&&n.actor.send("loadTile",D,B.bind(this),void 0,!0))},!0);n.request={cancel:F}}function B(F,U){return delete n.request,n.aborted?o(null):F&&F.status!==404?o(F):(U&&U.resourceTiming&&(n.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&n.setExpiryData(U),n.loadVectorData(U,this.map.painter),a.ax(this.dispatcher),o(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,o){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class oi extends a.E{constructor(n,o,f,_){super(),this.id=n,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.l({type:"raster"},o),a.l(this,a.ar(o,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"})),this._tileJSONRequest=ts(this._options,this.map._requestManager,null,null,(o,f)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new a.t(o)):f&&(a.l(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),f.bounds&&(this.tileBounds=new xr(f.bounds,this.minzoom,this.maxzoom)),hr(f.tiles),this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))),n&&n(o)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=a.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return a.l({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,o){const f=a.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=a.o(this.map._requestManager.transformRequest(_,a.R.Tile),(v,b,P,D)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):v?(n.state="errored",o(v)):b?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:P,expires:D}),n.setTexture(b,this.map.painter),n.state="loaded",a.ax(this.dispatcher),void o(null)):o(null)))}abortTile(n,o){n.request&&(n.request.cancel(),delete n.request),o&&o()}unloadTile(n,o){n.texture&&n.texture instanceof a.T?(n.destroy(!0),n.texture&&n.texture instanceof a.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dr extends oi{constructor(n,o,f,_){super(n,o,f,_),this.type="raster-array",this.maxzoom=22,this._options=a.l({type:"raster-array"},o)}triggerRepaint(n){const o=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);o&&o.enabled&&f&&o._clearRenderCacheForTile(f.id,n.tileID),this.map.triggerRepaint()}loadTile(n,o){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,a.R.Tile);n.requestParams=_,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(v,b,P,D)=>{if(delete n.request,n.aborted)return n.state="unloaded",o(null);if(v)return v.code===20?void 0:(n.state="errored",o(v));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:P,expires:D}),n.state="empty",o(null)})}unloadTile(n,o){const f=n.texture;f&&f instanceof a.T?(n.destroy(!0),this.map.painter.saveTileTexture(f)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,o,f){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(o,f,(_,v)=>{if(_)return n.state="errored",this.fire(new a.t(_)),void this.triggerRepaint(n);v&&(n.setTexture(v,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:v})=>v===n),f=o&&o.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(n,o,f){if(!n)return;const _=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let v=null;o instanceof a.aB?v=o.paint.get("raster-array-band"):o instanceof a.aC&&(v=o.paint.get("raster-particle-array-band"));const b=v||this.getInitialBand(_);if(b!=null)if(n.textureDescriptor){if(!n.updateNeeded(_,b)||f)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,_,b)}}const Zn={vector:Ji,raster:oi,"raster-dem":class extends oi{constructor(d,n,o,f){super(d,n,o,f),this.type="raster-dem",this.maxzoom=22,this._options=a.l({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,v){_&&(d.state="errored",n(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=a.o(this.map._requestManager.transformRequest(o,a.R.Tile),(function(_,v,b,P){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(_)d.state="errored",n(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:b,expires:P});const D=ImageBitmap&&v instanceof ImageBitmap&&a.ay(),B=1-(v.width-a.az(v.width))/2;B<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const F=D?v:a.q.getImageData(v,B),U={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:B};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",U,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const n=d.canonical,o=Math.pow(2,n.z),f=(n.x-1+o)%o,_=n.x===0?d.wrap-1:d.wrap,v=(n.x+1+o)%o,b=n.x+1===o?d.wrap+1:d.wrap,P={};return P[new a.aA(d.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},P[new a.aA(d.overscaledZ,b,n.z,v,n.y).key]={backfilled:!1},n.y>0&&(P[new a.aA(d.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1},P[new a.aA(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},P[new a.aA(d.overscaledZ,b,n.z,v,n.y-1).key]={backfilled:!1}),n.y+1<o&&(P[new a.aA(d.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1},P[new a.aA(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},P[new a.aA(d.overscaledZ,b,n.z,v,n.y+1).key]={backfilled:!1}),P}},"raster-array":Dr,geojson:class extends a.E{constructor(d,n,o,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(f),this._data=n.data,this._options=a.l({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=a.ab/this.tileSize;this.workerOptions=a.l({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:a.ab,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.ab,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new a.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new a.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const o of this._data.features)n.set(o.id,o);for(const o of d.features)n.set(o.id,o);this._data.features=[...n.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterLeaves(d,n,o,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:n,offset:o},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.x("dataloading",{dataType:"source"})),this._loaded=!1;const n=a.l({append:d},this.workerOptions);n.scope=this.scope;const o=this._data;typeof o=="string"?(n.request=this.map._requestManager.transformRequest(a.q.resolveURL(o),a.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new a.t(f));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new a.x("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const o=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,v=this._partialReload,b={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};d.request=this.actor.send(o,b,(P,D)=>v&&!D?(d.state="loaded",n(null)):(delete d.request,d.destroy(),d.aborted?n(null):P?n(P):(d.loadVectorData(D,this.map.painter,o==="reloadTile"),n(null))),void 0,o==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,n){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aD{constructor(d,n,o,f){super(d,n,o,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.R.Source).url);a.aE(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new a.t(n)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new a.t(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(d,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aD,model:class extends a.E{constructor(d,n,o,f){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const d=[];for(const n in this._options.models){const o=this._options.models[n],f=a.aG(this.map._requestManager.transformRequest(o.uri,a.R.Model).url).then(_=>{if(!_)return;const v=a.aH(_),b=new a.aI(n,o.position,o.orientation,v);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(_=>{this.fire(new a.t(new Error(`Could not load model ${n} from ${o.uri}: ${_.message}`)))});d.push(f)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new a.t(new Error(`Could not load models: ${n.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,n){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(d,n,o,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=ts(this._options,this.map._requestManager,n,o,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new a.t(f))):_&&(a.l(this,_),_.bounds&&(this.tileBounds=new xr(_.bounds,this.minzoom,this.maxzoom)),hr(_.tiles,this.map._requestManager._customAccessToken),this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,n){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(o,a.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=n;else{if(d.buckets){const v=Object.values(d.buckets);for(const b of v)b.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,_.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(v,b){return d.aborted?n(null):v&&v.status!==404?n(v):(this.map._refreshExpiredTiles&&b&&d.setExpiryData(b),d.loadModelData(b,this.map.painter),d.state="loaded",void n(null))}}serialize(){return a.l({},this._options)}},canvas:class extends a.aD{constructor(d,n,o,f){super(d,n,o,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new a.t(new a.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.t(new a.V(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.t(new a.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.t(new a.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.t(new a.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof a.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends a.E{constructor(d,n,o,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xr(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),a.l(this,a.ar(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:o,z:f}=d.canonical;return this._implementation.hasTile({x:n,y:o,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:o,y:f,z:_}=d.tileID.canonical,v=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:o,y:f,z:_},{signal:v.signal})).then((function(b){return delete d.request,d.aborted?(d.state="unloaded",n(null)):b===void 0?(d.state="errored",n(null)):b===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(b)?(this.loadTileData(d,b),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(d.state="errored",n(b))}),d.request.cancel=()=>v.abort()}loadTileData(d,n){d.setTexture(n,this.map.painter)}unloadTile(d,n){if(d.texture&&d.texture instanceof a.T?(d.destroy(!0),d.texture&&d.texture instanceof a.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:o,y:f,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:o,y:f,z:_})}n&&n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=a.av(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))}}},uu=function(d,n,o,f){const _=new Zn[n.type](d,n,o,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return a.aJ(["load","abort","unload","serialize","prepare"],_),_};function Er(d,n){const o=a.a6.mat4.identity([]);return a.a6.mat4.scale(o,o,[.5*d.width,.5*-d.height,1]),a.a6.mat4.translate(o,o,[1,-1,0]),a.a6.mat4.multiply(o,o,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(o)}function Si(d,n,o,f,_,v,b,P,D=!1){const B=d.tilesIn(o,P,D);B.sort(so);const F=[];for(const q of B)F.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(n,d._state,q,f,_,v,b,Er(d.transform,q.tile.tileID),D)});const U=function(q){const $={},ee={};for(const K of q){const re=K.queryResults,ie=K.wrappedTileID,ae=ee[ie]=ee[ie]||{};for(const de in re){const fe=re[de],be=ae[de]=ae[de]||{},Ee=$[de]=$[de]||[];for(const we of fe)be[we.featureIndex]||(be[we.featureIndex]=!0,Ee.push(we))}}return $}(F);for(const q in U)U[q].forEach($=>{const ee=$.feature,K=ee.layer;K&&K.type!=="background"&&K.type!=="sky"&&K.type!=="slot"&&(a.aK(q)||(ee.source=K.source,K["source-layer"]&&(ee.sourceLayer=K["source-layer"])),ee.state=ee.id!==void 0?d.getFeatureState(K["source-layer"],ee.id):{})});return U}function pr(d,n){const o=d.getRenderableIds().map(v=>d.getTileByID(v)),f=[],_={};for(let v=0;v<o.length;v++){const b=o[v],P=b.tileID.canonical.key;_[P]||(_[P]=!0,b.querySourceFeatures(f,n))}return f}function so(d,n){const o=d.tileID,f=n.tileID;return o.overscaledZ-f.overscaledZ||o.canonical.y-f.canonical.y||o.wrap-f.wrap||o.canonical.x-f.canonical.x}function oo(d,n){const o={};if(!n)return o;for(const f of d){const _=f.layerIds.map(v=>n.getLayer(v)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(v=>_.filter(b=>b.id===v)[0]));for(const v of _)o[v.fqid]=f}}return o}const zt=32,Sn=33,Jn=new Uint16Array(8184);for(let d=0;d<2046;d++){let n=d+2,o=0,f=0,_=0,v=0,b=0,P=0;for(1&n?_=v=b=zt:o=f=P=zt;(n>>=1)>1;){const B=o+_>>1,F=f+v>>1;1&n?(_=o,v=f,o=b,f=P):(o=_,f=v,_=b,v=P),b=B,P=F}const D=4*d;Jn[D+0]=o,Jn[D+1]=f,Jn[D+2]=_,Jn[D+3]=v}const mr=new Uint16Array(2178),$s=new Uint8Array(1089),Ir=new Uint16Array(1089);function Wa(d){return d===0?-.03125:d===32?.03125:0}const ao={type:2,extent:a.ab,loadGeometry:()=>[[new a.P(0,0),new a.P(a.ab+1,0),new a.P(a.ab+1,a.ab+1),new a.P(0,a.ab+1),new a.P(0,0)]]};class As{constructor(n,o,f,_,v){this.tileID=n,this.uid=a.aQ(),this.uses=0,this.tileSize=o,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<a.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,f){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=oo(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof a.aS){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof a.aS&&v.hasRTLText){this.hasRTLText=!0,a.aT();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_],b=o.style.getOwnLayer(_);if(!b)continue;const P=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,P)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new a.aR}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,o,f){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets={...this.buckets,...oo(n.buckets,o.style)},n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const _ in this.buckets){const v=this.buckets[_];v.uploadPending()&&v.upload(n)}const o=n.gl,f=this.imageAtlas;if(f&&!f.uploaded){const _=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new a.T(n,f.image,o.RGBA8,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(n,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(n,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(n,o,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,f),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=o.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(o)))}queryRenderedFeatures(n,o,f,_,v,b,P,D,B){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:D,transform:P,filter:_,layers:v,availableImages:b,tileTransform:this.tileTransform},n,o):{}}querySourceFeatures(n,o){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),v=o?o.sourceLayer:"",b=_._geojsonTileLayer||_[v];if(!b)return;const P=a.aU(o&&o.filter),{z:D,x:B,y:F}=this.tileID.canonical,U={z:D,x:B,y:F};for(let q=0;q<b.length;q++){const $=b.feature(q);if(P.needGeometry){const re=a.aV($,!0);if(!P.filter(new a.a3(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!P.filter(new a.a3(this.tileID.overscaledZ),$))continue;const ee=f.getId($,v),K=new a.aW($,D,B,F,ee);K.tile=U,n.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const f=a.aX(n.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{const v=this.expirationTime-o;v?this.expirationTime=f+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n){if(!this.latestFeatureIndex)return;const o=this.latestFeatureIndex.loadVTLayers(),f=n.style.listImages(),_=n.style.getBrightness();for(const v in this.buckets){if(!n.style.hasLayer(v))continue;const b=this.buckets[v],P=b.layers[0],D=P.sourceLayer||"_geojsonTileLayer",B=o[D],F=n.style.getSourceCache(P.source,P.scope);let U={};F&&(U=F._state.getState(D,void 0)),b.update(U,B,f,this.imageAtlas&&this.imageAtlas.patternPositions||{},_),(b instanceof a.aY||b instanceof a.aZ)&&n._terrain&&n._terrain.enabled&&F&&b.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(F.id,this.tileID);const q=n&&n.style&&n.style.getOwnLayer(v);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=a.q.now()+n}setTexture(n,o){const f=o.context,_=f.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof a.T?this.texture.update(n):(this.texture=new a.T(f,n,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(n,o){const f={};for(const _ of o)f[_]=!0;this.dependencies[n]=f}hasDependency(n,o){for(const f of n){const _=this.dependencies[f];if(_){for(const v of o)if(_[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const f=a.a_(ao,this.tileID.canonical,this.tileTransform)[0],_=new a.a$,v=new a.b0;for(let b=0;b<f.length;b++){const{x:P,y:D}=f[b];_.emplaceBack(P,D),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(v),this._tileDebugBuffer=n.createVertexBuffer(_,a.b1.members),this._tileDebugSegments=a.b2.simpleSegment(0,0,_.length,v.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const f=a.a_(ao,this.tileID.canonical,this.tileTransform)[0];let _,v;if(this.isRaster){const b=function(P,D){const B=a.aL(P,D),F=Math.pow(2,P.z);for(let re=0;re<Sn;re++)for(let ie=0;ie<Sn;ie++){const ae=a.aM((P.x+(ie+Wa(ie))/zt)/F),de=a.aN((P.y+(re+Wa(re))/zt)/F),fe=D.project(ae,de),be=re*Sn+ie;mr[2*be+0]=Math.round((fe.x*B.scale-B.x)*a.ab),mr[2*be+1]=Math.round((fe.y*B.scale-B.y)*a.ab)}$s.fill(0),Ir.fill(0);for(let re=2045;re>=0;re--){const ie=4*re,ae=Jn[ie+0],de=Jn[ie+1],fe=Jn[ie+2],be=Jn[ie+3],Ee=ae+fe>>1,we=de+be>>1,Ie=Ee+we-de,Re=we+ae-Ee,Be=de*Sn+ae,Ne=be*Sn+fe,De=we*Sn+Ee,Je=Math.hypot((mr[2*Be+0]+mr[2*Ne+0])/2-mr[2*De+0],(mr[2*Be+1]+mr[2*Ne+1])/2-mr[2*De+1])>=16;$s[De]=$s[De]||(Je?1:0),re<1022&&($s[De]=$s[De]||$s[(de+Re>>1)*Sn+(ae+Ie>>1)]||$s[(be+Re>>1)*Sn+(fe+Ie>>1)])}const U=new a.aO,q=new a.aP;let $=0;function ee(re,ie){const ae=ie*Sn+re;return Ir[ae]===0&&(U.emplaceBack(mr[2*ae+0],mr[2*ae+1],re*a.ab/zt,ie*a.ab/zt),Ir[ae]=++$),Ir[ae]-1}function K(re,ie,ae,de,fe,be){const Ee=re+ae>>1,we=ie+de>>1;if(Math.abs(re-fe)+Math.abs(ie-be)>1&&$s[we*Sn+Ee])K(fe,be,re,ie,Ee,we),K(ae,de,fe,be,Ee,we);else{const Ie=ee(re,ie),Re=ee(ae,de),Be=ee(fe,be);q.emplaceBack(Ie,Re,Be)}}return K(0,0,zt,zt,zt,0),K(zt,zt,0,0,0,zt),{vertices:U,indices:q}}(this.tileID.canonical,o);_=b.vertices,v=b.indices}else{_=new a.aO,v=new a.aP;for(const{x:P,y:D}of f)_.emplaceBack(P,D,0,0);const b=a.b3(_.int16,void 0,4);for(let P=0;P<b.length;P+=3)v.emplaceBack(b[P],b[P+1],b[P+2])}this._tileBoundsBuffer=n.createVertexBuffer(_,a.b4.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(v),this._tileBoundsSegments=a.b2.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugBuffers(n,o){const f=o.projection;if(!f||f.name!=="globe"||o.freezeTileCoverage)return;const _=this.tileID.canonical,v=a.b5(_,o),b=a.b6(v),P=a.a9(o.zoom);let D;P>0&&(D=a.a6.mat4.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,_,o,b,D,P),this._makeGlobeTileDebugTextBuffer(n,_,o,b,D,P)}_globePoint(n,o,f,_,v,b,P){let D=a.b7(n,o,f);if(b){const B=1<<f.z,F=a.am(_.center.lng),U=a.at(_.center.lat),q=(f.x+.5)/B-F;let $=0;q>.5?$=-1:q<-.5&&($=1);let ee=(n/a.ab+f.x)/B+$,K=(o/a.ab+f.y)/B;ee=(ee-F)*_._pixelsPerMercatorPixel+F,K=(K-U)*_._pixelsPerMercatorPixel+U;const re=[ee*_.worldSize,K*_.worldSize,0];a.a6.vec3.transformMat4(re,re,b),D=a.b8(D,re,P)}return a.a6.vec3.transformMat4(D,D,v)}_makeGlobeTileDebugBorderBuffer(n,o,f,_,v,b){const P=new a.a$,D=new a.b0,B=new a.b9,F=(q,$,ee,K,re)=>{const ie=(ee-q)/(re-1),ae=(K-$)/(re-1),de=P.length;for(let fe=0;fe<re;fe++){const be=q+fe*ie,Ee=$+fe*ae;P.emplaceBack(be,Ee);const we=this._globePoint(be,Ee,o,f,_,v,b);B.emplaceBack(we[0],we[1],we[2]),D.emplaceBack(de+fe)}},U=a.ab;F(0,0,U,0,16),F(U,0,U,U,16),F(U,U,0,U,16),F(0,U,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(D),this._tileDebugBuffer=n.createVertexBuffer(P,a.b1.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(B,a.ba.members),this._tileDebugSegments=a.b2.simpleSegment(0,0,P.length,D.length)}_makeGlobeTileDebugTextBuffer(n,o,f,_,v,b){const P=a.ab/4,D=new a.a$,B=new a.aP,F=new a.b9,U=25;B.reserve(32),D.reserve(U),F.reserve(U);const q=($,ee)=>U*$+ee;for(let $=0;$<U;$++){const ee=$*P;for(let K=0;K<U;K++){const re=K*P;D.emplaceBack(re,ee);const ie=this._globePoint(re,ee,o,f,_,v,b);F.emplaceBack(ie[0],ie[1],ie[2])}}for(let $=0;$<4;$++)for(let ee=0;ee<4;ee++){const K=q($,ee),re=q($,ee+1),ie=q($+1,ee),ae=q($+1,ee+1);B.emplaceBack(K,re,ie),B.emplaceBack(ie,re,ae)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(B),this._tileDebugTextBuffer=n.createVertexBuffer(D,a.b1.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(F,a.ba.members),this._tileDebugTextSegments=a.b2.simpleSegment(0,0,U,32)}destroy(n=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.bb.setPbf(a.bc);class qr extends As{constructor(n,o,f,_,v){super(n,o,f,_,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,o){const f=o.context,_=f.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof a.T?this.texture.update(n,{premultiply:!1}):this.texture=new a.T(f,n,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,o){const f=this._mrt=new a.bb(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=a.bd(_,(v,b,P,D)=>{if(v)o(v);else try{const B=f.getHeaderLength(b);if(B>n)return void(this.request=this.fetchHeader(B,o));f.parseHeader(b),this._isHeaderLoaded=!0;let F=0;for(const U of Object.values(f.layers))F=Math.max(F,U.dataIndex[U.dataIndex.length-1].last_byte);b.byteLength>=F&&(this.entireBuffer=b),o(null,this.entireBuffer||b,P,D)}catch(B){o(B)}}),this.request}fetchBand(n,o,f){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void f(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void f(new Error("Can't fetch tile band without an actor"));let b;const P=(U,q)=>{b.complete(U,q),U?f(U):(this.updateTextureDescriptor(n,o),f(null,this.textureDescriptor&&this.textureDescriptor.img))},D=(U,q)=>{if(U)return f(U);const $=v.send("decodeRasterArray",{buffer:q,task:b},P,void 0,!0);this._workQueue.push(()=>{$&&$.cancel(),b.cancel()})},B=_.getLayer(n);if(!B)return void f(new Error(`Unknown sourceLayer "${n}"`));if(B.hasDataForBand(o))return this.updateTextureDescriptor(n,o),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=B.getDataRange([o]);if(b=_.createDecodingTask(F),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)D(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),q=a.bd(U,D);this._fetchQueue.push(()=>{q.cancel(),b.cancel()})}else f(null)}updateNeeded(n,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,o){if(!this._mrt)return;const f=this._mrt.getLayer(n);if(!f||!f.hasBand(o)||!f.hasDataForBand(o))return;const{bytes:_,tileSize:v,buffer:b,offset:P,scale:D}=f.getBandView(o),B=v+2*b,F={data:_,width:B,height:B},U=this.texture;U&&U instanceof a.T&&U.update(F,{premultiply:!1}),this.textureDescriptor={layer:n,band:o,img:F,buffer:b,offset:P,tileSize:v,format:f.pixelFormat,mix:[D,256*D,65536*D,16777216*D]}}}class Cl{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,f){const _=n.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:o,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(n,v)},f)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const f=n.wrapped().key,_=o===void 0?0:this.data[f].indexOf(o),v=this.data[f][_];return this.data[f].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const f in this.data)for(const _ of this.data[f])n(_.value)||o.push(_);for(const f of o)this.remove(f.value.tileID,f)}}class us{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,f){const _=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][_]=this.stateChanges[n][_]||{},a.l(this.stateChanges[n][_],f),this.deletedStates[n]===null){this.deletedStates[n]={};for(const v in this.state[n])v!==_&&(this.deletedStates[n][v]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][_]===null){this.deletedStates[n][_]={};for(const v in this.state[n][_])f[v]||(this.deletedStates[n][_][v]=null)}else for(const v in f)this.deletedStates[n]&&this.deletedStates[n][_]&&this.deletedStates[n][_][v]===null&&delete this.deletedStates[n][_][v]}removeFeatureState(n,o,f){if(this.deletedStates[n]===null)return;const _=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},f&&o!==void 0)this.deletedStates[n][_]!==null&&(this.deletedStates[n][_]=this.deletedStates[n][_]||{},this.deletedStates[n][_][f]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][_])for(f in this.deletedStates[n][_]={},this.stateChanges[n][_])this.deletedStates[n][_][f]=null;else this.deletedStates[n][_]=null;else this.deletedStates[n]=null}getState(n,o){const f=this.state[n]||{},_=this.stateChanges[n]||{},v=this.deletedStates[n];if(v===null)return{};if(o!==void 0){const P=String(o),D=a.l({},f[P],_[P]);if(v){const B=v[o];if(B===null)return{};for(const F in B)delete D[F]}return D}const b=a.l({},f,_);if(v)for(const P in v)delete b[P];return b}initializeTileState(n,o){n.refreshFeatureState(o)}coalesceChanges(n,o){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const b in this.stateChanges[_])this.state[_][b]||(this.state[_][b]={}),a.l(this.state[_][b],this.stateChanges[_][b]),v[b]=this.state[_][b];f[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const b in this.state[_])v[b]={},this.state[_][b]={};else for(const b in this.deletedStates[_]){if(this.deletedStates[_][b]===null)this.state[_][b]={};else if(this.state[_][b])for(const P of Object.keys(this.deletedStates[_][b]))delete this.state[_][b][P];v[b]=this.state[_][b]}f[_]=f[_]||{},a.l(f[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in n)n[_].refreshFeatureState(o)}}class ns extends a.E{constructor(n,o,f){super(),this.id=n,this._onlySymbols=f,o.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Cl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new us,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const f=this._tiles[o];f.upload(n),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return a.be(this._tiles).map(n=>n.tileID).sort(Tr).map(n=>n.key)}getRenderableIds(n,o){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,n,o)&&f.push(this._tiles[_]);return n?f.sort((_,v)=>{const b=_.tileID,P=v.tileID,D=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),B=new a.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-P.overscaledZ||B.y-D.y||B.x-D.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(Tr).map(_=>_.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o,f){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())&&(f||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const f=this._tiles[n];f&&(f.state!=="loading"&&(f.state=o),this._loadTile(f,this._tileLoaded.bind(this,f,n,o)))}_tileLoaded(n,o,f,_){if(_)if(n.state="errored",_.status!==404)this._source.fire(new a.t(_,{tile:n}));else{if(this._source.fire(new a.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=a.q.now(),f==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new a.x("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let _=0;_<o.length;_++){const v=o[_];if(n.neighboringTiles&&n.neighboringTiles[v]){const b=this.getTileByID(v);f(n,b),f(b,n)}}function f(_,v){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-_.tileID.canonical.x;const P=v.tileID.canonical.y-_.tileID.canonical.y,D=Math.pow(2,_.tileID.canonical.z),B=v.tileID.key;b===0&&P===0||Math.abs(P)>1||(Math.abs(b)>1&&(Math.abs(b+D)===1?b+=D:Math.abs(b-D)===1&&(b-=D)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,b,P),_.neighboringTiles&&_.neighboringTiles[B]&&(_.neighboringTiles[B].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,f,_){for(const v in this._tiles){let b=this._tiles[v];if(_[v]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>f)continue;let P=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){const B=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[B.key],b&&b.hasData()&&(P=B)}let D=P;for(;D.overscaledZ>o;)if(D=D.scaledTo(D.overscaledZ-1),n[D.key]){_[P.key]=P;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const f=this._loadedParentTiles[n.key];return f&&f.tileID.overscaledZ>=o?f:null}for(let f=n.overscaledZ-1;f>=o;f--){const _=n.scaledTo(f),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const f=Math.ceil(n.width/o)+1,_=Math.ceil(n.height/o)+1,v=Math.floor(f*_*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(P)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const f={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+o),f[v.tileID.key]=v}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(n,o,f,_){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let b,P=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const U=D.attenuationRange()[0],q=Math.floor(U)-Math.log2(D.getDemUpscale());P>q&&(P=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new a.aA(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=n.clone();U.tileCoverLift=this.tileCoverLift,b=U.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:P,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&n.projection.name==="globe"&&(b.push(new a.aA(1,0,1,0,0)),b.push(new a.aA(1,0,1,1,0)),b.push(new a.aA(1,0,1,0,1)),b.push(new a.aA(1,0,1,1,1)))}else if(b=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:P,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);b=b.filter(q=>U(q))}}else b=[];if(b.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ma(this._source.type)){const U=n.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),q=Math.min(U,this._source.maxzoom);if(v){const $=n.extendTileCover(b,q);for(const ee of $)b.push(ee)}else{const $=n.extendTileCover(b,q,_);for(const ee of $)this._shadowCasterTiles[ee.key]=!0,b.push(ee)}}const B=this._updateRetainedTiles(b);if(ma(this._source.type)&&b.length!==0){const U={},q={},$=Object.keys(B);for(const K of $){const re=B[K],ie=this._tiles[K];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=a.q.now())continue;const ae=this.findLoadedParent(re,Math.max(re.overscaledZ-ns.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),U[ae.tileID.key]=ae.tileID),q[K]=re}const ee=b[b.length-1].overscaledZ;for(const K in this._tiles){const re=this._tiles[K];if(B[K]||!re.hasData())continue;let ie=re.tileID;for(;ie.overscaledZ>ee;){ie=ie.scaledTo(ie.overscaledZ-1);const ae=this._tiles[ie.key];if(ae&&ae.hasData()&&q[ie.key]){B[K]=re.tileID;break}}}for(const K in U)B[K]||(this._coveredTiles[K]=!0,B[K]=U[K])}for(const U in B)this._tiles[U].clearFadeHold();const F=a.bf(this._tiles,B);for(const U of F){const q=this._tiles[U];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const f={},_=n.reduce((B,F)=>Math.min(B,F.overscaledZ),1/0),v=n[0].overscaledZ,b=Math.max(v-ns.maxOverzooming,this._source.minzoom),P=Math.max(v+ns.maxUnderzooming,this._source.minzoom),D={};for(const B of n){const F=this._addTile(B);o[B.key]=B,F.hasData()||_<this._source.maxzoom&&(D[B.key]=B)}this._retainLoadedChildren(D,_,P,o);for(const B of n){let F=this._tiles[B.key];if(F.hasData())continue;if(B.canonical.z>=this._source.maxzoom){const q=B.children(this._source.maxzoom)[0],$=this.getTile(q);if($&&$.hasData()){o[q.key]=q;continue}}else{const q=B.children(this._source.maxzoom);if(o[q[0].key]&&o[q[1].key]&&o[q[2].key]&&o[q[3].key])continue}let U=F.wasRequested();for(let q=B.overscaledZ-1;q>=b;--q){const $=B.scaledTo(q);if(f[$.key]||(f[$.key]=!0,F=this.getTile($),!F&&U&&(F=this._addTile($)),F&&(o[$.key]=$,U=F.wasRequested(),F.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let f,_=this._tiles[n].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}o.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;_=v}for(const v of o)this._loadedParentTiles[v]=f}}_addTile(n){let o=this._tiles[n.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const f=!!o;if(!f){const _=this.map?this.map.painter:null,v=this._source.tileSize*n.overscaleFactor();o=this._source.type==="raster-array"?new qr(n,v,this.transform.tileZoom,_,this._isRaster):new As(n,v,this.transform.tileZoom,_,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,f||this._source.fire(new a.x("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const f=o.getExpiryTimeout();f&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},f))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,f){const _=[],v=this.transform;if(!v)return _;const b=v.projection.name==="globe",P=a.am(v.center.lng);for(const D in this._tiles){const B=this._tiles[D];if(f&&B.clearQueryDebugViz(),B.holdingForFade())continue;let F;if(b){const U=B.tileID.canonical;if(U.z===0){const q=[Math.abs(a.ap(P,...ga(U,-1))-P),Math.abs(a.ap(P,...ga(U,1))-P)];F=[0,2*q.indexOf(Math.min(...q))-1]}else{const q=[Math.abs(a.ap(P,...ga(U,-1))-P),Math.abs(a.ap(P,...ga(U,0))-P),Math.abs(a.ap(P,...ga(U,1))-P)];F=[q.indexOf(Math.min(...q))-1]}}else F=[0];for(const U of F){const q=n.containsTile(B,v,o,U);q&&_.push(q)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,o){const f=this.getRenderableIds(n,o).map(v=>this._tiles[v].tileID),_=this.transform.projection.name==="globe";for(const v of f)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=_?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return f}sortCoordinatesByDistance(n){const o=n.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),v={};for(const b of o){const P=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*P+b.wrap-f[0])*_[0]+((b.canonical.y+.5)*P-f[1])*_[1]-f[2]*_[2]}return o.sort((b,P)=>v[b.key]-v[P.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(ma(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=a.q.now())return!0}return!1}setFeatureState(n,o,f){this._state.updateState(n=n||"_geojsonTileLayer",o,f)}removeFeatureState(n,o,f){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,f)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,f){const _=this._tiles[n];_&&_.setDependencies(o,f)}reloadTilesForDependencies(n,o){for(const f in this._tiles)this._tiles[f].hasDependency(n,o)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(n,o))};return void this._source.on("data",D)}const f=new Map,_=Array.isArray(n)?n:[n],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const D of _){const B=D.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of B)f.set(F.key,F);this.usedForTerrain&&D.updateElevation(!1)}const P=Array.from(f.values());a.bg(P,(D,B)=>{const F=new As(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,U=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),B(U,F)})},o)}}function Tr(d,n){const o=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*n.wrap)-+(n.wrap<0);return d.overscaledZ-n.overscaledZ||f-o||n.canonical.y-d.canonical.y||n.canonical.x-d.canonical.x}function ma(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function ga(d,n){const o=1<<d.z;return[d.x/o+n,(d.x+1)/o+n]}ns.maxOverzooming=10,ns.maxUnderzooming=3;class Ml{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,o=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:n,visibilityChanged:o});else if(_.type==="model"){const v=this.style.getLayerSource(_);v&&v.type==="batched-model"&&this.layers.push({layer:_,visible:n,visibilityChanged:o})}}}onNewFrame(n){this.layersGotHidden=!1;for(const o of this.layers){const f=o.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(n)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(_=!f.isHidden(n)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&o.visible,o.visible=_}}updateZOffset(n,o){this.currentBuildingBuckets=[];for(const _ of this.layers){const v=_.layer,b=this.style.getLayerSourceCache(v);let P=1;v.type==="fill-extrusion"&&(P=_.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let D=b?b.getTile(o):null;if(!D&&b&&o.canonical.z>b.getSource().minzoom){let B=o.scaledTo(Math.min(b.getSource().maxzoom,o.overscaledZ-1));for(;B.overscaledZ>=b.getSource().minzoom&&(D=b.getTile(B),!D&&B.overscaledZ!==0);)B=B.scaledTo(B.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:o,verticalScale:P})}n.hasAnyZOffset=!1;let f=!1;for(let _=0;_<n.symbolInstances.length;_++){const v=n.symbolInstances.get(_),b=v.zOffset,P=this._getHeightAtTileOffset(o,v.tileAnchorX,v.tileAnchorY);v.zOffset=P!==Number.NEGATIVE_INFINITY?P:b,f||b===v.zOffset||(f=!0),n.hasAnyZOffset||v.zOffset===0||(n.hasAnyZOffset=!0)}f&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,o,f,_){let v=o,b=f;if(n.canonical.z!==_.canonical.z){const P=_.canonical,D=1/(1<<n.canonical.z-P.z);v=(o+n.canonical.x*a.ab)*D-P.x*a.ab|0,b=(f+n.canonical.y*a.ab)*D-P.y*a.ab|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(n,o,f){let _,v;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;const{bucket:P,tileID:D,verticalScale:B}=this.currentBuildingBuckets[b];if(!P)continue;const{tileX:F,tileY:U}=this._mapCoordToOverlappingTile(n,o,f,D),q=P.getHeightAtTileCoord(F,U);q&&q.height!==void 0&&(q.hidden?_=q.height:v=Math.max(q.height*B,v||0))}if(v!==void 0)return v;for(let b=0;b<this.layers.length;++b){const P=this.layers[b];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:D,tileID:B}=this.currentBuildingBuckets[b];if(!D)continue;const{tileX:F,tileY:U}=this._mapCoordToOverlappingTile(n,o,f,B),q=D.getHeightAtTileCoord(F,U);if(q&&!q.hidden)return q.height===void 0&&_!==void 0?Math.min(q.maxHeight,_)*q.verticalScale:q.height?q.height*q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function lo(d,n){const o={};for(const f in d)f!=="ref"&&(o[f]=d[f]);return a.bh.forEach(f=>{f in n&&(o[f]=n[f])}),o}function _a(d){d=d.slice();const n=Object.create(null);for(let o=0;o<d.length;o++)n[d[o].id]=d[o];for(let o=0;o<d.length;o++)"ref"in d[o]&&(d[o]=lo(d[o],n[d[o].ref]));return d}const Un={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Al(d,n,o){o.push({command:Un.addSource,args:[d,n[d]]})}function ai(d,n,o){n.push({command:Un.removeSource,args:[d]}),o[d]=!0}function Tc(d,n,o,f){ai(d,o,f),Al(d,n,o)}function ln(d,n,o){let f;for(f in d[o])if(d[o].hasOwnProperty(f)&&f!=="data"&&!a.bi(d[o][f],n[o][f]))return!1;for(f in n[o])if(n[o].hasOwnProperty(f)&&f!=="data"&&!a.bi(d[o][f],n[o][f]))return!1;return!0}function Pl(d,n,o,f,_,v){let b;for(b in n=n||{},d=d||{})d.hasOwnProperty(b)&&(a.bi(d[b],n[b])||o.push({command:v,args:[f,b,n[b],_]}));for(b in n)n.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(a.bi(d[b],n[b])||o.push({command:v,args:[f,b,n[b],_]}))}function ks(d){return d.id}function ya(d,n){return d[n.id]=n,d}class Ki{constructor(n,o){this.reset(n,o)}reset(n,o){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.ap(n,0,1);let o=1,f=this._distances[o];const _=n*this.paddedLength+this.padding;for(;f<_&&o<this._distances.length;)f=this._distances[++o];const v=o-1,b=this._distances[v],P=f-b,D=P>0?(_-b)/P:0;return this.points[v].mult(1-D).add(this.points[o].mult(D))}}class jr{constructor(n,o,f){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(o/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,o,f,_,v){this._forEachCell(o,f,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(n,o,f,_){this._forEachCell(o-_,f-_,o+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(f),this.circles.push(_)}_insertBoxCell(n,o,f,_,v,b){this.boxCells[v].push(b)}_insertCircleCell(n,o,f,_,v,b){this.circleCells[v].push(b)}_query(n,o,f,_,v,b){if(f<0||n>this.width||_<0||o>this.height)return!v&&[];const P=[];if(n<=0&&o<=0&&this.width<=f&&this.height<=_){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)P.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const B=this.circles[3*D],F=this.circles[3*D+1],U=this.circles[3*D+2];P.push({key:this.circleKeys[D],x1:B-U,y1:F-U,x2:B+U,y2:F+U})}return b?P.filter(b):P}return this._forEachCell(n,o,f,_,this._queryCell,P,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?P.length>0:P}_queryCircle(n,o,f,_,v){const b=n-f,P=n+f,D=o-f,B=o+f;if(P<0||b>this.width||B<0||D>this.height)return!_&&[];const F=[];return this._forEachCell(b,D,P,B,this._queryCellCircle,F,{hitTest:_,circle:{x:n,y:o,radius:f},seenUids:{box:{},circle:{}}},v),_?F.length>0:F}query(n,o,f,_,v){return this._query(n,o,f,_,!1,v)}hitTest(n,o,f,_,v){return this._query(n,o,f,_,!0,v)}hitTestCircle(n,o,f,_){return this._queryCircle(n,o,f,!0,_)}_queryCell(n,o,f,_,v,b,P,D){const B=P.seenUids,F=this.boxCells[v];if(F!==null){const q=this.bboxes;for(const $ of F)if(!B.box[$]){B.box[$]=!0;const ee=4*$;if(n<=q[ee+2]&&o<=q[ee+3]&&f>=q[ee+0]&&_>=q[ee+1]&&(!D||D(this.boxKeys[$]))){if(P.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[$],x1:q[ee],y1:q[ee+1],x2:q[ee+2],y2:q[ee+3]})}}}const U=this.circleCells[v];if(U!==null){const q=this.circles;for(const $ of U)if(!B.circle[$]){B.circle[$]=!0;const ee=3*$;if(this._circleAndRectCollide(q[ee],q[ee+1],q[ee+2],n,o,f,_)&&(!D||D(this.circleKeys[$]))){if(P.hitTest)return b.push(!0),!0;{const K=q[ee],re=q[ee+1],ie=q[ee+2];b.push({key:this.circleKeys[$],x1:K-ie,y1:re-ie,x2:K+ie,y2:re+ie})}}}}}_queryCellCircle(n,o,f,_,v,b,P,D){const B=P.circle,F=P.seenUids,U=this.boxCells[v];if(U!==null){const $=this.bboxes;for(const ee of U)if(!F.box[ee]){F.box[ee]=!0;const K=4*ee;if(this._circleAndRectCollide(B.x,B.y,B.radius,$[K+0],$[K+1],$[K+2],$[K+3])&&(!D||D(this.boxKeys[ee])))return b.push(!0),!0}}const q=this.circleCells[v];if(q!==null){const $=this.circles;for(const ee of q)if(!F.circle[ee]){F.circle[ee]=!0;const K=3*ee;if(this._circlesCollide($[K],$[K+1],$[K+2],B.x,B.y,B.radius)&&(!D||D(this.circleKeys[ee])))return b.push(!0),!0}}}_forEachCell(n,o,f,_,v,b,P,D){const B=this._convertToXCellCoord(n),F=this._convertToYCellCoord(o),U=this._convertToXCellCoord(f),q=this._convertToYCellCoord(_);for(let $=B;$<=U;$++)for(let ee=F;ee<=q;ee++)if(v.call(this,n,o,f,_,this.xCellCount*ee+$,b,P,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,o,f,_,v,b){const P=_-n,D=v-o,B=f+b;return B*B>P*P+D*D}_circleAndRectCollide(n,o,f,_,v,b,P){const D=(b-_)/2,B=Math.abs(n-(_+D));if(B>D+f)return!1;const F=(P-v)/2,U=Math.abs(o-(v+F));if(U>F+f)return!1;if(B<=D||U<=F)return!0;const q=B-D,$=U-F;return q*q+$*$<=f*f}}const Ci={unknown:0,flipRequired:1,flipNotRequired:2},Wt=Math.tan(85*Math.PI/180);function Gn(d,n,o,f,_,v,b){const P=a.a6.mat4.create();if(o)if(v.name==="globe"){const D=a.bj(_,n);a.a6.mat4.multiply(P,P,D)}else{const D=a.a6.mat2.invert([],b);P[0]=D[0],P[1]=D[1],P[4]=D[2],P[5]=D[3],f||a.a6.mat4.rotateZ(P,P,_.angle)}else a.a6.mat4.multiply(P,_.labelPlaneMatrix,d);return P}function cn(d,n,o,f,_,v,b){const P=Gn(d,n,o,f,_,v,b);return v.name==="globe"&&o||(P[2]=P[6]=P[10]=P[14]=0),P}function is(d,n,o,f,_,v,b){if(o){if(v.name==="globe"){const P=Gn(d,n,o,f,_,v,b);return a.a6.mat4.invert(P,P),a.a6.mat4.multiply(P,d,P),P}{const P=a.a6.mat4.clone(d),D=a.a6.mat4.identity([]);return D[0]=b[0],D[1]=b[1],D[4]=b[2],D[5]=b[3],a.a6.mat4.multiply(P,P,D),f||a.a6.mat4.rotateZ(P,P,-_.angle),P}}return _.glCoordMatrix}function Vi(d,n,o,f){const _=[d,n,o,1];o?a.a6.vec4.transformMat4(_,_,f):Rl(_,_,f);const v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function Wn(d,n){return Math.min(.5+d/n*.5,1.5)}function cu(d,n){const o=d[0]/d[3],f=d[1]/d[3];return o>=-n[0]&&o<=n[0]&&f>=-n[1]&&f<=n[1]}function Ll(d,n,o,f,_,v,b,P,D,B){const F=o.transform,U=f?d.textSizeData:d.iconSizeData,q=a.bk(U,o.transform.zoom),$=F.projection.name==="globe",ee=[256/o.width*2+1,256/o.height*2+1],K=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;K.clear();let re=null;$&&(re=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const ie=d.lineVertexArray,ae=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,de=o.transform.width/o.transform.height;let fe,be=!1;for(let Ee=0;Ee<ae.length;Ee++){const we=ae.get(Ee),{numGlyphs:Ie,writingMode:Re}=we;if(Re!==a.bl.vertical||be||fe===a.bl.horizontal||(be=!0),fe=Re,(we.hidden||Re===a.bl.vertical)&&!be){Bs(Ie,K);continue}be=!1;const Be=new a.P(we.tileAnchorX,we.tileAnchorY);let{x:Ne,y:De,z:Je}=F.projection.projectTilePoint(Be.x,Be.y,B.canonical);if(D){const[mt,Ot,Kt]=D(Be);Ne+=mt,De+=Ot,Je+=Kt}const at=[Ne,De,Je,1];if(a.a6.vec4.transformMat4(at,at,n),!cu(at,ee)){Bs(Ie,K);continue}const vt=at[3],St=Wn(o.transform.getCameraToCenterDistance(F.projection),vt),Pt=a.bm(U,q,we),He=b?Pt/St:Pt*St,gt=Vi(Ne,De,Je,_);if(gt[3]<=0){Bs(Ie,K);continue}let rt={};const _t=b?null:D,xt=Wi(we,He,!1,P,n,_,v,d.glyphOffsetArray,ie,K,re,gt,Be,rt,de,_t,F.projection,B,b);be=xt.useVertical,_t&&xt.needsFlipping&&(rt={}),(xt.notEnoughRoom||be||xt.needsFlipping&&Wi(we,He,!0,P,n,_,v,d.glyphOffsetArray,ie,K,re,gt,Be,rt,de,_t,F.projection,B,b).notEnoughRoom)&&Bs(Ie,K)}f?(d.text.dynamicLayoutVertexBuffer.updateData(K),re&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(re)):(d.icon.dynamicLayoutVertexBuffer.updateData(K),re&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(re))}function $a(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K){const{lineStartIndex:re,glyphStartIndex:ie,segment:ae}=P,de=ie+P.numGlyphs,fe=re+P.lineLength,be=n.getoffsetX(ie),Ee=n.getoffsetX(de-1),we=cs(d*be,o,f,_,v,b,ae,re,fe,D,B,F,U,q,!0,$,ee,K);if(!we)return null;const Ie=cs(d*Ee,o,f,_,v,b,ae,re,fe,D,B,F,U,q,!0,$,ee,K);return Ie?{first:we,last:Ie}:null}function rr(d,n,o,f){return d===a.bl.horizontal&&Math.abs(f)>Math.abs(o)?{useVertical:!0}:d===a.bl.vertical?f>0?{needsFlipping:!0}:null:n!==Ci.unknown&&function(_,v){return _===0||Math.abs(v/_)>Wt}(o,f)?n===Ci.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Wi(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re,ie,ae){const de=n/24,fe=d.lineOffsetX*de,be=d.lineOffsetY*de,{lineStartIndex:Ee,glyphStartIndex:we,numGlyphs:Ie,segment:Re,writingMode:Be,flipState:Ne}=d,De=Ee+d.lineLength,Je=at=>{if(F){const[He,gt,rt]=at.up,_t=B.length;a.bn(F,_t+0,He,gt,rt),a.bn(F,_t+1,He,gt,rt),a.bn(F,_t+2,He,gt,rt),a.bn(F,_t+3,He,gt,rt)}const[vt,St,Pt]=at.point;a.bo(B,vt,St,Pt,at.angle)};if(Ie>1){const at=$a(de,P,fe,be,o,U,q,d,D,v,$,K,!1,re,ie,ae);if(!at)return{notEnoughRoom:!0};if(f&&!o){let[vt,St,Pt]=at.first.point,[He,gt,rt]=at.last.point;[vt,St]=Vi(vt,St,Pt,b),[He,gt]=Vi(He,gt,rt,b);const _t=rr(Be,Ne,(He-vt)*ee,gt-St);if(d.flipState=_t&&_t.needsFlipping?Ci.flipRequired:Ci.flipNotRequired,_t)return _t}Je(at.first);for(let vt=we+1;vt<we+Ie-1;vt++){const St=cs(de*P.getoffsetX(vt),fe,be,o,U,q,Re,Ee,De,D,v,$,K,!1,!1,re,ie,ae);if(!St)return B.length-=4*(vt-we),{notEnoughRoom:!0};Je(St)}Je(at.last)}else{if(f&&!o){const vt=Vi(q.x,q.y,0,_),St=Ee+Re+1,Pt=new a.P(D.getx(St),D.gety(St)),He=Vi(Pt.x,Pt.y,0,_),gt=He[3]>0?He:Qn(q,Pt,vt,1,_,void 0,re,ie.canonical),rt=rr(Be,Ne,(gt[0]-vt[0])*ee,gt[1]-vt[1]);if(d.flipState=rt&&rt.needsFlipping?Ci.flipRequired:Ci.flipNotRequired,rt)return rt}const at=cs(de*P.getoffsetX(we),fe,be,o,U,q,Re,Ee,De,D,v,$,K,!1,!1,re,ie,ae);if(!at)return{notEnoughRoom:!0};Je(at)}return{}}function Sc(d,n,o,f,_){const{x:v,y:b,z:P}=f.projectTilePoint(d.x,d.y,n);if(!_)return Vi(v,b,P,o);const[D,B,F]=_(d);return Vi(v+D,b+B,P+F,o)}function Qn(d,n,o,f,_,v,b,P){const D=Sc(d.sub(n)._unit()._add(d),P,_,b,v);return a.a6.vec3.sub(D,o,D),a.a6.vec3.normalize(D,D),a.a6.vec3.scaleAndAdd(D,o,D,f)}function cs(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re,ie){const ae=f?d-n:d+n;let de=ae>0?1:-1,fe=0;f&&(de*=-1,fe=Math.PI),de<0&&(fe+=Math.PI);let be=P+b+(de>0?0:1)|0,Ee=_,we=_,Ie=0,Re=0;const Be=Math.abs(ae),Ne=[],De=[];let Je=v,at=Je;const vt=()=>Qn(at,Je,we,Be-Ie+1,F,q,K,re.canonical);for(;Ie+Re<=Be;){if(be+=de,be<P||be>=D)return null;if(we=Ee,at=Je,Ne.push(we),$&&De.push(at),Je=new a.P(B.getx(be),B.gety(be)),Ee=U[be],!Ee){const Ot=Sc(Je,re.canonical,F,K,q);Ee=Ot[3]>0?U[be]=Ot:vt()}Ie+=Re,Re=a.a6.vec3.distance(we,Ee)}ee&&q&&(U[be]&&(Ee=vt(),Re=a.a6.vec3.distance(we,Ee)),U[be]=Ee);const St=(Be-Ie)/Re,Pt=Je.sub(at)._mult(St)._add(at),He=a.a6.vec3.sub([],Ee,we),gt=a.a6.vec3.scaleAndAdd([],we,He,St);let rt=[0,0,1],_t=He[0],xt=He[1];if(ie&&(rt=K.upVector(re.canonical,Pt.x,Pt.y),rt[0]!==0||rt[1]!==0||rt[2]!==1)){const Ot=[rt[2],0,-rt[0]],Kt=a.a6.vec3.cross([],rt,Ot);a.a6.vec3.normalize(Ot,Ot),a.a6.vec3.normalize(Kt,Kt),_t=a.a6.vec3.dot(He,Ot),xt=a.a6.vec3.dot(He,Kt)}if(o){const Ot=a.a6.vec3.cross([],rt,He);a.a6.vec3.normalize(Ot,Ot),a.a6.vec3.scaleAndAdd(gt,gt,Ot,o*de)}const mt=fe+Math.atan2(xt,_t);return Ne.push(gt),$&&De.push(Pt),{point:gt,angle:mt,path:Ne,tilePath:De,up:rt}}function Bs(d,n){const o=n.length,f=o+4*d;n.resize(f),n.float32.fill(-1/0,4*o,4*f)}function Rl(d,n,o){const f=n[0],_=n[1];return d[0]=o[0]*f+o[4]*_+o[12],d[1]=o[1]*f+o[5]*_+o[13],d[3]=o[3]*f+o[7]*_+o[15],d}const Or=100;class Nr{constructor(n,o,f=new jr(n.width+200,n.height+200,25),_=new jr(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Or,this.screenBottomBoundary=n.height+Or,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=o}placeCollisionBox(n,o,f,_,v,b,P,D){let B=f.projectedAnchorX,F=f.projectedAnchorY,U=f.projectedAnchorZ;const q=f.elevation,$=f.tileID,ee=n.getProjection();if(q&&$){const[Ee,we,Ie]=ee.upVector($.canonical,f.tileAnchorX,f.tileAnchorY),Re=ee.upVectorScale($.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Ee*q*Re,F+=we*q*Re,U+=Ie*q*Re}const K=this.projectAndGetPerspectiveRatio(P,B,F,U,f.tileID,ee.name==="globe"||!!q||this.transform.pitch>0,ee),re=b*K.perspectiveRatio,ie=(f.x1*o+_.x-f.padding)*re+K.point.x,ae=(f.y1*o+_.y-f.padding)*re+K.point.y,de=(f.x2*o+_.x+f.padding)*re+K.point.x,fe=(f.y2*o+_.y+f.padding)*re+K.point.y,be=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(ie,ae,de,fe)||!v&&this.grid.hitTest(ie,ae,de,fe,D)||be?{box:[],offscreen:!1,occluded:K.occluded}:{box:[ie,ae,de,fe],offscreen:this.isOffscreen(ie,ae,de,fe),occluded:!1}}placeCollisionCircles(n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K){const re=[],ie=this.transform.elevation,ae=n.getProjection(),de=ie?ie.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,ae):null,fe=new a.P(f.tileAnchorX,f.tileAnchorY);let{x:be,y:Ee,z:we}=ae.projectTilePoint(fe.x,fe.y,K.canonical);if(de){const[Pt,He,gt]=de(fe);be+=Pt,Ee+=He,we+=gt}const Ie=ae.name==="globe",Re=this.projectAndGetPerspectiveRatio(P,be,Ee,we,K,Ie||!!ie||this.transform.pitch>0,ae),{perspectiveRatio:Be}=Re,Ne=(U?b/Be:b*Be)/a.br,De=Vi(be,Ee,we,D),Je=Re.signedDistanceFromCamera>0?$a(Ne,v,f.lineOffsetX*Ne,f.lineOffsetY*Ne,!1,De,fe,f,_,D,{},ie&&!U?de:null,U&&!!ie,ae,K,U):null;let at=!1,vt=!1,St=!0;if(Je&&!Re.occluded){const Pt=.5*$*Be+ee,He=new a.P(-100,-100),gt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),rt=new Ki,{first:_t,last:xt}=Je,mt=_t.path.length;let Ot=[];for(let Zt=mt-1;Zt>=1;Zt--)Ot.push(_t.path[Zt]);for(let Zt=1;Zt<xt.path.length;Zt++)Ot.push(xt.path[Zt]);const Kt=2.5*Pt;B&&(Ot=Ot.map(([Zt,un,Ut],hn)=>(de&&!Ie&&(Ut=de(hn<mt-1?_t.tilePath[mt-1-hn]:xt.tilePath[hn-mt+2])[2]),Vi(Zt,un,Ut,B))),Ot.some(Zt=>Zt[3]<=0)&&(Ot=[]));let on=[];if(Ot.length>0){let Zt=1/0,un=-1/0,Ut=1/0,hn=-1/0;for(const Cn of Ot)Zt=Math.min(Zt,Cn[0]),Ut=Math.min(Ut,Cn[1]),un=Math.max(un,Cn[0]),hn=Math.max(hn,Cn[1]);un>=He.x&&Zt<=gt.x&&hn>=He.y&&Ut<=gt.y&&(on=[Ot.map(Cn=>new a.P(Cn[0],Cn[1]))],(Zt<He.x||un>gt.x||Ut<He.y||hn>gt.y)&&(on=a.bp(on,He.x,He.y,gt.x,gt.y)))}for(const Zt of on){rt.reset(Zt,.25*Pt);let un=0;un=rt.length<=.5*Pt?1:Math.ceil(rt.paddedLength/Kt)+1;for(let Ut=0;Ut<un;Ut++){const hn=Ut/Math.max(un-1,1),Cn=rt.lerp(hn),Hn=Cn.x+Or,Di=Cn.y+Or;re.push(Hn,Di,Pt,0);const ti=Hn-Pt,Bi=Di-Pt,di=Hn+Pt,Oi=Di+Pt;if(St=St&&this.isOffscreen(ti,Bi,di,Oi),vt=vt||this.isInsideGrid(ti,Bi,di,Oi),!o&&this.grid.hitTestCircle(Hn,Di,Pt,q)&&(at=!0,!F))return{circles:[],offscreen:!1,collisionDetected:at,occluded:!1}}}}return{circles:!F&&at||!vt?[]:re,offscreen:St,collisionDetected:at,occluded:Re.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let f=1/0,_=1/0,v=-1/0,b=-1/0;for(const F of n){const U=new a.P(F.x+Or,F.y+Or);f=Math.min(f,U.x),_=Math.min(_,U.y),v=Math.max(v,U.x),b=Math.max(b,U.y),o.push(U)}const P=this.grid.query(f,_,v,b).concat(this.ignoredGrid.query(f,_,v,b)),D={},B={};for(const F of P){const U=F.key;if(D[U.bucketInstanceId]===void 0&&(D[U.bucketInstanceId]={}),D[U.bucketInstanceId][U.featureIndex])continue;const q=[new a.P(F.x1,F.y1),new a.P(F.x2,F.y1),new a.P(F.x2,F.y2),new a.P(F.x1,F.y2)];a.bq(o,q)&&(D[U.bucketInstanceId][U.featureIndex]=!0,B[U.bucketInstanceId]===void 0&&(B[U.bucketInstanceId]=[]),B[U.bucketInstanceId].push(U.featureIndex))}return B}insertCollisionBox(n,o,f,_,v){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:v},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,o,f,_,v){const b=o?this.ignoredGrid:this.grid,P={bucketInstanceId:f,featureIndex:_,collisionGroupID:v};for(let D=0;D<n.length;D+=4)b.insertCircle(P,n[D],n[D+1],n[D+2])}projectAndGetPerspectiveRatio(n,o,f,_,v,b,P){const D=[o,f,_,1];let B=!1;_||this.transform.pitch>0?(a.a6.vec4.transformMat4(D,D,n),this.fogState&&v&&P.name!=="globe"&&(B=function(q,$,ee,K,re,ie){const ae=ie.calculateFogTileMatrix(re),de=[$,ee,K];return a.a6.vec3.transformMat4(de,de,ae),Vt(q,a.a6.vec3.length(de),ie.pitch,ie._fov)}(this.fogState,o,f,_,v.toUnwrapped(),this.transform)>.9)):Rl(D,D,n);const F=D[3];return{point:new a.P((D[0]/F+1)/2*this.transform.width+Or,(-D[1]/F+1)/2*this.transform.height+Or),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/F*.5,1.5),signedDistanceFromCamera:F,occluded:b&&D[2]>F||B}}isOffscreen(n,o,f,_){return f<Or||n>=this.screenRightBoundary||_<Or||o>this.screenBottomBoundary}isInsideGrid(n,o,f,_){return f>=0&&n<this.gridRightBoundary&&_>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const n=a.a6.mat4.identity([]);return a.a6.mat4.translate(n,n,[-100,-100,0]),n}}function $i(d,n,o){const f=n.createTileMatrix(d,d.worldSize,o.toUnwrapped());return a.a6.mat4.multiply(new Float32Array(16),d.projMatrix,f)}function hu(d,n,o){if(n.projection.name===o.projection.name)return d.projMatrix;const f=o.clone();return f.setProjection(n.projection),$i(f,n.getProjection(),d)}function ys(d,n,o){return n.name===o.projection.name?d.projMatrix:$i(o,n,d)}class Qi{constructor(n,o,f,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Sr{constructor(n,o,f,_,v,b=!1){this.text=new Qi(n?n.text:null,o,f,v),this.icon=new Qi(n?n.icon:null,o,_,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vs{constructor(n,o,f,_=!1){this.text=n,this.icon=o,this.skipFade=f,this.clipped=_}}class At{constructor(){this.invProjMatrix=a.a6.mat4.create(),this.viewportMatrix=a.a6.mat4.create(),this.circles=[]}}class hs{constructor(n,o,f,_,v){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=v}}class Mi{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:f=>f.collisionGroupID===o}}return this.collisionGroups[n]}}function Co(d,n,o,f,_){const{horizontalAlign:v,verticalAlign:b}=a.by(d),P=-(v-.5)*n,D=-(b-.5)*o,B=a.bx(d,f);return new a.P(P+B[0]*_,D+B[1]*_)}function Zo(d,n,o,f,_){const v=new a.P(d,n);return o&&v._rotate(f?_:-_),v}class Mo{constructor(n,o,f,_,v,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Nr(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Mi(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,o,f,_,v=1){const b=f.getBucket(o),P=f.latestFeatureIndex;if(!b||!P||o.fqid!==b.layerIds[0])return;const D=b.layers[0].layout,B=b.layers[0].paint,F=f.collisionBoxArray,U=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),q=f.tileSize/a.ab,$=f.tileID.toUnwrapped();this.transform.setProjection(b.projection);const ee=(K=f.tileID,re=b.getProjection(),ie=this.transform,re.name===this.projection?ie.calculateProjMatrix(K.toUnwrapped()):$i(ie,re,K));var K,re,ie;const ae=D.get("text-pitch-alignment")==="map",de=D.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const fe=o.dynamicFilter(),be=o.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(f),we=cn(ee,f.tileID.canonical,ae,de,this.transform,b.getProjection(),Ee);let Ie=null;if(ae){const vt=is(ee,f.tileID.canonical,ae,de,this.transform,b.getProjection(),Ee);Ie=a.a6.mat4.multiply([],this.transform.labelPlaneMatrix,vt)}let Re=null;fe&&f.latestFeatureIndex&&(Re={unwrappedTileID:$,dynamicFilter:fe,dynamicFilterNeedsFeature:be}),this.retainedQueryData[b.bucketInstanceId]=new hs(b.bucketInstanceId,P,b.sourceLayerIndex,b.index,f.tileID);const Be=b.layers[0].layout.get("text-size-scale-range"),Ne=a.ap(v,Be[0],Be[1]),De=b.layers[0].layout.get("icon-size-scale-range"),Je=a.ap(v,De[0],De[1]),at={bucket:b,layout:D,paint:B,posMatrix:ee,textLabelPlaneMatrix:we,labelToScreenMatrix:Ie,clippingData:Re,scale:U,textPixelRatio:q,holdingForFade:f.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:a.bk(b.textSizeData,this.transform.zoom,Ne),partiallyEvaluatedIconSize:a.bk(b.iconSizeData,this.transform.zoom,Je),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(const vt of b.sortKeyRanges){const{sortKey:St,symbolInstanceStart:Pt,symbolInstanceEnd:He}=vt;n.push({sortKey:St,symbolInstanceStart:Pt,symbolInstanceEnd:He,parameters:at})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:at})}attemptAnchorPlacement(n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re,ie,ae){const{textOffset0:de,textOffset1:fe,crossTileID:be}=q,Ee=[de,fe],we=Co(n,f,_,Ee,v),Ie=this.collisionIndex.placeCollisionBox(ee,v,o,Zo(we.x,we.y,b,P,this.transform.angle),U,D,B,F.predicate);if(re){const Re=ee.getSymbolInstanceIconSize(ae,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,Re,re,Zo(we.x,we.y,b,P,this.transform.angle),U,D,B,F.predicate).box.length===0)return}if(Ie.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Re=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Ee,width:f,height:_,anchor:n,textScale:v,prevAnchor:Re},this.markUsedJustification(ee,n,q,K),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,K,q),this.placedOrientations[be]=K),{shift:we,placedGlyphBoxes:Ie}}}placeLayerBucketPart(n,o,f,_,v=1){const{bucket:b,layout:P,paint:D,posMatrix:B,textLabelPlaneMatrix:F,labelToScreenMatrix:U,clippingData:q,textPixelRatio:$,holdingForFade:ee,collisionBoxArray:K,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ie,collisionGroup:ae,latestFeatureIndex:de}=n.parameters,fe=P.get("text-optional"),be=P.get("icon-optional"),Ee=P.get("text-allow-overlap"),we=P.get("icon-allow-overlap"),Ie=P.get("text-rotation-alignment")==="map",Re=P.get("text-pitch-alignment")==="map",Be=P.get("symbol-z-elevate"),Ne=D.get("symbol-z-offset"),De=P.get("symbol-elevation-reference")==="sea",Je=P.get("text-size-scale-range"),at=P.get("icon-size-scale-range"),vt=a.ap(v,Je[0],Je[1]),St=a.ap(v,at[0],at[1]);this.transform.setProjection(b.projection);let Pt=Ee&&(we||!b.hasIconData()||be),He=we&&(Ee||!b.hasTextData()||fe);const gt=!Ne.isConstant();!b.collisionArrays&&K&&b.deserializeCollisionBoxes(K),f&&_&&b.updateCollisionDebugBuffers(this.transform.zoom,K,vt,St);const rt=(_t,xt,mt)=>{const{crossTileID:Ot,numVerticalGlyphVertices:Kt}=_t;let on=null;if(q&&q.dynamicFilterNeedsFeature||gt){const Kn=this.retainedQueryData[b.bucketInstanceId];on=de.loadFeature({featureIndex:_t.featureIndex,bucketIndex:Kn.bucketIndex,sourceLayerIndex:Kn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(q&&!(0,q.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},on,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new a.P(_t.tileAnchorX,_t.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[Ot]=new vs(!1,!1,!1,!0),void o.add(Ot);const Zt=Ne.evaluate(on,{});if(o.has(Ot))return;if(ee)return void(this.placements[Ot]=new vs(!1,!1,!1));let un=!1,Ut=!1,hn=!0,Cn=!1,Hn=!1,Di=null,ti={box:null,offscreen:null,occluded:null},Bi={box:null,offscreen:null,occluded:null},di=null,Oi=null,kn=null,Pi=0,Ti=0,mi=0;mt.textFeatureIndex?Pi=mt.textFeatureIndex:_t.useRuntimeCollisionCircles&&(Pi=_t.featureIndex),mt.verticalTextFeatureIndex&&(Ti=mt.verticalTextFeatureIndex);const qi=Kn=>{Kn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const $n=this.transform.elevation;Kn.elevation=De?Zt:Zt+($n?$n.getAtTileOffset(Kn.tileID,Kn.tileAnchorX,Kn.tileAnchorY):0),Kn.elevation+=_t.zOffset},Br=mt.textBox;if(Br){qi(Br);const Kn=fi=>{let Ni=a.bl.horizontal;if(b.allowVerticalPlacement&&!fi&&this.prevPlacement){const ur=this.prevPlacement.placedOrientations[Ot];ur&&(this.placedOrientations[Ot]=ur,Ni=ur,this.markUsedOrientation(b,Ni,_t))}return Ni},$n=(fi,Ni)=>{if(b.allowVerticalPlacement&&Kt>0&&mt.verticalTextBox){for(const ur of b.writingModes)if(ur===a.bl.vertical?(ti=Ni(),Bi=ti):ti=fi(),ti&&ti.box&&ti.box.length)break}else ti=fi()};if(P.get("text-variable-anchor")){let fi=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ot]){const ji=this.prevPlacement.variableOffsets[Ot];fi.indexOf(ji.anchor)>0&&(fi=fi.filter(as=>as!==ji.anchor),fi.unshift(ji.anchor))}const Ni=(ji,as,xl)=>{const wo=b.getSymbolInstanceTextSize(re,_t,this.transform.zoom,xt),Eo=(ji.x2-ji.x1)*wo+2*ji.padding,la=(ji.y2-ji.y1)*wo+2*ji.padding,Ba=_t.hasIconTextFit&&!we?as:null;Ba&&qi(Ba);let Io={box:[],offscreen:!1,occluded:!1};const Ql=Ee?2*fi.length:fi.length;for(let ua=0;ua<Ql;++ua){const _i=this.attemptAnchorPlacement(fi[ua%fi.length],ji,Eo,la,wo,Ie,Re,$,B,ae,ua>=fi.length,_t,xt,b,xl,Ba,re,ie);if(_i&&(Io=_i.placedGlyphBoxes,Io&&Io.box&&Io.box.length)){un=!0,Di=_i.shift;break}}return Io};$n(()=>Ni(Br,mt.iconBox,a.bl.horizontal),()=>{const ji=mt.verticalTextBox;return ji&&qi(ji),b.allowVerticalPlacement&&!(ti&&ti.box&&ti.box.length)&&Kt>0&&ji?Ni(ji,mt.verticalIconBox,a.bl.vertical):{box:null,offscreen:null,occluded:null}}),ti&&(un=ti.box,hn=ti.offscreen,Cn=ti.occluded);const ur=Kn(!(!ti||!ti.box));if(!un&&this.prevPlacement){const ji=this.prevPlacement.variableOffsets[Ot];ji&&(this.variableOffsets[Ot]=ji,this.markUsedJustification(b,ji.anchor,_t,ur))}}else{const fi=(Ni,ur)=>{const ji=b.getSymbolInstanceTextSize(re,_t,this.transform.zoom,xt,v),as=this.collisionIndex.placeCollisionBox(b,ji,Ni,new a.P(0,0),Ee,$,B,ae.predicate);return as&&as.box&&as.box.length&&(this.markUsedOrientation(b,ur,_t),this.placedOrientations[Ot]=ur),as};$n(()=>fi(Br,a.bl.horizontal),()=>{const Ni=mt.verticalTextBox;return b.allowVerticalPlacement&&Kt>0&&Ni?(qi(Ni),fi(Ni,a.bl.vertical)):{box:null,offscreen:null,occluded:null}}),Kn(!!(ti&&ti.box&&ti.box.length))}}if(di=ti,un=di&&di.box&&di.box.length>0,hn=di&&di.offscreen,Cn=di&&di.occluded,_t.useRuntimeCollisionCircles){const Kn=b.text.placedSymbolArray.get(_t.centerJustifiedTextSymbolIndex>=0?_t.centerJustifiedTextSymbolIndex:_t.verticalPlacedTextSymbolIndex),$n=a.bm(b.textSizeData,re,Kn),fi=P.get("text-padding");Oi=this.collisionIndex.placeCollisionCircles(b,Ee,Kn,b.lineVertexArray,b.glyphOffsetArray,$n,B,F,U,f,Re,ae.predicate,_t.collisionCircleDiameter*$n/a.br,fi,this.retainedQueryData[b.bucketInstanceId].tileID),un=Ee||Oi.circles.length>0&&!Oi.collisionDetected,hn=hn&&Oi.offscreen,Cn=Oi.occluded}if(mt.iconFeatureIndex&&(mi=mt.iconFeatureIndex),mt.iconBox){const Kn=$n=>{qi($n);const fi=_t.hasIconTextFit&&Di?Zo(Di.x,Di.y,Ie,Re,this.transform.angle):new a.P(0,0),Ni=b.getSymbolInstanceIconSize(ie,this.transform.zoom,_t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Ni,$n,fi,we,$,B,ae.predicate)};Bi&&Bi.box&&Bi.box.length&&mt.verticalIconBox?(kn=Kn(mt.verticalIconBox),Ut=kn.box.length>0):(kn=Kn(mt.iconBox),Ut=kn.box.length>0),hn=hn&&kn.offscreen,Hn=kn.occluded}const Bo=fe||_t.numHorizontalGlyphVertices===0&&Kt===0,aa=be||_t.numIconVertices===0;if(Bo||aa?aa?Bo||(Ut=Ut&&un):un=Ut&&un:Ut=un=Ut&&un,un&&di&&di.box&&this.collisionIndex.insertCollisionBox(di.box,P.get("text-ignore-placement"),b.bucketInstanceId,Bi&&Bi.box&&Ti?Ti:Pi,ae.ID),Ut&&kn&&this.collisionIndex.insertCollisionBox(kn.box,P.get("icon-ignore-placement"),b.bucketInstanceId,mi,ae.ID),Oi&&(un&&this.collisionIndex.insertCollisionCircles(Oi.circles,P.get("text-ignore-placement"),b.bucketInstanceId,Pi,ae.ID),f)){const Kn=b.bucketInstanceId;let $n=this.collisionCircleArrays[Kn];$n===void 0&&($n=this.collisionCircleArrays[Kn]=new At);for(let fi=0;fi<Oi.circles.length;fi+=4)$n.circles.push(Oi.circles[fi+0]),$n.circles.push(Oi.circles[fi+1]),$n.circles.push(Oi.circles[fi+2]),$n.circles.push(Oi.collisionDetected?1:0)}const Jr=b.projection.name!=="globe";Pt=Pt&&(Jr||!Cn),He=He&&(Jr||!Hn),this.placements[Ot]=new vs(un||Pt,Ut||He,hn||b.justReloaded),o.add(Ot)};if(Be&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,this.retainedQueryData[b.bucketInstanceId].tileID),b.updateZOffset()),b.sortFeaturesByY){const _t=b.getSortedSymbolIndexes(this.transform.angle);for(let xt=_t.length-1;xt>=0;--xt){const mt=_t[xt];rt(b.symbolInstances.get(mt),mt,b.collisionArrays[mt])}b.hasAnyZOffset&&a.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const _t=b.getSortedIndexesByZOffset();for(let xt=0;xt<_t.length;++xt){const mt=_t[xt];rt(b.symbolInstances.get(mt),mt,b.collisionArrays[mt])}}else for(let _t=n.symbolInstanceStart;_t<n.symbolInstanceEnd;_t++)rt(b.symbolInstances.get(_t),_t,b.collisionArrays[_t]);if(f&&b.bucketInstanceId in this.collisionCircleArrays){const _t=this.collisionCircleArrays[b.bucketInstanceId];a.a6.mat4.invert(_t.invProjMatrix,B),_t.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,o,f,_){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:D,crossTileID:B}=f,F=a.bw(o),U=_===a.bl.vertical?D:F==="left"?v:F==="center"?b:F==="right"?P:-1;v>=0&&(n.text.placedSymbolArray.get(v).crossTileID=U>=0&&v!==U?0:B),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:B),P>=0&&(n.text.placedSymbolArray.get(P).crossTileID=U>=0&&P!==U?0:B),D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=U>=0&&D!==U?0:B)}markUsedOrientation(n,o,f){const _=o===a.bl.horizontal||o===a.bl.horizontalOnly?o:0,v=o===a.bl.vertical?o:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:B}=f,F=n.text.placedSymbolArray;b>=0&&(F.get(b).placedOrientation=_),P>=0&&(F.get(P).placedOrientation=_),D>=0&&(F.get(D).placedOrientation=_),B>=0&&(F.get(B).placedOrientation=v)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let f=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const _=o?o.symbolFadeChange(n):1,v=o?o.opacities:{},b=o?o.variableOffsets:{},P=o?o.placedOrientations:{};for(const D in this.placements){const B=this.placements[D],F=v[D];F?(this.opacities[D]=new Sr(F,_,B.text,B.icon,null,B.clipped),f=f||B.text!==F.text.placed||B.icon!==F.icon.placed):(this.opacities[D]=new Sr(null,_,B.text,B.icon,B.skipFade,B.clipped),f=f||B.text||B.icon)}for(const D in v){const B=v[D];if(!this.opacities[D]){const F=new Sr(B,_,!1,!1);F.isHidden()||(this.opacities[D]=F,f=f||B.text.placed||B.icon.placed)}}for(const D in b)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=b[D]);for(const D in P)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=P[D]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)}updateLayerOpacities(n,o,f,_){const v=new Set;for(const b of o){const P=b.getBucket(n);P&&b.latestFeatureIndex&&n.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,v,b,b.collisionBoxArray,f,_,b.tileID,n.scope),P.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(P,b.tileID),P.updateZOffset()))}}updateBucketOpacities(n,o,f,_,v,b,P,D){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const B=n.layers[0].layout,F=n.layers[0].paint,U=!!n.layers[0].dynamicFilter(),q=new Sr(null,0,!1,!1,!0),$=B.get("text-allow-overlap"),ee=B.get("icon-allow-overlap"),K=B.get("text-variable-anchor"),re=B.get("text-rotation-alignment")==="map",ie=B.get("text-pitch-alignment")==="map",ae=F.get("symbol-z-offset"),de=B.get("symbol-elevation-reference")==="sea",fe=!ae.isConstant(),be=new Sr(null,0,$&&(ee||!n.hasIconData()||B.get("icon-optional")),ee&&($||!n.hasTextData()||B.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const Ee=(Ie,Re,Be)=>{for(let Ne=0;Ne<Re/4;Ne++)Ie.opacityVertexArray.emplaceBack(Be)};let we=0;b&&n.updateReplacement(P,b);for(let Ie=0;Ie<n.symbolInstances.length;Ie++){const Re=n.symbolInstances.get(Ie),{numHorizontalGlyphVertices:Be,numVerticalGlyphVertices:Ne,crossTileID:De,numIconVertices:Je,tileAnchorX:at,tileAnchorY:vt}=Re;let St=null;const Pt=this.retainedQueryData[n.bucketInstanceId];fe&&Re&&Pt&&(St=f.latestFeatureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:Pt.bucketIndex,sourceLayerIndex:Pt.sourceLayerIndex,layoutVertexArrayOffset:0}));const He=ae.evaluate(St,{}),gt=o.has(De);let rt=this.opacities[De];gt?rt=q:rt||(rt=be,this.opacities[De]=rt),o.add(De);const _t=Be>0||Ne>0,xt=Je>0,mt=this.placedOrientations[De],Ot=mt===a.bl.vertical,Kt=mt===a.bl.horizontal||mt===a.bl.horizontalOnly;!_t&&!xt||rt.isHidden()||we++;let on=!1;if((_t||xt)&&b)for(const Zt of n.activeReplacements){if(a.bs(Zt,v,a.bt.Symbol,D)||Zt.min.x>at||at>Zt.max.x||Zt.min.y>vt||vt>Zt.max.y)continue;const un=a.bu(at,vt,P.canonical,Zt.footprintTileId.canonical);if(on=a.bv(un,Zt.footprint),on)break}if(_t){const Zt=on?Ya:Xa(rt.text);Ee(n.text,Be,Ot?Ya:Zt),Ee(n.text,Ne,Kt?Ya:Zt);const un=rt.text.isHidden(),{leftJustifiedTextSymbolIndex:Ut,centerJustifiedTextSymbolIndex:hn,rightJustifiedTextSymbolIndex:Cn,verticalPlacedTextSymbolIndex:Hn}=Re,Di=n.text.placedSymbolArray,ti=un||Ot?1:0;Ut>=0&&(Di.get(Ut).hidden=ti),hn>=0&&(Di.get(hn).hidden=ti),Cn>=0&&(Di.get(Cn).hidden=ti),Hn>=0&&(Di.get(Hn).hidden=un||Kt?1:0);const Bi=this.variableOffsets[De];Bi&&this.markUsedJustification(n,Bi.anchor,Re,mt);const di=this.placedOrientations[De];di&&(this.markUsedJustification(n,"left",Re,di),this.markUsedOrientation(n,di,Re))}if(xt){const Zt=on?Ya:Xa(rt.icon),{placedIconSymbolIndex:un,verticalPlacedIconSymbolIndex:Ut}=Re,hn=n.icon.placedSymbolArray,Cn=rt.icon.isHidden()?1:0;un>=0&&(Ee(n.icon,Je,Ot?Ya:Zt),hn.get(un).hidden=Cn),Ut>=0&&(Ee(n.icon,Re.numVerticalIconVertices,Kt?Ya:Zt),hn.get(Ut).hidden=Cn)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Zt=n.collisionArrays[Ie];if(Zt){let un=new a.P(0,0),Ut=!0;if(Zt.textBox||Zt.verticalTextBox){if(K){const Cn=this.variableOffsets[De];Cn?(un=Co(Cn.anchor,Cn.width,Cn.height,Cn.textOffset,Cn.textScale),re&&un._rotate(ie?this.transform.angle:-this.transform.angle)):Ut=!1}U&&(Ut=!rt.clipped),Zt.textBox&&Ao(n.textCollisionBox.collisionVertexArray,rt.text.placed,!Ut||Ot,He,de,un.x,un.y),Zt.verticalTextBox&&Ao(n.textCollisionBox.collisionVertexArray,rt.text.placed,!Ut||Kt,He,de,un.x,un.y)}const hn=Ut&&!!(!Kt&&Zt.verticalIconBox);Zt.iconBox&&Ao(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,hn,He,de,Re.hasIconTextFit?un.x:0,Re.hasIconTextFit?un.y:0),Zt.verticalIconBox&&Ao(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,!hn,He,de,Re.hasIconTextFit?un.x:0,Re.hasIconTextFit?un.y:0)}}}if(n.fullyClipped=we===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Ie=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Ie.invProjMatrix,n.placementViewportMatrix=Ie.viewportMatrix,n.collisionCircleArray=Ie.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,o){const f=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function Ao(d,n,o,f,_,v,b){d.emplaceBack(n?1:0,o?1:0,v||0,b||0,f,_?1:0),d.emplaceBack(n?1:0,o?1:0,v||0,b||0,f,_?1:0),d.emplaceBack(n?1:0,o?1:0,v||0,b||0,f,_?1:0),d.emplaceBack(n?1:0,o?1:0,v||0,b||0,f,_?1:0)}const rs=Math.pow(2,25),du=Math.pow(2,24),uo=Math.pow(2,17),zr=Math.pow(2,16),Dl=Math.pow(2,9),Vs=Math.pow(2,8),ju=Math.pow(2,1);function Xa(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const n=d.placed?1:0,o=Math.floor(127*d.opacity);return o*rs+n*du+o*uo+n*zr+o*Dl+n*Vs+o*ju+n}const Ya=0;class Cc{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,o,f,_,v,b){const P=this._bucketParts;for(;this._currentTileIndex<n.length;)if(o.getBucketParts(P,_,n[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((D,B)=>D.sortKey-B.sortKey));this._currentPartIndex<P.length;){const D=P[this._currentPartIndex];if(o.placeLayerBucketPart(D,this._seenCrossTileIDs,f,D.symbolInstanceStart===0,b),this._currentPartIndex++,v())return!0}return!1}}class ss{constructor(n,o,f,_,v,b,P,D,B){this.placement=new Mo(n,v,b,P,D,B),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,o,f,_,v){const b=a.q.now(),P=()=>{const D=a.q.now()-b;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=o[n[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=B)&&(!D.maxzoom||D.maxzoom>B)){const F=D,U=F.layout.get("symbol-z-elevate"),q=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,$=F.layout.get("symbol-z-order"),ee=$==="viewport-y"||$==="auto"&&!($!=="viewport-y"&&q),K=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),re=ee&&K,ie=this._inProgressLayer=this._inProgressLayer||new Cc(F),ae=a.av(D.source,D.scope);if(ie.continuePlacement(U||re?_[ae]:f[ae],this.placement,this._showCollisionBoxes,D,P,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Xs=512/a.ab/2;class Mc{constructor(n,o,f){this.tileID=n,this.bucketInstanceId=f,this.index=new a.bz(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=n.canonical.x*a.ab,v=n.canonical.y*a.ab;for(let b=0;b<o.length;b++){const{key:P,crossTileID:D,tileAnchorX:B,tileAnchorY:F}=o.get(b),U=Math.floor((_+B)*Xs),q=Math.floor((v+F)*Xs);this.index.add(U,q),this.keys.push(P),this.crossTileIDs.push(D)}this.index.finish()}findMatches(n,o,f){const _=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),v=Xs/Math.pow(2,o.canonical.z-this.tileID.canonical.z),b=o.canonical.x*a.ab,P=o.canonical.y*a.ab;for(let D=0;D<n.length;D++){const B=n.get(D);if(B.crossTileID)continue;const{key:F,tileAnchorX:U,tileAnchorY:q}=B,$=Math.floor((b+U)*v),ee=Math.floor((P+q)*v),K=this.index.range($-_,ee-_,$+_,ee+_);for(const re of K){const ie=this.crossTileIDs[re];if(this.keys[re]===F&&!f.has(ie)){f.add(ie),B.crossTileID=ie;break}}}}}class Po{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ac{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const o=Math.round((n-this.lng)/360);if(o!==0)for(const f in this.indexes){const _=this.indexes[f],v={};for(const b in _){const P=_[b];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+o),v[P.tileID.key]=P}this.indexes[f]=v}this.lng=n}addBucket(n,o,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let v=0;v<o.symbolInstances.length;v++)o.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const _=this.usedCrossTileIDs[n.overscaledZ];for(const v in this.indexes){const b=this.indexes[v];if(Number(v)>n.overscaledZ)for(const P in b){const D=b[P];D.tileID.isChildOf(n)&&D.findMatches(o.symbolInstances,n,_)}else{const P=b[n.scaledTo(Number(v)).key];P&&P.findMatches(o.symbolInstances,n,_)}}for(let v=0;v<o.symbolInstances.length;v++){const b=o.symbolInstances.get(v);b.crossTileID||(b.crossTileID=f.generate(),_.add(b.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Mc(n,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(n,o){for(const f of o.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let o=!1;for(const f in this.indexes){const _=this.indexes[f];for(const v in _)n[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[v]),delete _[v],o=!0)}return o}}class Ys{constructor(){this.layerIndexes={},this.crossTileIDs=new Po,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,o,f,_){let v=this.layerIndexes[n.fqid];v===void 0&&(v=this.layerIndexes[n.fqid]=new Ac);let b=!1;const P={};_.name!=="globe"&&v.handleWrapJump(f);for(const D of o){const B=D.getBucket(n);B&&n.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,B,this.crossTileIDs)&&(b=!0),P[B.bucketInstanceId]=!0)}return v.removeStaleBuckets(P)&&(b=!0),b}pruneUnusedLayers(n){const o={};n.forEach(f=>{o[f]=!0});for(const f in this.layerIndexes)o[f]||delete this.layerIndexes[f]}}const xs=771;class An{constructor(n,o,f,_){this.blendFunction=n,this.blendColor=o,this.mask=f,this.blendEquation=_}}An.Replace=[1,0,1,0],An.disabled=new An(An.Replace,a.bA.transparent,[!1,!1,!1,!1]),An.unblended=new An(An.Replace,a.bA.transparent,[!0,!0,!0,!0]),An.alphaBlended=new An([1,xs,1,xs],a.bA.transparent,[!0,!0,!0,!0]),An.alphaBlendedNonPremultiplied=new An([770,xs,770,xs],a.bA.transparent,[!0,!0,!0,!0]),An.multiply=new An([774,0,774,0],a.bA.transparent,[!0,!0,!0,!0]);class rn{constructor(n,o,f){this.func=n,this.mask=o,this.range=f}}rn.ReadOnly=!1,rn.ReadWrite=!0,rn.disabled=new rn(519,rn.ReadOnly,[0,1]);const va=7680;class xn{constructor(n,o,f,_,v,b){this.test=n,this.ref=o,this.mask=f,this.fail=_,this.depthFail=v,this.pass=b}}xn.disabled=new xn({func:519,mask:0},0,0,va,va,va);const fu=1029,Ja=2305;class mn{constructor(n,o,f){this.enable=n,this.mode=o,this.frontFace=f}}function Fr(d,n){const o=a.bD(d,3);a.a6.mat4.fromQuat(d,n),a.bF(d,3,o)}function Ol(d,n){const o=a.a6.quat.identity([]);return a.a6.quat.rotateZ(o,o,-n),a.a6.quat.rotateX(o,o,-d),o}function Nl(d,n){const o=[d[0],d[1],0],f=[n[0],n[1],0];if(a.a6.vec3.length(o)>=1e-15){const b=a.a6.vec3.normalize([],o);a.a6.vec3.scale(f,b,a.a6.vec3.dot(f,b)),n[0]=f[0],n[1]=f[1]}const _=a.a6.vec3.cross([],n,d);if(a.a6.vec3.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return Ol(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}mn.disabled=new mn(!1,fu,Ja),mn.backCCW=new mn(!0,fu,Ja),mn.backCW=new mn(!0,fu,2304),mn.frontCW=new mn(!0,1028,2304),mn.frontCCW=new mn(!0,1028,Ja);class Lo{constructor(n,o){this.position=n,this.orientation=o}get position(){return this._position}set position(n){if(n){const o=n instanceof a.a5?n:new a.a5(n[0],n[1],n[2]);this._renderWorldCopies&&(o.x=a.bB(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(n,o){if(this.orientation=null,!this.position)return;const f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(a.a5.fromLngLat(n)):0,v=a.a5.fromLngLat(n,_),b=[v.x-f.x,v.y-f.y,v.z-f.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Nl(b,o)}setPitchBearing(n,o){this.orientation=Ol(a.bC(n),a.bC(-o))}}class Wo{constructor(n,o){this._transform=a.a6.mat4.identity([]),this.orientation=o,this.position=n}get mercatorPosition(){const n=this.position;return new a.a5(n[0],n[1],n[2])}get position(){const n=a.bD(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var o;n&&a.bF(this._transform,3,[(o=n)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||a.a6.quat.identity([]),n&&Fr(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,o){this._orientation=Ol(n,o),Fr(this._transform,this._orientation)}forward(){const n=a.bD(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=a.bD(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=a.bD(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,o){const f=new Float64Array(16);return a.a6.mat4.invert(f,this.getWorldToCamera(n,o)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,o,f){const _=this.position;a.a6.vec3.scale(_,_,-n);const v=new Float64Array(16);return a.a6.mat4.fromScaling(v,[f,f,f]),a.a6.mat4.translate(v,v,_),v[10]*=o,v}getWorldToCamera(n,o){const f=new Float64Array(16),_=new Float64Array(4),v=this.position;return a.a6.quat.conjugate(_,this._orientation),a.a6.vec3.scale(v,v,-n),a.a6.mat4.fromQuat(f,_),a.a6.mat4.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=o,f[9]*=o,f[10]*=o,f[11]*=o,f}getCameraToClipPerspective(n,o,f,_){const v=new Float64Array(16);return a.a6.mat4.perspective(v,n,o,f,_),v}getCameraToClipOrthographic(n,o,f,_,v,b){const P=new Float64Array(16);return a.a6.mat4.ortho(P,n,o,f,_,v,b),P}getDistanceToElevation(n,o=!1){const f=n===0?0:a.bE(n,o?a.aN(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Wo([...this.position],[...this.orientation])}}const Hr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class pu{constructor(n=0,o=0,f=0,_=0){if(isNaN(n)||n<0||isNaN(o)||o<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=f,this.right=_}interpolate(n,o,f){return o.top!=null&&n.top!=null&&(this.top=a.aa(n.top,o.top,f)),o.bottom!=null&&n.bottom!=null&&(this.bottom=a.aa(n.bottom,o.bottom,f)),o.left!=null&&n.left!=null&&(this.left=a.aa(n.left,o.left,f)),o.right!=null&&n.right!=null&&(this.right=a.aa(n.right,o.right,f)),this}getCenter(n,o){const f=a.ap((this.left+n-this.right)/2,0,n),_=a.ap((this.top+o-this.bottom)/2,0,o);return new a.P(f,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new pu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const $o=(d,n,o)=>(1-o)*d+o*n,Ka=d=>d*d*d*d*d;class Ps{constructor(n,o,f,_,v,b,P){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(b),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new a.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new pu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Wo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new Ps(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,o=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return a.ar(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=a.bM(this.projectionOptions);const f=this.getProjection(),_=!a.bi(o,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.bM({name:"mercator"});const o=n!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bB(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const o=-n*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=a.a6.mat2.create(),a.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const o=a.ap(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=a.bC(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,v=0;for(let b=0;b<o.length;b++){const P=new a.P(o[b][0]*this.width,f+o[b][1]*(this.height-f)),D=n.pointCoordinate(P);if(!D)continue;const B=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);_+=D[3]*B,v+=B}return v===0?NaN:_/v}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*o,_=this._mercatorZfromZoom(n),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-f,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[o.x,o.y,o.z]:[n.x,n.y,n.z];const _=a.a6.vec3.length(a.a6.vec3.sub([],this._camera.position,f));return a.ap(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let o=!1;if(n.orientation&&!a.a6.quat.exactEquals(n.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];a.a6.vec3.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,o=new Lo;return o.position=new a.a5(n[0],n[1],n[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(n){if(!a.a6.quat.length(n))return!1;a.a6.quat.normalize(n,n);const o=a.a6.vec3.transformQuat([],[0,0,-1],n),f=a.a6.vec3.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const _=Nl(o,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const o=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=a.ap(n[2],_/f,_/o),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,o,f){this._unmodified=!1,this._edgeInsets.interpolate(n,o,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(n){const o=[new a.bN(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new a.P(0,0)),_=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),b=this.pointCoordinate(new a.P(0,this.height)),P=Math.floor(Math.min(f.x,_.x,v.x,b.x)),D=Math.floor(Math.max(f.x,_.x,v.x,b.x)),B=1;for(let F=P-B;F<=D+B;F++)F!==0&&o.push(new a.bN(F,n))}return o}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,o,f){let _=[];const v=f!==void 0,b=!v;if(b&&this.zoom<o||v&&f[0]===0&&f[1]===0)return _;const P=new Set,D=(F,U,q,$,ee)=>{const K=a.c2(U,F,q,$,ee);P.has(K)||(_.push(new a.aA(F,U,q,$,ee)),P.add(K))};for(let F=0;F<n.length;F++){const U=n[F];if(b&&U.canonical.z!==o)continue;const q=U.canonical,$=U.overscaledZ,ee=U.wrap,K=1<<q.z,re=q.x+1<K,ie=q.x>0,ae=q.y+1<K,de=q.y>0,fe=U.wrap-(ie?0:1),be=U.wrap+(re?0:1),Ee=ie?q.x-1:K-1,we=re?q.x+1:0;if(v)f[0]<0?(D($,be,q.z,we,q.y),f[1]<0&&ae&&(D($,ee,q.z,q.x,q.y+1),D($,be,q.z,we,q.y+1)),f[1]>0&&de&&(D($,ee,q.z,q.x,q.y-1),D($,be,q.z,we,q.y-1))):f[0]>0?(D($,fe,q.z,Ee,q.y),f[1]<0&&ae&&(D($,ee,q.z,q.x,q.y+1),D($,fe,q.z,Ee,q.y+1)),f[1]>0&&de&&(D($,ee,q.z,q.x,q.y-1),D($,fe,q.z,Ee,q.y-1))):f[1]<0&&ae?D($,ee,q.z,q.x,q.y+1):de&&D($,ee,q.z,q.x,q.y-1);else{const Ie=U.visibleQuadrants;1&Ie&&(D($,fe,q.z,Ee,q.y),de&&(D($,ee,q.z,q.x,q.y-1),D($,fe,q.z,Ee,q.y-1))),2&Ie&&(D($,be,q.z,we,q.y),de&&(D($,ee,q.z,q.x,q.y-1),D($,be,q.z,we,q.y-1))),4&Ie&&(D($,fe,q.z,Ee,q.y),ae&&(D($,ee,q.z,q.x,q.y+1),D($,fe,q.z,Ee,q.y+1))),8&Ie&&(D($,be,q.z,we,q.y),ae&&(D($,ee,q.z,q.x,q.y+1),D($,be,q.z,we,q.y+1)))}}const B=[];for(const F of _)_.some(U=>F.isChildOf(U))||B.push(F);if(_=B.filter(F=>!n.some(U=>!!(F.overscaledZ<o&&U.isChildOf(F))||F.equals(U)||F.isChildOf(U))),b){const F=1<<o,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[F*U.x,F*U.y],$=4,ee=$*$;_=_.filter(K=>{const re=K.canonical.x+.5-q[0],ie=K.canonical.y+.5-q[1];return re*re+ie*ie<ee})}return _}coveringTiles(n){let o=this.coveringZoomLevel(n);const f=o,_=this.elevation&&this.elevation.exaggeration(),v=_&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&o<n.minzoom)return[];n.maxzoom!==void 0&&o>n.maxzoom&&(o=n.maxzoom);const P=this.locationCoordinate(this.center),D=this.center.lat,B=1<<o,F=[B*P.x,B*P.y,0],U=this.projection.name==="globe",q=!U,$=a.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,q),ee=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=B*a.bE(1,this.center.lat),re=this._camera.position[2]/a.bE(1,this.center.lat),ie=[B*ee.x,B*ee.y,re*(q?1:K)],ae=U||_,de=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),fe=this.isLODDisabled(!0)?o:0;let be;if(this._elevation&&n.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const He=this._elevation.getMinMaxForVisibleTiles();be=He?He.max:this._centerAltitude}else be=this._centerAltitude;const Ee=n.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,we=this.projection.isReprojectedInTileSpace?a.bP(this):1,Ie=He=>{const rt=new a.a5(He.x+25e-6,He.y,He.z),_t=new a.a5(He.x,He.y+25e-6,He.z),xt=He.toLngLat(),mt=rt.toLngLat(),Ot=_t.toLngLat(),Kt=this.locationCoordinate(xt),on=this.locationCoordinate(mt),Zt=this.locationCoordinate(Ot),un=Math.hypot(on.x-Kt.x,on.y-Kt.y),Ut=Math.hypot(Zt.x-Kt.x,Zt.y-Kt.y);return Math.sqrt(un*Ut)*we/25e-6},Re=He=>{const gt=be,rt=Ee;return{aabb:a.bS(this,B,0,0,0,He,rt,gt,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:gt,wrap:He,fullyVisible:!1}},Be=[];let Ne=[];const De=o,Je=n.reparseOverscaled?f:o,at=(re-this._centerAltitude)*K,vt=He=>{if(!this._elevation||!He.tileID||!b)return;const gt=this._elevation.getMinMaxForTile(He.tileID),rt=He.aabb;gt?(rt.min[2]=gt.min,rt.max[2]=gt.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(He.shouldSplit=Pt(He),He.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},St=(He,gt)=>{if(.707*gt<He)return 1;const rt=gt/He;return rt/(1.4144271570014144+(Math.pow(1.1,rt-1.4144271570014144+1)-1)/(1.1-1)-1)},Pt=He=>{if(He.zoom<fe)return!0;if(He.zoom===De)return!1;if(He.shouldSplit!=null)return He.shouldSplit;const gt=He.aabb.distanceX(ie),rt=He.aabb.distanceY(ie);let _t=at,xt=1;if(U){_t=He.aabb.distanceZ(ie);const Ut=Math.pow(2,He.zoom),hn=a.aN((He.y+1)/Ut),Cn=a.aN(He.y/Ut),Hn=Math.min(Math.max(D,hn),Cn),Di=a.c6(Hn)/a.c6(D);if(xt=Hn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Di/this._mercatorScaleRatio),this.zoom<=a.c3&&He.zoom===De-1&&Di>=.9)return!0}else if(v&&(_t=He.aabb.distanceZ(ie)*K),this.projection.isReprojectedInTileSpace&&f<=5){const Ut=Math.pow(2,He.zoom),hn=Ie(new a.a5((He.x+.5)/Ut,(He.y+.5)/Ut));xt=hn>.85?1:hn}if(!b){const Ut=Math.sqrt(gt*gt+rt*rt+_t*_t);let hn=(1<<De-He.zoom)*de*xt;return hn*=St(Math.max(_t,at),Ut),Ut<hn}let mt=Number.MAX_VALUE,Ot=0;const Kt=He.aabb.getCorners(),on=[];for(const Ut of Kt){a.a6.vec3.sub(on,Ut,ie),U||(v?on[2]*=K:on[2]=at);const hn=a.a6.vec3.dot(on,this._camera.forward());hn<mt&&(mt=hn,Ot=Math.abs(on[2]))}let Zt=(1<<De-He.zoom)*de*xt;if(Zt*=St(Math.max(Ot,at),mt),mt<Zt)return!0;const un=He.aabb.closestPoint(F);return un[0]===F[0]&&un[1]===F[1]};if(this.renderWorldCopies)for(let He=1;He<=3;He++)Be.push(Re(-He)),Be.push(Re(He));for(Be.push(Re(0));Be.length>0;){const He=Be.pop(),gt=He.x,rt=He.y;let _t=He.fullyVisible;const xt=()=>this.projection.name==="globe"&&(He.y===0||He.y===(1<<He.zoom)-1);if(!_t){let mt=ae?He.aabb.intersects($):He.aabb.intersectsFlat($);if(mt===0&&xt()){const Ot=new a.bQ(He.zoom,gt,rt);mt=a.bR(this,B,Ot,!0).intersects($)}if(mt===0)continue;_t=mt===2}if(He.zoom!==De&&Pt(He))for(let mt=0;mt<4;mt++){const Ot=(gt<<1)+mt%2,Kt=(rt<<1)+(mt>>1),on={aabb:b?He.aabb.quadrant(mt):a.bS(this,B,He.zoom+1,Ot,Kt,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:Ot,y:Kt,wrap:He.wrap,fullyVisible:_t,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};v&&!U&&(on.tileID=new a.aA(He.zoom+1===De?Je:He.zoom+1,He.wrap,He.zoom+1,Ot,Kt),vt(on)),Be.push(on)}else{const mt=He.zoom===De?Je:He.zoom;if(n.minzoom&&n.minzoom>mt)continue;let Ot=0;if(!_t){let un=ae?He.aabb.intersectsPrecise($):He.aabb.intersectsPreciseFlat($);if(un===0&&xt()){const Ut=new a.bQ(He.zoom,gt,rt);un=a.bR(this,B,Ut,!0).intersectsPrecise($)}if(un===0)continue;if(n.calculateQuadrantVisibility)if($.containsPoint(He.aabb.center))Ot=15;else for(let Ut=0;Ut<4;Ut++)He.aabb.quadrant(Ut).intersects($)!==0&&(Ot|=1<<Ut)}const Kt=F[0]-(.5+gt+(He.wrap<<He.zoom))*(1<<o-He.zoom),on=F[1]-.5-rt,Zt=He.tileID?He.tileID:new a.aA(mt,He.wrap,He.zoom,gt,rt);n.calculateQuadrantVisibility&&(Zt.visibleQuadrants=Ot),Ne.push({tileID:Zt,distanceSq:Kt*Kt+on*on})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,gt=this.horizonLineFromTop();Ne=Ne.filter(rt=>{const _t=[0,0,0,1],xt=[a.ab,a.ab,0,1],mt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());a.a6.vec4.transformMat4(_t,_t,mt),a.a6.vec4.transformMat4(xt,xt,mt);const Ot=a.a6.vec4.min([],_t,xt),Kt=a.a6.vec4.max([],_t,xt),on=a.bT(Ot,Kt);if(on===0)return!0;let Zt=!1;const un=this._elevation;if(un&&on>He&&gt!==0){const Ut=this.calculateProjMatrix(rt.tileID.toUnwrapped());let hn;n.isTerrainDEM||(hn=un.getMinMaxForTile(rt.tileID)),hn||(hn={min:Ee,max:be});const Cn=a.c4(this.rotation),Hn=[Cn[0]*a.ab,Cn[1]*a.ab,hn.max];a.a6.vec3.transformMat4(Hn,Hn,Ut),Zt=(1-Hn[1])*this.height*.5<gt}return on<He||Zt})}return Ne.sort((He,gt)=>He.distanceSq-gt.distanceSq).map(He=>He.tileID)}resize(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const o=a.ap(n.lat,-a.bU,a.bU),f=this.projection.project(n.lng,o);return new a.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,o){let f,_;const v=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;f=(o.x-v.x)/P,_=(o.y-v.y)/P}else{const P=this.pointCoordinate(o),D=this.pointCoordinate(v);f=P.x-D.x,_=P.y-D.y}const b=this.locationCoordinate(n);this.setLocation(new a.a5(b.x-f,b.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,o){const f=o?a.bE(o,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new a.a5(_.x,_.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,o){const f=o??this._centerAltitude,_=[n.x,n.y,0,1],v=[n.x,n.y,1,1];a.a6.vec4.transformMat4(_,_,this.pixelMatrixInverse),a.a6.vec4.transformMat4(v,v,this.pixelMatrixInverse);const b=v[3];a.a6.vec4.scale(_,_,1/_[3]),a.a6.vec4.scale(v,v,1/b);const P=_[2],D=v[2];return{p0:_,p1:v,t:P===D?0:(f-P)/(D-P)}}screenPointToMercatorRay(n){const o=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return a.a6.vec4.transformMat4(o,o,this.pixelMatrixInverse),a.a6.vec4.transformMat4(f,f,this.pixelMatrixInverse),a.a6.vec4.scale(o,o,1/o[3]),a.a6.vec4.scale(f,f,1/f[3]),o[2]=a.bE(o[2],this._center.lat)*this.worldSize,f[2]=a.bE(f[2],this._center.lat)*this.worldSize,a.a6.vec4.scale(o,o,1/this.worldSize),a.a6.vec4.scale(f,f,1/this.worldSize),new a.aj([o[0],o[1],o[2]],a.a6.vec3.normalize([],a.a6.vec3.sub([],f,o)))}rayIntersectionCoordinate(n){const{p0:o,p1:f,t:_}=n,v=a.bE(o[2],this._center.lat),b=a.bE(f[2],this._center.lat);return new a.a5(a.aa(o[0],f[0],_)/this.worldSize,a.aa(o[1],f[1],_)/this.worldSize,a.aa(v,b,_))}pointCoordinate(n,o=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,o)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let o=this.projection.pointCoordinate3D(this,n.x,n.y);if(o)return new a.a5(o[0],o[1],o[2]);let f=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const v=.02*_,b=n.clone();for(let P=0;P<10&&_-f>v;P++){b.y=a.aa(f,_,.66);const D=this.projection.pointCoordinate3D(this,b.x,b.y);D?(_=b.y,o=D):f=b.y}return o?new a.a5(o[0],o[1],o[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=a.bV)return!this.isPointAboveHorizon(n);const o=this.pointCoordinate(n);return o.y>=0&&o.y<=1}_coordinatePoint(n,o){const f=o&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return a.a6.vec4.transformMat4(_,_,this.pixelMatrix),_[3]>0?new a.P(_[0]/_[3],_[1]/_[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:o}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new a.P(o,n)),b=this.pointLocation3D(new a.P(_,n)),P=this.pointLocation3D(new a.P(_,f)),D=this.pointLocation3D(new a.P(o,f));let B=Math.min(v.lng,b.lng,P.lng,D.lng),F=Math.max(v.lng,b.lng,P.lng,D.lng),U=Math.min(v.lat,b.lat,P.lat,D.lat),q=Math.max(v.lat,b.lat,P.lat,D.lat);const $=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,K=(re,ie,ae,de,fe)=>{const be=(re+ae)/2,Ee=(ie+de)/2,we=new a.P(be,Ee),{lng:Ie,lat:Re}=this.pointLocation3D(we),Be=Math.max(0,B-Ie,U-Re,Ie-F,Re-q);B=Math.min(B,Ie),F=Math.max(F,Ie),U=Math.min(U,Re),q=Math.max(q,Re),(fe<ee||Be>$)&&(K(re,ie,be,Ee,fe+1),K(be,Ee,ae,de,fe+1))};if(K(o,n,_,n,1),K(_,n,_,f,1),K(_,f,o,f,1),K(o,f,o,n,1),this.projection.name==="globe"){const[re,ie]=a.bW(this);re?(q=90,F=180,B=-180):ie&&(U=-90,F=180,B=-180)}return new a.as(new a.bL(B,U),new a.bL(F,q))}_getBoundsRectangular(n,o){const{top:f,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,P=new a.P(_,f),D=new a.P(b,f),B=new a.P(b,v),F=new a.P(_,v);let U=this.pointCoordinate(P,n),q=this.pointCoordinate(D,n);const $=this.pointCoordinate(B,o),ee=this.pointCoordinate(F,o),K=(re,ie)=>(ie.y-re.y)/(ie.x-re.x);return U.y>1&&q.y>=0?U=new a.a5((1-ee.y)/K(ee,U)+ee.x,1):U.y<0&&q.y<=1&&(U=new a.a5(-ee.y/K(ee,U)+ee.x,0)),q.y>1&&U.y>=0?q=new a.a5((1-$.y)/K($,q)+$.x,1):q.y<0&&U.y<=1&&(q=new a.a5(-$.y/K($,q)+$.x,0)),new a.as().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=n.visibleDemTiles.reduce((f,_)=>{if(_.dem){const v=_.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*n.exaggeration(),o.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-o*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-a.bU,this.maxLat=a.bU,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.am(this.minLng)*this.tileSize,this.worldMaxX=a.am(this.maxLng)*this.tileSize,this.worldMinY=a.at(this.maxLat)*this.tileSize,this.worldMaxY=a.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,o){return this.projection.createTileMatrix(this,o,n)}calculateDistanceTileData(n){const o=n.key,f=this._distanceTileDataCache;if(f[o])return f[o];const _=n.canonical,v=1/this.height,b=this.cameraWorldSize,P=b/this.zoomScale(_.z),D=(_.x+Math.pow(2,_.z)*n.wrap)*P,B=_.y*P,F=this.point;F.x*=b/this.worldSize,F.y*=b/this.worldSize;const U=this.angle,q=Math.sin(-U),$=-Math.cos(-U);return f[o]={bearing:[q,$],center:[(F.x-D)*v,(F.y-B)*v],scale:P/a.ab*v},f[o]}calculateFogTileMatrix(n){const o=n.key,f=this._fogTileMatrixCache;if(f[o])return f[o];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return a.a6.mat4.multiply(_,this.worldToFogMatrix,_),f[o]=new Float32Array(_),f[o]}calculateProjMatrix(n,o=!1,f=!1){const _=n.key;let v;if(v=f?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,v[_])return v[_];const b=this.calculatePosMatrix(n,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,a.a6.mat4.multiply(b,P,b),v[_]=new Float32Array(b),v[_]}calculatePixelsToTileUnitsMatrix(n){const o=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[o])return f[o];const _=a.bX(n,this);return f[o]=_,f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,o=a.a6.mat4.fromScaling([],[n,n,n]);return a.a6.mat4.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const o=a.bE(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(o),_=this._camera.forward(),v=a.bE(1,this._center.lat);f[2]/=v,_[2]/=v,a.a6.vec3.normalize(_,_);const b=n.raycast(f,_,n.exaggeration());if(b){const P=a.a6.vec3.scaleAndAdd([],f,_,b),D=new a.a5(P[0],P[1],a.bE(P[2],a.aN(P[1]))),B=(D.z+a.a6.vec3.length([D.x-f[0],D.y-f[1],D.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const o=this._elevation,f=a.bE(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),v=o.getAtPointOrZero(new a.a5(..._)),b=this.pixelsPerMeter/this.worldSize*v,P=this._minimumHeightOverTerrain(),D=_[2]-b;if(D<=P)if(D<0||n){const B=this.locationCoordinate(this._center,this._centerAltitude),F=[_[0],_[1],B.z-_[2]],U=a.a6.vec3.length(F);F[2]-=(P-D)/this._pixelsPerMercatorPixel;const q=a.a6.vec3.length(F);if(q===0)return;a.a6.vec3.scale(F,F,U/q*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],B.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const q=this.center;return q.lat=a.ap(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(q.lng=a.ap(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const o=this._unmodified,{x:f,y:_}=this.point;let v=0,b=f,P=_;const D=this.width/2,B=this.height/2,F=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(_-B<F&&(P=F+B),_+B>U&&(P=U-B),U-F<this.height&&(v=Math.max(v,this.height/(U-F)),P=(U+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,ee=this.worldSize/2-(q+$)/2;b=(f+ee+this.worldSize)%this.worldSize-ee,b-D<q&&(b=q+D),b+D>$&&(b=$-D),$-q<this.width&&(v=Math.max(v,this.width/($-q)),b=($+q)/2)}b===f&&P===_||(this.center=this.unproject(new a.P(b,P))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,o=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.bE(1,this.center.lat)/a.bE(1,a.c5));const _=a.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,v);let P;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-n.x/this.width,D[9]=2*n.y/this.height,this.isOrthographic){let Re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Be=Re*this.aspect,Ne=-Be,De=-Re;Be-=n.x,Ne-=n.x,Re+=n.y,De+=n.y,P=this._camera.getCameraToClipOrthographic(Ne,Be,De,Re,this._nearZ,this._farZ),((Je,at,vt,St)=>{for(let Pt=0;Pt<16;Pt++)Je[Pt]=$o(at[Pt],vt[Pt],St)})(P,P,D,Ka(this.pitch>=15?1:this.pitch/15))}else P=D;const B=a.a6.mat4.mul([],D,b);let F=a.a6.mat4.mul([],P,b);if(this.projection.isReprojectedInTileSpace){const Re=this.locationCoordinate(this.center),Be=a.a6.mat4.identity([]);a.a6.mat4.translate(Be,Be,[Re.x*this.worldSize,Re.y*this.worldSize,0]),a.a6.mat4.multiply(Be,Be,a.bZ(this)),a.a6.mat4.translate(Be,Be,[-Re.x*this.worldSize,-Re.y*this.worldSize,0]),a.a6.mat4.multiply(F,F,Be),a.a6.mat4.multiply(B,B,Be),this.inverseAdjustmentMatrix=a.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.a6.mat4.scale([],F,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=F,this.invProjMatrix=a.a6.mat4.invert(new Float64Array(16),this.projMatrix),o){const Re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Re[8]=2*-n.x/this.width,Re[9]=2*n.y/this.height,this.expandedFarZProjMatrix=a.a6.mat4.mul([],Re,b)}else this.expandedFarZProjMatrix=this.projMatrix;const U=a.a6.mat4.invert([],P);this.frustumCorners=a.b$.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const q=new Float32Array(16);a.a6.mat4.identity(q),a.a6.mat4.scale(q,q,[1,-1,1]),a.a6.mat4.rotateX(q,q,this._pitch),a.a6.mat4.rotateZ(q,q,this.angle);const $=a.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.a6.mat4.clone($);const ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-n.x/this.width,$[9]=2*(n.y+ee)/this.height,this.skyboxMatrix=a.a6.mat4.multiply(q,$,q);const K=this.point,re=K.x,ie=K.y,ae=this.width%2/2,de=this.height%2/2,fe=Math.cos(this.angle),be=Math.sin(this.angle),Ee=re-Math.round(re)+fe*ae+be*de,we=ie-Math.round(ie)+fe*de+be*ae,Ie=new Float64Array(F);if(a.a6.mat4.translate(Ie,Ie,[Ee>.5?Ee-1:Ee,we>.5?we-1:we,0]),this.alignedProjMatrix=Ie,F=a.a6.mat4.create(),a.a6.mat4.scale(F,F,[this.width/2,-this.height/2,1]),a.a6.mat4.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=a.a6.mat4.create(),a.a6.mat4.scale(F,F,[1,-1,1]),a.a6.mat4.translate(F,F,[-1,-1,0]),a.a6.mat4.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=a.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},F=a.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.c0(this);const Re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.a6.vec3.transformMat4(Re,Re,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[n,n,o];a.a6.vec3.scale(v,v,_),a.a6.vec3.scale(f,f,-1),a.a6.vec3.multiply(f,f,v);const b=a.a6.mat4.create();a.a6.mat4.translate(b,b,f),a.a6.mat4.scale(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,o,_)}_computeCameraPosition(n){const o=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*v,_.y/this.worldSize-f[1]*v,n/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=n[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((o-f)/_,1)),this._camera.position=a.a6.vec3.scaleAndAdd([],this._camera.position,n,v),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,o=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),v=a.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.bC(this._maxPitch)),P=Math.max((n[2]-v)/Math.cos(f),b),D=this._zoomFromMercatorZ(P);a.a6.vec3.scaleAndAdd(n,n,o,P),this._pitch=a.ap(f,a.bC(this.minPitch),a.bC(this.maxPitch)),this.angle=a.bB(_,-Math.PI,Math.PI),this._setZoom(a.ap(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.a5(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let o=0,f=a.bV,_=0,v=1/0;for(;f-o>1e-6&&f>o;){const b=o+.5*(f-o),P=this.tileSize*Math.pow(2,b),D=this.getCameraToCenterDistance(this.projection,b,P),B=this.scaleZoom(D/(n*this.tileSize)),F=Math.abs(b-B);F<v&&(v=F,_=b),b<B?o=b:f=b}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,o){const f=Math.min(n.x,o.x),_=Math.max(n.x,o.x),v=Math.min(n.y,o.y),b=Math.max(n.y,o.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new a.P(f,v),new a.P(_,b),new a.P(f,b),new a.P(_,v)],D=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const F of P){const U=this.pointRayIntersection(F);if(U.t<0)return!0;const q=this.rayIntersectionCoordinate(U);if(q.x<D||q.y<0||q.x>B||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(n,o){const f=a.a6.vec3.length(a.a6.vec3.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(f)+o;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([o,f,_],v){const b=[o,f,_,1];a.a6.vec4.transformMat4(b,b,v);const P=b[3]=Math.max(b[3],1e-6);return b[0]/=P,b[1]/=P,b[2]/=P,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,n))}}getCameraToCenterDistance(n,o=this.zoom,f=this.worldSize){const _=a.bY(n,o,this.width,this.height,1024),v=n.pixelSpaceConversion(this.center.lat,f,_);let b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=$o(1,b,Ka(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.a6.mat4.multiply(n,n,this.globeMatrix),n}getFrustum(n){return a.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Cr=(d,n)=>{if(n>0&&d.terrain&&a.w("Cutoff is currently disabled on terrain"),n<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=d.transform,f=Math.max(Math.abs(o._zoom-(d.minCutoffZoom-1)),1),_=o.isLODDisabled(!1)?a.a7(60,45,o.pitch):a.a7(30,15,o.pitch),v=o._farZ-o._nearZ,b=n*o.height,P=((1-(D=_))*o.cameraToCenterDistance+D*(o._farZ+b))*f;var D;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(P-o._nearZ)/v,(P-b-o._nearZ)/v]}}},li={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Xo{constructor(n,o){this.aabb=n,this.lastCascade=o}}class Mt{add(n,o){const f=this.receivers[n.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],o.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],o.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],o.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],o.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],o.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],o.max[2])):this.receivers[n.key]=new Xo(o,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,o,f){const _=a.ca.fromPoints(n.points);let v=0;for(const b in this.receivers){const P=this.receivers[b];if(!P||!_.intersectsAabb(P.aabb))continue;P.aabb.min=_.closestPoint(P.aabb.min),P.aabb.max=_.closestPoint(P.aabb.max);const D=P.aabb.getCorners();for(let B=0;B<f.length;B++){let F=!0;for(const U of D){const q=[U[0]*o,U[1]*o,U[2]];if(a.a6.vec3.transformMat4(q,q,f[B].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){F=!1;break}}if(P.lastCascade=B,v=Math.max(v,B),F)break}}return v+1}}class Hu{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Mt,this._depthMode=new rn(n.context.gl.LEQUAL,rn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(li,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(li,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(li,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,o){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const _=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((ee,K)=>{const re=f.style._mergedLayers[K];return ee+(re.hasShadowPass()&&!re.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=f.context,b=li.shadowMapResolution,P=li.shadowMapResolution;if(this._cascades.length===0||li.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ee=0;ee<li.cascadeCount;++ee){const K=f._shadowMapDebug,re=v.gl,ie=v.createFramebuffer(b,P,K,"texture"),ae=new a.T(v,{width:b,height:P,data:null},re.DEPTH_COMPONENT16);if(ie.depthAttachment.set(ae.texture),K){const de=new a.T(v,{width:b,height:P,data:null},re.RGBA8);ie.colorAttachment.set(de.texture)}this._cascades.push({framebuffer:ie,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.bO,scale:0})}}this.shadowDirection=bs(o);let D=0;if(n.elevation){const ee=n.elevation,K=[1e4,-1e4];ee.visibleDemTiles.filter(re=>re.dem).forEach(re=>{const ie=re.dem.tree;K[0]=Math.min(K[0],ie.minimums[0]),K[1]=Math.max(K[1],ie.maximums[0])}),K[0]!==1e4&&(D=(K[1]-K[0])*ee.exaggeration())}const B=1.5*n.cameraToCenterDistance,F=3*B,U=new Float64Array(16);for(let ee=0;ee<this._cascades.length;++ee){const K=this._cascades[ee];let re=n.height/50,ie=1;li.cascadeCount===1?ie=F:ee===0?ie=B:(re=B,ie=F);const[ae,de]=Ls(n,this.shadowDirection,re,ie,li.shadowMapResolution,D);K.scale=n.scale,K.matrix=ae,K.boundingSphereRadius=de,a.a6.mat4.invert(U,K.matrix),K.frustum=a.bO.fromInvProjectionMatrix(U,1,0,!0),K.far=ie}const q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/li.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=li.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hr.ShadowMap0,this._uniformValues.u_shadowmap_1=Hr.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const $=f.transform.elevation;for(const ee of this._groundShadowTiles){let K={min:0,max:0};if($){const re=$.getMinMaxForTile(ee);re&&(K=re)}this.addShadowReceiver(ee.toUnwrapped(),K.min,K.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,o){if(!this.enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,li.shadowMapResolution,li.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,_.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),_.clear({color:a.bA.white,depth:1});for(const b of n.order){const P=n._mergedLayers[b];if(!P.hasShadowPass()||P.isHidden(f.transform.zoom))continue;const D=n.getLayerSourceCache(P),B=D?o[D.id]:void 0;(P.type==="model"||B&&B.length)&&f.renderLayer(f,D,P,B)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,o=n.style,f=n.context,_=o.directionalLight,v=o.ambientLight;if(!_||!v)return;const b=[],P=Cr(n,n.longestCutoffRange);P.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");const D=or(o,_,v),B=new rn(f.gl.LEQUAL,rn.ReadOnly,n.depthRangeFor3D);for(const F of this._groundShadowTiles){const U=F.toUnwrapped(),q=n.isTileAffectedByFog(F),$=n.getOrCreateProgram("groundShadow",{defines:b,overrideFog:q});this.setupShadows(U,$),n.uploadCommonUniforms(f,$,U,null,P);const ee={u_matrix:n.transform.calculateProjMatrix(U),u_ground_shadow_factor:D};$.draw(n,f.gl.TRIANGLES,B,xn.disabled,An.multiply,mn.disabled,ee,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?An.unblended:An.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const o=this.painter.transform,f=o.calculatePosMatrix(n,o.worldSize);return a.a6.mat4.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(n){return a.a6.mat4.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,o,f,_=0){if(!this.enabled)return;const v=this.painter.transform,b=this.painter.context,P=b.gl,D=this._uniformValues,B=new Float64Array(16),F=v.calculatePosMatrix(n,v.worldSize);for(let U=0;U<this._cascades.length;U++)a.a6.mat4.multiply(B,this._cascades[U].matrix,F),D[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),b.activeTexture.set(P.TEXTURE0+Hr.ShadowMap0+U),this._cascades[U].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const U=a.c9(n.canonical),q=2/v.tileSize*a.ab/li.shadowMapResolution,$=q*this._cascades[0].boundingSphereRadius,ee=q*this._cascades[this._cascades.length-1].boundingSphereRadius,K=(f==="vector-tile"?1:3)/Math.pow(2,_-n.canonical.z-(1-v.zoom+Math.floor(v.zoom)));D.u_shadow_normal_offset=[U,$*K,ee*K],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(b,D)}setupShadowsFromMatrix(n,o,f=!1){if(!this.enabled)return;const _=this.painter.context,v=_.gl,b=this._uniformValues,P=new Float64Array(16);for(let D=0;D<li.cascadeCount;D++)a.a6.mat4.multiply(P,this._cascades[D].matrix,n),b[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),_.activeTexture.set(v.TEXTURE0+Hr.ShadowMap0+D),this._cascades[D].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){const D=li.normalOffset;b.u_shadow_normal_offset=[1,D,D],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(_,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,o,f,_){if(_[2]>=0)return{};const v=function(D,B,F){const U=F/(1<<D.canonical.z);return new a.ca([D.canonical.x*U+D.wrap*F,D.canonical.y*U+D.wrap*F,0],[(D.canonical.x+1)*U+D.wrap*F,(D.canonical.y+1)*U+D.wrap*F,B])}(n,o,f).getCorners(),b=o/-_[2];_[0]<0?(a.a6.vec3.add(v[0],v[0],[_[0]*b,0,0]),a.a6.vec3.add(v[3],v[3],[_[0]*b,0,0])):_[0]>0&&(a.a6.vec3.add(v[1],v[1],[_[0]*b,0,0]),a.a6.vec3.add(v[2],v[2],[_[0]*b,0,0])),_[1]<0?(a.a6.vec3.add(v[0],v[0],[0,_[1]*b,0]),a.a6.vec3.add(v[1],v[1],[0,_[1]*b,0])):_[1]>0&&(a.a6.vec3.add(v[2],v[2],[0,_[1]*b,0]),a.a6.vec3.add(v[3],v[3],[0,_[1]*b,0]));const P={};return P.vertices=v,P.planes=[fn(v[1],v[0],v[4]),fn(v[2],v[1],v[5]),fn(v[3],v[2],v[6]),fn(v[0],v[3],v[7])],P}addShadowReceiver(n,o,f){this._receivers.add(n,a.ca.fromTileIdAndHeight(n,o,f))}getMaxCascadeForTile(n){const o=this._receivers.get(n);return o&&o.lastCascade?o.lastCascade:0}}function fn(d,n,o){const f=a.a6.vec3.sub([],o,n),_=a.a6.vec3.sub([],d,n),v=a.a6.vec3.cross([],f,_),b=a.a6.vec3.length(v);return b===0?[0,0,1,0]:(a.a6.vec3.scale(v,v,1/b),[v[0],v[1],v[2],-a.a6.vec3.dot(v,n)])}function bs(d){const n=d.properties.get("direction"),o=a.c8(n.x,n.y,n.z);o[2]=a.ap(o[2],0,75);const f=a.cb([o[0],o[1],o[2]]);return a.a6.vec3.fromValues(f.x,f.y,f.z)}function or(d,n,o){const f=n.properties.get("color"),_=n.properties.get("intensity"),v=n.properties.get("direction"),b=[v.x,v.y,v.z],P=o.properties.get("color"),D=o.properties.get("intensity"),B=Math.max(a.a6.vec3.dot([0,0,1],b),0),F=[0,0,0];a.a6.vec3.scale(F,P.toRenderColor(d.getLut(n.scope)).toArray01Linear().slice(0,3),D);const U=[0,0,0];return a.a6.vec3.scale(U,f.toRenderColor(d.getLut(o.scope)).toArray01Linear().slice(0,3),B*_),a.cc([F[0]>0?F[0]/(F[0]+U[0]):0,F[1]>0?F[1]/(F[1]+U[1]):0,F[2]>0?F[2]/(F[2]+U[2]):0])}function Ls(d,n,o,f,_,v){const b=d.zoom,P=d.scale,D=d.worldSize,B=1/D,F=d.aspect,U=Math.sqrt(1+F*F)*Math.tan(.5*d.fovX),q=U*U,$=f-o,ee=f+o;let K,re;q>$/ee?(K=f,re=f*U):(K=.5*ee*(1+q),re=.5*Math.sqrt($*$+2*(f*f+o*o)*q+ee*ee*q*q));const ie=d.projection.pixelsPerMeter(d.center.lat,D),ae=d._camera.getCameraToWorldMercator(),de=[0,0,-K*B];a.a6.vec3.transformMat4(de,de,ae);let fe=re*B;const be=d._edgeInsets;if(!(be.left===0&&be.top===0&&be.right===0&&be.bottom===0||be.left===be.right&&be.top===be.bottom)){const _t=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?ie:1),xt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,o,f);xt[8]=2*-d.centerOffset.x/d.width,xt[9]=2*d.centerOffset.y/d.height;const mt=new Float64Array(16);a.a6.mat4.mul(mt,xt,_t);const Ot=new Float64Array(16);a.a6.mat4.invert(Ot,mt);const Kt=a.bO.fromInvProjectionMatrix(Ot,D,b,!0);for(const on of Kt.points){const Zt=((Ee=on)[0]/=P,Ee[1]/=P,Ee[2]=a.bE(Ee[2],d._center.lat),Ee);fe=Math.max(fe,a.a6.vec3.len(a.a6.vec3.subtract([],de,Zt)))}}var Ee;fe*=_/(_-1);const we=Math.acos(n[2]),Ie=Math.atan2(-n[0],-n[1]),Re=new Wo;Re.position=de,Re.setPitchBearing(we,Ie);const Be=Re.getWorldToCamera(D,ie),Ne=fe*D,De=Math.min(d._mercatorZfromZoom(17)*D*-2,-2*Ne),Je=Re.getCameraToClipOrthographic(-Ne,Ne,-Ne,Ne,De,(Ne+v*ie)/n[2]),at=new Float64Array(16);a.a6.mat4.multiply(at,Je,Be);const vt=a.a6.vec3.fromValues(Math.floor(1e6*de[0])/1e6*D,Math.floor(1e6*de[1])/1e6*D,0),St=.5*_,Pt=[0,0,0];a.a6.vec3.transformMat4(Pt,vt,at),a.a6.vec3.scale(Pt,Pt,St);const He=[Math.floor(Pt[0]),Math.floor(Pt[1]),Math.floor(Pt[2])],gt=[0,0,0];a.a6.vec3.sub(gt,Pt,He),a.a6.vec3.scale(gt,gt,-1/St);const rt=new Float64Array(16);return a.a6.mat4.identity(rt),a.a6.mat4.translate(rt,rt,gt),a.a6.mat4.multiply(at,rt,at),[at,Ne]}class Us extends a.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,o){return a.aG(this.requestManager.transformRequest(o,a.R.Model).url).then(f=>{if(!f)return;const _=a.aH(f),v=new a.aI(n,void 0,void 0,_);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new a.t(new Error(`Could not load model ${n} from ${o}: ${f.message}`)))})}load(n,o){this.models[o]||(this.models[o]={});const f=Object.keys(n);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+f.length;const _=[];for(const v of f)_.push(this.loadModel(v,n[v]));Promise.allSettled(_).then(v=>{for(let b=0;b<v.length;b++){const{status:P,value:D}=v[b];P==="fulfilled"&&D&&(this.models[o][f[b]]={model:D,numReferences:1})}this.numModelsLoading[o]-=f.length,this.fire(new a.x("data",{dataType:"style"}))}).catch(v=>{this.fire(new a.t(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,o){return!!this.getModel(n,o)}getModel(n,o){return this.models[o]||(this.models[o]={}),this.models[o][n]?this.models[o][n].model:void 0}addModel(n,o,f){this.models[f]||(this.models[f]={}),this.hasModel(n,f)&&this.models[f][n].numReferences++,this.load({[n]:this.requestManager.normalizeModelURL(o)},f)}addModels(n,o){this.models[o]||(this.models[o]={});const f={};for(const _ in n)this.models[o][_]={},f[_]=this.requestManager.normalizeModelURL(n[_]);this.load(f,o)}addModelsFromBucket(n,o){this.models[o]||(this.models[o]={});const f={};for(const _ of n)this.hasModel(_,o)?this.models[o][_].numReferences++:f[_]=this.requestManager.normalizeModelURL(_);this.load(f,o)}removeModel(n,o){if(this.models[o]&&this.models[o][n]&&(this.models[o][n].numReferences--,this.models[o][n].numReferences===0)){const f=this.models[o][n].model;delete this.models[o][n],f.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,o){this.models[o]||(this.models[o]={});for(const f in this.models[o])this.models[o][f].model&&this.models[o][f].model.upload(n.context)}}const mu=new a.a0({data:new a.a1(a._.colorTheme.data)}),ws=(d,n)=>qe(d,n&&n.filter(o=>o.identifier!=="source.canvas")),On=a.ar(Un,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ii=a.ar(Un,["setCenter","setZoom","setBearing","setPitch"]),Yo={version:8,layers:[],sources:{}},Zr={duration:300,delay:0};class kr extends a.E{constructor(n,o={}){super(),this.map=n,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=a.l({},Zr),this._buildingIndex=new Ml(this),this.crossTileSymbolIndex=new Ys,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Tl,this.dispatcher=o.dispatcher?o.dispatcher:new a.ce(a.cf(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Zs,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new a.cg(n._requestManager,o.localFontFamily?a.ch.all:o.localIdeographFontFamily?a.ch.ideographs:a.ch.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new Us(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",a.ci());const f=this;this._rtlTextPluginCallback=kr.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,b)=>{if(a.cj(v),b&&b.every(P=>P))for(const P in f._sourceCaches){const D=f._sourceCaches[P],B=D.getSource().type;B!=="vector"&&B!=="geojson"||D.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.getOwnSource(_.sourceId);if(v&&v.vectorLayerIds)for(const b in this._layers){const P=this._layers[b];P.source===v.id&&this._validateLayer(P)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(a.f(n))return n;const o=a.ck(n);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${a.cl(JSON.stringify(n))}`}_diffStyle(n,o,f){this.globalId=this._getGlobalId(n);const _=(v,b)=>{try{b(null,this.setState(v,f))}catch(P){b(P,!1)}};if(typeof n=="string"){const v=this.map._requestManager.normalizeStyleURL(n),b=this.map._requestManager.transformRequest(v,a.R.Style);a.n(b,(P,D)=>{P?this.fire(new a.t(P)):D&&_(D,o)})}else typeof n=="object"&&_(n,o)}loadURL(n,o={}){this.fire(new a.x("dataloading",{dataType:"style"}));const f=typeof o.validate=="boolean"?o.validate:!a.f(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,o.accessToken),this.resolvedImports.add(n);const _=this.importsCache.get(n);if(_)return this._load(_,f);const v=this.map._requestManager.transformRequest(n,a.R.Style);this._request=a.n(v,(b,P)=>{if(this._request=null,b)this.fire(new a.t(b));else if(P)return this.importsCache.set(n,P),this._load(P,f)})}loadJSON(n,o={}){this.fire(new a.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=a.q.frame(()=>{this._request=null,this._load(n,o.validate!==!1)})}loadEmpty(){this.fire(new a.x("dataloading",{dataType:"style"})),this._load(Yo,!1)}_loadImports(n,o,f){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const v of n){const b=this._createFragmentStyle(v),P=new Promise(F=>{b.once("style.import.load",F),b.once("error",F)}).then(()=>this.mergeAll());if(_.push(P),this.resolvedImports.has(v.url)){b.loadEmpty();continue}const D=v.data||this.importsCache.get(v.url);D?(b.loadJSON(D,{validate:o}),this._isInternalStyle(D)&&(b.globalId=null)):v.url?b.loadURL(v.url,{validate:o}):b.loadEmpty();const B={style:b,id:v.id,config:v.config};if(f){const F=this.fragments.findIndex(({id:U})=>U===f);this.fragments=this.fragments.slice(0,F).concat(B).concat(this.fragments.slice(F))}else this.fragments.push(B)}return Promise.allSettled(_)}getImportGlobalIds(n=this,o=new Set){for(const f of n.fragments)f.style.globalId&&o.add(f.style.globalId),this.getImportGlobalIds(f.style,o);return[...o.values()]}_createFragmentStyle(n){const o=this.scope?a.av(n.id,this.scope):n.id;let f;const _=this._initialConfig&&this._initialConfig[o];(n.config||_)&&(f=a.l({},n.config,_));const v=new kr(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,o){const f=n.schema;if(this._isInternalStyle(n)){const b=a.l({},Yo,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(b,o)}if(this.updateConfig(this._config,f),o&&ws(this,Ws(n)))return;this._loaded=!0,this.stylesheet=a.cm(n);const _=()=>{for(const B in n.sources)this.addSource(B,n.sources[B],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const b=_a(this.stylesheet.layers);if(this._order=b.map(B=>B.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const B=this.stylesheet.lights[0];this.light=new We(B.properties,B.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new We(this.stylesheet.light)),this._layers={};for(const B of b){const F=a.cq(B,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const U=this.getOwnLayerSourceCache(F),q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&F.canCastShadows()&&q&&(U.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.x("data",{dataType:"style"}));const D=this.isRootStyle();n.imports?this._loadImports(n.imports,o).then(()=>{this._reloadImports(),this.fire(new a.x(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.x(D?"style.load":"style.import.load")))},v=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=v,v){const b=this._evaluateColorThemeData(v);this._loadColorTheme(b).then(()=>{_()}).catch(P=>{a.w(`Couldn't load color theme from the stylesheet: ${P}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,o,f,_,v,b,P,D;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(F.light!=null&&(n=F.light),F.stylesheet.lights)for(const U of F.stylesheet.lights)U.type==="ambient"&&F.ambientLight!=null&&(o=F.ambientLight),U.type==="directional"&&F.directionalLight!=null&&(f=F.directionalLight);_=this._prioritizeTerrain(_,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(v=F.fog),F.stylesheet.camera!=null&&(D=F.stylesheet.camera),F.stylesheet.projection!=null&&(b=F.stylesheet.projection),F.stylesheet.transition!=null&&(P=F.stylesheet.transition),B[F.scope]=F._styleColorTheme}}),this.light=n,this.ambientLight=o,this.directionalLight=f,this.fog=v,this._styleColorThemeForScope=B,_===null?delete this.terrain:this.terrain=_,this.camera=D||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=a.l({},Zr,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const o=f=>{for(const _ of f.fragments)o(_.style);n(f)};o(this)}_prioritizeTerrain(n,o,f){const _=n&&n.drapeRenderMode===0;return f===null?o&&o.drapeRenderMode===0?o:_?n:null:o!=null&&(!n||_||o&&o.drapeRenderMode===1)?o:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{n=this._prioritizeTerrain(n,o.terrain,o.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(n=o.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},o={},f={};this.forEachFragmentStyle(_=>{for(const v in _._sourceCaches){const b=a.av(v,_.scope);n[b]=_._sourceCaches[v]}for(const v in _._otherSourceCaches){const b=a.av(v,_.scope);o[b]=_._otherSourceCaches[v]}for(const v in _._symbolSourceCaches){const b=a.av(v,_.scope);f[b]=_._symbolSourceCaches[v]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=f}mergeLayers(){const n={},o=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(v=>{for(const P of v._order){const D=v._layers[P];if(D.type==="slot"){const B=a.cn(P);if(n[B])continue;n[B]=[]}D.slot&&n[D.slot]?n[D.slot].push(D):o.push(D)}const{featuresets:b}=v.stylesheet||{};if(b)for(const P in b){const{selectors:D}=b[P];for(const B of D){const F=v._layers[B.layer],U=this._mergedLayerSelectors.get(F.fqid)||[];let q;if(B.properties)for(const $ in B.properties){const ee=a.M(B.properties[$]);ee.result==="success"&&(q=q||{},q[$]=ee.value)}U.push({featuresetId:P,featureNamespace:B.featureNamespace,properties:q}),this._mergedLayerSelectors.set(F.fqid,U)}}}),this._mergedOrder=[];const _=(v=[])=>{for(const b of v)if(b.type==="slot"){const P=a.cn(b.id);n[P]&&_(n[P]),this._mergedSlots.push(P)}else{const P=a.av(b.id,b.scope);this._mergedOrder.push(P),f[P]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};_(o),this._mergedOrder.sort((v,b)=>{const P=f[v],D=f[b];return P.hasInitialOcclusionOpacityProperties?D.is3D()?1:0:P.is3D()&&D.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=a.l({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(o,f,_){const v=a.l({},f);for(const P of Object.keys(a._.colorTheme))v[P]===void 0&&(v[P]=a._.colorTheme[P].default);const b=new a.$(mu,o,new Map(_));return b.setTransitionOrValue(v,_),b.untransitioned().possiblyEvaluate(new a.a3(0))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{const v="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let b=n;b.startsWith(v)||(b=v+b);const P="mapbox-reserved-lut",D=new Image;D.src=b,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void f();this._styleColorTheme.lutLoading=!1;const{width:B,height:F,data:U}=a.q.getImageData(D);if(F>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(B!==F*F)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new a.r({width:B,height:F},U),pixelRatio:1,sdf:!1,version:0});const q=this.imageManager.getImage(P,this.scope);q?(this._styleColorTheme.lut={image:q.data,data:n},f()):_(new Error("Missing LUT image."))}})}getLut(n){const o=this._styleColorThemeForScope[n];return o?o.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(o,f,_){let v,b,P;const D=a.q.devicePixelRatio>1?"@2x":"";let B=a.n(f.transformRequest(f.normalizeSpriteURL(o,D,".json"),a.R.SpriteJSON),(q,$)=>{B=null,P||(P=q,v=$,U())}),F=a.o(f.transformRequest(f.normalizeSpriteURL(o,D,".png"),a.R.SpriteImage),(q,$)=>{F=null,P||(P=q,b=$,U())});function U(){if(P)_(P);else if(v&&b){const q=a.q.getImageData(b),$={};for(const ee in v){const{width:K,height:re,x:ie,y:ae,sdf:de,pixelRatio:fe,stretchX:be,stretchY:Ee,content:we}=v[ee],Ie=new a.r({width:K,height:re});a.r.copy(q,Ie,{x:ie,y:ae},{x:0,y:0},{width:K,height:re},null),$[ee]={data:Ie,pixelRatio:fe,sdf:de,stretchX:be,stretchY:Ee,content:we}}_(null,$)}}return{cancel(){B&&(B.cancel(),B=null),F&&(F.cancel(),F=null)}}}(n,this.map._requestManager,(o,f)=>{if(this._spriteRequest=null,o)this.fire(new a.t(o));else if(f)for(const _ in f)this.imageManager.addImage(_,this.scope,f[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.x("data",{dataType:"style"}))})}_validateLayer(n){const o=this.getOwnSource(n.source);if(!o)return;const f=n.sourceLayer;f&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(f)===-1)&&this.fire(new a.t(new Error(`Source layer "${f}" does not exist on source "${o.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,o)=>{const f=this.fragments[o];return f&&f.style&&(n.data=f.style.serialize()),n})}_serializeSources(){const n={};for(const o in this._sourceCaches){const f=this._sourceCaches[o].getSource();n[f.id]||(n[f.id]=f.serialize())}return n}_serializeLayers(n){const o=[];for(const f of n){const _=this._layers[f];_&&_.type!=="custom"&&o.push(_.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const o=this.getOwnLayer(n);if(o)return o;this.fire(new a.t(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const o=this.getOwnSource(n);if(o)return o;this.fire(new a.t(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,o){const f=this.map.painter;if(f)for(let _=n.minzoom||0;_<(n.maxzoom||25.5);_++){const v=n.getProgramIds();if(v)for(const b of v){const P=n.getDefaultProgramParams(b,o.zoom,this._styleColorTheme.lut);P&&(f.style=this,this.fog&&(f._fogVisible=!0,P.overrideFog=!0,f.getOrCreateProgram(b,P)),f._fogVisible=!1,P.overrideFog=!1,f.getOrCreateProgram(b,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,f.getOrCreateProgram(b,P)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const o=this.calculateLightsBrightness();n.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const f=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const P in b){const{updatedIds:D,removedIds:B}=b[P];(D||B)&&(this._updateWorkerLayers(P,D,B),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const v={};for(const b in this._mergedSourceCaches){const P=this._mergedSourceCaches[b];v[b]=P.used,P.used=!1,P.tileCoverLift=0}for(const b of this._mergedOrder){const P=this._mergedLayers[b];if(P.recalculate(n,this._availableImages),!P.isHidden(n.zoom)){const D=this.getLayerSourceCache(P);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,P.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(P,n)}):this.precompilePrograms(P,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(const b in v){const P=this._mergedSourceCaches[b];v[b]!==P.used&&P.getSource().fire(new a.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:P.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new a.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,o,f){const _=this.getFragmentStyle(n);_&&this.dispatcher.broadcast("updateLayers",{layers:o?_._serializeLayers(o):[],scope:n,removedIds:f||[],options:_.options})}setState(n,o){if(this._checkLoaded(),ws(this,Ws(n)))return!1;(n=a.cm(n)).layers=_a(n.layers);const f=function(b,P){if(!b)return[{command:Un.setStyle,args:[P]}];let D=[];try{if(!a.bi(b.version,P.version))return[{command:Un.setStyle,args:[P]}];if(a.bi(b.center,P.center)||D.push({command:Un.setCenter,args:[P.center]}),a.bi(b.zoom,P.zoom)||D.push({command:Un.setZoom,args:[P.zoom]}),a.bi(b.bearing,P.bearing)||D.push({command:Un.setBearing,args:[P.bearing]}),a.bi(b.pitch,P.pitch)||D.push({command:Un.setPitch,args:[P.pitch]}),a.bi(b.sprite,P.sprite)||D.push({command:Un.setSprite,args:[P.sprite]}),a.bi(b.glyphs,P.glyphs)||D.push({command:Un.setGlyphs,args:[P.glyphs]}),a.bi(b.imports,P.imports)||function($=[],ee=[],K){ee=ee||[];const re=($=$||[]).map(ks),ie=ee.map(ks),ae=$.reduce(ya,{}),de=ee.reduce(ya,{}),fe=re.slice();let be,Ee,we,Ie;for(be=0,Ee=0;be<re.length;be++)we=re[be],de.hasOwnProperty(we)?Ee++:(K.push({command:Un.removeImport,args:[we]}),fe.splice(fe.indexOf(we,Ee),1));for(be=0,Ee=0;be<ie.length;be++)we=ie[ie.length-1-be],fe[fe.length-1-be]!==we&&(ae.hasOwnProperty(we)?(K.push({command:Un.removeImport,args:[we]}),fe.splice(fe.lastIndexOf(we,fe.length-Ee),1)):Ee++,Ie=fe[fe.length-be],K.push({command:Un.addImport,args:[de[we],Ie]}),fe.splice(fe.length-be,0,we));for(const Re of ee){const Be=ae[Re.id];Be&&!a.bi(Be,Re)&&K.push({command:Un.updateImport,args:[Re.id,Re]})}}(b.imports,P.imports,D),a.bi(b.transition,P.transition)||D.push({command:Un.setTransition,args:[P.transition]}),a.bi(b.light,P.light)||D.push({command:Un.setLight,args:[P.light]}),a.bi(b.fog,P.fog)||D.push({command:Un.setFog,args:[P.fog]}),a.bi(b.projection,P.projection)||D.push({command:Un.setProjection,args:[P.projection]}),a.bi(b.lights,P.lights)||D.push({command:Un.setLights,args:[P.lights]}),a.bi(b.camera,P.camera)||D.push({command:Un.setCamera,args:[P.camera]}),!a.bi(b["color-theme"],P["color-theme"]))return[{command:Un.setStyle,args:[P]}];const B={},F=[];(function($,ee,K,re){let ie;for(ie in ee=ee||{},$=$||{})$.hasOwnProperty(ie)&&(ee.hasOwnProperty(ie)||ai(ie,K,re));for(ie in ee){if(!ee.hasOwnProperty(ie))continue;const ae=ee[ie];$.hasOwnProperty(ie)?a.bi($[ie],ae)||($[ie].type==="geojson"&&ae.type==="geojson"&&ln($,ee,ie)?K.push({command:Un.setGeoJSONSourceData,args:[ie,ae.data]}):Tc(ie,ee,K,re)):Al(ie,ee,K)}})(b.sources,P.sources,F,B);const U=[];b.layers&&b.layers.forEach($=>{$.source&&B[$.source]?D.push({command:Un.removeLayer,args:[$.id]}):U.push($)});let q=b.terrain;q&&B[q.source]&&(D.push({command:Un.setTerrain,args:[void 0]}),q=void 0),D=D.concat(F),a.bi(q,P.terrain)||D.push({command:Un.setTerrain,args:[P.terrain]}),function($,ee,K){ee=ee||[];const re=($=$||[]).map(ks),ie=ee.map(ks),ae=$.reduce(ya,{}),de=ee.reduce(ya,{}),fe=re.slice(),be=Object.create(null);let Ee,we,Ie,Re,Be,Ne,De;for(Ee=0,we=0;Ee<re.length;Ee++)Ie=re[Ee],de.hasOwnProperty(Ie)?we++:(K.push({command:Un.removeLayer,args:[Ie]}),fe.splice(fe.indexOf(Ie,we),1));for(Ee=0,we=0;Ee<ie.length;Ee++)Ie=ie[ie.length-1-Ee],fe[fe.length-1-Ee]!==Ie&&(ae.hasOwnProperty(Ie)?(K.push({command:Un.removeLayer,args:[Ie]}),fe.splice(fe.lastIndexOf(Ie,fe.length-we),1)):we++,Ne=fe[fe.length-Ee],K.push({command:Un.addLayer,args:[de[Ie],Ne]}),fe.splice(fe.length-Ee,0,Ie),be[Ie]=!0);for(Ee=0;Ee<ie.length;Ee++)if(Ie=ie[Ee],Re=ae[Ie],Be=de[Ie],!be[Ie]&&!a.bi(Re,Be))if(a.bi(Re.source,Be.source)&&a.bi(Re["source-layer"],Be["source-layer"])&&a.bi(Re.type,Be.type)){for(De in Pl(Re.layout,Be.layout,K,Ie,null,Un.setLayoutProperty),Pl(Re.paint,Be.paint,K,Ie,null,Un.setPaintProperty),a.bi(Re.slot,Be.slot)||K.push({command:Un.setSlot,args:[Ie,Be.slot]}),a.bi(Re.filter,Be.filter)||K.push({command:Un.setFilter,args:[Ie,Be.filter]}),a.bi(Re.minzoom,Be.minzoom)&&a.bi(Re.maxzoom,Be.maxzoom)||K.push({command:Un.setLayerZoomRange,args:[Ie,Be.minzoom,Be.maxzoom]}),Re)Re.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Pl(Re[De],Be[De],K,Ie,De.slice(6),Un.setPaintProperty):a.bi(Re[De],Be[De])||K.push({command:Un.setLayerProperty,args:[Ie,De,Be[De]]}));for(De in Be)Be.hasOwnProperty(De)&&!Re.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Pl(Re[De],Be[De],K,Ie,De.slice(6),Un.setPaintProperty):a.bi(Re[De],Be[De])||K.push({command:Un.setLayerProperty,args:[Ie,De,Be[De]]}))}else K.push({command:Un.removeLayer,args:[Ie]}),Ne=fe[fe.lastIndexOf(Ie)+1],K.push({command:Un.addLayer,args:[Be,Ne]})}(U,P.layers,D)}catch(B){console.warn("Unable to compute style diff:",B),D=[{command:Un.setStyle,args:[P]}]}return D}(this.serialize(),n).filter(b=>!(b.command in Ii));if(f.length===0)return!1;const _=f.filter(b=>!(b.command in On));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);const v=[];return f.forEach(b=>{v.push(this[b.command].apply(this,b.args))}),o&&Promise.all(v).then(o),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,o){return this.getImage(n)?this.fire(new a.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,o),this._afterImageUpdated(n),this)}updateImage(n,o){this.imageManager.updateImage(n,this.scope,o)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new a.t(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,o,f={}){return this._checkLoaded(),this._validate(Oe,`models.${n}`,o,null,f)||(this.modelManager.addModel(n,o,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new a.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,o,f={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Rr,`sources.${n}`,o,null,f))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const _=uu(n,o,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const v=b=>{const P=(b?"symbol:":"other:")+_.id,D=a.av(P,this.scope),B=this._sourceCaches[P]=new ns(D,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=B,B.onAdd(this.map)};v(!1),o.type!=="vector"&&o.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const o=this.getOwnSource(n);if(!o)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new a.t(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new a.t(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this.getOwnSourceCaches(n);for(const _ of f){const v=a.cn(_.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(_.id),_.fire(new a.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,o){this._checkLoaded(),this.getOwnSource(n).setData(o),this._changes.setDirty()}getOwnSource(n){const o=this.getOwnSourceCache(n);return o&&o.getSource()}getOwnSources(){const n=[];for(const o in this._otherSourceCaches){const f=this.getOwnSourceCache(o);f&&n.push(f.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const o in n){const f=n[o]._tiles;for(const _ in f){const v=f[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const _ of n){if(this._validate(Fn,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(_),v.updateTransitions(o)}else this.ambientLight=new vn(_,ui||(ui=new a.a0({color:new a.a1(a._.properties_light_ambient.color),intensity:new a.a1(a._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(_),v.updateTransitions(o)}else this.directionalLight=new vn(_,Yn||(Yn=new a.a0({direction:new a.ad(a._.properties_light_directional.direction),color:new a.a1(a._.properties_light_directional.color),intensity:new a.a1(a._.properties_light_directional.intensity),"cast-shadows":new a.a1(a._.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.a1(a._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=new a.a3(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,o=this.ambientLight;if(!n||!o)return;const f=q=>.2126*(q[0]<=.03928?q[0]/12.92:Math.pow((q[0]+.055)/1.055,2.4))+.7152*(q[1]<=.03928?q[1]/12.92:Math.pow((q[1]+.055)/1.055,2.4))+.0722*(q[2]<=.03928?q[2]/12.92:Math.pow((q[2]+.055)/1.055,2.4)),_=n.properties.get("color").toRenderColor(null).toArray01(),v=n.properties.get("intensity"),b=n.properties.get("direction"),P=1-a.c8(b.x,b.y,b.z)[2]/90,D=f(_)*v*P,B=o.properties.get("color").toRenderColor(null).toArray01(),F=o.properties.get("intensity"),U=f(B)*F;return Number(((D+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(a.aK(n)){const o=a.co(n),f=this.fragments.find(({id:v})=>v===o);if(!f)throw new Error(`Style import '${n}' not found`);const _=a.cn(n);return f.style.getFragmentStyle(_)}{const o=this.fragments.find(({id:f})=>f===n);if(!o)throw new Error(`Style import '${n}' not found`);return o.style}}getFeaturesetDescriptors(n){const o=this.getFragmentStyle(n);if(!o||!o.stylesheet.featuresets)return[];const f=[];for(const _ in o.stylesheet.featuresets)f.push({featuresetId:_,importId:o.scope?o.scope:void 0});return f}getFeaturesetLayers(n,o){const f=this.getFragmentStyle(o),_=f.stylesheet.featuresets;if(!_||!_[n])return this.fire(new a.t(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const b of _[n].selectors){const P=f.getOwnLayer(b.layer);P&&v.push(P)}return v}getConfigProperty(n,o){const f=this.getFragmentStyle(n);if(!f)return null;const _=a.av(o,f.scope),v=f.options.get(_),b=v?v.value||v.default:null;return b?b.serialize():null}setConfigProperty(n,o,f){const _=this.getFragmentStyle(n);if(!_)return;const v=_.stylesheet.schema;if(!v||!v[o])return;const b=a.M(f);if(b.result!=="success")return void ws(this,b.value);const P=b.value.expression,D=a.av(o,_.scope),B=_.options.get(D);if(!B)return;let F;const{minValue:U,maxValue:q,stepValue:$,type:ee,values:K}=v[o],re=a.M(v[o].default);re.result==="success"&&(F=re.value.expression),F?(this.options.set(D,{...B,value:P,default:F,minValue:U,maxValue:q,stepValue:$,type:ee,values:K}),this.updateConfigDependencies(o)):this.fire(new a.t(new Error(`No schema defined for the config option "${o}" in the "${n}" fragment.`)))}getConfig(n){const o=this.getFragmentStyle(n);if(!o)return null;const f=o.stylesheet.schema;if(!f)return null;const _={};for(const v in f){const b=a.av(v,o.scope),P=o.options.get(b),D=P?P.value||P.default:null;_[v]=D?D.serialize():null}return _}setConfig(n,o){const f=this.getFragmentStyle(n);f&&(f.updateConfig(o,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const o=this.getFragmentStyle(n);return o?o.stylesheet.schema:null}setSchema(n,o){const f=this.getFragmentStyle(n);f&&(f.stylesheet.schema=o,f.updateConfig(f._config,o),this.updateConfigDependencies())}updateConfig(n,o){if(this._config=n,n||o)if(o)for(const f in o){let _,v;const b=a.M(o[f].default);if(b.result==="success"&&(_=b.value.expression),n&&n[f]!==void 0){const q=a.M(n[f]);q.result==="success"&&(v=q.value.expression)}const{minValue:P,maxValue:D,stepValue:B,type:F,values:U}=o[f];if(_){const q=a.av(f,this.scope);this.options.set(q,{default:_,value:v,minValue:P,maxValue:D,stepValue:B,type:F,values:U})}else this.fire(new a.t(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new a.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const o of this._configDependentLayers){const f=this.getLayer(o);if(f){if(n&&!f.configDependencies.has(n))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(o=>{if(o._styleColorTheme.colorTheme){const f=o._evaluateColorThemeData(o._styleColorTheme.colorTheme);(!o._styleColorTheme.lut&&f!==""||o._styleColorTheme.lut&&f!==o._styleColorTheme.lut.data)&&o.setColorTheme(o._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(n,o,f={}){this._checkLoaded();const _=n.id;if(this._layers[_])return void this.fire(new a.t(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(n.type==="custom"){if(ws(this,a.cp(n)))return;v=a.cq(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=a.cm(n),n=a.l(n,{source:_})),this._validate(Ke,`layers.${_}`,n,{arrayIndex:-1},f))return;v=a.cq(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let b=this._order.length;if(o){const F=this._order.indexOf(o);if(F===-1)return void this.fire(new a.t(new Error(`Layer with id "${o}" does not exist on this map.`)));v.slot===this._layers[o].slot?b=F:a.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const P=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&v.canCastShadows()&&D&&(P.castsShadows=!0);const B=this._changes.getRemovedLayer(v);if(B&&v.source&&P&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const F=a.av(v.source,v.scope);B.type!==v.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),P.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(n,o){this._checkLoaded();const f=this._checkLayer(n);if(!f||n===o)return;const _=this._order.indexOf(n);this._order.splice(_,1);let v=this._order.length;if(o){const b=this._order.indexOf(o);if(b===-1)return void this.fire(new a.t(new Error(`Layer with id "${o}" does not exist on this map.`)));f.slot===this._layers[o].slot?v=b:a.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const o=this._checkLayer(n);if(!o)return;o.setEventedParent(null);const f=this._order.indexOf(n);this._order.splice(f,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const _=this.getOwnLayerSourceCache(o);if(_&&_.castsShadows){let v=!1;for(const b in this._layers)if(this._layers[b].source===o.source&&this._layers[b].canCastShadows()){v=!0;break}_.castsShadows=v}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const o in this._layers)if(this._layers[o].type===n)return!0;return!1}setLayerZoomRange(n,o,f){this._checkLoaded();const _=this._checkLayer(n);_&&(_.minzoom===o&&_.maxzoom===f||(o!=null&&(_.minzoom=o),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,o){this._checkLoaded();const f=this._checkLayer(n);f&&f.slot!==o&&(f.slot=o,this._updateLayer(f))}setFilter(n,o,f={}){this._checkLoaded();const _=this._checkLayer(n);if(_&&!a.bi(_.filter,o))return o==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(ne,`layers.${_.id}.filter`,o,{layerType:_.type},f)||(_.filter=a.cm(o),this._updateLayer(_)))}getFilter(n){const o=this._checkLayer(n);if(o)return a.cm(o.filter)}setLayoutProperty(n,o,f,_={}){this._checkLoaded();const v=this._checkLayer(n);if(v&&!a.bi(v.getLayoutProperty(o),f)){if(f!=null&&(!_||_.validate!==!1)&&ws(v,ge.call(Ws,{key:`layers.${n}.layout.${o}`,layerType:v.type,objectKey:o,value:f,styleSpec:a._,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(o,f),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(n,o){const f=this._checkLayer(n);if(f)return f.getLayoutProperty(o)}setPaintProperty(n,o,f,_={}){this._checkLoaded();const v=this._checkLayer(n);if(!v||a.bi(v.getPaintProperty(o),f)||f!=null&&(!_||_.validate!==!1)&&ws(v,oe.call(Ws,{key:`layers.${n}.paint.${o}`,layerType:v.type,objectKey:o,value:f,styleSpec:a._})))return;const b=v.setPaintProperty(o,f);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(n,o){const f=this._checkLayer(n);if(f)return f.getPaintProperty(o)}setFeatureState(n,o){this._checkLoaded();const f=n.featureset;if(f){if("featuresetId"in f){const B=this.getFragmentStyle(f.importId),F=B.getFeaturesetLayers(f.featuresetId);for(const{source:U,sourceLayer:q}of F)B.setFeatureState({id:n.id,source:U,sourceLayer:q},o)}else if("layerId"in f){const B=this.getLayer(f.layerId);this.setFeatureState({id:n.id,source:B.source,sourceLayer:B.sourceLayer},o)}return}const _=n.source,v=n.sourceLayer,b=this._checkSource(_);if(!b)return;const P=b.type;if(P==="geojson"&&v)return void this.fire(new a.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(P==="vector"&&!v)return void this.fire(new a.t(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new a.t(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(_);for(const B of D)B.setFeatureState(v,n.id,o)}removeFeatureState(n,o){this._checkLoaded();const f=n.featureset;if(f){if("featuresetId"in f){const B=this.getFragmentStyle(f.importId),F=B.getFeaturesetLayers(f.featuresetId);for(const{source:U,sourceLayer:q}of F)B.removeFeatureState({id:n.id,source:U,sourceLayer:q},o)}else if("layerId"in f){const B=this.getLayer(f.layerId);this.removeFeatureState({id:n.id,source:B.source,sourceLayer:B.sourceLayer},o)}return}const _=n.source,v=this._checkSource(_);if(!v)return;const b=v.type,P=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!P)return void this.fire(new a.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new a.t(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(_);for(const B of D)B.removeFeatureState(P,n.id,o)}getFeatureState(n){this._checkLoaded();const o=n.featureset;if(o){let b;if("featuresetId"in o){const P=this.getFragmentStyle(o.importId),D=P.getFeaturesetLayers(o.featuresetId);for(const{source:B,sourceLayer:F}of D){const U=P.getFeatureState({id:n.id,source:B,sourceLayer:F});if(U&&!b)b=U;else if(!a.bi(b,U))return void this.fire(new a.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n){const P=this.getLayer(o.layerId);b=this.getFeatureState({id:n.id,source:P.source,sourceLayer:P.sourceLayer})}return b}const f=n.source,_=n.sourceLayer,v=this._checkSource(f);if(v){if(v.type!=="vector"||_)return n.id===void 0&&this.fire(new a.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(_,n.id);this.fire(new a.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=a.l({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return a.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),o=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return a.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(n){for(const o of Object.values(this._mergedLayers))n(o)&&this._updateLayer(o)}_updateLayer(n){this._changes.updateLayer(n);const o=this.getLayerSourceCache(n),f=a.av(n.source,n.scope),_=this._changes.getUpdatedSourceCaches();n.source&&!_[f]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),o.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const o=P=>this._mergedLayers[P].is3D(),f=this.order,_={},v=[];for(let P=f.length-1;P>=0;P--){const D=f[P];if(o(D)){_[D]=P;for(const B of n){const F=B[D];if(F)for(const U of F)v.push(U)}}}v.sort((P,D)=>D.intersectionZ-P.intersectionZ);const b=[];for(let P=f.length-1;P>=0;P--){const D=f[P];if(o(D))for(let B=v.length-1;B>=0;B--){const F=v[B].feature;if(F.layer&&_[F.layer.id]<P)break;b.push(F),v.pop()}else for(const B of n){const F=B[D];if(F)for(const U of F)b.push(U.feature)}}return b}queryRenderedFeatures(n,o,f){o&&!Array.isArray(o)&&o.filter&&this._validate(ne,"queryRenderedFeatures.filter",o.filter,null,o);let _,v=!1;const b=new Set;if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new a.t(new Error("parameters.layers must be an Array."))),[];_=[];for(const F of o.layers){const U=this._mergedLayers[F];if(!U)return this.fire(new a.t(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];U.is3D()&&(v=!0),b.add(U.source),_.push(F)}}else v=this.has3DLayers();const P=this._queryRenderedFeatures(n,f,{layerIds:_,filter:o.filter,has3DLayers:v,includedSources:b}),D=this._flattenAndSortRenderedFeatures(P),B=[];for(const F of D)a.co(F.layer.id)===this.scope&&B.push(F);return B}queryRenderedFeaturesForInteractions(n,o,f){let _=[];for(const{featureset:D,filter:B,radius:F}of o){let U=!1;const q=[],$=new Set;if("featuresetId"in D){const K=this.getFeaturesetLayers(D.featuresetId,D.importId);if(K.length===0)continue;for(const re of K)re.is3D()&&(U=!0),$.add(re.source),q.push(re.fqid)}else if("layerId"in D){const K=this._mergedLayers[D.layerId];if(!K)return this.fire(new a.t(new Error(`The layer '${D.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];K.is3D()&&(U=!0),$.add(K.source),q.push(D.layerId)}let ee=n;if(F)if(n instanceof a.P||typeof n[0]=="number"){const K=a.P.convert(n);ee=[[K.x-F,K.y-F],[K.x+F,K.y+F]]}else{const K=a.P.convert(n[0]),re=a.P.convert(n[1]);ee=[[K.x-F,K.y-F],[re.x+F,re.y+F]]}_=_.concat(this._queryRenderedFeatures(ee,f,{layerIds:q,filter:B,has3DLayers:U,includedSources:$}))}const v=this._flattenAndSortRenderedFeatures(_),b=(D,B,F)=>{const U=D.clone();if(delete U.layer,U.featureset=B,F&&F.featureNamespace&&(U.namespace=F.featureNamespace),F&&F.properties){const q={},$=this.map.transform.zoom;for(const ee of Object.keys(F.properties)){const K=F.properties[ee].evaluate({zoom:$},D._vectorTileFeature,D.state,D.tile,this._availableImages);K!=null&&(q[ee]=K)}U.properties=q}return U},P=[];for(const D of v){const B=D.layer.id,F=a.cn(B),U=a.co(B);for(const{featureset:q}of o){if("layerId"in q&&q.layerId!==B)continue;if("layerId"in q&&q.layerId===B){const ee=b(D,q);P.push(ee);continue}if("featuresetId"in q&&(q.importId!==U||!this.getFeaturesetLayers(q.featuresetId,q.importId).map(ee=>ee.id).includes(F)))continue;const $=this._mergedLayerSelectors.get(B)||[];for(const ee of $){const K=b(D,q,ee);P.push(K)}}}return P}_queryRenderedFeatures(n,o,f){const{layerIds:_,filter:v,has3DLayers:b,includedSources:P}=f,D=[],B=Dn.createFromScreenPoints(n,o);for(const F in this._mergedSourceCaches){if(!this._mergedSourceCaches[F].getSource())continue;const U=this._mergedSourceCaches[F].getSource().id;_&&!P.has(U)||D.push(Si(this._mergedSourceCaches[F],this._mergedLayers,B,v,_||[],this._availableImages,o,b,!!this.map._showQueryGeometry))}return this.placement&&D.push(function(F,U,q,$,ee,K,re,ie){const ae={},de=re.queryRenderedSymbols(q),fe=[];for(const be of Object.keys(de).map(Number))fe.push(ie[be]);fe.sort(so);for(const be of fe){const Ee=be.featureIndex.lookupSymbolFeatures(de[be.bucketInstanceId],be.bucketIndex,be.sourceLayerIndex,$,ee,K,F);for(const we in Ee){const Ie=ae[we]=ae[we]||[],Re=Ee[we];Re.sort((Be,Ne)=>{const De=be.featureSortOrder;if(De){const Je=De.indexOf(Be.featureIndex);return De.indexOf(Ne.featureIndex)-Je}return Ne.featureIndex-Be.featureIndex});for(const Be of Re)Ie.push(Be)}}for(const be in ae)ae[be].forEach(Ee=>{const we=Ee.feature,Ie=F[be],Re=U(Ie);if(!Re)return;const Be=Re.getFeatureState(we.layer["source-layer"],we.id);we.state=Be,a.aK(Ie.id)||(we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]))});return ae}(this._mergedLayers,this.getLayerSourceCache.bind(this),B.screenGeometry,v,_||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),D}querySourceFeatures(n,o){const f=o&&o.filter;f&&this._validate(ne,"querySourceFeatures.filter",f,null,o);let _=[];const v=this.getOwnSourceCaches(n);for(const b of v)_=_.concat(pr(b,o));return _}addSourceType(n,o,f){return kr.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(kr.setSourceType(n,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:o.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,o,f={}){this._checkLoaded();const _=this.light.getLight();let v=!1;for(const P in n)if(!a.bi(n[P],_[P])){v=!0;break}if(!v)return;const b=this._getTransitionParameters();this.light.setLight(n,o,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,o=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=n;const _=n.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const P="terrain-dem-src";this.addSource(P,f.source),f=a.cm(f),f=a.l(f,{source:P})}const v=a.l({},f),b={};if(this.terrain&&_){v.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(b.style=P.serialize())}if(this._validate(pa,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&o!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,o),this.fire(new a.x("data",{dataType:"style"}))}else{const v=this.terrain,b=v.get();for(const P of Object.keys(a._.terrain))!f.hasOwnProperty(P)&&a._.terrain[P].default&&(f[P]=a._.terrain[P].default);for(const P in n)if(!a.bi(n[P],b[P])){v.set(n,this.options),this.stylesheet.terrain=n;const D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new a.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const o=this.fog=new In(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!a.bi(o.get(),n)){o.set(n,this.options),this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}}else this._createFog(n);this._markersNeedUpdate=!0}setColorTheme(n){this._checkLoaded();const o=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()};if(this._styleColorTheme.colorTheme=n,!n)return this._styleColorTheme.lut=null,void o();const f=this._evaluateColorThemeData(n);this._loadColorTheme(f).then(()=>{this.fire(new a.x("colorthemeset")),o()}).catch(_=>{a.w(`Couldn't set color theme: ${_}`)})}_getTransitionParameters(n){return{now:a.q.now(),transition:a.l(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],o=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?n.push(f):o.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...o)}_createTerrain(n,o){const f=this.terrain=new nt(n,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="symbol"&&this._updateLayer(o)}}_validate(n,o,f,_,v={}){if(v&&v.validate===!1)return!1;const b=a.l({},this.serialize());return ws(this,n.call(Ws,a.l({key:o,style:b,value:f,styleSpec:a._},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const o=this.getSourceCaches(n);for(const f of o)f.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const o=this.getSourceCaches(n);for(const f of o)f.resume(),f.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let o;this.directionalLight&&(o=bs(this.directionalLight));for(const f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(n,void 0,void 0,o)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const o=this._sourceCaches[n];o.resume(),o.reload()}}_updatePlacement(n,o,f,_,v,b,P=!1){let D=!1,B=!1;const F={},U={};for(const q of this._mergedOrder){const $=this._mergedLayers[q];if($.type!=="symbol")continue;const ee=a.av($.source,$.scope);let K=F[ee];if(!K){const ie=this.getLayerSourceCache($);if(!ie)continue;const ae=ie.getRenderableIds(!0).map(de=>ie.getTileByID(de));U[ee]=ae.slice(),K=F[ee]=ae.sort((de,fe)=>fe.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(fe.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer($,K,o.center.lng,o.projection);D=D||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new a.x("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.q.now(),o.zoom))&&(this.pauseablePlacement=new ss(o,this._mergedOrder,P,f,_,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.q.now()),B=!0),D&&this.pauseablePlacement.placement.setStale()),B||D){this._buildingIndex.onNewFrame(o.zoom);for(let q=0;q<this._mergedOrder.length;q++){const $=this._mergedLayers[this._mergedOrder[q]];if($.type!=="symbol")continue;const ee=this.isLayerClipped($);this.placement.updateLayerOpacities($,F[a.av($.source,$.scope)],q,ee?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,o){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===n.id)!==-1)return void this.fire(new a.t(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!o)return f.push(n),this._loadImports([n],!0);const _=f.findIndex(({id:v})=>v===o);return _===-1&&this.fire(new a.t(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(n).concat(f.slice(_)),this._loadImports([n],!0,o)}updateImport(n,o){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(n);return _===-1?this:typeof o=="string"?(this.setImportUrl(n,o),this):(o.url&&o.url!==f[_].url&&this.setImportUrl(n,o.url),a.bi(o.config,f[_].config)||this.setImportConfig(n,o.config),a.bi(o.data,f[_].data)||this.setImportData(n,o.data),this)}moveImport(n,o){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(n);if(_===-1)return this;const v=this.getImportIndex(o);if(v===-1)return this;const b=f[_],P=this.fragments[_];return f=f.filter(({id:D})=>D!==n),this.fragments=this.fragments.filter(({id:D})=>D!==n),this.stylesheet.imports=f.slice(0,v).concat(b).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(P).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(n,o){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(n);if(_===-1)return this;f[_].url=o;const v=this.fragments[_];return v.style=this._createFragmentStyle(f[_]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(o),this}setImportData(n,o){this._checkLoaded();const f=this.getImportIndex(n),_=this.stylesheet.imports||[];return f===-1?this:o?(this.fragments[f].style.setState(o),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(n,_[f].url))}setImportConfig(n,o){this._checkLoaded();const f=this.getImportIndex(n),_=this.stylesheet.imports||[];if(f===-1)return this;o?_[f].config=o:delete _[f].config;const v=this.fragments[f],b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=o,v.style.updateConfig(o,b),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const o=this.stylesheet.imports||[],f=this.getImportIndex(n);f!==-1&&(o.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(n){const o=(this.stylesheet.imports||[]).findIndex(f=>f.id===n);return o===-1&&this.fire(new a.t(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),o}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const o in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[o];f&&n.push(f.getSource())}return n}getSource(n,o){const f=this.getSourceCache(n,o);return f&&f.getSource()}getLayerSource(n){const o=this.getLayerSourceCache(n);return o&&o.getSource()}getSourceCache(n,o){const f=a.av(n,o);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(n){const o=a.av(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[n]&&o.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&o.push(this._mergedSymbolSourceCaches[n]),o}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const o in n){const f=n[o];f==="reload"?this.reloadSource(o):f==="clear"&&this.clearSource(o)}}updateLayers(n){const o=this._changes.getUpdatedPaintProperties();for(const f of o){const _=this.getLayer(f);_&&_.updateTransitions(n)}}getImages(n,o,f){this.imageManager.getImages(o.icons,o.scope,f),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(o.tileID.key,o.type,o.icons)};_(this._otherSourceCaches[o.source]),_(this._symbolSourceCaches[o.source])}getGlyphs(n,o,f){this.glyphManager.getGlyphs(o.stacks,o.scope,f)}getResource(n,o,f){return a.ct(o,f)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const o=[];return this._otherSourceCaches[n]&&o.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&o.push(this._symbolSourceCaches[n]),o}_isSourceCacheLoaded(n){const o=this.getOwnSourceCaches(n);return o.length===0?(this.fire(new a.t(new Error(`There is no source with ID '${n}'`))),!1):o.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,o){if(!this._clipLayerPresent&&n.type!=="fill-extrusion")return!1;const f=n.type==="fill-extrusion"&&n.sourceLayer==="building";if(n.is3D()){if(f||o&&o.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}kr.getSourceType=function(d){return Zn[d]},kr.setSourceType=function(d,n){Zn[d]=n},kr.registerForPluginStateChange=a.cd;var gu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,co=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ds=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,xa="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Zu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Wu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,_u=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ho=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ba=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Rh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,wa=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const fo=[];Ia(gu,fo),Ia(ds,fo),Ia(co,fo);const po={"_prelude_fog.vertex.glsl":Wu,"_prelude_terrain.vertex.glsl":Zu,"_prelude_shadow.vertex.glsl":Rh,"_prelude_fog.fragment.glsl":_u,"_prelude_shadow.fragment.glsl":wa,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ho,"_prelude_raster_particle.glsl":ba},mo={};qn("",Zu),qn(_u,Wu),qn(wa,Rh),qn(ho,""),qn(ba,"");const go=qn(co,ds),yu=gu;var Ea={background:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:qn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:qn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:qn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:qn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:qn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:qn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:qn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:qn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:qn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:qn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:qn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:qn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:qn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:qn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:qn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xa),skyboxGradient:qn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xa),skyboxCapture:qn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:qn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:qn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:qn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:qn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:qn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:qn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ia(d,n){const o=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of o)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const v of _)n.includes(v)||n.push(v)}}function qn(d,n){const o=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(B=>{const F=B.split(" ");return F[F.length-1]}),_=[...new Set(_)]);const v={},b=[],P=[];if(d=d.replace(o,(B,F)=>(P.push(F),"")),(n=n.replace(o,(B,F)=>(b.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...fo];Ia(d,D),Ia(n,D);for(const B of[...b,...P])po[B]||console.error(`Undefined include: ${B}`),mo[B]||(mo[B]=[],Ia(po[B],mo[B])),D=[...D,...mo[B]];return{fragmentSource:d=d.replace(f,(B,F,U,q,$)=>(v[$]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${U} ${q} ${$};
#else
uniform ${U} ${q} u_${$};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${$}
    ${U} ${q} ${$} = u_${$};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${U} ${q} ${$};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(f,(B,F,U,q,$)=>{const ee=q==="float"?"vec2":q,K=$.match(/color/)?"color":ee;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${$}
in ${U} ${q} a_${$};
#endif
`:v[$]?F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${ee} a_${$};
out ${U} ${q} ${$};
#else
uniform ${U} ${q} u_${$};
#endif
`:F==="initialize"?K==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${U} ${q} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${K}(a_${$}, u_${$}_t);
#else
    ${U} ${q} ${$} = u_${$};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${U} ${q} a_${$};
    out ${U} ${q} ${$};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${$} = a_${$};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${ee} a_${$};
#else
uniform ${U} ${q} u_${$};
#endif
`:F==="define-instanced"?K==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${$}0;
in vec4 a_${$}1;
in vec4 a_${$}2;
in vec4 a_${$}3;
#else
uniform ${U} ${q} u_${$};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${ee} a_${$};
#else
uniform ${U} ${q} u_${$};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${U} ${q} ${$} = a_${$};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${q} ${$} = a_${$};
#else
    ${U} ${q} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${q} ${$} = unpack_mix_${K}(a_${$}, u_${$}_t);
#else
    ${U} ${q} ${$} = u_${$};
#endif
`}),staticAttributes:_,usedDefines:D,vertexIncludes:b,fragmentIncludes:P}}class Jo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,o,f,_,v,b,P,D){this.context=n;let B=this.boundPaintVertexBuffers.length!==_.length;for(let U=0;!B&&U<_.length;U++)this.boundPaintVertexBuffers[U]!==_[U]&&(B=!0);let F=this.boundDynamicVertexBuffers.length!==P.length;for(let U=0;!F&&U<P.length;U++)this.boundDynamicVertexBuffers[U]!==P[U]&&(F=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==f||B||F||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(o,f,_,v,b,P,D);else{n.bindVertexArrayOES.set(this.vao);for(const U of P)U&&(U.bind(),D&&U.instanceCount&&U.setVertexAttribDivisor(n.gl,o,D));v&&v.dynamicDraw&&v.bind()}}freshBind(n,o,f,_,v,b,P){const D=n.numAttributes,B=this.context,F=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,o.enableAttributes(F,n),o.bind(),o.setVertexAttribPointers(F,n,v);for(const U of f)U.enableAttributes(F,n),U.bind(),U.setVertexAttribPointers(F,n,v);for(const U of b)U&&(U.enableAttributes(F,n),U.bind(),U.setVertexAttribPointers(F,n,v),P&&U.instanceCount&&U.setVertexAttribDivisor(F,n,P));_&&_.bind(),B.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function vu(d,n){const o=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new a.a5(0,f/o).toLngLat().lat,new a.a5(0,(f+1)/o).toLngLat().lat]}function Qa(d,n,o,f,_,v,b){const P=d.context,D=P.gl,B=o.hillshadeFBO;if(!B)return;d.prepareDrawTile();const F=d.isTileAffectedByFog(n),U=d.getOrCreateProgram("hillshade",{overrideFog:F});P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,B.colorAttachment.get());const q=((re,ie,ae,de)=>{const fe=ae.paint.get("hillshade-shadow-color"),be=ae.paint.get("hillshade-highlight-color"),Ee=ae.paint.get("hillshade-accent-color"),we=ae.paint.get("hillshade-emissive-strength");let Ie=a.bC(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")Ie-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const Be=re.style.directionalLight.properties.get("direction"),Ne=a.c8(Be.x,Be.y,Be.z);Ie=a.bC(Ne[1])}const Re=!re.options.moving;return{u_matrix:de||re.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),Re),u_image:0,u_latrange:vu(0,ie.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Ie],u_shadow:fe.toRenderColor(ae.lut),u_highlight:be.toRenderColor(ae.lut),u_emissive_strength:we,u_accent:Ee.toRenderColor(ae.lut)}})(d,o,f,d.terrain?n.projMatrix:null);d.uploadCommonUniforms(P,U,n.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:ee,tileBoundsSegments:K}=d.getTileBoundsBuffers(o);U.draw(d,D.TRIANGLES,_,v,b,mn.disabled,q,f.id,$,ee,K)}function Ta(d,n,o){if(!n.needsDEMTextureUpload)return;const f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(o.stride);const v=o.getPixels();n.demTexture?n.demTexture.update(v,{premultiply:!1}):n.demTexture=new a.T(f,v,_.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Sa(d,n,o){const f=d.context,_=f.gl;if(!n.dem)return;const v=n.dem;if(f.activeTexture.set(_.TEXTURE1),Ta(d,n,v),!n.demTexture)return;n.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const b=v.dim;f.activeTexture.set(_.TEXTURE0);let P=n.hillshadeFBO;if(!P){const q=new a.T(f,{width:b,height:b,data:null},_.RGBA8);q.bind(_.LINEAR,_.CLAMP_TO_EDGE),P=n.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),P.colorAttachment.set(q.texture)}f.bindFramebuffer.set(P.framebuffer),f.viewport.set([0,0,b,b]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:B,tileBoundsSegments:F}=d.getMercatorTileBoundsBuffers(),U=[];d.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(d,_.TRIANGLES,rn.disabled,xn.disabled,An.unblended,mn.disabled,((q,$)=>{const ee=$.stride,K=a.a6.mat4.create();return a.a6.mat4.ortho(K,0,a.ab,-a.ab,0,0,1),a.a6.mat4.translate(K,K,[0,-a.ab,0]),{u_matrix:K,u_image:1,u_dimension:[ee,ee],u_zoom:q.overscaledZ}})(n.tileID,v),o.id,D,B,F),n.needsHillshadePrepare=!1}class dn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $u extends dn{getDefault(){return a.bA.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Xu extends dn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Yu extends dn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class br extends dn{getDefault(){return[!0,!0,!0,!0]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ca extends dn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class _o extends dn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class xu extends dn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const o=this.current;(n.func!==o.func||n.ref!==o.ref||n.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ju extends dn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Ma extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=n,this.dirty=!1}}class Pc extends dn{getDefault(){return[0,1]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ku extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=n,this.dirty=!1}}class el extends dn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Qu extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.BLEND):o.disable(o.BLEND),this.current=n,this.dirty=!1}}class tl extends dn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ko extends dn{getDefault(){return a.bA.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class bu extends dn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class zl extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=n,this.dirty=!1}}class Lc extends dn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Rc extends dn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Wr=class extends dn{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Ro extends dn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class $r extends dn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class nl extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class fs extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Gs extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class wu extends dn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Es extends dn{getDefault(){return null}set(n){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Is extends dn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Fl extends dn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class qs extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ec extends dn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class js extends dn{constructor(n,o){super(n),this.context=n,this.parent=o}getDefault(){return null}}class kl extends js{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class tc extends js{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Bl extends js{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Aa extends tc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const uh=(d,n,o)=>({u_matrix:d,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:o}),Eu=(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:o,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:b,u_frustum_tr:P,u_frustum_br:D,u_frustum_bl:B,u_globe_pos:F,u_globe_radius:U,u_viewport:q,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:ee});function nc(d,n){return d!=null&&n!=null&&!(!d.hasData()||!n.hasData())&&d.demTexture!=null&&n.demTexture!=null&&d.tileID.key!==n.tileID.key}const ps=new class{constructor(){this.operations={}}newMorphing(d,n,o,f,_){if(d in this.operations){const v=this.operations[d];v.to.tileID.key!==o.tileID.key&&(v.queued=o)}else this.operations[d]={startTime:f,phase:0,duration:_,from:n,to:o,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const o=this.operations[n];for(o.phase=(d-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Dc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function gr(d,n,o){if(n===0)return 0;const f=n<1&&o===514?.25/n:1;return 6*Math.pow(1.5,22-d)*Math.max(n,1)*f}function ms(d,n){const o=1<<d.z;return!n&&(d.x===0||d.x===o-1)||d.y===0||d.y===o-1}const il=d=>({u_matrix:d});function Vl(d,n,o,f,_){if(_>0){const v=a.q.now(),b=(v-d.timeAdded)/_,P=n?(v-n.timeAdded)/_:-1,D=o.getSource(),B=f.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),F=!n||Math.abs(n.tileID.overscaledZ-B)>Math.abs(d.tileID.overscaledZ-B),U=F&&d.refreshedUponExpiration?1:a.ap(F?b:1-P,0,1);return d.refreshedUponExpiration&&b>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Qo extends ns{constructor(n){const o={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new a.ce(a.cf(),null),_=uu("mock-dem",o,f,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,o){n.state="loaded",o(null)}}class ic extends ns{constructor(n){const o=uu("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new a.ce(a.cf(),null),n.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,o,f){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){const P=new As(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom);P.state="loaded",this._tiles[b.key]=P}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(n){const o=this.proxyCachedFBO[n];if(o!==void 0){const f=Object.values(o);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Iu extends a.aA{constructor(n,o,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=o,this.projMatrix=f}}class Ul extends a.cE{constructor(n,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,v]=function(D){const B=new a.a$,F=new a.aP,U=131;B.reserve(17161),F.reserve(33800);const q=a.ab/128,$=a.ab+q/2,ee=$+q;for(let re=-q;re<ee;re+=q)for(let ie=-q;ie<ee;ie+=q){const ae=ie<0||ie>$||re<0||re>$?24575:0,de=a.ap(Math.round(ie),0,a.ab),fe=a.ap(Math.round(re),0,a.ab);B.emplaceBack(de+ae,fe)}const K=(re,ie)=>{const ae=ie*U+re;F.emplaceBack(ae+1,ae,ae+U),F.emplaceBack(ae+U,ae+U+1,ae+1)};for(let re=1;re<129;re++)for(let ie=1;ie<129;ie++)K(ie,re);return[0,129].forEach(re=>{for(let ie=0;ie<130;ie++)K(ie,re),K(re,ie)}),[B,F,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(f,a.b1.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=a.b2.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=a.b2.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ic(o.map),this.orthoMatrix=a.a6.mat4.create(),a.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.ab,0,a.ab,0,1);const P=b.gl;this._overlapStencilMode=new xn({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qo(o.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,o,f){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const _=n.terrain.properties,v=n.terrain.drapeRenderMode===0,b=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.q.now();const P=n.terrain&&n.terrain.scope,D=_.get("source"),B=v?this._mockSourceCache:n.getSourceCache(D,P);if(!B)return void a.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=B,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(o):_.get("exaggeration"),!o.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(o,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),o.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const o=this._previousCameraAltitude,f=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=f;const _=o!=null?f-o:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const v=n.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let P=v-this._previousZoom;const D=this._previousUpdateTimestamp;let B=v;this._evaluationZoom!=null&&(B=this._evaluationZoom,Math.abs(v-B)>.5&&(P=.5*(v-B+P)),P*_<0&&(B+=P)),this._evaluationZoom=B;const F=b.getExaggeration(B),U=F===b.getExaggeration(Math.max(0,B-.1));if(U&&Math.abs(F-this._exaggeration)<.01)return F;let q=Math.min(.1,.00375*(this._updateTimestamp-D));return(U||F<.1||Math.abs(P)<1e-4)&&(q=Math.min(.2,4*q)),a.aa(this._exaggeration,F,q)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(a.a5.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=o.getIds().map(D=>{const B=o.getTileByID(D).tileID;return B.projMatrix=f.calculateProjMatrix(B.toUnwrapped()),B});(function(D,B){const F=B.transform.pointCoordinate(B.transform.getCameraPoint()),U=new a.P(F.x,F.y);D.sort((q,$)=>{if($.overscaledZ-q.overscaledZ)return $.overscaledZ-q.overscaledZ;const ee=new a.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),K=new a.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),re=U.mult(1<<q.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(ee)-re.distSqr(K)})})(_,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const D in b){const B=b[D];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,n[D],v),B.usedForTerrain))continue;const F=n[D];B.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[o.id]=_.map(D=>new Iu(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const B=this.terrainTileForTile[D.key];if(!B)continue;const F=B.tileID.key;F in P||(this._visibleDemTiles.push(B),P[F]=F)}}_assignTerrainTiles(n){this._initializing||n.forEach(o=>{if(this.terrainTileForTile[o.key])return;const f=this._findTileCoveringTileID(o,this.sourceCache);f&&(this.terrainTileForTile[o.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,o=n.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(o.TEXTURE1),Ta(this.painter,_,v))}}_prepareDemTileUniforms(n,o,f,_){if(!o||o.demTexture==null)return!1;const v=n.tileID.canonical,b=Math.pow(2,o.tileID.canonical.z-v.z),P=_||"";return f[`u_dem_tl${P}`]=[v.x*b%1,v.y*b%1],f[`u_dem_scale${P}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const o=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const v=_.dem.tree.minimums[0];return v>0&&n++,f+v},0);return n?o/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,o=n.gl;n.activeTexture.set(o.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new a.cF({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new a.T(n,_,o.R32F,{premultiply:!1}),v}setupElevationDraw(n,o,f){const _=this.painter.context,v=_.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let P=null,D=null,B=1;if(f&&f.morphing&&this._useVertexMorphing){const $=f.morphing.srcDemTile,ee=f.morphing.dstDemTile;B=f.morphing.phase,$&&ee&&(this._prepareDemTileUniforms(n,$,b,"_prev")&&(D=$),this._prepareDemTileUniforms(n,ee,b)&&(P=ee))}const F=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let U=null;var q;if(this.enabled?D&&P?(U=P.demTexture,_.activeTexture.set(v.TEXTURE4),D.demTexture.bind(F(D),v.CLAMP_TO_EDGE),b.u_dem_lerp=B):(P=this.terrainTileForTile[n.tileID.key],U=this._prepareDemTileUniforms(n,P,b)?P.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,_.activeTexture.set(v.TEXTURE2),U&&(b.u_dem_size=(q=U).size[0]===1?1:q.size[0]-2,U.bind(F(P),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,o,b),f&&f.useMeterToDem&&P){const $=(1<<P.tileID.canonical.z)*a.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=$}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),o.setTerrainUniformValues(_,b),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);o.setGlobeUniformValues(_,$)}}globeUniformValues(n,o,f){const _=n.projection;return{u_tile_tl_up:_.upVector(o,0,0),u_tile_tr_up:_.upVector(o,a.ab,0),u_tile_br_up:_.upVector(o,a.ab,a.ab),u_tile_bl_up:_.upVector(o,0,a.ab),u_tile_up_scale:f?a.cG(1):_.upVectorScale(o,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const o=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,b,P,D){if(_.transform.projection.name==="globe")(function(B,F,U,q,$){const ee=B.context,K=ee.gl;let re,ie;const ae=B.transform,de=a.cx(B,ee,ae),fe=(Je,at)=>{if(ie===at)return;const vt=[Dc[at],"PROJECTION_GLOBE_VIEW"];de&&vt.push("CUSTOM_ANTIALIASING");const St=B.isTileAffectedByFog(Je);re=B.getOrCreateProgram("globeRaster",{defines:vt,overrideFog:St}),ie=at},be=B.colorModeForRenderPass(),Ee=new rn(K.LEQUAL,rn.ReadWrite,B.depthRangeFor3D);ps.update($);const we=a.cy(ae),Ie=[a.am(ae.center.lng),a.at(ae.center.lat)],Re=B.globeSharedBuffers,Be=[ae.width*a.q.devicePixelRatio,ae.height*a.q.devicePixelRatio],Ne=Float32Array.from(ae.globeMatrix),De={useDenormalizedUpVectorScale:!0};{const Je=B.transform,at=gr(Je.zoom,F.exaggeration(),F.sourceCache._source.tileSize);ie=-1;const vt=K.TRIANGLES;for(const St of q){const Pt=U.getTile(St),He=xn.disabled,gt=F.prevTerrainTileForTile[St.key],rt=F.terrainTileForTile[St.key];nc(gt,rt)&&ps.newMorphing(St.key,gt,rt,$,250),ee.activeTexture.set(K.TEXTURE0),Pt.texture&&Pt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const _t=ps.getMorphValuesForProxy(St.key),xt=_t?1:0;_t&&a.C(De,{morphing:{srcDemTile:_t.from,dstDemTile:_t.to,phase:a.cw(_t.phase)}});const mt=a.cz(St.canonical),Ot=a.cA(mt.getCenter().lat),Kt=a.cB(St.canonical,mt,Ot,Je.worldSize/Je._pixelsPerMercatorPixel),on=a.b6(a.cC(St.canonical)),Zt=Eu(Je.expandedFarZProjMatrix,Ne,we,on,a.a9(Je.zoom),Ie,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,Be,at,Je._farZ,Kt);if(fe(St,xt),re&&(F.setupElevationDraw(Pt,re,De),B.uploadCommonUniforms(ee,re,St.toUnwrapped()),Re)){const[un,Ut,hn]=Re.getGridBuffers(Ot,at!==0);re.draw(B,vt,Ee,He,be,mn.backCCW,Zt,"globe_raster",un,Ut,hn)}}}if(Re&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];de&&Je.push("CUSTOM_ANTIALIASING"),re=B.getOrCreateProgram("globeRaster",{defines:Je});for(const at of q){const{x:vt,y:St,z:Pt}=at.canonical,He=St===0,gt=St===(1<<Pt)-1,[rt,_t,xt,mt]=Re.getPoleBuffers(Pt,!1);if(mt&&(He||gt)){const Ot=U.getTile(at);ee.activeTexture.set(K.TEXTURE0),Ot.texture&&Ot.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let Kt=a.cD(Pt,vt,ae);const on=a.b6(a.cC(at.canonical)),Zt=(un,Ut)=>un.draw(B,K.TRIANGLES,Ee,xn.disabled,be,mn.disabled,Eu(ae.expandedFarZProjMatrix,Kt,Kt,on,0,Ie,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Be,0,ae._farZ),"globe_pole_raster",Ut,xt,mt);F.setupElevationDraw(Ot,re,De),B.uploadCommonUniforms(ee,re,at.toUnwrapped()),He&&B.renderDefaultNorthPole&&Zt(re,rt),gt&&B.renderDefaultSouthPole&&(Kt=a.a6.mat4.scale(a.a6.mat4.create(),Kt,[1,-1,1]),Zt(re,_t))}}}})(_,v,b,P,D);else{const B=_.context,F=B.gl;let U,q;const $=_.shadowRenderer,ee=Cr(_,_.longestCutoffRange),K=be=>{if(q===be)return;const Ee=[];Ee.push(Dc[be]),ee.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),$&&(Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&Ee.push("NORMAL_OFFSET")),U=_.getOrCreateProgram("terrainRaster",{defines:Ee}),q=be},re=_.colorModeForRenderPass(),ie=new rn(F.LEQUAL,rn.ReadWrite,_.depthRangeFor3D);ps.update(D);const ae=_.transform,de=gr(ae.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let fe=[0,0,0];if($){const be=_.style.directionalLight,Ee=_.style.ambientLight;be&&Ee&&(fe=or(_.style,be,Ee))}{q=-1;const be=F.TRIANGLES,[Ee,we]=[v.gridIndexBuffer,v.gridSegments];for(const Ie of P){const Re=b.getTile(Ie),Be=xn.disabled,Ne=v.prevTerrainTileForTile[Ie.key],De=v.terrainTileForTile[Ie.key];nc(Ne,De)&&ps.newMorphing(Ie.key,Ne,De,D,250),B.activeTexture.set(F.TEXTURE0),Re.texture&&Re.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Je=ps.getMorphValuesForProxy(Ie.key),at=Je?1:0;let vt;Je&&(vt={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:a.cw(Je.phase)}});const St=uh(Ie.projMatrix,ms(Ie.canonical,ae.renderWorldCopies)?de/10:de,fe);if(K(at),!U)continue;v.setupElevationDraw(Re,U,vt);const Pt=Ie.toUnwrapped();$&&$.setupShadows(Pt,U),_.uploadCommonUniforms(B,U,Pt,null,ee),U.draw(_,be,ie,Be,re,mn.backCCW,St,"terrain_raster",v.gridBuffer,Ee,we)}}}}(o,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const o=this.painter,f=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),P=o.style.order,D=[];let B=0;for(const F of v){const U=_.getTileByID(F.proxyTileKey),q=_.proxyCachedFBO[F.key]?_.proxyCachedFBO[F.key][n]:void 0,$=q!==void 0?_.renderCache[q]:this.pool[B++],ee=q!==void 0;if(U.texture=$.tex,ee&&!$.dirty){D.push(U.tileID);continue}let K;f.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(f.clear({color:a.bA.transparent,stencil:0}),$.dirty=!1);for(let re=b.start;re<=b.end;++re){const ie=o.style._mergedLayers[P[re]];if(ie.isHidden(o.transform.zoom))continue;const ae=o.style.getLayerSourceCache(ie),de=ae?this.proxyToSource[F.key][ae.id]:[F];if(!de)continue;const fe=de;f.viewport.set([0,0,$.fb.width,$.fb.height]),K!==(ae?ae.id:null)&&(this._setupStencil($,de,ie,ae),K=ae?ae.id:null),o.renderLayer(o,ae,ie,fe)}if(this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const ie=o.style._mergedLayers[P[re]];if(ie.isHidden(o.transform.zoom))continue;const ae=o.style.getLayerSourceCache(ie),de=ae?this.proxyToSource[F.key][ae.id]:[F];if(!de)continue;const fe=de;f.viewport.set([0,0,$.fb.width,$.fb.height]),K!==(ae?ae.id:null)&&(this._setupStencil($,de,ie,ae),K=ae?ae.id:null),o.renderLayer(o,ae,ie,fe)}this.renderedToTile?($.dirty=!0,D.push(U.tileID)):ee||--B,B===5&&(B=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),b.end+1}postRender(){}isLayerOrderingCorrect(n){const o=n.order.length;let f=-1,_=o;for(let v=0;v<o;++v)this._style.isLayerDraped(n._mergedLayers[n.order[v]])?f=Math.max(f,v):_=Math.min(_,v);return _>f}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{n=Math.min(n,o.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,o,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const b=v.tileID,P=1<<b.overscaledZ,{x:D,y:B}=b.canonical,F=D/P,U=(D+1)/P,q=B/P,$=(B+1)/P;return{minx:F,miny:q,maxx:U,maxy:$,t:v.dem.tree.raycastRoot(F,q,U,$,n,o,f),tile:v}});_.sort((v,b)=>(v.t!==null?v.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const v of _){if(v.t==null)return null;const b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,n,o,f);if(b!=null)return b}return null}_createFBO(){const n=this.painter.context,o=n.gl,f=this.drapeBufferSize;n.activeTexture.set(o.TEXTURE0);const _=new a.T(n,{width:f[0],height:f[1],data:null},o.RGBA8);_.bind(o.LINEAR,o.CLAMP_TO_EDGE);const v=n.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(_.texture),v.depthAttachment=new Aa(n,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const o=this._style._mergedLayers[n],f=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!f&&o.shouldRedrape():!f&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style.getSources())if(f instanceof Ji){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(v&&!o[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof a.a4){o[v.id]=!0;for(const b of this.proxyCoords){const P=this.proxyToSource[b.key][v.id];if(P)for(const D of P)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof oi){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(!v||o[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const b=_.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const D=this.proxyToSource[P.key][v.id];if(D)for(const B of D){const F=Vl(v.getTile(B),v.findLoadedParent(B,0),v,this.painter.transform,b);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(v.id,B)}}}}_setupDrapedRenderBatches(){const n=this._style.order,o=n.length;if(o===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,v=0,b=this._style._mergedLayers[n[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<o;)b=this._style._mergedLayers[n[v]];for(;v<o;++v){const P=this._style._mergedLayers[n[v]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?_===void 0&&(_=v):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),_!==void 0&&(f.push({start:_,end:v-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:v-1}),f.length!==0){const P=f[f.length-1];this._pendingGroundEffectLayers.every(D=>D>P.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(n){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const b=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let P=0;P<b.length;++P){const D=Object.values(b[P]);o.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let b=f.length-1;b>=0;b--){const P=f[b];if(o.getTileByID(P.key),o.proxyCachedFBO[P.key]!==void 0){const D=n[P.key],B=this.proxyToSource[P.key];let F=0;for(const U in B){const q=B[U],$=D[U];if(!$||$.length!==q.length||q.some((ee,K)=>ee!==$[K]||_[U]&&_[U].hasOwnProperty(ee.key))){F=-1;break}++F}for(const U in o.proxyCachedFBO[P.key])o.renderCache[o.proxyCachedFBO[P.key][U]].dirty=F<0||F!==Object.values(D).length}}const v=[...this._drapedRenderBatches];v.sort((b,P)=>P.end-P.start-(b.end-b.start));for(const b of v)for(const P of f){if(o.proxyCachedFBO[P.key])continue;let D=o.renderCachePool.pop();D===void 0&&o.renderCache.length<50&&(D=o.renderCache.length,o.renderCache.push(this._createFBO())),D!==void 0&&(o.proxyCachedFBO[P.key]={},o.proxyCachedFBO[P.key][b.start]=D,o.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(n,o,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,b=v.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let P;if(f.isTileClipped())P=o.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):xn.disabled}_renderTileClippingMasks(n,o){const f=this.painter,_=this.painter.context,v=_.gl;f._tileClippingMaskIDs={},_.setColorMode(An.disabled),_.setDepthMode(rn.disabled);const b=f.getOrCreateProgram("clippingMask");for(const P of n){const D=f._tileClippingMaskIDs[P.key]=--o;b.draw(f,v.TRIANGLES,rn.disabled,new xn({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),An.disabled,mn.disabled,il(P.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const o=this.painter.transform;if(n.x<0||n.x>o.width||n.y<0||n.y>o.height)return null;const f=[n.x,n.y,1,1];a.a6.vec4.transformMat4(f,f,o.pixelMatrixInverse),a.a6.vec4.scale(f,f,1/f[3]),f[0]/=o.worldSize,f[1]/=o.worldSize;const _=o._camera.position,v=a.bE(1,o.center.lat),b=[_[0],_[1],_[2]/v,0],P=a.a6.vec3.subtract([],f.slice(0,3),b);a.a6.vec3.normalize(P,P);const D=this.raycast(b,P,this._exaggeration);return D!==null&&D?(a.a6.vec3.scaleAndAdd(b,b,P,D),b[3]=b[2],b[2]*=v,b):null}_setupProxiedCoordsForOrtho(n,o,f){if(n.getSource()instanceof a.aD)return this._setupProxiedCoordsForImageSource(n,o,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){const B=v[D],F=this._findTileCoveringTileID(B,n);if(F){const U=this._createProxiedId(B,F,f[B.key]&&f[B.key][n.id]);_.push(U),this.proxyToSource[B.key][n.id]=[U]}}let b=!1;const P=new Set;for(let D=0;D<o.length;D++){const B=n.getTile(o[D]);if(!B||!B.hasData())continue;const F=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==B.tileID.canonical.z){const U=this.proxyToSource[F.tileID.key][n.id],q=this._createProxiedId(F.tileID,B,f[F.tileID.key]&&f[F.tileID.key][n.id]);U?U.splice(U.length-1,0,q):this.proxyToSource[F.tileID.key][n.id]=[q];const $=this.proxyToSource[F.tileID.key][n.id];P.has($)||P.add($),_.push(q),b=!0}}if(this._sourceTilesOverlap[n.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const D of P)D.sort((B,F)=>F.overscaledZ-B.overscaledZ)}_setupProxiedCoordsForImageSource(n,o,f){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],v=this.proxyCoords,b=n.getSource(),P=b.tileID;if(!P)return;const D=new a.P(P.x,P.y)._div(1<<P.z),B=b.coordinates.map(a.a5.fromLngLat).reduce((U,q)=>(U.min.x=Math.min(U.min.x,q.x-D.x),U.min.y=Math.min(U.min.y,q.y-D.y),U.max.x=Math.max(U.max.x,q.x-D.x),U.max.y=Math.max(U.max.y,q.y-D.y),U),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(U,q)=>{const $=U.wrap+U.canonical.x/(1<<U.canonical.z),ee=U.canonical.y/(1<<U.canonical.z),K=a.ab/(1<<U.canonical.z),re=q.wrap+q.canonical.x/(1<<q.canonical.z),ie=q.canonical.y/(1<<q.canonical.z);return $+K<re+B.min.x||$>re+B.max.x||ee+K<ie+B.min.y||ee>ie+B.max.y};for(let U=0;U<v.length;U++){const q=v[U];for(let $=0;$<o.length;$++){const ee=n.getTile(o[$]);if(!ee||!ee.hasData()||F(q,ee.tileID))continue;const K=this._createProxiedId(q,ee,f[q.key]&&f[q.key][n.id]),re=this.proxyToSource[q.key][n.id];re?re.push(K):this.proxyToSource[q.key][n.id]=[K],_.push(K)}}}_createProxiedId(n,o,f){let _=this.orthoMatrix;if(f){const v=f.find(b=>b.key===o.tileID.key);if(v)return v}if(o.tileID.key!==n.key){const v=n.canonical.z-o.tileID.canonical.z;let b,P,D;_=a.a6.mat4.create();const B=o.tileID.wrap-n.wrap<<n.overscaledZ;v>0?(b=a.ab>>v,P=b*((o.tileID.canonical.x<<v)-n.canonical.x+B),D=b*((o.tileID.canonical.y<<v)-n.canonical.y)):(b=a.ab<<-v,P=a.ab*(o.tileID.canonical.x-(n.canonical.x+B<<-v)),D=a.ab*(o.tileID.canonical.y-(n.canonical.y<<-v))),a.a6.mat4.ortho(_,0,b,0,b,0,1),a.a6.mat4.translate(_,_,[P,D,0])}return new Iu(o.tileID,n.key,_)}_findTileCoveringTileID(n,o){let f=o.getTile(n);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[o.id],v=_[n.key];if(f=v?o.getTileByID(v):null,f&&f.hasData()||v===null)return f;let b=f?f.tileID:n,P=b.overscaledZ;const D=o.getSource().minzoom,B=[];if(!v){const U=o.getSource().maxzoom;if(n.canonical.z>=U){const q=n.canonical.z-U;o.getSource().reparseOverscaled?(P=Math.max(n.canonical.z+2,o.transform.tileZoom),b=new a.aA(P,n.wrap,U,n.canonical.x>>q,n.canonical.y>>q)):q!==0&&(P=U,b=new a.aA(P,n.wrap,U,n.canonical.x>>q,n.canonical.y>>q))}b.key!==n.key&&(B.push(b.key),f=o.getTile(b))}const F=U=>{B.forEach(q=>{_[q]=U}),B.length=0};for(P-=1;P>=D&&(!f||!f.hasData());P--){f&&F(f.tileID.key);const U=b.calculateScaledKey(P);if(f=o.getTileByID(U),f&&f.hasData())break;const q=_[U];if(q===null)break;q===void 0?B.push(U):f=o.getTileByID(q)}return F(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,o){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[o.key]=!0}}function Tu(d,n,o){const f=function(P,D,B){const F=a.a6.vec3.dot(D,P),U=a.a6.vec3.dot(B,[.2126,.7152,.0722]),q=(ee,K,re)=>(1-re)*ee+re*K,$=q(1-.3*Math.min(U,1),1,Math.min(F+1,1));return q(.92,1,Math.asin(a.ap(D[2],-1,1))/Math.PI+.5)*$}(d,[0,0,1],n),_=[0,0,0];a.a6.vec3.scale(_,o.slice(0,3),f);const v=[0,0,0];a.a6.vec3.scale(v,n.slice(0,3),d[2]);const b=[0,0,0];return a.a6.vec3.add(b,_,v),a.cc(b)}const Do=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Oc=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Ts{static cacheKey(n,o,f,_){let v=`${o}${_?_.cacheKey:""}`;for(const b of f)n.usedDefines.includes(b)&&(v+=`/${b}`);return v}constructor(n,o,f,_,v,b){const P=n.gl;this.program=P.createProgram(),this.configuration=_,this.name=o,this.fixedDefines=[...b];const D=_?_.getBinderAttributes():[],B=(f.staticAttributes||[]).concat(D);let F=_?_.defines():[];F=F.concat(b.map(re=>`#define ${re}`));const U=`#version 300 es
`;let q=U+F.concat("precision mediump float;",yu,go.fragmentSource).join(`
`);for(const re of f.fragmentIncludes)q+=`
${po[re]}`;q+=`
${f.fragmentSource}`;let $=U+F.concat("precision highp float;",yu,go.vertexSource).join(`
`);for(const re of f.vertexIncludes)$+=`
${po[re]}`;$+=`
${f.vertexSource}`;const ee=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(ee,q),P.compileShader(ee),P.attachShader(this.program,ee);const K=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(K,$),P.compileShader(K),P.attachShader(this.program,K),this.attributes={},this.numAttributes=B.length;for(let re=0;re<this.numAttributes;re++)if(B[re]){const ie=B[re].startsWith("a_")?B[re]:`a_${B[re]}`;P.bindAttribLocation(this.program,re,ie),this.attributes[ie]=re}P.linkProgram(this.program),P.deleteShader(K),P.deleteShader(ee),this.fixedUniforms=v(n),this.binderUniforms=_?_.getUniforms(n):[],(b.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(re=>({u_dem:new a.bK(re),u_dem_prev:new a.bK(re),u_dem_tl:new a.bH(re),u_dem_scale:new a.bJ(re),u_dem_tl_prev:new a.bH(re),u_dem_scale_prev:new a.bJ(re),u_dem_size:new a.bJ(re),u_dem_lerp:new a.bJ(re),u_exaggeration:new a.bJ(re),u_depth:new a.bK(re),u_depth_size_inv:new a.bH(re),u_depth_range_unpack:new a.bH(re),u_occluder_half_size:new a.bJ(re),u_occlusion_depth_offset:new a.bJ(re),u_meter_to_dem:new a.bJ(re),u_label_plane_matrix_inv:new a.bG(re)}))(n)),b.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new a.bI(re),u_tile_tr_up:new a.bI(re),u_tile_br_up:new a.bI(re),u_tile_bl_up:new a.bI(re),u_tile_up_scale:new a.bJ(re)}))(n)),b.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new a.bG(re),u_fog_range:new a.bH(re),u_fog_color:new a.c7(re),u_fog_horizon_blend:new a.bJ(re),u_fog_vertical_limit:new a.bH(re),u_fog_temporal_offset:new a.bJ(re),u_frustum_tl:new a.bI(re),u_frustum_tr:new a.bI(re),u_frustum_br:new a.bI(re),u_frustum_bl:new a.bI(re),u_globe_pos:new a.bI(re),u_globe_radius:new a.bJ(re),u_globe_transition:new a.bJ(re),u_is_globe:new a.bK(re),u_viewport:new a.bH(re)}))(n)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new a.c7(re)}))(n)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new a.bI(re),u_lighting_directional_dir:new a.bI(re),u_lighting_directional_color:new a.bI(re),u_ground_radiance:new a.bI(re)}))(n)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new a.bG(re),u_light_matrix_1:new a.bG(re),u_fade_range:new a.bH(re),u_shadow_normal_offset:new a.bI(re),u_shadow_intensity:new a.bJ(re),u_shadow_texel_size:new a.bJ(re),u_shadow_map_resolution:new a.bJ(re),u_shadow_direction:new a.bI(re),u_shadow_bias:new a.bI(re),u_shadowmap_0:new a.bK(re),u_shadowmap_1:new a.bK(re)}))(n))}}setTerrainUniformValues(n,o){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_]&&f[_].set(this.program,_,o[_])}}setGlobeUniformValues(n,o){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_]&&f[_].set(this.program,_,o[_])}}setFogUniformValues(n,o){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setCutoffUniformValues(n,o){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setLightsUniformValues(n,o){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}}setShadowUniformValues(n,o){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;n.program.set(this.program);for(const _ in o)f[_].set(this.program,_,o[_])}_drawDebugWireframe(n,o,f,_,v,b,P,D,B,F){const U=n.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const q=n.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||n._terrain&&n._terrain.renderingToTexture||!Do.includes(this.name))||!(!U.layers3D||!Oc.includes(this.name))))return;const $=q.gl,ee=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,v,q);if(!ee)return;const K=[...this.fixedDefines];K.push("DEBUG_WIREFRAME");const re=n.getOrCreateProgram(this.name,{config:this.configuration,defines:K});q.program.set(re.program);const ie=(fe,be,Ee)=>{if(be[fe]&&Ee[fe])for(const we in be[fe])Ee[fe][we]&&Ee[fe][we].set(Ee.program,we,be[fe][we].current)};B&&B.setUniforms(re.program,q,re.binderUniforms,P,{zoom:D}),ie("fixedUniforms",this,re),ie("terrainUniforms",this,re),ie("globeUniforms",this,re),ie("fogUniforms",this,re),ie("lightsUniforms",this,re),ie("shadowUniforms",this,re),ee.bind(),q.setColorMode(new An([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],a.bA.transparent,[!0,!0,!0,!1])),q.setDepthMode(new rn(o.func===$.LESS?$.LEQUAL:o.func,rn.ReadOnly,o.range)),q.setStencilMode(xn.disabled);const ae=3*b.primitiveLength*2,de=3*b.primitiveOffset*2*2;F&&F>1?$.drawElementsInstanced($.LINES,ae,$.UNSIGNED_SHORT,de,F):$.drawElements($.LINES,ae,$.UNSIGNED_SHORT,de),v.bind(),q.program.set(this.program),q.setDepthMode(o),q.setStencilMode(f),q.setColorMode(_)}checkUniforms(n,o,f){if(this.fixedDefines.includes(o)){for(const _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${_} not set but required by ${o} being defined`)}}draw(n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re){const ie=n.context,ae=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(f),ie.setStencilMode(_),ie.setColorMode(v),ie.setCullFace(b);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,P[be]);ee&&ee.setUniforms(this.program,ie,this.binderUniforms,q,{zoom:$});const de={[ae.POINTS]:1,[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[o];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const fe=re&&re>0?1:void 0;for(const be of U.get()){const Ee=be.vaos||(be.vaos={});(Ee[D]||(Ee[D]=new Jo)).bind(ie,this,B,ee?ee.getPaintVertexBuffers():[],F,be.vertexOffset,K||[],fe),re&&re>1?ae.drawElementsInstanced(o,be.primitiveLength*de,ae.UNSIGNED_SHORT,be.primitiveOffset*de*2,re):F?ae.drawElements(o,be.primitiveLength*de,ae.UNSIGNED_SHORT,be.primitiveOffset*de*2):ae.drawArrays(o,be.vertexOffset,be.vertexLength),o===ae.TRIANGLES&&F&&this._drawDebugWireframe(n,f,_,v,F,be,q,$,ee,re)}}}function Pa(d,n){const o=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,d.transform.tileZoom)/o,_=f*(n.tileID.canonical.x+n.tileID.wrap*o),v=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ak(n,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}const ea={terrain:0,flat:1},rc=a.a6.mat4.create(),Su=(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re,ie)=>{const ae=n.style.light,de=ae.properties.get("position"),fe=[de.x,de.y,de.z],be=a.a6.mat3.create();ae.properties.get("anchor")==="viewport"&&(a.a6.mat3.fromRotation(be,-n.transform.angle),a.a6.vec3.transformMat3(fe,fe,be));const Ee=ae.properties.get("color"),we=n.transform,Ie={u_matrix:d,u_lightpos:fe,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[Ee.r,Ee.g,Ee.b],u_vertical_gradient:+o,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ea[B],u_base_type:ea[F],u_ao:_,u_edge_radius:v,u_width_scale:b,u_flood_light_color:ee,u_vertical_scale:K,u_flood_light_intensity:re,u_ground_shadow_factor:ie};return we.projection.name==="globe"&&(Ie.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],Ie.u_zoom_transition=U,Ie.u_inv_rot_matrix=$,Ie.u_merc_center=q,Ie.u_up_dir=we.projection.upVector(new a.bQ(0,0,0),q[0]*a.ab,q[1]*a.ab),Ie.u_height_lift=D),Ie},ci=(d,n,o,f,_,v)=>({u_matrix:d,u_edge_radius:n,u_width_scale:o,u_vertical_scale:f,u_height_type:ea[_],u_base_type:ea[v]}),Ss=(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re)=>{const ie=Su(d,n,o,f,_,v,b,P,B,F,U,q,$,ee,K,re,1,[0,0,0]),ae={u_height_factor:-Math.pow(2,P.overscaledZ)/D.tileSize/8};return a.l(ie,Pa(n,D),ae)},Cu=(d,n)=>({u_matrix:d,u_emissive_strength:n}),ta=(d,n,o,f)=>a.l(Cu(d,n),Pa(o,f)),gs=(d,n,o)=>({u_matrix:d,u_world:o,u_emissive_strength:n}),rl=(d,n,o,f,_)=>a.l(ta(d,n,o,f),{u_world:_}),sc=(d,n,o,f)=>{const _=a.ab/o.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},Js=(d,n,o=1)=>({u_matrix:d,u_color:n.toRenderColor(null),u_overlay:0,u_overlay_scale:o}),na=a.a6.mat4.create(),Gl=(d,n,o,f,_,v,b)=>{const P=d.transform,D=P.projection.name==="globe",B=D?a.cI(P.zoom,n.canonical)*P._pixelsPerMercatorPixel:a.ak(o,1,v),F={u_matrix:n.projMatrix,u_extrude_scale:B,u_intensity:b,u_inv_rot_matrix:na,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){F.u_inv_rot_matrix=f,F.u_merc_center=_,F.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],F.u_zoom_transition=a.a9(P.zoom);const U=_[0]*a.ab,q=_[1]*a.ab;F.u_up_dir=P.projection.upVector(new a.bQ(0,0,0),U,q)}return F};function yo(d,[n,o,f,_],[v,b]){if(v===b)return[0,0,0,0];const P=255*(d-1)/(d*(b-v));return[n*P,o*P,f*P,_*P]}function Oo(d,n,[o,f]){return o===f?0:.5/d+(n-o)*(d-1)/(d*(f-o))}const La=(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re,ie,ae,de,fe)=>({u_matrix:d,u_normalize_matrix:n,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:B,u_fade_t:F.mix,u_opacity:F.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:a.cJ(U.paint.get("raster-saturation")),u_contrast_factor:a.cK(U.paint.get("raster-contrast")),u_spin_weights:ql(U.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:$,u_zoom_transition:b,u_merc_center:P,u_cutoff_params:D,u_colorization_mix:yo(a.cL,K,ie),u_colorization_offset:Oo(a.cL,re,ie),u_color_ramp:ee,u_texture_offset:[de/(ae+2*de),ae/(ae+2*de)],u_texture_res:[ae+2*de,ae+2*de],u_emissive_strength:fe});function ql(d){d*=Math.PI/180;const n=Math.sin(d),o=Math.cos(d);return[(2*o+1)/3,(-Math.sqrt(3)*n-o+1)/3,(Math.sqrt(3)*n-o+1)/3]}const ia=.05,sl=(d,n,o,f,_,v,b,P,D,B,F,U)=>({u_matrix:d,u_normalize_matrix:n,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:B,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:P,u_cutoff_params:D}),Mu=(d,n,o,f,_,v,b,P,D,B)=>({u_particle_texture:d,u_particle_texture_side_len:n,u_tile_offset:o,u_velocity:f,u_color_ramp:v,u_velocity_res:_,u_max_speed:b,u_uv_offset:P,u_data_scale:[255*D[0],255*D[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[ia,ia]}),oc=(d,n,o,f,_,v,b,P,D,B)=>({u_particle_texture:d,u_particle_texture_side_len:n,u_velocity:o,u_velocity_res:f,u_max_speed:_,u_speed_factor:v,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*D[0],255*D[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[ia,ia]}),ac=a.a6.mat4.create(),hi=(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re,ie,ae,de,fe,be)=>{const Ee=_.transform,we={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Ee.getCameraToCenterDistance(ae),u_rotate_symbol:+o,u_aspect_ratio:Ee.width/Ee.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:P,u_is_text:+B,u_elevation_from_sea:D?1:0,u_pitch_with_map:+f,u_texsize:F,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ac,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ac,u_up_vector:[0,-1,0],u_color_adj_mat:de,u_icon_transition:fe||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(ae)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:a.q.devicePixelRatio,u_is_halo:+q,u_scale_factor:be||1};return ae.name==="globe"&&(we.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],we.u_zoom_transition=ee,we.u_inv_rot_matrix=re,we.u_merc_center=K,we.u_camera_forward=Ee._camera.forward(),we.u_ecef_origin=a.cM(Ee.globeMatrix,$.toUnwrapped()),we.u_tile_matrix=Float32Array.from(Ee.globeMatrix),we.u_up_vector=ie),we},Xr=(d,n,o,f)=>({u_matrix:d,u_emissive_strength:n,u_opacity:o,u_color:f}),al=(d,n,o,f,_,v,b,P,D)=>a.l(function(B,F,U,q,$,ee){const{width:K,height:re}=q.imageManager.getPixelSize(F),ie=Math.pow(2,ee.tileID.overscaledZ),ae=ee.tileSize*Math.pow(2,q.transform.tileZoom)/ie,de=ae*(ee.tileID.canonical.x+ee.tileID.wrap*ie),fe=ae*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[K,re],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:$?[q.transform.width,-1*q.transform.height]:[1/a.ak(ee,1,q.transform.tileZoom),1/a.ak(ee,1,q.transform.tileZoom)],u_pixel_coord_upper:[de>>16,fe>>16],u_pixel_coord_lower:[65535&de,65535&fe]}}(0,v,b,f,P,D),{u_matrix:d,u_emissive_strength:n,u_opacity:o}),Gt=new Float32Array(a.a6.mat4.identity([])),ll=(d,n,o,f,_,v,b,P,D,B,F,U,q,$=[0,0,0],ee)=>{const K=_.style.light,re=K.properties.get("position"),ie=[-re.x,-re.y,re.z],ae=a.a6.mat3.create();K.properties.get("anchor")==="viewport"&&(a.a6.mat3.fromRotation(ae,-_.transform.angle),a.a6.vec3.transformMat3(ie,ie,ae));const de=F.alphaMode==="MASK",fe=K.properties.get("color").toRenderColor(null),be=q.paint.get("model-ambient-occlusion-intensity"),Ee=q.paint.get("model-color").constantOr(a.bA.white).toRenderColor(null),we=q.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:n,u_normal_matrix:o,u_node_matrix:f||Gt,u_lightpos:ie,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:$,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+de,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[P[0],P[1],P[2],1],u_metallicFactor:D,u_roughnessFactor:B,u_baseColorTexture:Hr.BaseColor,u_metallicRoughnessTexture:Hr.MetallicRoughness,u_normalTexture:Hr.Normal,u_occlusionTexture:Hr.Occlusion,u_emissionTexture:Hr.Emission,u_lutTexture:Hr.LUT,u_color_mix:[Ee.r,Ee.g,Ee.b,we],u_aoIntensity:be,u_emissive_strength:U,u_occlusionTextureTransform:ee||[0,0,0,0]}},ul=(d,n=Gt,o=Gt)=>({u_matrix:d,u_instance:n,u_node_matrix:o}),No={fillExtrusion:d=>({u_matrix:new a.bG(d),u_lightpos:new a.bI(d),u_lightintensity:new a.bJ(d),u_lightcolor:new a.bI(d),u_vertical_gradient:new a.bJ(d),u_opacity:new a.bJ(d),u_edge_radius:new a.bJ(d),u_width_scale:new a.bJ(d),u_ao:new a.bH(d),u_height_type:new a.bK(d),u_base_type:new a.bK(d),u_tile_id:new a.bI(d),u_zoom_transition:new a.bJ(d),u_inv_rot_matrix:new a.bG(d),u_merc_center:new a.bH(d),u_up_dir:new a.bI(d),u_height_lift:new a.bJ(d),u_flood_light_color:new a.bI(d),u_vertical_scale:new a.bJ(d),u_flood_light_intensity:new a.bJ(d),u_ground_shadow_factor:new a.bI(d)}),fillExtrusionDepth:d=>({u_matrix:new a.bG(d),u_edge_radius:new a.bJ(d),u_width_scale:new a.bJ(d),u_vertical_scale:new a.bJ(d),u_height_type:new a.bK(d),u_base_type:new a.bK(d)}),fillExtrusionPattern:d=>({u_matrix:new a.bG(d),u_lightpos:new a.bI(d),u_lightintensity:new a.bJ(d),u_lightcolor:new a.bI(d),u_vertical_gradient:new a.bJ(d),u_height_factor:new a.bJ(d),u_edge_radius:new a.bJ(d),u_width_scale:new a.bJ(d),u_ao:new a.bH(d),u_height_type:new a.bK(d),u_base_type:new a.bK(d),u_tile_id:new a.bI(d),u_zoom_transition:new a.bJ(d),u_inv_rot_matrix:new a.bG(d),u_merc_center:new a.bH(d),u_up_dir:new a.bI(d),u_height_lift:new a.bJ(d),u_image:new a.bK(d),u_texsize:new a.bH(d),u_pixel_coord_upper:new a.bH(d),u_pixel_coord_lower:new a.bH(d),u_tile_units_to_pixels:new a.bJ(d),u_opacity:new a.bJ(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new a.bG(d),u_opacity:new a.bJ(d),u_ao_pass:new a.bJ(d),u_meter_to_tile:new a.bJ(d),u_ao:new a.bH(d),u_flood_light_intensity:new a.bJ(d),u_flood_light_color:new a.bI(d),u_attenuation:new a.bJ(d),u_edge_radius:new a.bJ(d),u_fb:new a.bK(d),u_fb_size:new a.bJ(d),u_dynamic_offset:new a.bJ(d)}),fill:d=>({u_matrix:new a.bG(d),u_emissive_strength:new a.bJ(d)}),fillPattern:d=>({u_matrix:new a.bG(d),u_emissive_strength:new a.bJ(d),u_image:new a.bK(d),u_texsize:new a.bH(d),u_pixel_coord_upper:new a.bH(d),u_pixel_coord_lower:new a.bH(d),u_tile_units_to_pixels:new a.bJ(d)}),fillOutline:d=>({u_matrix:new a.bG(d),u_emissive_strength:new a.bJ(d),u_world:new a.bH(d)}),fillOutlinePattern:d=>({u_matrix:new a.bG(d),u_emissive_strength:new a.bJ(d),u_world:new a.bH(d),u_image:new a.bK(d),u_texsize:new a.bH(d),u_pixel_coord_upper:new a.bH(d),u_pixel_coord_lower:new a.bH(d),u_tile_units_to_pixels:new a.bJ(d)}),circle:a.cN,collisionBox:d=>({u_matrix:new a.bG(d),u_camera_to_center_distance:new a.bJ(d),u_extrude_scale:new a.bH(d)}),collisionCircle:d=>({u_matrix:new a.bG(d),u_inv_matrix:new a.bG(d),u_camera_to_center_distance:new a.bJ(d),u_viewport_size:new a.bH(d)}),debug:d=>({u_color:new a.cu(d),u_matrix:new a.bG(d),u_overlay:new a.bK(d),u_overlay_scale:new a.bJ(d)}),clippingMask:d=>({u_matrix:new a.bG(d)}),heatmap:d=>({u_extrude_scale:new a.bJ(d),u_intensity:new a.bJ(d),u_matrix:new a.bG(d),u_inv_rot_matrix:new a.bG(d),u_merc_center:new a.bH(d),u_tile_id:new a.bI(d),u_zoom_transition:new a.bJ(d),u_up_dir:new a.bI(d)}),heatmapTexture:d=>({u_image:new a.bK(d),u_color_ramp:new a.bK(d),u_opacity:new a.bJ(d)}),hillshade:d=>({u_matrix:new a.bG(d),u_image:new a.bK(d),u_latrange:new a.bH(d),u_light:new a.bH(d),u_shadow:new a.cu(d),u_highlight:new a.cu(d),u_emissive_strength:new a.bJ(d),u_accent:new a.cu(d)}),hillshadePrepare:d=>({u_matrix:new a.bG(d),u_image:new a.bK(d),u_dimension:new a.bH(d),u_zoom:new a.bJ(d)}),line:a.cO,linePattern:a.cP,raster:d=>({u_matrix:new a.bG(d),u_normalize_matrix:new a.bG(d),u_globe_matrix:new a.bG(d),u_merc_matrix:new a.bG(d),u_grid_matrix:new a.cv(d),u_tl_parent:new a.bH(d),u_scale_parent:new a.bJ(d),u_fade_t:new a.bJ(d),u_opacity:new a.bJ(d),u_image0:new a.bK(d),u_image1:new a.bK(d),u_brightness_low:new a.bJ(d),u_brightness_high:new a.bJ(d),u_saturation_factor:new a.bJ(d),u_contrast_factor:new a.bJ(d),u_spin_weights:new a.bI(d),u_perspective_transform:new a.bH(d),u_raster_elevation:new a.bJ(d),u_zoom_transition:new a.bJ(d),u_merc_center:new a.bH(d),u_cutoff_params:new a.c7(d),u_colorization_mix:new a.c7(d),u_colorization_offset:new a.bJ(d),u_color_ramp:new a.bK(d),u_texture_offset:new a.bH(d),u_texture_res:new a.bH(d),u_emissive_strength:new a.bJ(d)}),rasterParticle:d=>({u_matrix:new a.bG(d),u_normalize_matrix:new a.bG(d),u_globe_matrix:new a.bG(d),u_merc_matrix:new a.bG(d),u_grid_matrix:new a.cv(d),u_tl_parent:new a.bH(d),u_scale_parent:new a.bJ(d),u_fade_t:new a.bJ(d),u_opacity:new a.bJ(d),u_image0:new a.bK(d),u_image1:new a.bK(d),u_raster_elevation:new a.bJ(d),u_zoom_transition:new a.bJ(d),u_merc_center:new a.bH(d),u_cutoff_params:new a.c7(d)}),rasterParticleTexture:d=>({u_texture:new a.bK(d),u_opacity:new a.bJ(d)}),rasterParticleDraw:d=>({u_particle_texture:new a.bK(d),u_particle_texture_side_len:new a.bJ(d),u_tile_offset:new a.bH(d),u_velocity:new a.bK(d),u_color_ramp:new a.bK(d),u_velocity_res:new a.bH(d),u_max_speed:new a.bJ(d),u_uv_offset:new a.bH(d),u_data_scale:new a.bH(d),u_data_offset:new a.bJ(d),u_particle_pos_scale:new a.bJ(d),u_particle_pos_offset:new a.bH(d)}),rasterParticleUpdate:d=>({u_particle_texture:new a.bK(d),u_particle_texture_side_len:new a.bJ(d),u_velocity:new a.bK(d),u_velocity_res:new a.bH(d),u_max_speed:new a.bJ(d),u_speed_factor:new a.bJ(d),u_reset_rate:new a.bJ(d),u_rand_seed:new a.bJ(d),u_uv_offset:new a.bH(d),u_data_scale:new a.bH(d),u_data_offset:new a.bJ(d),u_particle_pos_scale:new a.bJ(d),u_particle_pos_offset:new a.bH(d)}),symbol:d=>({u_is_size_zoom_constant:new a.bK(d),u_is_size_feature_constant:new a.bK(d),u_size_t:new a.bJ(d),u_size:new a.bJ(d),u_camera_to_center_distance:new a.bJ(d),u_rotate_symbol:new a.bK(d),u_aspect_ratio:new a.bJ(d),u_fade_change:new a.bJ(d),u_matrix:new a.bG(d),u_label_plane_matrix:new a.bG(d),u_coord_matrix:new a.bG(d),u_is_text:new a.bK(d),u_elevation_from_sea:new a.bK(d),u_pitch_with_map:new a.bK(d),u_texsize:new a.bH(d),u_texsize_icon:new a.bH(d),u_texture:new a.bK(d),u_texture_icon:new a.bK(d),u_gamma_scale:new a.bJ(d),u_device_pixel_ratio:new a.bJ(d),u_tile_id:new a.bI(d),u_zoom_transition:new a.bJ(d),u_inv_rot_matrix:new a.bG(d),u_merc_center:new a.bH(d),u_camera_forward:new a.bI(d),u_tile_matrix:new a.bG(d),u_up_vector:new a.bI(d),u_ecef_origin:new a.bI(d),u_is_halo:new a.bK(d),u_icon_transition:new a.bJ(d),u_color_adj_mat:new a.bG(d),u_scale_factor:new a.bJ(d)}),background:d=>({u_matrix:new a.bG(d),u_emissive_strength:new a.bJ(d),u_opacity:new a.bJ(d),u_color:new a.cu(d)}),backgroundPattern:d=>({u_matrix:new a.bG(d),u_emissive_strength:new a.bJ(d),u_opacity:new a.bJ(d),u_image:new a.bK(d),u_pattern_tl:new a.bH(d),u_pattern_br:new a.bH(d),u_texsize:new a.bH(d),u_pattern_size:new a.bH(d),u_pixel_coord_upper:new a.bH(d),u_pixel_coord_lower:new a.bH(d),u_pattern_units_to_pixels:new a.bH(d)}),terrainRaster:d=>({u_matrix:new a.bG(d),u_image0:new a.bK(d),u_skirt_height:new a.bJ(d),u_ground_shadow_factor:new a.bI(d)}),skybox:d=>({u_matrix:new a.bG(d),u_sun_direction:new a.bI(d),u_cubemap:new a.bK(d),u_opacity:new a.bJ(d),u_temporal_offset:new a.bJ(d)}),skyboxGradient:d=>({u_matrix:new a.bG(d),u_color_ramp:new a.bK(d),u_center_direction:new a.bI(d),u_radius:new a.bJ(d),u_opacity:new a.bJ(d),u_temporal_offset:new a.bJ(d)}),skyboxCapture:d=>({u_matrix_3f:new a.cv(d),u_sun_direction:new a.bI(d),u_sun_intensity:new a.bJ(d),u_color_tint_r:new a.c7(d),u_color_tint_m:new a.c7(d),u_luminance:new a.bJ(d)}),globeRaster:d=>({u_proj_matrix:new a.bG(d),u_globe_matrix:new a.bG(d),u_normalize_matrix:new a.bG(d),u_merc_matrix:new a.bG(d),u_zoom_transition:new a.bJ(d),u_merc_center:new a.bH(d),u_image0:new a.bK(d),u_grid_matrix:new a.cv(d),u_skirt_height:new a.bJ(d),u_far_z_cutoff:new a.bJ(d),u_frustum_tl:new a.bI(d),u_frustum_tr:new a.bI(d),u_frustum_br:new a.bI(d),u_frustum_bl:new a.bI(d),u_globe_pos:new a.bI(d),u_globe_radius:new a.bJ(d),u_viewport:new a.bH(d)}),globeAtmosphere:d=>({u_frustum_tl:new a.bI(d),u_frustum_tr:new a.bI(d),u_frustum_br:new a.bI(d),u_frustum_bl:new a.bI(d),u_horizon:new a.bJ(d),u_transition:new a.bJ(d),u_fadeout_range:new a.bJ(d),u_color:new a.c7(d),u_high_color:new a.c7(d),u_space_color:new a.c7(d),u_temporal_offset:new a.bJ(d),u_horizon_angle:new a.bJ(d)}),model:d=>({u_matrix:new a.bG(d),u_lighting_matrix:new a.bG(d),u_normal_matrix:new a.bG(d),u_node_matrix:new a.bG(d),u_lightpos:new a.bI(d),u_lightintensity:new a.bJ(d),u_lightcolor:new a.bI(d),u_camera_pos:new a.bI(d),u_opacity:new a.bJ(d),u_baseColorFactor:new a.c7(d),u_emissiveFactor:new a.c7(d),u_metallicFactor:new a.bJ(d),u_roughnessFactor:new a.bJ(d),u_baseTextureIsAlpha:new a.bK(d),u_alphaMask:new a.bK(d),u_alphaCutoff:new a.bJ(d),u_baseColorTexture:new a.bK(d),u_metallicRoughnessTexture:new a.bK(d),u_normalTexture:new a.bK(d),u_occlusionTexture:new a.bK(d),u_emissionTexture:new a.bK(d),u_lutTexture:new a.bK(d),u_color_mix:new a.c7(d),u_aoIntensity:new a.bJ(d),u_emissive_strength:new a.bJ(d),u_occlusionTextureTransform:new a.c7(d)}),modelDepth:d=>({u_matrix:new a.bG(d),u_instance:new a.bG(d),u_node_matrix:new a.bG(d)}),groundShadow:d=>({u_matrix:new a.bG(d),u_ground_shadow_factor:new a.bI(d)}),stars:d=>({u_matrix:new a.bG(d),u_up:new a.bI(d),u_right:new a.bI(d),u_intensity_multiplier:new a.bJ(d)}),snowParticle:d=>({u_modelview:new a.bG(d),u_projection:new a.bG(d),u_time:new a.bJ(d),u_cam_pos:new a.bI(d),u_velocityConeAperture:new a.bJ(d),u_velocity:new a.bJ(d),u_horizontalOscillationRadius:new a.bJ(d),u_horizontalOscillationRate:new a.bJ(d),u_boxSize:new a.bJ(d),u_billboardSize:new a.bJ(d),u_simpleShapeParameters:new a.bH(d),u_screenSize:new a.bH(d),u_thinningCenterPos:new a.bH(d),u_thinningShape:new a.bI(d),u_thinningAffectedRatio:new a.bJ(d),u_thinningParticleOffset:new a.bJ(d),u_particleColor:new a.c7(d),u_direction:new a.bI(d)}),rainParticle:d=>({u_modelview:new a.bG(d),u_projection:new a.bG(d),u_time:new a.bJ(d),u_cam_pos:new a.bI(d),u_texScreen:new a.bK(d),u_velocityConeAperture:new a.bJ(d),u_velocity:new a.bJ(d),u_boxSize:new a.bJ(d),u_rainDropletSize:new a.bH(d),u_distortionStrength:new a.bJ(d),u_rainDirection:new a.bI(d),u_color:new a.c7(d),u_screenSize:new a.bH(d),u_thinningCenterPos:new a.bH(d),u_thinningShape:new a.bI(d),u_thinningAffectedRatio:new a.bJ(d),u_thinningParticleOffset:new a.bJ(d),u_shapeDirectionalPower:new a.bJ(d),u_mode:new a.bJ(d)}),occlusion:d=>({u_matrix:new a.bG(d),u_anchorPos:new a.bI(d),u_screenSizePx:new a.bH(d),u_occluderSizePx:new a.bH(d),u_color:new a.c7(d)})};class os{constructor(n,o,f,_){this.id=os.uniqueIdxCounter,os.uniqueIdxCounter++,this.context=n;const v=n.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||_||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=os.uniqueIdxCounter,os.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}os.uniqueIdxCounter=0;const Yt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cl{constructor(n,o,f,_,v,b){this.length=o.length,this.attributes=f,this.itemSize=o.bytesPerElement,this.dynamicDraw=_,this.instanceCount=b,this.context=n;const P=n.gl;this.buffer=P.createBuffer(),n.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||v||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,o){for(let f=0;f<this.attributes.length;f++){const _=o.attributes[this.attributes[f].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,o,f){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],b=o.attributes[v.name];b!==void 0&&n.vertexAttribPointer(b,v.components,n[Yt[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(n,o,f){for(let _=0;_<this.attributes.length;_++){const v=o.attributes[this.attributes[_].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nc{constructor(n,o,f,_,v){this.context=n,this.width=o,this.height=f;const b=this.framebuffer=n.gl.createFramebuffer();_&&(this.colorAttachment=new kl(n,b)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new tc(n,b):new Bl(n,b))}destroy(){const n=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&n.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&n.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&n.deleteTexture(o)}n.deleteFramebuffer(this.framebuffer)}}class lc{constructor(n,o){this.gl=n,this.clearColor=new $u(this),this.clearDepth=new Xu(this),this.clearStencil=new Yu(this),this.colorMask=new br(this),this.depthMask=new Ca(this),this.stencilMask=new _o(this),this.stencilFunc=new xu(this),this.stencilOp=new Ju(this),this.stencilTest=new Ma(this),this.depthRange=new Pc(this),this.depthTest=new Ku(this),this.depthFunc=new el(this),this.blend=new Qu(this),this.blendFunc=new tl(this),this.blendColor=new Ko(this),this.blendEquation=new bu(this),this.cullFace=new zl(this),this.cullFaceSide=new Lc(this),this.frontFace=new Rc(this),this.program=new Wr(this),this.activeTexture=new Ro(this),this.viewport=new $r(this),this.bindFramebuffer=new nl(this),this.bindRenderbuffer=new fs(this),this.bindTexture=new Gs(this),this.bindVertexBuffer=new wu(this),this.bindElementBuffer=new Es(this),this.bindVertexArrayOES=new Is(this),this.pixelStoreUnpack=new Fl(this),this.pixelStoreUnpackPremultiplyAlpha=new qs(this),this.pixelStoreUnpackFlipY=new ec(this),this.options=o?{...o}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,o,f){return new os(this,n,o,f)}createVertexBuffer(n,o,f,_,v){return new cl(this,n,o,f,_,v)}createRenderbuffer(n,o,f){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,n,o,f),this.bindRenderbuffer.set(null),v}createFramebuffer(n,o,f,_){return new Nc(this,n,o,f,_)}clear({color:n,depth:o,stencil:f,colorMask:_}){const v=this.gl;let b=0;n&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(_||[!0,!0,!0,!0])),o!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),f!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){a.bi(n.blendFunction,An.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let hl;function Ra(d,n,o,f,_,v,b){const P=d.context,D=P.gl,B=d.transform,F=d.getOrCreateProgram("collisionBox"),U=[];let q=0,$=0;for(let fe=0;fe<f.length;fe++){const be=f[fe],Ee=n.getTile(be),we=Ee.getBucket(o);if(!we)continue;const Ie=hu(be,we,B);let Re=Ie;_[0]===0&&_[1]===0||(Re=d.translatePosMatrix(Ie,Ee,_,v));const Be=b?we.textCollisionBox:we.iconCollisionBox,Ne=we.collisionCircleArray;if(Ne.length>0){const De=a.a6.mat4.create(),Je=Re;a.a6.mat4.mul(De,we.placementInvProjMatrix,B.glCoordMatrix),a.a6.mat4.mul(De,De,we.placementViewportMatrix),U.push({circleArray:Ne,circleOffset:$,transform:Je,invTransform:De,projection:we.getProjection()}),q+=Ne.length/4,$=q}Be&&(d.terrain&&d.terrain.setupElevationDraw(Ee,F),F.draw(d,D.LINES,rn.disabled,xn.disabled,d.colorModeForRenderPass(),mn.disabled,sc(Re,B,Ee,we.getProjection()),o.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,B.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!b||!U.length)return;const ee=d.getOrCreateProgram("collisionCircle"),K=new a.cQ;K.resize(4*q),K._trim();let re=0;for(const fe of U)for(let be=0;be<fe.circleArray.length/4;be++){const Ee=4*be,we=fe.circleArray[Ee+0],Ie=fe.circleArray[Ee+1],Re=fe.circleArray[Ee+2],Be=fe.circleArray[Ee+3];K.emplace(re++,we,Ie,Re,Be,0),K.emplace(re++,we,Ie,Re,Be,1),K.emplace(re++,we,Ie,Re,Be,2),K.emplace(re++,we,Ie,Re,Be,3)}(!hl||hl.length<2*q)&&(hl=function(fe){const be=2*fe,Ee=new a.aP;Ee.resize(be),Ee._trim();for(let we=0;we<be;we++){const Ie=6*we;Ee.uint16[Ie+0]=4*we+0,Ee.uint16[Ie+1]=4*we+1,Ee.uint16[Ie+2]=4*we+2,Ee.uint16[Ie+3]=4*we+2,Ee.uint16[Ie+4]=4*we+3,Ee.uint16[Ie+5]=4*we+0}return Ee}(q));const ie=P.createIndexBuffer(hl,!0),ae=P.createVertexBuffer(K,a.cR.members,!0);for(const fe of U){const be={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(de=B).getCameraToCenterDistance(fe.projection),u_viewport_size:[de.width,de.height]};ee.draw(d,D.TRIANGLES,rn.disabled,xn.disabled,d.colorModeForRenderPass(),mn.disabled,be,o.id,ae,ie,a.b2.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,B.zoom)}var de;ae.destroy(),ie.destroy()}const Da=a.a6.mat4.create();function uc(d){const n=d._camera.getWorldToCamera(d.worldSize,1),o=a.a6.mat4.multiply([],n,d.globeMatrix);a.a6.mat4.invert(o,o);const f=[0,0,0],_=[0,1,0,0];return a.a6.vec4.transformMat4(_,_,o),f[0]=_[0],f[1]=_[1],f[2]=_[2],a.a6.vec3.normalize(f,f),f}function Au({width:d,height:n,anchor:o,textOffset:f,textScale:_},v){const{horizontalAlign:b,verticalAlign:P}=a.by(o),D=-(b-.5)*d,B=-(P-.5)*n,F=a.bx(o,f);return new a.P((D/_+F[0])*v,(B/_+F[1])*v)}function cc(d,n,o,f,_,v,b,P,D,B,F){const U=d.text.placedSymbolArray,q=d.text.dynamicLayoutVertexArray,$=d.icon.dynamicLayoutVertexArray,ee={},K=d.getProjection(),re=ys(P,K,v),ie=v.elevation,ae=K.upVectorScale(P.canonical,v.center.lat,v.worldSize).metersToTile;q.clear();for(let de=0;de<U.length;de++){const fe=U.get(de),{tileAnchorX:be,tileAnchorY:Ee,numGlyphs:we}=fe,Ie=fe.hidden||!fe.crossTileID||d.allowVerticalPlacement&&!fe.placedOrientation?null:f[fe.crossTileID];if(Ie){let Re=0,Be=0,Ne=0;if(ie){const rt=ie?ie.getAtTileOffset(P,be,Ee):0,[_t,xt,mt]=K.upVector(P.canonical,be,Ee);Re=rt*_t*ae,Be=rt*xt*ae,Ne=rt*mt*ae}let[De,Je,at,vt]=Vi(fe.projectedAnchorX+Re,fe.projectedAnchorY+Be,fe.projectedAnchorZ+Ne,o?re:b);const St=Wn(v.getCameraToCenterDistance(K),vt);let Pt=_.evaluateSizeForFeature(d.textSizeData,B,fe)*St/a.br;o&&(Pt*=d.tilePixelRatio/D);const He=Au(Ie,Pt);o?({x:De,y:Je,z:at}=K.projectTilePoint(be+He.x,Ee+He.y,P.canonical),[De,Je,at]=Vi(De+Re,Je+Be,at+Ne,b)):(n&&He._rotate(-v.angle),De+=He.x,Je+=He.y,at=0);const gt=d.allowVerticalPlacement&&fe.placedOrientation===a.bl.vertical?Math.PI/2:0;for(let rt=0;rt<we;rt++)a.bo(q,De,Je,at,gt);F&&fe.associatedIconIndex>=0&&(ee[fe.associatedIconIndex]={x:De,y:Je,z:at,angle:gt})}else Bs(we,q)}if(F){$.clear();const de=d.icon.placedSymbolArray;for(let fe=0;fe<de.length;fe++){const be=de.get(fe),{numGlyphs:Ee}=be,we=ee[fe];if(be.hidden||!we)Bs(Ee,$);else{const{x:Ie,y:Re,z:Be,angle:Ne}=we;for(let De=0;De<Ee;De++)a.bo($,Ie,Re,Be,Ne)}}d.icon.dynamicLayoutVertexBuffer.updateData($)}d.text.dynamicLayoutVertexBuffer.updateData(q)}function Oa(d,n,o,f,_,v,b={}){const P=o.paint.get("icon-translate"),D=o.paint.get("text-translate"),B=o.paint.get("icon-translate-anchor"),F=o.paint.get("text-translate-anchor"),U=o.layout.get("icon-rotation-alignment"),q=o.layout.get("text-rotation-alignment"),$=o.layout.get("icon-pitch-alignment"),ee=o.layout.get("text-pitch-alignment"),K=o.layout.get("icon-keep-upright"),re=o.layout.get("text-keep-upright"),ie=o.paint.get("icon-color-saturation"),ae=o.paint.get("icon-color-contrast"),de=o.paint.get("icon-color-brightness-min"),fe=o.paint.get("icon-color-brightness-max"),be=o.layout.get("symbol-elevation-reference")==="sea",Ee=d.context,we=Ee.gl,Ie=d.transform,Re=U==="map",Be=q==="map",Ne=$==="map",De=ee==="map",Je=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let at=!1;const vt=d.depthModeForSublayer(0,rn.ReadOnly),St=[a.am(Ie.center.lng),a.at(Ie.center.lat)],Pt=o.layout.get("text-variable-anchor"),He=Ie.projection.name==="globe",gt=[],rt=[0,-1,0];for(const _t of f){const xt=n.getTile(_t),mt=xt.getBucket(o);if(!mt||mt.projection.name==="mercator"&&He||mt.fullyClipped)continue;const Ot=mt.projection.name==="globe",Kt=Ot?a.a9(Ie.zoom):0,on=ys(_t,mt.getProjection(),Ie),Zt=Ie.calculatePixelsToTileUnitsMatrix(xt),un=Pt&&mt.hasTextData(),Ut=mt.hasIconTextFit()&&un&&mt.hasIconData(),hn=mt.getProjection().createInversionMatrix(Ie,_t.canonical),Cn=Ti=>{Ie.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||d.terrain)&&(Ti.push("DEPTH_D24"),Ti.push("DEPTH_OCCLUSION"))},Hn=()=>{const Ti=Re&&o.layout.get("symbol-placement")!=="point",mi=[];Cn(mi);const qi=Ti||Ut,Br=o.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&Ne&&mi.push("PITCH_WITH_MAP_TERRAIN"),Ot&&(mi.push("PROJECTION_GLOBE_VIEW"),qi&&mi.push("PROJECTED_POS_ON_VIEWPORT")),Br>0&&mi.push("ICON_TRANSITION"),mt.icon.zOffsetVertexBuffer&&mi.push("Z_OFFSET"),ie===0&&ae===0&&de===0&&fe===1||mi.push("COLOR_ADJUSTMENT"),mt.sdfIcons&&mi.push("RENDER_SDF");const Bo=mt.icon.programConfigurations.get(o.id),aa=d.getOrCreateProgram("symbol",{config:Bo,defines:mi}),Jr=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Kn=mt.iconSizeData,$n=a.bk(Kn,Ie.zoom),fi=Ne||Ie.pitch!==0,Ni=Gn(on,xt.tileID.canonical,Ne,Re,Ie,mt.getProjection(),Zt),ur=is(on,xt.tileID.canonical,Ne,Re,Ie,mt.getProjection(),Zt),ji=d.translatePosMatrix(ur,xt,P,B,!0),as=d.translatePosMatrix(on,xt,P,B),xl=qi?Da:Ni,wo=Re&&!Ne&&!Ti;let Eo=rt;!He&&!Ie.mercatorFromTransition||Re||(Eo=uc(Ie));const la=Ot?Eo:rt,Ba=o.getColorAdjustmentMatrix(ie,ae,de,fe),Io=hi(Kn.kind,$n,wo,Ne,d,as,xl,ji,be,!1,Jr,[0,0],!0,_t,Kt,St,hn,la,mt.getProjection(),Ba,Br),Ql=xt.imageAtlasTexture?xt.imageAtlasTexture:null,ua=o.layout.get("icon-size").constantOr(0)!==1||mt.iconsNeedLinear,_i=mt.sdfIcons||d.options.rotating||d.options.zooming||ua||fi?we.LINEAR:we.NEAREST,Gc=mt.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,xd=d.terrain&&Ne&&Ti?a.a6.mat4.invert(a.a6.mat4.create(),Ni):Da;if(Ti&&mt.icon){const qc=Ie.elevation,bd=qc?qc.getAtTileOffsetFunc(_t,Ie.center.lat,Ie.worldSize,mt.getProjection()):null,_h=cn(on,xt.tileID.canonical,Ne,Re,Ie,mt.getProjection(),Zt);Ll(mt,on,d,!1,_h,ur,Ne,K,bd,_t)}return{program:aa,buffers:mt.icon,uniformValues:Io,atlasTexture:Ql,atlasTextureIcon:null,atlasInterpolation:_i,atlasInterpolationIcon:null,isSDF:mt.sdfIcons,hasHalo:Gc,tile:xt,labelPlaneMatrixInv:xd}},Di=()=>{const Ti=Be&&o.layout.get("symbol-placement")!=="point",mi=[],qi=Ti||Pt||Ut;d.terrainRenderModeElevated()&&De&&mi.push("PITCH_WITH_MAP_TERRAIN"),Ot&&(mi.push("PROJECTION_GLOBE_VIEW"),qi&&mi.push("PROJECTED_POS_ON_VIEWPORT")),mt.text.zOffsetVertexBuffer&&mi.push("Z_OFFSET"),mt.iconsInText&&mi.push("RENDER_TEXT_AND_SYMBOL"),mi.push("RENDER_SDF"),Cn(mi);const Br=mt.text.programConfigurations.get(o.id),Bo=d.getOrCreateProgram("symbol",{config:Br,defines:mi});let aa,Jr=[0,0],Kn=null;const $n=mt.textSizeData;mt.iconsInText&&(Jr=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],Kn=xt.imageAtlasTexture?xt.imageAtlasTexture:null,aa=De||Ie.pitch!==0||d.options.rotating||d.options.zooming||$n.kind==="composite"||$n.kind==="camera"?we.LINEAR:we.NEAREST);const fi=xt.glyphAtlasTexture?xt.glyphAtlasTexture.size:[0,0],Ni=o.layout.get("text-size-scale-range"),ur=a.ap(d.scaleFactor,Ni[0],Ni[1]),ji=a.bk($n,Ie.zoom,ur),as=Gn(on,xt.tileID.canonical,De,Be,Ie,mt.getProjection(),Zt),xl=is(on,xt.tileID.canonical,De,Be,Ie,mt.getProjection(),Zt),wo=d.translatePosMatrix(xl,xt,D,F,!0),Eo=d.translatePosMatrix(on,xt,D,F),la=qi?Da:as,Ba=Be&&!De&&!Ti;let Io=rt;!He&&!Ie.mercatorFromTransition||Be||(Io=uc(Ie));const Ql=hi($n.kind,ji,Ba,De,d,Eo,la,wo,be,!0,fi,Jr,!0,_t,Kt,St,hn,Ot?Io:rt,mt.getProjection(),null,null,ur),ua=xt.glyphAtlasTexture?xt.glyphAtlasTexture:null,_i=we.LINEAR,Gc=o.paint.get("text-halo-width").constantOr(1)!==0,xd=d.terrain&&De&&Ti?a.a6.mat4.invert(a.a6.mat4.create(),as):Da;if(Ti&&mt.text){const qc=Ie.elevation,bd=qc?qc.getAtTileOffsetFunc(_t,Ie.center.lat,Ie.worldSize,mt.getProjection()):null,_h=cn(on,xt.tileID.canonical,De,Be,Ie,mt.getProjection(),Zt);Ll(mt,on,d,!0,_h,xl,De,re,bd,_t)}return{program:Bo,buffers:mt.text,uniformValues:Ql,atlasTexture:ua,atlasTextureIcon:Kn,atlasInterpolation:_i,atlasInterpolationIcon:aa,isSDF:!0,hasHalo:Gc,tile:xt,labelPlaneMatrixInv:xd}},ti=mt.icon.segments.get().length,Bi=mt.text.segments.get().length,di=ti&&!b.onlyText?Hn():null,Oi=Bi&&!b.onlyIcons?Di():null,kn=o.paint.get("icon-opacity").constantOr(1),Pi=o.paint.get("text-opacity").constantOr(1);if(Je&&mt.canOverlap){at=!0;const Ti=kn&&!b.onlyText?mt.icon.segments.get():[],mi=Pi&&!b.onlyIcons?mt.text.segments.get():[];for(const qi of Ti)gt.push({segments:new a.b2([qi]),sortKey:qi.sortKey,state:di});for(const qi of mi)gt.push({segments:new a.b2([qi]),sortKey:qi.sortKey,state:Oi})}else b.onlyText||gt.push({segments:kn?mt.icon.segments:new a.b2([]),sortKey:0,state:di}),b.onlyIcons||gt.push({segments:Pi?mt.text.segments:new a.b2([]),sortKey:0,state:Oi})}at&&gt.sort((_t,xt)=>_t.sortKey-xt.sortKey);for(const _t of gt){const xt=_t.state;if(xt)if(d.terrain?d.terrain.setupElevationDraw(xt.tile,xt.program,{useDepthForOcclusion:Ie.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:xt.labelPlaneMatrixInv}):d.setupDepthForOcclusion(Ie.depthOcclusionForSymbolsAndCircles,xt.program),Ee.activeTexture.set(we.TEXTURE0),xt.atlasTexture&&xt.atlasTexture.bind(xt.atlasInterpolation,we.CLAMP_TO_EDGE,!0),xt.atlasTextureIcon&&(Ee.activeTexture.set(we.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,we.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,xt.program),xt.hasHalo){const mt=xt.uniformValues;mt.u_is_halo=1,Ri(xt.buffers,_t.segments,o,d,xt.program,vt,_,v,mt,2),mt.u_is_halo=0}else{if(xt.isSDF){const mt=xt.uniformValues;xt.hasHalo&&(mt.u_is_halo=1,Ri(xt.buffers,_t.segments,o,d,xt.program,vt,_,v,mt,1)),mt.u_is_halo=0}Ri(xt.buffers,_t.segments,o,d,xt.program,vt,_,v,xt.uniformValues,1)}}}function Ri(d,n,o,f,_,v,b,P,D,B){const F=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,v,b,P,mn.disabled,D,o.id,d.layoutVertexBuffer,d.indexBuffer,n,o.paint,f.transform.zoom,d.programConfigurations.get(o.id),F,B)}function wi(d,n,o,f,_,v,b){const P=d.context.gl,D=o.paint.get("fill-pattern"),B=o.is3D(),F=B?d.stencilModeFor3D():xn.disabled,U=D&&D.constantOr(1);let q,$,ee,K,re;b?($=U&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=P.LINES):($=U?"fillPattern":"fill",q=P.TRIANGLES);for(const ie of f){const ae=n.getTile(ie);if(U&&!ae.patternsLoaded())continue;const de=ae.getBucket(o);if(!de)continue;d.prepareDrawTile();const fe=de.programConfigurations.get(o.id),be=d.isTileAffectedByFog(ie),Ee=d.getOrCreateProgram($,{config:fe,overrideFog:be});U&&(d.context.activeTexture.set(P.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),fe.updatePaintBuffers());const we=D.constantOr(null);if(we&&ae.imageAtlas){const Be=ae.imageAtlas.patternPositions[we.toString()];Be&&fe.setConstantPatternPositions(Be)}const Ie=d.translatePosMatrix(ie.projMatrix,ae,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Re=o.paint.get("fill-emissive-strength");if(b){K=de.indexBuffer2,re=de.segments2;const Be=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];ee=$==="fillOutlinePattern"&&U?rl(Ie,Re,d,ae,Be):gs(Ie,Re,Be)}else K=de.indexBuffer,re=de.segments,ee=U?ta(Ie,Re,d,ae):Cu(Ie,Re);d.uploadCommonUniforms(d.context,Ee,ie.toUnwrapped()),Ee.draw(d,q,_,B?F:d.stencilModeForClipping(ie),v,mn.disabled,ee,o.id,de.layoutVertexBuffer,K,re,o.paint,d.transform.zoom,fe,void 0)}}function ar(d,n,o,f,_,v,b,P){o.resetLayerRenderingStats(d);const D=d.context,B=D.gl,F=d.transform,U=o.paint.get("fill-extrusion-pattern"),q=U.constantOr(1),$=o.paint.get("fill-extrusion-opacity"),ee=d.style.enable3dLights(),K=o.paint.get(ee&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),re=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],ie=o.layout.get("fill-extrusion-edge-radius"),ae=ie>0&&!o.paint.get("fill-extrusion-rounded-roof"),de=ae?0:ie,fe=F.projection.name==="globe"?a.c_():0,be=F.projection.name==="globe",Ee=be?a.a9(F.zoom):0,we=[a.am(F.center.lng),a.at(F.center.lat)],Ie=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),Re=o.paint.get("fill-extrusion-flood-light-intensity"),Be=o.paint.get("fill-extrusion-vertical-scale"),Ne=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,De=o.paint.get("fill-extrusion-height-alignment"),Je=o.paint.get("fill-extrusion-base-alignment"),at=Cr(d,o.paint.get("fill-extrusion-cutoff-fade-range")),vt=[];let St;be&&vt.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&vt.push("FAUX_AO"),ae&&vt.push("ZERO_ROOF_RADIUS"),P&&vt.push("HAS_CENTROID"),Re>0&&vt.push("FLOOD_LIGHT"),at.shouldRenderCutoff&&vt.push("RENDER_CUTOFF"),Ne&&vt.push("RENDER_WALL_MODE");const Pt=d.renderPass==="shadow",He=d.shadowRenderer,gt=Pt&&!!He;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let rt=[0,0,0];if(He){const mt=d.style.directionalLight,Ot=d.style.ambientLight;mt&&Ot&&(rt=or(d.style,mt,Ot)),Pt||(vt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),He.useNormalOffset&&vt.push("NORMAL_OFFSET")),St=vt.concat(["SHADOWS_SINGLE_CASCADE"])}const _t=gt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",xt=o.getLayerRenderingStats();for(const mt of f){const Ot=n.getTile(mt),Kt=Ot.getBucket(o);if(!Kt||Kt.projection.name!==F.projection.name)continue;let on=!1;He&&(on=He.getMaxCascadeForTile(mt.toUnwrapped())===0);const Zt=d.isTileAffectedByFog(mt),un=Kt.programConfigurations.get(o.id),Ut=d.getOrCreateProgram(_t,{config:un,defines:on?St:vt,overrideFog:Zt});if(d.terrain&&d.terrain.setupElevationDraw(Ot,Ut,{useMeterToDem:!0}),!Kt.centroidVertexBuffer){const di=Ut.attributes.a_centroid_pos;di!==void 0&&B.vertexAttrib2f(di,0,0)}!Pt&&He&&He.setupShadows(Ot.tileID.toUnwrapped(),Ut,"vector-tile",Ot.tileID.overscaledZ),q&&(d.context.activeTexture.set(B.TEXTURE0),Ot.imageAtlasTexture&&Ot.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),un.updatePaintBuffers());const hn=U.constantOr(null);if(hn&&Ot.imageAtlas){const di=Ot.imageAtlas.patternPositions[hn.toString()];di&&un.setConstantPatternPositions(di)}const Cn=o.paint.get("fill-extrusion-vertical-gradient"),Hn=1/Kt.tileToMeter;let Di;if(Pt&&He){if(jl(Ot.tileID,Kt,d))continue;const di=He.calculateShadowPassMatrixFromTile(Ot.tileID.toUnwrapped());Di=ci(di,de,Hn,Be,De,Je)}else{const di=d.translatePosMatrix(mt.expandedProjMatrix,Ot,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Oi=F.projection.createInversionMatrix(F,mt.canonical);Di=q?Ss(di,d,Cn,$,re,de,Hn,mt,Ot,fe,De,Je,Ee,we,Oi,Ie,Be):Su(di,d,Cn,$,re,de,Hn,mt,fe,De,Je,Ee,we,Oi,Ie,Be,Re,rt)}d.uploadCommonUniforms(D,Ut,mt.toUnwrapped(),null,at);let ti=Kt.segments;if(F.projection.name==="mercator"&&!Pt&&(ti=Kt.getVisibleSegments(Ot.tileID,d.terrain,d.transform.getFrustum(0)),!ti.get().length))continue;if(xt)if(Pt)for(const di of ti.get())xt.numRenderedVerticesInShadowPass+=di.primitiveLength;else for(const di of ti.get())xt.numRenderedVerticesInTransparentPass+=di.primitiveLength;const Bi=[];(d.terrain||P)&&Bi.push(Kt.centroidVertexBuffer),be&&Bi.push(Kt.layoutVertexExtBuffer),Ne&&Bi.push(Kt.wallVertexBuffer),Ut.draw(d,D.gl.TRIANGLES,_,v,b,mn.backCCW,Di,o.id,Kt.layoutVertexBuffer,Kt.indexBuffer,ti,o.paint,d.transform.zoom,un,Bi)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function pi(d,n,o,f,_,v,b,P,D,B,F,U,q,$,ee,K,re,ie,ae){const de=d.context,fe=de.gl,be=d.transform,Ee=d.transform.zoom,we=[],Ie=Cr(d,o.paint.get("fill-extrusion-cutoff-fade-range"));B==="clear"?(we.push("CLEAR_SUBPASS"),ae&&(we.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(fe.TEXTURE0),ae.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):B==="sdf"&&we.push("SDF_SUBPASS"),re&&we.push("HAS_CENTROID"),Ie.shouldRenderCutoff&&we.push("RENDER_CUTOFF");const Re=o.layout.get("fill-extrusion-edge-radius"),Be=(Ne,De,Je,at,vt)=>{const St=De.programConfigurations.get(o.id),Pt=d.isTileAffectedByFog(Ne),He=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:St,defines:we,overrideFog:Pt}),gt=((_t,xt,mt,Ot,Kt,on,Zt,un,Ut,hn,Cn)=>({u_matrix:xt,u_opacity:mt,u_ao_pass:Ot?1:0,u_meter_to_tile:Kt,u_ao:on,u_flood_light_intensity:Zt,u_flood_light_color:un,u_attenuation:Ut,u_edge_radius:hn,u_fb:0,u_fb_size:Cn,u_dynamic_offset:1}))(0,at,F,D,vt,[U,q*vt],$,ee,K,Ee>=17?0:Re*vt,ae?ae.size[0]:0),rt=[];re&&rt.push(De.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(de,He,Ne.toUnwrapped(),null,Ie),He.draw(d,de.gl.TRIANGLES,_,v,b,P,gt,o.id,De.vertexBuffer,De.indexBuffer,Je,o.paint,Ee,St,rt)};for(const Ne of f){const De=n.getTile(Ne),Je=De.getBucket(o);if(!Je||Je.projection.name!==be.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const at=Je.groundEffect,vt=1/Je.tileToMeter;{const St=d.translatePosMatrix(Ne.projMatrix,De,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Pt=at.getDefaultSegment();Be(Ne,at,Pt,St,vt)}if(ie)for(let St=0;St<4;St++){const Pt=a.c$[St](Ne),He=n.getTile(Pt);if(!He)continue;const gt=He.getBucket(o);if(!gt||gt.projection.name!==be.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;const rt=gt.groundEffect;let _t,xt;St===0?(_t=[-a.ab,0,0],xt=1):St===1?(_t=[a.ab,0,0],xt=0):St===2?(_t=[0,-a.ab,0],xt=3):(_t=[0,a.ab,0],xt=2);const mt=rt.regionSegments[xt];if(!mt)continue;const Ot=new Float32Array(16);a.a6.mat4.translate(Ot,Ne.projMatrix,_t),Be(Ne,rt,mt,d.translatePosMatrix(Ot,De,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),vt)}}}function Pu(d,n,o,f,_,v,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const P=v?v.findDEMTileFor(o):null;if(!(P&&P.dem||b))return;const D=ie=>new a.P(Math.ceil((ie+a.d2)*a.d3),0),B=ie=>{const ae=n.getSource().minzoom,de=be=>{const Ee=n.getTileByID(be);if(Ee&&Ee.hasData())return Ee.getBucket(_)},fe=[0,-1,1];for(const be of fe){if(ie.overscaledZ+be<ae)continue;const Ee=de(ie.calculateScaledKey(ie.overscaledZ+be));if(Ee)return Ee}},F=[0,0,0],U=(ie,ae)=>(F[0]=Math.min(ie.min.y,ae.min.y),F[1]=Math.max(ie.max.y,ae.max.y),F[2]=a.ab-ae.min.x>ie.max.x?ae.min.x-a.ab:ie.max.x,F),q=(ie,ae)=>(F[0]=Math.min(ie.min.x,ae.min.x),F[1]=Math.max(ie.max.x,ae.max.x),F[2]=a.ab-ae.min.y>ie.max.y?ae.min.y-a.ab:ie.max.y,F),$=[(ie,ae)=>U(ie,ae),(ie,ae)=>U(ae,ie),(ie,ae)=>q(ie,ae),(ie,ae)=>q(ae,ie)],ee=(ie,ae,de,fe,be,Ee,we)=>{if(!v)return 0;const Ie=[[Ee?de:ie,Ee?ie:de,0],[Ee?de:ae,Ee?ae:de,0]],Re=we<0?a.ab+we:we,Be=[Ee?Re:(ie+ae)/2,Ee?(ie+ae)/2:Re,0];return de===0&&we<0||de!==0&&we>0?v.getForTilePoints(be,[Be],!0,fe):Ie.push(Be),v.getForTilePoints(o,Ie,!0,P),Math.max(Ie[0][2],Ie[1][2],Be[2])/v.exaggeration()};for(let ie=0;ie<4;ie++){const ae=f.borderFeatureIndices[ie];if(ae.length===0)continue;const de=a.c$[ie](o),fe=B(de);if(!(fe&&fe instanceof a.d0)||f.borderDoneWithNeighborZ[ie]===fe.canonical.z)continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const be=v?v.findDEMTileFor(de):null;if(!(be&&be.dem||b))continue;const Ee=(ie<2?1:5)-ie,we=fe.borderDoneWithNeighborZ[Ee]!==f.canonical.z,Ie=fe.borderFeatureIndices[Ee];let Re=0;if(f.canonical.z!==fe.canonical.z){for(const Be of ae)f.showCentroid(f.featuresOnBorder[Be]);if(we)for(const Be of Ie)fe.showCentroid(fe.featuresOnBorder[Be]);f.borderDoneWithNeighborZ[ie]=fe.canonical.z,fe.borderDoneWithNeighborZ[Ee]=f.canonical.z}for(const Be of ae){const Ne=f.featuresOnBorder[Be],De=f.centroidData[Ne.centroidDataIndex],Je=Ne.borders[ie];let at;for(;Re<Ie.length;){at=fe.featuresOnBorder[Ie[Re]];const vt=at.borders[Ee];if(vt[1]>Je[0]+3||vt[0]>Je[0]-3)break;fe.showCentroid(at),Re++}if(at&&Re<Ie.length){const vt=Re;let St=0;for(;!(at.borders[Ee][0]>Je[1]-3)&&(St++,++Re!==Ie.length);)at=fe.featuresOnBorder[Ie[Re]];at=fe.featuresOnBorder[Ie[vt]];let Pt=!1;if(St>=1){const rt=at.borders[Ee];Math.abs(Je[0]-rt[0])<3&&Math.abs(Je[1]-rt[1])<3&&(St=1,Pt=!0,Re=vt+1)}else if(St===0){f.showCentroid(Ne);continue}const He=fe.centroidData[at.centroidDataIndex];b&&Pt&&(((K=De).flags|(re=He).flags)&a.d1?(K.flags|=a.d1,re.flags|=a.d1):(K.flags&=~a.d1,re.flags&=~a.d1));const gt=Ne.intersectsCount()>1||at.intersectsCount()>1;if(St>1)Re=vt,De.centroidXY=He.centroidXY=new a.P(0,0);else if(be&&be.dem&&!gt){const rt=$[ie](De,He),_t=ie%2?a.ab-1:0,xt=ee(rt[0],Math.min(a.ab-1,rt[1]),_t,be,de,ie<2,rt[2]);De.centroidXY=He.centroidXY=D(xt)}else gt?De.centroidXY=He.centroidXY=new a.P(0,0):(De.centroidXY=f.encodeBorderCentroid(Ne),He.centroidXY=fe.encodeBorderCentroid(at));f.writeCentroidToBuffer(De),fe.writeCentroidToBuffer(He)}else f.showCentroid(Ne)}f.borderDoneWithNeighborZ[ie]=fe.canonical.z,fe.borderDoneWithNeighborZ[Ee]=f.canonical.z}var K,re;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const hc=[1,0,0],Lu=[0,1,0],dl=[0,0,1];function jl(d,n,o){const f=o.transform,_=o.shadowRenderer;if(!_)return!0;const v=d.toUnwrapped(),b=f.tileSize*_._cascades[o.currentShadowCascade].scale;let P=n.maxHeight;if(f.elevation){const K=f.elevation.getMinMaxForTile(d);K&&(P+=K.max)}const D=[..._.shadowDirection];D[2]=-D[2];const B=_.computeSimplifiedTileShadowVolume(v,P,b,D);if(!B)return!1;const F=[hc,Lu,dl,D,[D[0],0,D[2]],[0,D[1],D[2]]],U=f.projection.name==="globe",q=f.scaleZoom(b),$=a.bO.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,q,!U),ee=_.getCurrentCascadeFrustum();return $.intersectsPrecise(B.vertices,B.planes,F)===0||ee.intersectsPrecise(B.vertices,B.planes,F)===0}function nr(d){return[d[0]*a.d4,d[1]*a.d4,d[2]*a.d4,0]}function Ui(d,n,o,f,_,v,b,P,D){const B=f.getSource(),F=o.globeSharedBuffers;if(!F)return;let U,q,$;if(n&&(U=f.getTile(n)),B instanceof a.aD?(q=B.texture,$=a.cD(0,0,o.transform)):U&&n&&(q=U.texture,$=a.cD(n.canonical.z,n.canonical.x,o.transform)),!q||!$)return;d||($=a.a6.mat4.scale(a.a6.mat4.create(),$,[1,-1,1]));const ee=o.context,K=ee.gl,re=_.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR,ie=o.colorModeForDrapableLayerRenderPass(v),ae=b.defines;ae.push("GLOBE_POLES");const de=new rn(K.LEQUAL,rn.ReadWrite,o.depthRangeFor3D),fe=Float32Array.from(o.transform.expandedFarZProjMatrix),be=Float32Array.from(a.b6(a.cC(new a.bQ(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),ee.activeTexture.set(K.TEXTURE0),q.bind(re,K.CLAMP_TO_EDGE),ee.activeTexture.set(K.TEXTURE1),q.bind(re,K.CLAMP_TO_EDGE),q.useMipmap&&ee.extTextureFilterAnisotropic&&o.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const[Ee,we,Ie,Re]=n?F.getPoleBuffers(n.canonical.z,!1):F.getPoleBuffers(0,!0),Be=_.paint.get("raster-elevation");let Ne;d?(Ne=Ee,o.renderDefaultNorthPole=Be!==0):(Ne=we,o.renderDefaultSouthPole=Be!==0);const De=nr(b.mix),Je=((vt,St,Pt,He,gt,rt,_t,xt,mt,Ot,Kt,on,Zt)=>La(vt,St,Pt,new Float32Array(16),new Float32Array(9),[0,0],He,[0,0],[0,0,0,0],1,{opacity:1,mix:0},rt,[0,0],xt,2,Ot,Kt,on,1,0,Zt))(fe,be,$,a.a9(o.transform.zoom),0,_,0,Be,0,De,b.offset,b.range,v),at=o.getOrCreateProgram("raster",{defines:ae});o.uploadCommonUniforms(ee,at,null),at.draw(o,K.TRIANGLES,de,D,ie,P,Je,_.id,Ne,Ie,Re)}function Hl(d){const n=d._nearZ,o=d.projection.farthestPixelDistance(d),f=o-n,_=.2*d.height,v=n+_;return[n,o,(v-_-n)/f,(v-n)/f]}function Ru(d,n,o,f){if(d)return n instanceof Dr&&d instanceof qr?n.getTextureDescriptor(d,o,!0):{texture:d.texture,mix:nr(f.mix),offset:f.offset,buffer:0,tileSize:1}}var dc=a.d5([{name:"a_index",type:"Int16",components:1}]);class fl{constructor(n,o,f,_){const v={width:f[0],height:f[1],data:null},b=n.gl;this.targetColorTexture=new a.T(n,v,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(n,v,b.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(o,_),this.lastInvalidatedAt=0}updateParticleTexture(n,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,_=o.width*o.height;this.particleTexture0=new a.T(this.context,o,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,o,f.RGBA8,{premultiply:!1,useMipmap:!1});const v=new a.d6;v.reserve(_);for(let b=0;b<_;b++)v.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(v,dc.members,!0),this.particleSegment=a.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=a.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Du(d,n,o){if(!d)return null;const f=n.getTextureDescriptor(d,o,!0);if(!f)return null;let{texture:_,mix:v,offset:b,tileSize:P,buffer:D,format:B}=f;if(!_||!B)return null;let F=!1;return B==="uint32"&&(F=!0,v[3]=0,v=yo(a.d7,v,[0,o.paint.get("raster-particle-max-speed")]),b=Oo(a.d7,b,[0,o.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[D/(P+2*D),P/(P+2*D)],tileSize:P,scalarData:F,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[B]]}}function zc(d){const n=d._nearZ,o=d.projection.farthestPixelDistance(d),f=o-n,_=.2*d.height,v=n+_;return[n,o,(v-_-n)/f,(v-n)/f]}const vo=new a.bA(1,0,0,1),Na=new a.bA(0,1,0,1),It=new a.bA(0,0,1,1),Ht=new a.bA(1,0,1,1),zo=new a.bA(0,1,1,1);function Ei(d,n,o,f,_,v,b){const P=d.context,D=d.transform,B=P.gl,F=D.projection.name==="globe",U=F?["PROJECTION_GLOBE_VIEW"]:[];let q=a.a6.mat4.clone(o.projMatrix);if(F&&a.a9(D.zoom)>0){const De=a.b5(o.canonical,D),Je=a.d8(De);q=a.a6.mat4.multiply(new Float32Array(16),D.globeMatrix,Je),a.a6.mat4.multiply(q,D.projMatrix,q)}const $=a.a6.mat4.create();$[12]+=2*_/(a.q.devicePixelRatio*D.width),$[13]+=2*v/(a.q.devicePixelRatio*D.height),a.a6.mat4.multiply(q,$,q);const ee=d.getOrCreateProgram("debug",{defines:U}),K=n.getTileByID(o.key);d.terrain&&d.terrain.setupElevationDraw(K,ee);const re=rn.disabled,ie=xn.disabled,ae=d.colorModeForRenderPass(),de="$debug";P.activeTexture.set(B.TEXTURE0),d.emptyTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),F?K._makeGlobeTileDebugBuffers(d.context,D):K._makeDebugTileBoundsBuffers(d.context,D.projection);const fe=K._tileDebugBuffer||d.debugBuffer,be=K._tileDebugIndexBuffer||d.debugIndexBuffer,Ee=K._tileDebugSegments||d.debugSegments;if(ee.draw(d,B.LINE_STRIP,re,ie,ae,mn.disabled,Js(q,f),de,fe,be,Ee,null,null,null,[K._globeTileDebugBorderBuffer]),b){const De=K.latestRawTileData,Je=Math.floor((De&&De.byteLength||0)/1024);let at=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(at+=` => ${o.overscaledZ}`),at+=` ${K.state}`,at+=` ${Je}kb`,function(vt,St){vt.initDebugOverlayCanvas();const Pt=vt.debugOverlayCanvas,He=vt.context.gl,gt=vt.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,Pt.width,Pt.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(St,5,5),gt.strokeText(St,5,5),vt.debugOverlayTexture.update(Pt),vt.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(d,at)}const we=n.getTile(o).tileSize,Ie=512/Math.min(we,512)*(o.overscaledZ/D.zoom)*.5,Re=K._tileDebugTextBuffer||d.debugBuffer,Be=K._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ne=K._tileDebugTextSegments||d.debugSegments;ee.draw(d,B.TRIANGLES,re,ie,An.alphaBlended,mn.disabled,Js(q,a.bA.transparent,Ie),de,Re,Be,Ne,null,null,null,[K._globeTileDebugTextBuffer])}function $e(d,n,o,f){ra(d,0,n+o/2,d.transform.width,o,f)}function Zl(d,n,o,f){ra(d,n-o/2,0,o,d.transform.height,f)}function ra(d,n,o,f,_,v){const b=d.context,P=b.gl;P.enable(P.SCISSOR_TEST),P.scissor(n*a.q.devicePixelRatio,o*a.q.devicePixelRatio,f*a.q.devicePixelRatio,_*a.q.devicePixelRatio),b.clear({color:v}),P.disable(P.SCISSOR_TEST)}const xo=a.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Fo}=xo;function bo(d,n,o,f){d.emplaceBack(n,o,f)}class Ks{constructor(n){this.vertexArray=new a.d9,this.indices=new a.aP,bo(this.vertexArray,-1,-1,1),bo(this.vertexArray,1,-1,1),bo(this.vertexArray,-1,1,1),bo(this.vertexArray,1,1,1),bo(this.vertexArray,-1,-1,-1),bo(this.vertexArray,1,-1,-1),bo(this.vertexArray,-1,1,-1),bo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Fo),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=a.b2.simpleSegment(0,0,36,12)}}function ko(d,n,o,f,_,v){const b=d.context.gl,P=n.paint.get("sky-atmosphere-color"),D=n.paint.get("sky-atmosphere-halo-color"),B=n.paint.get("sky-atmosphere-sun-intensity"),F=((U,q,$,ee,K)=>({u_matrix_3f:U,u_sun_direction:q,u_sun_intensity:$,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(a.a6.mat3.fromMat4(a.a6.mat3.create(),f),_,B,P,D);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,n.skyboxTexture,0),o.draw(d,b.TRIANGLES,rn.disabled,xn.disabled,An.unblended,mn.frontCW,F,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const dd=a.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fd{constructor(n){const o=new a.da;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const f=new a.aP;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(o,dd.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=a.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Qs=a.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class eo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class pl{constructor(n){this.colorModeAlphaBlendedWriteRGB=new An([1,xs,1,xs],a.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new An([1,0,1,0],a.bA.transparent,[!1,!1,!1,!0]),this.params=new eo,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const o=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new fd(o);const f=this.params.sizeRange,_=this.params.intensityRange,v=function(F){const U=a.dd(30),q=[];for(let $=0;$<F;++$){const ee=2*Math.PI*U(),K=Math.acos(1-2*U())-.5*Math.PI;q.push(a.a6.vec3.fromValues(Math.cos(K)*Math.cos(ee),Math.cos(K)*Math.sin(ee),Math.sin(K)))}return q}(this.params.starsCount),b=a.dd(300),P=new a.db,D=new a.aP;let B=0;for(let F=0;F<v.length;++F){const U=a.a6.vec3.scale([],v[F],200),q=Math.max(0,1+.01*f*(1*b()-.5)),$=Math.max(0,1+.01*_*(1*b()-.5));P.emplaceBack(U[0],U[1],U[2],-1,-1,q,$),P.emplaceBack(U[0],U[1],U[2],1,-1,q,$),P.emplaceBack(U[0],U[1],U[2],1,1,q,$),P.emplaceBack(U[0],U[1],U[2],-1,1,q,$),D.emplaceBack(B+0,B+1,B+2),D.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=o.createVertexBuffer(P,Qs.members),this.starsIdx=o.createIndexBuffer(D),this.starsSegments=a.b2.simpleSegment(0,0,P.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,o){const f=n.context,_=f.gl,v=n.transform,b=new rn(_.LEQUAL,rn.ReadOnly,[0,1]),P=a.a9(v.zoom),D=n.style.getLut(o.scope),B=o.properties.get("color").toRenderColor(D).toArray01(),F=o.properties.get("high-color").toRenderColor(D).toArray01(),U=o.properties.get("space-color").toRenderColor(D).toArray01PremultipliedAlpha(),q=5e-4,$=a.dc(o.properties.get("horizon-blend"),0,1,q,.25),ee=a.cx(n,f,v)&&$===q?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,K=n.frameCounter/1e3%1,re=a.a6.vec3.length(v.globeCenterInViewSpace),ie=Math.sqrt(Math.pow(re,2)-Math.pow(ee,2)),ae=Math.acos(ie/re),de=fe=>{const be=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&be.push("ALPHA_PASS");const Ee=n.getOrCreateProgram("globeAtmosphere",{defines:be}),we=((Re,Be,Ne,De,Je,at,vt,St,Pt,He,gt,rt)=>({u_frustum_tl:Re,u_frustum_tr:Be,u_frustum_br:Ne,u_frustum_bl:De,u_horizon:Je,u_transition:at,u_fadeout_range:vt,u_color:St,u_high_color:Pt,u_space_color:He,u_temporal_offset:gt,u_horizon_angle:rt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,P,$,B,F,U,K,ae);n.uploadCommonUniforms(f,Ee);const Ie=this.atmosphereBuffer;Ie&&Ee.draw(n,_.TRIANGLES,b,xn.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mn.backCW,we,fe?"atmosphere_glow_alpha":"atmosphere_glow",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)};de(!1),de(!0)}drawStars(n,o){const f=a.ap(o.properties.get("star-intensity"),0,1);if(f===0)return;const _=n.context,v=_.gl,b=n.transform,P=n.getOrCreateProgram("stars"),D=a.a6.quat.identity([]);a.a6.quat.rotateX(D,D,-b._pitch),a.a6.quat.rotateZ(D,D,-b.angle),a.a6.quat.rotateX(D,D,a.bC(b._center.lat)),a.a6.quat.rotateY(D,D,-a.bC(b._center.lng));const B=a.a6.mat4.fromQuat(new Float32Array(16),D),F=a.a6.mat4.multiply([],b.starsProjMatrix,B),U=a.a6.mat3.fromMat4([],B),q=a.a6.mat3.invert([],U),$=[0,1,0];a.a6.vec3.transformMat3($,$,q),a.a6.vec3.scale($,$,this.params.sizeMultiplier);const ee=[1,0,0];a.a6.vec3.transformMat3(ee,ee,q),a.a6.vec3.scale(ee,ee,this.params.sizeMultiplier);const K=(re=$,ie=ee,ae=f,{u_matrix:Float32Array.from(F),u_up:re,u_right:ie,u_intensity_multiplier:ae});var re,ie,ae;n.uploadCommonUniforms(_,P),this.starsVx&&this.starsIdx&&P.draw(n,v.TRIANGLES,rn.disabled,xn.disabled,this.colorModeAlphaBlendedWriteRGB,mn.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ch(d,n){const o=[...d],f=n.cameraWorldSizeForFog/n.worldSize,_=a.a6.mat4.identity([]);return a.a6.mat4.scale(_,_,[f,f,1]),a.a6.mat4.multiply(o,_,o),a.a6.mat4.multiply(o,n.worldToFogMatrix,o),o}function Hs(d,n,o,f,_){const v=o.material,b=f.context,{baseColorTexture:P,metallicRoughnessTexture:D}=v.pbrMetallicRoughness,{normalTexture:B,occlusionTexture:F,emissionTexture:U}=v;function q(ee,K,re){if(ee&&(d.push(K),b.activeTexture.set(b.gl.TEXTURE0+re),ee.gfxTexture)){const{minFilter:ie,magFilter:ae,wrapS:de,wrapT:fe}=ee.sampler;ee.gfxTexture.bindExtraParam(ie,ae,de,fe)}}q(P,"HAS_TEXTURE_u_baseColorTexture",Hr.BaseColor),q(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Hr.MetallicRoughness),q(B,"HAS_TEXTURE_u_normalTexture",Hr.Normal),q(F,"HAS_TEXTURE_u_occlusionTexture",Hr.Occlusion),q(U,"HAS_TEXTURE_u_emissionTexture",Hr.Emission),_&&(_.texture||(_.texture=new a.df(f.context,_.image,[_.image.height,_.image.height,_.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+Hr.LUT),_.texture&&_.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(o.texcoordBuffer)),o.colorBuffer&&(d.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(o.colorBuffer)),o.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(o.normalBuffer)),o.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(o.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES");const $=f.shadowRenderer;$&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&d.push("NORMAL_OFFSET"))}function Wl(d,n,o,f,_,v){const b=o.paint.get("model-opacity"),P=n.context,D=new rn(n.context.gl.LEQUAL,rn.ReadWrite,n.depthRangeFor3D),B=n.transform,F=d.mesh,U=F.material,q=U.pbrMetallicRoughness,$=n.style.fog;let ee;ee=n.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:a.a6.mat4.multiply([],f.zScaleMatrix,d.nodeModelMatrix),a.a6.mat4.multiply(ee,f.negCameraPosMatrix,ee);const K=a.a6.mat4.invert([],ee);a.a6.mat4.transpose(K,K);const re=o.paint.get("model-emissive-strength").constantOr(0),ie=ll(new Float32Array(d.worldViewProjection),new Float32Array(ee),new Float32Array(K),null,n,b,q.baseColorFactor.toRenderColor(null),U.emissiveFactor,q.metallicFactor,q.roughnessFactor,U,re,o),ae={defines:[]},de=[],fe=n.shadowRenderer;fe&&(fe.useNormalOffset=!1),Hs(ae.defines,de,F,n,o.lut);let be=null;if($){const Ie=ch(d.nodeModelMatrix,n.transform);if(be=new Float32Array(Ie),B.projection.name!=="globe"){const Re=F.aabb.min,Be=F.aabb.max,[Ne,De]=$.getOpacityForBounds(Ie,Re[0],Re[1],Be[0],Be[1]);ae.overrideFog=Ne>=Tt||De>=Tt}}const Ee=Cr(n,o.paint.get("model-cutoff-fade-range"));Ee.shouldRenderCutoff&&ae.defines.push("RENDER_CUTOFF");const we=n.getOrCreateProgram("model",ae);n.uploadCommonUniforms(P,we,null,be,Ee),n.renderPass!=="shadow"&&fe&&fe.setupShadowsFromMatrix(d.nodeModelMatrix,we),we.draw(n,P.gl.TRIANGLES,D,_,v,F.material.doubleSided?mn.disabled:mn.backCCW,ie,o.id,F.vertexBuffer,F.indexBuffer,F.segments,o.paint,n.transform.zoom,void 0,de)}function fc(d,n,o,f,_,v,b){let P;P=d.projection.name==="globe"?a.dg(o,d):[...o],a.a6.mat4.multiply(P,P,n.matrix);const D=a.a6.mat4.multiply([],f,P);if(n.meshes)for(const B of n.meshes){if(B.material.alphaMode!=="BLEND"){b.push({mesh:B,depth:0,modelIndex:_,worldViewProjection:D,nodeModelMatrix:P});continue}const F=a.a6.vec3.transformMat4([],B.centroid,D);F[2]>0&&v.push({mesh:B,depth:F[2],modelIndex:_,worldViewProjection:D,nodeModelMatrix:P})}if(n.children)for(const B of n.children)fc(d,B,o,f,_,v,b)}function Fc(d,n,o,f){const _=o.shadowRenderer;if(!_)return;const v=_.getShadowPassDepthMode(),b=_.getShadowPassColorMode(),P=_.calculateShadowPassMatrixFromMatrix(n),D=ul(P);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,v,xn.disabled,b,mn.backCCW,D,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,o.transform.zoom,void 0,void 0)}function Dh(d,n,o){const f=n.updateZoomBasedPaintProperties(),_=function(v,b,P){let D,B,F,U=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&U>0){const q=v.terrain,$=q.findDEMTileFor(P);$&&$.dem?D=a.di.create(q,P,$):U=0}if(U===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),U===b.validForExaggeration&&(U===0||D&&D._demTile&&D._demTile.tileID===b.validForDEMTile.id&&D._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const q in b.instancesPerModel){const $=b.instancesPerModel[q];for(let ee=0;ee<$.instancedDataArray.length;++ee){const K=(D?U*D.getElevationAt(0|$.instancedDataArray.float32[16*ee],0|$.instancedDataArray.float32[16*ee+1],!0,!0):0)+$.instancesEvaluatedElevation[ee];$.instancedDataArray.float32[16*ee+6]=K,B=B?Math.min(b.terrainElevationMin,K):K,F=F?Math.max(b.terrainElevationMax,K):K}}return b.terrainElevationMin=B||0,b.terrainElevationMax=F||0,b.validForExaggeration=U,b.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,n,o);(f||_)&&(n.uploaded=!1,n.upload(d.context))}const sa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.ca([0,0,0],[a.ab,a.ab,0])};function Rs(d,n){const o=1<<d.canonical.z,f=n.getFreeCameraOptions().position,_=n.elevation,v=d.canonical.x/o,b=(d.canonical.x+1)/o,P=d.canonical.y/o,D=(d.canonical.y+1)/o;let B=n._centerAltitude;if(_){const $=_.getMinMaxForTile(d);$&&$.max>B&&(B=$.max)}const F=a.ap(f.x,v,b)-f.x,U=a.ap(f.y,P,D)-f.y,q=a.bE(B,n.center.lat)-f.z;return n._zoomFromMercatorZ(Math.sqrt(F*F+U*U+q*q))}function Oh(d,n,o,f,_,v,b){const P=d.context,D=d.renderPass==="shadow",B=d.shadowRenderer,F=D&&B?B.getShadowPassDepthMode():new rn(P.gl.LEQUAL,rn.ReadWrite,d.depthRangeFor3D),U=d.isTileAffectedByFog(v);if(o.meshes)for(const q of o.meshes){const $=["MODEL_POSITION_ON_GPU"],ee=[];let K,re,ie;f.instancedDataArray.length>20&&$.push("INSTANCED_ARRAYS");const ae=Cr(d,n.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),D&&B)K=d.getOrCreateProgram("modelDepth",{defines:$}),re=ul(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(o.matrix)),ie=B.getShadowPassColorMode();else{Hs($,ee,q,d,n.lut),K=d.getOrCreateProgram("model",{defines:$,overrideFog:U});const fe=q.material,be=fe.pbrMetallicRoughness,Ee=n.paint.get("model-opacity"),we=n.paint.get("model-emissive-strength").constantOr(0);re=ll(v.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,d,Ee,be.baseColorFactor.toRenderColor(null),fe.emissiveFactor,be.metallicFactor,be.roughnessFactor,fe,we,n,_),B&&(b.shadowUniformsInitialized?K.setShadowUniformValues(P,B.getShadowUniformValues()):(B.setupShadows(v.toUnwrapped(),K,"model-tile",v.overscaledZ),b.shadowUniformsInitialized=!0)),ie=ae.shouldRenderCutoff||Ee<1||fe.alphaMode!=="OPAQUE"?An.alphaBlended:An.unblended}d.uploadCommonUniforms(P,K,v.toUnwrapped(),null,ae);const de=q.material.doubleSided?mn.disabled:mn.backCCW;if(f.instancedDataArray.length>20)ee.push(f.instancedDataBuffer),K.draw(d,P.gl.TRIANGLES,F,xn.disabled,ie,de,re,n.id,q.vertexBuffer,q.indexBuffer,q.segments,n.paint,d.transform.zoom,void 0,ee,f.instancedDataArray.length);else{const fe=D?"u_instance":"u_normal_matrix";for(let be=0;be<f.instancedDataArray.length;++be)re[fe]=new Float32Array(f.instancedDataArray.arrayBuffer,64*be,16),K.draw(d,P.gl.TRIANGLES,F,xn.disabled,ie,de,re,n.id,q.vertexBuffer,q.indexBuffer,q.segments,n.paint,d.transform.zoom,void 0,ee)}}if(o.children)for(const q of o.children)Oh(d,n,q,f,_,v,b)}const Cs=[1,-1,1];function ni(d,n,o,f){if(!o.modelManager)return!0;const _=o.modelManager;if(!o.shadowRenderer)return!0;const v=o.shadowRenderer,b=n.aabb;let P=!0,D=d.maxHeight;if(D===0){let F=0;for(const U in d.instancesPerModel){const q=_.getModel(U,f);q?F=Math.max(F,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):P=!1}D=d.maxScale*F*1.41+d.maxVerticalOffset,P&&(d.maxHeight=D)}b.max[2]=D,b.min[2]+=d.terrainElevationMin,b.max[2]+=d.terrainElevationMax,a.a6.vec3.transformMat4(b.min,b.min,n.tileMatrix),a.a6.vec3.transformMat4(b.max,b.max,n.tileMatrix);const B=b.intersects(v.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=B===2),B===0}function ei(d,n){const o=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],_=d.uniformValues.u_cutoff_params[2],v=d.uniformValues.u_cutoff_params[3];return f===o||v===_?1:a.ap(((n-o)/(f-o)-_)/(v-_),0,1)}function Nh(d,n,o,f){if(n.pitch<20)return 1;const _=n.getWorldToCameraMatrix();a.a6.mat4.multiply(_,_,d);const v=a.a6.vec4.fromValues(o.min[0],o.min[1],o.min[2],1);let b=a.a6.vec4.transformMat4(a.a6.vec4.create(),v,_),P=b,D=b;v[1]=o.max[1],b=a.a6.vec4.transformMat4(a.a6.vec4.create(),v,_),P=b[1]<P[1]?b:P,D=b[1]>D[1]?b:D,v[0]=o.max[0],b=a.a6.vec4.transformMat4(a.a6.vec4.create(),v,_),P=b[1]<P[1]?b:P,D=b[1]>D[1]?b:D,v[1]=o.min[1],b=a.a6.vec4.transformMat4(a.a6.vec4.create(),v,_),P=b[1]<P[1]?b:P,D=b[1]>D[1]?b:D;const B=a.ap(f[0],0,1),F=100*n.pixelsPerMeter*a.ap(f[1],0,1),U=a.ap(f[2],0,1),q=a.a6.vec4.lerp(a.a6.vec4.create(),P,D,B),$=Math.tan(.5*n.fovX),ee=-q[2]*$;if(F===0)return q[1]<-Math.abs(ee)?U:1;const K=(-Math.abs(ee)-q[1])/F,re=(ae,de,fe)=>(1-fe)*ae+fe*de,ie=a.ap(re(1,U,K),U,1);return re(1,ie,a.ap((n.pitch-20)/20,0,1))}class ml{}class kc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,o,f){{const U=this._storage.get(o.id);if(U)return U.lastUsedFrameIdx=n,U.buf}const _=f.gl,v=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),b=new ArrayBuffer(v),P=new Int16Array(b);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const D=new a.dk;for(let U=0;U<v/2;U+=3){const q=P[U],$=P[U+1],ee=P[U+2];D.emplaceBack(q,$),D.emplaceBack($,ee),D.emplaceBack(ee,q)}const B=f.bindVertexArrayOES.current,F=new ml;return F.buf=new os(f,D),F.lastUsedFrameIdx=n,this._storage.set(o.id,F),f.bindVertexArrayOES.set(B),F.buf}update(n){for(const[o,f]of this._storage)n-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(o))}destroy(){for(const[n,o]of this._storage)o.buf.destroy(),this._storage.delete(n)}}class Ou{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class hh{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const pc={symbol:function(d,n,o,f,_){if(d.renderPass!=="translucent")return;const v=xn.disabled,b=d.colorModeForRenderPass(),P=o.layout.get("text-variable-anchor"),D=o.layout.get("text-size-scale-range"),B=a.ap(d.scaleFactor,D[0],D[1]);P&&function(q,$,ee,K,re,ie,ae,de){const fe=$.transform,be=re==="map",Ee=ie==="map";for(const we of q){const Ie=K.getTile(we),Re=Ie.getBucket(ee);if(!Re||!Re.text||!Re.text.segments.get().length)continue;const Be=a.bk(Re.textSizeData,fe.zoom,de),Ne=ys(we,Re.getProjection(),fe),De=fe.calculatePixelsToTileUnitsMatrix(Ie),Je=Gn(Ne,Ie.tileID.canonical,Ee,be,fe,Re.getProjection(),De),at=Re.hasIconTextFit()&&Re.hasIconData();if(Be){const vt=Math.pow(2,fe.zoom-Ie.tileID.overscaledZ);cc(Re,be,Ee,ae,a.cS,fe,Je,we,vt,Be,at)}}}(f,d,o,n,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_,B);const F=o.paint.get("icon-opacity").constantOr(1)!==0,U=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||U)?Oa(d,n,o,f,v,b):(F&&Oa(d,n,o,f,v,b,{onlyIcons:!0}),U&&Oa(d,n,o,f,v,b,{onlyText:!0})),n.map.showCollisionBoxes&&(Ra(d,n,o,f,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Ra(d,n,o,f,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,o,f){if(d.renderPass!=="translucent")return;const _=o.paint.get("circle-opacity"),v=o.paint.get("circle-stroke-width"),b=o.paint.get("circle-stroke-opacity"),P=o.layout.get("circle-sort-key").constantOr(1)!==void 0,D=o.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(v.constantOr(1)===0||b.constantOr(1)===0))return;const B=d.context,F=B.gl,U=d.transform,q=d.depthModeForSublayer(0,rn.ReadOnly),$=xn.disabled,ee=d.colorModeForDrapableLayerRenderPass(D),K=U.projection.name==="globe",re=[a.am(U.center.lng),a.at(U.center.lat)],ie=[];for(let de=0;de<f.length;de++){const fe=f[de],be=n.getTile(fe),Ee=be.getBucket(o);if(!Ee||Ee.projection.name!==U.projection.name)continue;const we=Ee.programConfigurations.get(o.id),Ie=a.cT(o),Re=d.isTileAffectedByFog(fe);K&&Ie.push("PROJECTION_GLOBE_VIEW"),Ie.push("DEPTH_D24"),d.terrain&&U.depthOcclusionForSymbolsAndCircles&&Ie.push("DEPTH_OCCLUSION");const Be=d.getOrCreateProgram("circle",{config:we,defines:Ie,overrideFog:Re}),Ne=Ee.layoutVertexBuffer,De=Ee.globeExtVertexBuffer,Je=Ee.indexBuffer,at=U.projection.createInversionMatrix(U,fe.canonical),vt={programConfiguration:we,program:Be,layoutVertexBuffer:Ne,globeExtVertexBuffer:De,indexBuffer:Je,uniformValues:a.cU(d,fe,be,at,re,o),tile:be};if(P){const St=Ee.segments.get();for(const Pt of St)ie.push({segments:new a.b2([Pt]),sortKey:Pt.sortKey,state:vt})}else ie.push({segments:Ee.segments,sortKey:0,state:vt})}P&&ie.sort((de,fe)=>de.sortKey-fe.sortKey);const ae={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const de of ie){const{programConfiguration:fe,program:be,layoutVertexBuffer:Ee,globeExtVertexBuffer:we,indexBuffer:Ie,uniformValues:Re,tile:Be}=de.state,Ne=de.segments;d.terrain&&d.terrain.setupElevationDraw(Be,be,ae),d.uploadCommonUniforms(B,be,Be.tileID.toUnwrapped()),be.draw(d,F.TRIANGLES,q,$,ee,mn.disabled,Re,o.id,Ee,Ie,Ne,o.paint,U.zoom,fe,[we])}},heatmap:function(d,n,o,f){if(o.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,v=_.gl,b=xn.disabled,P=new An([v.ONE,v.ONE,v.ONE,v.ONE],a.bA.transparent,[!0,!0,!0,!0]);(function($,ee,K,re){const ie=$.gl,ae=ee.width*re,de=ee.height*re;$.activeTexture.set(ie.TEXTURE1),$.viewport.set([0,0,ae,de]);let fe=K.heatmapFbo;if(!fe||fe&&(fe.width!==ae||fe.height!==de)){fe&&fe.destroy();const be=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,be),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),fe=K.heatmapFbo=$.createFramebuffer(ae,de,!0,null),function(Ee,we,Ie,Re,Be,Ne){const De=Ee.gl;De.texImage2D(De.TEXTURE_2D,0,Ee.extRenderToTextureHalfFloat?De.RGBA16F:De.RGBA,Be,Ne,0,De.RGBA,Ee.extRenderToTextureHalfFloat?De.HALF_FLOAT:De.UNSIGNED_BYTE,null),Re.colorAttachment.set(Ie)}($,0,be,fe,ae,de)}else ie.bindTexture(ie.TEXTURE_2D,fe.colorAttachment.get()),$.bindFramebuffer.set(fe.framebuffer)})(_,d,o,d.transform.projection.name==="globe"?.5:.25),_.clear({color:a.bA.transparent});const D=d.transform,B=D.projection.name==="globe",F=B?["PROJECTION_GLOBE_VIEW"]:[],U=B?mn.frontCCW:mn.disabled,q=[a.am(D.center.lng),a.at(D.center.lat)];for(let $=0;$<f.length;$++){const ee=f[$];if(n.hasRenderableParent(ee))continue;const K=n.getTile(ee),re=K.getBucket(o);if(!re||re.projection.name!==D.projection.name)continue;const ie=d.isTileAffectedByFog(ee),ae=re.programConfigurations.get(o.id),de=d.getOrCreateProgram("heatmap",{config:ae,defines:F,overrideFog:ie}),{zoom:fe}=d.transform;d.terrain&&d.terrain.setupElevationDraw(K,de),d.uploadCommonUniforms(_,de,ee.toUnwrapped());const be=D.projection.createInversionMatrix(D,ee.canonical);de.draw(d,v.TRIANGLES,rn.disabled,b,P,U,Gl(d,ee,K,be,q,fe,o.paint.get("heatmap-intensity")),o.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,o.paint,d.transform.zoom,ae,B?[re.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){const b=_.context,P=b.gl,D=v.heatmapFbo;if(!D)return;b.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,D.colorAttachment.get()),b.activeTexture.set(P.TEXTURE1);let B=v.colorRampTexture;B||(B=v.colorRampTexture=new a.T(b,v.colorRamp,P.RGBA8)),B.bind(P.LINEAR,P.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,P.TRIANGLES,rn.disabled,xn.disabled,_.colorModeForRenderPass(),mn.disabled,((F,U,q,$)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,o))},line:function(d,n,o,f){if(d.renderPass!=="translucent")return;const _=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const b=o.paint.get("line-emissive-strength"),P=o.paint.get("line-occlusion-opacity"),D=o.layout.get("line-elevation-reference")==="sea",B=d.context,F=B.gl,U=!o.isDraped();if(U&&d.transform.projection.name==="globe")return;const q=o.layout.get("line-cross-slope"),$=q!==void 0,ee=q<1,K=U?new rn(d.depthOcclusion?F.GREATER:F.LEQUAL,rn.ReadOnly,d.depthRangeFor3D):d.depthModeForSublayer(0,rn.ReadOnly),re=d.colorModeForDrapableLayerRenderPass(b),ie=d.terrain&&d.terrain.renderingToTexture,ae=ie?1:a.q.devicePixelRatio,de=o.paint.get("line-dasharray"),fe=de.constantOr(1),be=o.layout.get("line-cap"),Ee=de.constantOr(null),we=be.constantOr(null),Ie=o.paint.get("line-pattern"),Re=Ie.constantOr(1),Be=Ie.constantOr(null),Ne=o.paint.get("line-opacity").constantOr(1);let De=!Re&&Ne!==1||d.depthOcclusion&&P>0&&P<1;const Je=o.paint.get("line-gradient"),at=Re?"linePattern":"line",vt=a.cV(o);let St;if(ie&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(De=!1),P!==0&&d.depthOcclusion){const He=o.paint._values["line-opacity"];He&&He.value&&He.value.kind==="constant"?St=He.value:a.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}if(U&&(d.forceTerrainMode=!0),!U&&P!==0&&d.terrain&&!ie)return void a.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`);const Pt=De&&U?d.stencilModeFor3D():xn.disabled;U&&(vt.push("ELEVATED"),$&&vt.push(ee?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&vt.push("ELEVATION_REFERENCE_SEA"));for(const He of f){const gt=n.getTile(He);if(Re&&!gt.patternsLoaded())continue;const rt=gt.getBucket(o);if(!rt)continue;d.prepareDrawTile();const _t=rt.programConfigurations.get(o.id),xt=d.isTileAffectedByFog(He),mt=d.getOrCreateProgram(at,{config:_t,defines:vt,overrideFog:xt,overrideRtt:!U&&void 0});if(Be&&gt.imageAtlas){const Ut=gt.imageAtlas.patternPositions[Be.toString()];Ut&&_t.setConstantPatternPositions(Ut)}if(!Re&&Ee&&we&&gt.lineAtlas){const Ut=gt.lineAtlas.getDash(Ee,we);Ut&&_t.setConstantPatternPositions(Ut)}let[Ot,Kt]=o.paint.get("line-trim-offset");(we==="round"||we==="square")&&Ot!==Kt&&(Ot===0&&(Ot-=1),Kt===1&&(Kt+=1));const on=ie?He.projMatrix:null,Zt=Re?a.cW(d,gt,o,on,ae,[Ot,Kt]):a.cX(d,gt,o,on,rt.lineClipsArray.length,ae,[Ot,Kt]);if(Je){const Ut=rt.gradients[o.id];let hn=Ut.texture;if(o.gradientVersion!==Ut.version){let Cn=256;if(o.stepInterpolant){const Hn=n.getSource().maxzoom,Di=He.canonical.z===Hn?Math.ceil(1<<d.transform.maxZoom-He.canonical.z):1;Cn=a.ap(a.cY(rt.maxLineLength/a.ab*1024*Di),256,B.maxTextureSize)}Ut.gradient=a.cZ({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Cn,image:Ut.gradient||void 0,clips:rt.lineClipsArray}),Ut.texture?Ut.texture.update(Ut.gradient):Ut.texture=new a.T(B,Ut.gradient,F.RGBA8),Ut.version=o.gradientVersion,hn=Ut.texture}B.activeTexture.set(F.TEXTURE1),hn.bind(o.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}fe&&(B.activeTexture.set(F.TEXTURE0),gt.lineAtlasTexture&&gt.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),_t.updatePaintBuffers()),Re&&(B.activeTexture.set(F.TEXTURE0),gt.imageAtlasTexture&&gt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),_t.updatePaintBuffers()),U&&!D&&d.terrain.setupElevationDraw(gt,mt),d.uploadCommonUniforms(B,mt,He.toUnwrapped());const un=Ut=>{St!=null&&(St.value=Ne*P),mt.draw(d,F.TRIANGLES,K,Ut,re,mn.disabled,Zt,o.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,o.paint,d.transform.zoom,_t,[rt.layoutVertexBuffer2,rt.patternVertexBuffer,rt.zOffsetVertexBuffer]),St!=null&&(St.value=Ne)};if(De&&!U){const Ut=d.stencilModeForClipping(He).ref;Ut===0&&ie&&B.clear({stencil:0});const hn={func:F.EQUAL,mask:255};Zt.u_alpha_discard_threshold=.8,un(new xn(hn,Ut,255,F.KEEP,F.KEEP,F.INVERT)),Zt.u_alpha_discard_threshold=0,un(new xn(hn,Ut,255,F.KEEP,F.KEEP,F.KEEP))}else De&&U&&(Zt.u_alpha_discard_threshold=.001),un(U?Pt:d.stencilModeForClipping(He))}U&&(d.forceTerrainMode=!1),De&&(d.resetStencilClippingMasks(),ie&&B.clear({stencil:0})),P===0||d.depthOcclusion||ie||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,n,o,f){const _=o.paint.get("fill-color"),v=o.paint.get("fill-opacity"),b=o.is3D(),P=new rn(d.context.gl.LEQUAL,rn.ReadWrite,d.depthRangeFor3D);if(v.constantOr(1)===0)return;const D=o.paint.get("fill-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(D),F=o.paint.get("fill-pattern"),U=d.opaquePassEnabledForLayer()&&!F.constantOr(1)&&_.constantOr(a.bA.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===U){const q=b?P:d.depthModeForSublayer(1,d.renderPass==="opaque"?rn.ReadWrite:rn.ReadOnly);wi(d,n,o,f,q,B,!1)}if(!b&&d.renderPass==="translucent"&&o.paint.get("fill-antialias")){const q=b?P:d.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,rn.ReadOnly);wi(d,n,o,f,q,B,!0)}},"fill-extrusion":function(d,n,o,f){const _=o.paint.get("fill-extrusion-opacity"),v=d.context,b=v.gl,P=d.terrain,D=P&&P.renderingToTexture;if(_===0)return;const B=d.conflationActive&&d.style.isLayerClipped(o,n.getSource()),F=d.style.order.indexOf(o.fqid);if(B&&function(U,q,$,ee,K){for(const re of ee){const ie=q.getTile(re).getBucket($);ie&&(ie.updateReplacement(re,U.replacementSource,K),ie.uploadCentroid(U.context))}}(d,n,o,f,F),P||B)for(const U of f){const q=n.getTile(U).getBucket(o);q&&Pu(d.context,n,U,q,o,P,B)}if(d.renderPass==="shadow"&&d.shadowRenderer){const U=d.shadowRenderer;if(P&&_<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.a4)return;const q=U.getShadowPassDepthMode(),$=U.getShadowPassColorMode();ar(d,n,o,f,q,xn.disabled,$,B)}else if(d.renderPass==="translucent"){const U=!o.paint.get("fill-extrusion-pattern").constantOr(1),q=o.paint.get("fill-extrusion-color").constantOr(a.bA.white);if(!D&&q.a!==0){const $=new rn(d.context.gl.LEQUAL,rn.ReadWrite,d.depthRangeFor3D);_===1&&U?ar(d,n,o,f,$,xn.disabled,An.unblended,B):(ar(d,n,o,f,$,xn.disabled,An.disabled,B),ar(d,n,o,f,$,d.stencilModeFor3D(),d.colorModeForRenderPass(),B),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&U&&(!P&&d.transform.projection.name!=="globe"||D)){const $=o.paint.get("fill-extrusion-opacity"),ee=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),K=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=o.paint.get("fill-extrusion-flood-light-intensity"),ie=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),ae=ee>0&&K>0,de=re>0,fe=(Ee,we,Ie)=>(1-Ie)*Ee+Ie*we,be=Ee=>{const we=d.depthModeForSublayer(1,rn.ReadOnly,b.LEQUAL,!0),Ie=o.paint.get(Ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=fe(.1,3,Ie),Be=d._showOverdrawInspector;if(!Be){const Ne=new xn({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),De=new An([b.ONE,b.ONE,b.ONE,b.ONE],a.bA.transparent,[!1,!1,!1,!0],b.MIN);pi(d,n,o,f,we,Ne,De,mn.disabled,Ee,"sdf",$,ee,K,re,ie,Re,B,!1)}{const Ne=Be?xn.disabled:new xn({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),De=Be?d.colorModeForRenderPass():new An([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],a.bA.transparent,[!0,!0,!0,!0]);pi(d,n,o,f,we,Ne,De,mn.disabled,Ee,"color",$,ee,K,re,ie,Re,B,!1)}};if(D){const Ee=(we,Ie,Re)=>{const Be=d.depthModeForSublayer(1,rn.ReadOnly,b.LEQUAL,!1),Ne=o.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),De=fe(.1,3,Ne);{const Je=new An([b.ONE,b.ONE,b.ONE,b.ONE],a.bA.transparent,[!1,!1,!1,!0]);pi(d,n,o,f,Be,xn.disabled,Je,mn.disabled,we,"clear",$,ee,K,re,ie,De,B,Ie)}{const Je=new xn({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),at=new An([b.ONE,b.ONE,b.ONE,b.ONE],a.bA.transparent,[!1,!1,!1,!0],b.MIN);pi(d,n,o,f,Be,Je,at,mn.disabled,we,"sdf",$,ee,K,re,ie,De,B,Ie)}{const Je=we?b.ZERO:b.ONE_MINUS_DST_ALPHA,at=new xn({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),vt=new An([Je,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],a.bA.transparent,[!0,!0,!0,!0]);pi(d,n,o,f,Be,at,vt,mn.disabled,we,"color",$,ee,K,re,ie,De,B,Ie)}{const Je=new An([b.ONE,b.ONE,b.ONE,we?b.ZERO:b.ONE],a.bA.transparent,[!1,!1,!1,!0],we?b.FUNC_ADD:b.MAX);pi(d,n,o,f,Be,xn.disabled,Je,mn.disabled,we,"clear",$,ee,K,re,ie,De,B,Ie,Re)}};if(ae||de){let we;if(d.prepareDrawTile(),P){const Ie=P.drapeBufferSize[0],Re=P.drapeBufferSize[1];we=P.framebufferCopyTexture,we&&(!we||we.size[0]===Ie&&we.size[1]===Re)||(we&&we.destroy(),we=P.framebufferCopyTexture=new a.T(v,new a.r({width:Ie,height:Re}),b.RGBA8)),we.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Ie,Re)}ae&&Ee(!0,!1,we),de&&Ee(!1,!0,we)}}else ae&&be(!0),de&&be(!1),(ae||de)&&d.resetStencilClippingMasks()}}},hillshade:function(d,n,o,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const _=d.context,v=d.terrain&&d.terrain.renderingToTexture,[b,P]=d.renderPass!=="translucent"||v?[{},f]:d.stencilConfigForOverlap(f);for(const D of P){const B=n.getTile(D);if(B.needsHillshadePrepare&&d.renderPass==="offscreen")Sa(d,B,o);else if(d.renderPass==="translucent"){const F=d.depthModeForSublayer(0,rn.ReadOnly),U=o.paint.get("hillshade-emissive-strength"),q=d.colorModeForDrapableLayerRenderPass(U),$=v&&d.terrain?d.terrain.stencilModeForRTTOverlap(D):b[D.overscaledZ];Qa(d,D,B,o,F,$,q)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,o,f,_,v){if(d.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const b=d.transform.projection.name==="globe",P=o.paint.get("raster-elevation")!==0,D=P&&b;if(d.renderElevatedRasterBackface&&!D)return;const B=d.context,F=B.gl,U=n.getSource(),q=function(Ee,we,Ie,Re){const Be=we.paint.get("raster-color"),Ne=Ee.type==="raster-array",De=[],Je=we.paint.get("raster-resampling"),at=we.paint.get("raster-color-mix");let vt=we.paint.get("raster-color-range");const St=[at[0],at[1],at[2],0],Pt=at[3];let He=Je==="nearest"?Re.NEAREST:Re.LINEAR;if(Ne&&(De.push("RASTER_ARRAY"),Be||De.push("RASTER_COLOR"),Je==="linear"&&De.push("RASTER_ARRAY_LINEAR"),He=Re.NEAREST,!vt&&Ee.rasterLayers)){const gt=Ee.rasterLayers.find(({id:rt})=>rt===we.sourceLayer);gt&&gt.fields&&gt.fields.range&&(vt=gt.fields.range)}if(vt=vt||[0,1],Be){De.push("RASTER_COLOR"),Ie.activeTexture.set(Re.TEXTURE2),we.updateColorRamp(vt);let gt=we.colorRampTexture;gt||(gt=we.colorRampTexture=new a.T(Ie,we.colorRamp,Re.RGBA8)),gt.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}return{mix:St,range:vt,offset:Pt,defines:De,resampling:He}}(U,o,B,F);if(U instanceof a.aD&&!f.length&&!b)return;const $=o.paint.get("raster-emissive-strength"),ee=d.colorModeForDrapableLayerRenderPass($),K=d.terrain&&d.terrain.renderingToTexture,re=!d.options.moving,ie=o.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(U instanceof a.aD&&!f.length&&(U.onNorthPole||U.onSouthPole)){const Ee=P?d.stencilModeFor3D():xn.disabled;return void Ui(!!U.onNorthPole,null,d,n,o,$,q,mn.disabled,Ee)}if(!f.length)return;const[ae,de]=U instanceof a.aD||K?[{},f]:d.stencilConfigForOverlap(f),fe=de[de.length-1].overscaledZ;D&&q.defines.push("PROJECTION_GLOBE_VIEW"),P&&q.defines.push("RENDER_CUTOFF");const be=(Ee,we,Ie)=>{for(const Re of Ee){const Be=Re.toUnwrapped(),Ne=n.getTile(Re);if(K&&(!Ne||!Ne.hasData()))continue;B.activeTexture.set(F.TEXTURE0);const De=Ru(Ne,U,o,q);if(!De||!De.texture)continue;const{texture:Je,mix:at,offset:vt,tileSize:St,buffer:Pt}=De;let He,gt;K?(He=rn.disabled,gt=Re.projMatrix):P?(He=new rn(F.LEQUAL,rn.ReadWrite,d.depthRangeFor3D),gt=b?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Be,re)):(He=d.depthModeForSublayer(Re.overscaledZ-fe,o.paint.get("raster-opacity")===1?rn.ReadWrite:rn.ReadOnly,F.LESS),gt=d.transform.calculateProjMatrix(Be,re));const rt=d.terrain&&K?d.terrain.stencilModeForRTTOverlap(Re):ae[Re.overscaledZ],_t=v?0:o.paint.get("raster-fade-duration");Ne.registerFadeDuration(_t);const xt=n.findLoadedParent(Re,0),mt=Vl(Ne,xt,n,d.transform,_t);let Ot,Kt;d.terrain&&d.terrain.prepareDrawTile(),B.activeTexture.set(F.TEXTURE0),Je.bind(ie,F.CLAMP_TO_EDGE),B.activeTexture.set(F.TEXTURE1),xt?(xt.texture&&xt.texture.bind(ie,F.CLAMP_TO_EDGE),Ot=Math.pow(2,xt.tileID.overscaledZ-Ne.tileID.overscaledZ),Kt=[Ne.tileID.canonical.x*Ot%1,Ne.tileID.canonical.y*Ot%1]):Je.bind(ie,F.CLAMP_TO_EDGE),Je.useMipmap&&B.extTextureFilterAnisotropic&&d.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const on=d.transform;let Zt;const un=P?Hl(on):[0,0,0,0];let Ut,hn,Cn,Hn,Di,ti=0;if(D&&U instanceof a.aD&&U.coordinates.length>3)Ut=Float32Array.from(a.b6(a.cC(new a.bQ(0,0,0)))),hn=Float32Array.from(on.globeMatrix),Cn=Float32Array.from(a.cy(on)),Hn=[a.am(on.center.lng),a.at(on.center.lat)],Zt=U.elevatedGlobePerspectiveTransform,Di=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const kn=a.cz(Re.canonical);ti=a.cA(kn.getCenter().lat),Ut=Float32Array.from(a.b6(a.cC(Re.canonical))),hn=Float32Array.from(on.globeMatrix),Cn=Float32Array.from(a.cy(on)),Hn=[a.am(on.center.lng),a.at(on.center.lat)],Zt=[0,0],Di=Float32Array.from(a.cB(Re.canonical,kn,ti,on.worldSize/on._pixelsPerMercatorPixel))}else Zt=U instanceof a.aD?U.perspectiveTransform:[0,0],Ut=new Float32Array(16),hn=new Float32Array(9),Cn=new Float32Array(16),Hn=[0,0],Di=new Float32Array(9);const Bi=La(gt,Ut,hn,Cn,Di,Kt||[0,0],a.a9(d.transform.zoom),Hn,un,Ot||1,mt,o,Zt,P?o.paint.get("raster-elevation"):0,2,at,vt,q.range,St,Pt,$),di=d.isTileAffectedByFog(Re),Oi=d.getOrCreateProgram("raster",{defines:q.defines,overrideFog:di});if(d.uploadCommonUniforms(B,Oi,Be),U instanceof a.aD){const kn=U.elevatedGlobeVertexBuffer,Pi=U.elevatedGlobeIndexBuffer;if(K||!b)U.boundsBuffer&&U.boundsSegments&&Oi.draw(d,F.TRIANGLES,He,xn.disabled,ee,mn.disabled,Bi,o.id,U.boundsBuffer,d.quadTriangleIndexBuffer,U.boundsSegments);else if(kn&&Pi){const Ti=on.zoom<=a.c3?U.elevatedGlobeSegments:U.getSegmentsForLongitude(on.center.lng);Ti&&Oi.draw(d,F.TRIANGLES,He,xn.disabled,ee,we,Bi,o.id,kn,Pi,Ti)}}else if(D){He=new rn(F.LEQUAL,rn.ReadOnly,d.depthRangeFor3D);const kn=d.globeSharedBuffers;if(kn){const[Pi,Ti,mi]=kn.getGridBuffers(ti,!1);Oi.draw(d,F.TRIANGLES,He,Ie||rt,d.colorModeForRenderPass(),we,Bi,o.id,Pi,Ti,mi)}}else{const{tileBoundsBuffer:kn,tileBoundsIndexBuffer:Pi,tileBoundsSegments:Ti}=d.getTileBoundsBuffers(Ne);Oi.draw(d,F.TRIANGLES,He,rt,ee,mn.disabled,Bi,o.id,kn,Pi,Ti)}}if(!(U instanceof a.aD)&&D)for(const Re of Ee){const Be=Re.canonical.y===(1<<Re.canonical.z)-1;Re.canonical.y===0&&Ui(!0,Re,d,n,o,$,q,we,Ie||xn.disabled),Be&&Ui(!1,Re,d,n,o,$,q,we===mn.frontCW?mn.backCW:mn.frontCW,Ie||xn.disabled)}};D?be(de,d.renderElevatedRasterBackface?mn.backCW:mn.frontCW,d.stencilModeFor3D()):be(de,mn.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,n,o,f,_,v){d.renderPass==="offscreen"&&function(b,P,D,B){if(!B.length)return;const F=b.context,U=F.gl,q=P.getSource();if(!(q instanceof Dr))return;const $=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let ee=D.particlePositionRGBAImage;if(!ee||ee.width!==$){const de=function(fe){const be=fe*fe,Ee=new Uint8Array(4*be),we=function(Re){return Re|=0,Re=Math.imul(2747636419^Re,2654435769),Re=Math.imul(Re^Re>>>16,2654435769),((Re=Math.imul(Re^Re>>>16,2654435769))>>>0)/4294967296},Ie=1/1.1;for(let Re=0;Re<be;Re++){const Be=Ie*(we(2*Re+0)+ia),Ne=Ie*(we(2*Re+1)+ia),De=255*Be%1,Je=255*Ne%1,at=De,vt=Ne-Je/255,St=Je;Ee[4*Re+0]=255*(Be-De/255),Ee[4*Re+1]=255*at,Ee[4*Re+2]=255*vt,Ee[4*Re+3]=255*St}return Ee}($);ee=D.particlePositionRGBAImage=new a.r({width:$,height:$},de)}let K=D.particleFramebuffer;K?K.width!==$&&(K.destroy(),K=D.particleFramebuffer=F.createFramebuffer($,$,!0,null)):K=D.particleFramebuffer=F.createFramebuffer($,$,!0,null);const re=[];for(const de of B){const fe=P.getTile(de);if(!(fe instanceof qr))continue;const be=Du(fe,q,D);if(!be)continue;const Ee=[fe.tileSize,fe.tileSize];let we=D.tileFramebuffer;we||(we=D.tileFramebuffer=F.createFramebuffer(Ee[0],Ee[1],!0,null));let Ie=fe.rasterParticleState;Ie||(Ie=fe.rasterParticleState=new fl(F,de,Ee,ee));const Re=Ie.update(D.lastInvalidatedAt);Ie.particleTextureDimension!==$&&Ie.updateParticleTexture(de,ee);const Be=Ie.targetColorTexture;Ie.targetColorTexture=Ie.backgroundColorTexture,Ie.backgroundColorTexture=Be;const Ne=Ie.particleTexture0;Ie.particleTexture0=Ie.particleTexture1,Ie.particleTexture1=Ne,re.push([de,be,Ie,Re])}if(re.length===0)return;const ie=a.q.now(),ae=D.previousDrawTimestamp?.001*(ie-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=ie,D.hasColorMap()){F.activeTexture.set(U.TEXTURE0+2);let de=D.colorRampTexture;de||(de=D.colorRampTexture=new a.T(F,D.colorRamp,U.RGBA8)),de.bind(U.LINEAR,U.CLAMP_TO_EDGE)}F.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(de,fe,be){const Ee=de.context,we=Ee.gl,Ie=fe.tileFramebuffer;Ee.activeTexture.set(we.TEXTURE0);const Re={u_texture:0,u_opacity:1.05*(Ne=fe.paint.get("raster-particle-fade-opacity-factor"))/(Ne+.05)},Be=de.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ne;for(const De of be){const[,,Je,at]=De;Ie.colorAttachment.set(Je.targetColorTexture.texture),Ee.viewport.set([0,0,Ie.width,Ie.height]),Ee.clear({color:a.bA.transparent}),at&&(Je.backgroundColorTexture.bind(we.NEAREST,we.CLAMP_TO_EDGE),Be.draw(de,we.TRIANGLES,rn.disabled,xn.disabled,An.alphaBlended,mn.disabled,Re,fe.id,de.viewportBuffer,de.quadTriangleIndexBuffer,de.viewportSegments))}}(b,D,re),function(de,fe,be,Ee){const we=de.context,Ie=we.gl,Re=be.tileFramebuffer,Be=de.transform.projection.name==="globe",Ne=be.paint.get("raster-particle-max-speed");for(const De of Ee){const[Je,at,vt]=De;we.activeTexture.set(Ie.TEXTURE0+0),at.texture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Re.colorAttachment.set(vt.targetColorTexture.texture);const St=de.getOrCreateProgram("rasterParticleDraw",{defines:at.defines,overrideFog:!1});we.activeTexture.set(Ie.TEXTURE0+1);const Pt=at.scalarData?[]:[0,1,2,3].map(rt=>a.c$[rt](Je));Pt.push(Je);const He=Je.canonical.x,gt=Je.canonical.y;for(const rt of Pt){const _t=fe.getTile(Be?rt.wrapped():rt);if(!_t)continue;const xt=_t.rasterParticleState;if(!xt)continue;const mt=rt.canonical.x+(1<<rt.canonical.z)*(rt.wrap-Je.wrap),Ot=rt.canonical.y;xt.particleTexture0.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE);const Kt=Mu(1,xt.particleTexture0.size[0],[mt-He,Ot-gt],0,at.texture.size,2,Ne,at.textureOffset,at.scale,at.offset);St.draw(de,Ie.POINTS,rn.disabled,xn.disabled,An.alphaBlended,mn.disabled,Kt,be.id,xt.particleIndexBuffer,void 0,xt.particleSegment)}}}(b,P,D,re),F.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(de,fe,be,Ee){const we=de.context,Ie=we.gl,Re=fe.paint.get("raster-particle-max-speed"),Be=Ee*fe.paint.get("raster-particle-speed-factor")*.15,Ne=function(Je){return Math.pow(Je,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),De=fe.particleFramebuffer;we.viewport.set([0,0,De.width,De.height]);for(const Je of be){const[,at,vt]=Je;we.activeTexture.set(Ie.TEXTURE0+0),at.texture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),we.activeTexture.set(Ie.TEXTURE0+1);const St=vt.particleTexture0;St.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE);const Pt=oc(1,St.size[0],0,at.texture.size,Re,Be,Ne,at.textureOffset,at.scale,at.offset);De.colorAttachment.set(vt.particleTexture1.texture),we.clear({color:a.bA.transparent}),de.getOrCreateProgram("rasterParticleUpdate",{defines:at.defines}).draw(de,Ie.TRIANGLES,rn.disabled,xn.disabled,An.unblended,mn.disabled,Pt,fe.id,de.viewportBuffer,de.quadTriangleIndexBuffer,de.viewportSegments)}}(b,D,re,ae)}(d,n,o,f),d.renderPass==="translucent"&&(function(b,P,D,B,F){const U=b.context,q=U.gl,$=P.getSource().tileSize,ee=5*(1-a.a7(a.bV,a.bV+1,b.transform.zoom))*$+D.paint.get("raster-particle-elevation"),K=!b.options.moving,re=b.transform.projection.name==="globe";if(!B.length)return;const[ie,ae]=b.stencilConfigForOverlap(B),de=[];re&&de.push("PROJECTION_GLOBE_VIEW");const fe=b.stencilModeFor3D();for(const be of ae){const Ee=be.toUnwrapped(),we=P.getTile(be);if(!we.rasterParticleState)continue;const Ie=we.rasterParticleState,Re=100;we.registerFadeDuration(Re);const Be=P.findLoadedParent(be,0),Ne=Vl(we,Be,P,b.transform,Re);let De,Je;b.terrain&&b.terrain.prepareDrawTile(),U.activeTexture.set(q.TEXTURE0),Ie.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),U.activeTexture.set(q.TEXTURE1),Be&&Be.rasterParticleState?(Be.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),De=Math.pow(2,Be.tileID.overscaledZ-we.tileID.overscaledZ),Je=[we.tileID.canonical.x*De%1,we.tileID.canonical.y*De%1]):Ie.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const at=re?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(Ee,K),vt=b.transform,St=zc(vt),Pt=a.cz(be.canonical),He=a.cA(Pt.getCenter().lat);let gt,rt,_t,xt,mt;re?(gt=Float32Array.from(a.b6(a.cC(be.canonical))),rt=Float32Array.from(vt.globeMatrix),_t=Float32Array.from(a.cy(vt)),xt=[a.am(vt.center.lng),a.at(vt.center.lat)],mt=Float32Array.from(a.cB(be.canonical,Pt,He,vt.worldSize/vt._pixelsPerMercatorPixel))):(gt=new Float32Array(16),rt=new Float32Array(9),_t=new Float32Array(16),xt=[0,0],mt=new Float32Array(9));const Ot=sl(at,gt,rt,_t,mt,Je||[0,0],a.a9(b.transform.zoom),xt,St,De||1,Ne,ee),Kt=b.isTileAffectedByFog(be),on=b.getOrCreateProgram("rasterParticle",{defines:de,overrideFog:Kt});if(b.uploadCommonUniforms(U,on,Ee),re){const Zt=new rn(q.LEQUAL,rn.ReadOnly,b.depthRangeFor3D),un=0,Ut=b.globeSharedBuffers;if(Ut){const[hn,Cn,Hn]=Ut.getGridBuffers(He,un!==0);on.draw(b,q.TRIANGLES,Zt,fe,An.alphaBlended,b.renderElevatedRasterBackface?mn.frontCCW:mn.backCCW,Ot,D.id,hn,Cn,Hn)}}else{const Zt=b.depthModeForSublayer(0,rn.ReadOnly),un=ie[be.overscaledZ],{tileBoundsBuffer:Ut,tileBoundsIndexBuffer:hn,tileBoundsSegments:Cn}=b.getTileBoundsBuffers(we);on.draw(b,q.TRIANGLES,Zt,un,An.alphaBlended,mn.disabled,Ot,D.id,Ut,hn,Cn)}}b.resetStencilClippingMasks()}(d,n,o,f),d.style.map.triggerRepaint())},background:function(d,n,o,f){const _=o.paint.get("background-color"),v=o.paint.get("background-opacity"),b=o.paint.get("background-emissive-strength"),P=o.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const D=d.context,B=D.gl,F=d.transform,U=F.tileSize,q=o.paint.get("background-pattern");let $;if(q!==void 0&&(q===null||($=d.imageManager.getPattern(q.toString(),o.scope,d.style.getLut(o.scope)),!$)))return;const ee=!q&&_.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==ee)return;const K=xn.disabled,re=d.depthModeForSublayer(0,ee==="opaque"?rn.ReadWrite:rn.ReadOnly),ie=d.colorModeForDrapableLayerRenderPass(b),ae=q?"backgroundPattern":"background";let de,fe=f;if(fe||(de=d.getBackgroundTiles(),fe=Object.values(de).map(be=>be.tileID)),q&&(D.activeTexture.set(B.TEXTURE0),d.imageManager.bind(d.context,o.scope)),P){const be=d.getOrCreateProgram(ae,{overrideFog:!1,overrideRtt:!0}),Ee=new Float32Array(a.a6.mat4.identity([])),we=new a.aA(0,0,0,0,0),Ie=q?al(Ee,b,v,d,0,o.scope,$,P,{tileID:we,tileSize:U}):Xr(Ee,b,v,_.toRenderColor(o.lut));be.draw(d,B.TRIANGLES,re,K,ie,mn.disabled,Ie,o.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const be of fe){const Ee=d.isTileAffectedByFog(be),we=d.getOrCreateProgram(ae,{overrideFog:Ee}),Ie=be.toUnwrapped(),Re=f?be.projMatrix:d.transform.calculateProjMatrix(Ie);d.prepareDrawTile();const Be=n?n.getTile(be):de?de[be.key]:new As(be,U,F.zoom,d),Ne=q?al(Re,b,v,d,0,o.scope,$,P,{tileID:be,tileSize:U}):Xr(Re,b,v,_.toRenderColor(o.lut));d.uploadCommonUniforms(D,we,Ie);const{tileBoundsBuffer:De,tileBoundsIndexBuffer:Je,tileBoundsSegments:at}=d.getTileBoundsBuffers(Be);we.draw(d,B.TRIANGLES,re,K,ie,mn.disabled,Ne,o.id,De,Je,at)}},sky:function(d,n,o){const f=d._atmosphere?a.a9(d.transform.zoom):1,_=o.paint.get("sky-opacity")*f;if(_===0)return;const v=d.context,b=o.paint.get("sky-type"),P=new rn(v.gl.LEQUAL,rn.ReadOnly,[0,1]),D=d.frameCounter/1e3%1;b==="atmosphere"?d.renderPass==="offscreen"?o.needsSkyboxCapture(d)&&(function(B,F,U,q){const $=B.context,ee=$.gl;let K=F.skyboxFbo;if(!K){K=F.skyboxFbo=$.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Ks($),F.skyboxTexture=$.gl.createTexture(),ee.bindTexture(ee.TEXTURE_CUBE_MAP,F.skyboxTexture),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MAG_FILTER,ee.LINEAR);for(let de=0;de<6;++de)ee.texImage2D(ee.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,ee.RGBA,32,32,0,ee.RGBA,ee.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(K.framebuffer),$.viewport.set([0,0,32,32]);const re=F.getCenter(B,!0),ie=B.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);a.a6.mat4.identity(ae),a.a6.mat4.rotateY(ae,ae,.5*-Math.PI),ko(B,F,ie,ae,re,0),a.a6.mat4.identity(ae),a.a6.mat4.rotateY(ae,ae,.5*Math.PI),ko(B,F,ie,ae,re,1),a.a6.mat4.identity(ae),a.a6.mat4.rotateX(ae,ae,.5*-Math.PI),ko(B,F,ie,ae,re,2),a.a6.mat4.identity(ae),a.a6.mat4.rotateX(ae,ae,.5*Math.PI),ko(B,F,ie,ae,re,3),a.a6.mat4.identity(ae),ko(B,F,ie,ae,re,4),a.a6.mat4.identity(ae),a.a6.mat4.rotateY(ae,ae,Math.PI),ko(B,F,ie,ae,re,5),$.viewport.set([0,0,B.width,B.height])}(d,o),o.markSkyboxValid(d)):d.renderPass==="sky"&&function(B,F,U,q,$){const ee=B.context,K=ee.gl,re=B.transform,ie=B.getOrCreateProgram("skybox");ee.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,F.skyboxTexture);const ae=((de,fe,be,Ee,we)=>({u_matrix:de,u_sun_direction:fe,u_cubemap:0,u_opacity:Ee,u_temporal_offset:we}))(re.skyboxMatrix,F.getCenter(B,!1),0,q,$);B.uploadCommonUniforms(ee,ie),ie.draw(B,K.TRIANGLES,U,xn.disabled,B.colorModeForRenderPass(),mn.backCW,ae,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,o,P,_,D):b==="gradient"&&d.renderPass==="sky"&&function(B,F,U,q,$){const ee=B.context,K=ee.gl,re=B.transform,ie=B.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Ks(ee)),ee.activeTexture.set(K.TEXTURE0);let ae=F.colorRampTexture;ae||(ae=F.colorRampTexture=new a.T(ee,F.colorRamp,K.RGBA8)),ae.bind(K.LINEAR,K.CLAMP_TO_EDGE);const de=((fe,be,Ee,we,Ie)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:be,u_radius:a.bC(Ee),u_opacity:we,u_temporal_offset:Ie}))(re.skyboxMatrix,F.getCenter(B,!1),F.paint.get("sky-gradient-radius"),q,$);B.uploadCommonUniforms(ee,ie),ie.draw(B,K.TRIANGLES,U,xn.disabled,B.colorModeForRenderPass(),mn.backCW,de,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,o,P,_,D)},debug:function(d,n,o,f,_,v){for(let b=0;b<o.length;b++)if(_){const B=new a.bA(f.r*.8,f.g*.8,f.b*.8,1);Ei(d,n,o[b],f,-1,-1,v),Ei(d,n,o[b],f,-1,1,v),Ei(d,n,o[b],f,1,1,v),Ei(d,n,o[b],f,1,-1,v),Ei(d,n,o[b],B,0,0,v)}else Ei(d,n,o[b],f,0,0,v)},custom:function(d,n,o,f){const _=d.context,v=o.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&o.isDraped(n)){if(d.renderPass==="offscreen"){const b=v.prerender;if(b){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const P=d.transform.pointMerc;b.call(v,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),a.a9(d.transform.zoom),[P.x,P.y],d.transform.pixelsPerMeterRatio)}else b.call(v,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const P=v.renderToTile;if(P){const D=f[0].canonical,B=new a.a5(D.x+f[0].wrap*(1<<D.z),D.y,D.z);_.setDepthMode(rn.disabled),_.setStencilMode(xn.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),P.call(v,_.gl,B),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(xn.disabled);const b=v.renderingMode==="3d"?new rn(d.context.gl.LEQUAL,rn.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,rn.ReadOnly);if(_.setDepthMode(b),d.transform.projection.name==="globe"){const P=d.transform.pointMerc;v.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),a.a9(d.transform.zoom),[P.x,P.y],d.transform.pixelsPerMeterRatio)}else v.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,n,o,f){if(d.renderPass==="opaque")return;const _=o.paint.get("model-opacity");if(_===0)return;const v=o.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!v||d.terrain&&_<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof a.a4))return;const b=d.shadowRenderer,P=o.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,P||(b.enabled=!1));const D=()=>{b&&(b.useNormalOffset=!0,P||(b.enabled=!0))},B=n.getSource();if(d.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return function(ie,ae,de,fe,be){const Ee=ie.transform;if(Ee.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${Ee.projection.name} projection is not yet implemented`);const we=Ee.getFreeCameraOptions().position;if(!ie.modelManager)return;const Ie=ie.modelManager;de.modelManager=Ie;const Re=ie.shadowRenderer;if(!de._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Be=de._unevaluatedLayout._values["model-id"],Ne={...de.layout.get("model-id").parameters},De=ie.style.order.indexOf(de.fqid);for(const Je of fe){const at=ae.getTile(Je).getBucket(de);if(!at||at.projection.name!==Ee.projection.name)continue;const vt=at.getModelUris();vt&&!at.modelsRequested&&(Ie.addModelsFromBucket(vt,be),at.modelsRequested=!0);const St=Rs(Je,Ee);Ne.zoom=St;const Pt=Be.possiblyEvaluate(Ne);if(Dh(ie,at,Je),sa.shadowUniformsInitialized=!1,sa.useSingleShadowCascade=!!Re&&Re.getMaxCascadeForTile(Je.toUnwrapped())===0,ie.renderPass==="shadow"&&Re){if(ie.currentShadowCascade===1&&at.isInsideFirstShadowMapFrustum)continue;const rt=Ee.calculatePosMatrix(Je.toUnwrapped(),Ee.worldSize);if(sa.tileMatrix.set(rt),sa.shadowTileMatrix=Float32Array.from(Re.calculateShadowPassMatrixFromMatrix(rt)),sa.aabb.min.fill(0),sa.aabb.max[0]=sa.aabb.max[1]=a.ab,sa.aabb.max[2]=0,ni(at,sa,ie,de.scope))continue}const He=1<<Je.canonical.z,gt=[((we.x-Je.wrap)*He-Je.canonical.x)*a.ab,(we.y*He-Je.canonical.y)*a.ab,we.z*He*a.ab];ie.conflationActive&&Object.keys(at.instancesPerModel).length>0&&ie.style.isLayerClipped(de,ae.getSource())&&at.updateReplacement(Je,ie.replacementSource,De,be)&&(at.uploaded=!1,at.upload(ie.context));for(let rt in at.instancesPerModel){const _t=at.instancesPerModel[rt];_t.features.length>0&&(rt=Pt.evaluate(_t.features[0].feature,{}));const xt=Ie.getModel(rt,be);if(xt&&xt.uploaded)for(const mt of xt.nodes)Oh(ie,de,mt,_t,gt,Je,sa)}}}(d,n,o,f,B.type==="vector"?o.scope:""),void D();if(!B.loaded())return;if(B.type==="batched-model")return function(ie,ae,de,fe){de.resetLayerRenderingStats(ie);const be=ie.context,Ee=ie.transform,we=ie.style.fog,Ie=ie.shadowRenderer;if(Ee.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Ee.projection.name} projection is not yet implemented`);const Re=ie.transform.getFreeCameraOptions().position,Be=a.a6.vec3.scale([],[Re.x,Re.y,Re.z],ie.transform.worldSize),Ne=a.a6.vec3.negate([],Be),De=a.a6.mat4.identity([]),Je=a.de(Ee.center.lat,Ee.zoom),at=a.a6.mat4.fromScaling([],[1,1,1/Je]);a.a6.mat4.translate(De,De,Ne);const vt=de.paint.get("model-opacity"),St=new rn(be.gl.LEQUAL,rn.ReadWrite,ie.depthRangeFor3D),Pt=new rn(be.gl.LEQUAL,rn.ReadOnly,ie.depthRangeFor3D),He=new a.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),gt=ie.renderPass==="shadow",rt=gt&&Ie?Ie.getCurrentCascadeFrustum():Ee.getFrustum(Ee.scaleZoom(Ee.worldSize)),_t=de.paint.get("model-front-cutoff"),xt=_t[2]<1,mt=Cr(ie,de.paint.get("model-cutoff-fade-range")),Ot=de.getLayerRenderingStats();(function(Kt,on,Zt,un){const Ut=Kt.terrain?Kt.terrain.exaggeration():0,hn=Kt.transform.zoom;for(const Cn of un){const Hn=on.getTile(Cn).getBucket(Zt);Hn&&(Kt.conflationActive&&Hn.updateReplacement(Cn,Kt.replacementSource),Hn.evaluateScale(Kt,Zt),Kt.terrain&&Ut>0&&Hn.elevationUpdate(Kt.terrain,Ut,Cn,Zt.source),Hn.needsReEvaluation(Kt,hn,Zt)&&Hn.evaluate(Zt))}})(ie,ae,de,fe),function(){let Kt,on,Zt;xt?(Kt=fe.length-1,on=-1,Zt=-1):(Kt=0,on=fe.length,Zt=1);const un=new Float64Array(16),Ut=a.a6.vec3.create(),hn=new a.P(0,0);for(let Cn=Kt;Cn!==on;Cn+=Zt){const Hn=fe[Cn],Di=ae.getTile(Hn).getBucket(de);if(!Di||!Di.uploaded)continue;let ti=!1;Ie&&(ti=Ie.getMaxCascadeForTile(Hn.toUnwrapped())===0);const Bi=Ee.calculatePosMatrix(Hn.toUnwrapped(),Ee.worldSize),di=Di.modelTraits;!gt&&xt&&(a.a6.mat4.invert(un,Bi),a.a6.vec3.transformMat4(Ut,Be,un),hn.x=Ut[0],hn.y=Ut[1]);const Oi=[];for(const kn of Di.getNodesInfo()){if(kn.hiddenByReplacement||!kn.node.meshes)continue;const Pi=kn.node;let Ti=0;ie.terrain&&Pi.elevation&&(Ti=Pi.elevation*ie.terrain.exaggeration());const mi=(()=>{const ur=kn.aabb;return He.min=[...ur.min],He.max=[...ur.max],He.min[2]+=Ti,He.max[2]+=Ti,a.a6.vec3.transformMat4(He.min,He.min,Bi),a.a6.vec3.transformMat4(He.max,He.max,Bi),He})(),qi=kn.evaluatedScale;if(qi[0]<=1&&qi[1]<=1&&qi[2]<=1&&mi.intersects(rt)===0)continue;if(!gt&&xt){const ur=.16666666666666666;kn.cameraCollisionOpacity=Be[0]>mi.min[0]&&Be[0]<mi.max[0]&&Be[1]>mi.min[1]&&Be[1]<mi.max[1]&&Be[2]*Je<mi.max[2]&&Pi.footprint&&a.bv(hn,Pi.footprint)?Math.max(kn.cameraCollisionOpacity-ur,0):Math.min(1,kn.cameraCollisionOpacity+ur)}const Br=[...Bi],Bo=Pi.anchor?Pi.anchor[0]:0,aa=Pi.anchor?Pi.anchor[1]:0;a.a6.mat4.translate(Br,Br,[Bo*(qi[0]-1),aa*(qi[1]-1),Ti]),a.a6.vec3.exactEquals(qi,a.dh)||a.a6.mat4.scale(Br,Br,qi);const Jr=a.a6.mat4.multiply([],Br,Pi.matrix),Kn=a.a6.mat4.multiply([],Ee.expandedFarZProjMatrix,Jr),$n=a.a6.mat4.multiply([],Ee.expandedFarZProjMatrix,Br),fi=a.a6.vec4.transformMat4([],[Bo,aa,Ti,1],Kn)[2];Pi.hidden=!1;let Ni=vt;gt||(xt&&(Ni*=kn.cameraCollisionOpacity,Ni*=Nh(Br,Ee,kn.aabb,_t)),Ni*=ei(mt,fi)),Ni!==0?Oi.push({nodeInfo:kn,depth:fi,opacity:Ni,wvpForNode:Kn,wvpForTile:$n,nodeModelMatrix:Jr,tileModelMatrix:Br}):Pi.hidden=!0}gt||Oi.sort((kn,Pi)=>!xt||kn.opacity===1&&Pi.opacity===1?kn.depth<Pi.depth?-1:1:kn.opacity===1?-1:Pi.opacity===1?1:kn.depth>Pi.depth?-1:1);for(const kn of Oi){const Pi=kn.nodeInfo,Ti=Pi.node;let mi=a.a6.mat4.multiply([],at,kn.tileModelMatrix);a.a6.mat4.multiply(mi,De,mi);const qi=a.a6.mat4.invert([],mi);a.a6.mat4.transpose(qi,qi),a.a6.mat4.scale(qi,qi,Cs),mi=a.a6.mat4.multiply(mi,mi,Ti.matrix);const Br=ie.renderPass==="light-beam",Bo=di&a.dj.HasMapboxMeshFeatures,aa=Bo?0:Pi.evaluatedRMEA[0][2];for(let Jr=0;Jr<Ti.meshes.length;++Jr){const Kn=Ti.meshes[Jr],$n=Jr===Ti.lightMeshIndex;let fi=kn.wvpForNode;if($n){if(!Br&&!ie.terrain&&ie.shadowRenderer){ie.currentLayer<ie.firstLightBeamLayer&&(ie.firstLightBeamLayer=ie.currentLayer);continue}fi=kn.wvpForTile}else if(Br)continue;const Ni={defines:[]},ur=[];if(!gt&&Ie&&(Ie.useNormalOffset=!!Kn.normalBuffer),Hs(Ni.defines,ur,Kn,ie,de.lut),Bo||Ni.defines.push("DIFFUSE_SHADED"),ti&&Ni.defines.push("SHADOWS_SINGLE_CASCADE"),Ot&&(gt?Ot.numRenderedVerticesInShadowPass+=Kn.vertexArray.length:Ot.numRenderedVerticesInTransparentPass+=Kn.vertexArray.length),gt){Fc(Kn,kn.nodeModelMatrix,ie,de);continue}let ji=null;if(we){const Ba=ch(kn.nodeModelMatrix,ie.transform);if(ji=new Float32Array(Ba),Ee.projection.name!=="globe"){const Io=Kn.aabb.min,Ql=Kn.aabb.max,[ua,_i]=we.getOpacityForBounds(Ba,Io[0],Io[1],Ql[0],Ql[1]);Ni.overrideFog=ua>=Tt||_i>=Tt}}const as=Kn.material;let xl;as.occlusionTexture&&as.occlusionTexture.offsetScale&&(xl=as.occlusionTexture.offsetScale,Ni.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const wo=ie.getOrCreateProgram("model",Ni);!gt&&Ie&&Ie.setupShadowsFromMatrix(kn.tileModelMatrix,wo,Ie.useNormalOffset),ie.uploadCommonUniforms(be,wo,null,ji);const Eo=as.pbrMetallicRoughness;Eo.metallicFactor=.9,Eo.roughnessFactor=.5;const la=ll(new Float32Array(fi),new Float32Array(mi),new Float32Array(qi),new Float32Array(Ti.matrix),ie,kn.opacity,Eo.baseColorFactor.toRenderColor(null),as.emissiveFactor,Eo.metallicFactor,Eo.roughnessFactor,as,aa,de,[0,0,0],xl);!$n&&(Pi.hasTranslucentParts||kn.opacity<1)&&wo.draw(ie,be.gl.TRIANGLES,St,xn.disabled,An.disabled,mn.backCCW,la,de.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,de.paint,ie.transform.zoom,void 0,ur),wo.draw(ie,be.gl.TRIANGLES,$n?Pt:St,xn.disabled,$n||kn.opacity<1||Pi.hasTranslucentParts?An.alphaBlended:An.unblended,mn.backCCW,la,de.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,de.paint,ie.transform.zoom,void 0,ur)}}}}()}(d,n,o,f),void D();if(B.type!=="model")return;const F=B.getModels(),U=[],q=d.transform.getFreeCameraOptions().position,$=a.a6.vec3.scale([],[q.x,q.y,q.z],d.transform.worldSize);a.a6.vec3.negate($,$);const ee=[],K=[];let re=0;for(const ie of F){const ae=o.paint.get("model-rotation").constantOr(null),de=o.paint.get("model-scale").constantOr(null),fe=o.paint.get("model-translation").constantOr(null);ie.computeModelMatrix(d,ae,de,fe,!0,!0,!1);const be=a.a6.mat4.identity([]),Ee=a.de(ie.position.lat,d.transform.zoom),we=a.a6.mat4.fromScaling([],[1,1,1/Ee]);a.a6.mat4.translate(be,be,$),U.push({zScaleMatrix:we,negCameraPosMatrix:be});for(const Ie of ie.nodes)fc(d.transform,Ie,ie.matrix,d.transform.expandedFarZProjMatrix,re,ee,K);re++}if(ee.sort((ie,ae)=>ae.depth-ie.depth),d.renderPass!=="shadow"){if(_===1)for(const ie of K)Wl(ie,d,o,U[ie.modelIndex],xn.disabled,d.colorModeForRenderPass());else{for(const ie of K)Wl(ie,d,o,U[ie.modelIndex],xn.disabled,An.disabled);for(const ie of K)Wl(ie,d,o,U[ie.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const ie of ee)Wl(ie,d,o,U[ie.modelIndex],xn.disabled,d.colorModeForRenderPass());D()}else{for(const ie of K)Fc(ie.mesh,ie.nodeModelMatrix,d,o);for(const ie of ee)Fc(ie.mesh,ie.nodeModelMatrix,d,o);D()}}},za={model:function(d,n,o){const f=n.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,f.type==="vector"?d.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const _=f.getModels();for(const v of _)v.upload(o.context)},raster:function(d,n,o){const f=n.getSource();if(!(f instanceof Dr&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const v=d.paint.get("raster-array-band")||f.getInitialBand(_);if(v==null)return;const b=n.getIds().map(P=>n.getTileByID(P));for(const P of b)P.updateNeeded(_,v)&&f.prepareTile(P,_,v)},"raster-particle":function(d,n,o){const f=n.getSource();if(!(f instanceof Dr&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const v=d.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(v==null)return;const b=n.getIds().map(P=>n.getTileByID(P));for(const P of b)P.updateNeeded(_,v)&&f.prepareTile(P,_,v)}};class gl{constructor(n,o,f,_,v){this.context=new lc(n,o),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=a.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const b=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const D of b)this._debugParams.enabledLayers[D]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of b)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new Ou(v),this.setup(),this.numSublayers=ns.maxUnderzooming+ns.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Hu(this),this._wireframeDebugCache=new kc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const P=new a.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,P,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_}updateTerrain(n,o){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ul(this,n));const _=this._terrain;this.transform.elevation=f?_:null,_.update(n,this.transform,o),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(n){const o=n.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=o.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const v=f+.78*(_-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Ul(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,o){if(this.width=n*a.q.devicePixelRatio,this.height=o*a.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const n=this.context,o=new a.a$;o.emplaceBack(0,0),o.emplaceBack(a.ab,0),o.emplaceBack(0,a.ab),o.emplaceBack(a.ab,a.ab),this.tileExtentBuffer=n.createVertexBuffer(o,a.b1.members),this.tileExtentSegments=a.b2.simpleSegment(0,0,4,2);const f=new a.a$;f.emplaceBack(0,0),f.emplaceBack(a.ab,0),f.emplaceBack(0,a.ab),f.emplaceBack(a.ab,a.ab),this.debugBuffer=n.createVertexBuffer(f,a.b1.members),this.debugSegments=a.b2.simpleSegment(0,0,4,5);const _=new a.a$;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,a.b1.members),this.viewportSegments=a.b2.simpleSegment(0,0,4,2);const v=new a.aO;v.emplaceBack(0,0,0,0),v.emplaceBack(a.ab,0,a.ab,0),v.emplaceBack(0,a.ab,0,a.ab),v.emplaceBack(a.ab,a.ab,a.ab,a.ab),this.mercatorBoundsBuffer=n.createVertexBuffer(v,a.b4.members),this.mercatorBoundsSegments=a.b2.simpleSegment(0,0,4,2);const b=new a.aP;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(b);const P=new a.b0;for(const B of[0,1,3,2,0])P.emplaceBack(B);this.debugIndexBuffer=n.createIndexBuffer(P),this.emptyTexture=new a.T(n,new a.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=a.a6.mat4.create();const D=this.context.gl;this.stencilClearMode=new xn({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,rn.disabled,this.stencilClearMode,An.disabled,mn.disabled,il(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,o,f){if(!o||this.currentStencilSource===o.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const D of f)if(this._tileClippingMaskIDs[D.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=o.id;const _=this.context,v=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(An.disabled),_.setDepthMode(rn.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of f){const D=o.getTile(P),B=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=this.getTileBoundsBuffers(D);b.draw(this,v.TRIANGLES,rn.disabled,new xn({func:v.ALWAYS,mask:0},B,255,v.KEEP,v.KEEP,v.REPLACE),An.disabled,mn.disabled,il(P.projMatrix),"$clipping",F,U,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,o=this.context.gl;return new xn({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const o=this.context.gl;return new xn({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(n){const o=this.context.gl,f=n.sort((b,P)=>P.overscaledZ-b.overscaledZ),_=f[f.length-1].overscaledZ,v=f[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const b={};for(let P=0;P<v;P++)b[P+_]=new xn({func:o.GEQUAL,mask:255},P+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=v,[b,f]}return[{[_]:xn.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new An([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new a.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?An.unblended:An.alphaBlended}colorModeForDrapableLayerRenderPass(n){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new An([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new a.bA(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,o,f,_=!1){if(this.depthOcclusion)return new rn(this.context.gl.GREATER,rn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return rn.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new rn(f||this.context.gl.LEQUAL,o,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,o=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),v=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&f!==0&&(this.depthFBO=new Nc(this.context,o,f,!1,"texture"),this.depthTexture=new a.T(this.context,{width:o,height:f,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),n.bindTexture(n.TEXTURE_2D,v),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,o,f,0,0,o,f,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,o)=>n+o/this._fpsHistory.length,0))}render(n,o){const f=a.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=o;const _=this.style._mergedLayers,v=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Ne=>{const De=_[Ne];return!(De.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[De.type]});let b=!1,P=!1;for(const Ne of v){const De=_[Ne];De.type==="circle"&&(b=!0),De.type==="symbol"&&(De.hasInitialOcclusionOpacityProperties?P=!0:b=!0)}const D=v.map(Ne=>_[Ne]),B=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(a.q.now()),this.imageManager.beginFrame();let F=0,U=!1;for(const Ne in B){const De=B[Ne];De.used&&(De.prepare(this.context),De.getSource().usedInConflation&&++F)}let q=!1;for(const Ne of D)Ne.isHidden(this.transform.zoom)||(Ne.type==="clip"&&(q=!0),this.prepareLayer(Ne));const $={},ee={},K={},re={},ie={};for(const Ne in B){const De=B[Ne];$[Ne]=De.getVisibleCoordinates(),ee[Ne]=$[Ne].slice().reverse(),K[Ne]=De.getVisibleCoordinates(!0).reverse(),re[Ne]=De.getShadowCasterCoordinates(),ie[Ne]=De.sortCoordinatesByDistance($[Ne])}const ae=Ne=>{const De=this.style.getLayerSourceCache(Ne);return De&&De.used?De.getSource():null};if(F||q||this._clippingActiveLastFrame){const Ne=[],De=[];let Je=0;for(const at of D)this.isSourceForClippingOrConflation(at,ae(at))&&(Ne.push(at),De.push(Je)),Je++;if(Ne&&(q||Ne.length>1)||this._clippingActiveLastFrame){q=!1;const at=[];for(let vt=0;vt<Ne.length;vt++){const St=Ne[vt],Pt=De[vt],He=this.style.getLayerSourceCache(St);if(!He||!He.used||!He.getSource().usedInConflation&&St.type!=="clip")continue;let gt=a.dn,rt=a.bt.None;const _t=[];let xt=!0;if(St.type==="clip"){gt=Pt;for(const mt of St.layout.get("clip-layer-types"))rt|=mt==="model"?a.bt.Model:mt==="symbol"?a.bt.Symbol:a.bt.FillExtrusion;for(const mt of St.layout.get("clip-layer-scope"))_t.push(mt);St.isHidden(this.transform.zoom)?xt=!1:q=!0}xt&&at.push({layer:St.fqid,cache:He,order:gt,clipMask:rt,clipScope:_t})}this.replacementSource.setSources(at),U=!0}}this._clippingActiveLastFrame=q,U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ne=0;Ne<D.length;Ne++){const De=D[Ne],Je=De.cutoffRange();if(this.longestCutoffRange=Math.max(Je,this.longestCutoffRange),Je>0){const at=ae(De);at&&(this.minCutoffZoom=Math.max(at.minzoom,this.minCutoffZoom)),De.minzoom&&(this.minCutoffZoom=Math.max(De.minzoom,this.minCutoffZoom))}De.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ne),this._lastOcclusionLayer=Ne)}const de=this.style&&this.style.fog;de?(this._fogVisible=de.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=de.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0);const fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ne in B)for(const De of $[Ne]){let Je={min:0,max:0};this.terrain&&(Je=this.terrain.getMinMaxForTile(De)||Je),fe.addShadowReceiver(De.toUnwrapped(),Je.min,Je.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new pl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!no.has(this.context.gl))return;this.renderPass="offscreen";for(const Ne of D){const De=n.getLayerSourceCache(Ne);if(!Ne.hasOffscreenPass()||Ne.isHidden(this.transform.zoom))continue;const Je=De?ee[De.id]:void 0;(Ne.type==="custom"||Ne.type==="raster"||Ne.type==="raster-particle"||Ne.isSky()||Je&&Je.length)&&this.renderLayer(this,De,Ne,Je)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,re)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const be=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ee=(()=>{if(o.showOverdrawInspector)return a.bA.black;const Ne=this.style.fog;if(Ne&&this.transform.projection.supportsFog){const De=this.style.getLut(Ne.scope);if(!be){const Je=Ne.properties.get("color").toRenderColor(De).toArray01();return new a.bA(...Je)}if(be){const Je=Ne.properties.get("space-color").toRenderColor(De).toArray01();return new a.bA(...Je)}}return a.bA.transparent})();if(this.context.clear({color:Ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const Ne=D[this.currentLayer],De=n.getLayerSourceCache(Ne);if(Ne.isSky())continue;const Je=De?(Ne.is3D()?ie:ee)[De.id]:void 0;this._renderTileClippingMasks(Ne,De,Je),this.renderLayer(this,De,Ne,Je)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const Ne=D[this.currentLayer],De=n.getLayerSourceCache(Ne);Ne.isSky()&&this.renderLayer(this,De,Ne,De?ee[De.id]:void 0)}function we(Ne,De){let Je;return De&&(Je=(Ne.type==="symbol"?K:Ne.is3D()?ie:ee)[De.id]),Je}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const Ne=D[this.currentLayer];if(Ne.type==="raster"||Ne.type==="raster-particle"){const De=n.getLayerSourceCache(Ne);this.renderLayer(this,De,Ne,we(Ne,De))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ie=0;fe&&(Ie=fe.getShadowCastingLayerCount());let Re=!1,Be=-1;for(let Ne=0;Ne<v.length;++Ne){const De=D[Ne];De.isHidden(this.transform.zoom)||De.is3D()&&(Be=Ne)}for(P&&Be===-1&&(b=!0);this.currentLayer<v.length;){const Ne=D[this.currentLayer],De=n.getLayerSourceCache(Ne);if(Ne.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ne)){if(Ne.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(b&&!Re&&this.terrain&&!this.transform.isOrthographic&&(Re=!0,this.blitDepth()),P&&Be!==-1&&this.currentLayer===Be+1&&!this.transform.isOrthographic&&this.blitDepth(),Ne.is3D()||this.terrain||this._renderTileClippingMasks(Ne,De,De?$[De.id]:void 0),this.renderLayer(this,De,Ne,we(Ne,De)),!this.terrain&&fe&&Ie>0&&Ne.hasShadowPass()&&--Ie==0&&(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Je=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Je;this.currentLayer++){const at=D[this.currentLayer];if(!at.hasLightBeamPass())continue;const vt=n.getLayerSourceCache(at);this.renderLayer(this,vt,at,vt?ee[vt.id]:void 0)}this.currentLayer=Je,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Je=this.currentLayer;this.depthOcclusion=!0;for(const at of this.layersWithOcclusionOpacity){this.currentLayer=at;const vt=D[this.currentLayer],St=n.getLayerSourceCache(vt),Pt=St?ee[St.id]:void 0;vt.is3D()||this.terrain||this._renderTileClippingMasks(vt,St,St?$[St.id]:void 0),this.renderLayer(this,St,vt,Pt)}this.depthOcclusion=!1,this.currentLayer=Je,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ne=null;D.forEach(De=>{const Je=n.getLayerSourceCache(De);Je&&!De.isHidden(this.transform.zoom)&&Je.getVisibleCoordinates().length&&(!Ne||Ne.getSource().maxzoom<Je.getSource().maxzoom)&&(Ne=Je)}),Ne&&this.options.showTileBoundaries&&pc.debug(this,Ne,Ne.getVisibleCoordinates(),a.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&pc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ne){const De=Ne.transform.padding;$e(Ne,Ne.transform.height-(De.top||0),3,vo),$e(Ne,De.bottom||0,3,Na),Zl(Ne,De.left||0,3,It),Zl(Ne,Ne.transform.width-(De.right||0),3,Ht);const Je=Ne.transform.centerPoint;(function(at,vt,St,Pt){ra(at,vt-1,St-10,2,20,Pt),ra(at,vt-10,St-1,20,2,Pt)})(Ne,Je.x,Ne.transform.height-Je.y,zo)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:o}=this.transform.projection,f=!o||!o.includes(n.type);if(za[n.type]&&(f||this.terrain&&n.type==="custom")){const _=this.style.getLayerSourceCache(n);za[n.type](n,_,this)}this.gpuTimingEnd()}renderLayer(n,o,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(f.type)&&(!n.terrain||f.type!=="custom")||f.type==="clip"||pc[f.type](n,o,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(o.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,o=this.context.gl,f=o.createQuery();this.deferredRenderGpuTimeQueries.push(f),o.beginQuery(n.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const o={};for(const f in n){const _=n[f],v=this.context.extTimerQuery,b=v.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(_.query),o[f]=b}return o}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let f=0;for(const _ of n)f+=o.getQueryParameter(_,o.QUERY_RESULT)/1e6,o.deleteQuery(_);return f}translatePosMatrix(n,o,f,_,v){if(!f[0]&&!f[1])return n;const b=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){const B=Math.sin(b),F=Math.cos(b);f=[f[0]*F-f[1]*B,f[0]*B+f[1]*F]}const P=[v?f[0]:a.ak(o,f[0],this.transform.zoom),v?f[1]:a.ak(o,f[1],this.transform.zoom),0],D=new Float32Array(16);return a.a6.mat4.translate(D,n,P),D}saveTileTexture(n){const o=n.size[0],f=this._tileTextures[o];f?f.push(n):this._tileTextures[o]=[n]}getTileTexture(n){const o=this._tileTextures[n];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,o,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||_||o!==void 0&&!o||v.push("FOG","FOG_DITHERING"),_&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(n,o){this.cache=this.cache||{};const f=o&&o.defines||[],_=o&&o.config,v=this.currentGlobalDefines(n,o&&o.overrideFog,o&&o.overrideRtt).concat(f),b=Ts.cacheKey(Ea[n],n,v,_);return this.cache[b]||(this.cache[b]=new Ts(this.context,n,Ea[n],_,No[n],v)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,o){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const v=((b,P,D)=>{const B=b.properties.get("direction"),F=b.properties.get("color").toRenderColor(D.getLut(b.scope)).toArray01(),U=b.properties.get("intensity"),q=P.properties.get("color").toRenderColor(D.getLut(P.scope)).toArray01(),$=P.properties.get("intensity"),ee=[B.x,B.y,B.z],K=a.cH(q,$),re=a.cH(F,U);return{u_lighting_ambient_color:K,u_lighting_directional_dir:ee,u_lighting_directional_color:re,u_ground_radiance:Tu(ee,re,K)}})(f,_,this.style);o.setLightsUniformValues(n,v)}}}uploadCommonUniforms(n,o,f,_,v){if(this.uploadCommonLightUniforms(n,o),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const P=b.getOpacity(this.transform.pitch),D=((B,F,U,q,$,ee,K,re,ie,ae,de,fe)=>{const be=B.transform,Ee=F.properties.get("color").toRenderColor(B.style.getLut(F.scope)).toArray01();Ee[3]=q;const we=B.frameCounter/1e3%1,[Ie,Re]=F.properties.get("vertical-range");return{u_fog_matrix:U?be.calculateFogTileMatrix(U):fe||B.identityMat,u_fog_range:F.getFovAdjustedRange(be._fov),u_fog_color:Ee,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Re),Re],u_fog_temporal_offset:we,u_frustum_tl:$,u_frustum_tr:ee,u_frustum_br:K,u_frustum_bl:re,u_globe_pos:ie,u_globe_radius:ae,u_viewport:de,u_globe_transition:a.a9(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,b,f,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.q.devicePixelRatio,this.transform.height*a.q.devicePixelRatio],_);o.setFogUniformValues(n,D)}v&&o.setCutoffUniformValues(n,v.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,o=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)o[_.key]=n[_.key]||new As(_,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,o){return!(!n.is3D()||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[n.key];return o||(this._cachedTileFogOpacities[n.key]=o=this.style.fog.getOpacityForTile(n)),o[0]>=Tt||o[1]>=Tt}setupDepthForOcclusion(n,o,f){const _=this.context,v=_.gl,b=!!f;var P;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(v.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),_.activeTexture.set(v.TEXTURE0),b||o.setTerrainUniformValues(_,f)}}function Fa(d,n){let o=!1,f=null;const _=()=>{f=null,o&&(d(),f=setTimeout(_,n),o=!1)};return()=>(o=!0,f||_(),f)}class Bc{constructor(n){this._hashName=n&&encodeURIComponent(n),a.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fa(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const o=mc(n);if(this._hashName){const f=this._hashName;let _=!1;const v=location.hash.slice(1).split("&").map(b=>{const P=b.split("=")[0];return P===f?(_=!0,`${P}=${o}`):b}).filter(b=>b);return _||v.push(`${f}=${o}`),`#${v.join("&")}`}return`#${o}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(o=f)}),(o&&o[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(f=>isNaN(f))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(o[3]||0):n.getBearing();return n.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:f,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function mc(d,n){const o=d.getCenter(),f=Math.round(100*d.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),b=Math.round(o.lng*v)/v,P=Math.round(o.lat*v)/v,D=d.getBearing(),B=d.getPitch();let F=n?`/${b}/${P}/${f}`:`${f}/${P}/${b}`;return(D||B)&&(F+="/"+Math.round(10*D)/10),B&&(F+=`/${Math.round(B)}`),F}const Nu={linearity:.3,easing:a.dp(0,0,.3,1)},dh=a.l({deceleration:2500,maxSpeed:1400},Nu),fh=a.l({deceleration:20,maxSpeed:1400},Nu),e=a.l({deceleration:1e3,maxSpeed:360},Nu),r=a.l({deceleration:1e3,maxSpeed:90},Nu);class u{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,o=a.q.now();for(;n.length>0&&o-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)o.zoom+=v.zoomDelta||0,o.bearing+=v.bearingDelta||0,o.pitch+=v.pitchDelta||0,v.panDelta&&o.pan._add(v.panDelta),v.around&&(o.around=v.around),v.pinchAround&&(o.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(o.pan.mag()){const v=w(o.pan.mag(),f,a.l({},dh,n||{}));_.offset=o.pan.mult(v.amount/o.pan.mag()),_.center=this._map.transform.center,g(_,v)}if(o.zoom){const v=w(o.zoom,f,fh);_.zoom=this._map.transform.zoom+v.amount,g(_,v)}if(o.bearing){const v=w(o.bearing,f,e);_.bearing=this._map.transform.bearing+a.ap(v.amount,-179,179),g(_,v)}if(o.pitch){const v=w(o.pitch,f,r);_.pitch=this._map.transform.pitch+v.amount,g(_,v)}if(_.zoom||_.bearing){const v=o.pinchAround===void 0?o.around:o.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function g(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function w(d,n,o){const{maxSpeed:f,linearity:_,deceleration:v}=o,b=a.ap(d*_/(n/1e3),-f,f),P=Math.abs(b)/(v*_);return{easing:o.easing,duration:1e3*P,amount:b*(P/2)}}class O extends a.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f,_={}){const v=ft(o.getCanvasContainer(),f),b=o.unproject(v);super(n,a.l({point:v,lngLat:b,originalEvent:f},_)),this._defaultPrevented=!1,this.target=o}}class H extends a.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f){const _=n==="touchend"?f.changedTouches:f.touches,v=et(o.getCanvasContainer(),_),b=v.map(D=>o.unproject(D)),P=v.reduce((D,B,F,U)=>D.add(B.div(U.length)),new a.P(0,0));super(n,{points:v,point:P,lngLats:b,lngLat:o.unproject(P),originalEvent:f}),this._defaultPrevented=!1}}class Q extends a.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class ye{constructor(n,o){this._map=n,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Q(this._map,n))}mousedown(n,o){return this._mousedownPos=o,this._firePreventable(new O(n.type,this._map,n))}mouseup(n){this._map.fire(new O(n.type,this._map,n))}preclick(n){const o=a.l({},n);o.type="preclick",this._map.fire(new O(o.type,this._map,o))}click(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(n),this._map.fire(new O(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new O(n.type,this._map,n))}mouseover(n){this._map.fire(new O(n.type,this._map,n))}mouseout(n){this._map.fire(new O(n.type,this._map,n))}touchstart(n){return this._firePreventable(new H(n.type,this._map,n))}touchmove(n){this._map.fire(new H(n.type,this._map,n))}touchend(n){this._map.fire(new H(n.type,this._map,n))}touchcancel(n){this._map.fire(new H(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ue{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new O(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new O("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new O(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ct{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,o){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ae(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(n,o){if(!this._active)return;const f=o,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=ve("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(_.x,f.x),P=Math.max(_.x,f.x),D=Math.min(_.y,f.y),B=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${D}px)`,this._box.style.width=P-b+"px",this._box.style.height=B-D+"px")})}mouseupWindow(n,o){if(!this._active)return;const f=this._startPos,_=o;if(f&&n.button===0){if(this.reset(),ze(),f.x!==_.x||f.y!==_.y)return this._map.fire(new a.x("boxzoomend",{originalEvent:n})),{cameraAnimation:v=>v.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),pt(),delete this._startPos,delete this._lastPos}_fireEvent(n,o){return this._map.fire(new a.x(n,{originalEvent:o}))}}function yt(d,n){const o={};for(let f=0;f<d.length;f++)o[d[f].identifier]=n[f];return o}class Ft{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,o,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const v=new a.P(0,0);for(const b of _)v._add(b);return v.div(_.length)}(o),this.touches=yt(f,o)))}touchmove(n,o,f){if(this.aborted||!this.centroid)return;const _=yt(f,o);for(const v in this.touches){const b=_[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(n,o,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class sn{constructor(n){this.singleTap=new Ft(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,o,f){this.singleTap.touchstart(n,o,f)}touchmove(n,o,f){this.singleTap.touchmove(n,o,f)}touchend(n,o,f){const _=this.singleTap.touchend(n,o,f);if(_){const v=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(v&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Tn{constructor(){this._zoomIn=new sn({numTouches:1,numTaps:2}),this._zoomOut=new sn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,o,f){this._zoomIn.touchstart(n,o,f),this._zoomOut.touchstart(n,o,f)}touchmove(n,o,f){this._zoomIn.touchmove(n,o,f),this._zoomOut.touchmove(n,o,f)}touchend(n,o,f){const _=this._zoomIn.touchend(n,o,f),v=this._zoomOut.touchend(n,o,f);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:n})}):v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Pn={0:1,2:2};class Ai{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,o){return!1}_move(n,o){return{}}mousedown(n,o){if(this._lastPoint)return;const f=ht(n);this._correctButton(n,f)&&(this._lastPoint=o,this._eventButton=f)}mousemoveWindow(n,o){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&function(_,v){const b=Pn[v];return _.buttons===void 0||(_.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(f,o)}}mouseupWindow(n){this._lastPoint&&ht(n)===this._eventButton&&(this._moved&&ze(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class er extends Ai{mousedown(n,o){super.mousedown(n,o),this._lastPoint&&(this._active=!0)}_correctButton(n,o){return o===0&&!n.ctrlKey}_move(n,o){return{around:o,panDelta:o.sub(n)}}}class Ds extends Ai{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=.8*(o.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class oa extends Ai{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=-.5*(o.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class gc{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),a.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(n,o,f){return this._calculateTransform(n,o,f)}touchmove(n,o,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!a.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,o,f)}}touchend(n,o,f){this._calculateTransform(n,o,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,o,f){f.length>0&&(this._active=!0);const _=yt(f,o),v=new a.P(0,0),b=new a.P(0,0);let P=0;for(const B in _){const F=_[B],U=this._touches[B];U&&(v._add(F),b._add(F.sub(U)),P++,_[B]=F)}if(this._touches=_,P<this._minTouches||!b.mag())return;const D=b.div(P);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(P),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ve("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class $l{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,o,f){return{}}touchstart(n,o,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([o[0],o[1]]))}touchmove(n,o,f){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[v,b]=_,P=_l(f,o,v),D=_l(f,o,b);if(!P||!D)return;const B=this._aroundCenter?null:P.add(D).div(2);return this._move([P,D],B,n)}touchend(n,o,f){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,b=_l(f,o,_),P=_l(f,o,v);b&&P||(this._active&&ze(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _l(d,n,o){for(let f=0;f<d.length;f++)if(d[f].identifier===o)return n[f]}function pd(d,n){return Math.log(d/n)/Math.LN2}class If extends $l{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,o){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(pd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pd(this._distance,f),pinchAround:o}}}function md(d,n){return 180*d.angleWith(n)/Math.PI}class Tf extends $l{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,o){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:md(this._vector,f),pinchAround:o}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const o=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=md(n,f);return Math.abs(_)<o}}function zh(d){return Math.abs(d.y)>Math.abs(d.x)}class Sf extends $l{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,zh(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,o,f){const _=this._lastPoints;if(!_)return;const v=n[0].sub(_[0]),b=n[1].sub(_[1]);return this._map._cooperativeGestures&&!a.dq()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(n,o,f){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,v=o.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const b=n.y>0==o.y>0;return zh(n)&&zh(o)&&b}}const Cf={panStep:100,bearingStep:15,pitchStep:10};class Mf{constructor(){const n=Cf;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let o=0,f=0,_=0,v=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),v=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),v=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:P=>{const D=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Af,zoom:o?Math.round(D)+o*(n.shiftKey?2:1):D,bearing:P.getBearing()+f*this._bearingStep,pitch:P.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:P.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Af(d){return d*(2-d)}const gd=4.000244140625,Yp=1/450;class Jp{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Yp,a.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||a.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=a.q.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,o!==0&&o%gd==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=ft(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>gd?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&F!==0&&(F=1/F);const U=o(),q=Math.pow(2,U),$=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*F))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:o(),_=this._startZoom,v=this._easing;let b,P=!1;if(this._type==="wheel"&&_&&v){const B=Math.min((a.q.now()-this._lastWheelEventTime)/200,1),F=v(B);b=a.aa(_,f,F),B<1?this._frameId||(this._frameId=!0):P=!0}else b=f,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=b-o();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let o=a.dr;if(this._prevEase){const f=this._prevEase,_=(a.q.now()-f.start)/f.duration,v=f.easing(_+.01)-f.easing(_),b=.27/Math.sqrt(v*v+1e-4)*.01,P=Math.sqrt(.0729-b*b);o=a.dp(b,P,.25,1)}return this._prevEase={start:a.q.now(),duration:n,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ve("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class lr{constructor(n,o){this._clickZoom=n,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,o){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(o)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kp{constructor(){this._tap=new sn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,o,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=o[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,o,f))}touchmove(n,o,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=o[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(n,o,f)}touchend(n,o,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,o,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qp{constructor(n,o,f){this._el=n,this._mousePan=o,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ph{constructor(n,o,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lf{constructor(n,o,f,_){this._el=n,this._touchZoom=o,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vc=d=>d.zoom||d.drag||d.pitch||d.rotate;class Fh extends a.x{}class Xl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,o){const f=a.a6.vec3.sub([],o,n);this.radius=a.a6.vec3.length(f[2]<0?a.a6.vec3.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){a.a6.vec3.div(n,n,this.constants),a.a6.vec3.normalize(n,n),a.a6.vec3.mul(n,n,this.constants);const o=a.a6.vec3.scale([],n,this.radius);if(o[2]>0){const f=a.a6.vec3.scale([],[0,0,1],a.a6.vec3.dot(o,[0,0,1])),_=a.a6.vec3.scale([],a.a6.vec3.normalize([],[o[0],o[1],0]),this.radius),v=a.a6.vec3.add([],o,a.a6.vec3.scale([],a.a6.vec3.sub([],a.a6.vec3.add([],_,f),o),2));o[0]=v[0],o[1]=v[1]}return o}}function _c(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Yr{constructor(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new u(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),a.aJ(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,b]of this._listeners){const P=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(v,P,b)}}destroy(){for(const[n,o,f]of this._listeners){const _=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(o,_,f)}}_addDefaultHandlers(n){const o=this._map,f=o.getCanvasContainer();this._add("mapEvent",new ye(o,n));const _=o.boxZoom=new ct(o,n);this._add("boxZoom",_);const v=new Tn,b=new Pf;o.doubleClickZoom=new lr(b,v),this._add("tapZoom",v),this._add("clickZoom",b);const P=new Kp;this._add("tapDragZoom",P);const D=o.touchPitch=new Sf(o);this._add("touchPitch",D);const B=new Ds(n),F=new oa(n);o.dragRotate=new ph(n,B,F),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const U=new er(n),q=new gc(o,n);o.dragPan=new Qp(f,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);const $=new Tf,ee=new If;o.touchZoomRotate=new Lf(f,ee,$,P),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ue(o));const K=o.scrollZoom=new Jp(o,this);this._add("scrollZoom",K,["mousePan"]);const re=o.keyboard=new Mf;this._add("keyboard",re);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ie]&&o[ie].enable(n[ie])}_add(n,o,f){this._handlers.push({handlerName:n,handler:o,allowed:f}),this._handlersById[n]=o}stop(n){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,o,f){for(const _ in n)if(_!==f&&(!o||o.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const o=[];for(const f of n)this._el.contains(f.target)&&o.push(f);return o}handleEvent(n,o){this._updatingCamera=!0;const f=n.type==="renderFrame",_=f?void 0:n,v={needsRenderFrame:!1},b={},P={},D=n.touches?this._getMapTouches(n.touches):void 0,B=D?et(this._el,D):f?void 0:ft(this._el,n);for(const{handlerName:q,handler:$,allowed:ee}of this._handlers){if(!$.isEnabled())continue;let K;this._blockedByActive(P,ee,q)?$.reset():$[o||n.type]&&(K=$[o||n.type](n,B,D),this.mergeHandlerResult(v,b,K,q,_),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||$.isActive())&&(P[q]=$)}const F={};for(const q in this._previousActiveHandlers)P[q]||(F[q]=_);this._previousActiveHandlers=P,(Object.keys(F).length||_c(v))&&(this._changes.push([v,b,F]),this._triggerRenderFrame()),(Object.keys(P).length||_c(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=v;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,o,f,_,v){if(!f)return;a.l(n,f);const b={handlerName:_,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(o.zoom=b),f.panDelta!==void 0&&(o.drag=b),f.pitchDelta!==void 0&&(o.pitch=b),f.bearingDelta!==void 0&&(o.rotate=b)}_applyChanges(){const n={},o={},f={};for(const[_,v,b]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),a.l(o,v),a.l(f,b);this._updateMapTransform(n,o,f),this._changes=[]}_updateMapTransform(n,o,f){const _=this._map,v=_.transform,b=ae=>[ae.x,ae.y,ae.z];if((ae=>{const de=this._eventsInProgress.drag;return de&&!this._handlersById[de.handlerName].isActive()})()&&!_c(n)){const ae=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ae!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!_c(n))return void this._fireEvents(o,f,!0);let{panDelta:P,zoomDelta:D,bearingDelta:B,pitchDelta:F,around:U,aroundCoord:q,pinchAround:$}=n;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),$!==void 0&&(U=$),(D||(ae=>o[ae]&&!this._eventsInProgress[ae])("drag"))&&U&&(this._dragOrigin=b(v.pointCoordinate3D(U)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),U=U||_.transform.centerPoint,B&&(v.bearing+=B),F&&(v.pitch+=F),v._updateCameraState();const ee=[0,0,0];if(P)if(v.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U).dir),de=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U.sub(P)).dir);ee[0]=de[0]-ae[0],ee[1]=de[1]-ae[1]}else{const ae=v.pointCoordinate(U);if(v.projection.name==="globe"){P=P.rotate(-v.angle);const de=v._pixelsPerMercatorPixel/v.worldSize;ee[0]=-P.x*a.ds(a.aN(ae.y))*de,ee[1]=-P.y*a.ds(v.center.lat)*de}else{const de=v.pointCoordinate(U.sub(P));ae&&de&&(ee[0]=de.x-ae.x,ee[1]=de.y-ae.y)}}const K=v.zoom,re=[0,0,0];if(D){const ae=b(q||v.pointCoordinate3D(U)),de={dir:a.a6.vec3.normalize([],a.a6.vec3.sub([],ae,v._camera.position))};if(de.dir[2]<0){const fe=v.zoomDeltaToMovement(ae,D);a.a6.vec3.scale(re,de.dir,fe)}}const ie=a.a6.vec3.add(ee,ee,re);v._translateCameraConstrained(ie),D&&Math.abs(v.zoom-K)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,f,!0)}_fireEvents(n,o,f){const _=Vc(this._eventsInProgress),v=Vc(n),b={};for(const F in n){const{originalEvent:U}=n[F];this._eventsInProgress[F]||(b[`${F}start`]=U),this._eventsInProgress[F]=n[F]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const F in b)this._fireEvent(F,b[F]);v&&this._fireEvent("move",v.originalEvent);for(const F in n){const{originalEvent:U}=n[F];this._fireEvent(F,U)}const P={};let D;for(const F in this._eventsInProgress){const{handlerName:U,originalEvent:q}=this._eventsInProgress[F];this._handlersById[U].isActive()||(delete this._eventsInProgress[F],D=o[U]||q,P[`${F}end`]=D)}for(const F in P)this._fireEvent(F,P[F]);const B=Vc(this._eventsInProgress);if(f&&(_||v)&&!B){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;F?(U(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:D})):(this._map.fire(new a.x("moveend",{originalEvent:D})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,o){this._map.fire(new a.x(n,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Fh("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const yl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class _d extends a.E{constructor(n,o){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,a.aJ(["_renderFrameCallback"],this)}getCenter(){return new a.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(n,o){return this.jumpTo({center:n},o)}panBy(n,o,f){return n=a.P.convert(n).mult(-1),this.panTo(this.transform.center,a.l({offset:n},o),f)}panTo(n,o,f){return this.easeTo(a.l({center:n},o),f)}getZoom(){return this.transform.zoom}setZoom(n,o){return this.jumpTo({zoom:n},o),this}zoomTo(n,o,f){return this.easeTo(a.l({zoom:n},o),f)}zoomIn(n,o){return this.zoomTo(this.getZoom()+1,n,o),this}zoomOut(n,o){return this.zoomTo(this.getZoom()-1,n,o),this}getBearing(){return this.transform.bearing}setBearing(n,o){return this.jumpTo({bearing:n},o),this}getPadding(){return this.transform.padding}setPadding(n,o){return this.jumpTo({padding:n},o),this}rotateTo(n,o,f){return this.easeTo(a.l({bearing:n},o),f)}resetNorth(n,o){return this.rotateTo(0,a.l({duration:1e3},n),o),this}resetNorthPitch(n,o){return this.easeTo(a.l({bearing:0,pitch:0,duration:1e3},n),o),this}snapToNorth(n,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,o):this}getPitch(){return this.transform.pitch}setPitch(n,o){return this.jumpTo({pitch:n},o),this}cameraForBounds(n,o){n=a.as.convert(n);const f=o&&o.bearing||0,_=o&&o.pitch||0,v=n.getNorthWest(),b=n.getSouthEast();return this._cameraForBounds(this.transform,v,b,f,_,o)}_extendPadding(n){const o={top:0,right:0,bottom:0,left:0};return n==null?a.l({},o,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:a.l({},o,n)}_extendCameraOptions(n){return(n=a.l({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,o){const f=o.max[0]-o.min[0],_=o.max[1]-o.min[1];return f/_>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):_/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,o,f,_,v,b){const P=n.clone(),D=this._extendCameraOptions(b);P.bearing=_,P.pitch=v;const B=a.bL.convert(o),F=a.bL.convert(f),U=.5*(B.lat+F.lat),q=.5*(B.lng+F.lng),$=a.dt(U,q),ee=a.a6.vec3.normalize([],$),K=a.a6.vec3.normalize([],a.a6.vec3.cross([],ee,[0,1,0])),re=a.a6.vec3.cross([],K,ee),ie=[K[0],K[1],K[2],0,re[0],re[1],re[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],ae=[$,a.dt(B.lat,B.lng),a.dt(F.lat,B.lng),a.dt(F.lat,F.lng),a.dt(B.lat,F.lng),a.dt(U,B.lng),a.dt(U,F.lng),a.dt(B.lat,q),a.dt(F.lat,q)];let de=a.ca.fromPoints(ae.map(rt=>[a.a6.vec3.dot(K,rt),a.a6.vec3.dot(re,rt),a.a6.vec3.dot(ee,rt)]));const fe=a.a6.vec3.transformMat4([],de.center,ie);a.a6.vec3.squaredLength(fe)===0&&a.a6.vec3.set(fe,0,0,1),a.a6.vec3.normalize(fe,fe),a.a6.vec3.scale(fe,fe,a.aq),P.center=a.du(fe);const be=P.getWorldToCameraMatrix(),Ee=a.a6.mat4.invert(new Float64Array(16),be);de=a.ca.applyTransform(de,a.a6.mat4.multiply([],be,ie));const we=this._extendAABB(de,P,D,_);if(!we)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=we,a.a6.vec3.transformMat4(fe,fe,be);const Ie=.5*(de.max[2]-de.min[2]),Re=this._minimumAABBFrustumDistance(P,de),Be=a.a6.vec3.scale([],[0,0,1],Ie),Ne=a.a6.vec3.add(Be,fe,Be),De=Re+(P.pitch===0?0:a.a6.vec3.distance(fe,Ne)),Je=P.globeCenterInViewSpace,at=a.a6.vec3.sub([],fe,[Je[0],Je[1],Je[2]]);a.a6.vec3.normalize(at,at),a.a6.vec3.scale(at,at,De);const vt=a.a6.vec3.add([],fe,at);a.a6.vec3.transformMat4(vt,vt,Ee);const St=a.dw/a.aq,Pt=a.a6.vec3.length(vt),He=a.bE(Math.max(Pt*St-a.dw,Number.EPSILON),0),gt=Math.min(P.zoomFromMercatorZAdjusted(He),D.maxZoom);return gt>.5*(a.c3+a.bV)?(P.setProjection({name:"mercator"}),P.zoom=gt,this._cameraForBounds(P,o,f,_,v,b)):{center:P.center,zoom:gt,bearing:_,pitch:v}}_extendAABB(n,o,f,_){const v=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),P=b,D=v,B=v,F=b,U=o.width-(D+B),q=o.height-(P+F),$=a.a6.vec3.sub([],n.max,n.min),ee=Math.min(U/$[0],q/$[1]),K=Math.min(o.scaleZoom(o.scale*ee),f.maxZoom);if(isNaN(K))return null;const re=o.scale/o.zoomScale(K),ie=new a.ca([n.min[0]-D*re,n.min[1]-F*re,n.min[2]],[n.max[0]+B*re,n.max[1]+P*re,n.max[2]]),ae=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new a.P(f.offset.x,f.offset.y):a.P.convert(f.offset)).rotate(-a.bC(_));return ie.center[0]-=ae.x*re,ie.center[1]+=ae.y*re,ie}queryTerrainElevation(n,o){const f=this.transform.elevation;return f?(o=a.l({},{exaggerated:!0},o),f.getAtPoint(a.a5.fromLngLat(n),null,o.exaggerated)):null}_cameraForBounds(n,o,f,_,v,b){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,o,f,_,v,b);const P=n.clone(),D=this._extendCameraOptions(b);P.bearing=_,P.pitch=v;const B=a.bL.convert(o),F=a.bL.convert(f),U=new a.bL(B.lng,F.lat),q=new a.bL(F.lng,B.lat),$=P.project(B),ee=P.project(F),K=this.queryTerrainElevation(B),re=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(U),ae=this.queryTerrainElevation(q),de=[[$.x,$.y,Math.min(K||0,re||0,ie||0,ae||0)],[ee.x,ee.y,Math.max(K||0,re||0,ie||0,ae||0)]];let fe=a.ca.fromPoints(de);const be=P.getWorldToCameraMatrix(),Ee=a.a6.mat4.invert(new Float64Array(16),be);fe=a.ca.applyTransform(fe,be);const we=this._extendAABB(fe,P,D,_);if(!we)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=we;const Ie=.5*a.a6.vec3.sub([],fe.max,fe.min)[2],Re=this._minimumAABBFrustumDistance(P,fe),Be=[0,0,1,0];a.a6.vec4.transformMat4(Be,Be,be),a.a6.vec4.normalize(Be,Be);const Ne=a.a6.vec3.scale([],Be,Re+Ie),De=a.a6.vec3.add([],fe.center,Ne);a.a6.vec3.transformMat4(fe.center,fe.center,Ee),a.a6.vec3.transformMat4(De,De,Ee);const Je=P.unproject(new a.P(fe.center[0],fe.center[1])),at=a.dv(P.projection,Je),vt=Math.pow(2,at),St=Math.min(P._zoomFromMercatorZ(De[2]*P.pixelsPerMeter*vt/P.worldSize),D.maxZoom);return P.mercatorFromTransition&&St<.5*(a.c3+a.bV)?(P.setProjection({name:"globe"}),P.zoom=St,this._cameraForBounds(P,o,f,_,v,b)):{center:Je,zoom:St,bearing:_,pitch:v}}fitBounds(n,o,f){const _=this.cameraForBounds(n,o);return this._fitInternal(_,o,f)}fitScreenCoordinates(n,o,f,_,v){const b=a.P.convert(n),P=a.P.convert(o),D=new a.P(Math.min(b.x,P.x),Math.min(b.y,P.y)),B=new a.P(Math.max(b.x,P.x),Math.max(b.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,P))return this;const F=this.transform.pointLocation3D(D),U=this.transform.pointLocation3D(B),q=this.transform.pointLocation3D(new a.P(D.x,B.y)),$=this.transform.pointLocation3D(new a.P(B.x,D.y)),ee=[Math.min(F.lng,U.lng,q.lng,$.lng),Math.min(F.lat,U.lat,q.lat,$.lat)],K=[Math.max(F.lng,U.lng,q.lng,$.lng),Math.max(F.lat,U.lat,q.lat,$.lat)],re=_&&_.pitch?_.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,ee,K,f,re,_);return this._fitInternal(ie,_,v)}_fitInternal(n,o,f){return n?(o=a.l(n,o)).linear?this.easeTo(o,f):this.flyTo(o,f):this}jumpTo(n,o){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,b=!1;"zoom"in n&&f.zoom!==+n.zoom&&(_=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=a.bL.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(v=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(b=!0,f.pitch=+n.pitch);const P=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!f.isPaddingEqual(P))if(n.retainPadding===!1){const D=f.clone();D.padding=P,f.setLocationAtPoint(f.center,D.centerPoint)}else f.padding=P;return n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new a.x("movestart",o)).fire(new a.x("move",o)),_&&this.fire(new a.x("zoomstart",o)).fire(new a.x("zoom",o)).fire(new a.x("zoomend",o)),v&&this.fire(new a.x("rotatestart",o)).fire(new a.x("rotate",o)).fire(new a.x("rotateend",o)),b&&this.fire(new a.x("pitchstart",o)).fire(new a.x("pitch",o)).fire(new a.x("pitchend",o)),this.fire(new a.x("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(yl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,o){const f=this.transform;if(!f.projection.supportsFreeCamera)return a.w(yl),this;this.stop();const _=f.zoom,v=f.pitch,b=f.bearing;f.setFreeCameraOptions(n);const P=_!==f.zoom,D=v!==f.pitch,B=b!==f.bearing;return this.fire(new a.x("movestart",o)).fire(new a.x("move",o)),P&&this.fire(new a.x("zoomstart",o)).fire(new a.x("zoom",o)).fire(new a.x("zoomend",o)),B&&this.fire(new a.x("rotatestart",o)).fire(new a.x("rotate",o)).fire(new a.x("rotateend",o)),D&&this.fire(new a.x("pitchstart",o)).fire(new a.x("pitch",o)).fire(new a.x("pitchend",o)),this.fire(new a.x("moveend",o)),this}easeTo(n,o){this._stop(!1,n.easeId),((n=a.l({offset:[0,0],duration:500,easing:a.dr},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,_=this.getZoom(),v=this.getBearing(),b=this.getPitch(),P=this.getPadding(),D="zoom"in n?+n.zoom:_,B="bearing"in n?this._normalizeBearing(n.bearing,v):v,F="pitch"in n?+n.pitch:b,U=this._extendPadding(n.padding),q=a.P.convert(n.offset);let $,ee,K;if(f.projection.name==="globe"){const Be=a.a5.fromLngLat(f.center),Ne=q.rotate(-f.angle);Be.x+=Ne.x/f.worldSize,Be.y+=Ne.y/f.worldSize;const De=Be.toLngLat(),Je=a.bL.convert(n.center||De);this._normalizeCenter(Je),$=f.centerPoint.add(Ne),ee=new a.P(Be.x,Be.y).mult(f.worldSize),K=new a.P(a.am(Je.lng),a.at(Je.lat)).mult(f.worldSize).sub(ee)}else{$=f.centerPoint.add(q);const Be=f.pointLocation($),Ne=a.bL.convert(n.center||Be);this._normalizeCenter(Ne),ee=f.project(Be),K=f.project(Ne).sub(ee)}const re=f.zoomScale(D-_);let ie,ae;n.around&&(ie=a.bL.convert(n.around),ae=f.locationPoint(ie));const de=this._zooming||D!==_,fe=this._rotating||v!==B,be=this._pitching||F!==b,Ee=!f.isPaddingEqual(U),we=n.retainPadding===!1?f.clone():f,Ie=Be=>Ne=>{if(de&&(Be.zoom=a.aa(_,D,Ne)),fe&&(Be.bearing=a.aa(v,B,Ne)),be&&(Be.pitch=a.aa(b,F,Ne)),Ee&&(we.interpolatePadding(P,U,Ne),$=we.centerPoint.add(q)),ie)Be.setLocationAtPoint(ie,ae);else{const De=Be.zoomScale(Be.zoom-_),Je=D>_?Math.min(2,re):Math.max(.5,re),at=Math.pow(Je,1-Ne),vt=Be.unproject(ee.add(K.mult(Ne*at)).mult(De));Be.setLocationAtPoint(Be.renderWorldCopies?vt.wrap():vt,$)}return n.preloadOnly||this._fireMoveEvents(o),Be};if(n.preloadOnly){const Be=this._emulate(Ie,n.duration,f);return this._preloadTiles(Be),this}const Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=fe,this._pitching=be,this._padding=Ee,this._easeId=n.easeId,this._prepareEase(o,n.noMoveStart,Re),this._ease(Ie(f),Be=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(o,Be)},n),this}_prepareEase(n,o,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||f.moving||this.fire(new a.x("movestart",n)),this._zooming&&!f.zooming&&this.fire(new a.x("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new a.x("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new a.x("pitchstart",n))}_fireMoveEvents(n){this.fire(new a.x("move",n)),this._zooming&&this.fire(new a.x("zoom",n)),this._rotating&&this.fire(new a.x("rotate",n)),this._pitching&&this.fire(new a.x("pitch",n))}_afterEase(n,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new a.x("zoomend",n)),_&&this.fire(new a.x("rotateend",n)),v&&this.fire(new a.x("pitchend",n)),this.fire(new a.x("moveend",n))}flyTo(n,o){if(this._prefersReducedMotion(n)){const rt=a.ar(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(rt,o)}this.stop(),n=a.l({offset:[0,0],speed:1.2,curve:1.42,easing:a.dr},n);const f=this.transform,_=this.getZoom(),v=this.getBearing(),b=this.getPitch(),P=this.getPadding(),D="zoom"in n?a.ap(+n.zoom,f.minZoom,f.maxZoom):_,B="bearing"in n?this._normalizeBearing(n.bearing,v):v,F="pitch"in n?+n.pitch:b,U=this._extendPadding(n.padding),q=f.zoomScale(D-_),$=a.P.convert(n.offset);let ee=f.centerPoint.add($);const K=f.pointLocation(ee),re=a.bL.convert(n.center||K);this._normalizeCenter(re);const ie=f.project(K),ae=f.project(re).sub(ie);let de=n.curve;const fe=Math.max(f.width,f.height),be=fe/q,Ee=ae.mag();if("minZoom"in n){const rt=a.ap(Math.min(n.minZoom,_,D),f.minZoom,f.maxZoom),_t=fe/f.zoomScale(rt-_);de=Math.sqrt(_t/Ee*2)}const we=de*de;function Ie(rt){const _t=(be*be-fe*fe+(rt?-1:1)*we*we*Ee*Ee)/(2*(rt?be:fe)*we*Ee);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Re(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function Be(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const Ne=Ie(0);let De=function(rt){return Be(Ne)/Be(Ne+de*rt)},Je=function(rt){return fe*((Be(Ne)*(Re(_t=Ne+de*rt)/Be(_t))-Re(Ne))/we)/Ee;var _t},at=(Ie(1)-Ne)/de;if(Math.abs(Ee)<1e-6||!isFinite(at)){if(Math.abs(fe-be)<1e-6)return this.easeTo(n,o);const rt=be<fe?-1:1;at=Math.abs(Math.log(be/fe))/de,Je=function(){return 0},De=function(_t){return Math.exp(rt*de*_t)}}n.duration="duration"in n?+n.duration:1e3*at/("screenSpeed"in n?+n.screenSpeed/de:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const vt=v!==B,St=F!==b,Pt=!f.isPaddingEqual(U),He=n.retainPadding===!1?f.clone():f,gt=rt=>_t=>{const xt=_t*at,mt=1/De(xt);rt.zoom=_t===1?D:_+rt.scaleZoom(mt),vt&&(rt.bearing=a.aa(v,B,_t)),St&&(rt.pitch=a.aa(b,F,_t)),Pt&&(He.interpolatePadding(P,U,_t),ee=He.centerPoint.add($));const Ot=_t===1?re:rt.unproject(ie.add(ae.mult(Je(xt))).mult(mt));return rt.setLocationAtPoint(rt.renderWorldCopies?Ot.wrap():Ot,ee),rt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(o),rt};if(n.preloadOnly){const rt=this._emulate(gt,n.duration,f);return this._preloadTiles(rt),this}return this._zooming=!0,this._rotating=vt,this._pitching=St,this._padding=Pt,this._prepareEase(o,!1),this._ease(gt(f),()=>this._afterEase(o),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,o)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,o,f){f.animate===!1||f.duration===0?(n(1),o()):(this._easeStart=a.q.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((a.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,o){n=a.bB(n,-180,180);const f=Math.abs(n-o);return Math.abs(n-360-o)<f&&(n-=360),Math.abs(n+360-o)<f&&(n+=360),n}_normalizeCenter(n){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const f=n.lng-o.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&a.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,o,f){const _=Math.ceil(15*o/1e3),v=[],b=n(f.clone());for(let P=0;P<=_;P++){const D=b(P/_);v.push(D.clone())}return v}_preloadTiles(n,o){}}class kh{constructor(n={}){this.options=n,a.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const o=this.options&&this.options.compact,f=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ve("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const _=ve("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=ve("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(n){const f=o.reduce((_,v,b)=>(v.value&&(_+=`${v.key}=${v.value}${b<o.length-1?"&":""}`),_),"?");n.href=`${a.e.FEEDBACK_URL}/${f}#${mc(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const o=this._map.style._mergedSourceCaches;for(const _ in o){const v=o[_];if(v.used){const b=v.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((_,v)=>_.length-v.length),n=n.filter((_,v)=>{for(let b=v+1;b<n.length;b++)if(n[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yd{constructor(){a.aJ(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ve("div","mapboxgl-ctrl");const o=ve("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const o in n){const f=n[o].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Rf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o}remove(n){const o=this._currentlyRunning,f=o?this._queue.concat(o):this._queue;for(const _ of f)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const f of o)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class mh{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const o=a.cw((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,o,f){this._start=this.getValue(o),this._end=n,this._startTime=o,this._endTime=o+f}}const em={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Df=["mouseenter","mouseover","mouseleave","mouseout"];class Bh extends a.x{constructor(n,o,f,_){const{point:v,lngLat:b,originalEvent:P,target:D}=n;super(n.type,{point:v,lngLat:b,originalEvent:P,target:D}),this.preventDefault=()=>{n.preventDefault()},this.id=o,this.interaction=f,this.feature=_}}class vd{constructor(n){this.map=n,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(n,o){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const{type:f,filter:_}=o;if(_){const b=a.M(_,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(b.result==="error")throw new Error(b.value.map(P=>`${P.key}: ${P.message}`).join(", "));this.filters.set(n,b.value)}const v=this.interactionsByType.get(f)||new Map;v.size===0&&(Df.includes(f)?this.map.on(f,o.featureset,this.handleType):this.map.on(f,this.handleType),this.interactionsByType.set(f,v)),v.set(n,o),this.typeById.set(n,f)}remove(n){const o=this.typeById.get(n);if(!o)return;this.typeById.delete(n),this.filters.delete(n);const f=this.interactionsByType.get(o);f&&(f.delete(n),f.size===0&&this.map.off(o,this.handleType))}handleType(n){const o=this.interactionsByType.get(n.type),f=Array.from(o).reverse(),_=[];for(const[,P]of f)P.featureset&&_.push({featureset:P.featureset,filter:P.filter,radius:P.radius});let v=this.map.style.queryRenderedFeaturesForInteractions(n.point,_,this.map.transform);!v.length&&Df.includes(n.type)&&(v=[null]);let b=!1;for(const P of v){for(const[D,B]of f){const{handler:F,featureset:U}=B;if(U&&(P==null||a.bi(P.featureset,U))&&F(new Bh(n,D,B,P))!==!1){b=!0;break}}if(b)break}if(!b)for(const[P,D]of f){const{handler:B,featureset:F}=D;if(!F&&B(new Bh(n,P,D,null))!==!1)break}}}function gh(d,n){if(Array.isArray(d)&&Array.isArray(n)){const o=new Set(d),f=new Set(n);return o.size===f.size&&d.every(_=>f.has(_))}return a.bi(d,n)}const Uc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},Yl={showCompass:!0,showZoom:!0,visualizePitch:!1};class ka{constructor(n,o,f=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Ds({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new oa({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),a.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),Ae()}move(n,o){const f=this.map,_=this.mouseRotate.mousemoveWindow(n,o),v=_&&_.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,o),P=b&&b.pitchDelta;P&&f.setPitch(f.getPitch()+P)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){pt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(a.l({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ft(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ft(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=et(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=et(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Jl(d,n,o){if(d=new a.bL(d.lng,d.lat),n){const f=new a.bL(d.lng-360,d.lat),_=new a.bL(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-o.center.lng)/360),b=o.locationPoint(d).distSqr(n),P=n.x<0||n.y<0||n.x>o.width||n.y>o.height;o.locationPoint(f).distSqr(n)<b&&(P||Math.abs(f.lng-o.center.lng)<v)?d=f:o.locationPoint(_).distSqr(n)<b&&(P||Math.abs(_.lng-o.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-o.center.lng)>180;){const f=o.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;d.lng>o.center.lng?d.lng-=360:d.lng+=360}return d}const Kl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class vl extends a.E{constructor(n,o){if(super(),(n instanceof HTMLElement||o)&&(n=a.l({element:n},o)),a.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=a.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ve("div");const v=41,b=27,P=Nt("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),D=Nt("radialGradient",{id:"shadowGradient"},Nt("defs",{},P));Nt("stop",{offset:"10%","stop-opacity":.4},D),Nt("stop",{offset:"100%","stop-opacity":.05},D),Nt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),Nt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),Nt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),Nt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=a.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const f=this._element.classList;for(const v in Kl)f.remove(`mapboxgl-marker-anchor-${v}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=n&&n.className?n.className.trim().split(/\s+/):[];f.add(..._),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.bL.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const o=n.code,f=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const o=n.originalEvent.target,f=this._element;this._popup&&(o===f||f.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,o=this._pos;if(!n||!o)return!1;const f=n.unproject(o),_=n.getFreeCameraOptions();if(!_.position)return!1;const v=_.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const o=this._pos;if(!o||o.x<0||o.x>n.transform.width||o.y<0||o.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(o);let _;n._showingGlobe()&&a.dz(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Kl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const n=this._pos,o=this._map,f=this.getPitchAlignment();if(!o||!n||f!=="map")return"";if(!o._showingGlobe()){const D=o.getPitch();return D?`rotateX(${D}deg)`:""}const _=a.c1(a.dA(o.transform,this._lngLat)),v=n.sub(a.dB(o.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(b===0)return"";const P=_/b;return`rotateX(${-v.y*P}deg) rotateY(${v.x*P}deg)`}_calculateZTransform(){const n=this._pos,o=this._map;if(!o||!n)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(o._showingGlobe()){const v=o.project(new a.bL(this._lngLat.lng,this._lngLat.lat+.001)),b=o.project(new a.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=a.c1(Math.atan2(b.y,b.x))-90}else f=-o.getBearing();else if(_==="horizon"){const v=a.a7(4,6,o.getZoom()),b=a.dB(o.transform);b.y+=v*o.transform.height;const P=n.sub(b),D=a.c1(Math.atan2(P.y,P.x));f=(D>90?D-270:D+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Jl(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=a.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const o=this._map;if(!o)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const v=this._clickTolerance||o._clickTolerance;if(n.point.dist(f)<v)return;this._isDragging=!0}this._pos=n.point.sub(_),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.x("dragstart"))),this.fire(new a.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.x("dragend")),this._state="inactive"}_addDragHandler(n){const o=this._map,f=this._pos;o&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const o=this._map;return o&&(n?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},nm={maxWidth:100,unit:"metric"},im={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},rm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Of=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Os(d=new a.P(0,0),n="bottom"){if(typeof d=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new a.P(0,d);case"top-left":return new a.P(o,o);case"top-right":return new a.P(-o,o);case"bottom":return new a.P(0,-d);case"bottom-left":return new a.P(o,-o);case"bottom-right":return new a.P(-o,-o);case"left":return new a.P(d,0);case"right":return new a.P(-d,0)}return new a.P(0,0)}return d instanceof a.P||Array.isArray(d)?a.P.convert(d):a.P.convert(d[n]||[0,0])}return{version:_e,supported:Pe.supported,setRTLTextPlugin:a.dC,getRTLTextPluginStatus:a.dD,Map:class extends _d{constructor(d){xe.mark(me.create);const n=d;if((d=a.l({},Uc,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&a.dx(window)&&(d.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ps(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Rf,this._domRenderTaskQueue=new Rf,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.aQ(),this._locale=a.l({},em,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new mh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new zn(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?{...d.contextCreateOptions}:{},typeof d.container=="string"){const o=document.getElementById(d.container);if(!o)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=o}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),a.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new hh),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Yr(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||a.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new Bc(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const o=d.bounds;o&&(this.resize(),this.fitBounds(o,a.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new kh({customAttribution:d.customAttribution})),this._logoControl=new yd,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new a.x(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new a.x(`${o.dataType}dataloading`,o))}),this._interactions=new vd(this)}_getMapId(){return this._mapId}addControl(d,n){if(n===void 0&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new a.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(o,f.firstChild):f.appendChild(o),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new a.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new a.x("movestart",d)).fire(new a.x("move",d)),this.fire(new a.x("resize",d)),n&&this.fire(new a.x("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(a.as.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new a.x("zoomstart")).fire(new a.x("zoom")).fire(new a.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new a.x("zoomstart")).fire(new a.x("zoom")).fire(new a.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new a.x("pitchstart")).fire(new a.x("pitch")).fire(new a.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new a.x("pitchstart")).fire(new a.x("pitch")).fire(new a.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(n=>n==="auto"?navigator.language:n):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,n=d.projection.name;let o;n==="globe"&&d.zoom>=a.bV?(d.setMercatorFromTransition(),o=!0):n==="mercator"&&d.zoom<a.bV&&(d.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;return n=d.name==="globe"&&this.transform.zoom>=a.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(a.bL.convert(d))}unproject(d){return this.transform.pointLocation3D(a.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,o){const f=_=>{let v=[];if(Array.isArray(n)){const b=n.filter(P=>this.getLayer(P));v=b.length?this.queryRenderedFeatures(_,{layers:b}):[]}else v=this.queryRenderedFeatures(_,{featureset:n});return v};if(d==="mouseenter"||d==="mouseover"){let _=!1;return{listener:o,targets:n,delegates:{mousemove:b=>{const P=f(b.point);P.length?_||(_=!0,o.call(this,new O(d,this,b.originalEvent,{features:P}))):_=!1},mouseout:()=>{_=!1}}}}if(d==="mouseleave"||d==="mouseout"){let _=!1;return{listener:o,targets:n,delegates:{mousemove:P=>{f(P.point).length?_=!0:_&&(_=!1,o.call(this,new O(d,this,P.originalEvent)))},mouseout:P=>{_&&(_=!1,o.call(this,new O(d,this,P.originalEvent)))}}}}{const _=v=>{const b=f(v.point);b.length&&(v.features=b,o.call(this,v),delete v.features)};return{listener:o,targets:n,delegates:{[d]:_}}}}on(d,n,o){if(typeof n=="function"||o===void 0)return super.on(d,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._createDelegatedListener(d,n,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,n,o){if(typeof n=="function"||o===void 0)return super.once(d,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._createDelegatedListener(d,n,o);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,n,o){if(typeof n=="function"||o===void 0)return super.off(d,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._delegatedListeners?this._delegatedListeners[d]:void 0;return f&&(_=>{for(let v=0;v<_.length;v++){const b=_[v];if(b.listener===o&&gh(b.targets,n)){for(const P in b.delegates)this.off(P,b.delegates[P]);return _.splice(v,1),this}}})(f),this}queryRenderedFeatures(d,n){if(!this.style)return[];if(n!==void 0||d===void 0||d instanceof a.P||Array.isArray(d)||(n=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(n=n||{}))return this._isFeaturesetDescriptorValid(n.featureset)?this.style.queryRenderedFeaturesForInteractions(d,[n],this.transform):[];if(n.layers&&Array.isArray(n.layers)){for(const o of n.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(d,n,this.transform)}querySourceFeatures(d,n){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,n)}isPointOnSurface(d){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&a.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(d))}addInteraction(d,n){return this._interactions.add(d,n),this}removeInteraction(d){return this._interactions.remove(d),this}setStyle(d,n){return n=a.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&d&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(d,(o,f)=>{o?(a.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(d,n)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(n==null)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const o=a.l({},n);n&&n.config&&(o.initialConfig=n.config,delete o.config),this.style=new kr(this,o).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new kr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new a.t(new Error("IDs can't be empty."))),!1):!a.aK(d)||(this.fire(new a.t(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isFeaturesetDescriptorValid(d){return"featuresetId"in d?this._isValidId(d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const n of d)if(!this._isValidId(n))return!1;return!0}return this._isFeaturesetDescriptorValid(d)}addSource(d,n){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,n,o){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,o)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,n,{pixelRatio:o=1,sdf:f=!1,stretchX:_,stretchY:v,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:P,height:D,data:B}=a.q.getImageData(n);this.style.addImage(d,{data:new a.r({width:P,height:D},B),pixelRatio:o,stretchX:_,stretchY:v,content:b,sdf:f,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new a.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:D}=n,B=n;this.style.addImage(d,{data:new a.r({width:P,height:D},new Uint8Array(B.data)),pixelRatio:o,stretchX:_,stretchY:v,content:b,sdf:f,version:0,userImage:B}),B.onAdd&&B.onAdd(this,d)}}updateImage(d,n){this._lazyInitEmptyStyle();const o=this.style.getImage(d);if(!o)return void this.fire(new a.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?a.q.getImageData(n):n,{width:_,height:v,data:b}=f;if(_===void 0||v===void 0)return void this.fire(new a.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==o.data.width||v!==o.data.height)return void this.fire(new a.t(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const P=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);o.data.replace(b,P),this.style.updateImage(d,o)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new a.t(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){a.o(this._requestManager.transformRequest(d,a.R.Image),(o,f)=>{n(o,f instanceof HTMLImageElement?a.q.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(d,n){this._lazyInitEmptyStyle(),this.style.addModel(d,n)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new a.t(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,n){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)):this}getSlot(d){const n=this.getLayer(d);return n&&n.slot||null}setSlot(d,n){return this.style.setSlot(d,n),this.style.mergeLayers(),this._update(!0)}addImport(d,n){return this.style.addImport(d,n),this}updateImport(d,n){return typeof n!="string"&&n.id!==d?(this.removeImport(d),this.addImport(n)):(this.style.updateImport(d,n),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,n){return this.style.moveImport(d,n),this._update(!0)}moveLayer(d,n){return this._isValidId(d)?(this.style.moveLayer(d,n),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const n=this.style.getOwnLayer(d);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,n,o){return this._isValidId(d)?(this.style.setLayerZoomRange(d,n,o),this._update(!0)):this}setFilter(d,n,o={}){return this._isValidId(d)?(this.style.setFilter(d,n,o),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,n,o,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,n,o,f),this._update(!0)):this}getPaintProperty(d,n){return this._isValidId(d)?this.style.getPaintProperty(d,n):null}setLayoutProperty(d,n,o,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,n,o,f),this._update(!0)):this}getLayoutProperty(d,n){return this._isValidId(d)?this.style.getLayoutProperty(d,n):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,n){return this.style.setSchema(d,n),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,n){return this.style.setConfig(d,n),this._update(!0)}getConfigProperty(d,n){return this.style.getConfigProperty(d,n)}setConfigProperty(d,n,o){return this.style.setConfigProperty(d,n,o),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const n=d[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.bL.convert(d),this.transform):0}setFeatureState(d,n){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,n),this._update())}removeFeatureState(d,n){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,n),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let o,f,_,v=this._container;for(;v&&(!f||!_);){const b=window.getComputedStyle(v).transform;b&&b!=="none"&&(o=b.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(f=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(_=o[3])),v=v.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ve("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ve("div","mapboxgl-canvas-container",d);this._canvas=ve("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=ve("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=ve("div",`mapboxgl-ctrl-${_}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const o=a.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(d),this._canvas.height=o*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);n!==-1&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const d=a.l({},Pe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",d);n?(bn(n,!0),this.painter=new gl(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.m.testSupport(n)):this.fire(new a.t(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.x("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new a.x("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;this.fire(new a.x("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,f=a.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=_.createQuery(),_.beginQuery(o.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,F=this.transform.pitch,U=a.q.now(),q=new a.a3(B,{now:U,fadeDuration:v,pitch:F,transition:this.style.transition});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,xe.mark(me.load),this.fire(new a.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const B=a.q.now()-f;_.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const F=_.getQueryParameter(n,_.QUERY_RESULT)/1e6;_.deleteQuery(n),this.fire(new a.x("gpu-timing-frame",{cpuTime:B,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(B);this.fire(new a.x("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const B=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(B);this.fire(new a.x("gpu-timing-deferred-render",{gpuTime:F}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(D||this._repaint)this.triggerRepaint();else{const B=this.idle();if(B&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new a.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new a.x("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,xe.mark(me.fullLoad),this._performanceMetricsCollection&&Ha(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const o=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const _=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=d;const b=Math.abs(_-v);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),o(v);this._averageElevation.easeTo(v,d,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),o(v)}return!!this._averageElevation.isEasing(d)&&o(this._averageElevation.getValue(d))}_authenticate(){Ve(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===kt||d.status===401)){const n=this.painter.context.gl;bn(n,!1),this._logoControl instanceof yd&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),es(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ur(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const o=this.painter.context.gl,f=o.createFramebuffer();function _(v){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v,0);const b=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,b),b}return o.bindFramebuffer(o.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(d,n,o){let f=o[1]-o[0];const _=d.length/4;for(let v=0;v<n.length;v++){const b=n[v];let P=0;for(let D=0;D<b.length;D+=4)b[D]===d[D]&&b[D+1]===d[D+1]&&b[D+2]===d[D+2]&&b[D+3]===d[D+3]&&(P+=1);f+=(o[v+2]-o[v+1])*(1-P/_)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),no.delete(this.painter.context.gl),Go.remove(),_n.remove(),this._removed=!0,this.fire(new a.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=a.q.frame(n=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(n)}))}_preloadTiles(d){const n=this.style?this.style.getSourceCaches():[];return a.bg(n,(o,f)=>o._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,n){a.dy(d,n)}get version(){return _e}},NavigationControl:class{constructor(d={}){this.options=a.l({},Yl,d),this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(a.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ve("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ve("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:n}):o.resetNorth({},{originalEvent:n}))}),this._compassIcon=ve("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),o=n===d.getMaxZoom(),f=n===d.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ka(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const o=ve("button",d,this._container);return o.type="button",o.addEventListener("click",n),o}_setButtonTitle(d,n){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",o),d.firstElementChild&&d.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends a.E{constructor(d={}){super();const n=navigator.geolocation;this.options=a.l({geolocation:n},tm,d),a.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,d(o)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>n(o.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),o=d.coords;return!!n&&(o.longitude<n.getWest()||o.longitude>n.getEast()||o.latitude<n.getSouth()||o.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new a.x("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.x("geolocate",d)),this._finish()}}_updateCamera(d){const n=new a.bL(d.coords.longitude,d.coords.latitude),o=d.coords.accuracy,f=this._map.getBearing(),_=a.l({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(o),_,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new a.bL(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=a.bE(1,d._center.lat)*d.worldSize,o=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.x("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ve("button","mapboxgl-ctrl-geolocate",this._container),ve("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ve("div","mapboxgl-user-location"),this._dotElement.appendChild(ve("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ve("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new vl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ve("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.x("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:kh,ScaleControl:class{constructor(d={}){this.options=a.l({},nm,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,o=n._containerHeight/2,f=n._containerWidth/2-d/2,_=n.unproject([f,o]),v=n.unproject([f+d,o]),b=_.distanceTo(v);if(this.options.unit==="imperial"){const P=3.2808*b;P>5280?this._setScale(d,P/5280,"mile"):this._setScale(d,P,"foot")}else this.options.unit==="nautical"?this._setScale(d,b/1852,"nautical-mile"):b>=1e3?this._setScale(d,b/1e3,"kilometer"):this._setScale(d,b,"meter")}_setScale(d,n,o){this._map._requestDomTask(()=>{const f=function(v){const b=Math.pow(10,`${Math.floor(v)}`.length-1);let P=v/b;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(D){const B=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*B)/B}(P),b*P}(n),_=f/n;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(f):`${f}&nbsp;${im[o]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:a.w("Full screen control 'container' must be a DOM element.")),a.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ve("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ve("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(d){super(),this.options=a.l(Object.create(rm),d),a.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new a.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new a.x("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=a.bL.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const n=document.createDocumentFragment(),o=document.createElement("body");let f;for(o.innerHTML=d;f=o.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ve("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const o=this._closeButton=ve("button","mapboxgl-popup-close-button",n);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,o=this._container,f=this._pos;if(!n||!o||!f)return"bottom";const _=o.offsetWidth,v=o.offsetHeight,b=f.x<_/2,P=f.x>n.transform.width-_/2;if(f.y+d<v)return b?"top-left":P?"top-right":"top";if(f.y>n.transform.height-v){if(b)return"bottom-left";if(P)return"bottom-right"}return b?"left":P?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,o=this._content;if(!n||!this._lngLat&&!this._trackPointer||!o)return;let f=this._container;if(f||(f=this._container=ve("div","mapboxgl-popup",n.getContainer()),this._tip=ve("div","mapboxgl-popup-tip",f),f.appendChild(o)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jl(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const _=this._pos=this._trackPointer&&d instanceof a.P?d:n.project(this._lngLat),v=Os(this.options.offset),b=this._anchor=this._getAnchor(v.y),P=Os(this.options.offset,b),D=_.add(P).round();n._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Kl[b]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=a.dz(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Of);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:vl,Style:kr,LngLat:a.bL,LngLatBounds:a.as,Point:a.P,MercatorCoordinate:a.a5,FreeCameraOptions:Lo,Evented:a.E,config:a.e,prewarm:a.dE,clearPrewarmedResources:a.dF,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(d){a.e.ACCESS_TOKEN=d},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(d){a.e.API_URL=d},get workerCount(){return a.dG.workerCount},set workerCount(d){a.dG.workerCount=d},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){a.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){a.dH(d)},get workerUrl(){return a.dI.workerUrl},set workerUrl(d){a.dI.workerUrl=d},get workerClass(){return a.dI.workerClass},set workerClass(d){a.dI.workerClass=d},get workerParams(){return a.dI.workerParams},set workerParams(d){a.dI.workerParams=d},get dracoUrl(){return a.dJ()},set dracoUrl(d){a.dK(d)},get meshoptUrl(){return a.dL()},set meshoptUrl(d){a.dM(d)},setNow:a.q.setNow,restoreNow:a.q.restoreNow}});var te=W;return te})})(h1);var U2=h1.exports;const G2=c1(U2);var lu={exports:{}},ii={};function ah(S,R){return{type:"Feature",properties:R||{},geometry:S}}ii.feature=ah;ii.point=function(S,R){if(!Array.isArray(S))throw new Error("Coordinates must be an array");if(S.length<2)throw new Error("Coordinates must be at least 2 numbers long");return ah({type:"Point",coordinates:S.slice()},R)};ii.polygon=function(S,R){if(!S)throw new Error("No coordinates passed");for(var z=0;z<S.length;z++){var N=S[z];if(N.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var W=0;W<N[N.length-1].length;W++)if(N[N.length-1][W]!==N[0][W])throw new Error("First and last Position are not equivalent.")}return ah({type:"Polygon",coordinates:S},R)};ii.lineString=function(S,R){if(!S)throw new Error("No coordinates passed");return ah({type:"LineString",coordinates:S},R)};ii.featureCollection=function(S){return{type:"FeatureCollection",features:S}};ii.multiLineString=function(S,R){if(!S)throw new Error("No coordinates passed");return ah({type:"MultiLineString",coordinates:S},R)};ii.multiPoint=function(S,R){if(!S)throw new Error("No coordinates passed");return ah({type:"MultiPoint",coordinates:S},R)};ii.multiPolygon=function(S,R){if(!S)throw new Error("No coordinates passed");return ah({type:"MultiPolygon",coordinates:S},R)};ii.geometryCollection=function(S,R){return ah({type:"GeometryCollection",geometries:S},R)};var o_={miles:3960,nauticalmiles:3441.145,degrees:57.2957795,radians:1,inches:250905600,yards:6969600,meters:6373e3,metres:6373e3,kilometers:6373,kilometres:6373};ii.radiansToDistance=function(S,R){var z=o_[R||"kilometers"];if(z===void 0)throw new Error("Invalid unit");return S*z};ii.distanceToRadians=function(S,R){var z=o_[R||"kilometers"];if(z===void 0)throw new Error("Invalid unit");return S/z};ii.distanceToDegrees=function(S,R){var z=o_[R||"kilometers"];if(z===void 0)throw new Error("Invalid unit");return S/z*57.2958};var q2=ii.polygon,j2=ii.featureCollection,a_=function(S,R){return j2(W2(S.features.map(function(z){var N={x:z.geometry.coordinates[0],y:z.geometry.coordinates[1]};return R&&(N.z=z.properties[R]),N})).map(function(z){return q2([[[z.a.x,z.a.y],[z.b.x,z.b.y],[z.c.x,z.c.y],[z.a.x,z.a.y]]],{a:z.a.z,b:z.b.z,c:z.c.z})}))};function Xv(S,R,z){this.a=S,this.b=R,this.c=z;var N=R.x-S.x,W=R.y-S.y,X=z.x-S.x,te=z.y-S.y,a=N*(S.x+R.x)+W*(S.y+R.y),_e=X*(S.x+z.x)+te*(S.y+z.y),me=2*(N*(z.y-R.y)-W*(z.x-R.x)),xe,Se,Te,Qe;Math.abs(me)<1e-6?(xe=Math.min(S.x,R.x,z.x),Se=Math.min(S.y,R.y,z.y),Te=(Math.max(S.x,R.x,z.x)-xe)*.5,Qe=(Math.max(S.y,R.y,z.y)-Se)*.5,this.x=xe+Te,this.y=Se+Qe,this.r=Te*Te+Qe*Qe):(this.x=(te*a-W*_e)/me,this.y=(N*_e-X*a)/me,Te=this.x-S.x,Qe=this.y-S.y,this.r=Te*Te+Qe*Qe)}function H2(S,R){return R.x-S.x}function Z2(S){var R=S.length,z,N,W,X,te;e:for(;R;)for(N=S[--R],z=S[--R],W=R;W;)if(te=S[--W],X=S[--W],z===X&&N===te||z===te&&N===X){S.splice(R,2),S.splice(W,2),R-=2;continue e}}function W2(S){if(S.length<3)return[];S.sort(H2);for(var R=S.length-1,z=S[R].x,N=S[0].x,W=S[R].y,X=W;R--;)S[R].y<W&&(W=S[R].y),S[R].y>X&&(X=S[R].y);var te=N-z,a=X-W,_e=te>a?te:a,me=(N+z)*.5,xe=(X+W)*.5,Se=[new Xv({x:me-20*_e,y:xe-_e,__sentinel:!0},{x:me,y:xe+20*_e,__sentinel:!0},{x:me+20*_e,y:xe-_e,__sentinel:!0})],Te=[],Qe=[],Pe,ve,Nt;for(R=S.length;R--;){for(Qe.length=0,Pe=Se.length;Pe--;){if(te=S[R].x-Se[Pe].x,te>0&&te*te>Se[Pe].r){Te.push(Se[Pe]),Se.splice(Pe,1);continue}a=S[R].y-Se[Pe].y,!(te*te+a*a>Se[Pe].r)&&(Qe.push(Se[Pe].a,Se[Pe].b,Se[Pe].b,Se[Pe].c,Se[Pe].c,Se[Pe].a),Se.splice(Pe,1))}for(Z2(Qe),Pe=Qe.length;Pe;)Nt=Qe[--Pe],ve=Qe[--Pe],Se.push(new Xv(ve,Nt,S[R]))}for(Array.prototype.push.apply(Te,Se),R=Te.length;R--;)(Te[R].a.__sentinel||Te[R].b.__sentinel||Te[R].c.__sentinel)&&Te.splice(R,1);return Te}var lh={};function $2(S){if(Array.isArray(S)&&typeof S[0]=="number"&&typeof S[1]=="number")return S;if(S){if(S.type==="Feature"&&S.geometry&&S.geometry.type==="Point"&&Array.isArray(S.geometry.coordinates))return S.geometry.coordinates;if(S.type==="Point"&&Array.isArray(S.coordinates))return S.coordinates}throw new Error("A coordinate, feature, or point geometry is required")}function X2(S,R,z){if(!R||!z)throw new Error("type and name required");if(!S||S.type!==R)throw new Error("Invalid input to "+z+": must be a "+R+", given "+S.type)}function Y2(S,R,z){if(!z)throw new Error(".featureOf() requires a name");if(!S||S.type!=="Feature"||!S.geometry)throw new Error("Invalid input to "+z+", Feature with geometry required");if(!S.geometry||S.geometry.type!==R)throw new Error("Invalid input to "+z+": must be a "+R+", given "+S.geometry.type)}function J2(S,R,z){if(!z)throw new Error(".collectionOf() requires a name");if(!S||S.type!=="FeatureCollection")throw new Error("Invalid input to "+z+", FeatureCollection required");for(var N=0;N<S.features.length;N++){var W=S.features[N];if(!W||W.type!=="Feature"||!W.geometry)throw new Error("Invalid input to "+z+", Feature with geometry required");if(!W.geometry||W.geometry.type!==R)throw new Error("Invalid input to "+z+": must be a "+R+", given "+W.geometry.type)}}lh.geojsonType=X2;lh.collectionOf=J2;lh.featureOf=Y2;lh.getCoord=$2;var K2=lh,cd=function(R,z){var N=K2.getCoord(R),W=z.geometry.coordinates;z.geometry.type==="Polygon"&&(W=[W]);for(var X=0,te=!1;X<W.length&&!te;X++)if(Yv(N,W[X][0])){for(var a=!1,_e=1;_e<W[X].length&&!a;)Yv(N,W[X][_e])&&(a=!0),_e++;a||(te=!0)}return te};function Yv(S,R){for(var z=!1,N=0,W=R.length-1;N<R.length;W=N++){var X=R[N][0],te=R[N][1],a=R[W][0],_e=R[W][1],me=te>S[1]!=_e>S[1]&&S[0]<(a-X)*(S[1]-te)/(_e-te)+X;me&&(z=!z)}return z}var Q2=Array.isArray||function(S){return Object.prototype.toString.call(S)==="[object Array]"},eI=function(S,R){if(!Q2(S))throw new Error("Coordinates must be an array");if(S.length<2)throw new Error("Coordinates must be at least 2 numbers long");return{type:"Feature",geometry:{type:"Point",coordinates:S},properties:R||{}}},tI=eI,nI=function(S,R){var z=S[0],N=S[1],W=S[2];S[3];for(var X=(W-z)/R,te={type:"FeatureCollection",features:[]},a=0;a<=R;a++)for(var _e=0;_e<=R;_e++)te.features.push(tI([a*X+z,_e*X+N]));return te},Il={};function l_(S,R,z){var N,W,X,te,a,_e,me,xe,Se,Te=0,Qe,Pe=S.type==="FeatureCollection",ve=S.type==="Feature",Nt=Pe?S.features.length:1;for(N=0;N<Nt;N++)for(Se=Pe?S.features[N].geometry:ve?S.geometry:S,Qe=Se.type==="GeometryCollection",me=Qe?Se.geometries.length:1,te=0;te<me;te++)if(_e=Qe?Se.geometries[te]:Se,xe=_e.coordinates,Te=z&&(_e.type==="Polygon"||_e.type==="MultiPolygon")?1:0,_e.type==="Point")R(xe);else if(_e.type==="LineString"||_e.type==="MultiPoint")for(W=0;W<xe.length;W++)R(xe[W]);else if(_e.type==="Polygon"||_e.type==="MultiLineString")for(W=0;W<xe.length;W++)for(X=0;X<xe[W].length-Te;X++)R(xe[W][X]);else if(_e.type==="MultiPolygon")for(W=0;W<xe.length;W++)for(X=0;X<xe[W].length;X++)for(a=0;a<xe[W][X].length-Te;a++)R(xe[W][X][a]);else throw new Error("Unknown Geometry Type")}Il.coordEach=l_;function iI(S,R,z,N){return l_(S,function(W){z=R(z,W)},N),z}Il.coordReduce=iI;function f1(S,R){var z;switch(S.type){case"FeatureCollection":for(z=0;z<S.features.length;z++)R(S.features[z].properties);break;case"Feature":R(S.properties);break}}Il.propEach=f1;function rI(S,R,z){return f1(S,function(N){z=R(z,N)}),z}Il.propReduce=rI;function sI(S,R){if(S.type==="Feature")R(S);else if(S.type==="FeatureCollection")for(var z=0;z<S.features.length;z++)R(S.features[z])}Il.featureEach=sI;function oI(S){var R=[];return l_(S,function(z){R.push(z)}),R}Il.coordAll=oI;var aI=Il.coordEach,Up=function(S){var R=[1/0,1/0,-1/0,-1/0];return aI(S,function(z){R[0]>z[0]&&(R[0]=z[0]),R[1]>z[1]&&(R[1]=z[1]),R[2]<z[0]&&(R[2]=z[0]),R[3]<z[1]&&(R[3]=z[1])}),R},p1=function(S,R){var z=S.geometry.coordinates[0],N=S.geometry.coordinates[1],W=R.geometry.coordinates[0][0][0],X=R.geometry.coordinates[0][0][1],te=R.properties.a,a=R.geometry.coordinates[0][1][0],_e=R.geometry.coordinates[0][1][1],me=R.properties.b,xe=R.geometry.coordinates[0][2][0],Se=R.geometry.coordinates[0][2][1],Te=R.properties.c,Qe=(Te*(z-W)*(N-_e)+te*(z-a)*(N-Se)+me*(z-xe)*(N-X)-me*(z-W)*(N-Se)-Te*(z-a)*(N-X)-te*(z-xe)*(N-_e))/((z-W)*(N-_e)+(z-a)*(N-Se)+(z-xe)*(N-X)-(z-W)*(N-Se)-(z-a)*(N-X)-(z-xe)*(N-_e));return Qe},Jv=lh.getCoord,lI=ii.radiansToDistance,ja=function(S,R,z){var N=Math.PI/180,W=Jv(S),X=Jv(R),te=N*(X[1]-W[1]),a=N*(X[0]-W[0]),_e=N*W[1],me=N*X[1],xe=Math.pow(Math.sin(te/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(_e)*Math.cos(me);return lI(2*Math.atan2(Math.sqrt(xe),Math.sqrt(1-xe)),z)},Kv=ja,m1=function(S){var R=Kv(S.slice(0,2),[S[2],S[1]],"miles"),z=Kv(S.slice(0,2),[S[0],S[3]],"miles");if(R>=z){var N=(S[1]+S[3])/2;return[S[0],N-(S[2]-S[0])/2,S[2],N+(S[2]-S[0])/2]}else{var W=(S[0]+S[2])/2;return[W-(S[3]-S[1])/2,S[1],W+(S[3]-S[1])/2,S[3]]}},uI=g1,Vg=1e-10;function Ep(S,R){var z=S.x-R.x,N=S.y-R.y;return z*z+N*N<Vg}function Qv(S){for(var R=S.head;R;){var z=R.next;R.next=R.prev,R.prev=z,R=z}var z=S.head;S.head=S.tail,S.tail=z}function u_(S){this.level=S,this.s=null,this.count=0}u_.prototype.remove_seq=function(S){S.prev?S.prev.next=S.next:this.s=S.next,S.next&&(S.next.prev=S.prev),--this.count};u_.prototype.addSegment=function(S,R){for(var z=this.s,N=null,W=null,X=!1,te=!1;z&&(N==null&&(Ep(S,z.head.p)?(N=z,X=!0):Ep(S,z.tail.p)&&(N=z)),W==null&&(Ep(R,z.head.p)?(W=z,te=!0):Ep(R,z.tail.p)&&(W=z)),!(W!=null&&N!=null));)z=z.next;var a=(N!=null?1:0)|(W!=null?2:0);switch(a){case 0:var _e={p:S,prev:null},me={p:R,next:null};_e.next=me,me.prev=_e,N={head:_e,tail:me,next:this.s,prev:null,closed:!1},this.s&&(this.s.prev=N),this.s=N,++this.count;break;case 1:var xe={p:R};X?(xe.next=N.head,xe.prev=null,N.head.prev=xe,N.head=xe):(xe.next=null,xe.prev=N.tail,N.tail.next=xe,N.tail=xe);break;case 2:var xe={p:S};te?(xe.next=W.head,xe.prev=null,W.head.prev=xe,W.head=xe):(xe.next=null,xe.prev=W.tail,W.tail.next=xe,W.tail=xe);break;case 3:if(N===W){var xe={p:N.tail.p,next:N.head,prev:null};N.head.prev=xe,N.head=xe,N.closed=!0;break}switch((X?1:0)|(te?2:0)){case 0:Qv(N);case 1:W.tail.next=N.head,N.head.prev=W.tail,W.tail=N.tail,this.remove_seq(N);break;case 3:Qv(N);case 2:N.tail.next=W.head,W.head.prev=N.tail,N.tail=W.tail,this.remove_seq(W);break}}};function g1(S){if(S)this.drawContour=S;else{var R=this;R.contours={},this.drawContour=function(z,N,W,X,te,a){var _e=R.contours[a];_e||(_e=R.contours[a]=new u_(te)),_e.addSegment({x:z,y:N},{x:W,y:X})},this.contourList=function(){var z=[],N=R.contours;for(var W in N)for(var X=N[W].s,te=N[W].level;X;){var a=X.head,_e=[];for(_e.level=te,_e.k=W;a&&a.p;)_e.push(a.p),a=a.next;z.push(_e),X=X.next}return z.sort(function(me,xe){return me.k-xe.k}),z}}this.h=new Array(5),this.sh=new Array(5),this.xh=new Array(5),this.yh=new Array(5)}g1.prototype.contour=function(S,R,z,N,W,X,te,a,_e){var me=this.h,xe=this.sh,Se=this.xh,Te=this.yh,Qe=this.drawContour;this.contours={};for(var Pe=function(tn,Vn){return(me[Vn]*Se[tn]-me[tn]*Se[Vn])/(me[Vn]-me[tn])},ve=function(tn,Vn){return(me[Vn]*Te[tn]-me[tn]*Te[Vn])/(me[Vn]-me[tn])},Nt,wt,Bt,je,Ae,pt,en=0,ze=0,ft=0,et=0,ht=[0,1,1,0],it=[0,0,1,1],le=[[[0,0,8],[0,2,5],[7,6,9]],[[0,3,4],[1,3,1],[4,3,0]],[[9,6,7],[5,2,0],[8,0,0]]],kt=W-1;kt>=N;kt--)for(var zn=R;zn<=z-1;zn++){var Qt,ri;if(Qt=Math.min(S[zn][kt],S[zn][kt+1]),ri=Math.min(S[zn+1][kt],S[zn+1][kt+1]),Ae=Math.min(Qt,ri),Qt=Math.max(S[zn][kt],S[zn][kt+1]),ri=Math.max(S[zn+1][kt],S[zn+1][kt+1]),pt=Math.max(Qt,ri),pt>=_e[0]&&Ae<=_e[a-1]){for(var Zi=0;Zi<a;Zi++)if(_e[Zi]>=Ae&&_e[Zi]<=pt){for(var dt=4;dt>=0;dt--)dt>0?(me[dt]=S[zn+ht[dt-1]][kt+it[dt-1]]-_e[Zi],Se[dt]=X[zn+ht[dt-1]],Te[dt]=te[kt+it[dt-1]]):(me[0]=.25*(me[1]+me[2]+me[3]+me[4]),Se[0]=.5*(X[zn]+X[zn+1]),Te[0]=.5*(te[kt]+te[kt+1])),me[dt]>Vg?xe[dt]=1:me[dt]<-Vg?xe[dt]=-1:xe[dt]=0;for(dt=1;dt<=4;dt++)if(Nt=dt,wt=0,dt!=4?Bt=dt+1:Bt=1,je=le[xe[Nt]+1][xe[wt]+1][xe[Bt]+1],je!=0){switch(je){case 1:en=Se[Nt],ft=Te[Nt],ze=Se[wt],et=Te[wt];break;case 2:en=Se[wt],ft=Te[wt],ze=Se[Bt],et=Te[Bt];break;case 3:en=Se[Bt],ft=Te[Bt],ze=Se[Nt],et=Te[Nt];break;case 4:en=Se[Nt],ft=Te[Nt],ze=Pe(wt,Bt),et=ve(wt,Bt);break;case 5:en=Se[wt],ft=Te[wt],ze=Pe(Bt,Nt),et=ve(Bt,Nt);break;case 6:en=Se[Bt],ft=Te[Bt],ze=Pe(Nt,wt),et=ve(Nt,wt);break;case 7:en=Pe(Nt,wt),ft=ve(Nt,wt),ze=Pe(wt,Bt),et=ve(wt,Bt);break;case 8:en=Pe(wt,Bt),ft=ve(wt,Bt),ze=Pe(Bt,Nt),et=ve(Bt,Nt);break;case 9:en=Pe(Bt,Nt),ft=ve(Bt,Nt),ze=Pe(Nt,wt),et=ve(Nt,wt);break}Qe(en,ft,ze,et,_e[Zi],Zi)}}}}};var cI=a_,hI=cd,dI=nI,fI=Up,pI=p1,mI=ii.featureCollection,gI=ii.lineString,_I=m1,yI=uI,vI=function(S,R,z,N){for(var W=cI(S,R),X=fI(S),te=_I(X),a=dI(te,z),_e=[],me=0;me<a.features.length;me++)for(var xe=a.features[me],Se=0;Se<W.features.length;Se++){var Te=W.features[Se];hI(xe,Te)&&(xe.properties={},xe.properties[R]=pI(xe,Te))}for(var Qe=Math.sqrt(a.features.length),Pe=0;Pe<Qe;Pe++){for(var ve=a.features.slice(Pe*Qe,(Pe+1)*Qe),Nt=[],wt=0;wt<ve.length;wt++)ve[wt].properties?Nt.push(ve[wt].properties[R]):Nt.push(0);_e.push(Nt)}for(var Bt=(te[2]-te[0])/Qe,je=[],Ae=[],pt=0;pt<Qe;pt++)je.push(pt*Bt+te[0]),Ae.push(pt*Bt+te[1]);var en=new yI;en.contour(_e,0,z,0,z,je,Ae,N.length,N);var ze=en.contourList(),ft=mI([]);return ze.forEach(function(et){if(et.length>2){var ht=[];et.forEach(function(le){ht.push([le.x,le.y])});var it=gI(ht);it.properties={},it.properties[R]=et.level,ft.features.push(it)}}),ft},xI=bI;function bI(S){for(var R=0,z=0,N=1;N<S.length;++N)S[N][0]<S[R][0]&&(R=N),S[N][0]>S[z][0]&&(z=N);return R<z?[[R],[z]]:R>z?[[z],[R]]:[[R]]}var _1={exports:{}},y1=wI,ex=+(Math.pow(2,27)+1);function wI(S,R,z){var N=S*R,W=ex*S,X=W-S,te=W-X,a=S-te,_e=ex*R,me=_e-R,xe=_e-me,Se=R-xe,Te=N-te*xe,Qe=Te-a*xe,Pe=Qe-te*Se,ve=a*Se-Pe;return z?(z[0]=ve,z[1]=N,z):[ve,N]}var EI=TI;function II(S,R){var z=S+R,N=z-S,W=z-N,X=R-N,te=S-W,a=te+X;return a?[a,z]:[z]}function TI(S,R){var z=S.length|0,N=R.length|0;if(z===1&&N===1)return II(S[0],R[0]);var W=z+N,X=new Array(W),te=0,a=0,_e=0,me=Math.abs,xe=S[a],Se=me(xe),Te=R[_e],Qe=me(Te),Pe,ve;Se<Qe?(ve=xe,a+=1,a<z&&(xe=S[a],Se=me(xe))):(ve=Te,_e+=1,_e<N&&(Te=R[_e],Qe=me(Te))),a<z&&Se<Qe||_e>=N?(Pe=xe,a+=1,a<z&&(xe=S[a],Se=me(xe))):(Pe=Te,_e+=1,_e<N&&(Te=R[_e],Qe=me(Te)));for(var Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,je=Bt,Ae=Nt,pt,en,ze,ft,et;a<z&&_e<N;)Se<Qe?(Pe=xe,a+=1,a<z&&(xe=S[a],Se=me(xe))):(Pe=Te,_e+=1,_e<N&&(Te=R[_e],Qe=me(Te))),ve=je,Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,Bt&&(X[te++]=Bt),pt=Ae+Nt,en=pt-Ae,ze=pt-en,ft=Nt-en,et=Ae-ze,je=et+ft,Ae=pt;for(;a<z;)Pe=xe,ve=je,Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,Bt&&(X[te++]=Bt),pt=Ae+Nt,en=pt-Ae,ze=pt-en,ft=Nt-en,et=Ae-ze,je=et+ft,Ae=pt,a+=1,a<z&&(xe=S[a]);for(;_e<N;)Pe=Te,ve=je,Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,Bt&&(X[te++]=Bt),pt=Ae+Nt,en=pt-Ae,ze=pt-en,ft=Nt-en,et=Ae-ze,je=et+ft,Ae=pt,_e+=1,_e<N&&(Te=R[_e]);return je&&(X[te++]=je),Ae&&(X[te++]=Ae),te||(X[te++]=0),X.length=te,X}var SI=CI;function CI(S,R,z){var N=S+R,W=N-S,X=N-W,te=R-W,a=S-X;return z?(z[0]=a+te,z[1]=N,z):[a+te,N]}var vg=y1,MI=SI,AI=PI;function PI(S,R){var z=S.length;if(z===1){var N=vg(S[0],R);return N[0]?N:[N[1]]}var W=new Array(2*z),X=[.1,.1],te=[.1,.1],a=0;vg(S[0],R,X),X[0]&&(W[a++]=X[0]);for(var _e=1;_e<z;++_e){vg(S[_e],R,te);var me=X[1];MI(me,te[0],X),X[0]&&(W[a++]=X[0]);var xe=te[1],Se=X[1],Te=xe+Se,Qe=Te-xe,Pe=Se-Qe;X[1]=Te,Pe&&(W[a++]=Pe)}return X[1]&&(W[a++]=X[1]),a===0&&(W[a++]=0),W.length=a,W}var LI=DI;function RI(S,R){var z=S+R,N=z-S,W=z-N,X=R-N,te=S-W,a=te+X;return a?[a,z]:[z]}function DI(S,R){var z=S.length|0,N=R.length|0;if(z===1&&N===1)return RI(S[0],-R[0]);var W=z+N,X=new Array(W),te=0,a=0,_e=0,me=Math.abs,xe=S[a],Se=me(xe),Te=-R[_e],Qe=me(Te),Pe,ve;Se<Qe?(ve=xe,a+=1,a<z&&(xe=S[a],Se=me(xe))):(ve=Te,_e+=1,_e<N&&(Te=-R[_e],Qe=me(Te))),a<z&&Se<Qe||_e>=N?(Pe=xe,a+=1,a<z&&(xe=S[a],Se=me(xe))):(Pe=Te,_e+=1,_e<N&&(Te=-R[_e],Qe=me(Te)));for(var Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,je=Bt,Ae=Nt,pt,en,ze,ft,et;a<z&&_e<N;)Se<Qe?(Pe=xe,a+=1,a<z&&(xe=S[a],Se=me(xe))):(Pe=Te,_e+=1,_e<N&&(Te=-R[_e],Qe=me(Te))),ve=je,Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,Bt&&(X[te++]=Bt),pt=Ae+Nt,en=pt-Ae,ze=pt-en,ft=Nt-en,et=Ae-ze,je=et+ft,Ae=pt;for(;a<z;)Pe=xe,ve=je,Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,Bt&&(X[te++]=Bt),pt=Ae+Nt,en=pt-Ae,ze=pt-en,ft=Nt-en,et=Ae-ze,je=et+ft,Ae=pt,a+=1,a<z&&(xe=S[a]);for(;_e<N;)Pe=Te,ve=je,Nt=Pe+ve,wt=Nt-Pe,Bt=ve-wt,Bt&&(X[te++]=Bt),pt=Ae+Nt,en=pt-Ae,ze=pt-en,ft=Nt-en,et=Ae-ze,je=et+ft,Ae=pt,_e+=1,_e<N&&(Te=-R[_e]);return je&&(X[te++]=je),Ae&&(X[te++]=Ae),te||(X[te++]=0),X.length=te,X}(function(S){var R=y1,z=EI,N=AI,W=LI,X=5,te=11102230246251565e-32,a=(3+16*te)*te,_e=(7+56*te)*te;function me(je,Ae,pt,en){return function(ft,et,ht){var it=je(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),je(Ae(ft[1],et[0]),Ae(-et[1],ft[0]))),le=je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),kt=en(it,le);return kt[kt.length-1]}}function xe(je,Ae,pt,en){return function(ft,et,ht,it){var le=je(je(pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),et[2]),je(pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),-ht[2]),pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),it[2]))),je(pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),it[2])))),kt=je(je(pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),ft[2]),je(pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),-ht[2]),pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),it[2]))),je(pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),ht[2])))),zn=en(le,kt);return zn[zn.length-1]}}function Se(je,Ae,pt,en){return function(ft,et,ht,it,le){var kt=je(je(je(pt(je(pt(je(Ae(it[1],le[0]),Ae(-le[1],it[0])),ht[2]),je(pt(je(Ae(ht[1],le[0]),Ae(-le[1],ht[0])),-it[2]),pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),le[2]))),et[3]),je(pt(je(pt(je(Ae(it[1],le[0]),Ae(-le[1],it[0])),et[2]),je(pt(je(Ae(et[1],le[0]),Ae(-le[1],et[0])),-it[2]),pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),le[2]))),-ht[3]),pt(je(pt(je(Ae(ht[1],le[0]),Ae(-le[1],ht[0])),et[2]),je(pt(je(Ae(et[1],le[0]),Ae(-le[1],et[0])),-ht[2]),pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),le[2]))),it[3]))),je(pt(je(pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),et[2]),je(pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),-ht[2]),pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),it[2]))),-le[3]),je(pt(je(pt(je(Ae(it[1],le[0]),Ae(-le[1],it[0])),et[2]),je(pt(je(Ae(et[1],le[0]),Ae(-le[1],et[0])),-it[2]),pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),le[2]))),ft[3]),pt(je(pt(je(Ae(it[1],le[0]),Ae(-le[1],it[0])),ft[2]),je(pt(je(Ae(ft[1],le[0]),Ae(-le[1],ft[0])),-it[2]),pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),le[2]))),-et[3])))),je(je(pt(je(pt(je(Ae(et[1],le[0]),Ae(-le[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],le[0]),Ae(-le[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),le[2]))),it[3]),je(pt(je(pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),it[2]))),-le[3]),pt(je(pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),et[2]),je(pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),-ht[2]),pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),it[2]))),ft[3]))),je(pt(je(pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),ft[2]),je(pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),-ht[2]),pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),it[2]))),-et[3]),je(pt(je(pt(je(Ae(et[1],it[0]),Ae(-it[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),it[2]))),ht[3]),pt(je(pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),ht[2]))),-it[3]))))),zn=je(je(je(pt(je(pt(je(Ae(it[1],le[0]),Ae(-le[1],it[0])),ht[2]),je(pt(je(Ae(ht[1],le[0]),Ae(-le[1],ht[0])),-it[2]),pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),le[2]))),ft[3]),pt(je(pt(je(Ae(it[1],le[0]),Ae(-le[1],it[0])),ft[2]),je(pt(je(Ae(ft[1],le[0]),Ae(-le[1],ft[0])),-it[2]),pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),le[2]))),-ht[3])),je(pt(je(pt(je(Ae(ht[1],le[0]),Ae(-le[1],ht[0])),ft[2]),je(pt(je(Ae(ft[1],le[0]),Ae(-le[1],ft[0])),-ht[2]),pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),le[2]))),it[3]),pt(je(pt(je(Ae(ht[1],it[0]),Ae(-it[1],ht[0])),ft[2]),je(pt(je(Ae(ft[1],it[0]),Ae(-it[1],ft[0])),-ht[2]),pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),it[2]))),-le[3]))),je(je(pt(je(pt(je(Ae(ht[1],le[0]),Ae(-le[1],ht[0])),et[2]),je(pt(je(Ae(et[1],le[0]),Ae(-le[1],et[0])),-ht[2]),pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),le[2]))),ft[3]),pt(je(pt(je(Ae(ht[1],le[0]),Ae(-le[1],ht[0])),ft[2]),je(pt(je(Ae(ft[1],le[0]),Ae(-le[1],ft[0])),-ht[2]),pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),le[2]))),-et[3])),je(pt(je(pt(je(Ae(et[1],le[0]),Ae(-le[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],le[0]),Ae(-le[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),le[2]))),ht[3]),pt(je(pt(je(Ae(et[1],ht[0]),Ae(-ht[1],et[0])),ft[2]),je(pt(je(Ae(ft[1],ht[0]),Ae(-ht[1],ft[0])),-et[2]),pt(je(Ae(ft[1],et[0]),Ae(-et[1],ft[0])),ht[2]))),-le[3])))),Qt=en(kt,zn);return Qt[Qt.length-1]}}function Te(je){var Ae=je===3?me:je===4?xe:Se;return Ae(z,R,N,W)}var Qe=Te(3),Pe=Te(4),ve=[function(){return 0},function(){return 0},function(Ae,pt){return pt[0]-Ae[0]},function(Ae,pt,en){var ze=(Ae[1]-en[1])*(pt[0]-en[0]),ft=(Ae[0]-en[0])*(pt[1]-en[1]),et=ze-ft,ht;if(ze>0){if(ft<=0)return et;ht=ze+ft}else if(ze<0){if(ft>=0)return et;ht=-(ze+ft)}else return et;var it=a*ht;return et>=it||et<=-it?et:Qe(Ae,pt,en)},function(Ae,pt,en,ze){var ft=Ae[0]-ze[0],et=pt[0]-ze[0],ht=en[0]-ze[0],it=Ae[1]-ze[1],le=pt[1]-ze[1],kt=en[1]-ze[1],zn=Ae[2]-ze[2],Qt=pt[2]-ze[2],ri=en[2]-ze[2],Zi=et*kt,dt=ht*le,tn=ht*it,Vn=ft*kt,xi=ft*le,hr=et*it,_n=zn*(Zi-dt)+Qt*(tn-Vn)+ri*(xi-hr),es=(Math.abs(Zi)+Math.abs(dt))*Math.abs(zn)+(Math.abs(tn)+Math.abs(Vn))*Math.abs(Qt)+(Math.abs(xi)+Math.abs(hr))*Math.abs(ri),Jt=_e*es;return _n>Jt||-_n>Jt?_n:Pe(Ae,pt,en,ze)}];function Nt(je){var Ae=ve[je.length];return Ae||(Ae=ve[je.length]=Te(je.length)),Ae.apply(void 0,je)}function wt(je,Ae,pt,en,ze,ft,et){return function(it,le,kt,zn,Qt){switch(arguments.length){case 0:case 1:return 0;case 2:return en(it,le);case 3:return ze(it,le,kt);case 4:return ft(it,le,kt,zn);case 5:return et(it,le,kt,zn,Qt)}for(var ri=new Array(arguments.length),Zi=0;Zi<arguments.length;++Zi)ri[Zi]=arguments[Zi];return je(ri)}}function Bt(){for(;ve.length<=X;)ve.push(Te(ve.length));S.exports=wt.apply(void 0,[Nt].concat(ve));for(var je=0;je<=X;++je)S.exports[je]=ve[je]}Bt()})(_1);var c_=_1.exports,OI=NI,tx=c_[3];function NI(S){var R=S.length;if(R<3){for(var me=new Array(R),z=0;z<R;++z)me[z]=z;return R===2&&S[0][0]===S[1][0]&&S[0][1]===S[1][1]?[0]:me}for(var N=new Array(R),z=0;z<R;++z)N[z]=z;N.sort(function(Qe,Pe){var ve=S[Qe][0]-S[Pe][0];return ve||S[Qe][1]-S[Pe][1]});for(var W=[N[0],N[1]],X=[N[0],N[1]],z=2;z<R;++z){for(var te=N[z],a=S[te],_e=W.length;_e>1&&tx(S[W[_e-2]],S[W[_e-1]],a)<=0;)_e-=1,W.pop();for(W.push(te),_e=X.length;_e>1&&tx(S[X[_e-2]],S[X[_e-1]],a)>=0;)_e-=1,X.pop();X.push(te)}for(var me=new Array(X.length+W.length-2),xe=0,z=0,Se=W.length;z<Se;++z)me[xe++]=W[z];for(var Te=X.length-2;Te>0;--Te)me[xe++]=X[Te];return me}var zI=kI,FI=OI;function kI(S){var R=FI(S),z=R.length;if(z<=2)return[];for(var N=new Array(z),W=R[z-1],X=0;X<z;++X){var te=R[X];N[X]=[W,te],W=te}return N}var da={},ls={},h_=32;ls.INT_BITS=h_;ls.INT_MAX=2147483647;ls.INT_MIN=-1<<h_-1;ls.sign=function(S){return(S>0)-(S<0)};ls.abs=function(S){var R=S>>h_-1;return(S^R)-R};ls.min=function(S,R){return R^(S^R)&-(S<R)};ls.max=function(S,R){return S^(S^R)&-(S<R)};ls.isPow2=function(S){return!(S&S-1)&&!!S};ls.log2=function(S){var R,z;return R=(S>65535)<<4,S>>>=R,z=(S>255)<<3,S>>>=z,R|=z,z=(S>15)<<2,S>>>=z,R|=z,z=(S>3)<<1,S>>>=z,R|=z,R|S>>1};ls.log10=function(S){return S>=1e9?9:S>=1e8?8:S>=1e7?7:S>=1e6?6:S>=1e5?5:S>=1e4?4:S>=1e3?3:S>=100?2:S>=10?1:0};ls.popCount=function(S){return S=S-(S>>>1&1431655765),S=(S&858993459)+(S>>>2&858993459),(S+(S>>>4)&252645135)*16843009>>>24};function v1(S){var R=32;return S&=-S,S&&R--,S&65535&&(R-=16),S&16711935&&(R-=8),S&252645135&&(R-=4),S&858993459&&(R-=2),S&1431655765&&(R-=1),R}ls.countTrailingZeros=v1;ls.nextPow2=function(S){return S+=S===0,--S,S|=S>>>1,S|=S>>>2,S|=S>>>4,S|=S>>>8,S|=S>>>16,S+1};ls.prevPow2=function(S){return S|=S>>>1,S|=S>>>2,S|=S>>>4,S|=S>>>8,S|=S>>>16,S-(S>>>1)};ls.parity=function(S){return S^=S>>>16,S^=S>>>8,S^=S>>>4,S&=15,27030>>>S&1};var of=new Array(256);(function(S){for(var R=0;R<256;++R){var z=R,N=R,W=7;for(z>>>=1;z;z>>>=1)N<<=1,N|=z&1,--W;S[R]=N<<W&255}})(of);ls.reverse=function(S){return of[S&255]<<24|of[S>>>8&255]<<16|of[S>>>16&255]<<8|of[S>>>24&255]};ls.interleave2=function(S,R){return S&=65535,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,R&=65535,R=(R|R<<8)&16711935,R=(R|R<<4)&252645135,R=(R|R<<2)&858993459,R=(R|R<<1)&1431655765,S|R<<1};ls.deinterleave2=function(S,R){return S=S>>>R&1431655765,S=(S|S>>>1)&858993459,S=(S|S>>>2)&252645135,S=(S|S>>>4)&16711935,S=(S|S>>>16)&65535,S<<16>>16};ls.interleave3=function(S,R,z){return S&=1023,S=(S|S<<16)&4278190335,S=(S|S<<8)&251719695,S=(S|S<<4)&3272356035,S=(S|S<<2)&1227133513,R&=1023,R=(R|R<<16)&4278190335,R=(R|R<<8)&251719695,R=(R|R<<4)&3272356035,R=(R|R<<2)&1227133513,S|=R<<1,z&=1023,z=(z|z<<16)&4278190335,z=(z|z<<8)&251719695,z=(z|z<<4)&3272356035,z=(z|z<<2)&1227133513,S|z<<2};ls.deinterleave3=function(S,R){return S=S>>>R&1227133513,S=(S|S>>>2)&3272356035,S=(S|S>>>4)&251719695,S=(S|S>>>8)&4278190335,S=(S|S>>>16)&1023,S<<22>>22};ls.nextCombination=function(S){var R=S|S-1;return R+1|(~R&-~R)-1>>>v1(S)+1};var BI=x1;function x1(S){this.roots=new Array(S),this.ranks=new Array(S);for(var R=0;R<S;++R)this.roots[R]=R,this.ranks[R]=0}var Gp=x1.prototype;Object.defineProperty(Gp,"length",{get:function(){return this.roots.length}});Gp.makeSet=function(){var S=this.roots.length;return this.roots.push(S),this.ranks.push(0),S};Gp.find=function(S){for(var R=S,z=this.roots;z[S]!==S;)S=z[S];for(;z[R]!==S;){var N=z[R];z[R]=S,R=N}return S};Gp.link=function(S,R){var z=this.find(S),N=this.find(R);if(z!==N){var W=this.ranks,X=this.roots,te=W[z],a=W[N];te<a?X[z]=N:a<te?X[N]=z:(X[N]=z,++W[z])}};var b1=ls,w1=BI;function VI(S){for(var R=0,z=Math.max,N=0,W=S.length;N<W;++N)R=z(R,S[N].length);return R-1}da.dimension=VI;function UI(S){for(var R=-1,z=Math.max,N=0,W=S.length;N<W;++N)for(var X=S[N],te=0,a=X.length;te<a;++te)R=z(R,X[te]);return R+1}da.countVertices=UI;function GI(S){for(var R=new Array(S.length),z=0,N=S.length;z<N;++z)R[z]=S[z].slice(0);return R}da.cloneCells=GI;function hd(S,R){var z=S.length,N=S.length-R.length,W=Math.min;if(N)return N;switch(z){case 0:return 0;case 1:return S[0]-R[0];case 2:var me=S[0]+S[1]-R[0]-R[1];return me||W(S[0],S[1])-W(R[0],R[1]);case 3:var X=S[0]+S[1],te=R[0]+R[1];if(me=X+S[2]-(te+R[2]),me)return me;var a=W(S[0],S[1]),_e=W(R[0],R[1]),me=W(a,S[2])-W(_e,R[2]);return me||W(a+S[2],X)-W(_e+R[2],te);default:var xe=S.slice(0);xe.sort();var Se=R.slice(0);Se.sort();for(var Te=0;Te<z;++Te)if(N=xe[Te]-Se[Te],N)return N;return 0}}da.compareCells=hd;function qI(S,R){return hd(S[0],R[0])}function bf(S,R){if(R){for(var z=S.length,N=new Array(z),W=0;W<z;++W)N[W]=[S[W],R[W]];N.sort(qI);for(var W=0;W<z;++W)S[W]=N[W][0],R[W]=N[W][1];return S}else return S.sort(hd),S}da.normalize=bf;function d_(S){if(S.length===0)return[];for(var R=1,z=S.length,N=1;N<z;++N){var W=S[N];if(hd(W,S[N-1])){if(N===R){R++;continue}S[R++]=W}}return S.length=R,S}da.unique=d_;function lf(S,R){for(var z=0,N=S.length-1,W=-1;z<=N;){var X=z+N>>1,te=hd(S[X],R);te<=0?(te===0&&(W=X),z=X+1):te>0&&(N=X-1)}return W}da.findCell=lf;function E1(S,R){for(var z=new Array(S.length),N=0,W=z.length;N<W;++N)z[N]=[];for(var X=[],N=0,te=R.length;N<te;++N)for(var a=R[N],_e=a.length,me=1,xe=1<<_e;me<xe;++me){X.length=b1.popCount(me);for(var Se=0,Te=0;Te<_e;++Te)me&1<<Te&&(X[Se++]=a[Te]);var Qe=lf(S,X);if(!(Qe<0))for(;z[Qe++].push(N),!(Qe>=S.length||hd(S[Qe],X)!==0););}return z}da.incidence=E1;function jI(S,R){if(!R)return E1(d_(f_(S,0)),S);for(var z=new Array(R),N=0;N<R;++N)z[N]=[];for(var N=0,W=S.length;N<W;++N)for(var X=S[N],te=0,a=X.length;te<a;++te)z[X[te]].push(N);return z}da.dual=jI;function HI(S){for(var R=[],z=0,N=S.length;z<N;++z)for(var W=S[z],X=W.length|0,te=1,a=1<<X;te<a;++te){for(var _e=[],me=0;me<X;++me)te>>>me&1&&_e.push(W[me]);R.push(_e)}return bf(R)}da.explode=HI;function f_(S,R){if(R<0)return[];for(var z=[],N=(1<<R+1)-1,W=0;W<S.length;++W)for(var X=S[W],te=N;te<1<<X.length;te=b1.nextCombination(te)){for(var a=new Array(R+1),_e=0,me=0;me<X.length;++me)te&1<<me&&(a[_e++]=X[me]);z.push(a)}return bf(z)}da.skeleton=f_;function ZI(S){for(var R=[],z=0,N=S.length;z<N;++z)for(var W=S[z],X=0,te=W.length;X<te;++X){for(var a=new Array(W.length-1),_e=0,me=0;_e<te;++_e)_e!==X&&(a[me++]=W[_e]);R.push(a)}return bf(R)}da.boundary=ZI;function WI(S,R){for(var z=new w1(R),N=0;N<S.length;++N)for(var W=S[N],X=0;X<W.length;++X)for(var te=X+1;te<W.length;++te)z.link(W[X],W[te]);for(var a=[],_e=z.ranks,N=0;N<_e.length;++N)_e[N]=-1;for(var N=0;N<S.length;++N){var me=z.find(S[N][0]);_e[me]<0?(_e[me]=a.length,a.push([S[N].slice(0)])):a[_e[me]].push(S[N].slice(0))}return a}function $I(S){for(var R=d_(bf(f_(S,0))),z=new w1(R.length),N=0;N<S.length;++N)for(var W=S[N],X=0;X<W.length;++X)for(var te=lf(R,[W[X]]),a=X+1;a<W.length;++a)z.link(te,lf(R,[W[a]]));for(var _e=[],me=z.ranks,N=0;N<me.length;++N)me[N]=-1;for(var N=0;N<S.length;++N){var xe=z.find(lf(R,[S[N][0]]));me[xe]<0?(me[xe]=_e.length,_e.push([S[N].slice(0)])):_e[me[xe]].push(S[N].slice(0))}return _e}function XI(S,R){return R?WI(S,R):$I(S)}da.connectedComponents=XI;var YI=tT,Ug=c_,JI=da.compareCells;function Dp(S,R,z){this.vertices=S,this.adjacent=R,this.boundary=z,this.lastVisited=-1}Dp.prototype.flip=function(){var S=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=S;var R=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=R};function KI(S,R,z){this.vertices=S,this.cell=R,this.index=z}function QI(S,R){return JI(S.vertices,R.vertices)}function eT(S){for(var R=["function orient(){var tuple=this.tuple;return test("],z=0;z<=S;++z)z>0&&R.push(","),R.push("tuple[",z,"]");R.push(")}return orient");var N=new Function("test",R.join("")),W=Ug[S+1];return W||(W=Ug),N(W)}var nx=[];function I1(S,R,z){this.dimension=S,this.vertices=R,this.simplices=z,this.interior=z.filter(function(X){return!X.boundary}),this.tuple=new Array(S+1);for(var N=0;N<=S;++N)this.tuple[N]=this.vertices[N];var W=nx[S];W||(W=nx[S]=eT(S)),this.orient=W}var wf=I1.prototype;wf.handleBoundaryDegeneracy=function(S,R){var z=this.dimension,N=this.vertices.length-1,W=this.tuple,X=this.vertices,te=[S];for(S.lastVisited=-N;te.length>0;){S=te.pop(),S.vertices;for(var a=S.adjacent,_e=0;_e<=z;++_e){var me=a[_e];if(!(!me.boundary||me.lastVisited<=-N)){for(var xe=me.vertices,Se=0;Se<=z;++Se){var Te=xe[Se];Te<0?W[Se]=R:W[Se]=X[Te]}var Qe=this.orient();if(Qe>0)return me;me.lastVisited=-N,Qe===0&&te.push(me)}}}return null};wf.walk=function(S,R){var z=this.vertices.length-1,N=this.dimension,W=this.vertices,X=this.tuple,te=R?this.interior.length*Math.random()|0:this.interior.length-1,a=this.interior[te];e:for(;!a.boundary;){for(var _e=a.vertices,me=a.adjacent,xe=0;xe<=N;++xe)X[xe]=W[_e[xe]];a.lastVisited=z;for(var xe=0;xe<=N;++xe){var Se=me[xe];if(!(Se.lastVisited>=z)){var Te=X[xe];X[xe]=S;var Qe=this.orient();if(X[xe]=Te,Qe<0){a=Se;continue e}else Se.boundary?Se.lastVisited=-z:Se.lastVisited=z}}return}return a};wf.addPeaks=function(S,R){var z=this.vertices.length-1,N=this.dimension,W=this.vertices,X=this.tuple,te=this.interior,a=this.simplices,_e=[R];R.lastVisited=z,R.vertices[R.vertices.indexOf(-1)]=z,R.boundary=!1,te.push(R);for(var me=[];_e.length>0;){var R=_e.pop(),xe=R.vertices,Se=R.adjacent,Te=xe.indexOf(z);if(!(Te<0)){for(var Qe=0;Qe<=N;++Qe)if(Qe!==Te){var Pe=Se[Qe];if(!(!Pe.boundary||Pe.lastVisited>=z)){var ve=Pe.vertices;if(Pe.lastVisited!==-z){for(var Nt=0,wt=0;wt<=N;++wt)ve[wt]<0?(Nt=wt,X[wt]=S):X[wt]=W[ve[wt]];var Bt=this.orient();if(Bt>0){ve[Nt]=z,Pe.boundary=!1,te.push(Pe),_e.push(Pe),Pe.lastVisited=z;continue}else Pe.lastVisited=-z}var je=Pe.adjacent,Ae=xe.slice(),pt=Se.slice(),en=new Dp(Ae,pt,!0);a.push(en);var ze=je.indexOf(R);if(!(ze<0)){je[ze]=en,pt[Te]=Pe,Ae[Qe]=-1,pt[Qe]=R,Se[Qe]=en,en.flip();for(var wt=0;wt<=N;++wt){var ft=Ae[wt];if(!(ft<0||ft===z)){for(var et=new Array(N-1),ht=0,it=0;it<=N;++it){var le=Ae[it];le<0||it===wt||(et[ht++]=le)}me.push(new KI(et,en,wt))}}}}}}}me.sort(QI);for(var Qe=0;Qe+1<me.length;Qe+=2){var kt=me[Qe],zn=me[Qe+1],Qt=kt.index,ri=zn.index;Qt<0||ri<0||(kt.cell.adjacent[kt.index]=zn.cell,zn.cell.adjacent[zn.index]=kt.cell)}};wf.insert=function(S,R){var z=this.vertices;z.push(S);var N=this.walk(S,R);if(N){for(var W=this.dimension,X=this.tuple,te=0;te<=W;++te){var a=N.vertices[te];a<0?X[te]=S:X[te]=z[a]}var _e=this.orient(X);_e<0||_e===0&&(N=this.handleBoundaryDegeneracy(N,S),!N)||this.addPeaks(S,N)}};wf.boundary=function(){for(var S=this.dimension,R=[],z=this.simplices,N=z.length,W=0;W<N;++W){var X=z[W];if(X.boundary){for(var te=new Array(S),a=X.vertices,_e=0,me=0,xe=0;xe<=S;++xe)a[xe]>=0?te[_e++]=a[xe]:me=xe&1;if(me===(S&1)){var Se=te[0];te[0]=te[1],te[1]=Se}R.push(te)}}return R};function tT(S,R){var z=S.length;if(z===0)throw new Error("Must have at least d+1 points");var N=S[0].length;if(z<=N)throw new Error("Must input at least d+1 points");var W=S.slice(0,N+1),X=Ug.apply(void 0,W);if(X===0)throw new Error("Input not in general position");for(var te=new Array(N+1),a=0;a<=N;++a)te[a]=a;X<0&&(te[0]=1,te[1]=0);for(var _e=new Dp(te,new Array(N+1),!1),me=_e.adjacent,xe=new Array(N+2),a=0;a<=N;++a){for(var Se=te.slice(),Te=0;Te<=N;++Te)Te===a&&(Se[Te]=-1);var Qe=Se[0];Se[0]=Se[1],Se[1]=Qe;var Pe=new Dp(Se,new Array(N+1),!0);me[a]=Pe,xe[a]=Pe}xe[N+1]=_e;for(var a=0;a<=N;++a)for(var Se=me[a].vertices,ve=me[a].adjacent,Te=0;Te<=N;++Te){var Nt=Se[Te];if(Nt<0){ve[Te]=_e;continue}for(var wt=0;wt<=N;++wt)me[wt].vertices.indexOf(Nt)<0&&(ve[Te]=me[wt])}for(var Bt=new I1(N,W,xe),je=!!R,a=N+1;a<z;++a)Bt.insert(S[a],je);return Bt.boundary()}var nT=sT,iT=c_;function rT(S,R){for(var z=new Array(R+1),N=0;N<S.length;++N)z[N]=S[N];for(var N=0;N<=S.length;++N){for(var W=S.length;W<=R;++W){for(var X=new Array(R),te=0;te<R;++te)X[te]=Math.pow(W+1-N,te);z[W]=X}var a=iT.apply(void 0,z);if(a)return!0}return!1}function sT(S){var R=S.length;if(R===0)return[];if(R===1)return[0];for(var z=S[0].length,N=[S[0]],W=[0],X=1;X<R;++X){if(N.push(S[X]),!rT(N,z)){N.pop();continue}if(W.push(X),W.length===z+1)return W}return W}var oT=cT,ix=YI,aT=nT;function lT(S,R){for(var z=S.length,N=new Array(z),W=0;W<R.length;++W)N[W]=S[R[W]];for(var X=R.length,W=0;W<z;++W)R.indexOf(W)<0&&(N[X++]=S[W]);return N}function uT(S,R){for(var z=S.length,N=R.length,W=0;W<z;++W)for(var X=S[W],te=0;te<X.length;++te){var a=X[te];if(a<N)X[te]=R[a];else{a=a-N;for(var _e=0;_e<N;++_e)a>=R[_e]&&(a+=1);X[te]=a}}return S}function cT(S,R){try{return ix(S,!0)}catch{var z=aT(S);if(z.length<=R)return[];var N=lT(S,z),W=ix(N,!0);return uT(W,z)}}var hT=xI,dT=zI,fT=oT,pT=mT;function mT(S){var R=S.length;if(R===0)return[];if(R===1)return[[0]];var z=S[0].length;return z===0?[]:z===1?hT(S):z===2?dT(S):fT(S,z)}var gT=Il.coordEach,_T=pT,yT=ii.polygon,vT=function(S){var R=[];gT(S,function(X){R.push(X)});var z=_T(R);if(z.length>0){for(var N=[],W=0;W<z.length;W++)N.push(R[z[W][0]]);return N.push(R[z[z.length-1][1]]),yT([N])}},xT=cd,bT=ii.featureCollection,wT=function(S,R){for(var z=bT([]),N=0;N<R.features.length;N++)for(var W=0;W<S.features.length;W++){var X=xT(S.features[W],R.features[N]);X&&z.features.push(S.features[W])}return z},Gg={exports:{}};(function(S,R){(function(z,N){N(R)})(u1,function(z){function N(e,r){for(var u in r)r.hasOwnProperty(u)&&(e[u]=r[u])}function W(){}function X(){}function te(){}function a(){}function _e(){}function me(){}function xe(){}function Se(e){this.message=e}function Te(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e}function Qe(){if(arguments.length===0)Se.call(this);else if(arguments.length===1){var e=arguments[0];Se.call(this,e)}}function Pe(){}function ve(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)ve.call(this,0,0);else if(arguments.length===1){var e=arguments[0];ve.call(this,e.x,e.y,e.z)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];ve.call(this,r,u,ve.NULL_ORDINATE)}else if(arguments.length===3){var g=arguments[0],w=arguments[1],O=arguments[2];this.x=g,this.y=w,this.z=O}}function Nt(){if(this.dimensionsToTest=2,arguments.length===0)Nt.call(this,2);else if(arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new X;this.dimensionsToTest=e}}function wt(){}function Bt(){}function je(e){this.message=e||""}function Ae(){}function pt(e){this.message=e||""}function en(e){this.message=e||""}function ze(){this.array_=[],arguments[0]instanceof Bt&&this.addAll(arguments[0])}function ft(){if(ze.apply(this),arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.ensureCapacity(r.length),this.add(r,u)}}}function et(){if(this.minx=null,this.maxx=null,this.miny=null,this.maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof ve){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof et){var r=arguments[0];this.init(r)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.init(u.x,g.x,u.y,g.y)}else if(arguments.length===4){var w=arguments[0],O=arguments[1],H=arguments[2],Q=arguments[3];this.init(w,O,H,Q)}}function ht(){}function it(){ht.call(this,"Projective point not representable on the Cartesian plane.")}function le(){}function kt(e,r){return e.interfaces_&&e.interfaces_().indexOf(r)>-1}function zn(){}function Qt(e){this.str=e}function ri(e){this.value=e}function Zi(){}function dt(){if(this.hi=0,this.lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof dt){var r=arguments[0];this.init(r)}else if(typeof arguments[0]=="string"){var u=arguments[0];dt.call(this,dt.parse(u))}}else if(arguments.length===2){var g=arguments[0],w=arguments[1];this.init(g,w)}}function tn(){}function Vn(){}function xi(){}function hr(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],u=arguments[1];this.x=r,this.y=u,this.w=1}else if(arguments[0]instanceof hr&&arguments[1]instanceof hr){var g=arguments[0],w=arguments[1];this.x=g.y*w.w-w.y*g.w,this.y=w.x*g.w-g.x*w.w,this.w=g.x*w.y-w.x*g.y}else if(arguments[0]instanceof ve&&arguments[1]instanceof ve){var O=arguments[0],H=arguments[1];this.x=O.y-H.y,this.y=H.x-O.x,this.w=O.x*H.y-H.x*O.y}}else if(arguments.length===3){var Q=arguments[0],ye=arguments[1],Ue=arguments[2];this.x=Q,this.y=ye,this.w=Ue}else if(arguments.length===4){var ct=arguments[0],yt=arguments[1],Ft=arguments[2],sn=arguments[3],Tn=ct.y-yt.y,Pn=yt.x-ct.x,Ai=ct.x*yt.y-yt.x*ct.y,er=Ft.y-sn.y,Ds=sn.x-Ft.x,oa=Ft.x*sn.y-sn.x*Ft.y;this.x=Pn*oa-Ds*Ai,this.y=er*Ai-Tn*oa,this.w=Tn*Ds-er*Pn}}function _n(){}function es(){}function Jt(){this.envelope=null,this.factory=null,this.SRID=null,this.userData=null;var e=arguments[0];this.factory=e,this.SRID=e.getSRID()}function Ur(){}function tr(){}function Ha(){}function Go(){}function Ve(){}function no(){}function bn(){}function Tl(){}function Lt(){}function Zs(){}function Gr(){}function io(){}function pn(){this.array_=[],arguments[0]instanceof Bt&&this.addAll(arguments[0])}function Lr(e){return e==null?xo:e.color}function si(e){return e==null?null:e.parent}function _s(e,r){e!==null&&(e.color=r)}function qo(e){return e==null?null:e.left}function Sl(e){return e==null?null:e.right}function nn(){this.root_=null,this.size_=0}function fa(){}function jo(){}function dr(){this.array_=[],arguments[0]instanceof Bt&&this.addAll(arguments[0])}function ir(){}function Rt(){}function Fs(){}function So(){}function jn(){this.geometries=null;var e=arguments[0],r=arguments[1];if(Jt.call(this,r),e===null&&(e=[]),Jt.hasNullElements(e))throw new X;this.geometries=e}function fr(){var e=arguments[0],r=arguments[1];jn.call(this,e,r)}function Ms(){if(this.geom=null,this.geomFact=null,this.bnRule=null,this.endpointMap=null,arguments.length===1){var e=arguments[0];Ms.call(this,e,tr.MOD2_BOUNDARY_RULE)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.geom=r,this.geomFact=r.getFactory(),this.bnRule=u}}function Za(){this.count=null}function ro(){}function qu(){}function Xn(){}function Ho(){}function Ic(){}function Ws(){}function Rr(){}function Yi(){}function Fn(){this.points=null;var e=arguments[0],r=arguments[1];Jt.call(this,r),this.init(e)}function pa(){}function Fi(){this.coordinates=null;var e=arguments[0],r=arguments[1];Jt.call(this,r),this.init(e)}function Ke(){}function ne(){this.shell=null,this.holes=null;var e=arguments[0],r=arguments[1],u=arguments[2];if(Jt.call(this,u),e===null&&(e=this.getFactory().createLinearRing()),r===null&&(r=[]),Jt.hasNullElements(r))throw new X;if(e.isEmpty()&&Jt.hasNonEmptyElements(r))throw new X;this.shell=e,this.holes=r}function oe(){var e=arguments[0],r=arguments[1];jn.call(this,e,r)}function ge(){if(arguments[0]instanceof ve&&arguments[1]instanceof Zn){var e=arguments[0],r=arguments[1];ge.call(this,r.getCoordinateSequenceFactory().create(e),r)}else if(kt(arguments[0],Vn)&&arguments[1]instanceof Zn){var u=arguments[0],g=arguments[1];Fn.call(this,u,g),this.validateConstruction()}}function Oe(){var e=arguments[0],r=arguments[1];jn.call(this,e,r)}function Ce(){if(this.factory=null,this.isUserDataCopied=!1,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.factory=e}}}function qe(){}function tt(){}function We(){}function nt(){}function st(){if(this.dimension=3,this.coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];st.call(this,e,3)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.coordinates=new Array(r).fill(null);for(var u=0;r>u;u++)this.coordinates[u]=new ve}else if(kt(arguments[0],Vn)){var g=arguments[0];if(g===null)return this.coordinates=new Array(0).fill(null),null;this.dimension=g.getDimension(),this.coordinates=new Array(g.size()).fill(null);for(var u=0;u<this.coordinates.length;u++)this.coordinates[u]=g.getCoordinateCopy(u)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var w=arguments[0],O=arguments[1];this.coordinates=w,this.dimension=O,w===null&&(this.coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var H=arguments[0],Q=arguments[1];this.coordinates=new Array(H).fill(null),this.dimension=Q;for(var u=0;H>u;u++)this.coordinates[u]=new ve}}}function lt(){}function Tt(e,r){return e===r||e!==e&&r!==r}function Vt(e,r){function u(g){return this&&this.constructor===u?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=r,void(g&&Xt.call(this,g))):new u(g)}return ko(e,"size",{get:ts}),e.constructor=u,u.prototype=e,u}function Xt(e){this.add?e.forEach(this.add,this):e.forEach(function(r){this.set(r[0],r[1])},this)}function yn(e){return this.has(e)&&(this._keys.splice(Ks,1),this._values.splice(Ks,1),this._itp.forEach(function(r){Ks<r[0]&&r[0]--})),Ks>-1}function En(e){return this.has(e)?this._values[Ks]:void 0}function In(e,r){if(this.objectOnly&&r!==Object(r))throw new TypeError("Invalid value used as weak collection key");if(r!==r||r===0)for(Ks=e.length;Ks--&&!Tt(e[Ks],r););else Ks=e.indexOf(r);return Ks>-1}function vn(e){return In.call(this,this._keys,e)}function ui(e,r){return this.has(e)?this._values[Ks]=r:this._values[this._keys.push(e)-1]=r,this}function Yn(){(this._keys||0).length=this._values.length=0}function Dn(){return vr(this._itp,this._keys)}function bi(){return vr(this._itp,this._values)}function ki(){return vr(this._itp,this._keys,this._values)}function vr(e,r,u){var g=[0],w=!1;return e.push(g),{next:function(){var O,H=g[0];return!w&&H<r.length?(O=u?[r[H],u[H]]:r[H],g[0]++):(w=!0,e.splice(e.indexOf(g),1)),{done:w,value:O}}}}function ts(){return this._values.length}function xr(e,r){for(var u=this.entries();;){var g=u.next();if(g.done)break;e.call(r,g.value[1],g.value[0],this)}}function Ji(){this.map_=new fd}function oi(){if(this.modelType=null,this.scale=null,arguments.length===0)this.modelType=oi.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Dr){var e=arguments[0];this.modelType=e,e===oi.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var r=arguments[0];this.modelType=oi.FIXED,this.setScale(r)}else if(arguments[0]instanceof oi){var u=arguments[0];this.modelType=u.modelType,this.scale=u.scale}}}function Dr(){this.name=null;var e=arguments[0];this.name=e,Dr.nameToTypeMap.put(e,this)}function Zn(){if(this.precisionModel=null,this.coordinateSequenceFactory=null,this.SRID=null,arguments.length===0)Zn.call(this,new oi,0);else if(arguments.length===1){if(kt(arguments[0],_n)){var e=arguments[0];Zn.call(this,new oi,0,e)}else if(arguments[0]instanceof oi){var r=arguments[0];Zn.call(this,r,0,Zn.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];Zn.call(this,u,g,Zn.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2];this.precisionModel=w,this.coordinateSequenceFactory=H,this.SRID=O}}function uu(e){this.geometryFactory=e||new Zn}function Er(e){this.parser=new uu(e)}function Si(){this.result=null,this.inputLines=Array(2).fill().map(function(){return Array(2)}),this.intPt=new Array(2).fill(null),this.intLineIndex=null,this._isProper=null,this.pa=null,this.pb=null,this.precisionModel=null,this.intPt[0]=new ve,this.intPt[1]=new ve,this.pa=this.intPt[0],this.pb=this.intPt[1],this.result=0}function pr(){Si.apply(this)}function so(){}function oo(){this.p=null,this.crossingCount=0,this.isPointOnSegment=!1;var e=arguments[0];this.p=e}function zt(){}function Sn(){if(this.p0=null,this.p1=null,arguments.length===0)Sn.call(this,new ve,new ve);else if(arguments.length===1){var e=arguments[0];Sn.call(this,e.p0,e.p1)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.p0=r,this.p1=u}else if(arguments.length===4){var g=arguments[0],w=arguments[1],O=arguments[2],H=arguments[3];Sn.call(this,new ve(g,w),new ve(O,H))}}function Jn(){if(this.matrix=null,arguments.length===0)this.matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(Rt.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var e=arguments[0];Jn.call(this),this.set(e)}else if(arguments[0]instanceof Jn){var r=arguments[0];Jn.call(this),this.matrix[le.INTERIOR][le.INTERIOR]=r.matrix[le.INTERIOR][le.INTERIOR],this.matrix[le.INTERIOR][le.BOUNDARY]=r.matrix[le.INTERIOR][le.BOUNDARY],this.matrix[le.INTERIOR][le.EXTERIOR]=r.matrix[le.INTERIOR][le.EXTERIOR],this.matrix[le.BOUNDARY][le.INTERIOR]=r.matrix[le.BOUNDARY][le.INTERIOR],this.matrix[le.BOUNDARY][le.BOUNDARY]=r.matrix[le.BOUNDARY][le.BOUNDARY],this.matrix[le.BOUNDARY][le.EXTERIOR]=r.matrix[le.BOUNDARY][le.EXTERIOR],this.matrix[le.EXTERIOR][le.INTERIOR]=r.matrix[le.EXTERIOR][le.INTERIOR],this.matrix[le.EXTERIOR][le.BOUNDARY]=r.matrix[le.EXTERIOR][le.BOUNDARY],this.matrix[le.EXTERIOR][le.EXTERIOR]=r.matrix[le.EXTERIOR][le.EXTERIOR]}}}function mr(){this.areaBasePt=null,this.triangleCent3=new ve,this.areasum2=0,this.cg3=new ve,this.lineCentSum=new ve,this.totalLength=0,this.ptCount=0,this.ptCentSum=new ve;var e=arguments[0];this.areaBasePt=null,this.add(e)}function $s(e){this.message=e||""}function Ir(){this.array_=[]}function Wa(){this.treeSet=new dr,this.list=new ze}function ao(){if(this.geomFactory=null,this.inputPts=null,arguments.length===1){var e=arguments[0];ao.call(this,ao.extractCoordinates(e),e.getFactory())}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.inputPts=Wa.filterCoordinates(r),this.geomFactory=u}}function As(){this.origin=null;var e=arguments[0];this.origin=e}function qr(){this.inputGeom=null,this.factory=null,this.pruneEmptyGeometry=!0,this.preserveGeometryCollectionType=!0,this.preserveCollections=!1,this.preserveType=!1}function Cl(){if(this.snapTolerance=0,this.srcPts=null,this.seg=new Sn,this.allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Fn&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];Cl.call(this,e.getCoordinates(),r)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var u=arguments[0],g=arguments[1];this.srcPts=u,this._isClosed=Cl.isClosed(u),this.snapTolerance=g}}function us(){this.srcGeom=null;var e=arguments[0];this.srcGeom=e}function ns(){if(qr.apply(this),this.snapTolerance=null,this.snapPts=null,this.isSelfSnap=!1,arguments.length===2){var e=arguments[0],r=arguments[1];this.snapTolerance=e,this.snapPts=r}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.snapTolerance=u,this.snapPts=g,this.isSelfSnap=w}}function Tr(){this.isFirst=!0,this.commonMantissaBitsCount=53,this.commonBits=0,this.commonSignExp=null}function ma(){this.commonCoord=null,this.ccFilter=new ga}function ga(){this.commonBitsX=new Tr,this.commonBitsY=new Tr}function Ml(){this.trans=null;var e=arguments[0];this.trans=e}function lo(){this.parent=null,this.atStart=null,this.max=null,this.index=null,this.subcollectionIterator=null;var e=arguments[0];this.parent=e,this.atStart=!0,this.index=0,this.max=e.getNumGeometries()}function _a(){if(this.boundaryRule=tr.OGC_SFS_BOUNDARY_RULE,this.isIn=null,this.numBoundaries=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];if(e===null)throw new X;this.boundaryRule=e}}}function Un(){}function Al(){}function ai(){this.pts=null,this.data=null;var e=arguments[0],r=arguments[1];this.pts=e,this.data=r}function Tc(){}function ln(){this.bounds=null,this.item=null;var e=arguments[0],r=arguments[1];this.bounds=e,this.item=r}function Pl(){this._size=null,this.items=null,this._size=0,this.items=new ze,this.items.add(null)}function ks(){}function ya(){}function Ki(){if(this.childBoundables=new ze,this.bounds=null,this.level=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.level=e}}}function jr(){this.boundable1=null,this.boundable2=null,this._distance=null,this.itemDistance=null;var e=arguments[0],r=arguments[1],u=arguments[2];this.boundable1=e,this.boundable2=r,this.itemDistance=u,this._distance=this.distance()}function Ci(){if(this.root=null,this.built=!1,this.itemBoundables=new ze,this.nodeCapacity=null,arguments.length===0)Ci.call(this,Ci.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var e=arguments[0];Pe.isTrue(e>1,"Node capacity must be greater than 1"),this.nodeCapacity=e}}function Wt(){}function Gn(){}function cn(){if(arguments.length===0)cn.call(this,cn.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var e=arguments[0];Ci.call(this,e)}}function is(){var e=arguments[0];Ki.call(this,e)}function Vi(){}function Wn(){this.segString=null,this.coord=null,this.segmentIndex=null,this.segmentOctant=null,this._isInterior=null;var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3];this.segString=e,this.coord=new ve(r),this.segmentIndex=u,this.segmentOctant=g,this._isInterior=!r.equals2D(e.getCoordinate(u))}function cu(){this.nodeMap=new nn,this.edge=null;var e=arguments[0];this.edge=e}function Ll(){this.nodeList=null,this.edge=null,this.nodeIt=null,this.currNode=null,this.nextNode=null,this.currSegIndex=0;var e=arguments[0];this.nodeList=e,this.edge=e.getEdge(),this.nodeIt=e.iterator(),this.readNextNode()}function $a(){}function rr(){this.nodeList=new cu(this),this.pts=null,this.data=null;var e=arguments[0],r=arguments[1];this.pts=e,this.data=r}function Wi(){this.tempEnv1=new et,this.tempEnv2=new et,this.overlapSeg1=new Sn,this.overlapSeg2=new Sn}function Sc(){this.pts=null,this.start=null,this.end=null,this.env=null,this.context=null,this.id=null;var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3];this.pts=e,this.start=r,this.end=u,this.context=g}function Qn(){}function cs(){}function Bs(){}function Rl(){if(this.segInt=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}}}function Or(){if(this.monoChains=new ze,this.index=new cn,this.idCounter=0,this.nodedSegStrings=null,this.nOverlaps=0,arguments.length!==0){if(arguments.length===1){var e=arguments[0];Rl.call(this,e)}}}function Nr(){Wi.apply(this),this.si=null;var e=arguments[0];this.si=e}function $i(){if(this.pt=null,arguments.length===1){var e=arguments[0];Se.call(this,e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];Se.call(this,$i.msgWithCoord(r,u)),this.pt=new ve(u)}}function hu(){}function ys(){this.findAllIntersections=!1,this.isCheckEndSegmentsOnly=!1,this.li=null,this.interiorIntersection=null,this.intSegments=null,this.intersections=new ze,this.intersectionCount=0,this.keepIntersections=!0;var e=arguments[0];this.li=e,this.interiorIntersection=null}function Qi(){this.li=new pr,this.segStrings=null,this.findAllIntersections=!1,this.segInt=null,this._isValid=!0;var e=arguments[0];this.segStrings=e}function Sr(){this.nv=null;var e=arguments[0];this.nv=new Qi(Sr.toSegmentStrings(e))}function vs(){this.mapOp=null;var e=arguments[0];this.mapOp=e}function At(){}function hs(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[At.ON]=r}else if(arguments[0]instanceof hs){var u=arguments[0];if(this.init(u.location.length),u!==null)for(var g=0;g<this.location.length;g++)this.location[g]=u.location[g]}}else if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2];this.init(3),this.location[At.ON]=w,this.location[At.LEFT]=O,this.location[At.RIGHT]=H}}function Mi(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new hs(e),this.elt[1]=new hs(e)}else if(arguments[0]instanceof Mi){var r=arguments[0];this.elt[0]=new hs(r.elt[0]),this.elt[1]=new hs(r.elt[1])}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.elt[0]=new hs(le.NONE),this.elt[1]=new hs(le.NONE),this.elt[u].setLocation(g)}else if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2];this.elt[0]=new hs(w,O,H),this.elt[1]=new hs(w,O,H)}else if(arguments.length===4){var Q=arguments[0],ye=arguments[1],Ue=arguments[2],ct=arguments[3];this.elt[0]=new hs(le.NONE,le.NONE,le.NONE),this.elt[1]=new hs(le.NONE,le.NONE,le.NONE),this.elt[Q].setLocations(ye,Ue,ct)}}function Co(){this.startDe=null,this.maxNodeDegree=-1,this.edges=new ze,this.pts=new ze,this.label=new Mi(le.NONE),this.ring=null,this._isHole=null,this.shell=null,this.holes=new ze,this.geometryFactory=null;var e=arguments[0],r=arguments[1];this.geometryFactory=r,this.computePoints(e),this.computeRing()}function Zo(){var e=arguments[0],r=arguments[1];Co.call(this,e,r)}function Mo(){var e=arguments[0],r=arguments[1];Co.call(this,e,r)}function Ao(){if(this.label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.label=e}}}function rs(){Ao.apply(this),this.coord=null,this.edges=null;var e=arguments[0],r=arguments[1];this.coord=e,this.edges=r,this.label=new Mi(0,le.NONE)}function du(){this.nodeMap=new nn,this.nodeFact=null;var e=arguments[0];this.nodeFact=e}function uo(){if(this.edge=null,this.label=null,this.node=null,this.p0=null,this.p1=null,this.dx=null,this.dy=null,this.quadrant=null,arguments.length===1){var e=arguments[0];this.edge=e}else if(arguments.length===3){var r=arguments[0],u=arguments[1],g=arguments[2];uo.call(this,r,u,g,null)}else if(arguments.length===4){var w=arguments[0],O=arguments[1],H=arguments[2],Q=arguments[3];uo.call(this,w),this.init(O,H),this.label=Q}}function zr(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this.sym=null,this.next=null,this.nextMin=null,this.edgeRing=null,this.minEdgeRing=null,this.depth=[0,-999,-999];var e=arguments[0],r=arguments[1];if(uo.call(this,e),this._isForward=r,r)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var u=e.getNumPoints()-1;this.init(e.getCoordinate(u),e.getCoordinate(u-1))}this.computeDirectedLabel()}function Dl(){}function Vs(){if(this.edges=new ze,this.nodes=null,this.edgeEndList=new ze,arguments.length===0)this.nodes=new du(new Dl);else if(arguments.length===1){var e=arguments[0];this.nodes=new du(e)}}function ju(){this.geometryFactory=null,this.shellList=new ze;var e=arguments[0];this.geometryFactory=e}function Xa(){this.op=null,this.geometryFactory=null,this.ptLocator=null,this.lineEdgesList=new ze,this.resultLineList=new ze;var e=arguments[0],r=arguments[1],u=arguments[2];this.op=e,this.geometryFactory=r,this.ptLocator=u}function Ya(){this.op=null,this.geometryFactory=null,this.resultPointList=new ze;var e=arguments[0],r=arguments[1];this.op=e,this.geometryFactory=r}function Cc(){}function ss(){this.geom=null;var e=arguments[0];this.geom=e}function Xs(){this.edgeMap=new nn,this.edgeList=null,this.ptInAreaLocation=[le.NONE,le.NONE]}function Mc(){Xs.apply(this),this.resultAreaEdgeList=null,this.label=null,this.SCANNING_FOR_INCOMING=1,this.LINKING_TO_OUTGOING=2}function Po(){Dl.apply(this)}function Ac(){this.mce=null,this.chainIndex=null;var e=arguments[0],r=arguments[1];this.mce=e,this.chainIndex=r}function Ys(){if(this.label=null,this.xValue=null,this.eventType=null,this.insertEvent=null,this.deleteEventIndex=null,this.obj=null,arguments.length===2){var e=arguments[0],r=arguments[1];this.eventType=Ys.DELETE,this.xValue=e,this.insertEvent=r}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.eventType=Ys.INSERT,this.label=u,this.xValue=g,this.obj=w}}function xs(){}function An(){this._hasIntersection=!1,this.hasProper=!1,this.hasProperInterior=!1,this.properIntersectionPoint=null,this.li=null,this.includeProper=null,this.recordIsolated=null,this.isSelfIntersection=null,this.numIntersections=0,this.numTests=0,this.bdyNodes=null,this._isDone=!1,this.isDoneWhenProperInt=!1;var e=arguments[0],r=arguments[1],u=arguments[2];this.li=e,this.includeProper=r,this.recordIsolated=u}function rn(){xs.apply(this),this.events=new ze,this.nOverlaps=null}function va(){this.min=te.POSITIVE_INFINITY,this.max=te.NEGATIVE_INFINITY}function xn(){}function fu(){va.apply(this),this.item=null;var e=arguments[0],r=arguments[1],u=arguments[2];this.min=e,this.max=r,this.item=u}function Ja(){va.apply(this),this.node1=null,this.node2=null;var e=arguments[0],r=arguments[1];this.node1=e,this.node2=r,this.buildExtent(this.node1,this.node2)}function mn(){this.leaves=new ze,this.root=null,this.level=0}function Fr(){if(this.lines=null,this.isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this.lines=e}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.lines=r,this.isForcedToLineString=u}}function Ol(){this.items=new ze}function Nl(){this.index=null;var e=arguments[0];if(!kt(e,Ke))throw new X;this.index=new Wo(e)}function Lo(){this.counter=null;var e=arguments[0];this.counter=e}function Wo(){this.index=new mn;var e=arguments[0];this.init(e)}function Hr(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],r=arguments[1],u=arguments[2];this.coord=new ve(e),this.segmentIndex=r,this.dist=u}function pu(){this.nodeMap=new nn,this.edge=null;var e=arguments[0];this.edge=e}function $o(){}function Ka(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new et,this.env2=new et;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var r=new $o;this.startIndex=r.getChainStartIndices(this.pts)}function Ps(){this.depth=Array(2).fill().map(function(){return Array(3)});for(var e=0;2>e;e++)for(var r=0;3>r;r++)this.depth[e][r]=Ps.NULL_VALUE}function Cr(){if(Ao.apply(this),this.pts=null,this.env=null,this.eiList=new pu(this),this.name=null,this.mce=null,this._isIsolated=!0,this.depth=new Ps,this.depthDelta=0,arguments.length===1){var e=arguments[0];Cr.call(this,e,null)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.pts=r,this.label=u}}function li(){if(Vs.apply(this),this.parentGeom=null,this.lineEdgeMap=new Ji,this.boundaryNodeRule=null,this.useBoundaryDeterminationRule=!0,this.argIndex=null,this.boundaryNodes=null,this._hasTooFewPoints=!1,this.invalidPoint=null,this.areaPtLocator=null,this.ptLocator=new _a,arguments.length===2){var e=arguments[0],r=arguments[1];li.call(this,e,r,tr.OGC_SFS_BOUNDARY_RULE)}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.argIndex=u,this.parentGeom=g,this.boundaryNodeRule=w,g!==null&&this.add(g)}}function Xo(){if(this.li=new pr,this.resultPrecisionModel=null,this.arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this.arg=new Array(1).fill(null),this.arg[0]=new li(0,e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];Xo.call(this,r,u,tr.OGC_SFS_BOUNDARY_RULE)}else if(arguments.length===3){var g=arguments[0],w=arguments[1],O=arguments[2];g.getPrecisionModel().compareTo(w.getPrecisionModel())>=0?this.setComputationPrecision(g.getPrecisionModel()):this.setComputationPrecision(w.getPrecisionModel()),this.arg=new Array(2).fill(null),this.arg[0]=new li(0,g,O),this.arg[1]=new li(1,w,O)}}function Mt(){this.pts=null,this._orientation=null;var e=arguments[0];this.pts=e,this._orientation=Mt.orientation(e)}function Hu(){this.edges=new ze,this.ocaMap=new nn}function fn(){this.ptLocator=new _a,this.geomFact=null,this.resultGeom=null,this.graph=null,this.edgeList=new Hu,this.resultPolyList=new ze,this.resultLineList=new ze,this.resultPointList=new ze;var e=arguments[0],r=arguments[1];Xo.call(this,e,r),this.graph=new Vs(new Po),this.geomFact=e.getFactory()}function bs(){this.geom=new Array(2).fill(null),this.snapTolerance=null,this.cbr=null;var e=arguments[0],r=arguments[1];this.geom[0]=e,this.geom[1]=r,this.computeSnapTolerance()}function or(){this.geom=new Array(2).fill(null);var e=arguments[0],r=arguments[1];this.geom[0]=e,this.geom[1]=r}function Ls(){this.factory=null,this.interiorPoint=null,this.maxWidth=0;var e=arguments[0];this.factory=e.getFactory(),this.add(e)}function Us(){this.poly=null,this.centreY=null,this.hiY=te.MAX_VALUE,this.loY=-te.MAX_VALUE;var e=arguments[0];this.poly=e,this.hiY=e.getEnvelopeInternal().getMaxY(),this.loY=e.getEnvelopeInternal().getMinY(),this.centreY=Ls.avg(this.loY,this.hiY)}function mu(){this.centroid=null,this.minDistance=te.MAX_VALUE,this.interiorPoint=null;var e=arguments[0];this.centroid=e.getCentroid().getCoordinate(),this.addInterior(e),this.interiorPoint===null&&this.addEndpoints(e)}function ws(){this.centroid=null,this.minDistance=te.MAX_VALUE,this.interiorPoint=null;var e=arguments[0];this.centroid=e.getCentroid().getCoordinate(),this.add(e)}function On(){}function Ii(){this.p0=null,this.p1=null,this.p2=null;var e=arguments[0],r=arguments[1],u=arguments[2];this.p0=e,this.p1=r,this.p2=u}function Yo(){this.input=null,this.extremalPts=null,this.centre=null,this.radius=0;var e=arguments[0];this.input=e}function Zr(){if(this.inputGeom=null,this.isConvex=null,this.convexHullPts=null,this.minBaseSeg=new Sn,this.minWidthPt=null,this.minPtIndex=null,this.minWidth=0,arguments.length===1){var e=arguments[0];Zr.call(this,e,!1)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.inputGeom=r,this.isConvex=u}}function kr(){this.inputGeom=null,this.distanceTolerance=null;var e=arguments[0];this.inputGeom=e}function gu(){qr.apply(this),this.distanceTolerance=null;var e=arguments[0];this.distanceTolerance=e}function co(){this._orig=null,this._sym=null,this._next=null;var e=arguments[0];this._orig=e}function ds(){this._isMarked=!1;var e=arguments[0];co.call(this,e)}function xa(){this.vertexMap=new Ji}function Zu(){this._isStart=!1;var e=arguments[0];ds.call(this,e)}function Wu(){xa.apply(this)}function _u(){this.result=null,this.factory=null,this.graph=null,this.lines=new ze,this.nodeEdgeStack=new Ir,this.ringStartEdge=null,this.graph=new Wu}function ho(){this.items=new ze,this.subnode=new Array(4).fill(null)}function ba(){}function Rh(e,r){var u,g,w,O,H={32:{d:127,c:128,b:0,a:0},64:{d:32752,c:0,b:0,a:0}},Q={32:8,64:11}[e];if(O||(u=0>r||0>1/r,isFinite(r)||(O=H[e],u&&(O.d+=1<<e/4-1),g=Math.pow(2,Q)-1,w=0)),!O){for(g={32:127,64:1023}[e],w=Math.abs(r);w>=2;)g++,w/=2;for(;1>w&&g>0;)g--,w*=2;0>=g&&(w/=2)}return g}function wa(){this.pt=new ve,this.level=0,this.env=null;var e=arguments[0];this.computeKey(e)}function fo(){ho.apply(this),this.env=null,this.centrex=null,this.centrey=null,this.level=null;var e=arguments[0],r=arguments[1];this.env=e,this.level=r,this.centrex=(e.getMinX()+e.getMaxX())/2,this.centrey=(e.getMinY()+e.getMaxY())/2}function po(){}function mo(){ho.apply(this)}function go(){this.root=null,this.minExtent=1,this.root=new mo}function yu(e){this.geometryFactory=e||new Zn}function Ea(e){this.geometryFactory=e||new Zn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new yu(this.geometryFactory)}function Ia(){this.parser=new yu(this.geometryFactory)}function qn(e){this.geometryFactory=e||new Zn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new uu(this.geometryFactory)}function Jo(e){return[e.x,e.y]}function vu(e){this.geometryFactory=e||new Zn}function Qa(){if(this.noder=null,this.scaleFactor=null,this.offsetX=null,this.offsetY=null,this.isScaled=!1,arguments.length===2){var e=arguments[0],r=arguments[1];Qa.call(this,e,r,0,0)}else if(arguments.length===4){var u=arguments[0],g=arguments[1];this.noder=u,this.scaleFactor=g,this.isScaled=!this.isIntegerPrecision()}}function Ta(){if(this.inputGeom=null,this.isClosedEndpointsInInterior=!0,this.nonSimpleLocation=null,arguments.length===1){var e=arguments[0];this.inputGeom=e}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.inputGeom=r,this.isClosedEndpointsInInterior=!u.isInBoundary(2)}}function Sa(){this.pt=null,this.isClosed=null,this.degree=null;var e=arguments[0];this.pt=e,this.isClosed=!1,this.degree=0}function dn(){if(this.quadrantSegments=dn.DEFAULT_QUADRANT_SEGMENTS,this.endCapStyle=dn.CAP_ROUND,this.joinStyle=dn.JOIN_ROUND,this.mitreLimit=dn.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this.simplifyFactor=dn.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(u)}else if(arguments.length===4){var g=arguments[0],w=arguments[1],O=arguments[2],H=arguments[3];this.setQuadrantSegments(g),this.setEndCapStyle(w),this.setJoinStyle(O),this.setMitreLimit(H)}}}function $u(){this.minIndex=-1,this.minCoord=null,this.minDe=null,this.orientedDe=null}function Xu(){this.array_=[]}function Yu(){this.finder=null,this.dirEdgeList=new ze,this.nodes=new ze,this.rightMostCoord=null,this.env=null,this.finder=new $u}function br(){this.inputLine=null,this.distanceTol=null,this.isDeleted=null,this.angleOrientation=zt.COUNTERCLOCKWISE;var e=arguments[0];this.inputLine=e}function Ca(){this.ptList=null,this.precisionModel=null,this.minimimVertexDistance=0,this.ptList=new ze}function _o(){this.maxCurveSegmentError=0,this.filletAngleQuantum=null,this.closingSegLengthFactor=1,this.segList=null,this.distance=0,this.precisionModel=null,this.bufParams=null,this.li=null,this.s0=null,this.s1=null,this.s2=null,this.seg0=new Sn,this.seg1=new Sn,this.offset0=new Sn,this.offset1=new Sn,this.side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],r=arguments[1],u=arguments[2];this.precisionModel=e,this.bufParams=r,this.li=new pr,this.filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===dn.JOIN_ROUND&&(this.closingSegLengthFactor=_o.MAX_CLOSING_SEG_LEN_FACTOR),this.init(u)}function xu(){this.distance=0,this.precisionModel=null,this.bufParams=null;var e=arguments[0],r=arguments[1];this.precisionModel=e,this.bufParams=r}function Ju(){this.subgraphs=null,this.seg=new Sn,this.cga=new zt;var e=arguments[0];this.subgraphs=e}function Ma(){this.upwardSeg=null,this.leftDepth=null;var e=arguments[0],r=arguments[1];this.upwardSeg=new Sn(e),this.leftDepth=r}function Pc(){this.inputGeom=null,this.distance=null,this.curveBuilder=null,this.curveList=new ze;var e=arguments[0],r=arguments[1],u=arguments[2];this.inputGeom=e,this.distance=r,this.curveBuilder=u}function Ku(){this._hasIntersection=!1,this.hasProper=!1,this.hasProperInterior=!1,this.hasInterior=!1,this.properIntersectionPoint=null,this.li=null,this.isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this.li=e}function el(){this.bufParams=null,this.workingPrecisionModel=null,this.workingNoder=null,this.geomFact=null,this.graph=null,this.edgeList=new Hu;var e=arguments[0];this.bufParams=e}function Qu(){this.li=new pr,this.segStrings=null;var e=arguments[0];this.segStrings=e}function tl(){this.li=null,this.pt=null,this.originalPt=null,this.ptScaled=null,this.p0Scaled=null,this.p1Scaled=null,this.scaleFactor=null,this.minx=null,this.maxx=null,this.miny=null,this.maxy=null,this.corner=new Array(4).fill(null),this.safeEnv=null;var e=arguments[0],r=arguments[1],u=arguments[2];if(this.originalPt=e,this.pt=e,this.scaleFactor=r,this.li=u,0>=r)throw new X;r!==1&&(this.pt=new ve(this.scale(e.x),this.scale(e.y)),this.p0Scaled=new ve,this.p1Scaled=new ve),this.initCorners(this.pt)}function Ko(){this.tempEnv1=new et,this.selectedSegment=new Sn}function bu(){this.index=null;var e=arguments[0];this.index=e}function zl(){Ko.apply(this),this.hotPixel=null,this.parentEdge=null,this.hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],r=arguments[1],u=arguments[2];this.hotPixel=e,this.parentEdge=r,this.hotPixelVertexIndex=u}function Lc(){this.li=null,this.interiorIntersections=null;var e=arguments[0];this.li=e,this.interiorIntersections=new ze}function Rc(){this.pm=null,this.li=null,this.scaleFactor=null,this.noder=null,this.pointSnapper=null,this.nodedSegStrings=null;var e=arguments[0];this.pm=e,this.li=new pr,this.li.setPrecisionModel(e),this.scaleFactor=e.getScale()}function Wr(){if(this.argGeom=null,this.distance=null,this.bufParams=new dn,this.resultGeometry=null,this.saveException=null,arguments.length===1){var e=arguments[0];this.argGeom=e}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.argGeom=r,this.bufParams=u}}function Ro(){this.comps=null;var e=arguments[0];this.comps=e}function $r(){if(this.component=null,this.segIndex=null,this.pt=null,arguments.length===2){var e=arguments[0],r=arguments[1];$r.call(this,e,$r.INSIDE_AREA,r)}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.component=u,this.segIndex=g,this.pt=w}}function nl(){this.pts=null;var e=arguments[0];this.pts=e}function fs(){this.locations=null;var e=arguments[0];this.locations=e}function Gs(){if(this.geom=null,this.terminateDistance=0,this.ptLocator=new _a,this.minDistanceLocation=null,this.minDistance=te.MAX_VALUE,arguments.length===2){var e=arguments[0],r=arguments[1];Gs.call(this,e,r,0)}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.geom=new Array(2).fill(null),this.geom[0]=u,this.geom[1]=g,this.terminateDistance=w}}function wu(){this.factory=null,this.directedEdges=new ze,this.coordinates=null;var e=arguments[0];this.factory=e}function Es(){this._isMarked=!1,this._isVisited=!1,this.data=null}function Is(){Es.apply(this),this.parentEdge=null,this.from=null,this.to=null,this.p0=null,this.p1=null,this.sym=null,this.edgeDirection=null,this.quadrant=null,this.angle=null;var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3];this.from=e,this.to=r,this.edgeDirection=g,this.p0=e.getCoordinate(),this.p1=u;var w=this.p1.x-this.p0.x,O=this.p1.y-this.p0.y;this.quadrant=Qn.quadrant(w,O),this.angle=Math.atan2(O,w)}function Fl(){var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3];Is.call(this,e,r,u,g)}function qs(){if(Es.apply(this),this.dirEdge=null,arguments.length!==0){if(arguments.length===2){var e=arguments[0],r=arguments[1];this.setDirectedEdges(e,r)}}}function ec(){this.outEdges=new ze,this.sorted=!1}function js(){if(Es.apply(this),this.pt=null,this.deStar=null,arguments.length===1){var e=arguments[0];js.call(this,e,new ec)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.pt=r,this.deStar=u}}function kl(){qs.apply(this),this.line=null;var e=arguments[0];this.line=e}function tc(){this.nodeMap=new nn}function Bl(){this.edges=new pn,this.dirEdges=new pn,this.nodeMap=new tc}function Aa(){Bl.apply(this)}function uh(){this.graph=new Aa,this.mergedLineStrings=null,this.factory=null,this.edgeStrings=null}function Eu(){this.edgeRing=null,this.next=null,this.label=-1;var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3];Is.call(this,e,r,u,g)}function nc(){qs.apply(this),this.line=null;var e=arguments[0];this.line=e}function ps(){this.factory=null,this.deList=new ze,this.lowestEdge=null,this.ring=null,this.ringPts=null,this.holes=null,this.shell=null,this._isHole=null,this._isProcessed=!1,this._isIncludedSet=!1,this._isIncluded=!1;var e=arguments[0];this.factory=e}function Dc(){}function gr(){Bl.apply(this),this.factory=null;var e=arguments[0];this.factory=e}function ms(){if(this.lineStringAdder=new il(this),this.graph=null,this.dangles=new ze,this.cutEdges=new ze,this.invalidRingLines=new ze,this.holeList=null,this.shellList=null,this.polyList=null,this.isCheckingRingsValid=!0,this.extractOnlyPolygonal=null,this.geomFactory=null,arguments.length===0)ms.call(this,!1);else if(arguments.length===1){var e=arguments[0];this.extractOnlyPolygonal=e}}function il(){this.p=null;var e=arguments[0];this.p=e}function Vl(){}function Qo(){if(this.edgeEnds=new ze,arguments.length===1){var e=arguments[0];Qo.call(this,null,e)}else if(arguments.length===2){var r=arguments[1];uo.call(this,r.getEdge(),r.getCoordinate(),r.getDirectedCoordinate(),new Mi(r.getLabel())),this.insert(r)}}function ic(){Xs.apply(this)}function Iu(){var e=arguments[0],r=arguments[1];rs.call(this,e,r)}function Ul(){Dl.apply(this)}function Tu(){this.li=new pr,this.ptLocator=new _a,this.arg=null,this.nodes=new du(new Ul),this.im=null,this.isolatedEdges=new ze,this.invalidPoint=null;var e=arguments[0];this.arg=e}function Do(){this.rectEnv=null;var e=arguments[0];this.rectEnv=e.getEnvelopeInternal()}function Oc(){this.li=new pr,this.rectEnv=null,this.diagUp0=null,this.diagUp1=null,this.diagDown0=null,this.diagDown1=null;var e=arguments[0];this.rectEnv=e,this.diagUp0=new ve(e.getMinX(),e.getMinY()),this.diagUp1=new ve(e.getMaxX(),e.getMaxY()),this.diagDown0=new ve(e.getMinX(),e.getMaxY()),this.diagDown1=new ve(e.getMaxX(),e.getMinY())}function Ts(){this._isDone=!1}function Pa(){this.rectangle=null,this.rectEnv=null;var e=arguments[0];this.rectangle=e,this.rectEnv=e.getEnvelopeInternal()}function ea(){Ts.apply(this),this.rectEnv=null,this._intersects=!1;var e=arguments[0];this.rectEnv=e}function rc(){Ts.apply(this),this.rectSeq=null,this.rectEnv=null,this._containsPoint=!1;var e=arguments[0];this.rectSeq=e.getExteriorRing().getCoordinateSequence(),this.rectEnv=e.getEnvelopeInternal()}function Su(){Ts.apply(this),this.rectEnv=null,this.rectIntersector=null,this.hasIntersection=!1,this.p0=new ve,this.p1=new ve;var e=arguments[0];this.rectEnv=e.getEnvelopeInternal(),this.rectIntersector=new Oc(this.rectEnv)}function ci(){if(this._relate=null,arguments.length===2){var e=arguments[0],r=arguments[1];Xo.call(this,e,r),this._relate=new Tu(this.arg)}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];Xo.call(this,u,g,w),this._relate=new Tu(this.arg)}}function Ss(){this.geomFactory=null,this.skipEmpty=!1,this.inputGeoms=null;var e=arguments[0];this.geomFactory=Ss.extractFactory(e),this.inputGeoms=e}function Cu(){this.pointGeom=null,this.otherGeom=null,this.geomFact=null;var e=arguments[0],r=arguments[1];this.pointGeom=e,this.otherGeom=r,this.geomFact=r.getFactory()}function ta(){this.sortIndex=-1,this.comps=null;var e=arguments[0],r=arguments[1];this.sortIndex=e,this.comps=r}function gs(){this.inputPolys=null,this.geomFactory=null;var e=arguments[0];this.inputPolys=e,this.inputPolys===null&&(this.inputPolys=new ze)}function rl(){if(this.polygons=new ze,this.lines=new ze,this.points=new ze,this.geomFact=null,arguments.length===1){if(kt(arguments[0],Bt)){var e=arguments[0];this.extract(e)}else if(arguments[0]instanceof Jt){var r=arguments[0];this.extract(r)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.geomFact=g,this.extract(u)}}function sc(){this.geometryFactory=new Zn,this.geomGraph=null,this.disconnectedRingcoord=null;var e=arguments[0];this.geomGraph=e}function Js(){this.items=new ze,this.subnode=[null,null]}function na(){if(this.min=null,this.max=null,arguments.length===0)this.min=0,this.max=0;else if(arguments.length===1){var e=arguments[0];this.init(e.min,e.max)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.init(r,u)}}function Gl(){this.pt=0,this.level=0,this.interval=null;var e=arguments[0];this.computeKey(e)}function yo(){Js.apply(this),this.interval=null,this.centre=null,this.level=null;var e=arguments[0],r=arguments[1];this.interval=e,this.level=r,this.centre=(e.getMin()+e.getMax())/2}function Oo(){Js.apply(this)}function La(){this.root=null,this.minExtent=1,this.root=new Oo}function ql(){}function ia(){this.ring=null,this.tree=null,this.crossings=0,this.interval=new na;var e=arguments[0];this.ring=e,this.buildIndex()}function sl(){Ko.apply(this),this.mcp=null,this.p=null;var e=arguments[0],r=arguments[1];this.mcp=e,this.p=r}function Mu(){this.nodes=new du(new Ul)}function oc(){this.li=new pr,this.geomGraph=null,this.nodeGraph=new Mu,this.invalidPoint=null;var e=arguments[0];this.geomGraph=e}function ac(){this.graph=null,this.rings=new ze,this.totalEnv=new et,this.index=null,this.nestedPt=null;var e=arguments[0];this.graph=e}function hi(){if(this.errorType=null,this.pt=null,arguments.length===1){var e=arguments[0];hi.call(this,e,null)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.errorType=r,u!==null&&(this.pt=u.copy())}}function Xr(){this.parentGeometry=null,this.isSelfTouchingRingFormingHoleValid=!1,this.validErr=null;var e=arguments[0];this.parentGeometry=e}function al(){Ce.CoordinateOperation.apply(this),this.targetPM=null,this.removeCollapsed=!0;var e=arguments[0],r=arguments[1];this.targetPM=e,this.removeCollapsed=r}function Gt(){this.targetPM=null,this.removeCollapsed=!0,this.changePrecisionModel=!1,this.isPointwise=!1;var e=arguments[0];this.targetPM=e}function ll(){this.pts=null,this.usePt=null,this.distanceTolerance=null,this.seg=new Sn;var e=arguments[0];this.pts=e}function ul(){this.inputGeom=null,this.distanceTolerance=null,this.isEnsureValidTopology=!0;var e=arguments[0];this.inputGeom=e}function No(){qr.apply(this),this.isEnsureValidTopology=!0,this.distanceTolerance=null;var e=arguments[0],r=arguments[1];this.isEnsureValidTopology=e,this.distanceTolerance=r}function os(){if(this.parent=null,this.index=null,arguments.length===2){var e=arguments[0],r=arguments[1];os.call(this,e,r,null,-1)}else if(arguments.length===4){var u=arguments[0],g=arguments[1],w=arguments[2],O=arguments[3];Sn.call(this,u,g),this.parent=w,this.index=O}}function Yt(){if(this.parentLine=null,this.segs=null,this.resultSegs=new ze,this.minimumSize=null,arguments.length===1){var e=arguments[0];Yt.call(this,e,2)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.parentLine=r,this.minimumSize=u,this.init()}}function cl(){this.index=new go}function Nc(){this.querySeg=null,this.items=new ze;var e=arguments[0];this.querySeg=e}function lc(){this.li=new pr,this.inputIndex=new cl,this.outputIndex=new cl,this.line=null,this.linePts=null,this.distanceTolerance=0;var e=arguments[0],r=arguments[1];this.inputIndex=e,this.outputIndex=r}function hl(){this.inputIndex=new cl,this.outputIndex=new cl,this.distanceTolerance=0}function Ra(){this.inputGeom=null,this.lineSimplifier=new hl,this.linestringMap=null;var e=arguments[0];this.inputGeom=e}function Da(){qr.apply(this),this.linestringMap=null;var e=arguments[0];this.linestringMap=e}function uc(){this.tps=null;var e=arguments[0];this.tps=e}function Au(){this.seg=null,this.segLen=null,this.splitPt=null,this.minimumLen=0;var e=arguments[0];this.seg=e,this.segLen=e.getLength()}function cc(){}function Oa(){}function Ri(){}function wi(){if(this.p=null,arguments.length===1){var e=arguments[0];this.p=new ve(e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.p=new ve(r,u)}else if(arguments.length===3){var g=arguments[0],w=arguments[1],O=arguments[2];this.p=new ve(g,w,O)}}function ar(){this._isOnConstraint=null,this.constraint=null;var e=arguments[0];wi.call(this,e)}function pi(){this._rot=null,this.vertex=null,this.next=null,this.data=null}function Pu(){this.subdiv=null,this.isUsingTolerance=!1;var e=arguments[0];this.subdiv=e,this.isUsingTolerance=e.getTolerance()>0}function hc(){}function Lu(){this.subdiv=null,this.lastEdge=null;var e=arguments[0];this.subdiv=e,this.init()}function dl(){if(this.seg=null,arguments.length===1){if(typeof arguments[0]=="string"){var e=arguments[0];Se.call(this,e)}else if(arguments[0]instanceof Sn){var r=arguments[0];Se.call(this,"Locate failed to converge (at edge: "+r+").  Possible causes include invalid Subdivision topology or very close sites"),this.seg=new Sn(r)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];Se.call(this,dl.msgWithSpatial(u,g)),this.seg=new Sn(g)}}function jl(){}function nr(){this.visitedKey=0,this.quadEdges=new ze,this.startingEdge=null,this.tolerance=null,this.edgeCoincidenceTolerance=null,this.frameVertex=new Array(3).fill(null),this.frameEnv=null,this.locator=null,this.seg=new Sn,this.triEdges=new Array(3).fill(null);var e=arguments[0],r=arguments[1];this.tolerance=r,this.edgeCoincidenceTolerance=r/nr.EDGE_COINCIDENCE_TOL_FACTOR,this.createFrame(e),this.startingEdge=this.initSubdiv(),this.locator=new Lu(this)}function Ui(){}function Hl(){this.triList=new ze}function Ru(){this.triList=new ze}function dc(){this.coordList=new ft,this.triCoords=new ze}function fl(){if(this.ls=null,this.data=null,arguments.length===2){var e=arguments[0],r=arguments[1];this.ls=new Sn(e,r)}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.ls=new Sn(u,g),this.data=w}else if(arguments.length===6){var O=arguments[0],H=arguments[1],Q=arguments[2],ye=arguments[3],Ue=arguments[4],ct=arguments[5];fl.call(this,new ve(O,H,Q),new ve(ye,Ue,ct))}else if(arguments.length===7){var yt=arguments[0],Ft=arguments[1],sn=arguments[2],Tn=arguments[3],Pn=arguments[4],Ai=arguments[5],er=arguments[6];fl.call(this,new ve(yt,Ft,sn),new ve(Tn,Pn,Ai),er)}}function Du(){}function zc(){if(this.p=null,this.data=null,this.left=null,this.right=null,this.count=null,arguments.length===2){var e=arguments[0],r=arguments[1];this.p=new ve(e),this.left=null,this.right=null,this.count=1,this.data=r}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.p=new ve(u,g),this.left=null,this.right=null,this.count=1,this.data=w}}function vo(){if(this.root=null,this.numberOfNodes=null,this.tolerance=null,arguments.length===0)vo.call(this,0);else if(arguments.length===1){var e=arguments[0];this.tolerance=e}}function Na(){this.tolerance=null,this.matchNode=null,this.matchDist=0,this.p=null;var e=arguments[0],r=arguments[1];this.p=e,this.tolerance=r}function It(){this.initialVertices=null,this.segVertices=null,this.segments=new ze,this.subdiv=null,this.incDel=null,this.convexHull=null,this.splitFinder=new Oa,this.kdt=null,this.vertexFactory=null,this.computeAreaEnv=null,this.splitPt=null,this.tolerance=null;var e=arguments[0],r=arguments[1];this.initialVertices=new ze(e),this.tolerance=r,this.kdt=new vo(r)}function Ht(){this.siteCoords=null,this.tolerance=0,this.subdiv=null}function zo(){this.siteCoords=null,this.constraintLines=null,this.tolerance=0,this.subdiv=null,this.constraintVertexMap=new nn}function Ei(){this.siteCoords=null,this.tolerance=0,this.subdiv=null,this.clipEnv=null,this.diagramEnv=null}function $e(){}Array.prototype.fill||(Array.prototype.fill=function(e){for(var r=Object(this),u=parseInt(r.length,10),g=arguments[1],w=parseInt(g,10)||0,O=0>w?Math.max(u+w,0):Math.min(w,u),H=arguments[2],Q=H===void 0?u:parseInt(H,10)||0,ye=0>Q?Math.max(u+Q,0):Math.min(Q,u);ye>O;O++)r[O]=e;return r}),Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(e){return e!==e},Math.trunc=Math.trunc||function(e){return 0>e?Math.ceil(e):Math.floor(e)},N(W.prototype,{interfaces_:function(){return[]},getClass:function(){return W}}),W.equalsWithTolerance=function(e,r,u){return Math.abs(e-r)<=u},te.isNaN=function(e){return Number.isNaN(e)},te.doubleToLongBits=function(e){return e},te.longBitsToDouble=function(e){return e},te.isInfinite=function(e){return!Number.isFinite(e)},te.MAX_VALUE=Number.MAX_VALUE,Te(Qe,Se),N(Qe.prototype,{interfaces_:function(){return[]},getClass:function(){return Qe}}),N(Pe.prototype,{interfaces_:function(){return[]},getClass:function(){return Pe}}),Pe.shouldNeverReachHere=function(){if(arguments.length===0)Pe.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Qe("Should never reach here"+(e!==null?": "+e:""))}},Pe.isTrue=function(){if(arguments.length===1){var e=arguments[0];Pe.isTrue(e,null)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];if(!r)throw u===null?new Qe:new Qe(u)}},Pe.equals=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];Pe.equals(e,r,null)}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];if(!g.equals(u))throw new Qe("Expected "+u+" but encountered "+g+(w!==null?": "+w:""))}},N(ve.prototype,{setOrdinate:function(e,r){switch(e){case ve.X:this.x=r;break;case ve.Y:this.y=r;break;case ve.Z:this.z=r;break;default:throw new X}},equals2D:function(){if(arguments.length===1){var e=arguments[0];return this.x!==e.x?!1:this.y===e.y}if(arguments.length===2){var r=arguments[0],u=arguments[1];return W.equalsWithTolerance(this.x,r.x,u)?!!W.equalsWithTolerance(this.y,r.y,u):!1}},getOrdinate:function(e){switch(e){case ve.X:return this.x;case ve.Y:return this.y;case ve.Z:return this.z}throw new X},equals3D:function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||te.isNaN(this.z)&&te.isNaN(e.z))},equals:function(e){return e instanceof ve?this.equals2D(e):!1},equalInZ:function(e,r){return W.equalsWithTolerance(this.z,e.z,r)},compareTo:function(e){var r=e;return this.x<r.x?-1:this.x>r.x?1:this.y<r.y?-1:this.y>r.y?1:0},clone:function(){try{var e=null;return e}catch(r){if(r instanceof CloneNotSupportedException)return Pe.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw r}finally{}},copy:function(){return new ve(this)},toString:function(){return"("+this.x+", "+this.y+", "+this.z+")"},distance3D:function(e){var r=this.x-e.x,u=this.y-e.y,g=this.z-e.z;return Math.sqrt(r*r+u*u+g*g)},distance:function(e){var r=this.x-e.x,u=this.y-e.y;return Math.sqrt(r*r+u*u)},hashCode:function(){var e=17;return e=37*e+ve.hashCode(this.x),e=37*e+ve.hashCode(this.y)},setCoordinate:function(e){this.x=e.x,this.y=e.y,this.z=e.z},interfaces_:function(){return[a,_e,xe]},getClass:function(){return ve}}),ve.hashCode=function(){if(arguments.length===1){var e=arguments[0],r=te.doubleToLongBits(e);return Math.trunc(r^r>>>32)}},N(Nt.prototype,{compare:function(e,r){var u=e,g=r,w=Nt.compare(u.x,g.x);if(w!==0)return w;var O=Nt.compare(u.y,g.y);if(O!==0)return O;if(this.dimensionsToTest<=2)return 0;var H=Nt.compare(u.z,g.z);return H},interfaces_:function(){return[me]},getClass:function(){return Nt}}),Nt.compare=function(e,r){return r>e?-1:e>r?1:te.isNaN(e)?te.isNaN(r)?0:-1:te.isNaN(r)?1:0},ve.DimensionalComparator=Nt,ve.serialVersionUID=6683108902428367e3,ve.NULL_ORDINATE=te.NaN,ve.X=0,ve.Y=1,ve.Z=2,wt.prototype.hasNext=function(){},wt.prototype.next=function(){},wt.prototype.remove=function(){},Bt.prototype.add=function(){},Bt.prototype.addAll=function(){},Bt.prototype.isEmpty=function(){},Bt.prototype.iterator=function(){},Bt.prototype.size=function(){},Bt.prototype.toArray=function(){},Bt.prototype.remove=function(){},je.prototype=new Error,je.prototype.name="IndexOutOfBoundsException",Ae.prototype=Object.create(Bt.prototype),Ae.prototype.constructor=Ae,Ae.prototype.get=function(){},Ae.prototype.set=function(){},Ae.prototype.isEmpty=function(){},pt.prototype=new Error,pt.prototype.name="NoSuchElementException",en.prototype=new Error,en.prototype.name="OperationNotSupported",ze.prototype=Object.create(Ae.prototype),ze.prototype.constructor=ze,ze.prototype.ensureCapacity=function(){},ze.prototype.interfaces_=function(){return[Ae,Bt]},ze.prototype.add=function(e){return this.array_.push(e),!0},ze.prototype.clear=function(){this.array_=[]},ze.prototype.addAll=function(e){for(var r=e.iterator();r.hasNext();)this.add(r.next());return!0},ze.prototype.set=function(e,r){var u=this.array_[e];return this.array_[e]=r,u},ze.prototype.iterator=function(){return new Zl(this)},ze.prototype.get=function(e){if(0>e||e>=this.size())throw new je;return this.array_[e]},ze.prototype.isEmpty=function(){return this.array_.length===0},ze.prototype.size=function(){return this.array_.length},ze.prototype.toArray=function(){for(var e=[],r=0,u=this.array_.length;u>r;r++)e.push(this.array_[r]);return e},ze.prototype.remove=function(e){for(var r=!1,u=0,g=this.array_.length;g>u;u++)if(this.array_[u]===e){this.array_.splice(u,1),r=!0;break}return r};var Zl=function(e){this.arrayList_=e,this.position_=0};Zl.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new pt;return this.arrayList_.get(this.position_++)},Zl.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},Zl.prototype.set=function(e){return this.arrayList_.set(this.position_-1,e)},Zl.prototype.remove=function(){throw new en},Te(ft,ze),N(ft.prototype,{getCoordinate:function(e){return this.get(e)},addAll:function(){if(arguments.length===2){for(var e=arguments[0],r=arguments[1],u=!1,g=e.iterator();g.hasNext();)this.add(g.next(),r),u=!0;return u}return ze.prototype.addAll.apply(this,arguments)},clone:function(){for(var r=ze.prototype.clone.call(this),u=0;u<this.size();u++)r.add(u,this.get(u).copy());return r},toCoordinateArray:function(){return this.toArray(ft.coordArrayType)},add:function(){if(arguments.length===1){var e=arguments[0];ze.prototype.add.call(this,e)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var r=arguments[0],u=arguments[1];return this.add(r,u,!0),!0}if(arguments[0]instanceof ve&&typeof arguments[1]=="boolean"){var g=arguments[0],w=arguments[1];if(!w&&this.size()>=1){var O=this.get(this.size()-1);if(O.equals2D(g))return null}ze.prototype.add.call(this,g)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var H=arguments[0],Q=arguments[1];return this.add(H,Q),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var ye=arguments[0],Ue=arguments[1],ct=arguments[2];if(ct)for(var yt=0;yt<ye.length;yt++)this.add(ye[yt],Ue);else for(var yt=ye.length-1;yt>=0;yt--)this.add(ye[yt],Ue);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof ve){var Ft=arguments[0],sn=arguments[1],Tn=arguments[2];if(!Tn){var Pn=this.size();if(Pn>0){if(Ft>0){var Ai=this.get(Ft-1);if(Ai.equals2D(sn))return null}if(Pn>Ft){var er=this.get(Ft);if(er.equals2D(sn))return null}}}ze.prototype.add.call(this,Ft,sn)}}else if(arguments.length===4){var Ds=arguments[0],oa=arguments[1],gc=arguments[2],$l=arguments[3],_l=1;gc>$l&&(_l=-1);for(var yt=gc;yt!==$l;yt+=_l)this.add(Ds[yt],oa);return!0}},closeRing:function(){this.size()>0&&this.add(new ve(this.get(0)),!1)},interfaces_:function(){return[]},getClass:function(){return ft}}),ft.coordArrayType=new Array(0).fill(null),N(et.prototype,{getArea:function(){return this.getWidth()*this.getHeight()},equals:function(e){if(!(e instanceof et))return!1;var r=e;return this.isNull()?r.isNull():this.maxx===r.getMaxX()&&this.maxy===r.getMaxY()&&this.minx===r.getMinX()&&this.miny===r.getMinY()},intersection:function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new et;var r=this.minx>e.minx?this.minx:e.minx,u=this.miny>e.miny?this.miny:e.miny,g=this.maxx<e.maxx?this.maxx:e.maxx,w=this.maxy<e.maxy?this.maxy:e.maxy;return new et(r,g,u,w)},isNull:function(){return this.maxx<this.minx},getMaxX:function(){return this.maxx},covers:function(){if(arguments.length===1){if(arguments[0]instanceof ve){var e=arguments[0];return this.covers(e.x,e.y)}if(arguments[0]instanceof et){var r=arguments[0];return this.isNull()||r.isNull()?!1:r.getMinX()>=this.minx&&r.getMaxX()<=this.maxx&&r.getMinY()>=this.miny&&r.getMaxY()<=this.maxy}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];return this.isNull()?!1:u>=this.minx&&u<=this.maxx&&g>=this.miny&&g<=this.maxy}},intersects:function(){if(arguments.length===1){if(arguments[0]instanceof et){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e.minx>this.maxx||e.maxx<this.minx||e.miny>this.maxy||e.maxy<this.miny)}if(arguments[0]instanceof ve){var r=arguments[0];return this.intersects(r.x,r.y)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];return this.isNull()?!1:!(u>this.maxx||u<this.minx||g>this.maxy||g<this.miny)}},getMinY:function(){return this.miny},getMinX:function(){return this.minx},expandToInclude:function(){if(arguments.length===1){if(arguments[0]instanceof ve){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof et){var r=arguments[0];if(r.isNull())return null;this.isNull()?(this.minx=r.getMinX(),this.maxx=r.getMaxX(),this.miny=r.getMinY(),this.maxy=r.getMaxY()):(r.minx<this.minx&&(this.minx=r.minx),r.maxx>this.maxx&&(this.maxx=r.maxx),r.miny<this.miny&&(this.miny=r.miny),r.maxy>this.maxy&&(this.maxy=r.maxy))}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.isNull()?(this.minx=u,this.maxx=u,this.miny=g,this.maxy=g):(u<this.minx&&(this.minx=u),u>this.maxx&&(this.maxx=u),g<this.miny&&(this.miny=g),g>this.maxy&&(this.maxy=g))}},minExtent:function(){if(this.isNull())return 0;var e=this.getWidth(),r=this.getHeight();return r>e?e:r},getWidth:function(){return this.isNull()?0:this.maxx-this.minx},compareTo:function(e){var r=e;return this.isNull()?r.isNull()?0:-1:r.isNull()?1:this.minx<r.minx?-1:this.minx>r.minx?1:this.miny<r.miny?-1:this.miny>r.miny?1:this.maxx<r.maxx?-1:this.maxx>r.maxx?1:this.maxy<r.maxy?-1:this.maxy>r.maxy?1:0},translate:function(e,r){return this.isNull()?null:void this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+r,this.getMaxY()+r)},toString:function(){return"Env["+this.minx+" : "+this.maxx+", "+this.miny+" : "+this.maxy+"]"},setToNull:function(){this.minx=0,this.maxx=-1,this.miny=0,this.maxy=-1},getHeight:function(){return this.isNull()?0:this.maxy-this.miny},maxExtent:function(){if(this.isNull())return 0;var e=this.getWidth(),r=this.getHeight();return e>r?e:r},expandBy:function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];if(this.isNull())return null;this.minx-=r,this.maxx+=r,this.miny-=u,this.maxy+=u,(this.minx>this.maxx||this.miny>this.maxy)&&this.setToNull()}},contains:function(){if(arguments.length===1){if(arguments[0]instanceof et){var e=arguments[0];return this.covers(e)}if(arguments[0]instanceof ve){var r=arguments[0];return this.covers(r)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];return this.covers(u,g)}},centre:function(){return this.isNull()?null:new ve((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},init:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof ve){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof et){var r=arguments[0];this.minx=r.minx,this.maxx=r.maxx,this.miny=r.miny,this.maxy=r.maxy}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.init(u.x,g.x,u.y,g.y)}else if(arguments.length===4){var w=arguments[0],O=arguments[1],H=arguments[2],Q=arguments[3];O>w?(this.minx=w,this.maxx=O):(this.minx=O,this.maxx=w),Q>H?(this.miny=H,this.maxy=Q):(this.miny=Q,this.maxy=H)}},getMaxY:function(){return this.maxy},distance:function(e){if(this.intersects(e))return 0;var r=0;this.maxx<e.minx?r=e.minx-this.maxx:this.minx>e.maxx&&(r=this.minx-e.maxx);var u=0;return this.maxy<e.miny?u=e.miny-this.maxy:this.miny>e.maxy&&(u=this.miny-e.maxy),r===0?u:u===0?r:Math.sqrt(r*r+u*u)},hashCode:function(){var e=17;return e=37*e+ve.hashCode(this.minx),e=37*e+ve.hashCode(this.maxx),e=37*e+ve.hashCode(this.miny),e=37*e+ve.hashCode(this.maxy)},interfaces_:function(){return[a,xe]},getClass:function(){return et}}),et.intersects=function(){if(arguments.length===3){var e=arguments[0],r=arguments[1],u=arguments[2];return u.x>=(e.x<r.x?e.x:r.x)&&u.x<=(e.x>r.x?e.x:r.x)&&u.y>=(e.y<r.y?e.y:r.y)&&u.y<=(e.y>r.y?e.y:r.y)}if(arguments.length===4){var g=arguments[0],w=arguments[1],O=arguments[2],H=arguments[3],Q=Math.min(O.x,H.x),ye=Math.max(O.x,H.x),Ue=Math.min(g.x,w.x),ct=Math.max(g.x,w.x);return Ue>ye||Q>ct?!1:(Q=Math.min(O.y,H.y),ye=Math.max(O.y,H.y),Ue=Math.min(g.y,w.y),ct=Math.max(g.y,w.y),Ue>ye?!1:!(Q>ct))}},et.serialVersionUID=5873921885273102e3,Te(it,ht),N(it.prototype,{interfaces_:function(){return[]},getClass:function(){return it}}),N(le.prototype,{interfaces_:function(){return[]},getClass:function(){return le}}),le.toLocationSymbol=function(e){switch(e){case le.EXTERIOR:return"e";case le.BOUNDARY:return"b";case le.INTERIOR:return"i";case le.NONE:return"-"}throw new X},le.INTERIOR=0,le.BOUNDARY=1,le.EXTERIOR=2,le.NONE=-1,N(zn.prototype,{interfaces_:function(){return[]},getClass:function(){return zn}}),zn.log10=function(e){var r=Math.log(e);return te.isInfinite(r)||te.isNaN(r)?r:r/zn.LOG_10},zn.min=function(e,r,u,g){var w=e;return w>r&&(w=r),w>u&&(w=u),w>g&&(w=g),w},zn.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1],u=arguments[2];return r>e?r:e>u?u:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var g=arguments[0],w=arguments[1],O=arguments[2];return w>g?w:g>O?O:g}},zn.wrap=function(e,r){return 0>e?r- -e%r:e%r},zn.max=function(){if(arguments.length===3){var e=arguments[0],r=arguments[1],u=arguments[2],g=e;return r>g&&(g=r),u>g&&(g=u),g}if(arguments.length===4){var w=arguments[0],O=arguments[1],H=arguments[2],Q=arguments[3],g=w;return O>g&&(g=O),H>g&&(g=H),Q>g&&(g=Q),g}},zn.average=function(e,r){return(e+r)/2},zn.LOG_10=Math.log(10),Qt.prototype.append=function(e){this.str+=e},Qt.prototype.setCharAt=function(e,r){return this.str.substr(0,e)+r+this.str.substr(e+1)},Qt.prototype.toString=function(e){return this.str},ri.prototype.intValue=function(){return this.value},ri.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0},ri.isNaN=function(e){return Number.isNaN(e)},Zi.isWhitespace=function(e){return 32>=e&&e>=0||e==127},Zi.toUpperCase=function(e){return e.toUpperCase()},N(dt.prototype,{le:function(e){return this.hi<e.hi||this.hi===e.hi&&this.lo<=e.lo},extractSignificantDigits:function(e,r){var u=this.abs(),g=dt.magnitude(u.hi),w=dt.TEN.pow(g);u=u.divide(w),u.gt(dt.TEN)?(u=u.divide(dt.TEN),g+=1):u.lt(dt.ONE)&&(u=u.multiply(dt.TEN),g-=1);for(var O=g+1,H=new Qt,Q=dt.MAX_PRINT_DIGITS-1,ye=0;Q>=ye;ye++){e&&ye===O&&H.append(".");var Ue=Math.trunc(u.hi);if(0>Ue)break;var ct=!1,yt=0;Ue>9?(ct=!0,yt="9"):yt="0"+Ue,H.append(yt),u=u.subtract(dt.valueOf(Ue)).multiply(dt.TEN),ct&&u.selfAdd(dt.TEN);var Ft=!0,sn=dt.magnitude(u.hi);if(0>sn&&Math.abs(sn)>=Q-ye&&(Ft=!1),!Ft)break}return r[0]=g,H.toString()},sqr:function(){return this.multiply(this)},doubleValue:function(){return this.hi+this.lo},subtract:function(){if(arguments[0]instanceof dt){var e=arguments[0];return this.add(e.negate())}if(typeof arguments[0]=="number"){var r=arguments[0];return this.add(-r)}},equals:function(){if(arguments.length===1){var e=arguments[0];return this.hi===e.hi&&this.lo===e.lo}},isZero:function(){return this.hi===0&&this.lo===0},selfSubtract:function(){if(arguments[0]instanceof dt){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e.hi,-e.lo)}if(typeof arguments[0]=="number"){var r=arguments[0];return this.isNaN()?this:this.selfAdd(-r,0)}},getSpecialNumberString:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},min:function(e){return this.le(e)?this:e},selfDivide:function(){if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];return this.selfDivide(e.hi,e.lo)}if(typeof arguments[0]=="number"){var r=arguments[0];return this.selfDivide(r,0)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1],w=null,O=null,H=null,Q=null,ye=null,Ue=null,ct=null,yt=null;return ye=this.hi/u,Ue=dt.SPLIT*ye,w=Ue-ye,yt=dt.SPLIT*u,w=Ue-w,O=ye-w,H=yt-u,ct=ye*u,H=yt-H,Q=u-H,yt=w*H-ct+w*Q+O*H+O*Q,Ue=(this.hi-ct-yt+this.lo-ye*g)/u,yt=ye+Ue,this.hi=yt,this.lo=ye-yt+Ue,this}},dump:function(){return"DD<"+this.hi+", "+this.lo+">"},divide:function(){if(arguments[0]instanceof dt){var e=arguments[0],r=null,u=null,g=null,w=null,O=null,H=null,Q=null,ye=null;O=this.hi/e.hi,H=dt.SPLIT*O,r=H-O,ye=dt.SPLIT*e.hi,r=H-r,u=O-r,g=ye-e.hi,Q=O*e.hi,g=ye-g,w=e.hi-g,ye=r*g-Q+r*w+u*g+u*w,H=(this.hi-Q-ye+this.lo-O*e.lo)/e.hi,ye=O+H;var Ue=ye,ct=O-ye+H;return new dt(Ue,ct)}if(typeof arguments[0]=="number"){var yt=arguments[0];return te.isNaN(yt)?dt.createNaN():dt.copy(this).selfDivide(yt,0)}},ge:function(e){return this.hi>e.hi||this.hi===e.hi&&this.lo>=e.lo},pow:function(e){if(e===0)return dt.valueOf(1);var r=new dt(this),u=dt.valueOf(1),g=Math.abs(e);if(g>1)for(;g>0;)g%2===1&&u.selfMultiply(r),g/=2,g>0&&(r=r.sqr());else u=r;return 0>e?u.reciprocal():u},ceil:function(){if(this.isNaN())return dt.NaN;var e=Math.ceil(this.hi),r=0;return e===this.hi&&(r=Math.ceil(this.lo)),new dt(e,r)},compareTo:function(e){var r=e;return this.hi<r.hi?-1:this.hi>r.hi?1:this.lo<r.lo?-1:this.lo>r.lo?1:0},rint:function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()},setValue:function(){if(arguments[0]instanceof dt){var e=arguments[0];return this.init(e),this}if(typeof arguments[0]=="number"){var r=arguments[0];return this.init(r),this}},max:function(e){return this.ge(e)?this:e},sqrt:function(){if(this.isZero())return dt.valueOf(0);if(this.isNegative())return dt.NaN;var e=1/Math.sqrt(this.hi),r=this.hi*e,u=dt.valueOf(r),g=this.subtract(u.sqr()),w=g.hi*(.5*e);return u.add(w)},selfAdd:function(){if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];return this.selfAdd(e.hi,e.lo)}if(typeof arguments[0]=="number"){var r=arguments[0],u=null,g=null,w=null,O=null,H=null,Q=null;return w=this.hi+r,H=w-this.hi,O=w-H,O=r-H+(this.hi-O),Q=O+this.lo,u=w+Q,g=Q+(w-u),this.hi=u+g,this.lo=g+(u-this.hi),this}}else if(arguments.length===2){var ye=arguments[0],Ue=arguments[1],u=null,g=null,ct=null,yt=null,w=null,O=null,H=null,Q=null;w=this.hi+ye,ct=this.lo+Ue,H=w-this.hi,Q=ct-this.lo,O=w-H,yt=ct-Q,O=ye-H+(this.hi-O),yt=Ue-Q+(this.lo-yt),H=O+ct,u=w+H,g=H+(w-u),H=yt+g;var Ft=u+H,sn=H+(u-Ft);return this.hi=Ft,this.lo=sn,this}},selfMultiply:function(){if(arguments.length===1){if(arguments[0]instanceof dt){var e=arguments[0];return this.selfMultiply(e.hi,e.lo)}if(typeof arguments[0]=="number"){var r=arguments[0];return this.selfMultiply(r,0)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1],w=null,O=null,H=null,Q=null,ye=null,Ue=null;ye=dt.SPLIT*this.hi,w=ye-this.hi,Ue=dt.SPLIT*u,w=ye-w,O=this.hi-w,H=Ue-u,ye=this.hi*u,H=Ue-H,Q=u-H,Ue=w*H-ye+w*Q+O*H+O*Q+(this.hi*g+this.lo*u);var ct=ye+Ue;w=ye-ct;var yt=Ue+w;return this.hi=ct,this.lo=yt,this}},selfSqr:function(){return this.selfMultiply(this)},floor:function(){if(this.isNaN())return dt.NaN;var e=Math.floor(this.hi),r=0;return e===this.hi&&(r=Math.floor(this.lo)),new dt(e,r)},negate:function(){return this.isNaN()?this:new dt(-this.hi,-this.lo)},clone:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return null;throw e}finally{}},multiply:function(){if(arguments[0]instanceof dt){var e=arguments[0];return e.isNaN()?dt.createNaN():dt.copy(this).selfMultiply(e)}if(typeof arguments[0]=="number"){var r=arguments[0];return te.isNaN(r)?dt.createNaN():dt.copy(this).selfMultiply(r,0)}},isNaN:function(){return te.isNaN(this.hi)},intValue:function(){return Math.trunc(this.hi)},toString:function(){var e=dt.magnitude(this.hi);return e>=-3&&20>=e?this.toStandardNotation():this.toSciNotation()},toStandardNotation:function(){var e=this.getSpecialNumberString();if(e!==null)return e;var r=new Array(1).fill(null),u=this.extractSignificantDigits(!0,r),g=r[0]+1,w=u;if(u.charAt(0)===".")w="0"+u;else if(0>g)w="0."+dt.stringOfChar("0",-g)+u;else if(u.indexOf(".")===-1){var O=g-u.length,H=dt.stringOfChar("0",O);w=u+H+".0"}return this.isNegative()?"-"+w:w},reciprocal:function(){var e=null,r=null,u=null,g=null,w=null,O=null,H=null,Q=null;w=1/this.hi,O=dt.SPLIT*w,e=O-w,Q=dt.SPLIT*this.hi,e=O-e,r=w-e,u=Q-this.hi,H=w*this.hi,u=Q-u,g=this.hi-u,Q=e*u-H+e*g+r*u+r*g,O=(1-H-Q-w*this.lo)/this.hi;var ye=w+O,Ue=w-ye+O;return new dt(ye,Ue)},toSciNotation:function(){if(this.isZero())return dt.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var r=new Array(1).fill(null),u=this.extractSignificantDigits(!1,r),g=dt.SCI_NOT_EXPONENT_CHAR+r[0];if(u.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+u);var w="";u.length>1&&(w=u.substring(1));var O=u.charAt(0)+"."+w;return this.isNegative()?"-"+O+g:O+g},abs:function(){return this.isNaN()?dt.NaN:this.isNegative()?this.negate():new dt(this)},isPositive:function(){return this.hi>0||this.hi===0&&this.lo>0},lt:function(e){return this.hi<e.hi||this.hi===e.hi&&this.lo<e.lo},add:function(){if(arguments[0]instanceof dt){var e=arguments[0];return dt.copy(this).selfAdd(e)}if(typeof arguments[0]=="number"){var r=arguments[0];return dt.copy(this).selfAdd(r)}},init:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.hi=e,this.lo=0}else if(arguments[0]instanceof dt){var r=arguments[0];this.hi=r.hi,this.lo=r.lo}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.hi=u,this.lo=g}},gt:function(e){return this.hi>e.hi||this.hi===e.hi&&this.lo>e.lo},isNegative:function(){return this.hi<0||this.hi===0&&this.lo<0},trunc:function(){return this.isNaN()?dt.NaN:this.isPositive()?this.floor():this.ceil()},signum:function(){return this.hi>0?1:this.hi<0?-1:this.lo>0?1:this.lo<0?-1:0},interfaces_:function(){return[xe,a,_e]},getClass:function(){return dt}}),dt.sqr=function(e){return dt.valueOf(e).selfMultiply(e)},dt.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return dt.parse(e)}if(typeof arguments[0]=="number"){var r=arguments[0];return new dt(r)}},dt.sqrt=function(e){return dt.valueOf(e).sqrt()},dt.parse=function(e){for(var r=0,u=e.length;Zi.isWhitespace(e.charAt(r));)r++;var g=!1;if(u>r){var w=e.charAt(r);w!=="-"&&w!=="+"||(r++,w==="-"&&(g=!0))}for(var O=new dt,H=0,Q=0,ye=0;!(r>=u);){var Ue=e.charAt(r);if(r++,Zi.isDigit(Ue)){var ct=Ue-"0";O.selfMultiply(dt.TEN),O.selfAdd(ct),H++}else{if(Ue!=="."){if(Ue==="e"||Ue==="E"){var yt=e.substring(r);try{ye=ri.parseInt(yt)}catch(Pn){throw Pn instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+yt+" in string "+e):Pn}finally{}break}throw new NumberFormatException("Unexpected character '"+Ue+"' at position "+r+" in string "+e)}Q=H}}var Ft=O,sn=H-Q-ye;if(sn===0)Ft=O;else if(sn>0){var Tn=dt.TEN.pow(sn);Ft=O.divide(Tn)}else if(0>sn){var Tn=dt.TEN.pow(-sn);Ft=O.multiply(Tn)}return g?Ft.negate():Ft},dt.createNaN=function(){return new dt(te.NaN,te.NaN)},dt.copy=function(e){return new dt(e)},dt.magnitude=function(e){var r=Math.abs(e),u=Math.log(r)/Math.log(10),g=Math.trunc(Math.floor(u)),w=Math.pow(10,g);return r>=10*w&&(g+=1),g},dt.stringOfChar=function(e,r){for(var u=new Qt,g=0;r>g;g++)u.append(e);return u.toString()},dt.PI=new dt(3.141592653589793,12246467991473532e-32),dt.TWO_PI=new dt(6.283185307179586,24492935982947064e-32),dt.PI_2=new dt(1.5707963267948966,6123233995736766e-32),dt.E=new dt(2.718281828459045,14456468917292502e-32),dt.NaN=new dt(te.NaN,te.NaN),dt.EPS=123259516440783e-46,dt.SPLIT=134217729,dt.MAX_PRINT_DIGITS=32,dt.TEN=dt.valueOf(10),dt.ONE=dt.valueOf(1),dt.SCI_NOT_EXPONENT_CHAR="E",dt.SCI_NOT_ZERO="0.0E0",N(tn.prototype,{interfaces_:function(){return[]},getClass:function(){return tn}}),tn.orientationIndex=function(e,r,u){var g=tn.orientationIndexFilter(e,r,u);if(1>=g)return g;var w=dt.valueOf(r.x).selfAdd(-e.x),O=dt.valueOf(r.y).selfAdd(-e.y),H=dt.valueOf(u.x).selfAdd(-r.x),Q=dt.valueOf(u.y).selfAdd(-r.y);return w.selfMultiply(Q).selfSubtract(O.selfMultiply(H)).signum()},tn.signOfDet2x2=function(e,r,u,g){var w=e.multiply(g).selfSubtract(r.multiply(u));return w.signum()},tn.intersection=function(e,r,u,g){var w=dt.valueOf(g.y).selfSubtract(u.y).selfMultiply(dt.valueOf(r.x).selfSubtract(e.x)),O=dt.valueOf(g.x).selfSubtract(u.x).selfMultiply(dt.valueOf(r.y).selfSubtract(e.y)),H=w.subtract(O),Q=dt.valueOf(g.x).selfSubtract(u.x).selfMultiply(dt.valueOf(e.y).selfSubtract(u.y)),ye=dt.valueOf(g.y).selfSubtract(u.y).selfMultiply(dt.valueOf(e.x).selfSubtract(u.x)),Ue=Q.subtract(ye),ct=Ue.selfDivide(H).doubleValue(),yt=dt.valueOf(e.x).selfAdd(dt.valueOf(r.x).selfSubtract(e.x).selfMultiply(ct)).doubleValue(),Ft=dt.valueOf(r.x).selfSubtract(e.x).selfMultiply(dt.valueOf(e.y).selfSubtract(u.y)),sn=dt.valueOf(r.y).selfSubtract(e.y).selfMultiply(dt.valueOf(e.x).selfSubtract(u.x)),Tn=Ft.subtract(sn),Pn=Tn.selfDivide(H).doubleValue(),Ai=dt.valueOf(u.y).selfAdd(dt.valueOf(g.y).selfSubtract(u.y).selfMultiply(Pn)).doubleValue();return new ve(yt,Ai)},tn.orientationIndexFilter=function(e,r,u){var g=null,w=(e.x-u.x)*(r.y-u.y),O=(e.y-u.y)*(r.x-u.x),H=w-O;if(w>0){if(0>=O)return tn.signum(H);g=w+O}else{if(!(0>w)||O>=0)return tn.signum(H);g=-w-O}var Q=tn.DP_SAFE_EPSILON*g;return H>=Q||-H>=Q?tn.signum(H):2},tn.signum=function(e){return e>0?1:0>e?-1:0},tn.DP_SAFE_EPSILON=1e-15,N(Vn.prototype,{setOrdinate:function(e,r,u){},size:function(){},getOrdinate:function(e,r){},getCoordinate:function(){},getCoordinateCopy:function(e){},getDimension:function(){},getX:function(e){},clone:function(){},expandEnvelope:function(e){},copy:function(){},getY:function(e){},toCoordinateArray:function(){},interfaces_:function(){return[_e]},getClass:function(){return Vn}}),Vn.X=0,Vn.Y=1,Vn.Z=2,Vn.M=3,xi.arraycopy=function(e,r,u,g,w){for(var O=0,H=r;r+w>H;H++)u[g+O]=e[H],O++},xi.getProperty=function(e){return{"line.separator":`
`}[e]},N(hr.prototype,{getY:function(){var e=this.y/this.w;if(te.isNaN(e)||te.isInfinite(e))throw new it;return e},getX:function(){var e=this.x/this.w;if(te.isNaN(e)||te.isInfinite(e))throw new it;return e},getCoordinate:function(){var e=new ve;return e.x=this.getX(),e.y=this.getY(),e},interfaces_:function(){return[]},getClass:function(){return hr}}),hr.intersection=function(e,r,u,g){var w=e.y-r.y,O=r.x-e.x,H=e.x*r.y-r.x*e.y,Q=u.y-g.y,ye=g.x-u.x,Ue=u.x*g.y-g.x*u.y,ct=O*Ue-ye*H,yt=Q*H-w*Ue,Ft=w*ye-Q*O,sn=ct/Ft,Tn=yt/Ft;if(te.isNaN(sn)||te.isInfinite(sn)||te.isNaN(Tn)||te.isInfinite(Tn))throw new it;return new ve(sn,Tn)},N(_n.prototype,{create:function(){arguments.length===1&&(arguments[0]instanceof Array||kt(arguments[0],Vn))},interfaces_:function(){return[]},getClass:function(){return _n}}),N(es.prototype,{filter:function(e){},interfaces_:function(){return[]},getClass:function(){return es}}),N(Jt.prototype,{isGeometryCollection:function(){return this.getSortIndex()===Jt.SORTINDEX_GEOMETRYCOLLECTION},getFactory:function(){return this.factory},getGeometryN:function(e){return this},getArea:function(){return 0},isRectangle:function(){return!1},equals:function(){if(arguments.length===1){if(arguments[0]instanceof Jt){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}if(arguments[0]instanceof Object){var r=arguments[0];if(!(r instanceof Jt))return!1;var u=r;return this.equalsExact(u)}}},equalsExact:function(e){return this===e||this.equalsExact(e,0)},geometryChanged:function(){this.apply(Jt.geometryChangedFilter)},geometryChangedAction:function(){this.envelope=null},equalsNorm:function(e){return e===null?!1:this.norm().equalsExact(e.norm())},getLength:function(){return 0},getNumGeometries:function(){return 1},compareTo:function(){if(arguments.length===1){var e=arguments[0],r=e;return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(e)}if(arguments.length===2){var u=arguments[0],g=arguments[1],r=u;return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(u,g)}},getUserData:function(){return this.userData},getSRID:function(){return this.SRID},getEnvelope:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},checkNotGeometryCollection:function(e){if(e.getSortIndex()===Jt.SORTINDEX_GEOMETRYCOLLECTION)throw new X},equal:function(e,r,u){return u===0?e.equals(r):e.distance(r)<=u},norm:function(){var e=this.copy();return e.normalize(),e},getPrecisionModel:function(){return this.factory.getPrecisionModel()},getEnvelopeInternal:function(){return this.envelope===null&&(this.envelope=this.computeEnvelopeInternal()),new et(this.envelope)},setSRID:function(e){this.SRID=e},setUserData:function(e){this.userData=e},compare:function(e,r){for(var u=e.iterator(),g=r.iterator();u.hasNext()&&g.hasNext();){var w=u.next(),O=g.next(),H=w.compareTo(O);if(H!==0)return H}return u.hasNext()?1:g.hasNext()?-1:0},hashCode:function(){return this.getEnvelopeInternal().hashCode()},isGeometryCollectionOrDerived:function(){return this.getSortIndex()===Jt.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Jt.SORTINDEX_MULTIPOINT||this.getSortIndex()===Jt.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Jt.SORTINDEX_MULTIPOLYGON},interfaces_:function(){return[_e,a,xe]},getClass:function(){return Jt}}),Jt.hasNonEmptyElements=function(e){for(var r=0;r<e.length;r++)if(!e[r].isEmpty())return!0;return!1},Jt.hasNullElements=function(e){for(var r=0;r<e.length;r++)if(e[r]===null)return!0;return!1},Jt.serialVersionUID=8763622679187377e3,Jt.SORTINDEX_POINT=0,Jt.SORTINDEX_MULTIPOINT=1,Jt.SORTINDEX_LINESTRING=2,Jt.SORTINDEX_LINEARRING=3,Jt.SORTINDEX_MULTILINESTRING=4,Jt.SORTINDEX_POLYGON=5,Jt.SORTINDEX_MULTIPOLYGON=6,Jt.SORTINDEX_GEOMETRYCOLLECTION=7,Jt.geometryChangedFilter={interfaces_:function(){return[es]},filter:function(e){e.geometryChangedAction()}},N(Ur.prototype,{filter:function(e){},interfaces_:function(){return[]},getClass:function(){return Ur}}),N(tr.prototype,{isInBoundary:function(e){},interfaces_:function(){return[]},getClass:function(){return tr}}),N(Ha.prototype,{isInBoundary:function(e){return e%2===1},interfaces_:function(){return[tr]},getClass:function(){return Ha}}),N(Go.prototype,{isInBoundary:function(e){return e>0},interfaces_:function(){return[tr]},getClass:function(){return Go}}),N(Ve.prototype,{isInBoundary:function(e){return e>1},interfaces_:function(){return[tr]},getClass:function(){return Ve}}),N(no.prototype,{isInBoundary:function(e){return e===1},interfaces_:function(){return[tr]},getClass:function(){return no}}),tr.Mod2BoundaryNodeRule=Ha,tr.EndPointBoundaryNodeRule=Go,tr.MultiValentEndPointBoundaryNodeRule=Ve,tr.MonoValentEndPointBoundaryNodeRule=no,tr.MOD2_BOUNDARY_RULE=new Ha,tr.ENDPOINT_BOUNDARY_RULE=new Go,tr.MULTIVALENT_ENDPOINT_BOUNDARY_RULE=new Ve,tr.MONOVALENT_ENDPOINT_BOUNDARY_RULE=new no,tr.OGC_SFS_BOUNDARY_RULE=tr.MOD2_BOUNDARY_RULE,N(bn.prototype,{interfaces_:function(){return[]},getClass:function(){return bn}}),bn.isRing=function(e){return e.length<4?!1:!!e[0].equals2D(e[e.length-1])},bn.ptNotInList=function(e,r){for(var u=0;u<e.length;u++){var g=e[u];if(bn.indexOf(g,r)<0)return g}return null},bn.scroll=function(e,r){var u=bn.indexOf(r,e);if(0>u)return null;var g=new Array(e.length).fill(null);xi.arraycopy(e,u,g,0,e.length-u),xi.arraycopy(e,0,g,e.length-u,u),xi.arraycopy(g,0,e,0,e.length)},bn.equals=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];if(e===r)return!0;if(e===null||r===null||e.length!==r.length)return!1;for(var u=0;u<e.length;u++)if(!e[u].equals(r[u]))return!1;return!0}if(arguments.length===3){var g=arguments[0],w=arguments[1],O=arguments[2];if(g===w)return!0;if(g===null||w===null||g.length!==w.length)return!1;for(var u=0;u<g.length;u++)if(O.compare(g[u],w[u])!==0)return!1;return!0}},bn.intersection=function(e,r){for(var u=new ft,g=0;g<e.length;g++)r.intersects(e[g])&&u.add(e[g],!0);return u.toCoordinateArray()},bn.hasRepeatedPoints=function(e){for(var r=1;r<e.length;r++)if(e[r-1].equals(e[r]))return!0;return!1},bn.removeRepeatedPoints=function(e){if(!bn.hasRepeatedPoints(e))return e;var r=new ft(e,!1);return r.toCoordinateArray()},bn.reverse=function(e){for(var r=e.length-1,u=Math.trunc(r/2),g=0;u>=g;g++){var w=e[g];e[g]=e[r-g],e[r-g]=w}},bn.removeNull=function(e){for(var r=0,u=0;u<e.length;u++)e[u]!==null&&r++;var g=new Array(r).fill(null);if(r===0)return g;for(var w=0,u=0;u<e.length;u++)e[u]!==null&&(g[w++]=e[u]);return g},bn.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],r=new Array(e.length).fill(null),u=0;u<e.length;u++)r[u]=new ve(e[u]);return r}if(arguments.length===5)for(var g=arguments[0],w=arguments[1],O=arguments[2],H=arguments[3],Q=arguments[4],u=0;Q>u;u++)O[H+u]=new ve(g[w+u])},bn.isEqualReversed=function(e,r){for(var u=0;u<e.length;u++){var g=e[u],w=r[e.length-u-1];if(g.compareTo(w)!==0)return!1}return!0},bn.envelope=function(e){for(var r=new et,u=0;u<e.length;u++)r.expandToInclude(e[u]);return r},bn.toCoordinateArray=function(e){return e.toArray(bn.coordArrayType)},bn.atLeastNCoordinatesOrNothing=function(e,r){return r.length>=e?r:[]},bn.indexOf=function(e,r){for(var u=0;u<r.length;u++)if(e.equals(r[u]))return u;return-1},bn.increasingDirection=function(e){for(var r=0;r<Math.trunc(e.length/2);r++){var u=e.length-1-r,g=e[r].compareTo(e[u]);if(g!==0)return g}return 1},bn.compare=function(e,r){for(var u=0;u<e.length&&u<r.length;){var g=e[u].compareTo(r[u]);if(g!==0)return g;u++}return u<r.length?-1:u<e.length?1:0},bn.minCoordinate=function(e){for(var r=null,u=0;u<e.length;u++)(r===null||r.compareTo(e[u])>0)&&(r=e[u]);return r},bn.extract=function(e,r,u){r=zn.clamp(r,0,e.length),u=zn.clamp(u,-1,e.length);var g=u-r+1;0>u&&(g=0),r>=e.length&&(g=0),r>u&&(g=0);var w=new Array(g).fill(null);if(g===0)return w;for(var O=0,H=r;u>=H;H++)w[O++]=e[H];return w},N(Tl.prototype,{compare:function(e,r){var u=e,g=r;return bn.compare(u,g)},interfaces_:function(){return[me]},getClass:function(){return Tl}}),N(Lt.prototype,{compare:function(e,r){var u=e,g=r;if(u.length<g.length)return-1;if(u.length>g.length)return 1;if(u.length===0)return 0;var w=bn.compare(u,g),O=bn.isEqualReversed(u,g);return O?0:w},OLDcompare:function(e,r){var u=e,g=r;if(u.length<g.length)return-1;if(u.length>g.length)return 1;if(u.length===0)return 0;for(var w=bn.increasingDirection(u),O=bn.increasingDirection(g),H=w>0?0:u.length-1,Q=O>0?0:u.length-1,ye=0;ye<u.length;ye++){var Ue=u[H].compareTo(g[Q]);if(Ue!==0)return Ue;H+=w,Q+=O}return 0},interfaces_:function(){return[me]},getClass:function(){return Lt}}),bn.ForwardComparator=Tl,bn.BidirectionalComparator=Lt,bn.coordArrayType=new Array(0).fill(null),Zs.prototype.get=function(){},Zs.prototype.put=function(){},Zs.prototype.size=function(){},Zs.prototype.values=function(){},Zs.prototype.entrySet=function(){},Gr.prototype=new Zs,io.prototype=new Bt,io.prototype.contains=function(){},pn.prototype=new io,pn.prototype.contains=function(e){for(var r=0,u=this.array_.length;u>r;r++){var g=this.array_[r];if(g===e)return!0}return!1},pn.prototype.add=function(e){return this.contains(e)?!1:(this.array_.push(e),!0)},pn.prototype.addAll=function(e){for(var r=e.iterator();r.hasNext();)this.add(r.next());return!0},pn.prototype.remove=function(e){throw new javascript.util.OperationNotSupported},pn.prototype.size=function(){return this.array_.length},pn.prototype.isEmpty=function(){return this.array_.length===0},pn.prototype.toArray=function(){for(var e=[],r=0,u=this.array_.length;u>r;r++)e.push(this.array_[r]);return e},pn.prototype.iterator=function(){return new ra(this)};var ra=function(e){this.hashSet_=e,this.position_=0};ra.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new pt;return this.hashSet_.array_[this.position_++]},ra.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},ra.prototype.remove=function(){throw new en};var xo=0,Fo=1;nn.prototype=new Gr,nn.prototype.get=function(e){for(var r=this.root_;r!==null;){var u=e.compareTo(r.key);if(0>u)r=r.left;else{if(!(u>0))return r.value;r=r.right}}return null},nn.prototype.put=function(e,r){if(this.root_===null)return this.root_={key:e,value:r,left:null,right:null,parent:null,color:xo,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var u,g,w=this.root_;do if(u=w,g=e.compareTo(w.key),0>g)w=w.left;else{if(!(g>0)){var O=w.value;return w.value=r,O}w=w.right}while(w!==null);var H={key:e,left:null,right:null,value:r,parent:u,color:xo,getValue:function(){return this.value},getKey:function(){return this.key}};return 0>g?u.left=H:u.right=H,this.fixAfterInsertion(H),this.size_++,null},nn.prototype.fixAfterInsertion=function(e){for(e.color=Fo;e!=null&&e!=this.root_&&e.parent.color==Fo;)if(si(e)==qo(si(si(e)))){var r=Sl(si(si(e)));Lr(r)==Fo?(_s(si(e),xo),_s(r,xo),_s(si(si(e)),Fo),e=si(si(e))):(e==Sl(si(e))&&(e=si(e),this.rotateLeft(e)),_s(si(e),xo),_s(si(si(e)),Fo),this.rotateRight(si(si(e))))}else{var r=qo(si(si(e)));Lr(r)==Fo?(_s(si(e),xo),_s(r,xo),_s(si(si(e)),Fo),e=si(si(e))):(e==qo(si(e))&&(e=si(e),this.rotateRight(e)),_s(si(e),xo),_s(si(si(e)),Fo),this.rotateLeft(si(si(e))))}this.root_.color=xo},nn.prototype.values=function(){var e=new ze,r=this.getFirstEntry();if(r!==null)for(e.add(r.value);(r=nn.successor(r))!==null;)e.add(r.value);return e},nn.prototype.entrySet=function(){var e=new pn,r=this.getFirstEntry();if(r!==null)for(e.add(r);(r=nn.successor(r))!==null;)e.add(r);return e},nn.prototype.rotateLeft=function(e){if(e!=null){var r=e.right;e.right=r.left,r.left!=null&&(r.left.parent=e),r.parent=e.parent,e.parent==null?this.root_=r:e.parent.left==e?e.parent.left=r:e.parent.right=r,r.left=e,e.parent=r}},nn.prototype.rotateRight=function(e){if(e!=null){var r=e.left;e.left=r.right,r.right!=null&&(r.right.parent=e),r.parent=e.parent,e.parent==null?this.root_=r:e.parent.right==e?e.parent.right=r:e.parent.left=r,r.right=e,e.parent=r}},nn.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e},nn.successor=function(e){if(e===null)return null;if(e.right!==null){for(var r=e.right;r.left!==null;)r=r.left;return r}for(var r=e.parent,u=e;r!==null&&u===r.right;)u=r,r=r.parent;return r},nn.prototype.size=function(){return this.size_},N(fa.prototype,{interfaces_:function(){return[]},getClass:function(){return fa}}),jo.prototype=new io,dr.prototype=new jo,dr.prototype.contains=function(e){for(var r=0,u=this.array_.length;u>r;r++){var g=this.array_[r];if(g.compareTo(e)===0)return!0}return!1},dr.prototype.add=function(e){if(this.contains(e))return!1;for(var r=0,u=this.array_.length;u>r;r++){var g=this.array_[r];if(g.compareTo(e)===1)return this.array_.splice(r,0,e),!0}return this.array_.push(e),!0},dr.prototype.addAll=function(e){for(var r=e.iterator();r.hasNext();)this.add(r.next());return!0},dr.prototype.remove=function(e){throw new en},dr.prototype.size=function(){return this.array_.length},dr.prototype.isEmpty=function(){return this.array_.length===0},dr.prototype.toArray=function(){for(var e=[],r=0,u=this.array_.length;u>r;r++)e.push(this.array_[r]);return e},dr.prototype.iterator=function(){return new bo(this)};var bo=function(e){this.treeSet_=e,this.position_=0};bo.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new pt;return this.treeSet_.array_[this.position_++]},bo.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},bo.prototype.remove=function(){throw new en},ir.sort=function(){var e,r,u,g,w=arguments[0];if(arguments.length===1)return g=function(H,Q){return H.compareTo(Q)},void w.sort(g);if(arguments.length===2)u=arguments[1],g=function(H,Q){return u.compare(H,Q)},w.sort(g);else{if(arguments.length===3){r=w.slice(arguments[1],arguments[2]),r.sort();var O=w.slice(0,arguments[1]).concat(r,w.slice(arguments[2],w.length));for(w.splice(0,w.length),e=0;e<O.length;e++)w.push(O[e]);return}if(arguments.length===4){for(r=w.slice(arguments[1],arguments[2]),u=arguments[3],g=function(H,Q){return u.compare(H,Q)},r.sort(g),O=w.slice(0,arguments[1]).concat(r,w.slice(arguments[2],w.length)),w.splice(0,w.length),e=0;e<O.length;e++)w.push(O[e]);return}}},ir.asList=function(e){for(var r=new ze,u=0,g=e.length;g>u;u++)r.add(e[u]);return r},N(Rt.prototype,{interfaces_:function(){return[]},getClass:function(){return Rt}}),Rt.toDimensionSymbol=function(e){switch(e){case Rt.FALSE:return Rt.SYM_FALSE;case Rt.TRUE:return Rt.SYM_TRUE;case Rt.DONTCARE:return Rt.SYM_DONTCARE;case Rt.P:return Rt.SYM_P;case Rt.L:return Rt.SYM_L;case Rt.A:return Rt.SYM_A}throw new X},Rt.toDimensionValue=function(e){switch(Zi.toUpperCase(e)){case Rt.SYM_FALSE:return Rt.FALSE;case Rt.SYM_TRUE:return Rt.TRUE;case Rt.SYM_DONTCARE:return Rt.DONTCARE;case Rt.SYM_P:return Rt.P;case Rt.SYM_L:return Rt.L;case Rt.SYM_A:return Rt.A}throw new X},Rt.P=0,Rt.L=1,Rt.A=2,Rt.FALSE=-1,Rt.TRUE=-2,Rt.DONTCARE=-3,Rt.SYM_FALSE="F",Rt.SYM_TRUE="T",Rt.SYM_DONTCARE="*",Rt.SYM_P="0",Rt.SYM_L="1",Rt.SYM_A="2",N(Fs.prototype,{filter:function(e){},interfaces_:function(){return[]},getClass:function(){return Fs}}),N(So.prototype,{filter:function(e,r){},isDone:function(){},isGeometryChanged:function(){},interfaces_:function(){return[]},getClass:function(){return So}}),Te(jn,Jt),N(jn.prototype,{computeEnvelopeInternal:function(){for(var e=new et,r=0;r<this.geometries.length;r++)e.expandToInclude(this.geometries[r].getEnvelopeInternal());return e},getGeometryN:function(e){return this.geometries[e]},getSortIndex:function(){return Jt.SORTINDEX_GEOMETRYCOLLECTION},getCoordinates:function(){for(var e=new Array(this.getNumPoints()).fill(null),r=-1,u=0;u<this.geometries.length;u++)for(var g=this.geometries[u].getCoordinates(),w=0;w<g.length;w++)r++,e[r]=g[w];return e},getArea:function(){for(var e=0,r=0;r<this.geometries.length;r++)e+=this.geometries[r].getArea();return e},equalsExact:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];if(!this.isEquivalentClass(e))return!1;var u=e;if(this.geometries.length!==u.geometries.length)return!1;for(var g=0;g<this.geometries.length;g++)if(!this.geometries[g].equalsExact(u.geometries[g],r))return!1;return!0}return Jt.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var e=0;e<this.geometries.length;e++)this.geometries[e].normalize();ir.sort(this.geometries)},getCoordinate:function(){return this.isEmpty()?null:this.geometries[0].getCoordinate()},getBoundaryDimension:function(){for(var e=Rt.FALSE,r=0;r<this.geometries.length;r++)e=Math.max(e,this.geometries[r].getBoundaryDimension());return e},getDimension:function(){for(var e=Rt.FALSE,r=0;r<this.geometries.length;r++)e=Math.max(e,this.geometries[r].getDimension());return e},getLength:function(){for(var e=0,r=0;r<this.geometries.length;r++)e+=this.geometries[r].getLength();return e},getNumPoints:function(){for(var e=0,r=0;r<this.geometries.length;r++)e+=this.geometries[r].getNumPoints();return e},getNumGeometries:function(){return this.geometries.length},reverse:function(){for(var e=this.geometries.length,r=new Array(e).fill(null),u=0;u<this.geometries.length;u++)r[u]=this.geometries[u].reverse();return this.getFactory().createGeometryCollection(r)},compareToSameClass:function(){if(arguments.length===1){var e=arguments[0],r=new dr(ir.asList(this.geometries)),u=new dr(ir.asList(e.geometries));return this.compare(r,u)}if(arguments.length===2){for(var g=arguments[0],w=arguments[1],O=g,H=this.getNumGeometries(),Q=O.getNumGeometries(),ye=0;H>ye&&Q>ye;){var Ue=this.getGeometryN(ye),ct=O.getGeometryN(ye),yt=Ue.compareToSameClass(ct,w);if(yt!==0)return yt;ye++}return H>ye?1:Q>ye?-1:0}},apply:function(){if(kt(arguments[0],Ur))for(var e=arguments[0],r=0;r<this.geometries.length;r++)this.geometries[r].apply(e);else if(kt(arguments[0],So)){var u=arguments[0];if(this.geometries.length===0)return null;for(var r=0;r<this.geometries.length&&(this.geometries[r].apply(u),!u.isDone());r++);u.isGeometryChanged()&&this.geometryChanged()}else if(kt(arguments[0],Fs)){var g=arguments[0];g.filter(this);for(var r=0;r<this.geometries.length;r++)this.geometries[r].apply(g)}else if(kt(arguments[0],es)){var w=arguments[0];w.filter(this);for(var r=0;r<this.geometries.length;r++)this.geometries[r].apply(w)}},getBoundary:function(){return this.checkNotGeometryCollection(this),Pe.shouldNeverReachHere(),null},clone:function(){var e=Jt.prototype.clone.call(this);e.geometries=new Array(this.geometries.length).fill(null);for(var r=0;r<this.geometries.length;r++)e.geometries[r]=this.geometries[r].clone();return e},getGeometryType:function(){return"GeometryCollection"},copy:function(){for(var e=new Array(this.geometries.length).fill(null),r=0;r<e.length;r++)e[r]=this.geometries[r].copy();return new jn(e,this.factory)},isEmpty:function(){for(var e=0;e<this.geometries.length;e++)if(!this.geometries[e].isEmpty())return!1;return!0},interfaces_:function(){return[]},getClass:function(){return jn}}),jn.serialVersionUID=-5694727726395021e3,Te(fr,jn),N(fr.prototype,{getSortIndex:function(){return Jt.SORTINDEX_MULTILINESTRING},equalsExact:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.isEquivalentClass(e)?jn.prototype.equalsExact.call(this,e,r):!1}return jn.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return this.isClosed()?Rt.FALSE:0},isClosed:function(){if(this.isEmpty())return!1;for(var e=0;e<this.geometries.length;e++)if(!this.geometries[e].isClosed())return!1;return!0},getDimension:function(){return 1},reverse:function(){for(var e=this.geometries.length,r=new Array(e).fill(null),u=0;u<this.geometries.length;u++)r[e-1-u]=this.geometries[u].reverse();return this.getFactory().createMultiLineString(r)},getBoundary:function(){return new Ms(this).getBoundary()},getGeometryType:function(){return"MultiLineString"},copy:function(){for(var e=new Array(this.geometries.length).fill(null),r=0;r<e.length;r++)e[r]=this.geometries[r].copy();return new fr(e,this.factory)},interfaces_:function(){return[fa]},getClass:function(){return fr}}),fr.serialVersionUID=8166665132445434e3,N(Ms.prototype,{boundaryMultiLineString:function(e){if(this.geom.isEmpty())return this.getEmptyMultiPoint();var r=this.computeBoundaryCoordinates(e);return r.length===1?this.geomFact.createPoint(r[0]):this.geomFact.createMultiPointFromCoords(r)},getBoundary:function(){return this.geom instanceof Fn?this.boundaryLineString(this.geom):this.geom instanceof fr?this.boundaryMultiLineString(this.geom):this.geom.getBoundary()},boundaryLineString:function(e){if(this.geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var r=this.bnRule.isInBoundary(2);return r?e.getStartPoint():this.geomFact.createMultiPoint()}return this.geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])},getEmptyMultiPoint:function(){return this.geomFact.createMultiPoint()},computeBoundaryCoordinates:function(e){var r=new ze;this.endpointMap=new nn;for(var u=0;u<e.getNumGeometries();u++){var g=e.getGeometryN(u);g.getNumPoints()!==0&&(this.addEndpoint(g.getCoordinateN(0)),this.addEndpoint(g.getCoordinateN(g.getNumPoints()-1)))}for(var w=this.endpointMap.entrySet().iterator();w.hasNext();){var O=w.next(),H=O.getValue(),Q=H.count;this.bnRule.isInBoundary(Q)&&r.add(O.getKey())}return bn.toCoordinateArray(r)},addEndpoint:function(e){var r=this.endpointMap.get(e);r===null&&(r=new Za,this.endpointMap.put(e,r)),r.count++},interfaces_:function(){return[]},getClass:function(){return Ms}}),Ms.getBoundary=function(){if(arguments.length===1){var e=arguments[0],r=new Ms(e);return r.getBoundary()}if(arguments.length===2){var u=arguments[0],g=arguments[1],r=new Ms(u,g);return r.getBoundary()}},N(Za.prototype,{interfaces_:function(){return[]},getClass:function(){return Za}}),N(Rr.prototype,{interfaces_:function(){return[]},getClass:function(){return Rr}}),Rr.chars=function(e,r){for(var u=new Array(r).fill(null),g=0;r>g;g++)u[g]=e;return new String(u)},Rr.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],r=new Ho,u=new ro;return e.printStackTrace(u),r.toString()}if(arguments.length===2){for(var g=arguments[0],w=arguments[1],O="",H=new qu(Rr.getStackTrace(g)),Q=new Ws,ye=0;w>ye;ye++)try{O+=Q.readLine()+Rr.NEWLINE}catch(Ue){if(!(Ue instanceof Ic))throw Ue;Pe.shouldNeverReachHere()}finally{}return O}},Rr.split=function(e,r){for(var u=r.length,g=new ze,w=""+e,O=w.indexOf(r);O>=0;){var H=w.substring(0,O);g.add(H),w=w.substring(O+u),O=w.indexOf(r)}w.length>0&&g.add(w);for(var Q=new Array(g.size()).fill(null),ye=0;ye<Q.length;ye++)Q[ye]=g.get(ye);return Q},Rr.toString=function(){if(arguments.length===1){var e=arguments[0];return Rr.SIMPLE_ORDINATE_FORMAT.format(e)}},Rr.spaces=function(e){return Rr.chars(" ",e)},Rr.NEWLINE=xi.getProperty("line.separator"),Rr.SIMPLE_ORDINATE_FORMAT=new Xn,N(Yi.prototype,{interfaces_:function(){return[]},getClass:function(){return Yi}}),Yi.copyCoord=function(e,r,u,g){for(var w=Math.min(e.getDimension(),u.getDimension()),O=0;w>O;O++)u.setOrdinate(g,O,e.getOrdinate(r,O))},Yi.isRing=function(e){var r=e.size();return r===0?!0:3>=r?!1:e.getOrdinate(0,Vn.X)===e.getOrdinate(r-1,Vn.X)&&e.getOrdinate(0,Vn.Y)===e.getOrdinate(r-1,Vn.Y)},Yi.isEqual=function(e,r){var u=e.size(),g=r.size();if(u!==g)return!1;for(var w=Math.min(e.getDimension(),r.getDimension()),O=0;u>O;O++)for(var H=0;w>H;H++){var Q=e.getOrdinate(O,H),ye=r.getOrdinate(O,H);if(!(e.getOrdinate(O,H)===r.getOrdinate(O,H)||te.isNaN(Q)&&te.isNaN(ye)))return!1}return!0},Yi.extend=function(e,r,u){var g=e.create(u,r.getDimension()),w=r.size();if(Yi.copy(r,0,g,0,w),w>0)for(var O=w;u>O;O++)Yi.copy(r,w-1,g,O,1);return g},Yi.reverse=function(e){for(var r=e.size()-1,u=Math.trunc(r/2),g=0;u>=g;g++)Yi.swap(e,g,r-g)},Yi.swap=function(e,r,u){if(r===u)return null;for(var g=0;g<e.getDimension();g++){var w=e.getOrdinate(r,g);e.setOrdinate(r,g,e.getOrdinate(u,g)),e.setOrdinate(u,g,w)}},Yi.copy=function(e,r,u,g,w){for(var O=0;w>O;O++)Yi.copyCoord(e,r+O,u,g+O)},Yi.toString=function(){if(arguments.length===1){var e=arguments[0],r=e.size();if(r===0)return"()";var u=e.getDimension(),g=new Qt;g.append("(");for(var w=0;r>w;w++){w>0&&g.append(" ");for(var O=0;u>O;O++)O>0&&g.append(","),g.append(Rr.toString(e.getOrdinate(w,O)))}return g.append(")"),g.toString()}},Yi.ensureValidRing=function(e,r){var u=r.size();if(u===0)return r;if(3>=u)return Yi.createClosedRing(e,r,4);var g=r.getOrdinate(0,Vn.X)===r.getOrdinate(u-1,Vn.X)&&r.getOrdinate(0,Vn.Y)===r.getOrdinate(u-1,Vn.Y);return g?r:Yi.createClosedRing(e,r,u+1)},Yi.createClosedRing=function(e,r,u){var g=e.create(u,r.getDimension()),w=r.size();Yi.copy(r,0,g,0,w);for(var O=w;u>O;O++)Yi.copy(r,0,g,O,1);return g},Te(Fn,Jt),N(Fn.prototype,{computeEnvelopeInternal:function(){return this.isEmpty()?new et:this.points.expandEnvelope(new et)},isRing:function(){return this.isClosed()&&this.isSimple()},getSortIndex:function(){return Jt.SORTINDEX_LINESTRING},getCoordinates:function(){return this.points.toCoordinateArray()},equalsExact:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];if(!this.isEquivalentClass(e))return!1;var u=e;if(this.points.size()!==u.points.size())return!1;for(var g=0;g<this.points.size();g++)if(!this.equal(this.points.getCoordinate(g),u.points.getCoordinate(g),r))return!1;return!0}return Jt.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var e=0;e<Math.trunc(this.points.size()/2);e++){var r=this.points.size()-1-e;if(!this.points.getCoordinate(e).equals(this.points.getCoordinate(r)))return this.points.getCoordinate(e).compareTo(this.points.getCoordinate(r))>0&&Yi.reverse(this.points),null}},getCoordinate:function(){return this.isEmpty()?null:this.points.getCoordinate(0)},getBoundaryDimension:function(){return this.isClosed()?Rt.FALSE:0},isClosed:function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},getEndPoint:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},getDimension:function(){return 1},getLength:function(){return zt.computeLength(this.points)},getNumPoints:function(){return this.points.size()},reverse:function(){var e=this.points.copy();Yi.reverse(e);var r=this.getFactory().createLineString(e);return r},compareToSameClass:function(){if(arguments.length===1){for(var e=arguments[0],r=e,u=0,g=0;u<this.points.size()&&g<r.points.size();){var w=this.points.getCoordinate(u).compareTo(r.points.getCoordinate(g));if(w!==0)return w;u++,g++}return u<this.points.size()?1:g<r.points.size()?-1:0}if(arguments.length===2){var O=arguments[0],H=arguments[1],r=O;return H.compare(this.points,r.points)}},apply:function(){if(kt(arguments[0],Ur))for(var e=arguments[0],r=0;r<this.points.size();r++)e.filter(this.points.getCoordinate(r));else if(kt(arguments[0],So)){var u=arguments[0];if(this.points.size()===0)return null;for(var r=0;r<this.points.size()&&(u.filter(this.points,r),!u.isDone());r++);u.isGeometryChanged()&&this.geometryChanged()}else if(kt(arguments[0],Fs)){var g=arguments[0];g.filter(this)}else if(kt(arguments[0],es)){var w=arguments[0];w.filter(this)}},getBoundary:function(){return new Ms(this).getBoundary()},isEquivalentClass:function(e){return e instanceof Fn},clone:function(){var e=Jt.prototype.clone.call(this);return e.points=this.points.clone(),e},getCoordinateN:function(e){return this.points.getCoordinate(e)},getGeometryType:function(){return"LineString"},copy:function(){return new Fn(this.points.copy(),this.factory)},getCoordinateSequence:function(){return this.points},isEmpty:function(){return this.points.size()===0},init:function(e){if(e===null&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),e.size()===1)throw new X("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this.points=e},isCoordinate:function(e){for(var r=0;r<this.points.size();r++)if(this.points.getCoordinate(r).equals(e))return!0;return!1},getStartPoint:function(){return this.isEmpty()?null:this.getPointN(0)},getPointN:function(e){return this.getFactory().createPoint(this.points.getCoordinate(e))},interfaces_:function(){return[fa]},getClass:function(){return Fn}}),Fn.serialVersionUID=0x2b2b51ba435c8e00,N(pa.prototype,{interfaces_:function(){return[]},getClass:function(){return pa}}),Te(Fi,Jt),N(Fi.prototype,{computeEnvelopeInternal:function(){if(this.isEmpty())return new et;var e=new et;return e.expandToInclude(this.coordinates.getX(0),this.coordinates.getY(0)),e},getSortIndex:function(){return Jt.SORTINDEX_POINT},getCoordinates:function(){return this.isEmpty()?[]:[this.getCoordinate()]},equalsExact:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.isEquivalentClass(e)?this.isEmpty()&&e.isEmpty()?!0:this.isEmpty()!==e.isEmpty()?!1:this.equal(e.getCoordinate(),this.getCoordinate(),r):!1}return Jt.prototype.equalsExact.apply(this,arguments)},normalize:function(){},getCoordinate:function(){return this.coordinates.size()!==0?this.coordinates.getCoordinate(0):null},getBoundaryDimension:function(){return Rt.FALSE},getDimension:function(){return 0},getNumPoints:function(){return this.isEmpty()?0:1},reverse:function(){return this.copy()},getX:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x},compareToSameClass:function(){if(arguments.length===1){var e=arguments[0],r=e;return this.getCoordinate().compareTo(r.getCoordinate())}if(arguments.length===2){var u=arguments[0],g=arguments[1],r=u;return g.compare(this.coordinates,r.coordinates)}},apply:function(){if(kt(arguments[0],Ur)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(kt(arguments[0],So)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.coordinates,0),r.isGeometryChanged()&&this.geometryChanged()}else if(kt(arguments[0],Fs)){var u=arguments[0];u.filter(this)}else if(kt(arguments[0],es)){var g=arguments[0];g.filter(this)}},getBoundary:function(){return this.getFactory().createGeometryCollection(null)},clone:function(){var e=Jt.prototype.clone.call(this);return e.coordinates=this.coordinates.clone(),e},getGeometryType:function(){return"Point"},copy:function(){return new Fi(this.coordinates.copy(),this.factory)},getCoordinateSequence:function(){return this.coordinates},getY:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y},isEmpty:function(){return this.coordinates.size()===0},init:function(e){e===null&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),Pe.isTrue(e.size()<=1),this.coordinates=e},isSimple:function(){return!0},interfaces_:function(){return[pa]},getClass:function(){return Fi}}),Fi.serialVersionUID=4902022702746615e3,N(Ke.prototype,{interfaces_:function(){return[]},getClass:function(){return Ke}}),Te(ne,Jt),N(ne.prototype,{computeEnvelopeInternal:function(){return this.shell.getEnvelopeInternal()},getSortIndex:function(){return Jt.SORTINDEX_POLYGON},getCoordinates:function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),r=-1,u=this.shell.getCoordinates(),g=0;g<u.length;g++)r++,e[r]=u[g];for(var w=0;w<this.holes.length;w++)for(var O=this.holes[w].getCoordinates(),H=0;H<O.length;H++)r++,e[r]=O[H];return e},getArea:function(){var e=0;e+=Math.abs(zt.signedArea(this.shell.getCoordinateSequence()));for(var r=0;r<this.holes.length;r++)e-=Math.abs(zt.signedArea(this.holes[r].getCoordinateSequence()));return e},isRectangle:function(){if(this.getNumInteriorRing()!==0||this.shell===null||this.shell.getNumPoints()!==5)return!1;for(var e=this.shell.getCoordinateSequence(),r=this.getEnvelopeInternal(),u=0;5>u;u++){var g=e.getX(u);if(g!==r.getMinX()&&g!==r.getMaxX())return!1;var w=e.getY(u);if(w!==r.getMinY()&&w!==r.getMaxY())return!1}for(var O=e.getX(0),H=e.getY(0),u=1;4>=u;u++){var g=e.getX(u),w=e.getY(u),Q=g!==O,ye=w!==H;if(Q===ye)return!1;O=g,H=w}return!0},equalsExact:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];if(!this.isEquivalentClass(e))return!1;var u=e,g=this.shell,w=u.shell;if(!g.equalsExact(w,r)||this.holes.length!==u.holes.length)return!1;for(var O=0;O<this.holes.length;O++)if(!this.holes[O].equalsExact(u.holes[O],r))return!1;return!0}return Jt.prototype.equalsExact.apply(this,arguments)},normalize:function(){if(arguments.length===0){this.normalize(this.shell,!0);for(var e=0;e<this.holes.length;e++)this.normalize(this.holes[e],!1);ir.sort(this.holes)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];if(r.isEmpty())return null;var g=new Array(r.getCoordinates().length-1).fill(null);xi.arraycopy(r.getCoordinates(),0,g,0,g.length);var w=bn.minCoordinate(r.getCoordinates());bn.scroll(g,w),xi.arraycopy(g,0,r.getCoordinates(),0,g.length),r.getCoordinates()[g.length]=g[0],zt.isCCW(r.getCoordinates())===u&&bn.reverse(r.getCoordinates())}},getCoordinate:function(){return this.shell.getCoordinate()},getNumInteriorRing:function(){return this.holes.length},getBoundaryDimension:function(){return 1},getDimension:function(){return 2},getLength:function(){var e=0;e+=this.shell.getLength();for(var r=0;r<this.holes.length;r++)e+=this.holes[r].getLength();return e},getNumPoints:function(){for(var e=this.shell.getNumPoints(),r=0;r<this.holes.length;r++)e+=this.holes[r].getNumPoints();return e},reverse:function(){var e=this.copy();e.shell=this.shell.copy().reverse(),e.holes=new Array(this.holes.length).fill(null);for(var r=0;r<this.holes.length;r++)e.holes[r]=this.holes[r].copy().reverse();return e},convexHull:function(){return this.getExteriorRing().convexHull()},compareToSameClass:function(){if(arguments.length===1){var e=arguments[0],r=this.shell,u=e.shell;return r.compareToSameClass(u)}if(arguments.length===2){var g=arguments[0],w=arguments[1],O=g,r=this.shell,u=O.shell,H=r.compareToSameClass(u,w);if(H!==0)return H;for(var Q=this.getNumInteriorRing(),ye=O.getNumInteriorRing(),Ue=0;Q>Ue&&ye>Ue;){var ct=this.getInteriorRingN(Ue),yt=O.getInteriorRingN(Ue),Ft=ct.compareToSameClass(yt,w);if(Ft!==0)return Ft;Ue++}return Q>Ue?1:ye>Ue?-1:0}},apply:function(){if(kt(arguments[0],Ur)){var e=arguments[0];this.shell.apply(e);for(var r=0;r<this.holes.length;r++)this.holes[r].apply(e)}else if(kt(arguments[0],So)){var u=arguments[0];if(this.shell.apply(u),!u.isDone())for(var r=0;r<this.holes.length&&(this.holes[r].apply(u),!u.isDone());r++);u.isGeometryChanged()&&this.geometryChanged()}else if(kt(arguments[0],Fs)){var g=arguments[0];g.filter(this)}else if(kt(arguments[0],es)){var w=arguments[0];w.filter(this),this.shell.apply(w);for(var r=0;r<this.holes.length;r++)this.holes[r].apply(w)}},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this.holes.length+1).fill(null);e[0]=this.shell;for(var r=0;r<this.holes.length;r++)e[r+1]=this.holes[r];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)},clone:function(){var e=Jt.prototype.clone.call(this);e.shell=this.shell.clone(),e.holes=new Array(this.holes.length).fill(null);for(var r=0;r<this.holes.length;r++)e.holes[r]=this.holes[r].clone();return e},getGeometryType:function(){return"Polygon"},copy:function(){for(var e=this.shell.copy(),r=new Array(this.holes.length).fill(null),u=0;u<r.length;u++)r[u]=this.holes[u].copy();return new ne(e,r,this.factory)},getExteriorRing:function(){return this.shell},isEmpty:function(){return this.shell.isEmpty()},getInteriorRingN:function(e){return this.holes[e]},interfaces_:function(){return[Ke]},getClass:function(){return ne}}),ne.serialVersionUID=-0x307ffefd8dc97200,Te(oe,jn),N(oe.prototype,{getSortIndex:function(){return Jt.SORTINDEX_MULTIPOINT},isValid:function(){return!0},equalsExact:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.isEquivalentClass(e)?jn.prototype.equalsExact.call(this,e,r):!1}return jn.prototype.equalsExact.apply(this,arguments)},getCoordinate:function(){if(arguments.length===1){var e=arguments[0];return this.geometries[e].getCoordinate()}return jn.prototype.getCoordinate.apply(this,arguments)},getBoundaryDimension:function(){return Rt.FALSE},getDimension:function(){return 0},getBoundary:function(){return this.getFactory().createGeometryCollection(null)},getGeometryType:function(){return"MultiPoint"},copy:function(){for(var e=new Array(this.geometries.length).fill(null),r=0;r<e.length;r++)e[r]=this.geometries[r].copy();return new oe(e,this.factory)},interfaces_:function(){return[pa]},getClass:function(){return oe}}),oe.serialVersionUID=-8048474874175356e3,Te(ge,Fn),N(ge.prototype,{getSortIndex:function(){return Jt.SORTINDEX_LINEARRING},getBoundaryDimension:function(){return Rt.FALSE},isClosed:function(){return this.isEmpty()?!0:Fn.prototype.isClosed.call(this)},reverse:function(){var e=this.points.copy();Yi.reverse(e);var r=this.getFactory().createLinearRing(e);return r},validateConstruction:function(){if(!this.isEmpty()&&!Fn.prototype.isClosed.call(this))throw new X;if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<ge.MINIMUM_VALID_SIZE)throw new X("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},getGeometryType:function(){return"LinearRing"},copy:function(){return new ge(this.points.copy(),this.factory)},interfaces_:function(){return[]},getClass:function(){return ge}}),ge.MINIMUM_VALID_SIZE=4,ge.serialVersionUID=-0x3b229e262367a600,Te(Oe,jn),N(Oe.prototype,{getSortIndex:function(){return Jt.SORTINDEX_MULTIPOLYGON},equalsExact:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.isEquivalentClass(e)?jn.prototype.equalsExact.call(this,e,r):!1}return jn.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return 1},getDimension:function(){return 2},reverse:function(){for(var e=this.geometries.length,r=new Array(e).fill(null),u=0;u<this.geometries.length;u++)r[u]=this.geometries[u].reverse();return this.getFactory().createMultiPolygon(r)},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new ze,r=0;r<this.geometries.length;r++)for(var u=this.geometries[r],g=u.getBoundary(),w=0;w<g.getNumGeometries();w++)e.add(g.getGeometryN(w));var O=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(O))},getGeometryType:function(){return"MultiPolygon"},copy:function(){for(var e=new Array(this.geometries.length).fill(null),r=0;r<e.length;r++)e[r]=this.geometries[r].copy();return new Oe(e,this.factory)},interfaces_:function(){return[Ke]},getClass:function(){return Oe}}),Oe.serialVersionUID=-0x7a5aa1369171980,N(Ce.prototype,{setCopyUserData:function(e){this.isUserDataCopied=e},edit:function(e,r){if(e===null)return null;var u=this.editInternal(e,r);return this.isUserDataCopied&&u.setUserData(e.getUserData()),u},editInternal:function(e,r){return this.factory===null&&(this.factory=e.getFactory()),e instanceof jn?this.editGeometryCollection(e,r):e instanceof ne?this.editPolygon(e,r):e instanceof Fi?r.edit(e,this.factory):e instanceof Fn?r.edit(e,this.factory):(Pe.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)},editGeometryCollection:function(e,r){for(var u=r.edit(e,this.factory),g=new ze,w=0;w<u.getNumGeometries();w++){var O=this.edit(u.getGeometryN(w),r);O===null||O.isEmpty()||g.add(O)}return u.getClass()===oe?this.factory.createMultiPoint(g.toArray([])):u.getClass()===fr?this.factory.createMultiLineString(g.toArray([])):u.getClass()===Oe?this.factory.createMultiPolygon(g.toArray([])):this.factory.createGeometryCollection(g.toArray([]))},editPolygon:function(e,r){var u=r.edit(e,this.factory);if(u===null&&(u=this.factory.createPolygon(null)),u.isEmpty())return u;var g=this.edit(u.getExteriorRing(),r);if(g===null||g.isEmpty())return this.factory.createPolygon();for(var w=new ze,O=0;O<u.getNumInteriorRing();O++){var H=this.edit(u.getInteriorRingN(O),r);H===null||H.isEmpty()||w.add(H)}return this.factory.createPolygon(g,w.toArray([]))},interfaces_:function(){return[]},getClass:function(){return Ce}}),Ce.GeometryEditorOperation=qe,N(tt.prototype,{edit:function(e,r){return e},interfaces_:function(){return[qe]},getClass:function(){return tt}}),N(We.prototype,{edit:function(e,r){if(e instanceof ge)return r.createLinearRing(this.editCoordinates(e.getCoordinates(),e));if(e instanceof Fn)return r.createLineString(this.editCoordinates(e.getCoordinates(),e));if(e instanceof Fi){var u=this.editCoordinates(e.getCoordinates(),e);return u.length>0?r.createPoint(u[0]):r.createPoint()}return e},interfaces_:function(){return[qe]},getClass:function(){return We}}),N(nt.prototype,{edit:function(e,r){return e instanceof ge?r.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Fn?r.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Fi?r.createPoint(this.edit(e.getCoordinateSequence(),e)):e},interfaces_:function(){return[qe]},getClass:function(){return nt}}),Ce.NoOpGeometryOperation=tt,Ce.CoordinateOperation=We,Ce.CoordinateSequenceOperation=nt,N(st.prototype,{setOrdinate:function(e,r,u){switch(r){case Vn.X:this.coordinates[e].x=u;break;case Vn.Y:this.coordinates[e].y=u;break;case Vn.Z:this.coordinates[e].z=u;break;default:throw new X}},size:function(){return this.coordinates.length},getOrdinate:function(e,r){switch(r){case Vn.X:return this.coordinates[e].x;case Vn.Y:return this.coordinates[e].y;case Vn.Z:return this.coordinates[e].z}return te.NaN},getCoordinate:function(){if(arguments.length===1){var e=arguments[0];return this.coordinates[e]}if(arguments.length===2){var r=arguments[0],u=arguments[1];u.x=this.coordinates[r].x,u.y=this.coordinates[r].y,u.z=this.coordinates[r].z}},getCoordinateCopy:function(e){return new ve(this.coordinates[e])},getDimension:function(){return this.dimension},getX:function(e){return this.coordinates[e].x},clone:function(){for(var e=new Array(this.size()).fill(null),r=0;r<this.coordinates.length;r++)e[r]=this.coordinates[r].clone();return new st(e,this.dimension)},expandEnvelope:function(e){for(var r=0;r<this.coordinates.length;r++)e.expandToInclude(this.coordinates[r]);return e},copy:function(){for(var e=new Array(this.size()).fill(null),r=0;r<this.coordinates.length;r++)e[r]=this.coordinates[r].copy();return new st(e,this.dimension)},toString:function(){if(this.coordinates.length>0){var e=new Qt(17*this.coordinates.length);e.append("("),e.append(this.coordinates[0]);for(var r=1;r<this.coordinates.length;r++)e.append(", "),e.append(this.coordinates[r]);return e.append(")"),e.toString()}return"()"},getY:function(e){return this.coordinates[e].y},toCoordinateArray:function(){return this.coordinates},interfaces_:function(){return[Vn,xe]},getClass:function(){return st}}),st.serialVersionUID=-0xcb44a778db18e00,N(lt.prototype,{readResolve:function(){return lt.instance()},create:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new st(e)}if(kt(arguments[0],Vn)){var r=arguments[0];return new st(r)}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];return g>3&&(g=3),2>g?new st(u):new st(u,g)}},interfaces_:function(){return[_n,xe]},getClass:function(){return lt}}),lt.instance=function(){return lt.instanceObject},lt.serialVersionUID=-0x38e49fa6cf6f2e00,lt.instanceObject=new lt;var Ks,ko=Object.defineProperty,dd=Vt({delete:yn,has:vn,get:En,set:ui,keys:Dn,values:bi,entries:ki,forEach:xr,clear:Yn}),fd=typeof Map<"u"&&Map.prototype.values?Map:dd;Ji.prototype=new Zs,Ji.prototype.get=function(e){return this.map_.get(e)||null},Ji.prototype.put=function(e,r){return this.map_.set(e,r),r},Ji.prototype.values=function(){for(var e=new ze,r=this.map_.values(),u=r.next();!u.done;)e.add(u.value),u=r.next();return e},Ji.prototype.entrySet=function(){var e=new pn;return this.map_.entries().forEach(function(r){return e.add(r)}),e},Ji.prototype.size=function(){return this.map_.size()},N(oi.prototype,{equals:function(e){if(!(e instanceof oi))return!1;var r=e;return this.modelType===r.modelType&&this.scale===r.scale},compareTo:function(e){var r=e,u=this.getMaximumSignificantDigits(),g=r.getMaximumSignificantDigits();return new ri(u).compareTo(new ri(g))},getScale:function(){return this.scale},isFloating:function(){return this.modelType===oi.FLOATING||this.modelType===oi.FLOATING_SINGLE},getType:function(){return this.modelType},toString:function(){var e="UNKNOWN";return this.modelType===oi.FLOATING?e="Floating":this.modelType===oi.FLOATING_SINGLE?e="Floating-Single":this.modelType===oi.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e},makePrecise:function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(te.isNaN(e))return e;if(this.modelType===oi.FLOATING_SINGLE){var r=e;return r}return this.modelType===oi.FIXED?Math.round(e*this.scale)/this.scale:e}if(arguments[0]instanceof ve){var u=arguments[0];if(this.modelType===oi.FLOATING)return null;u.x=this.makePrecise(u.x),u.y=this.makePrecise(u.y)}},getMaximumSignificantDigits:function(){var e=16;return this.modelType===oi.FLOATING?e=16:this.modelType===oi.FLOATING_SINGLE?e=6:this.modelType===oi.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e},setScale:function(e){this.scale=Math.abs(e)},interfaces_:function(){return[xe,a]},getClass:function(){return oi}}),oi.mostPrecise=function(e,r){return e.compareTo(r)>=0?e:r},N(Dr.prototype,{readResolve:function(){return Dr.nameToTypeMap.get(this.name)},toString:function(){return this.name},interfaces_:function(){return[xe]},getClass:function(){return Dr}}),Dr.serialVersionUID=-552860263173159e4,Dr.nameToTypeMap=new Ji,oi.Type=Dr,oi.serialVersionUID=7777263578777804e3,oi.FIXED=new Dr("FIXED"),oi.FLOATING=new Dr("FLOATING"),oi.FLOATING_SINGLE=new Dr("FLOATING SINGLE"),oi.maximumPreciseValue=9007199254740992,N(Zn.prototype,{toGeometry:function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new ve(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new ve(e.getMinX(),e.getMinY()),new ve(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new ve(e.getMinX(),e.getMinY()),new ve(e.getMinX(),e.getMaxY()),new ve(e.getMaxX(),e.getMaxY()),new ve(e.getMaxX(),e.getMinY()),new ve(e.getMinX(),e.getMinY())]),null)},createLineString:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLineString(e!==null?this.getCoordinateSequenceFactory().create(e):null)}if(kt(arguments[0],Vn)){var r=arguments[0];return new Fn(r,this)}}},createMultiLineString:function(){if(arguments.length===0)return new fr(null,this);if(arguments.length===1){var e=arguments[0];return new fr(e,this)}},buildGeometry:function(e){for(var r=null,u=!1,g=!1,w=e.iterator();w.hasNext();){var O=w.next(),H=O.getClass();r===null&&(r=H),H!==r&&(u=!0),O.isGeometryCollectionOrDerived()&&(g=!0)}if(r===null)return this.createGeometryCollection();if(u||g)return this.createGeometryCollection(Zn.toGeometryArray(e));var Q=e.iterator().next(),ye=e.size()>1;if(ye){if(Q instanceof ne)return this.createMultiPolygon(Zn.toPolygonArray(e));if(Q instanceof Fn)return this.createMultiLineString(Zn.toLineStringArray(e));if(Q instanceof Fi)return this.createMultiPoint(Zn.toPointArray(e));Pe.shouldNeverReachHere("Unhandled class: "+Q.getClass().getName())}return Q},createMultiPointFromCoords:function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)},createPoint:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof ve){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}if(kt(arguments[0],Vn)){var r=arguments[0];return new Fi(r,this)}}},getCoordinateSequenceFactory:function(){return this.coordinateSequenceFactory},createPolygon:function(){if(arguments.length===0)return new ne(null,null,this);if(arguments.length===1){if(kt(arguments[0],Vn)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var r=arguments[0];return this.createPolygon(this.createLinearRing(r))}if(arguments[0]instanceof ge){var u=arguments[0];return this.createPolygon(u,null)}}else if(arguments.length===2){var g=arguments[0],w=arguments[1];return new ne(g,w,this)}},getSRID:function(){return this.SRID},createGeometryCollection:function(){if(arguments.length===0)return new jn(null,this);if(arguments.length===1){var e=arguments[0];return new jn(e,this)}},createGeometry:function(e){var r=new Ce(this);return r.edit(e,{edit:function(){if(arguments.length===2){var u=arguments[0];return this.coordinateSequenceFactory.create(u)}}})},getPrecisionModel:function(){return this.precisionModel},createLinearRing:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}if(kt(arguments[0],Vn)){var r=arguments[0];return new ge(r,this)}}},createMultiPolygon:function(){if(arguments.length===0)return new Oe(null,this);if(arguments.length===1){var e=arguments[0];return new Oe(e,this)}},createMultiPoint:function(){if(arguments.length===0)return new oe(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new oe(e,this)}if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)}if(kt(arguments[0],Vn)){var u=arguments[0];if(u===null)return this.createMultiPoint(new Array(0).fill(null));for(var g=new Array(u.size()).fill(null),w=0;w<u.size();w++){var O=this.getCoordinateSequenceFactory().create(1,u.getDimension());Yi.copy(u,w,O,0,1),g[w]=this.createPoint(O)}return this.createMultiPoint(g)}}},interfaces_:function(){return[xe]},getClass:function(){return Zn}}),Zn.toMultiPolygonArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.toGeometryArray=function(e){if(e===null)return null;var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.getDefaultCoordinateSequenceFactory=function(){return lt.instance()},Zn.toMultiLineStringArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.toLineStringArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.toMultiPointArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.toLinearRingArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.toPointArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.toPolygonArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)},Zn.createPointFromInternalCoord=function(e,r){return r.getPrecisionModel().makePrecise(e),r.getFactory().createPoint(e)},Zn.serialVersionUID=-6820524753094096e3;var Qs={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};N(uu.prototype,{read:function(e){var r,u,g;e=e.replace(/[\n\r]/g," ");var w=Qs.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(w=Qs.emptyTypeStr.exec(e),w[2]=void 0),w&&(u=w[1].toLowerCase(),g=w[2],pl[u]&&(r=pl[u].apply(this,[g]))),r===void 0)throw new Error("Could not parse WKT "+e);return r},write:function(e){return this.extractGeometry(e)},extractGeometry:function(e){var r=e.getGeometryType().toLowerCase();if(!eo[r])return null;var u=r.toUpperCase();return e.isEmpty()?u+" EMPTY":u+"("+eo[r].apply(this,[e])+")"}});var eo={coordinate:function(e){return e.x+" "+e.y},point:function(e){return eo.coordinate.call(this,e.coordinates.coordinates[0])},multipoint:function(e){for(var r=[],u=0,g=e.geometries.length;g>u;++u)r.push("("+eo.point.apply(this,[e.geometries[u]])+")");return r.join(",")},linestring:function(e){for(var r=[],u=0,g=e.points.coordinates.length;g>u;++u)r.push(eo.coordinate.apply(this,[e.points.coordinates[u]]));return r.join(",")},linearring:function(e){for(var r=[],u=0,g=e.points.coordinates.length;g>u;++u)r.push(eo.coordinate.apply(this,[e.points.coordinates[u]]));return r.join(",")},multilinestring:function(e){for(var r=[],u=0,g=e.geometries.length;g>u;++u)r.push("("+eo.linestring.apply(this,[e.geometries[u]])+")");return r.join(",")},polygon:function(e){var r=[];r.push("("+eo.linestring.apply(this,[e.shell])+")");for(var u=0,g=e.holes.length;g>u;++u)r.push("("+eo.linestring.apply(this,[e.holes[u]])+")");return r.join(",")},multipolygon:function(e){for(var r=[],u=0,g=e.geometries.length;g>u;++u)r.push("("+eo.polygon.apply(this,[e.geometries[u]])+")");return r.join(",")},geometrycollection:function(e){for(var r=[],u=0,g=e.geometries.length;g>u;++u)r.push(this.extractGeometry(e.geometries[u]));return r.join(",")}},pl={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var r=e.trim().split(Qs.spaces);return this.geometryFactory.createPoint(new ve(Number.parseFloat(r[0]),Number.parseFloat(r[1])))},multipoint:function(e){if(e===void 0)return this.geometryFactory.createMultiPoint();for(var r,u=e.trim().split(","),g=[],w=0,O=u.length;O>w;++w)r=u[w].replace(Qs.trimParens,"$1"),g.push(pl.point.apply(this,[r]));return this.geometryFactory.createMultiPoint(g)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var r,u=e.trim().split(","),g=[],w=0,O=u.length;O>w;++w)r=u[w].trim().split(Qs.spaces),g.push(new ve(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(g)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var r,u=e.trim().split(","),g=[],w=0,O=u.length;O>w;++w)r=u[w].trim().split(Qs.spaces),g.push(new ve(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(g)},multilinestring:function(e){if(e===void 0)return this.geometryFactory.createMultiLineString();for(var r,u=e.trim().split(Qs.parenComma),g=[],w=0,O=u.length;O>w;++w)r=u[w].replace(Qs.trimParens,"$1"),g.push(pl.linestring.apply(this,[r]));return this.geometryFactory.createMultiLineString(g)},polygon:function(e){if(e===void 0)return this.geometryFactory.createPolygon();for(var r,u,g,w,O=e.trim().split(Qs.parenComma),H=[],Q=0,ye=O.length;ye>Q;++Q)r=O[Q].replace(Qs.trimParens,"$1"),u=pl.linestring.apply(this,[r]),g=this.geometryFactory.createLinearRing(u.points),Q===0?w=g:H.push(g);return this.geometryFactory.createPolygon(w,H)},multipolygon:function(e){if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var r,u=e.trim().split(Qs.doubleParenComma),g=[],w=0,O=u.length;O>w;++w)r=u[w].replace(Qs.trimParens,"$1"),g.push(pl.polygon.apply(this,[r]));return this.geometryFactory.createMultiPolygon(g)},geometrycollection:function(e){if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var r=e.trim().split("|"),u=[],g=0,w=r.length;w>g;++g)u.push(this.read(r[g]));return this.geometryFactory.createGeometryCollection(u)}};N(Er.prototype,{write:function(e){return this.parser.write(e)}}),N(Er,{toLineString:function(e,r){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+r.x+" "+r.y+" )"}}),N(Si.prototype,{getIndexAlongSegment:function(e,r){return this.computeIntLineIndex(),this.intLineIndex[e][r]},getTopologySummary:function(){var e=new Qt;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()},computeIntersection:function(e,r,u,g){this.inputLines[0][0]=e,this.inputLines[0][1]=r,this.inputLines[1][0]=u,this.inputLines[1][1]=g,this.result=this.computeIntersect(e,r,u,g)},getIntersectionNum:function(){return this.result},computeIntLineIndex:function(){if(arguments.length===0)this.intLineIndex===null&&(this.intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],r=this.getEdgeDistance(e,0),u=this.getEdgeDistance(e,1);r>u?(this.intLineIndex[e][0]=0,this.intLineIndex[e][1]=1):(this.intLineIndex[e][0]=1,this.intLineIndex[e][1]=0)}},isProper:function(){return this.hasIntersection()&&this._isProper},setPrecisionModel:function(e){this.precisionModel=e},isInteriorIntersection:function(){if(arguments.length===0)return this.isInteriorIntersection(0)?!0:!!this.isInteriorIntersection(1);if(arguments.length===1){for(var e=arguments[0],r=0;r<this.result;r++)if(!this.intPt[r].equals2D(this.inputLines[e][0])&&!this.intPt[r].equals2D(this.inputLines[e][1]))return!0;return!1}},getIntersection:function(e){return this.intPt[e]},isEndPoint:function(){return this.hasIntersection()&&!this._isProper},hasIntersection:function(){return this.result!==Si.NO_INTERSECTION},getEdgeDistance:function(e,r){var u=Si.computeEdgeDistance(this.intPt[r],this.inputLines[e][0],this.inputLines[e][1]);return u},isCollinear:function(){return this.result===Si.COLLINEAR_INTERSECTION},toString:function(){return Er.toLineString(this.inputLines[0][0],this.inputLines[0][1])+" - "+Er.toLineString(this.inputLines[1][0],this.inputLines[1][1])+this.getTopologySummary()},getEndpoint:function(e,r){return this.inputLines[e][r]},isIntersection:function(e){for(var r=0;r<this.result;r++)if(this.intPt[r].equals2D(e))return!0;return!1},getIntersectionAlongSegment:function(e,r){return this.computeIntLineIndex(),this.intPt[this.intLineIndex[e][r]]},interfaces_:function(){return[]},getClass:function(){return Si}}),Si.computeEdgeDistance=function(e,r,u){var g=Math.abs(u.x-r.x),w=Math.abs(u.y-r.y),O=-1;if(e.equals(r))O=0;else if(e.equals(u))O=g>w?g:w;else{var H=Math.abs(e.x-r.x),Q=Math.abs(e.y-r.y);O=g>w?H:Q,O!==0||e.equals(r)||(O=Math.max(H,Q))}return Pe.isTrue(!(O===0&&!e.equals(r)),"Bad distance calculation"),O},Si.nonRobustComputeEdgeDistance=function(e,r,u){var g=e.x-r.x,w=e.y-r.y,O=Math.sqrt(g*g+w*w);return Pe.isTrue(!(O===0&&!e.equals(r)),"Invalid distance calculation"),O},Si.DONT_INTERSECT=0,Si.DO_INTERSECT=1,Si.COLLINEAR=2,Si.NO_INTERSECTION=0,Si.POINT_INTERSECTION=1,Si.COLLINEAR_INTERSECTION=2,Te(pr,Si),N(pr.prototype,{isInSegmentEnvelopes:function(e){var r=new et(this.inputLines[0][0],this.inputLines[0][1]),u=new et(this.inputLines[1][0],this.inputLines[1][1]);return r.contains(e)&&u.contains(e)},computeIntersection:function(){if(arguments.length!==3)return Si.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],r=arguments[1],u=arguments[2];return this._isProper=!1,et.intersects(r,u,e)&&zt.orientationIndex(r,u,e)===0&&zt.orientationIndex(u,r,e)===0?(this._isProper=!0,(e.equals(r)||e.equals(u))&&(this._isProper=!1),this.result=Si.POINT_INTERSECTION,null):void(this.result=Si.NO_INTERSECTION)},normalizeToMinimum:function(e,r,u,g,w){w.x=this.smallestInAbsValue(e.x,r.x,u.x,g.x),w.y=this.smallestInAbsValue(e.y,r.y,u.y,g.y),e.x-=w.x,e.y-=w.y,r.x-=w.x,r.y-=w.y,u.x-=w.x,u.y-=w.y,g.x-=w.x,g.y-=w.y},safeHCoordinateIntersection:function(e,r,u,g){var w=null;try{w=hr.intersection(e,r,u,g)}catch(O){if(!(O instanceof it))throw O;w=pr.nearestEndpoint(e,r,u,g)}finally{}return w},intersection:function(e,r,u,g){var w=this.intersectionWithNormalization(e,r,u,g);return this.isInSegmentEnvelopes(w)||(w=new ve(pr.nearestEndpoint(e,r,u,g))),this.precisionModel!==null&&this.precisionModel.makePrecise(w),w},smallestInAbsValue:function(e,r,u,g){var w=e,O=Math.abs(w);return Math.abs(r)<O&&(w=r,O=Math.abs(r)),Math.abs(u)<O&&(w=u,O=Math.abs(u)),Math.abs(g)<O&&(w=g),w},checkDD:function(e,r,u,g,w){var O=tn.intersection(e,r,u,g),H=this.isInSegmentEnvelopes(O);xi.out.println("DD in env = "+H+"  --------------------- "+O),w.distance(O)>1e-4&&xi.out.println("Distance = "+w.distance(O))},intersectionWithNormalization:function(e,r,u,g){var w=new ve(e),O=new ve(r),H=new ve(u),Q=new ve(g),ye=new ve;this.normalizeToEnvCentre(w,O,H,Q,ye);var Ue=this.safeHCoordinateIntersection(w,O,H,Q);return Ue.x+=ye.x,Ue.y+=ye.y,Ue},computeCollinearIntersection:function(e,r,u,g){var w=et.intersects(e,r,u),O=et.intersects(e,r,g),H=et.intersects(u,g,e),Q=et.intersects(u,g,r);return w&&O?(this.intPt[0]=u,this.intPt[1]=g,Si.COLLINEAR_INTERSECTION):H&&Q?(this.intPt[0]=e,this.intPt[1]=r,Si.COLLINEAR_INTERSECTION):w&&H?(this.intPt[0]=u,this.intPt[1]=e,!u.equals(e)||O||Q?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):w&&Q?(this.intPt[0]=u,this.intPt[1]=r,!u.equals(r)||O||H?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):O&&H?(this.intPt[0]=g,this.intPt[1]=e,!g.equals(e)||w||Q?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):O&&Q?(this.intPt[0]=g,this.intPt[1]=r,!g.equals(r)||w||H?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):Si.NO_INTERSECTION},normalizeToEnvCentre:function(e,r,u,g,w){var O=e.x<r.x?e.x:r.x,H=e.y<r.y?e.y:r.y,Q=e.x>r.x?e.x:r.x,ye=e.y>r.y?e.y:r.y,Ue=u.x<g.x?u.x:g.x,ct=u.y<g.y?u.y:g.y,yt=u.x>g.x?u.x:g.x,Ft=u.y>g.y?u.y:g.y,sn=O>Ue?O:Ue,Tn=yt>Q?Q:yt,Pn=H>ct?H:ct,Ai=Ft>ye?ye:Ft,er=(sn+Tn)/2,Ds=(Pn+Ai)/2;w.x=er,w.y=Ds,e.x-=w.x,e.y-=w.y,r.x-=w.x,r.y-=w.y,u.x-=w.x,u.y-=w.y,g.x-=w.x,g.y-=w.y},computeIntersect:function(e,r,u,g){if(this._isProper=!1,!et.intersects(e,r,u,g))return Si.NO_INTERSECTION;var w=zt.orientationIndex(e,r,u),O=zt.orientationIndex(e,r,g);if(w>0&&O>0||0>w&&0>O)return Si.NO_INTERSECTION;var H=zt.orientationIndex(u,g,e),Q=zt.orientationIndex(u,g,r);if(H>0&&Q>0||0>H&&0>Q)return Si.NO_INTERSECTION;var ye=w===0&&O===0&&H===0&&Q===0;return ye?this.computeCollinearIntersection(e,r,u,g):(w===0||O===0||H===0||Q===0?(this._isProper=!1,e.equals2D(u)||e.equals2D(g)?this.intPt[0]=e:r.equals2D(u)||r.equals2D(g)?this.intPt[0]=r:w===0?this.intPt[0]=new ve(u):O===0?this.intPt[0]=new ve(g):H===0?this.intPt[0]=new ve(e):Q===0&&(this.intPt[0]=new ve(r))):(this._isProper=!0,this.intPt[0]=this.intersection(e,r,u,g)),Si.POINT_INTERSECTION)},interfaces_:function(){return[]},getClass:function(){return pr}}),pr.nearestEndpoint=function(e,r,u,g){var w=e,O=zt.distancePointLine(e,u,g),H=zt.distancePointLine(r,u,g);return O>H&&(O=H,w=r),H=zt.distancePointLine(u,e,r),O>H&&(O=H,w=u),H=zt.distancePointLine(g,e,r),O>H&&(O=H,w=g),w},N(so.prototype,{interfaces_:function(){return[]},getClass:function(){return so}}),so.orientationIndex=function(e,r,u){var g=r.x-e.x,w=r.y-e.y,O=u.x-r.x,H=u.y-r.y;return so.signOfDet2x2(g,w,O,H)},so.signOfDet2x2=function(e,r,u,g){var w=null,O=null,H=null;if(w=1,e===0||g===0)return r===0||u===0?0:r>0?u>0?-w:w:u>0?w:-w;if(r===0||u===0)return g>0?e>0?w:-w:e>0?-w:w;if(r>0?g>0?g>=r||(w=-w,O=e,e=u,u=O,O=r,r=g,g=O):-g>=r?(w=-w,u=-u,g=-g):(O=e,e=-u,u=O,O=r,r=-g,g=O):g>0?g>=-r?(w=-w,e=-e,r=-r):(O=-e,e=u,u=O,O=-r,r=g,g=O):r>=g?(e=-e,r=-r,u=-u,g=-g):(w=-w,O=-e,e=-u,u=O,O=-r,r=-g,g=O),e>0){if(!(u>0)||!(u>=e))return w}else{if(u>0||!(e>=u))return-w;w=-w,e=-e,u=-u}for(;;){if(H=Math.floor(u/e),u-=H*e,g-=H*r,0>g)return-w;if(g>r)return w;if(e>u+u){if(g+g>r)return w}else{if(r>g+g)return-w;u=e-u,g=r-g,w=-w}if(g===0)return u===0?0:-w;if(u===0||(H=Math.floor(e/u),e-=H*u,r-=H*g,0>r))return w;if(r>g)return-w;if(u>e+e){if(r+r>g)return-w}else{if(g>r+r)return w;e=u-e,r=g-r,w=-w}if(r===0)return e===0?0:w;if(e===0)return-w}},N(oo.prototype,{countSegment:function(e,r){if(e.x<this.p.x&&r.x<this.p.x)return null;if(this.p.x===r.x&&this.p.y===r.y)return this.isPointOnSegment=!0,null;if(e.y===this.p.y&&r.y===this.p.y){var u=e.x,g=r.x;return u>g&&(u=r.x,g=e.x),this.p.x>=u&&this.p.x<=g&&(this.isPointOnSegment=!0),null}if(e.y>this.p.y&&r.y<=this.p.y||r.y>this.p.y&&e.y<=this.p.y){var w=e.x-this.p.x,O=e.y-this.p.y,H=r.x-this.p.x,Q=r.y-this.p.y,ye=so.signOfDet2x2(w,O,H,Q);if(ye===0)return this.isPointOnSegment=!0,null;O>Q&&(ye=-ye),ye>0&&this.crossingCount++}},isPointInPolygon:function(){return this.getLocation()!==le.EXTERIOR},getLocation:function(){return this.isPointOnSegment?le.BOUNDARY:this.crossingCount%2===1?le.INTERIOR:le.EXTERIOR},isOnSegment:function(){return this.isPointOnSegment},interfaces_:function(){return[]},getClass:function(){return oo}}),oo.locatePointInRing=function(){if(arguments[0]instanceof ve&&kt(arguments[1],Vn)){for(var e=arguments[0],r=arguments[1],u=new oo(e),g=new ve,w=new ve,O=1;O<r.size();O++)if(r.getCoordinate(O,g),r.getCoordinate(O-1,w),u.countSegment(g,w),u.isOnSegment())return u.getLocation();return u.getLocation()}if(arguments[0]instanceof ve&&arguments[1]instanceof Array){for(var H=arguments[0],Q=arguments[1],u=new oo(H),O=1;O<Q.length;O++){var g=Q[O],w=Q[O-1];if(u.countSegment(g,w),u.isOnSegment())return u.getLocation()}return u.getLocation()}},N(zt.prototype,{interfaces_:function(){return[]},getClass:function(){return zt}}),zt.orientationIndex=function(e,r,u){return tn.orientationIndex(e,r,u)},zt.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var r=0,u=e[0].x,g=1;g<e.length-1;g++){var w=e[g].x-u,O=e[g+1].y,H=e[g-1].y;r+=w*(H-O)}return r/2}if(kt(arguments[0],Vn)){var Q=arguments[0],ye=Q.size();if(3>ye)return 0;var Ue=new ve,ct=new ve,yt=new ve;Q.getCoordinate(0,ct),Q.getCoordinate(1,yt);var u=ct.x;yt.x-=u;for(var r=0,g=1;ye-1>g;g++)Ue.y=ct.y,ct.x=yt.x,ct.y=yt.y,Q.getCoordinate(g+1,yt),yt.x-=u,r+=ct.x*(Ue.y-yt.y);return r/2}},zt.distanceLineLine=function(e,r,u,g){if(e.equals(r))return zt.distancePointLine(e,u,g);if(u.equals(g))return zt.distancePointLine(g,e,r);var w=!1;if(et.intersects(e,r,u,g)){var O=(r.x-e.x)*(g.y-u.y)-(r.y-e.y)*(g.x-u.x);if(O===0)w=!0;else{var H=(e.y-u.y)*(g.x-u.x)-(e.x-u.x)*(g.y-u.y),Q=(e.y-u.y)*(r.x-e.x)-(e.x-u.x)*(r.y-e.y),ye=Q/O,Ue=H/O;(0>Ue||Ue>1||0>ye||ye>1)&&(w=!0)}}else w=!0;return w?zn.min(zt.distancePointLine(e,u,g),zt.distancePointLine(r,u,g),zt.distancePointLine(u,e,r),zt.distancePointLine(g,e,r)):0},zt.isPointInRing=function(e,r){return zt.locatePointInRing(e,r)!==le.EXTERIOR},zt.computeLength=function(e){var r=e.size();if(1>=r)return 0;var u=0,g=new ve;e.getCoordinate(0,g);for(var w=g.x,O=g.y,H=1;r>H;H++){e.getCoordinate(H,g);var Q=g.x,ye=g.y,Ue=Q-w,ct=ye-O;u+=Math.sqrt(Ue*Ue+ct*ct),w=Q,O=ye}return u},zt.isCCW=function(e){var r=e.length-1;if(3>r)throw new X;for(var u=e[0],g=0,w=1;r>=w;w++){var O=e[w];O.y>u.y&&(u=O,g=w)}var H=g;do H-=1,0>H&&(H=r);while(e[H].equals2D(u)&&H!==g);var Q=g;do Q=(Q+1)%r;while(e[Q].equals2D(u)&&Q!==g);var ye=e[H],Ue=e[Q];if(ye.equals2D(u)||Ue.equals2D(u)||ye.equals2D(Ue))return!1;var ct=zt.computeOrientation(ye,u,Ue);return ct===0?ye.x>Ue.x:ct>0},zt.locatePointInRing=function(e,r){return oo.locatePointInRing(e,r)},zt.distancePointLinePerpendicular=function(e,r,u){var g=(u.x-r.x)*(u.x-r.x)+(u.y-r.y)*(u.y-r.y),w=((r.y-e.y)*(u.x-r.x)-(r.x-e.x)*(u.y-r.y))/g;return Math.abs(w)*Math.sqrt(g)},zt.computeOrientation=function(e,r,u){return zt.orientationIndex(e,r,u)},zt.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];if(r.length===0)throw new X;for(var u=e.distance(r[0]),g=0;g<r.length-1;g++){var w=zt.distancePointLine(e,r[g],r[g+1]);u>w&&(u=w)}return u}if(arguments.length===3){var O=arguments[0],H=arguments[1],Q=arguments[2];if(H.x===Q.x&&H.y===Q.y)return O.distance(H);var ye=(Q.x-H.x)*(Q.x-H.x)+(Q.y-H.y)*(Q.y-H.y),Ue=((O.x-H.x)*(Q.x-H.x)+(O.y-H.y)*(Q.y-H.y))/ye;if(0>=Ue)return O.distance(H);if(Ue>=1)return O.distance(Q);var ct=((H.y-O.y)*(Q.x-H.x)-(H.x-O.x)*(Q.y-H.y))/ye;return Math.abs(ct)*Math.sqrt(ye)}},zt.isOnLine=function(e,r){for(var u=new pr,g=1;g<r.length;g++){var w=r[g-1],O=r[g];if(u.computeIntersection(e,w,O),u.hasIntersection())return!0}return!1},zt.CLOCKWISE=-1,zt.RIGHT=zt.CLOCKWISE,zt.COUNTERCLOCKWISE=1,zt.LEFT=zt.COUNTERCLOCKWISE,zt.COLLINEAR=0,zt.STRAIGHT=zt.COLLINEAR,N(Sn.prototype,{minX:function(){return Math.min(this.p0.x,this.p1.x)},orientationIndex:function(){if(arguments[0]instanceof Sn){var e=arguments[0],r=zt.orientationIndex(this.p0,this.p1,e.p0),u=zt.orientationIndex(this.p0,this.p1,e.p1);return r>=0&&u>=0||0>=r&&0>=u?Math.max(r,u):0}if(arguments[0]instanceof ve){var g=arguments[0];return zt.orientationIndex(this.p0,this.p1,g)}},toGeometry:function(e){return e.createLineString([this.p0,this.p1])},isVertical:function(){return this.p0.x===this.p1.x},equals:function(e){if(!(e instanceof Sn))return!1;var r=e;return this.p0.equals(r.p0)&&this.p1.equals(r.p1)},intersection:function(e){var r=new pr;return r.computeIntersection(this.p0,this.p1,e.p0,e.p1),r.hasIntersection()?r.getIntersection(0):null},project:function(){if(arguments[0]instanceof ve){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new ve(e);var r=this.projectionFactor(e),u=new ve;return u.x=this.p0.x+r*(this.p1.x-this.p0.x),u.y=this.p0.y+r*(this.p1.y-this.p0.y),u}if(arguments[0]instanceof Sn){var g=arguments[0],w=this.projectionFactor(g.p0),O=this.projectionFactor(g.p1);if(w>=1&&O>=1||0>=w&&0>=O)return null;var H=this.project(g.p0);0>w&&(H=this.p0),w>1&&(H=this.p1);var Q=this.project(g.p1);return 0>O&&(Q=this.p0),O>1&&(Q=this.p1),new Sn(H,Q)}},normalize:function(){this.p1.compareTo(this.p0)<0&&this.reverse()},angle:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},getCoordinate:function(e){return e===0?this.p0:this.p1},distancePerpendicular:function(e){return zt.distancePointLinePerpendicular(e,this.p0,this.p1)},minY:function(){return Math.min(this.p0.y,this.p1.y)},midPoint:function(){return Sn.midPoint(this.p0,this.p1)},projectionFactor:function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var r=this.p1.x-this.p0.x,u=this.p1.y-this.p0.y,g=r*r+u*u;if(0>=g)return te.NaN;var w=((e.x-this.p0.x)*r+(e.y-this.p0.y)*u)/g;return w},closestPoints:function(e){var r=this.intersection(e);if(r!==null)return[r,r];var u=new Array(2).fill(null),g=te.MAX_VALUE,w=null,O=this.closestPoint(e.p0);g=O.distance(e.p0),u[0]=O,u[1]=e.p0;var H=this.closestPoint(e.p1);w=H.distance(e.p1),g>w&&(g=w,u[0]=H,u[1]=e.p1);var Q=e.closestPoint(this.p0);w=Q.distance(this.p0),g>w&&(g=w,u[0]=this.p0,u[1]=Q);var ye=e.closestPoint(this.p1);return w=ye.distance(this.p1),g>w&&(g=w,u[0]=this.p1,u[1]=ye),u},closestPoint:function(e){var r=this.projectionFactor(e);if(r>0&&1>r)return this.project(e);var u=this.p0.distance(e),g=this.p1.distance(e);return g>u?this.p0:this.p1},maxX:function(){return Math.max(this.p0.x,this.p1.x)},getLength:function(){return this.p0.distance(this.p1)},compareTo:function(e){var r=e,u=this.p0.compareTo(r.p0);return u!==0?u:this.p1.compareTo(r.p1)},reverse:function(){var e=this.p0;this.p0=this.p1,this.p1=e},equalsTopo:function(e){return this.p0.equals(e.p0)&&this.p1.equals(e.p1)||this.p0.equals(e.p1)&&this.p1.equals(e.p0)},lineIntersection:function(e){try{var r=hr.intersection(this.p0,this.p1,e.p0,e.p1);return r}catch(u){if(!(u instanceof it))throw u}finally{}return null},maxY:function(){return Math.max(this.p0.y,this.p1.y)},pointAlongOffset:function(e,r){var u=this.p0.x+e*(this.p1.x-this.p0.x),g=this.p0.y+e*(this.p1.y-this.p0.y),w=this.p1.x-this.p0.x,O=this.p1.y-this.p0.y,H=Math.sqrt(w*w+O*O),Q=0,ye=0;if(r!==0){if(0>=H)throw new IllegalStateException("Cannot compute offset from zero-length line segment");Q=r*w/H,ye=r*O/H}var Ue=u-ye,ct=g+Q,yt=new ve(Ue,ct);return yt},setCoordinates:function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.p0.x=r.x,this.p0.y=r.y,this.p1.x=u.x,this.p1.y=u.y}},segmentFraction:function(e){var r=this.projectionFactor(e);return 0>r?r=0:(r>1||te.isNaN(r))&&(r=1),r},toString:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},isHorizontal:function(){return this.p0.y===this.p1.y},distance:function(){if(arguments[0]instanceof Sn){var e=arguments[0];return zt.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}if(arguments[0]instanceof ve){var r=arguments[0];return zt.distancePointLine(r,this.p0,this.p1)}},pointAlong:function(e){var r=new ve;return r.x=this.p0.x+e*(this.p1.x-this.p0.x),r.y=this.p0.y+e*(this.p1.y-this.p0.y),r},hashCode:function(){var e=java.lang.Double.doubleToLongBits(this.p0.x);e^=31*java.lang.Double.doubleToLongBits(this.p0.y);var r=Math.trunc(e)^Math.trunc(e>>32),u=java.lang.Double.doubleToLongBits(this.p1.x);u^=31*java.lang.Double.doubleToLongBits(this.p1.y);var g=Math.trunc(u)^Math.trunc(u>>32);return r^g},interfaces_:function(){return[a,xe]},getClass:function(){return Sn}}),Sn.midPoint=function(e,r){return new ve((e.x+r.x)/2,(e.y+r.y)/2)},Sn.serialVersionUID=0x2d2172135f411c00,N(Jn.prototype,{isIntersects:function(){return!this.isDisjoint()},isCovers:function(){var e=Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])||Jn.isTrue(this.matrix[le.INTERIOR][le.BOUNDARY])||Jn.isTrue(this.matrix[le.BOUNDARY][le.INTERIOR])||Jn.isTrue(this.matrix[le.BOUNDARY][le.BOUNDARY]);return e&&this.matrix[le.EXTERIOR][le.INTERIOR]===Rt.FALSE&&this.matrix[le.EXTERIOR][le.BOUNDARY]===Rt.FALSE},isCoveredBy:function(){var e=Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])||Jn.isTrue(this.matrix[le.INTERIOR][le.BOUNDARY])||Jn.isTrue(this.matrix[le.BOUNDARY][le.INTERIOR])||Jn.isTrue(this.matrix[le.BOUNDARY][le.BOUNDARY]);return e&&this.matrix[le.INTERIOR][le.EXTERIOR]===Rt.FALSE&&this.matrix[le.BOUNDARY][le.EXTERIOR]===Rt.FALSE},set:function(){if(arguments.length===1)for(var e=arguments[0],r=0;r<e.length;r++){var u=Math.trunc(r/3),g=r%3;this.matrix[u][g]=Rt.toDimensionValue(e.charAt(r))}else if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2];this.matrix[w][O]=H}},isContains:function(){return Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])&&this.matrix[le.EXTERIOR][le.INTERIOR]===Rt.FALSE&&this.matrix[le.EXTERIOR][le.BOUNDARY]===Rt.FALSE},setAtLeast:function(){if(arguments.length===1)for(var e=arguments[0],r=0;r<e.length;r++){var u=Math.trunc(r/3),g=r%3;this.setAtLeast(u,g,Rt.toDimensionValue(e.charAt(r)))}else if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2];this.matrix[w][O]<H&&(this.matrix[w][O]=H)}},setAtLeastIfValid:function(e,r,u){e>=0&&r>=0&&this.setAtLeast(e,r,u)},isWithin:function(){return Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])&&this.matrix[le.INTERIOR][le.EXTERIOR]===Rt.FALSE&&this.matrix[le.BOUNDARY][le.EXTERIOR]===Rt.FALSE},isTouches:function(e,r){return e>r?this.isTouches(r,e):e===Rt.A&&r===Rt.A||e===Rt.L&&r===Rt.L||e===Rt.L&&r===Rt.A||e===Rt.P&&r===Rt.A||e===Rt.P&&r===Rt.L?this.matrix[le.INTERIOR][le.INTERIOR]===Rt.FALSE&&(Jn.isTrue(this.matrix[le.INTERIOR][le.BOUNDARY])||Jn.isTrue(this.matrix[le.BOUNDARY][le.INTERIOR])||Jn.isTrue(this.matrix[le.BOUNDARY][le.BOUNDARY])):!1},isOverlaps:function(e,r){return e===Rt.P&&r===Rt.P||e===Rt.A&&r===Rt.A?Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])&&Jn.isTrue(this.matrix[le.INTERIOR][le.EXTERIOR])&&Jn.isTrue(this.matrix[le.EXTERIOR][le.INTERIOR]):e===Rt.L&&r===Rt.L?this.matrix[le.INTERIOR][le.INTERIOR]===1&&Jn.isTrue(this.matrix[le.INTERIOR][le.EXTERIOR])&&Jn.isTrue(this.matrix[le.EXTERIOR][le.INTERIOR]):!1},isEquals:function(e,r){return e!==r?!1:Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])&&this.matrix[le.INTERIOR][le.EXTERIOR]===Rt.FALSE&&this.matrix[le.BOUNDARY][le.EXTERIOR]===Rt.FALSE&&this.matrix[le.EXTERIOR][le.INTERIOR]===Rt.FALSE&&this.matrix[le.EXTERIOR][le.BOUNDARY]===Rt.FALSE},toString:function(){for(var e=new Qt("123456789"),r=0;3>r;r++)for(var u=0;3>u;u++)e.setCharAt(3*r+u,Rt.toDimensionSymbol(this.matrix[r][u]));return e.toString()},setAll:function(e){for(var r=0;3>r;r++)for(var u=0;3>u;u++)this.matrix[r][u]=e},get:function(e,r){return this.matrix[e][r]},transpose:function(){var e=this.matrix[1][0];return this.matrix[1][0]=this.matrix[0][1],this.matrix[0][1]=e,e=this.matrix[2][0],this.matrix[2][0]=this.matrix[0][2],this.matrix[0][2]=e,e=this.matrix[2][1],this.matrix[2][1]=this.matrix[1][2],this.matrix[1][2]=e,this},matches:function(e){if(e.length!==9)throw new X;for(var r=0;3>r;r++)for(var u=0;3>u;u++)if(!Jn.matches(this.matrix[r][u],e.charAt(3*r+u)))return!1;return!0},add:function(e){for(var r=0;3>r;r++)for(var u=0;3>u;u++)this.setAtLeast(r,u,e.get(r,u))},isDisjoint:function(){return this.matrix[le.INTERIOR][le.INTERIOR]===Rt.FALSE&&this.matrix[le.INTERIOR][le.BOUNDARY]===Rt.FALSE&&this.matrix[le.BOUNDARY][le.INTERIOR]===Rt.FALSE&&this.matrix[le.BOUNDARY][le.BOUNDARY]===Rt.FALSE},isCrosses:function(e,r){return e===Rt.P&&r===Rt.L||e===Rt.P&&r===Rt.A||e===Rt.L&&r===Rt.A?Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])&&Jn.isTrue(this.matrix[le.INTERIOR][le.EXTERIOR]):e===Rt.L&&r===Rt.P||e===Rt.A&&r===Rt.P||e===Rt.A&&r===Rt.L?Jn.isTrue(this.matrix[le.INTERIOR][le.INTERIOR])&&Jn.isTrue(this.matrix[le.EXTERIOR][le.INTERIOR]):e===Rt.L&&r===Rt.L?this.matrix[le.INTERIOR][le.INTERIOR]===0:!1},interfaces_:function(){return[_e]},getClass:function(){return Jn}}),Jn.matches=function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var e=arguments[0],r=arguments[1];return r===Rt.SYM_DONTCARE||r===Rt.SYM_TRUE&&(e>=0||e===Rt.TRUE)||r===Rt.SYM_FALSE&&e===Rt.FALSE||r===Rt.SYM_P&&e===Rt.P||r===Rt.SYM_L&&e===Rt.L?!0:r===Rt.SYM_A&&e===Rt.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var u=arguments[0],g=arguments[1],w=new Jn(u);return w.matches(g)}},Jn.isTrue=function(e){return e>=0||e===Rt.TRUE};var ch=Object.freeze({Coordinate:ve,CoordinateList:ft,Envelope:et,LineSegment:Sn,GeometryFactory:Zn,Geometry:Jt,Point:Fi,LineString:Fn,LinearRing:ge,Polygon:ne,GeometryCollection:jn,MultiPoint:oe,MultiLineString:fr,MultiPolygon:Oe,Dimension:Rt,IntersectionMatrix:Jn});N(mr.prototype,{addPoint:function(e){this.ptCount+=1,this.ptCentSum.x+=e.x,this.ptCentSum.y+=e.y},setBasePoint:function(e){this.areaBasePt===null&&(this.areaBasePt=e)},addLineSegments:function(e){for(var r=0,u=0;u<e.length-1;u++){var g=e[u].distance(e[u+1]);if(g!==0){r+=g;var w=(e[u].x+e[u+1].x)/2;this.lineCentSum.x+=g*w;var O=(e[u].y+e[u+1].y)/2;this.lineCentSum.y+=g*O}}this.totalLength+=r,r===0&&e.length>0&&this.addPoint(e[0])},addHole:function(e){for(var r=zt.isCCW(e),u=0;u<e.length-1;u++)this.addTriangle(this.areaBasePt,e[u],e[u+1],r);this.addLineSegments(e)},getCentroid:function(){var e=new ve;if(Math.abs(this.areasum2)>0)e.x=this.cg3.x/3/this.areasum2,e.y=this.cg3.y/3/this.areasum2;else if(this.totalLength>0)e.x=this.lineCentSum.x/this.totalLength,e.y=this.lineCentSum.y/this.totalLength;else{if(!(this.ptCount>0))return null;e.x=this.ptCentSum.x/this.ptCount,e.y=this.ptCentSum.y/this.ptCount}return e},addShell:function(e){e.length>0&&this.setBasePoint(e[0]);for(var r=!zt.isCCW(e),u=0;u<e.length-1;u++)this.addTriangle(this.areaBasePt,e[u],e[u+1],r);this.addLineSegments(e)},addTriangle:function(e,r,u,g){var w=g?1:-1;mr.centroid3(e,r,u,this.triangleCent3);var O=mr.area2(e,r,u);this.cg3.x+=w*O*this.triangleCent3.x,this.cg3.y+=w*O*this.triangleCent3.y,this.areasum2+=w*O},add:function(){if(arguments[0]instanceof ne){var e=arguments[0];this.addShell(e.getExteriorRing().getCoordinates());for(var r=0;r<e.getNumInteriorRing();r++)this.addHole(e.getInteriorRingN(r).getCoordinates())}else if(arguments[0]instanceof Jt){var u=arguments[0];if(u.isEmpty())return null;if(u instanceof Fi)this.addPoint(u.getCoordinate());else if(u instanceof Fn)this.addLineSegments(u.getCoordinates());else if(u instanceof ne){var g=u;this.add(g)}else if(u instanceof jn)for(var w=u,r=0;r<w.getNumGeometries();r++)this.add(w.getGeometryN(r))}},interfaces_:function(){return[]},getClass:function(){return mr}}),mr.area2=function(e,r,u){return(r.x-e.x)*(u.y-e.y)-(u.x-e.x)*(r.y-e.y)},mr.centroid3=function(e,r,u,g){return g.x=e.x+r.x+u.x,g.y=e.y+r.y+u.y,null},mr.getCentroid=function(e){var r=new mr(e);return r.getCentroid()},$s.prototype=new Error,$s.prototype.name="EmptyStackException",Ir.prototype=new Ae,Ir.prototype.add=function(e){return this.array_.push(e),!0},Ir.prototype.get=function(e){if(0>e||e>=this.size())throw new IndexOutOfBoundsException;return this.array_[e]},Ir.prototype.push=function(e){return this.array_.push(e),e},Ir.prototype.pop=function(e){if(this.array_.length===0)throw new $s;return this.array_.pop()},Ir.prototype.peek=function(){if(this.array_.length===0)throw new $s;return this.array_[this.array_.length-1]},Ir.prototype.empty=function(){return this.array_.length===0},Ir.prototype.isEmpty=function(){return this.empty()},Ir.prototype.search=function(e){return this.array_.indexOf(e)},Ir.prototype.size=function(){return this.array_.length},Ir.prototype.toArray=function(){for(var e=[],r=0,u=this.array_.length;u>r;r++)e.push(this.array_[r]);return e},N(Wa.prototype,{filter:function(e){this.treeSet.contains(e)||(this.list.add(e),this.treeSet.add(e))},getCoordinates:function(){var e=new Array(this.list.size()).fill(null);return this.list.toArray(e)},interfaces_:function(){return[Ur]},getClass:function(){return Wa}}),Wa.filterCoordinates=function(e){for(var r=new Wa,u=0;u<e.length;u++)r.filter(e[u]);return r.getCoordinates()},N(ao.prototype,{preSort:function(e){for(var r=null,u=1;u<e.length;u++)(e[u].y<e[0].y||e[u].y===e[0].y&&e[u].x<e[0].x)&&(r=e[0],e[0]=e[u],e[u]=r);return ir.sort(e,1,e.length,new As(e[0])),e},computeOctRing:function(e){var r=this.computeOctPts(e),u=new ft;return u.add(r,!1),u.size()<3?null:(u.closeRing(),u.toCoordinateArray())},lineOrPolygon:function(e){if(e=this.cleanRing(e),e.length===3)return this.geomFactory.createLineString([e[0],e[1]]);var r=this.geomFactory.createLinearRing(e);return this.geomFactory.createPolygon(r,null)},cleanRing:function(e){Pe.equals(e[0],e[e.length-1]);for(var r=new ze,u=null,g=0;g<=e.length-2;g++){var w=e[g],O=e[g+1];w.equals(O)||u!==null&&this.isBetween(u,w,O)||(r.add(w),u=w)}r.add(e[e.length-1]);var H=new Array(r.size()).fill(null);return r.toArray(H)},isBetween:function(e,r,u){return zt.computeOrientation(e,r,u)!==0?!1:e.x!==u.x&&(e.x<=r.x&&r.x<=u.x||u.x<=r.x&&r.x<=e.x)||e.y!==u.y&&(e.y<=r.y&&r.y<=u.y||u.y<=r.y&&r.y<=e.y)},reduce:function(e){var r=this.computeOctRing(e);if(r===null)return e;for(var u=new dr,g=0;g<r.length;g++)u.add(r[g]);for(var g=0;g<e.length;g++)zt.isPointInRing(e[g],r)||u.add(e[g]);var w=bn.toCoordinateArray(u);return w.length<3?this.padArray3(w):w},getConvexHull:function(){if(this.inputPts.length===0)return this.geomFactory.createGeometryCollection(null);if(this.inputPts.length===1)return this.geomFactory.createPoint(this.inputPts[0]);if(this.inputPts.length===2)return this.geomFactory.createLineString(this.inputPts);var e=this.inputPts;this.inputPts.length>50&&(e=this.reduce(this.inputPts));var r=this.preSort(e),u=this.grahamScan(r),g=this.toCoordinateArray(u);return this.lineOrPolygon(g)},padArray3:function(e){for(var r=new Array(3).fill(null),u=0;u<r.length;u++)u<e.length?r[u]=e[u]:r[u]=e[0];return r},computeOctPts:function(e){for(var r=new Array(8).fill(null),u=0;u<r.length;u++)r[u]=e[0];for(var g=1;g<e.length;g++)e[g].x<r[0].x&&(r[0]=e[g]),e[g].x-e[g].y<r[1].x-r[1].y&&(r[1]=e[g]),e[g].y>r[2].y&&(r[2]=e[g]),e[g].x+e[g].y>r[3].x+r[3].y&&(r[3]=e[g]),e[g].x>r[4].x&&(r[4]=e[g]),e[g].x-e[g].y>r[5].x-r[5].y&&(r[5]=e[g]),e[g].y<r[6].y&&(r[6]=e[g]),e[g].x+e[g].y<r[7].x+r[7].y&&(r[7]=e[g]);return r},toCoordinateArray:function(e){for(var r=new Array(e.size()).fill(null),u=0;u<e.size();u++){var g=e.get(u);r[u]=g}return r},grahamScan:function(e){var r=null,u=new Ir;r=u.push(e[0]),r=u.push(e[1]),r=u.push(e[2]);for(var g=3;g<e.length;g++){for(r=u.pop();!u.empty()&&zt.computeOrientation(u.peek(),r,e[g])>0;)r=u.pop();r=u.push(r),r=u.push(e[g])}return r=u.push(e[0]),u},interfaces_:function(){return[]},getClass:function(){return ao}}),ao.extractCoordinates=function(e){var r=new Wa;return e.apply(r),r.getCoordinates()},N(As.prototype,{compare:function(e,r){var u=e,g=r;return As.polarCompare(this.origin,u,g)},interfaces_:function(){return[me]},getClass:function(){return As}}),As.polarCompare=function(e,r,u){var g=r.x-e.x,w=r.y-e.y,O=u.x-e.x,H=u.y-e.y,Q=zt.computeOrientation(e,r,u);if(Q===zt.COUNTERCLOCKWISE)return 1;if(Q===zt.CLOCKWISE)return-1;var ye=g*g+w*w,Ue=O*O+H*H;return Ue>ye?-1:ye>Ue?1:0},ao.RadialComparator=As,N(qr.prototype,{transformPoint:function(e,r){return this.factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))},transformPolygon:function(e,r){var u=!0,g=this.transformLinearRing(e.getExteriorRing(),e);g!==null&&g instanceof ge&&!g.isEmpty()||(u=!1);for(var w=new ze,O=0;O<e.getNumInteriorRing();O++){var H=this.transformLinearRing(e.getInteriorRingN(O),e);H===null||H.isEmpty()||(H instanceof ge||(u=!1),w.add(H))}if(u)return this.factory.createPolygon(g,w.toArray([]));var Q=new ze;return g!==null&&Q.add(g),Q.addAll(w),this.factory.buildGeometry(Q)},createCoordinateSequence:function(e){return this.factory.getCoordinateSequenceFactory().create(e)},getInputGeometry:function(){return this.inputGeom},transformMultiLineString:function(e,r){for(var u=new ze,g=0;g<e.getNumGeometries();g++){var w=this.transformLineString(e.getGeometryN(g),e);w!==null&&(w.isEmpty()||u.add(w))}return this.factory.buildGeometry(u)},transformCoordinates:function(e,r){return this.copy(e)},transformLineString:function(e,r){return this.factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))},transformMultiPoint:function(e,r){for(var u=new ze,g=0;g<e.getNumGeometries();g++){var w=this.transformPoint(e.getGeometryN(g),e);w!==null&&(w.isEmpty()||u.add(w))}return this.factory.buildGeometry(u)},transformMultiPolygon:function(e,r){for(var u=new ze,g=0;g<e.getNumGeometries();g++){var w=this.transformPolygon(e.getGeometryN(g),e);w!==null&&(w.isEmpty()||u.add(w))}return this.factory.buildGeometry(u)},copy:function(e){return e.copy()},transformGeometryCollection:function(e,r){for(var u=new ze,g=0;g<e.getNumGeometries();g++){var w=this.transform(e.getGeometryN(g));w!==null&&(this.pruneEmptyGeometry&&w.isEmpty()||u.add(w))}return this.preserveGeometryCollectionType?this.factory.createGeometryCollection(Zn.toGeometryArray(u)):this.factory.buildGeometry(u)},transform:function(e){if(this.inputGeom=e,this.factory=e.getFactory(),e instanceof Fi)return this.transformPoint(e,null);if(e instanceof oe)return this.transformMultiPoint(e,null);if(e instanceof ge)return this.transformLinearRing(e,null);if(e instanceof Fn)return this.transformLineString(e,null);if(e instanceof fr)return this.transformMultiLineString(e,null);if(e instanceof ne)return this.transformPolygon(e,null);if(e instanceof Oe)return this.transformMultiPolygon(e,null);if(e instanceof jn)return this.transformGeometryCollection(e,null);throw new X("Unknown Geometry subtype: "+e.getClass().getName())},transformLinearRing:function(e,r){var u=this.transformCoordinates(e.getCoordinateSequence(),e);if(u===null)return this.factory.createLinearRing(null);var g=u.size();return g>0&&4>g&&!this.preserveType?this.factory.createLineString(u):this.factory.createLinearRing(u)},interfaces_:function(){return[]},getClass:function(){return qr}}),N(Cl.prototype,{snapVertices:function(e,r){for(var u=this._isClosed?e.size()-1:e.size(),g=0;u>g;g++){var w=e.get(g),O=this.findSnapForVertex(w,r);O!==null&&(e.set(g,new ve(O)),g===0&&this._isClosed&&e.set(e.size()-1,new ve(O)))}},findSnapForVertex:function(e,r){for(var u=0;u<r.length;u++){if(e.equals2D(r[u]))return null;if(e.distance(r[u])<this.snapTolerance)return r[u]}return null},snapTo:function(e){var r=new ft(this.srcPts);this.snapVertices(r,e),this.snapSegments(r,e);var u=r.toCoordinateArray();return u},snapSegments:function(e,r){if(r.length===0)return null;var u=r.length;r[0].equals2D(r[r.length-1])&&(u=r.length-1);for(var g=0;u>g;g++){var w=r[g],O=this.findSegmentIndexToSnap(w,e);O>=0&&e.add(O+1,new ve(w),!1)}},findSegmentIndexToSnap:function(e,r){for(var u=te.MAX_VALUE,g=-1,w=0;w<r.size()-1;w++){if(this.seg.p0=r.get(w),this.seg.p1=r.get(w+1),this.seg.p0.equals2D(e)||this.seg.p1.equals2D(e)){if(this.allowSnappingToSourceVertices)continue;return-1}var O=this.seg.distance(e);O<this.snapTolerance&&u>O&&(u=O,g=w)}return g},setAllowSnappingToSourceVertices:function(e){this.allowSnappingToSourceVertices=e},interfaces_:function(){return[]},getClass:function(){return Cl}}),Cl.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])},N(us.prototype,{snapTo:function(e,r){var u=this.extractTargetCoordinates(e),g=new ns(r,u);return g.transform(this.srcGeom)},snapToSelf:function(e,r){var u=this.extractTargetCoordinates(this.srcGeom),g=new ns(e,u,!0),w=g.transform(this.srcGeom),O=w;return r&&kt(O,Ke)&&(O=w.buffer(0)),O},computeSnapTolerance:function(e){var r=this.computeMinimumSegmentLength(e),u=r/10;return u},extractTargetCoordinates:function(e){for(var r=new dr,u=e.getCoordinates(),g=0;g<u.length;g++)r.add(u[g]);return r.toArray(new Array(0).fill(null))},computeMinimumSegmentLength:function(e){for(var r=te.MAX_VALUE,u=0;u<e.length-1;u++){var g=e[u].distance(e[u+1]);r>g&&(r=g)}return r},interfaces_:function(){return[]},getClass:function(){return us}}),us.snap=function(e,r,u){var g=new Array(2).fill(null),w=new us(e);g[0]=w.snapTo(r,u);var O=new us(r);return g[1]=O.snapTo(g[0],u),g},us.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],r=us.computeSizeBasedSnapTolerance(e),u=e.getPrecisionModel();if(u.getType()===oi.FIXED){var g=1/u.getScale()*2/1.415;g>r&&(r=g)}return r}if(arguments.length===2){var w=arguments[0],O=arguments[1];return Math.min(us.computeOverlaySnapTolerance(w),us.computeOverlaySnapTolerance(O))}},us.computeSizeBasedSnapTolerance=function(e){var r=e.getEnvelopeInternal(),u=Math.min(r.getHeight(),r.getWidth()),g=u*us.SNAP_PRECISION_FACTOR;return g},us.snapToSelf=function(e,r,u){var g=new us(e);return g.snapToSelf(r,u)},us.SNAP_PRECISION_FACTOR=1e-9,Te(ns,qr),N(ns.prototype,{snapLine:function(e,r){var u=new Cl(e,this.snapTolerance);return u.setAllowSnappingToSourceVertices(this.isSelfSnap),u.snapTo(r)},transformCoordinates:function(e,r){var u=e.toCoordinateArray(),g=this.snapLine(u,this.snapPts);return this.factory.getCoordinateSequenceFactory().create(g)},interfaces_:function(){return[]},getClass:function(){return ns}}),N(Tr.prototype,{getCommon:function(){return te.longBitsToDouble(this.commonBits)},add:function(e){var r=te.doubleToLongBits(e);if(this.isFirst)return this.commonBits=r,this.commonSignExp=Tr.signExpBits(this.commonBits),this.isFirst=!1,null;var u=Tr.signExpBits(r);return u!==this.commonSignExp?(this.commonBits=0,null):(this.commonMantissaBitsCount=Tr.numCommonMostSigMantissaBits(this.commonBits,r),void(this.commonBits=Tr.zeroLowerBits(this.commonBits,64-(12+this.commonMantissaBitsCount))))},toString:function(){if(arguments.length===1){var e=arguments[0],r=te.longBitsToDouble(e),u=Long.toBinaryString(e),g="0000000000000000000000000000000000000000000000000000000000000000"+u,w=g.substring(g.length-64),O=w.substring(0,1)+"  "+w.substring(1,12)+"(exp) "+w.substring(12)+" [ "+r+" ]";return O}},interfaces_:function(){return[]},getClass:function(){return Tr}}),Tr.getBit=function(e,r){var u=1<<r;return e&u?1:0},Tr.signExpBits=function(e){return e>>52},Tr.zeroLowerBits=function(e,r){var u=(1<<r)-1,g=~u,w=e&g;return w},Tr.numCommonMostSigMantissaBits=function(e,r){for(var u=0,g=52;g>=0;g--){if(Tr.getBit(e,g)!==Tr.getBit(r,g))return u;u++}return 52},N(ma.prototype,{addCommonBits:function(e){var r=new Ml(this.commonCoord);e.apply(r),e.geometryChanged()},removeCommonBits:function(e){if(this.commonCoord.x===0&&this.commonCoord.y===0)return e;var r=new ve(this.commonCoord);r.x=-r.x,r.y=-r.y;var u=new Ml(r);return e.apply(u),e.geometryChanged(),e},getCommonCoordinate:function(){return this.commonCoord},add:function(e){e.apply(this.ccFilter),this.commonCoord=this.ccFilter.getCommonCoordinate()},interfaces_:function(){return[]},getClass:function(){return ma}}),N(ga.prototype,{filter:function(e){this.commonBitsX.add(e.x),this.commonBitsY.add(e.y)},getCommonCoordinate:function(){return new ve(this.commonBitsX.getCommon(),this.commonBitsY.getCommon())},interfaces_:function(){return[Ur]},getClass:function(){return ga}}),N(Ml.prototype,{filter:function(e,r){var u=e.getOrdinate(r,0)+this.trans.x,g=e.getOrdinate(r,1)+this.trans.y;e.setOrdinate(r,0,u),e.setOrdinate(r,1,g)},isDone:function(){return!1},isGeometryChanged:function(){return!0},interfaces_:function(){return[So]},getClass:function(){return Ml}}),ma.CommonCoordinateFilter=ga,ma.Translater=Ml,N(lo.prototype,{next:function(){if(this.atStart)return this.atStart=!1,lo.isAtomic(this.parent)&&this.index++,this.parent;if(this.subcollectionIterator!==null){if(this.subcollectionIterator.hasNext())return this.subcollectionIterator.next();this.subcollectionIterator=null}if(this.index>=this.max)throw new pt;var e=this.parent.getGeometryN(this.index++);return e instanceof jn?(this.subcollectionIterator=new lo(e),this.subcollectionIterator.next()):e},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){if(this.atStart)return!0;if(this.subcollectionIterator!==null){if(this.subcollectionIterator.hasNext())return!0;this.subcollectionIterator=null}return!(this.index>=this.max)},interfaces_:function(){return[wt]},getClass:function(){return lo}}),lo.isAtomic=function(e){return!(e instanceof jn)},N(_a.prototype,{locateInternal:function(){if(arguments[0]instanceof ve&&arguments[1]instanceof ne){var e=arguments[0],r=arguments[1];if(r.isEmpty())return le.EXTERIOR;var u=r.getExteriorRing(),g=this.locateInPolygonRing(e,u);if(g===le.EXTERIOR)return le.EXTERIOR;if(g===le.BOUNDARY)return le.BOUNDARY;for(var w=0;w<r.getNumInteriorRing();w++){var O=r.getInteriorRingN(w),H=this.locateInPolygonRing(e,O);if(H===le.INTERIOR)return le.EXTERIOR;if(H===le.BOUNDARY)return le.BOUNDARY}return le.INTERIOR}if(arguments[0]instanceof ve&&arguments[1]instanceof Fn){var Q=arguments[0],ye=arguments[1];if(!ye.getEnvelopeInternal().intersects(Q))return le.EXTERIOR;var Ue=ye.getCoordinates();return ye.isClosed()||!Q.equals(Ue[0])&&!Q.equals(Ue[Ue.length-1])?zt.isOnLine(Q,Ue)?le.INTERIOR:le.EXTERIOR:le.BOUNDARY}if(arguments[0]instanceof ve&&arguments[1]instanceof Fi){var ct=arguments[0],yt=arguments[1],Ft=yt.getCoordinate();return Ft.equals2D(ct)?le.INTERIOR:le.EXTERIOR}},locateInPolygonRing:function(e,r){return r.getEnvelopeInternal().intersects(e)?zt.locatePointInRing(e,r.getCoordinates()):le.EXTERIOR},intersects:function(e,r){return this.locate(e,r)!==le.EXTERIOR},updateLocationInfo:function(e){e===le.INTERIOR&&(this.isIn=!0),e===le.BOUNDARY&&this.numBoundaries++},computeLocation:function(e,r){if(r instanceof Fi&&this.updateLocationInfo(this.locateInternal(e,r)),r instanceof Fn)this.updateLocationInfo(this.locateInternal(e,r));else if(r instanceof ne)this.updateLocationInfo(this.locateInternal(e,r));else if(r instanceof fr)for(var u=r,g=0;g<u.getNumGeometries();g++){var w=u.getGeometryN(g);this.updateLocationInfo(this.locateInternal(e,w))}else if(r instanceof Oe)for(var O=r,g=0;g<O.getNumGeometries();g++){var H=O.getGeometryN(g);this.updateLocationInfo(this.locateInternal(e,H))}else if(r instanceof jn)for(var Q=new lo(r);Q.hasNext();){var ye=Q.next();ye!==r&&this.computeLocation(e,ye)}},locate:function(e,r){return r.isEmpty()?le.EXTERIOR:r instanceof Fn?this.locateInternal(e,r):r instanceof ne?this.locateInternal(e,r):(this.isIn=!1,this.numBoundaries=0,this.computeLocation(e,r),this.boundaryRule.isInBoundary(this.numBoundaries)?le.BOUNDARY:this.numBoundaries>0||this.isIn?le.INTERIOR:le.EXTERIOR)},interfaces_:function(){return[]},getClass:function(){return _a}}),N(Un.prototype,{interfaces_:function(){return[]},getClass:function(){return Un}}),Un.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];if(e===0&&r===0)throw new X;var u=Math.abs(e),g=Math.abs(r);return e>=0?r>=0?u>=g?0:1:u>=g?7:6:r>=0?u>=g?3:2:u>=g?4:5}if(arguments[0]instanceof ve&&arguments[1]instanceof ve){var w=arguments[0],O=arguments[1],H=O.x-w.x,Q=O.y-w.y;if(H===0&&Q===0)throw new X;return Un.octant(H,Q)}},N(Al.prototype,{getCoordinates:function(){},size:function(){},getCoordinate:function(e){},isClosed:function(){},setData:function(e){},getData:function(){},interfaces_:function(){return[]},getClass:function(){return Al}}),N(ai.prototype,{getCoordinates:function(){return this.pts},size:function(){return this.pts.length},getCoordinate:function(e){return this.pts[e]},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getSegmentOctant:function(e){return e===this.pts.length-1?-1:Un.octant(this.getCoordinate(e),this.getCoordinate(e+1))},setData:function(e){this.data=e},getData:function(){return this.data},toString:function(){return Er.toLineString(new st(this.pts))},interfaces_:function(){return[Al]},getClass:function(){return ai}}),N(Tc.prototype,{getBounds:function(){},interfaces_:function(){return[]},getClass:function(){return Tc}}),N(ln.prototype,{getItem:function(){return this.item},getBounds:function(){return this.bounds},interfaces_:function(){return[Tc,xe]},getClass:function(){return ln}}),N(Pl.prototype,{poll:function(){if(this.isEmpty())return null;var e=this.items.get(1);return this.items.set(1,this.items.get(this._size)),this._size-=1,this.reorder(1),e},size:function(){return this._size},reorder:function(e){for(var r=null,u=this.items.get(e);2*e<=this._size&&(r=2*e,r!==this._size&&this.items.get(r+1).compareTo(this.items.get(r))<0&&r++,this.items.get(r).compareTo(u)<0);e=r)this.items.set(e,this.items.get(r));this.items.set(e,u)},clear:function(){this._size=0,this.items.clear()},isEmpty:function(){return this._size===0},add:function(e){this.items.add(null),this._size+=1;var r=this._size;for(this.items.set(0,e);e.compareTo(this.items.get(Math.trunc(r/2)))<0;r/=2)this.items.set(r,this.items.get(Math.trunc(r/2)));this.items.set(r,e)},interfaces_:function(){return[]},getClass:function(){return Pl}}),N(ks.prototype,{visitItem:function(e){},interfaces_:function(){return[]},getClass:function(){return ks}}),N(ya.prototype,{insert:function(e,r){},remove:function(e,r){},query:function(){},interfaces_:function(){return[]},getClass:function(){return ya}}),N(Ki.prototype,{getLevel:function(){return this.level},size:function(){return this.childBoundables.size()},getChildBoundables:function(){return this.childBoundables},addChildBoundable:function(e){Pe.isTrue(this.bounds===null),this.childBoundables.add(e)},isEmpty:function(){return this.childBoundables.isEmpty()},getBounds:function(){return this.bounds===null&&(this.bounds=this.computeBounds()),this.bounds},interfaces_:function(){return[Tc,xe]},getClass:function(){return Ki}}),Ki.serialVersionUID=6493722185909574e3;var Hs={reverseOrder:function(){return{compare:function(e,r){return r.compareTo(e)}}},min:function(e){return Hs.sort(e),e.get(0)},sort:function(e,r){var u=e.toArray();r?ir.sort(u,r):ir.sort(u);for(var g=e.iterator(),w=0,O=u.length;O>w;w++)g.next(),g.set(u[w])},singletonList:function(e){var r=new ze;return r.add(e),r}};N(jr.prototype,{expandToQueue:function(e,r){var u=jr.isComposite(this.boundable1),g=jr.isComposite(this.boundable2);if(u&&g)return jr.area(this.boundable1)>jr.area(this.boundable2)?(this.expand(this.boundable1,this.boundable2,e,r),null):(this.expand(this.boundable2,this.boundable1,e,r),null);if(u)return this.expand(this.boundable1,this.boundable2,e,r),null;if(g)return this.expand(this.boundable2,this.boundable1,e,r),null;throw new X},isLeaves:function(){return!(jr.isComposite(this.boundable1)||jr.isComposite(this.boundable2))},compareTo:function(e){var r=e;return this._distance<r._distance?-1:this._distance>r._distance?1:0},expand:function(e,r,u,g){for(var w=e.getChildBoundables(),O=w.iterator();O.hasNext();){var H=O.next(),Q=new jr(H,r,this.itemDistance);Q.getDistance()<g&&u.add(Q)}},getBoundable:function(e){return e===0?this.boundable1:this.boundable2},getDistance:function(){return this._distance},distance:function(){return this.isLeaves()?this.itemDistance.distance(this.boundable1,this.boundable2):this.boundable1.getBounds().distance(this.boundable2.getBounds())},interfaces_:function(){return[a]},getClass:function(){return jr}}),jr.area=function(e){return e.getBounds().getArea()},jr.isComposite=function(e){return e instanceof Ki},N(Ci.prototype,{getNodeCapacity:function(){return this.nodeCapacity},lastNode:function(e){return e.get(e.size()-1)},size:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this.root));if(arguments.length===1){for(var r=arguments[0],u=0,g=r.getChildBoundables().iterator();g.hasNext();){var w=g.next();w instanceof Ki?u+=this.size(w):w instanceof ln&&(u+=1)}return u}},removeItem:function(e,r){for(var u=null,g=e.getChildBoundables().iterator();g.hasNext();){var w=g.next();w instanceof ln&&w.getItem()===r&&(u=w)}return u!==null?(e.getChildBoundables().remove(u),!0):!1},itemsTree:function(){if(arguments.length===0){this.build();var e=this.itemsTree(this.root);return e===null?new ze:e}if(arguments.length===1){for(var r=arguments[0],u=new ze,g=r.getChildBoundables().iterator();g.hasNext();){var w=g.next();if(w instanceof Ki){var O=this.itemsTree(w);O!==null&&u.add(O)}else w instanceof ln?u.add(w.getItem()):Pe.shouldNeverReachHere()}return u.size()<=0?null:u}},insert:function(e,r){Pe.isTrue(!this.built,"Cannot insert items into an STR packed R-tree after it has been built."),this.itemBoundables.add(new ln(e,r))},boundablesAtLevel:function(){if(arguments.length===1){var e=arguments[0],r=new ze;return this.boundablesAtLevel(e,this.root,r),r}if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];if(Pe.isTrue(u>-2),g.getLevel()===u)return w.add(g),null;for(var O=g.getChildBoundables().iterator();O.hasNext();){var H=O.next();H instanceof Ki?this.boundablesAtLevel(u,H,w):(Pe.isTrue(H instanceof ln),u===-1&&w.add(H))}return null}},query:function(){if(arguments.length===1){var e=arguments[0];this.build();var r=new ze;return this.isEmpty()||this.getIntersectsOp().intersects(this.root.getBounds(),e)&&this.query(e,this.root,r),r}if(arguments.length===2){var u=arguments[0],g=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.root.getBounds(),u)&&this.query(u,this.root,g)}else if(arguments.length===3){if(kt(arguments[2],ks)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki)for(var w=arguments[0],O=arguments[1],H=arguments[2],Q=O.getChildBoundables(),ye=0;ye<Q.size();ye++){var Ue=Q.get(ye);this.getIntersectsOp().intersects(Ue.getBounds(),w)&&(Ue instanceof Ki?this.query(w,Ue,H):Ue instanceof ln?H.visitItem(Ue.getItem()):Pe.shouldNeverReachHere())}else if(kt(arguments[2],Ae)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki)for(var ct=arguments[0],yt=arguments[1],Ft=arguments[2],Q=yt.getChildBoundables(),ye=0;ye<Q.size();ye++){var Ue=Q.get(ye);this.getIntersectsOp().intersects(Ue.getBounds(),ct)&&(Ue instanceof Ki?this.query(ct,Ue,Ft):Ue instanceof ln?Ft.add(Ue.getItem()):Pe.shouldNeverReachHere())}}},build:function(){return this.built?null:(this.root=this.itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this.itemBoundables,-1),this.itemBoundables=null,void(this.built=!0))},getRoot:function(){return this.build(),this.root},remove:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.build(),this.getIntersectsOp().intersects(this.root.getBounds(),e)?this.remove(e,this.root,r):!1}if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2],O=this.removeItem(g,w);if(O)return!0;for(var H=null,Q=g.getChildBoundables().iterator();Q.hasNext();){var ye=Q.next();if(this.getIntersectsOp().intersects(ye.getBounds(),u)&&ye instanceof Ki&&(O=this.remove(u,ye,w))){H=ye;break}}return H!==null&&H.getChildBoundables().isEmpty()&&g.getChildBoundables().remove(H),O}},createHigherLevels:function(e,r){Pe.isTrue(!e.isEmpty());var u=this.createParentBoundables(e,r+1);return u.size()===1?u.get(0):this.createHigherLevels(u,r+1)},depth:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this.root));if(arguments.length===1){for(var e=arguments[0],r=0,u=e.getChildBoundables().iterator();u.hasNext();){var g=u.next();if(g instanceof Ki){var w=this.depth(g);w>r&&(r=w)}}return r+1}},createParentBoundables:function(e,r){Pe.isTrue(!e.isEmpty());var u=new ze;u.add(this.createNode(r));var g=new ze(e);Hs.sort(g,this.getComparator());for(var w=g.iterator();w.hasNext();){var O=w.next();this.lastNode(u).getChildBoundables().size()===this.getNodeCapacity()&&u.add(this.createNode(r)),this.lastNode(u).addChildBoundable(O)}return u},isEmpty:function(){return this.built?this.root.isEmpty():this.itemBoundables.isEmpty()},interfaces_:function(){return[xe]},getClass:function(){return Ci}}),Ci.compareDoubles=function(e,r){return e>r?1:r>e?-1:0},Ci.IntersectsOp=Wt,Ci.serialVersionUID=-3886435814360241e3,Ci.DEFAULT_NODE_CAPACITY=10,N(Gn.prototype,{distance:function(e,r){},interfaces_:function(){return[]},getClass:function(){return Gn}}),Te(cn,Ci),N(cn.prototype,{createParentBoundablesFromVerticalSlices:function(e,r){Pe.isTrue(e.length>0);for(var u=new ze,g=0;g<e.length;g++)u.addAll(this.createParentBoundablesFromVerticalSlice(e[g],r));return u},createNode:function(e){return new is(e)},size:function(){return arguments.length===0?Ci.prototype.size.call(this):Ci.prototype.size.apply(this,arguments)},insert:function(){if(arguments.length!==2)return Ci.prototype.insert.apply(this,arguments);var e=arguments[0],r=arguments[1];return e.isNull()?null:void Ci.prototype.insert.call(this,e,r)},getIntersectsOp:function(){return cn.intersectsOp},verticalSlices:function(e,r){for(var u=Math.trunc(Math.ceil(e.size()/r)),g=new Array(r).fill(null),w=e.iterator(),O=0;r>O;O++){g[O]=new ze;for(var H=0;w.hasNext()&&u>H;){var Q=w.next();g[O].add(Q),H++}}return g},query:function(){if(arguments.length===1){var e=arguments[0];return Ci.prototype.query.call(this,e)}if(arguments.length===2){var r=arguments[0],u=arguments[1];Ci.prototype.query.call(this,r,u)}else if(arguments.length===3){if(kt(arguments[2],ks)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki){var g=arguments[0],w=arguments[1],O=arguments[2];Ci.prototype.query.call(this,g,w,O)}else if(kt(arguments[2],Ae)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki){var H=arguments[0],Q=arguments[1],ye=arguments[2];Ci.prototype.query.call(this,H,Q,ye)}}},getComparator:function(){return cn.yComparator},createParentBoundablesFromVerticalSlice:function(e,r){return Ci.prototype.createParentBoundables.call(this,e,r)},remove:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return Ci.prototype.remove.call(this,e,r)}return Ci.prototype.remove.apply(this,arguments)},depth:function(){return arguments.length===0?Ci.prototype.depth.call(this):Ci.prototype.depth.apply(this,arguments)},createParentBoundables:function(e,r){Pe.isTrue(!e.isEmpty());var u=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),g=new ze(e);Hs.sort(g,cn.xComparator);var w=this.verticalSlices(g,Math.trunc(Math.ceil(Math.sqrt(u))));return this.createParentBoundablesFromVerticalSlices(w,r)},nearestNeighbour:function(){if(arguments.length===1){if(kt(arguments[0],Gn)){var e=arguments[0],r=new jr(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(r)}if(arguments[0]instanceof jr){var u=arguments[0];return this.nearestNeighbour(u,te.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof cn&&kt(arguments[1],Gn)){var g=arguments[0],w=arguments[1],r=new jr(this.getRoot(),g.getRoot(),w);return this.nearestNeighbour(r)}if(arguments[0]instanceof jr&&typeof arguments[1]=="number"){var O=arguments[0],H=arguments[1],Q=H,ye=null,Ue=new Pl;for(Ue.add(O);!Ue.isEmpty()&&Q>0;){var ct=Ue.poll(),yt=ct.getDistance();if(yt>=Q)break;ct.isLeaves()?(Q=yt,ye=ct):ct.expandToQueue(Ue,Q)}return[ye.getBoundable(0).getItem(),ye.getBoundable(1).getItem()]}}else if(arguments.length===3){var Ft=arguments[0],sn=arguments[1],Tn=arguments[2],Pn=new ln(Ft,sn),r=new jr(this.getRoot(),Pn,Tn);return this.nearestNeighbour(r)[0]}},interfaces_:function(){return[ya,xe]},getClass:function(){return cn}}),cn.centreX=function(e){return cn.avg(e.getMinX(),e.getMaxX())},cn.avg=function(e,r){return(e+r)/2},cn.centreY=function(e){return cn.avg(e.getMinY(),e.getMaxY())},Te(is,Ki),N(is.prototype,{computeBounds:function(){for(var e=null,r=this.getChildBoundables().iterator();r.hasNext();){var u=r.next();e===null?e=new et(u.getBounds()):e.expandToInclude(u.getBounds())}return e},interfaces_:function(){return[]},getClass:function(){return is}}),cn.STRtreeNode=is,cn.serialVersionUID=0x39920f7d5f261e0,cn.xComparator={interfaces_:function(){return[me]},compare:function(e,r){return Ci.compareDoubles(cn.centreX(e.getBounds()),cn.centreX(r.getBounds()))}},cn.yComparator={interfaces_:function(){return[me]},compare:function(e,r){return Ci.compareDoubles(cn.centreY(e.getBounds()),cn.centreY(r.getBounds()))}},cn.intersectsOp={interfaces_:function(){return[IntersectsOp]},intersects:function(e,r){return e.intersects(r)}},cn.DEFAULT_NODE_CAPACITY=10,N(Vi.prototype,{interfaces_:function(){return[]},getClass:function(){return Vi}}),Vi.relativeSign=function(e,r){return r>e?-1:e>r?1:0},Vi.compare=function(e,r,u){if(r.equals2D(u))return 0;var g=Vi.relativeSign(r.x,u.x),w=Vi.relativeSign(r.y,u.y);switch(e){case 0:return Vi.compareValue(g,w);case 1:return Vi.compareValue(w,g);case 2:return Vi.compareValue(w,-g);case 3:return Vi.compareValue(-g,w);case 4:return Vi.compareValue(-g,-w);case 5:return Vi.compareValue(-w,-g);case 6:return Vi.compareValue(-w,g);case 7:return Vi.compareValue(g,-w)}return Pe.shouldNeverReachHere("invalid octant value"),0},Vi.compareValue=function(e,r){return 0>e?-1:e>0?1:0>r?-1:r>0?1:0},N(Wn.prototype,{getCoordinate:function(){return this.coord},print:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)},compareTo:function(e){var r=e;return this.segmentIndex<r.segmentIndex?-1:this.segmentIndex>r.segmentIndex?1:this.coord.equals2D(r.coord)?0:Vi.compare(this.segmentOctant,this.coord,r.coord)},isEndPoint:function(e){return this.segmentIndex!==0||this._isInterior?this.segmentIndex===e:!0},isInterior:function(){return this._isInterior},interfaces_:function(){return[a]},getClass:function(){return Wn}}),N(cu.prototype,{getSplitCoordinates:function(){var e=new ft;this.addEndpoints();for(var r=this.iterator(),u=r.next();r.hasNext();){var g=r.next();this.addEdgeCoordinates(u,g,e),u=g}return e.toCoordinateArray()},addCollapsedNodes:function(){var e=new ze;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var r=e.iterator();r.hasNext();){var u=r.next().intValue();this.add(this.edge.getCoordinate(u),u)}},print:function(e){e.println("Intersections:");for(var r=this.iterator();r.hasNext();){var u=r.next();u.print(e)}},findCollapsesFromExistingVertices:function(e){for(var r=0;r<this.edge.size()-2;r++){var u=this.edge.getCoordinate(r),g=(this.edge.getCoordinate(r+1),this.edge.getCoordinate(r+2));u.equals2D(g)&&e.add(new ri(r+1))}},addEdgeCoordinates:function(e,r,u){r.segmentIndex-e.segmentIndex+2;var g=this.edge.getCoordinate(r.segmentIndex),w=r.isInterior()||!r.coord.equals2D(g);u.add(new ve(e.coord),!1);for(var O=e.segmentIndex+1;O<=r.segmentIndex;O++)u.add(this.edge.getCoordinate(O));w&&u.add(new ve(r.coord))},iterator:function(){return this.nodeMap.values().iterator()},addSplitEdges:function(e){this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),u=r.next();r.hasNext();){var g=r.next(),w=this.createSplitEdge(u,g);e.add(w),u=g}},findCollapseIndex:function(e,r,u){if(!e.coord.equals2D(r.coord))return!1;var g=r.segmentIndex-e.segmentIndex;return r.isInterior()||g--,g===1?(u[0]=e.segmentIndex+1,!0):!1},findCollapsesFromInsertedNodes:function(e){for(var r=new Array(1).fill(null),u=this.iterator(),g=u.next();u.hasNext();){var w=u.next(),O=this.findCollapseIndex(g,w,r);O&&e.add(new ri(r[0])),g=w}},getEdge:function(){return this.edge},addEndpoints:function(){var e=this.edge.size()-1;this.add(this.edge.getCoordinate(0),0),this.add(this.edge.getCoordinate(e),e)},createSplitEdge:function(e,r){var u=r.segmentIndex-e.segmentIndex+2,g=this.edge.getCoordinate(r.segmentIndex),w=r.isInterior()||!r.coord.equals2D(g);w||u--;var O=new Array(u).fill(null),H=0;O[H++]=new ve(e.coord);for(var Q=e.segmentIndex+1;Q<=r.segmentIndex;Q++)O[H++]=this.edge.getCoordinate(Q);return w&&(O[H]=new ve(r.coord)),new rr(O,this.edge.getData())},add:function(e,r){var u=new Wn(this.edge,e,r,this.edge.getSegmentOctant(r)),g=this.nodeMap.get(u);return g!==null?(Pe.isTrue(g.coord.equals2D(e),"Found equal nodes with different coordinates"),g):(this.nodeMap.put(u,u),u)},checkSplitEdgesCorrectness:function(e){var r=this.edge.getCoordinates(),u=e.get(0),g=u.getCoordinate(0);if(!g.equals2D(r[0]))throw new Se("bad split edge start point at "+g);var w=e.get(e.size()-1),O=w.getCoordinates(),H=O[O.length-1];if(!H.equals2D(r[r.length-1]))throw new Se("bad split edge end point at "+H)},interfaces_:function(){return[]},getClass:function(){return cu}}),N(Ll.prototype,{next:function(){return this.currNode===null?(this.currNode=this.nextNode,this.currSegIndex=this.currNode.segmentIndex,this.readNextNode(),this.currNode):this.nextNode===null?null:this.nextNode.segmentIndex===this.currNode.segmentIndex?(this.currNode=this.nextNode,this.currSegIndex=this.currNode.segmentIndex,this.readNextNode(),this.currNode):(this.nextNode.segmentIndex>this.currNode.segmentIndex,null)},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){return this.nextNode!==null},readNextNode:function(){this.nodeIt.hasNext()?this.nextNode=this.nodeIt.next():this.nextNode=null},interfaces_:function(){return[wt]},getClass:function(){return Ll}}),N($a.prototype,{addIntersection:function(e,r){},interfaces_:function(){return[Al]},getClass:function(){return $a}}),N(rr.prototype,{getCoordinates:function(){return this.pts},size:function(){return this.pts.length},getCoordinate:function(e){return this.pts[e]},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getSegmentOctant:function(e){return e===this.pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))},setData:function(e){this.data=e},safeOctant:function(e,r){return e.equals2D(r)?0:Un.octant(e,r)},getData:function(){return this.data},addIntersection:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];this.addIntersectionNode(e,r)}else if(arguments.length===4){var u=arguments[0],g=arguments[1],w=arguments[3],O=new ve(u.getIntersection(w));this.addIntersection(O,g)}},toString:function(){return Er.toLineString(new st(this.pts))},getNodeList:function(){return this.nodeList},addIntersectionNode:function(e,r){var u=r,g=u+1;if(g<this.pts.length){var w=this.pts[g];e.equals2D(w)&&(u=g)}var O=this.nodeList.add(e,u);return O},addIntersections:function(e,r,u){for(var g=0;g<e.getIntersectionNum();g++)this.addIntersection(e,r,u,g)},interfaces_:function(){return[$a]},getClass:function(){return rr}}),rr.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],r=new ze;return rr.getNodedSubstrings(e,r),r}if(arguments.length===2)for(var u=arguments[0],g=arguments[1],w=u.iterator();w.hasNext();){var O=w.next();O.getNodeList().addSplitEdges(g)}},N(Wi.prototype,{overlap:function(){if(arguments.length!==2){if(arguments.length===4){var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3];e.getLineSegment(r,this.overlapSeg1),u.getLineSegment(g,this.overlapSeg2),this.overlap(this.overlapSeg1,this.overlapSeg2)}}},interfaces_:function(){return[]},getClass:function(){return Wi}}),N(Sc.prototype,{getLineSegment:function(e,r){r.p0=this.pts[e],r.p1=this.pts[e+1]},computeSelect:function(e,r,u,g){var w=this.pts[r],O=this.pts[u];if(g.tempEnv1.init(w,O),u-r===1)return g.select(this,r),null;if(!e.intersects(g.tempEnv1))return null;var H=Math.trunc((r+u)/2);H>r&&this.computeSelect(e,r,H,g),u>H&&this.computeSelect(e,H,u,g)},getCoordinates:function(){for(var e=new Array(this.end-this.start+1).fill(null),r=0,u=this.start;u<=this.end;u++)e[r++]=this.pts[u];return e},computeOverlaps:function(e,r){this.computeOverlapsInternal(this.start,this.end,e,e.start,e.end,r)},setId:function(e){this.id=e},select:function(e,r){this.computeSelect(e,this.start,this.end,r)},getEnvelope:function(){if(this.env===null){var e=this.pts[this.start],r=this.pts[this.end];this.env=new et(e,r)}return this.env},getEndIndex:function(){return this.end},getStartIndex:function(){return this.start},getContext:function(){return this.context},getId:function(){return this.id},computeOverlapsInternal:function(e,r,u,g,w,O){var H=this.pts[e],Q=this.pts[r],ye=u.pts[g],Ue=u.pts[w];if(r-e===1&&w-g===1)return O.overlap(this,e,u,g),null;if(O.tempEnv1.init(H,Q),O.tempEnv2.init(ye,Ue),!O.tempEnv1.intersects(O.tempEnv2))return null;var ct=Math.trunc((e+r)/2),yt=Math.trunc((g+w)/2);ct>e&&(yt>g&&this.computeOverlapsInternal(e,ct,u,g,yt,O),w>yt&&this.computeOverlapsInternal(e,ct,u,yt,w,O)),r>ct&&(yt>g&&this.computeOverlapsInternal(ct,r,u,g,yt,O),w>yt&&this.computeOverlapsInternal(ct,r,u,yt,w,O))},interfaces_:function(){return[]},getClass:function(){return Sc}}),N(Qn.prototype,{interfaces_:function(){return[]},getClass:function(){return Qn}}),Qn.isNorthern=function(e){return e===Qn.NE||e===Qn.NW},Qn.isOpposite=function(e,r){if(e===r)return!1;var u=(e-r+4)%4;return u===2},Qn.commonHalfPlane=function(e,r){if(e===r)return e;var u=(e-r+4)%4;if(u===2)return-1;var g=r>e?e:r,w=e>r?e:r;return g===0&&w===3?3:g},Qn.isInHalfPlane=function(e,r){return r===Qn.SE?e===Qn.SE||e===Qn.SW:e===r||e===r+1},Qn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];if(e===0&&r===0)throw new X;return e>=0?r>=0?Qn.NE:Qn.SE:r>=0?Qn.NW:Qn.SW}if(arguments[0]instanceof ve&&arguments[1]instanceof ve){var u=arguments[0],g=arguments[1];if(g.x===u.x&&g.y===u.y)throw new X;return g.x>=u.x?g.y>=u.y?Qn.NE:Qn.SE:g.y>=u.y?Qn.NW:Qn.SW}},Qn.NE=0,Qn.NW=1,Qn.SW=2,Qn.SE=3,N(cs.prototype,{interfaces_:function(){return[]},getClass:function(){return cs}}),cs.getChainStartIndices=function(e){var r=0,u=new ze;u.add(new ri(r));do{var g=cs.findChainEnd(e,r);u.add(new ri(g)),r=g}while(r<e.length-1);var w=cs.toIntArray(u);return w},cs.findChainEnd=function(e,r){for(var u=r;u<e.length-1&&e[u].equals2D(e[u+1]);)u++;if(u>=e.length-1)return e.length-1;for(var g=Qn.quadrant(e[u],e[u+1]),w=r+1;w<e.length;){if(!e[w-1].equals2D(e[w])){var O=Qn.quadrant(e[w-1],e[w]);if(O!==g)break}w++}return w-1},cs.getChains=function(){if(arguments.length===1){var e=arguments[0];return cs.getChains(e,null)}if(arguments.length===2){for(var r=arguments[0],u=arguments[1],g=new ze,w=cs.getChainStartIndices(r),O=0;O<w.length-1;O++){var H=new Sc(r,w[O],w[O+1],u);g.add(H)}return g}},cs.toIntArray=function(e){for(var r=new Array(e.size()).fill(null),u=0;u<r.length;u++)r[u]=e.get(u).intValue();return r},N(Bs.prototype,{computeNodes:function(e){},getNodedSubstrings:function(){},interfaces_:function(){return[]},getClass:function(){return Bs}}),N(Rl.prototype,{setSegmentIntersector:function(e){this.segInt=e},interfaces_:function(){return[Bs]},getClass:function(){return Rl}}),Te(Or,Rl),N(Or.prototype,{getMonotoneChains:function(){return this.monoChains},getNodedSubstrings:function(){return rr.getNodedSubstrings(this.nodedSegStrings)},getIndex:function(){return this.index},add:function(e){for(var r=cs.getChains(e.getCoordinates(),e),u=r.iterator();u.hasNext();){var g=u.next();g.setId(this.idCounter++),this.index.insert(g.getEnvelope(),g),this.monoChains.add(g)}},computeNodes:function(e){this.nodedSegStrings=e;for(var r=e.iterator();r.hasNext();)this.add(r.next());this.intersectChains()},intersectChains:function(){for(var e=new Nr(this.segInt),r=this.monoChains.iterator();r.hasNext();)for(var u=r.next(),g=this.index.query(u.getEnvelope()),w=g.iterator();w.hasNext();){var O=w.next();if(O.getId()>u.getId()&&(u.computeOverlaps(O,e),this.nOverlaps++),this.segInt.isDone())return null}},interfaces_:function(){return[]},getClass:function(){return Or}}),Te(Nr,Wi),N(Nr.prototype,{overlap:function(){if(arguments.length!==4)return Wi.prototype.overlap.apply(this,arguments);var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3],w=e.getContext(),O=u.getContext();this.si.processIntersections(w,r,O,g)},interfaces_:function(){return[]},getClass:function(){return Nr}}),Or.SegmentOverlapAction=Nr,Te($i,Se),N($i.prototype,{getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return $i}}),$i.msgWithCoord=function(e,r){return r!==null?e+" [ "+r+" ]":e},N(hu.prototype,{processIntersections:function(e,r,u,g){},isDone:function(){},interfaces_:function(){return[]},getClass:function(){return hu}}),N(ys.prototype,{getInteriorIntersection:function(){return this.interiorIntersection},setCheckEndSegmentsOnly:function(e){this.isCheckEndSegmentsOnly=e},getIntersectionSegments:function(){return this.intSegments},count:function(){return this.intersectionCount},getIntersections:function(){return this.intersections},setFindAllIntersections:function(e){this.findAllIntersections=e},setKeepIntersections:function(e){this.keepIntersections=e},processIntersections:function(e,r,u,g){if(!this.findAllIntersections&&this.hasIntersection()||e===u&&r===g)return null;if(this.isCheckEndSegmentsOnly){var w=this.isEndSegment(e,r)||this.isEndSegment(u,g);if(!w)return null}var O=e.getCoordinates()[r],H=e.getCoordinates()[r+1],Q=u.getCoordinates()[g],ye=u.getCoordinates()[g+1];this.li.computeIntersection(O,H,Q,ye),this.li.hasIntersection()&&this.li.isInteriorIntersection()&&(this.intSegments=new Array(4).fill(null),this.intSegments[0]=O,this.intSegments[1]=H,this.intSegments[2]=Q,this.intSegments[3]=ye,this.interiorIntersection=this.li.getIntersection(0),this.keepIntersections&&this.intersections.add(this.interiorIntersection),this.intersectionCount++)},isEndSegment:function(e,r){return r===0?!0:r>=e.size()-2},hasIntersection:function(){return this.interiorIntersection!==null},isDone:function(){return this.findAllIntersections?!1:this.interiorIntersection!==null},interfaces_:function(){return[hu]},getClass:function(){return ys}}),ys.createAllIntersectionsFinder=function(e){var r=new ys(e);return r.setFindAllIntersections(!0),r},ys.createAnyIntersectionFinder=function(e){return new ys(e)},ys.createIntersectionCounter=function(e){var r=new ys(e);return r.setFindAllIntersections(!0),r.setKeepIntersections(!1),r},N(Qi.prototype,{execute:function(){return this.segInt!==null?null:void this.checkInteriorIntersections()},getIntersections:function(){return this.segInt.getIntersections()},isValid:function(){return this.execute(),this._isValid},setFindAllIntersections:function(e){this.findAllIntersections=e},checkInteriorIntersections:function(){this._isValid=!0,this.segInt=new ys(this.li),this.segInt.setFindAllIntersections(this.findAllIntersections);var e=new Or;return e.setSegmentIntersector(this.segInt),e.computeNodes(this.segStrings),this.segInt.hasIntersection()?(this._isValid=!1,null):void 0},checkValid:function(){if(this.execute(),!this._isValid)throw new $i(this.getErrorMessage(),this.segInt.getInteriorIntersection())},getErrorMessage:function(){if(this._isValid)return"no intersections found";var e=this.segInt.getIntersectionSegments();return"found non-noded intersection between "+Er.toLineString(e[0],e[1])+" and "+Er.toLineString(e[2],e[3])},interfaces_:function(){return[]},getClass:function(){return Qi}}),Qi.computeIntersections=function(e){var r=new Qi(e);return r.setFindAllIntersections(!0),r.isValid(),r.getIntersections()},N(Sr.prototype,{checkValid:function(){this.nv.checkValid()},interfaces_:function(){return[]},getClass:function(){return Sr}}),Sr.toSegmentStrings=function(e){for(var r=new ze,u=e.iterator();u.hasNext();){var g=u.next();r.add(new ai(g.getCoordinates(),g))}return r},Sr.checkValid=function(e){var r=new Sr(e);r.checkValid()},N(vs.prototype,{map:function(e){for(var r=new ze,u=0;u<e.getNumGeometries();u++){var g=this.mapOp.map(e.getGeometryN(u));g.isEmpty()||r.add(g)}return e.getFactory().createGeometryCollection(Zn.toGeometryArray(r))},interfaces_:function(){return[]},getClass:function(){return vs}}),vs.map=function(e,r){var u=new vs(r);return u.map(e)},N(At.prototype,{interfaces_:function(){return[]},getClass:function(){return At}}),At.opposite=function(e){return e===At.LEFT?At.RIGHT:e===At.RIGHT?At.LEFT:e},At.ON=0,At.LEFT=1,At.RIGHT=2,N(hs.prototype,{setAllLocations:function(e){for(var r=0;r<this.location.length;r++)this.location[r]=e},isNull:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==le.NONE)return!1;return!0},setAllLocationsIfNull:function(e){for(var r=0;r<this.location.length;r++)this.location[r]===le.NONE&&(this.location[r]=e)},isLine:function(){return this.location.length===1},merge:function(e){if(e.location.length>this.location.length){var r=new Array(3).fill(null);r[At.ON]=this.location[At.ON],r[At.LEFT]=le.NONE,r[At.RIGHT]=le.NONE,this.location=r}for(var u=0;u<this.location.length;u++)this.location[u]===le.NONE&&u<e.location.length&&(this.location[u]=e.location[u])},getLocations:function(){return this.location},flip:function(){if(this.location.length<=1)return null;var e=this.location[At.LEFT];this.location[At.LEFT]=this.location[At.RIGHT],this.location[At.RIGHT]=e},toString:function(){var e=new Qt;return this.location.length>1&&e.append(le.toLocationSymbol(this.location[At.LEFT])),e.append(le.toLocationSymbol(this.location[At.ON])),this.location.length>1&&e.append(le.toLocationSymbol(this.location[At.RIGHT])),e.toString()},setLocations:function(e,r,u){this.location[At.ON]=e,this.location[At.LEFT]=r,this.location[At.RIGHT]=u},get:function(e){return e<this.location.length?this.location[e]:le.NONE},isArea:function(){return this.location.length>1},isAnyNull:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===le.NONE)return!0;return!1},setLocation:function(){if(arguments.length===1){var e=arguments[0];this.setLocation(At.ON,e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.location[r]=u}},init:function(e){this.location=new Array(e).fill(null),this.setAllLocations(le.NONE)},isEqualOnSide:function(e,r){return this.location[r]===e.location[r]},allPositionsEqual:function(e){for(var r=0;r<this.location.length;r++)if(this.location[r]!==e)return!1;return!0},interfaces_:function(){return[]},getClass:function(){return hs}}),N(Mi.prototype,{getGeometryCount:function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e},setAllLocations:function(e,r){this.elt[e].setAllLocations(r)},isNull:function(e){return this.elt[e].isNull()},setAllLocationsIfNull:function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.elt[r].setAllLocationsIfNull(u)}},isLine:function(e){return this.elt[e].isLine()},merge:function(e){for(var r=0;2>r;r++)this.elt[r]===null&&e.elt[r]!==null?this.elt[r]=new hs(e.elt[r]):this.elt[r].merge(e.elt[r])},flip:function(){this.elt[0].flip(),this.elt[1].flip()},getLocation:function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(At.ON)}if(arguments.length===2){var r=arguments[0],u=arguments[1];return this.elt[r].get(u)}},toString:function(){var e=new Qt;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()},isArea:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}},isAnyNull:function(e){return this.elt[e].isAnyNull()},setLocation:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];this.elt[e].setLocation(At.ON,r)}else if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];this.elt[u].setLocation(g,w)}},isEqualOnSide:function(e,r){return this.elt[0].isEqualOnSide(e.elt[0],r)&&this.elt[1].isEqualOnSide(e.elt[1],r)},allPositionsEqual:function(e,r){return this.elt[e].allPositionsEqual(r)},toLine:function(e){this.elt[e].isArea()&&(this.elt[e]=new hs(this.elt[e].location[0]))},interfaces_:function(){return[]},getClass:function(){return Mi}}),Mi.toLineLabel=function(e){for(var r=new Mi(le.NONE),u=0;2>u;u++)r.setLocation(u,e.getLocation(u));return r},N(Co.prototype,{computeRing:function(){if(this.ring!==null)return null;for(var e=new Array(this.pts.size()).fill(null),r=0;r<this.pts.size();r++)e[r]=this.pts.get(r);this.ring=this.geometryFactory.createLinearRing(e),this._isHole=zt.isCCW(this.ring.getCoordinates())},isIsolated:function(){return this.label.getGeometryCount()===1},computePoints:function(e){this.startDe=e;var r=e,u=!0;do{if(r===null)throw new $i("Found null DirectedEdge");if(r.getEdgeRing()===this)throw new $i("Directed Edge visited twice during ring-building at "+r.getCoordinate());this.edges.add(r);var g=r.getLabel();Pe.isTrue(g.isArea()),this.mergeLabel(g),this.addPoints(r.getEdge(),r.isForward(),u),u=!1,this.setEdgeRing(r,this),r=this.getNext(r)}while(r!==this.startDe)},getLinearRing:function(){return this.ring},getCoordinate:function(e){return this.pts.get(e)},computeMaxNodeDegree:function(){this.maxNodeDegree=0;var e=this.startDe;do{var r=e.getNode(),u=r.getEdges().getOutgoingDegree(this);u>this.maxNodeDegree&&(this.maxNodeDegree=u),e=this.getNext(e)}while(e!==this.startDe);this.maxNodeDegree*=2},addPoints:function(e,r,u){var g=e.getCoordinates();if(r){var w=1;u&&(w=0);for(var O=w;O<g.length;O++)this.pts.add(g[O])}else{var w=g.length-2;u&&(w=g.length-1);for(var O=w;O>=0;O--)this.pts.add(g[O])}},isHole:function(){return this._isHole},setInResult:function(){var e=this.startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this.startDe)},containsPoint:function(e){var r=this.getLinearRing(),u=r.getEnvelopeInternal();if(!u.contains(e)||!zt.isPointInRing(e,r.getCoordinates()))return!1;for(var g=this.holes.iterator();g.hasNext();){var w=g.next();if(w.containsPoint(e))return!1}return!0},addHole:function(e){this.holes.add(e)},isShell:function(){return this.shell===null},getLabel:function(){return this.label},getEdges:function(){return this.edges},getMaxNodeDegree:function(){return this.maxNodeDegree<0&&this.computeMaxNodeDegree(),this.maxNodeDegree},getShell:function(){return this.shell},mergeLabel:function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var r=arguments[0],u=arguments[1],g=r.getLocation(u,At.RIGHT);if(g===le.NONE)return null;if(this.label.getLocation(u)===le.NONE)return this.label.setLocation(u,g),null}},setShell:function(e){this.shell=e,e!==null&&e.addHole(this)},toPolygon:function(e){for(var r=new Array(this.holes.size()).fill(null),u=0;u<this.holes.size();u++)r[u]=this.holes.get(u).getLinearRing();var g=e.createPolygon(this.getLinearRing(),r);return g},interfaces_:function(){return[]},getClass:function(){return Co}}),Te(Zo,Co),N(Zo.prototype,{setEdgeRing:function(e,r){e.setMinEdgeRing(r)},getNext:function(e){return e.getNextMin()},interfaces_:function(){return[]},getClass:function(){return Zo}}),Te(Mo,Co),N(Mo.prototype,{buildMinimalRings:function(){var e=new ze,r=this.startDe;do{if(r.getMinEdgeRing()===null){var u=new Zo(r,this.geometryFactory);e.add(u)}r=r.getNext()}while(r!==this.startDe);return e},setEdgeRing:function(e,r){e.setEdgeRing(r)},linkDirectedEdgesForMinimalEdgeRings:function(){var e=this.startDe;do{var r=e.getNode();r.getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this.startDe)},getNext:function(e){return e.getNext()},interfaces_:function(){return[]},getClass:function(){return Mo}}),N(Ao.prototype,{setVisited:function(e){this._isVisited=e},setInResult:function(e){this._isInResult=e},isCovered:function(){return this._isCovered},isCoveredSet:function(){return this._isCoveredSet},setLabel:function(e){this.label=e},getLabel:function(){return this.label},setCovered:function(e){this._isCovered=e,this._isCoveredSet=!0},updateIM:function(e){Pe.isTrue(this.label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)},isInResult:function(){return this._isInResult},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return Ao}}),Te(rs,Ao),N(rs.prototype,{isIncidentEdgeInResult:function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();){var r=e.next();if(r.getEdge().isInResult())return!0}return!1},isIsolated:function(){return this.label.getGeometryCount()===1},getCoordinate:function(){return this.coord},print:function(e){e.println("node "+this.coord+" lbl: "+this.label)},computeIM:function(e){},computeMergedLocation:function(e,r){var u=le.NONE;if(u=this.label.getLocation(r),!e.isNull(r)){var g=e.getLocation(r);u!==le.BOUNDARY&&(u=g)}return u},setLabel:function(){if(arguments.length!==2)return Ao.prototype.setLabel.apply(this,arguments);var e=arguments[0],r=arguments[1];this.label===null?this.label=new Mi(e,r):this.label.setLocation(e,r)},getEdges:function(){return this.edges},mergeLabel:function(){if(arguments[0]instanceof rs){var e=arguments[0];this.mergeLabel(e.label)}else if(arguments[0]instanceof Mi)for(var r=arguments[0],u=0;2>u;u++){var g=this.computeMergedLocation(r,u),w=this.label.getLocation(u);w===le.NONE&&this.label.setLocation(u,g)}},add:function(e){this.edges.insert(e),e.setNode(this)},setLabelBoundary:function(e){if(this.label===null)return null;var r=le.NONE;this.label!==null&&(r=this.label.getLocation(e));var u=null;switch(r){case le.BOUNDARY:u=le.INTERIOR;break;case le.INTERIOR:u=le.BOUNDARY;break;default:u=le.BOUNDARY}this.label.setLocation(e,u)},interfaces_:function(){return[]},getClass:function(){return rs}}),N(du.prototype,{find:function(e){return this.nodeMap.get(e)},addNode:function(){if(arguments[0]instanceof ve){var e=arguments[0],r=this.nodeMap.get(e);return r===null&&(r=this.nodeFact.createNode(e),this.nodeMap.put(e,r)),r}if(arguments[0]instanceof rs){var u=arguments[0],r=this.nodeMap.get(u.getCoordinate());return r===null?(this.nodeMap.put(u.getCoordinate(),u),u):(r.mergeLabel(u),r)}},print:function(e){for(var r=this.iterator();r.hasNext();){var u=r.next();u.print(e)}},iterator:function(){return this.nodeMap.values().iterator()},values:function(){return this.nodeMap.values()},getBoundaryNodes:function(e){for(var r=new ze,u=this.iterator();u.hasNext();){var g=u.next();g.getLabel().getLocation(e)===le.BOUNDARY&&r.add(g)}return r},add:function(e){var r=e.getCoordinate(),u=this.addNode(r);u.add(e)},interfaces_:function(){return[]},getClass:function(){return du}}),N(uo.prototype,{compareDirection:function(e){return this.dx===e.dx&&this.dy===e.dy?0:this.quadrant>e.quadrant?1:this.quadrant<e.quadrant?-1:zt.computeOrientation(e.p0,e.p1,this.p1)},getDy:function(){return this.dy},getCoordinate:function(){return this.p0},setNode:function(e){this.node=e},print:function(e){var r=Math.atan2(this.dy,this.dx),u=this.getClass().getName(),g=u.lastIndexOf("."),w=u.substring(g+1);e.print("  "+w+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+r+"   "+this.label)},compareTo:function(e){var r=e;return this.compareDirection(r)},getDirectedCoordinate:function(){return this.p1},getDx:function(){return this.dx},getLabel:function(){return this.label},getEdge:function(){return this.edge},getQuadrant:function(){return this.quadrant},getNode:function(){return this.node},toString:function(){var e=Math.atan2(this.dy,this.dx),r=this.getClass().getName(),u=r.lastIndexOf("."),g=r.substring(u+1);return"  "+g+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+e+"   "+this.label},computeLabel:function(e){},init:function(e,r){this.p0=e,this.p1=r,this.dx=r.x-e.x,this.dy=r.y-e.y,this.quadrant=Qn.quadrant(this.dx,this.dy),Pe.isTrue(!(this.dx===0&&this.dy===0),"EdgeEnd with identical endpoints found")},interfaces_:function(){return[a]},getClass:function(){return uo}}),Te(zr,uo),N(zr.prototype,{getNextMin:function(){return this.nextMin},getDepth:function(e){return this.depth[e]},setVisited:function(e){this._isVisited=e},computeDirectedLabel:function(){this.label=new Mi(this.edge.getLabel()),this._isForward||this.label.flip()},getNext:function(){return this.next},setDepth:function(e,r){if(this.depth[e]!==-999&&this.depth[e]!==r)throw new $i("assigned depths do not match",this.getCoordinate());this.depth[e]=r},isInteriorAreaEdge:function(){for(var r=!0,u=0;2>u;u++)this.label.isArea(u)&&this.label.getLocation(u,At.LEFT)===le.INTERIOR&&this.label.getLocation(u,At.RIGHT)===le.INTERIOR||(r=!1);return r},setNextMin:function(e){this.nextMin=e},print:function(e){uo.prototype.print.call(this,e),e.print(" "+this.depth[At.LEFT]+"/"+this.depth[At.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},setMinEdgeRing:function(e){this.minEdgeRing=e},isLineEdge:function(){var e=this.label.isLine(0)||this.label.isLine(1),r=!this.label.isArea(0)||this.label.allPositionsEqual(0,le.EXTERIOR),u=!this.label.isArea(1)||this.label.allPositionsEqual(1,le.EXTERIOR);return e&&r&&u},setEdgeRing:function(e){this.edgeRing=e},getMinEdgeRing:function(){return this.minEdgeRing},getDepthDelta:function(){var e=this.edge.getDepthDelta();return this._isForward||(e=-e),e},setInResult:function(e){this._isInResult=e},getSym:function(){return this.sym},isForward:function(){return this._isForward},getEdge:function(){return this.edge},printEdge:function(e){this.print(e),e.print(" "),this._isForward?this.edge.print(e):this.edge.printReverse(e)},setSym:function(e){this.sym=e},setVisitedEdge:function(e){this.setVisited(e),this.sym.setVisited(e)},setEdgeDepths:function(e,r){var u=this.getEdge().getDepthDelta();this._isForward||(u=-u);var g=1;e===At.LEFT&&(g=-1);var w=At.opposite(e),O=u*g,H=r+O;this.setDepth(e,r),this.setDepth(w,H)},getEdgeRing:function(){return this.edgeRing},isInResult:function(){return this._isInResult},setNext:function(e){this.next=e},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return zr}}),zr.depthFactor=function(e,r){return e===le.EXTERIOR&&r===le.INTERIOR?1:e===le.INTERIOR&&r===le.EXTERIOR?-1:0},N(Dl.prototype,{createNode:function(e){return new rs(e,null)},interfaces_:function(){return[]},getClass:function(){return Dl}}),N(Vs.prototype,{printEdges:function(e){e.println("Edges:");for(var r=0;r<this.edges.size();r++){e.println("edge "+r+":");var u=this.edges.get(r);u.print(e),u.eiList.print(e)}},find:function(e){return this.nodes.find(e)},addNode:function(){if(arguments[0]instanceof rs){var e=arguments[0];return this.nodes.addNode(e)}if(arguments[0]instanceof ve){var r=arguments[0];return this.nodes.addNode(r)}},getNodeIterator:function(){return this.nodes.iterator()},linkResultDirectedEdges:function(){for(var e=this.nodes.iterator();e.hasNext();){var r=e.next();r.getEdges().linkResultDirectedEdges()}},debugPrintln:function(e){xi.out.println(e)},isBoundaryNode:function(e,r){var u=this.nodes.find(r);if(u===null)return!1;var g=u.getLabel();return g!==null&&g.getLocation(e)===le.BOUNDARY},linkAllDirectedEdges:function(){for(var e=this.nodes.iterator();e.hasNext();){var r=e.next();r.getEdges().linkAllDirectedEdges()}},matchInSameDirection:function(e,r,u,g){return e.equals(u)?zt.computeOrientation(e,r,g)===zt.COLLINEAR&&Qn.quadrant(e,r)===Qn.quadrant(u,g):!1},getEdgeEnds:function(){return this.edgeEndList},debugPrint:function(e){xi.out.print(e)},getEdgeIterator:function(){return this.edges.iterator()},findEdgeInSameDirection:function(e,r){for(var u=0;u<this.edges.size();u++){var g=this.edges.get(u),w=g.getCoordinates();if(this.matchInSameDirection(e,r,w[0],w[1])||this.matchInSameDirection(e,r,w[w.length-1],w[w.length-2]))return g}return null},insertEdge:function(e){this.edges.add(e)},findEdgeEnd:function(e){for(var r=this.getEdgeEnds().iterator();r.hasNext();){var u=r.next();if(u.getEdge()===e)return u}return null},addEdges:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();this.edges.add(u);var g=new zr(u,!0),w=new zr(u,!1);g.setSym(w),w.setSym(g),this.add(g),this.add(w)}},add:function(e){this.nodes.add(e),this.edgeEndList.add(e)},getNodes:function(){return this.nodes.values()},findEdge:function(e,r){for(var u=0;u<this.edges.size();u++){var g=this.edges.get(u),w=g.getCoordinates();if(e.equals(w[0])&&r.equals(w[1]))return g}return null},interfaces_:function(){return[]},getClass:function(){return Vs}}),Vs.linkResultDirectedEdges=function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();u.getEdges().linkResultDirectedEdges()}},N(ju.prototype,{sortShellsAndHoles:function(e,r,u){for(var g=e.iterator();g.hasNext();){var w=g.next();w.isHole()?u.add(w):r.add(w)}},computePolygons:function(e){for(var r=new ze,u=e.iterator();u.hasNext();){var g=u.next(),w=g.toPolygon(this.geometryFactory);r.add(w)}return r},placeFreeHoles:function(e,r){for(var u=r.iterator();u.hasNext();){var g=u.next();if(g.getShell()===null){var w=this.findEdgeRingContaining(g,e);if(w===null)throw new $i("unable to assign hole to a shell",g.getCoordinate(0));g.setShell(w)}}},buildMinimalEdgeRings:function(e,r,u){for(var g=new ze,w=e.iterator();w.hasNext();){var O=w.next();if(O.getMaxNodeDegree()>2){O.linkDirectedEdgesForMinimalEdgeRings();var H=O.buildMinimalRings(),Q=this.findShell(H);Q!==null?(this.placePolygonHoles(Q,H),r.add(Q)):u.addAll(H)}else g.add(O)}return g},containsPoint:function(e){for(var r=this.shellList.iterator();r.hasNext();){var u=r.next();if(u.containsPoint(e))return!0}return!1},buildMaximalEdgeRings:function(e){for(var r=new ze,u=e.iterator();u.hasNext();){var g=u.next();if(g.isInResult()&&g.getLabel().isArea()&&g.getEdgeRing()===null){var w=new Mo(g,this.geometryFactory);r.add(w),w.setInResult()}}return r},placePolygonHoles:function(e,r){for(var u=r.iterator();u.hasNext();){var g=u.next();g.isHole()&&g.setShell(e)}},getPolygons:function(){var e=this.computePolygons(this.shellList);return e},findEdgeRingContaining:function(e,r){for(var u=e.getLinearRing(),g=u.getEnvelopeInternal(),w=u.getCoordinateN(0),O=null,H=null,Q=r.iterator();Q.hasNext();){var ye=Q.next(),Ue=ye.getLinearRing(),ct=Ue.getEnvelopeInternal();O!==null&&(H=O.getLinearRing().getEnvelopeInternal());var yt=!1;ct.contains(g)&&zt.isPointInRing(w,Ue.getCoordinates())&&(yt=!0),yt&&(O===null||H.contains(ct))&&(O=ye)}return O},findShell:function(e){for(var r=0,u=null,g=e.iterator();g.hasNext();){var w=g.next();w.isHole()||(u=w,r++)}return Pe.isTrue(1>=r,"found two shells in MinimalEdgeRing list"),u},add:function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var r=arguments[0],u=arguments[1];Vs.linkResultDirectedEdges(u);var g=this.buildMaximalEdgeRings(r),w=new ze,O=this.buildMinimalEdgeRings(g,this.shellList,w);this.sortShellsAndHoles(O,this.shellList,w),this.placeFreeHoles(this.shellList,w)}},interfaces_:function(){return[]},getClass:function(){return ju}}),N(Xa.prototype,{collectLines:function(e){for(var r=this.op.getGraph().getEdgeEnds().iterator();r.hasNext();){var u=r.next();this.collectLineEdge(u,e,this.lineEdgesList),this.collectBoundaryTouchEdge(u,e,this.lineEdgesList)}},labelIsolatedLine:function(e,r){var u=this.ptLocator.locate(e.getCoordinate(),this.op.getArgGeometry(r));e.getLabel().setLocation(r,u)},build:function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this.resultLineList},collectLineEdge:function(e,r,u){var g=e.getLabel(),w=e.getEdge();e.isLineEdge()&&(e.isVisited()||!fn.isResultOfOp(g,r)||w.isCovered()||(u.add(w),e.setVisitedEdge(!0)))},findCoveredLineEdges:function(){for(var e=this.op.getGraph().getNodes().iterator();e.hasNext();){var r=e.next();r.getEdges().findCoveredLineEdges()}for(var u=this.op.getGraph().getEdgeEnds().iterator();u.hasNext();){var g=u.next(),w=g.getEdge();if(g.isLineEdge()&&!w.isCoveredSet()){var O=this.op.isCoveredByA(g.getCoordinate());w.setCovered(O)}}},labelIsolatedLines:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next(),g=u.getLabel();u.isIsolated()&&(g.isNull(0)?this.labelIsolatedLine(u,0):this.labelIsolatedLine(u,1))}},buildLines:function(e){for(var r=this.lineEdgesList.iterator();r.hasNext();){var u=r.next(),g=(u.getLabel(),this.geometryFactory.createLineString(u.getCoordinates()));this.resultLineList.add(g),u.setInResult(!0)}},collectBoundaryTouchEdge:function(e,r,u){var g=e.getLabel();return e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult()?null:(Pe.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),void(fn.isResultOfOp(g,r)&&r===fn.INTERSECTION&&(u.add(e.getEdge()),e.setVisitedEdge(!0))))},interfaces_:function(){return[]},getClass:function(){return Xa}}),N(Ya.prototype,{filterCoveredNodeToPoint:function(e){var r=e.getCoordinate();if(!this.op.isCoveredByLA(r)){var u=this.geometryFactory.createPoint(r);this.resultPointList.add(u)}},extractNonCoveredResultNodes:function(e){for(var r=this.op.getGraph().getNodes().iterator();r.hasNext();){var u=r.next();if(!(u.isInResult()||u.isIncidentEdgeInResult()||u.getEdges().getDegree()!==0&&e!==fn.INTERSECTION)){var g=u.getLabel();fn.isResultOfOp(g,e)&&this.filterCoveredNodeToPoint(u)}}},build:function(e){return this.extractNonCoveredResultNodes(e),this.resultPointList},interfaces_:function(){return[]},getClass:function(){return Ya}}),N(Cc.prototype,{locate:function(e){},interfaces_:function(){return[]},getClass:function(){return Cc}}),N(ss.prototype,{locate:function(e){return ss.locate(e,this.geom)},interfaces_:function(){return[Cc]},getClass:function(){return ss}}),ss.isPointInRing=function(e,r){return r.getEnvelopeInternal().intersects(e)?zt.isPointInRing(e,r.getCoordinates()):!1},ss.containsPointInPolygon=function(e,r){if(r.isEmpty())return!1;var u=r.getExteriorRing();if(!ss.isPointInRing(e,u))return!1;for(var g=0;g<r.getNumInteriorRing();g++){var w=r.getInteriorRingN(g);if(ss.isPointInRing(e,w))return!1}return!0},ss.containsPoint=function(e,r){if(r instanceof ne)return ss.containsPointInPolygon(e,r);if(r instanceof jn)for(var u=new lo(r);u.hasNext();){var g=u.next();if(g!==r&&ss.containsPoint(e,g))return!0}return!1},ss.locate=function(e,r){return r.isEmpty()?le.EXTERIOR:ss.containsPoint(e,r)?le.INTERIOR:le.EXTERIOR},N(Xs.prototype,{getNextCW:function(e){this.getEdges();var r=this.edgeList.indexOf(e),u=r-1;return r===0&&(u=this.edgeList.size()-1),this.edgeList.get(u)},propagateSideLabels:function(e){for(var r=le.NONE,u=this.iterator();u.hasNext();){var g=u.next(),w=g.getLabel();w.isArea(e)&&w.getLocation(e,At.LEFT)!==le.NONE&&(r=w.getLocation(e,At.LEFT))}if(r===le.NONE)return null;for(var O=r,u=this.iterator();u.hasNext();){var g=u.next(),w=g.getLabel();if(w.getLocation(e,At.ON)===le.NONE&&w.setLocation(e,At.ON,O),w.isArea(e)){var H=w.getLocation(e,At.LEFT),Q=w.getLocation(e,At.RIGHT);if(Q!==le.NONE){if(Q!==O)throw new $i("side location conflict",g.getCoordinate());H===le.NONE&&Pe.shouldNeverReachHere("found single null side (at "+g.getCoordinate()+")"),O=H}else Pe.isTrue(w.getLocation(e,At.LEFT)===le.NONE,"found single null side"),w.setLocation(e,At.RIGHT,O),w.setLocation(e,At.LEFT,O)}}},getCoordinate:function(){var e=this.iterator();if(!e.hasNext())return null;var r=e.next();return r.getCoordinate()},print:function(e){xi.out.println("EdgeEndStar:   "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var u=r.next();u.print(e)}},isAreaLabelsConsistent:function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},checkAreaLabelsConsistent:function(e){var r=this.getEdges();if(r.size()<=0)return!0;var u=r.size()-1,g=r.get(u).getLabel(),w=g.getLocation(e,At.LEFT);Pe.isTrue(w!==le.NONE,"Found unlabelled area edge");for(var O=w,H=this.iterator();H.hasNext();){var Q=H.next(),ye=Q.getLabel();Pe.isTrue(ye.isArea(e),"Found non-area edge");var Ue=ye.getLocation(e,At.LEFT),ct=ye.getLocation(e,At.RIGHT);if(Ue===ct||ct!==O)return!1;O=Ue}return!0},findIndex:function(e){this.iterator();for(var r=0;r<this.edgeList.size();r++){var u=this.edgeList.get(r);if(u===e)return r}return-1},iterator:function(){return this.getEdges().iterator()},getEdges:function(){return this.edgeList===null&&(this.edgeList=new ze(this.edgeMap.values())),this.edgeList},getLocation:function(e,r,u){return this.ptInAreaLocation[e]===le.NONE&&(this.ptInAreaLocation[e]=ss.locate(r,u[e].getGeometry())),this.ptInAreaLocation[e]},toString:function(){var e=new Qt;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var r=this.iterator();r.hasNext();){var u=r.next();e.append(u),e.append(`
`)}return e.toString()},computeEdgeEndLabels:function(e){for(var r=this.iterator();r.hasNext();){var u=r.next();u.computeLabel(e)}},computeLabelling:function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],u=this.iterator();u.hasNext();)for(var g=u.next(),w=g.getLabel(),O=0;2>O;O++)w.isLine(O)&&w.getLocation(O)===le.BOUNDARY&&(r[O]=!0);for(var u=this.iterator();u.hasNext();)for(var g=u.next(),w=g.getLabel(),O=0;2>O;O++)if(w.isAnyNull(O)){var H=le.NONE;if(r[O])H=le.EXTERIOR;else{var Q=g.getCoordinate();H=this.getLocation(O,Q,e)}w.setAllLocationsIfNull(O,H)}},getDegree:function(){return this.edgeMap.size()},insertEdgeEnd:function(e,r){this.edgeMap.put(e,r),this.edgeList=null},interfaces_:function(){return[]},getClass:function(){return Xs}}),Te(Mc,Xs),N(Mc.prototype,{linkResultDirectedEdges:function(){this.getResultAreaEdges();for(var e=null,r=null,u=this.SCANNING_FOR_INCOMING,g=0;g<this.resultAreaEdgeList.size();g++){var w=this.resultAreaEdgeList.get(g),O=w.getSym();if(w.getLabel().isArea())switch(e===null&&w.isInResult()&&(e=w),u){case this.SCANNING_FOR_INCOMING:if(!O.isInResult())continue;r=O,u=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(!w.isInResult())continue;r.setNext(w),u=this.SCANNING_FOR_INCOMING}}if(u===this.LINKING_TO_OUTGOING){if(e===null)throw new $i("no outgoing dirEdge found",this.getCoordinate());Pe.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),r.setNext(e)}},insert:function(e){var r=e;this.insertEdgeEnd(r,r)},getRightmostEdge:function(){var e=this.getEdges(),r=e.size();if(1>r)return null;var u=e.get(0);if(r===1)return u;var g=e.get(r-1),w=u.getQuadrant(),O=g.getQuadrant();return Qn.isNorthern(w)&&Qn.isNorthern(O)?u:!Qn.isNorthern(w)&&!Qn.isNorthern(O)?g:u.getDy()!==0?u:g.getDy()!==0?g:(Pe.shouldNeverReachHere("found two horizontal edges incident on node"),null)},print:function(e){xi.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var u=r.next();e.print("out "),u.print(e),e.println(),e.print("in "),u.getSym().print(e),e.println()}},getResultAreaEdges:function(){if(this.resultAreaEdgeList!==null)return this.resultAreaEdgeList;this.resultAreaEdgeList=new ze;for(var e=this.iterator();e.hasNext();){var r=e.next();(r.isInResult()||r.getSym().isInResult())&&this.resultAreaEdgeList.add(r)}return this.resultAreaEdgeList},updateLabelling:function(e){for(var r=this.iterator();r.hasNext();){var u=r.next(),g=u.getLabel();g.setAllLocationsIfNull(0,e.getLocation(0)),g.setAllLocationsIfNull(1,e.getLocation(1))}},linkAllDirectedEdges:function(){this.getEdges();for(var e=null,r=null,u=this.edgeList.size()-1;u>=0;u--){var g=this.edgeList.get(u),w=g.getSym();r===null&&(r=w),e!==null&&w.setNext(e),e=g}r.setNext(e)},computeDepths:function(){if(arguments.length===1){var e=arguments[0],r=this.findIndex(e),u=(e.getLabel(),e.getDepth(At.LEFT)),g=e.getDepth(At.RIGHT),w=this.computeDepths(r+1,this.edgeList.size(),u),O=this.computeDepths(0,r,w);if(O!==g)throw new $i("depth mismatch at "+e.getCoordinate())}else if(arguments.length===3){for(var H=arguments[0],Q=arguments[1],ye=arguments[2],Ue=ye,ct=H;Q>ct;ct++){var yt=this.edgeList.get(ct);yt.getLabel(),yt.setEdgeDepths(At.RIGHT,Ue),Ue=yt.getDepth(At.LEFT)}return Ue}},mergeSymLabels:function(){for(var e=this.iterator();e.hasNext();){var r=e.next(),u=r.getLabel();u.merge(r.getSym().getLabel())}},linkMinimalDirectedEdges:function(e){for(var r=null,u=null,g=this.SCANNING_FOR_INCOMING,w=this.resultAreaEdgeList.size()-1;w>=0;w--){var O=this.resultAreaEdgeList.get(w),H=O.getSym();switch(r===null&&O.getEdgeRing()===e&&(r=O),g){case this.SCANNING_FOR_INCOMING:if(H.getEdgeRing()!==e)continue;u=H,g=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(O.getEdgeRing()!==e)continue;u.setNextMin(O),g=this.SCANNING_FOR_INCOMING}}g===this.LINKING_TO_OUTGOING&&(Pe.isTrue(r!==null,"found null for first outgoing dirEdge"),Pe.isTrue(r.getEdgeRing()===e,"unable to link last incoming dirEdge"),u.setNextMin(r))},getOutgoingDegree:function(){if(arguments.length===0){for(var e=0,r=this.iterator();r.hasNext();){var u=r.next();u.isInResult()&&e++}return e}if(arguments.length===1){for(var g=arguments[0],e=0,r=this.iterator();r.hasNext();){var u=r.next();u.getEdgeRing()===g&&e++}return e}},getLabel:function(){return this.label},findCoveredLineEdges:function(){for(var e=le.NONE,r=this.iterator();r.hasNext();){var u=r.next(),g=u.getSym();if(!u.isLineEdge()){if(u.isInResult()){e=le.INTERIOR;break}if(g.isInResult()){e=le.EXTERIOR;break}}}if(e===le.NONE)return null;for(var w=e,r=this.iterator();r.hasNext();){var u=r.next(),g=u.getSym();u.isLineEdge()?u.getEdge().setCovered(w===le.INTERIOR):(u.isInResult()&&(w=le.EXTERIOR),g.isInResult()&&(w=le.INTERIOR))}},computeLabelling:function(e){Xs.prototype.computeLabelling.call(this,e),this.label=new Mi(le.NONE);for(var r=this.iterator();r.hasNext();)for(var u=r.next(),g=u.getEdge(),w=g.getLabel(),O=0;2>O;O++){var H=w.getLocation(O);H!==le.INTERIOR&&H!==le.BOUNDARY||this.label.setLocation(O,le.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return Mc}}),Te(Po,Dl),N(Po.prototype,{createNode:function(e){return new rs(e,new Mc)},interfaces_:function(){return[]},getClass:function(){return Po}}),N(Ac.prototype,{computeIntersections:function(e,r){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,r)},interfaces_:function(){return[]},getClass:function(){return Ac}}),N(Ys.prototype,{isDelete:function(){return this.eventType===Ys.DELETE},setDeleteEventIndex:function(e){this.deleteEventIndex=e},getObject:function(){return this.obj},compareTo:function(e){var r=e;return this.xValue<r.xValue?-1:this.xValue>r.xValue?1:this.eventType<r.eventType?-1:this.eventType>r.eventType?1:0},getInsertEvent:function(){return this.insertEvent},isInsert:function(){return this.eventType===Ys.INSERT},isSameLabel:function(e){return this.label===null?!1:this.label===e.label},getDeleteEventIndex:function(){return this.deleteEventIndex},interfaces_:function(){return[a]},getClass:function(){return Ys}}),Ys.INSERT=1,Ys.DELETE=2,N(xs.prototype,{interfaces_:function(){return[]},getClass:function(){return xs}}),N(An.prototype,{isTrivialIntersection:function(e,r,u,g){if(e===u&&this.li.getIntersectionNum()===1){if(An.isAdjacentSegments(r,g))return!0;if(e.isClosed()){var w=e.getNumPoints()-1;if(r===0&&g===w||g===0&&r===w)return!0}}return!1},getProperIntersectionPoint:function(){return this.properIntersectionPoint},setIsDoneIfProperInt:function(e){this.isDoneWhenProperInt=e},hasProperInteriorIntersection:function(){return this.hasProperInterior},isBoundaryPointInternal:function(e,r){for(var u=r.iterator();u.hasNext();){var g=u.next(),w=g.getCoordinate();if(e.isIntersection(w))return!0}return!1},hasProperIntersection:function(){return this.hasProper},hasIntersection:function(){return this._hasIntersection},isDone:function(){return this._isDone},isBoundaryPoint:function(e,r){return r===null?!1:this.isBoundaryPointInternal(e,r[0])?!0:!!this.isBoundaryPointInternal(e,r[1])},setBoundaryNodes:function(e,r){this.bdyNodes=new Array(2).fill(null),this.bdyNodes[0]=e,this.bdyNodes[1]=r},addIntersections:function(e,r,u,g){if(e===u&&r===g)return null;this.numTests++;var w=e.getCoordinates()[r],O=e.getCoordinates()[r+1],H=u.getCoordinates()[g],Q=u.getCoordinates()[g+1];this.li.computeIntersection(w,O,H,Q),this.li.hasIntersection()&&(this.recordIsolated&&(e.setIsolated(!1),u.setIsolated(!1)),this.numIntersections++,this.isTrivialIntersection(e,r,u,g)||(this._hasIntersection=!0,!this.includeProper&&this.li.isProper()||(e.addIntersections(this.li,r,0),u.addIntersections(this.li,g,1)),this.li.isProper()&&(this.properIntersectionPoint=this.li.getIntersection(0).copy(),this.hasProper=!0,this.isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this.li,this.bdyNodes)||(this.hasProperInterior=!0))))},interfaces_:function(){return[]},getClass:function(){return An}}),An.isAdjacentSegments=function(e,r){return Math.abs(e-r)===1},Te(rn,xs),N(rn.prototype,{prepareEvents:function(){Hs.sort(this.events);for(var e=0;e<this.events.size();e++){var r=this.events.get(e);r.isDelete()&&r.getInsertEvent().setDeleteEventIndex(e)}},computeIntersections:function(){if(arguments.length===1){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var r=0;r<this.events.size();r++){var u=this.events.get(r);if(u.isInsert()&&this.processOverlaps(r,u.getDeleteEventIndex(),u,e),e.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof An&&kt(arguments[0],Ae)&&kt(arguments[1],Ae)){var g=arguments[0],w=arguments[1],O=arguments[2];this.addEdges(g,g),this.addEdges(w,w),this.computeIntersections(O)}else if(typeof arguments[2]=="boolean"&&kt(arguments[0],Ae)&&arguments[1]instanceof An){var H=arguments[0],Q=arguments[1],ye=arguments[2];ye?this.addEdges(H,null):this.addEdges(H),this.computeIntersections(Q)}}},addEdge:function(e,r){for(var u=e.getMonotoneChainEdge(),g=u.getStartIndexes(),w=0;w<g.length-1;w++){var O=new Ac(u,w),H=new Ys(r,u.getMinX(w),O);this.events.add(H),this.events.add(new Ys(u.getMaxX(w),H))}},processOverlaps:function(e,r,u,g){for(var w=u.getObject(),O=e;r>O;O++){var H=this.events.get(O);if(H.isInsert()){var Q=H.getObject();u.isSameLabel(H)||(w.computeIntersections(Q,g),this.nOverlaps++)}}},addEdges:function(){if(arguments.length===1)for(var e=arguments[0],r=e.iterator();r.hasNext();){var u=r.next();this.addEdge(u,u)}else if(arguments.length===2)for(var g=arguments[0],w=arguments[1],r=g.iterator();r.hasNext();){var u=r.next();this.addEdge(u,w)}},interfaces_:function(){return[]},getClass:function(){return rn}}),N(va.prototype,{getMin:function(){return this.min},intersects:function(e,r){return!(this.min>r||this.max<e)},getMax:function(){return this.max},toString:function(){return Er.toLineString(new ve(this.min,0),new ve(this.max,0))},interfaces_:function(){return[]},getClass:function(){return va}}),N(xn.prototype,{compare:function(e,r){var u=e,g=r,w=(u.min+u.max)/2,O=(g.min+g.max)/2;return O>w?-1:w>O?1:0},interfaces_:function(){return[me]},getClass:function(){return xn}}),va.NodeComparator=xn,Te(fu,va),N(fu.prototype,{query:function(e,r,u){return this.intersects(e,r)?void u.visitItem(this.item):null},interfaces_:function(){return[]},getClass:function(){return fu}}),Te(Ja,va),N(Ja.prototype,{buildExtent:function(e,r){this.min=Math.min(e.min,r.min),this.max=Math.max(e.max,r.max)},query:function(e,r,u){return this.intersects(e,r)?(this.node1!==null&&this.node1.query(e,r,u),void(this.node2!==null&&this.node2.query(e,r,u))):null},interfaces_:function(){return[]},getClass:function(){return Ja}}),N(mn.prototype,{buildTree:function(){Hs.sort(this.leaves,new IntervalRTreeNode.NodeComparator);for(var e=this.leaves,r=null,u=new ze;;){if(this.buildLevel(e,u),u.size()===1)return u.get(0);r=e,e=u,u=r}},insert:function(e,r,u){if(this.root!==null)throw new IllegalStateException("Index cannot be added to once it has been queried");this.leaves.add(new fu(e,r,u))},query:function(e,r,u){this.init(),this.root.query(e,r,u)},buildRoot:function(){return this.root!==null?null:void(this.root=this.buildTree())},printNode:function(e){xi.out.println(Er.toLineString(new ve(e.min,this.level),new ve(e.max,this.level)))},init:function(){return this.root!==null?null:void this.buildRoot()},buildLevel:function(e,r){this.level++,r.clear();for(var u=0;u<e.size();u+=2){var g=e.get(u),w=u+1<e.size()?e.get(u):null;if(w===null)r.add(g);else{var O=new Ja(e.get(u),e.get(u+1));r.add(O)}}},interfaces_:function(){return[]},getClass:function(){return mn}}),N(Fr.prototype,{filter:function(e){if(this.isForcedToLineString&&e instanceof ge){var r=e.getFactory().createLineString(e.getCoordinateSequence());return this.lines.add(r),null}e instanceof Fn&&this.lines.add(e)},setForceToLineString:function(e){this.isForcedToLineString=e},interfaces_:function(){return[es]},getClass:function(){return Fr}}),Fr.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(Fr.getLines(e))}if(arguments.length===2){var r=arguments[0],u=arguments[1];return r.getFactory().buildGeometry(Fr.getLines(r,u))}},Fr.getLines=function(){if(arguments.length===1){var e=arguments[0];return Fr.getLines(e,!1)}if(arguments.length===2){if(kt(arguments[0],Bt)&&kt(arguments[1],Bt)){for(var r=arguments[0],u=arguments[1],g=r.iterator();g.hasNext();){var w=g.next();Fr.getLines(w,u)}return u}if(arguments[0]instanceof Jt&&typeof arguments[1]=="boolean"){var O=arguments[0],H=arguments[1],Q=new ze;return O.apply(new Fr(Q,H)),Q}if(arguments[0]instanceof Jt&&kt(arguments[1],Bt)){var ye=arguments[0],Ue=arguments[1];return ye instanceof Fn?Ue.add(ye):ye.apply(new Fr(Ue)),Ue}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&kt(arguments[0],Bt)&&kt(arguments[1],Bt)){for(var ct=arguments[0],yt=arguments[1],Ft=arguments[2],g=ct.iterator();g.hasNext();){var w=g.next();Fr.getLines(w,yt,Ft)}return yt}if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Jt&&kt(arguments[1],Bt)){var sn=arguments[0],Tn=arguments[1],Pn=arguments[2];return sn.apply(new Fr(Tn,Pn)),Tn}}},N(Ol.prototype,{visitItem:function(e){this.items.add(e)},getItems:function(){return this.items},interfaces_:function(){return[ks]},getClass:function(){return Ol}}),N(Nl.prototype,{locate:function(e){var r=new oo(e),u=new Lo(r);return this.index.query(e.y,e.y,u),r.getLocation()},interfaces_:function(){return[Cc]},getClass:function(){return Nl}}),N(Lo.prototype,{visitItem:function(e){var r=e;this.counter.countSegment(r.getCoordinate(0),r.getCoordinate(1))},interfaces_:function(){return[ks]},getClass:function(){return Lo}}),N(Wo.prototype,{init:function(e){for(var r=Fr.getLines(e),u=r.iterator();u.hasNext();){var g=u.next(),w=g.getCoordinates();this.addLine(w)}},addLine:function(e){for(var r=1;r<e.length;r++){var u=new Sn(e[r-1],e[r]),g=Math.min(u.p0.y,u.p1.y),w=Math.max(u.p0.y,u.p1.y);this.index.insert(g,w,u)}},query:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],u=new Ol;return this.index.query(e,r,u),u.getItems()}if(arguments.length===3){var g=arguments[0],w=arguments[1],O=arguments[2];this.index.query(g,w,O)}},interfaces_:function(){return[]},getClass:function(){return Wo}}),Nl.SegmentVisitor=Lo,Nl.IntervalIndexedGeometry=Wo,N(Hr.prototype,{getSegmentIndex:function(){return this.segmentIndex},getCoordinate:function(){return this.coord},print:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)},compareTo:function(e){var r=e;return this.compare(r.segmentIndex,r.dist)},isEndPoint:function(e){return this.segmentIndex===0&&this.dist===0?!0:this.segmentIndex===e},toString:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},getDistance:function(){return this.dist},compare:function(e,r){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<r?-1:this.dist>r?1:0},interfaces_:function(){return[a]},getClass:function(){return Hr}}),N(pu.prototype,{print:function(e){e.println("Intersections:");for(var r=this.iterator();r.hasNext();){var u=r.next();u.print(e)}},iterator:function(){return this.nodeMap.values().iterator()},addSplitEdges:function(e){this.addEndpoints();for(var r=this.iterator(),u=r.next();r.hasNext();){var g=r.next(),w=this.createSplitEdge(u,g);e.add(w),u=g}},addEndpoints:function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)},createSplitEdge:function(e,r){var u=r.segmentIndex-e.segmentIndex+2,g=this.edge.pts[r.segmentIndex],w=r.dist>0||!r.coord.equals2D(g);w||u--;var O=new Array(u).fill(null),H=0;O[H++]=new ve(e.coord);for(var Q=e.segmentIndex+1;Q<=r.segmentIndex;Q++)O[H++]=this.edge.pts[Q];return w&&(O[H]=r.coord),new Cr(O,new Mi(this.edge.label))},add:function(e,r,u){var g=new Hr(e,r,u),w=this.nodeMap.get(g);return w!==null?w:(this.nodeMap.put(g,g),g)},isIntersection:function(e){for(var r=this.iterator();r.hasNext();){var u=r.next();if(u.coord.equals(e))return!0}return!1},interfaces_:function(){return[]},getClass:function(){return pu}}),N($o.prototype,{getChainStartIndices:function(e){var r=0,u=new ze;u.add(new ri(r));do{var g=this.findChainEnd(e,r);u.add(new ri(g)),r=g}while(r<e.length-1);var w=$o.toIntArray(u);return w},findChainEnd:function(e,r){for(var u=Qn.quadrant(e[r],e[r+1]),g=r+1;g<e.length;){var w=Qn.quadrant(e[g-1],e[g]);if(w!==u)break;g++}return g-1},interfaces_:function(){return[]},getClass:function(){return $o}}),$o.toIntArray=function(e){for(var r=new Array(e.size()).fill(null),u=0;u<r.length;u++)r[u]=e.get(u).intValue();return r},N(Ka.prototype,{getCoordinates:function(){return this.pts},getMaxX:function(e){var r=this.pts[this.startIndex[e]].x,u=this.pts[this.startIndex[e+1]].x;return r>u?r:u},getMinX:function(e){var r=this.pts[this.startIndex[e]].x,u=this.pts[this.startIndex[e+1]].x;return u>r?r:u},computeIntersectsForChain:function(){if(arguments.length===4){var e=arguments[0],r=arguments[1],u=arguments[2],g=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],r,r.startIndex[u],r.startIndex[u+1],g)}else if(arguments.length===6){var w=arguments[0],O=arguments[1],H=arguments[2],Q=arguments[3],ye=arguments[4],Ue=arguments[5],ct=this.pts[w],yt=this.pts[O],Ft=H.pts[Q],sn=H.pts[ye];if(O-w===1&&ye-Q===1)return Ue.addIntersections(this.e,w,H.e,Q),null;if(this.env1.init(ct,yt),this.env2.init(Ft,sn),!this.env1.intersects(this.env2))return null;var Tn=Math.trunc((w+O)/2),Pn=Math.trunc((Q+ye)/2);Tn>w&&(Pn>Q&&this.computeIntersectsForChain(w,Tn,H,Q,Pn,Ue),ye>Pn&&this.computeIntersectsForChain(w,Tn,H,Pn,ye,Ue)),O>Tn&&(Pn>Q&&this.computeIntersectsForChain(Tn,O,H,Q,Pn,Ue),ye>Pn&&this.computeIntersectsForChain(Tn,O,H,Pn,ye,Ue))}},getStartIndexes:function(){return this.startIndex},computeIntersects:function(e,r){for(var u=0;u<this.startIndex.length-1;u++)for(var g=0;g<e.startIndex.length-1;g++)this.computeIntersectsForChain(u,e,g,r)},interfaces_:function(){return[]},getClass:function(){return Ka}}),N(Ps.prototype,{getDepth:function(e,r){return this.depth[e][r]},setDepth:function(e,r,u){this.depth[e][r]=u},isNull:function(){if(arguments.length===0){for(var e=0;2>e;e++)for(var r=0;3>r;r++)if(this.depth[e][r]!==Ps.NULL_VALUE)return!1;return!0}if(arguments.length===1){var u=arguments[0];return this.depth[u][1]===Ps.NULL_VALUE}if(arguments.length===2){var g=arguments[0],w=arguments[1];return this.depth[g][w]===Ps.NULL_VALUE}},normalize:function(){for(var e=0;2>e;e++)if(!this.isNull(e)){var r=this.depth[e][1];this.depth[e][2]<r&&(r=this.depth[e][2]),0>r&&(r=0);for(var u=1;3>u;u++){var g=0;this.depth[e][u]>r&&(g=1),this.depth[e][u]=g}}},getDelta:function(e){return this.depth[e][At.RIGHT]-this.depth[e][At.LEFT]},getLocation:function(e,r){return this.depth[e][r]<=0?le.EXTERIOR:le.INTERIOR},toString:function(){return"A: "+this.depth[0][1]+","+this.depth[0][2]+" B: "+this.depth[1][1]+","+this.depth[1][2]},add:function(){if(arguments.length===1)for(var e=arguments[0],r=0;2>r;r++)for(var u=1;3>u;u++){var g=e.getLocation(r,u);g!==le.EXTERIOR&&g!==le.INTERIOR||(this.isNull(r,u)?this.depth[r][u]=Ps.depthAtLocation(g):this.depth[r][u]+=Ps.depthAtLocation(g))}else if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2];H===le.INTERIOR&&this.depth[w][O]++}},interfaces_:function(){return[]},getClass:function(){return Ps}}),Ps.depthAtLocation=function(e){return e===le.EXTERIOR?0:e===le.INTERIOR?1:Ps.NULL_VALUE},Ps.NULL_VALUE=-1,Te(Cr,Ao),N(Cr.prototype,{getDepth:function(){return this.depth},getCollapsedEdge:function(){var e=new Array(2).fill(null);e[0]=this.pts[0],e[1]=this.pts[1];var r=new Cr(e,Mi.toLineLabel(this.label));return r},isIsolated:function(){return this._isIsolated},getCoordinates:function(){return this.pts},setIsolated:function(e){this._isIsolated=e},setName:function(e){this.name=e},equals:function(e){if(!(e instanceof Cr))return!1;var r=e;if(this.pts.length!==r.pts.length)return!1;for(var u=!0,g=!0,w=this.pts.length,O=0;O<this.pts.length;O++)if(this.pts[O].equals2D(r.pts[O])||(u=!1),this.pts[O].equals2D(r.pts[--w])||(g=!1),!u&&!g)return!1;return!0},getCoordinate:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var e=arguments[0];return this.pts[e]}},print:function(e){e.print("edge "+this.name+": "),e.print("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&e.print(","),e.print(this.pts[r].x+" "+this.pts[r].y);e.print(")  "+this.label+" "+this.depthDelta)},computeIM:function(e){Cr.updateIM(this.label,e)},isCollapsed:function(){return this.label.isArea()?this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2]):!1},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getMaximumSegmentIndex:function(){return this.pts.length-1},getDepthDelta:function(){return this.depthDelta},getNumPoints:function(){return this.pts.length},printReverse:function(e){e.print("edge "+this.name+": ");for(var r=this.pts.length-1;r>=0;r--)e.print(this.pts[r]+" ");e.println("")},getMonotoneChainEdge:function(){return this.mce===null&&(this.mce=new Ka(this)),this.mce},getEnvelope:function(){if(this.env===null){this.env=new et;for(var e=0;e<this.pts.length;e++)this.env.expandToInclude(this.pts[e])}return this.env},addIntersection:function(e,r,u,g){var w=new ve(e.getIntersection(g)),O=r,H=e.getEdgeDistance(u,g),Q=O+1;if(Q<this.pts.length){var ye=this.pts[Q];w.equals2D(ye)&&(O=Q,H=0)}this.eiList.add(w,O,H)},toString:function(){var e=new Qt;e.append("edge "+this.name+": "),e.append("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&e.append(","),e.append(this.pts[r].x+" "+this.pts[r].y);return e.append(")  "+this.label+" "+this.depthDelta),e.toString()},isPointwiseEqual:function(e){if(this.pts.length!==e.pts.length)return!1;for(var r=0;r<this.pts.length;r++)if(!this.pts[r].equals2D(e.pts[r]))return!1;return!0},setDepthDelta:function(e){this.depthDelta=e},getEdgeIntersectionList:function(){return this.eiList},addIntersections:function(e,r,u){for(var g=0;g<e.getIntersectionNum();g++)this.addIntersection(e,r,u,g)},interfaces_:function(){return[]},getClass:function(){return Cr}}),Cr.updateIM=function(){if(arguments.length!==2)return Ao.prototype.updateIM.apply(this,arguments);var e=arguments[0],r=arguments[1];r.setAtLeastIfValid(e.getLocation(0,At.ON),e.getLocation(1,At.ON),1),e.isArea()&&(r.setAtLeastIfValid(e.getLocation(0,At.LEFT),e.getLocation(1,At.LEFT),2),r.setAtLeastIfValid(e.getLocation(0,At.RIGHT),e.getLocation(1,At.RIGHT),2))},Te(li,Vs),N(li.prototype,{insertBoundaryPoint:function(e,r){var u=this.nodes.addNode(r),g=u.getLabel(),w=1,O=le.NONE;O=g.getLocation(e,At.ON),O===le.BOUNDARY&&w++;var H=li.determineBoundary(this.boundaryNodeRule,w);g.setLocation(e,H)},computeSelfNodes:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.computeSelfNodes(e,r,!1)}if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2],O=new An(u,!0,!1);O.setIsDoneIfProperInt(w);var H=this.createEdgeSetIntersector(),Q=this.parentGeom instanceof ge||this.parentGeom instanceof ne||this.parentGeom instanceof Oe,ye=g||!Q;return H.computeIntersections(this.edges,O,ye),this.addSelfIntersectionNodes(this.argIndex),O}},computeSplitEdges:function(e){for(var r=this.edges.iterator();r.hasNext();){var u=r.next();u.eiList.addSplitEdges(e)}},computeEdgeIntersections:function(e,r,u){var g=new An(r,u,!0);g.setBoundaryNodes(this.getBoundaryNodes(),e.getBoundaryNodes());var w=this.createEdgeSetIntersector();return w.computeIntersections(this.edges,e.edges,g),g},getGeometry:function(){return this.parentGeom},getBoundaryNodeRule:function(){return this.boundaryNodeRule},hasTooFewPoints:function(){return this._hasTooFewPoints},addPoint:function(){if(arguments[0]instanceof Fi){var e=arguments[0],r=e.getCoordinate();this.insertPoint(this.argIndex,r,le.INTERIOR)}else if(arguments[0]instanceof ve){var u=arguments[0];this.insertPoint(this.argIndex,u,le.INTERIOR)}},addPolygon:function(e){this.addPolygonRing(e.getExteriorRing(),le.EXTERIOR,le.INTERIOR);for(var r=0;r<e.getNumInteriorRing();r++){var u=e.getInteriorRingN(r);this.addPolygonRing(u,le.INTERIOR,le.EXTERIOR)}},addEdge:function(e){this.insertEdge(e);var r=e.getCoordinates();this.insertPoint(this.argIndex,r[0],le.BOUNDARY),this.insertPoint(this.argIndex,r[r.length-1],le.BOUNDARY)},addLineString:function(e){var r=bn.removeRepeatedPoints(e.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this.invalidPoint=r[0],null;var u=new Cr(r,new Mi(this.argIndex,le.INTERIOR));this.lineEdgeMap.put(e,u),this.insertEdge(u),Pe.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.argIndex,r[0]),this.insertBoundaryPoint(this.argIndex,r[r.length-1])},getInvalidPoint:function(){return this.invalidPoint},getBoundaryPoints:function(){for(var e=this.getBoundaryNodes(),r=new Array(e.size()).fill(null),u=0,g=e.iterator();g.hasNext();){var w=g.next();r[u++]=w.getCoordinate().copy()}return r},getBoundaryNodes:function(){return this.boundaryNodes===null&&(this.boundaryNodes=this.nodes.getBoundaryNodes(this.argIndex)),this.boundaryNodes},addSelfIntersectionNode:function(e,r,u){return this.isBoundaryNode(e,r)?null:void(u===le.BOUNDARY&&this.useBoundaryDeterminationRule?this.insertBoundaryPoint(e,r):this.insertPoint(e,r,u))},addPolygonRing:function(e,r,u){if(e.isEmpty())return null;var g=bn.removeRepeatedPoints(e.getCoordinates());if(g.length<4)return this._hasTooFewPoints=!0,this.invalidPoint=g[0],null;var w=r,O=u;zt.isCCW(g)&&(w=u,O=r);var H=new Cr(g,new Mi(this.argIndex,le.BOUNDARY,w,O));this.lineEdgeMap.put(e,H),this.insertEdge(H),this.insertPoint(this.argIndex,g[0],le.BOUNDARY)},insertPoint:function(e,r,u){var g=this.nodes.addNode(r),w=g.getLabel();w===null?g.label=new Mi(e,u):w.setLocation(e,u)},createEdgeSetIntersector:function(){return new rn},addSelfIntersectionNodes:function(e){for(var r=this.edges.iterator();r.hasNext();)for(var u=r.next(),g=u.getLabel().getLocation(e),w=u.eiList.iterator();w.hasNext();){var O=w.next();this.addSelfIntersectionNode(e,O.coord,g)}},add:function(){if(arguments.length!==1)return Vs.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof Oe&&(this.useBoundaryDeterminationRule=!1),e instanceof ne)this.addPolygon(e);else if(e instanceof Fn)this.addLineString(e);else if(e instanceof Fi)this.addPoint(e);else if(e instanceof oe)this.addCollection(e);else if(e instanceof fr)this.addCollection(e);else if(e instanceof Oe)this.addCollection(e);else{if(!(e instanceof jn))throw new UnsupportedOperationException(e.getClass().getName());this.addCollection(e)}},addCollection:function(e){for(var r=0;r<e.getNumGeometries();r++){var u=e.getGeometryN(r);this.add(u)}},locate:function(e){return kt(this.parentGeom,Ke)&&this.parentGeom.getNumGeometries()>50?(this.areaPtLocator===null&&(this.areaPtLocator=new Nl(this.parentGeom)),this.areaPtLocator.locate(e)):this.ptLocator.locate(e,this.parentGeom)},findEdge:function(){if(arguments.length===1){var e=arguments[0];return this.lineEdgeMap.get(e)}return Vs.prototype.findEdge.apply(this,arguments)},interfaces_:function(){return[]},getClass:function(){return li}}),li.determineBoundary=function(e,r){return e.isInBoundary(r)?le.BOUNDARY:le.INTERIOR},N(Xo.prototype,{getArgGeometry:function(e){return this.arg[e].getGeometry()},setComputationPrecision:function(e){this.resultPrecisionModel=e,this.li.setPrecisionModel(this.resultPrecisionModel)},interfaces_:function(){return[]},getClass:function(){return Xo}}),N(Mt.prototype,{compareTo:function(e){var r=e,u=Mt.compareOriented(this.pts,this._orientation,r.pts,r._orientation);return u},interfaces_:function(){return[a]},getClass:function(){return Mt}}),Mt.orientation=function(e){return bn.increasingDirection(e)===1},Mt.compareOriented=function(e,r,u,g){for(var w=r?1:-1,O=g?1:-1,H=r?e.length:-1,Q=g?u.length:-1,ye=r?0:e.length-1,Ue=g?0:u.length-1;;){var ct=e[ye].compareTo(u[Ue]);if(ct!==0)return ct;ye+=w,Ue+=O;var yt=ye===H,Ft=Ue===Q;if(yt&&!Ft)return-1;if(!yt&&Ft)return 1;if(yt&&Ft)return 0}},N(Hu.prototype,{print:function(e){e.print("MULTILINESTRING ( ");for(var r=0;r<this.edges.size();r++){var u=this.edges.get(r);r>0&&e.print(","),e.print("(");for(var g=u.getCoordinates(),w=0;w<g.length;w++)w>0&&e.print(","),e.print(g[w].x+" "+g[w].y);e.println(")")}e.print(")  ")},addAll:function(e){for(var r=e.iterator();r.hasNext();)this.add(r.next())},findEdgeIndex:function(e){for(var r=0;r<this.edges.size();r++)if(this.edges.get(r).equals(e))return r;return-1},iterator:function(){return this.edges.iterator()},getEdges:function(){return this.edges},get:function(e){return this.edges.get(e)},findEqualEdge:function(e){var r=new Mt(e.getCoordinates()),u=this.ocaMap.get(r);return u},add:function(e){this.edges.add(e);var r=new Mt(e.getCoordinates());this.ocaMap.put(r,e)},interfaces_:function(){return[]},getClass:function(){return Hu}}),Te(fn,Xo),N(fn.prototype,{insertUniqueEdge:function(e){var r=this.edgeList.findEqualEdge(e);if(r!==null){var u=r.getLabel(),g=e.getLabel();r.isPointwiseEqual(e)||(g=new Mi(e.getLabel()),g.flip());var w=r.getDepth();w.isNull()&&w.add(u),w.add(g),u.merge(g)}else this.edgeList.add(e)},getGraph:function(){return this.graph},cancelDuplicateResultEdges:function(){for(var e=this.graph.getEdgeEnds().iterator();e.hasNext();){var r=e.next(),u=r.getSym();r.isInResult()&&u.isInResult()&&(r.setInResult(!1),u.setInResult(!1))}},isCoveredByLA:function(e){return this.isCovered(e,this.resultLineList)?!0:!!this.isCovered(e,this.resultPolyList)},computeGeometry:function(e,r,u,g){var w=new ze;return w.addAll(e),w.addAll(r),w.addAll(u),w.isEmpty()?fn.createEmptyResult(g,this.arg[0].getGeometry(),this.arg[1].getGeometry(),this.geomFact):this.geomFact.buildGeometry(w)},mergeSymLabels:function(){for(var e=this.graph.getNodes().iterator();e.hasNext();){var r=e.next();r.getEdges().mergeSymLabels()}},isCovered:function(e,r){for(var u=r.iterator();u.hasNext();){var g=u.next(),w=this.ptLocator.locate(e,g);if(w!==le.EXTERIOR)return!0}return!1},replaceCollapsedEdges:function(){for(var e=new ze,r=this.edgeList.iterator();r.hasNext();){var u=r.next();u.isCollapsed()&&(r.remove(),e.add(u.getCollapsedEdge()))}this.edgeList.addAll(e)},updateNodeLabelling:function(){for(var e=this.graph.getNodes().iterator();e.hasNext();){var r=e.next(),u=r.getEdges().getLabel();r.getLabel().merge(u)}},getResultGeometry:function(e){return this.computeOverlay(e),this.resultGeom},insertUniqueEdges:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();this.insertUniqueEdge(u)}},computeOverlay:function(e){this.copyPoints(0),this.copyPoints(1),this.arg[0].computeSelfNodes(this.li,!1),this.arg[1].computeSelfNodes(this.li,!1),this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!0);var r=new ze;this.arg[0].computeSplitEdges(r),this.arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Sr.checkValid(this.edgeList.getEdges()),this.graph.addEdges(this.edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(e),this.cancelDuplicateResultEdges();var u=new ju(this.geomFact);u.add(this.graph),this.resultPolyList=u.getPolygons();var g=new Xa(this,this.geomFact,this.ptLocator);this.resultLineList=g.build(e);var w=new Ya(this,this.geomFact,this.ptLocator);this.resultPointList=w.build(e),this.resultGeom=this.computeGeometry(this.resultPointList,this.resultLineList,this.resultPolyList,e)},labelIncompleteNode:function(e,r){var u=this.ptLocator.locate(e.getCoordinate(),this.arg[r].getGeometry());e.getLabel().setLocation(r,u)},copyPoints:function(e){for(var r=this.arg[e].getNodeIterator();r.hasNext();){var u=r.next(),g=this.graph.addNode(u.getCoordinate());g.setLabel(e,u.getLabel().getLocation(e))}},findResultAreaEdges:function(e){for(var r=this.graph.getEdgeEnds().iterator();r.hasNext();){var u=r.next(),g=u.getLabel();g.isArea()&&!u.isInteriorAreaEdge()&&fn.isResultOfOp(g.getLocation(0,At.RIGHT),g.getLocation(1,At.RIGHT),e)&&u.setInResult(!0)}},computeLabelsFromDepths:function(){for(var e=this.edgeList.iterator();e.hasNext();){var r=e.next(),u=r.getLabel(),g=r.getDepth();if(!g.isNull()){g.normalize();for(var w=0;2>w;w++)u.isNull(w)||!u.isArea()||g.isNull(w)||(g.getDelta(w)===0?u.toLine(w):(Pe.isTrue(!g.isNull(w,At.LEFT),"depth of LEFT side has not been initialized"),u.setLocation(w,At.LEFT,g.getLocation(w,At.LEFT)),Pe.isTrue(!g.isNull(w,At.RIGHT),"depth of RIGHT side has not been initialized"),u.setLocation(w,At.RIGHT,g.getLocation(w,At.RIGHT))))}}},computeLabelling:function(){for(var e=this.graph.getNodes().iterator();e.hasNext();){var r=e.next();r.getEdges().computeLabelling(this.arg)}this.mergeSymLabels(),this.updateNodeLabelling()},labelIncompleteNodes:function(){for(var e=0,r=this.graph.getNodes().iterator();r.hasNext();){var u=r.next(),g=u.getLabel();u.isIsolated()&&(e++,g.isNull(0)?this.labelIncompleteNode(u,0):this.labelIncompleteNode(u,1)),u.getEdges().updateLabelling(g)}},isCoveredByA:function(e){return!!this.isCovered(e,this.resultPolyList)},interfaces_:function(){return[]},getClass:function(){return fn}}),fn.overlayOp=function(e,r,u){var g=new fn(e,r),w=g.getResultGeometry(u);return w},fn.intersection=function(e,r){if(e.isEmpty()||r.isEmpty())return fn.createEmptyResult(fn.INTERSECTION,e,r,e.getFactory());if(e.isGeometryCollection()){var u=r;return vs.map(e,{interfaces_:function(){return[MapOp]},map:function(g){return g.intersection(u)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(r),or.overlayOp(e,r,fn.INTERSECTION)},fn.symDifference=function(e,r){if(e.isEmpty()||r.isEmpty()){if(e.isEmpty()&&r.isEmpty())return fn.createEmptyResult(fn.SYMDIFFERENCE,e,r,e.getFactory());if(e.isEmpty())return r.copy();if(r.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(r),or.overlayOp(e,r,fn.SYMDIFFERENCE)},fn.resultDimension=function(e,r,u){var g=r.getDimension(),w=u.getDimension(),O=-1;switch(e){case fn.INTERSECTION:O=Math.min(g,w);break;case fn.UNION:O=Math.max(g,w);break;case fn.DIFFERENCE:O=g;break;case fn.SYMDIFFERENCE:O=Math.max(g,w)}return O},fn.createEmptyResult=function(e,r,u,g){var w=null;switch(fn.resultDimension(e,r,u)){case-1:w=g.createGeometryCollection(new Array(0).fill(null));break;case 0:w=g.createPoint();break;case 1:w=g.createLineString();break;case 2:w=g.createPolygon()}return w},fn.difference=function(e,r){return e.isEmpty()?fn.createEmptyResult(fn.DIFFERENCE,e,r,e.getFactory()):r.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(r),or.overlayOp(e,r,fn.DIFFERENCE))},fn.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],u=e.getLocation(0),g=e.getLocation(1);return fn.isResultOfOp(u,g,r)}if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2];switch(w===le.BOUNDARY&&(w=le.INTERIOR),O===le.BOUNDARY&&(O=le.INTERIOR),H){case fn.INTERSECTION:return w===le.INTERIOR&&O===le.INTERIOR;case fn.UNION:return w===le.INTERIOR||O===le.INTERIOR;case fn.DIFFERENCE:return w===le.INTERIOR&&O!==le.INTERIOR;case fn.SYMDIFFERENCE:return w===le.INTERIOR&&O!==le.INTERIOR||w!==le.INTERIOR&&O===le.INTERIOR}return!1}},fn.INTERSECTION=1,fn.UNION=2,fn.DIFFERENCE=3,fn.SYMDIFFERENCE=4,N(bs.prototype,{selfSnap:function(e){var r=new us(e),u=r.snapTo(e,this.snapTolerance);return u},removeCommonBits:function(e){this.cbr=new ma,this.cbr.add(e[0]),this.cbr.add(e[1]);var r=new Array(2).fill(null);return r[0]=this.cbr.removeCommonBits(e[0].copy()),r[1]=this.cbr.removeCommonBits(e[1].copy()),r},prepareResult:function(e){return this.cbr.addCommonBits(e),e},getResultGeometry:function(e){var r=this.snap(this.geom),u=fn.overlayOp(r[0],r[1],e);return this.prepareResult(u)},checkValid:function(e){e.isValid()||xi.out.println("Snapped geometry is invalid")},computeSnapTolerance:function(){this.snapTolerance=us.computeOverlaySnapTolerance(this.geom[0],this.geom[1])},snap:function(e){var r=this.removeCommonBits(e),u=us.snap(r[0],r[1],this.snapTolerance);return u},interfaces_:function(){return[]},getClass:function(){return bs}}),bs.overlayOp=function(e,r,u){var g=new bs(e,r);return g.getResultGeometry(u)},bs.union=function(e,r){return bs.overlayOp(e,r,fn.UNION)},bs.intersection=function(e,r){return bs.overlayOp(e,r,fn.INTERSECTION)},bs.symDifference=function(e,r){return bs.overlayOp(e,r,fn.SYMDIFFERENCE)},bs.difference=function(e,r){return bs.overlayOp(e,r,fn.DIFFERENCE)},N(or.prototype,{getResultGeometry:function(e){var r=null,u=!1,g=null;try{r=fn.overlayOp(this.geom[0],this.geom[1],e);var w=!0;w&&(u=!0)}catch(O){if(!(O instanceof Se))throw O;g=O}finally{}if(!u)try{r=bs.overlayOp(this.geom[0],this.geom[1],e)}catch(O){throw O instanceof Se?g:O}finally{}return r},interfaces_:function(){return[]},getClass:function(){return or}}),or.overlayOp=function(e,r,u){var g=new or(e,r);return g.getResultGeometry(u)},or.union=function(e,r){return or.overlayOp(e,r,fn.UNION)},or.intersection=function(e,r){return or.overlayOp(e,r,fn.INTERSECTION)},or.symDifference=function(e,r){return or.overlayOp(e,r,fn.SYMDIFFERENCE)},or.difference=function(e,r){return or.overlayOp(e,r,fn.DIFFERENCE)},N(Ls.prototype,{addPolygon:function(e){if(e.isEmpty())return null;var r=null,u=0,g=this.horizontalBisector(e);if(g.getLength()===0)u=0,r=g.getCoordinate();else{var w=or.overlayOp(g,e,fn.INTERSECTION),O=this.widestGeometry(w);u=O.getEnvelopeInternal().getWidth(),r=Ls.centre(O.getEnvelopeInternal())}(this.interiorPoint===null||u>this.maxWidth)&&(this.interiorPoint=r,this.maxWidth=u)},getInteriorPoint:function(){return this.interiorPoint},widestGeometry:function(){if(arguments[0]instanceof jn){var r=arguments[0];if(r.isEmpty())return r;for(var u=r.getGeometryN(0),g=1;g<r.getNumGeometries();g++)r.getGeometryN(g).getEnvelopeInternal().getWidth()>u.getEnvelopeInternal().getWidth()&&(u=r.getGeometryN(g));return u}if(arguments[0]instanceof Jt){var w=arguments[0];return w instanceof jn?this.widestGeometry(w):w}},horizontalBisector:function(e){var r=e.getEnvelopeInternal(),u=Us.getBisectorY(e);return this.factory.createLineString([new ve(r.getMinX(),u),new ve(r.getMaxX(),u)])},add:function(e){if(e instanceof ne)this.addPolygon(e);else if(e instanceof jn)for(var r=e,u=0;u<r.getNumGeometries();u++)this.add(r.getGeometryN(u))},interfaces_:function(){return[]},getClass:function(){return Ls}}),Ls.centre=function(e){return new ve(Ls.avg(e.getMinX(),e.getMaxX()),Ls.avg(e.getMinY(),e.getMaxY()))},Ls.avg=function(e,r){return(e+r)/2},N(Us.prototype,{updateInterval:function(e){e<=this.centreY?e>this.loY&&(this.loY=e):e>this.centreY&&e<this.hiY&&(this.hiY=e)},getBisectorY:function(){this.process(this.poly.getExteriorRing());for(var e=0;e<this.poly.getNumInteriorRing();e++)this.process(this.poly.getInteriorRingN(e));var r=Ls.avg(this.hiY,this.loY);return r},process:function(e){for(var r=e.getCoordinateSequence(),u=0;u<r.size();u++){var g=r.getY(u);this.updateInterval(g)}},interfaces_:function(){return[]},getClass:function(){return Us}}),Us.getBisectorY=function(e){var r=new Us(e);return r.getBisectorY()},Ls.SafeBisectorFinder=Us,N(mu.prototype,{addEndpoints:function(){if(arguments[0]instanceof Jt){var e=arguments[0];if(e instanceof Fn)this.addEndpoints(e.getCoordinates());else if(e instanceof jn)for(var r=e,u=0;u<r.getNumGeometries();u++)this.addEndpoints(r.getGeometryN(u))}else if(arguments[0]instanceof Array){var g=arguments[0];this.add(g[0]),this.add(g[g.length-1])}},getInteriorPoint:function(){return this.interiorPoint},addInterior:function(){if(arguments[0]instanceof Jt){var e=arguments[0];if(e instanceof Fn)this.addInterior(e.getCoordinates());else if(e instanceof jn)for(var r=e,u=0;u<r.getNumGeometries();u++)this.addInterior(r.getGeometryN(u))}else if(arguments[0]instanceof Array)for(var g=arguments[0],u=1;u<g.length-1;u++)this.add(g[u])},add:function(e){var r=e.distance(this.centroid);r<this.minDistance&&(this.interiorPoint=new ve(e),this.minDistance=r)},interfaces_:function(){return[]},getClass:function(){return mu}}),N(ws.prototype,{getInteriorPoint:function(){return this.interiorPoint},add:function(){if(arguments[0]instanceof Jt){var e=arguments[0];if(e instanceof Fi)this.add(e.getCoordinate());else if(e instanceof jn)for(var r=e,u=0;u<r.getNumGeometries();u++)this.add(r.getGeometryN(u))}else if(arguments[0]instanceof ve){var g=arguments[0],w=g.distance(this.centroid);w<this.minDistance&&(this.interiorPoint=new ve(g),this.minDistance=w)}},interfaces_:function(){return[]},getClass:function(){return ws}}),N(On.prototype,{interfaces_:function(){return[]},getClass:function(){return On}}),On.toDegrees=function(e){return 180*e/Math.PI},On.normalize=function(e){for(;e>Math.PI;)e-=On.PI_TIMES_2;for(;e<=-Math.PI;)e+=On.PI_TIMES_2;return e},On.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}if(arguments.length===2){var r=arguments[0],u=arguments[1],g=u.x-r.x,w=u.y-r.y;return Math.atan2(w,g)}},On.isAcute=function(e,r,u){var g=e.x-r.x,w=e.y-r.y,O=u.x-r.x,H=u.y-r.y,Q=g*O+w*H;return Q>0},On.isObtuse=function(e,r,u){var g=e.x-r.x,w=e.y-r.y,O=u.x-r.x,H=u.y-r.y,Q=g*O+w*H;return 0>Q},On.interiorAngle=function(e,r,u){var g=On.angle(r,e),w=On.angle(r,u);return Math.abs(w-g)},On.normalizePositive=function(e){if(0>e){for(;0>e;)e+=On.PI_TIMES_2;e>=On.PI_TIMES_2&&(e=0)}else{for(;e>=On.PI_TIMES_2;)e-=On.PI_TIMES_2;0>e&&(e=0)}return e},On.angleBetween=function(e,r,u){var g=On.angle(r,e),w=On.angle(r,u);return On.diff(g,w)},On.diff=function(e,r){var u=null;return u=r>e?r-e:e-r,u>Math.PI&&(u=2*Math.PI-u),u},On.toRadians=function(e){return e*Math.PI/180},On.getTurn=function(e,r){var u=Math.sin(r-e);return u>0?On.COUNTERCLOCKWISE:0>u?On.CLOCKWISE:On.NONE},On.angleBetweenOriented=function(e,r,u){var g=On.angle(r,e),w=On.angle(r,u),O=w-g;return O<=-Math.PI?O+On.PI_TIMES_2:O>Math.PI?O-On.PI_TIMES_2:O},On.PI_TIMES_2=2*Math.PI,On.PI_OVER_2=Math.PI/2,On.PI_OVER_4=Math.PI/4,On.COUNTERCLOCKWISE=zt.COUNTERCLOCKWISE,On.CLOCKWISE=zt.CLOCKWISE,On.NONE=zt.COLLINEAR,N(Ii.prototype,{area:function(){return Ii.area(this.p0,this.p1,this.p2)},signedArea:function(){return Ii.signedArea(this.p0,this.p1,this.p2)},interpolateZ:function(e){if(e===null)throw new X;return Ii.interpolateZ(e,this.p0,this.p1,this.p2)},longestSideLength:function(){return Ii.longestSideLength(this.p0,this.p1,this.p2)},isAcute:function(){return Ii.isAcute(this.p0,this.p1,this.p2)},circumcentre:function(){return Ii.circumcentre(this.p0,this.p1,this.p2)},area3D:function(){return Ii.area3D(this.p0,this.p1,this.p2)},centroid:function(){return Ii.centroid(this.p0,this.p1,this.p2)},inCentre:function(){return Ii.inCentre(this.p0,this.p1,this.p2)},interfaces_:function(){return[]},getClass:function(){return Ii}}),Ii.area=function(e,r,u){return Math.abs(((u.x-e.x)*(r.y-e.y)-(r.x-e.x)*(u.y-e.y))/2)},Ii.signedArea=function(e,r,u){return((u.x-e.x)*(r.y-e.y)-(r.x-e.x)*(u.y-e.y))/2},Ii.det=function(e,r,u,g){return e*g-r*u},Ii.interpolateZ=function(e,r,u,g){var w=r.x,O=r.y,H=u.x-w,Q=g.x-w,ye=u.y-O,Ue=g.y-O,ct=H*Ue-Q*ye,yt=e.x-w,Ft=e.y-O,sn=(Ue*yt-Q*Ft)/ct,Tn=(-ye*yt+H*Ft)/ct,Pn=r.z+sn*(u.z-r.z)+Tn*(g.z-r.z);return Pn},Ii.longestSideLength=function(e,r,u){var g=e.distance(r),w=r.distance(u),O=u.distance(e),H=g;return w>H&&(H=w),O>H&&(H=O),H},Ii.isAcute=function(e,r,u){return On.isAcute(e,r,u)&&On.isAcute(r,u,e)?!!On.isAcute(u,e,r):!1},Ii.circumcentre=function(e,r,u){var g=u.x,w=u.y,O=e.x-g,H=e.y-w,Q=r.x-g,ye=r.y-w,Ue=2*Ii.det(O,H,Q,ye),ct=Ii.det(H,O*O+H*H,ye,Q*Q+ye*ye),yt=Ii.det(O,O*O+H*H,Q,Q*Q+ye*ye),Ft=g-ct/Ue,sn=w+yt/Ue;return new ve(Ft,sn)},Ii.perpendicularBisector=function(e,r){var u=r.x-e.x,g=r.y-e.y,w=new hr(e.x+u/2,e.y+g/2,1),O=new hr(e.x-g+u/2,e.y+u+g/2,1);return new hr(w,O)},Ii.angleBisector=function(e,r,u){var g=r.distance(e),w=r.distance(u),O=g/(g+w),H=u.x-e.x,Q=u.y-e.y,ye=new ve(e.x+O*H,e.y+O*Q);return ye},Ii.area3D=function(e,r,u){var g=r.x-e.x,w=r.y-e.y,O=r.z-e.z,H=u.x-e.x,Q=u.y-e.y,ye=u.z-e.z,Ue=w*ye-O*Q,ct=O*H-g*ye,yt=g*Q-w*H,Ft=Ue*Ue+ct*ct+yt*yt,sn=Math.sqrt(Ft)/2;return sn},Ii.centroid=function(e,r,u){var g=(e.x+r.x+u.x)/3,w=(e.y+r.y+u.y)/3;return new ve(g,w)},Ii.inCentre=function(e,r,u){var g=r.distance(u),w=e.distance(u),O=e.distance(r),H=g+w+O,Q=(g*e.x+w*r.x+O*u.x)/H,ye=(g*e.y+w*r.y+O*u.y)/H;return new ve(Q,ye)},N(Yo.prototype,{getRadius:function(){return this.compute(),this.radius},getDiameter:function(){switch(this.compute(),this.extremalPts.length){case 0:return this.input.getFactory().createLineString();case 1:return this.input.getFactory().createPoint(this.centre)}var e=this.extremalPts[0],r=this.extremalPts[1];return this.input.getFactory().createLineString([e,r])},getExtremalPoints:function(){return this.compute(),this.extremalPts},computeCirclePoints:function(){if(this.input.isEmpty())return this.extremalPts=new Array(0).fill(null),null;if(this.input.getNumPoints()===1){var u=this.input.getCoordinates();return this.extremalPts=[new ve(u[0])],null}var e=this.input.convexHull(),r=e.getCoordinates(),u=r;if(r[0].equals2D(r[r.length-1])&&(u=new Array(r.length-1).fill(null),bn.copyDeep(r,0,u,0,r.length-1)),u.length<=2)return this.extremalPts=bn.copyDeep(u),null;for(var g=Yo.lowestPoint(u),w=Yo.pointWitMinAngleWithX(u,g),O=0;O<u.length;O++){var H=Yo.pointWithMinAngleWithSegment(u,g,w);if(On.isObtuse(g,H,w))return this.extremalPts=[new ve(g),new ve(w)],null;if(On.isObtuse(H,g,w))g=H;else{if(!On.isObtuse(H,w,g))return this.extremalPts=[new ve(g),new ve(w),new ve(H)],null;w=H}}Pe.shouldNeverReachHere("Logic failure in Minimum Bounding Circle algorithm!")},compute:function(){return this.extremalPts!==null?null:(this.computeCirclePoints(),this.computeCentre(),void(this.centre!==null&&(this.radius=this.centre.distance(this.extremalPts[0]))))},getFarthestPoints:function(){switch(this.compute(),this.extremalPts.length){case 0:return this.input.getFactory().createLineString();case 1:return this.input.getFactory().createPoint(this.centre)}var e=this.extremalPts[0],r=this.extremalPts[this.extremalPts.length-1];return this.input.getFactory().createLineString([e,r])},getCircle:function(){if(this.compute(),this.centre===null)return this.input.getFactory().createPolygon();var e=this.input.getFactory().createPoint(this.centre);return this.radius===0?e:e.buffer(this.radius)},getCentre:function(){return this.compute(),this.centre},computeCentre:function(){switch(this.extremalPts.length){case 0:this.centre=null;break;case 1:this.centre=this.extremalPts[0];break;case 2:this.centre=new ve((this.extremalPts[0].x+this.extremalPts[1].x)/2,(this.extremalPts[0].y+this.extremalPts[1].y)/2);break;case 3:this.centre=Ii.circumcentre(this.extremalPts[0],this.extremalPts[1],this.extremalPts[2])}},interfaces_:function(){return[]},getClass:function(){return Yo}}),Yo.pointWitMinAngleWithX=function(e,r){for(var u=te.MAX_VALUE,g=null,w=0;w<e.length;w++){var O=e[w];if(O!==r){var H=O.x-r.x,Q=O.y-r.y;0>Q&&(Q=-Q);var ye=Math.sqrt(H*H+Q*Q),Ue=Q/ye;u>Ue&&(u=Ue,g=O)}}return g},Yo.lowestPoint=function(e){for(var r=e[0],u=1;u<e.length;u++)e[u].y<r.y&&(r=e[u]);return r},Yo.pointWithMinAngleWithSegment=function(e,r,u){for(var g=te.MAX_VALUE,w=null,O=0;O<e.length;O++){var H=e[O];if(H!==r&&H!==u){var Q=On.angleBetween(r,H,u);g>Q&&(g=Q,w=H)}}return w},N(Zr.prototype,{getWidthCoordinate:function(){return this.computeMinimumDiameter(),this.minWidthPt},getSupportingSegment:function(){return this.computeMinimumDiameter(),this.inputGeom.getFactory().createLineString([this.minBaseSeg.p0,this.minBaseSeg.p1])},getDiameter:function(){if(this.computeMinimumDiameter(),this.minWidthPt===null)return this.inputGeom.getFactory().createLineString(null);var e=this.minBaseSeg.project(this.minWidthPt);return this.inputGeom.getFactory().createLineString([e,this.minWidthPt])},computeWidthConvex:function(e){e instanceof ne?this.convexHullPts=e.getExteriorRing().getCoordinates():this.convexHullPts=e.getCoordinates(),this.convexHullPts.length===0?(this.minWidth=0,this.minWidthPt=null,this.minBaseSeg=null):this.convexHullPts.length===1?(this.minWidth=0,this.minWidthPt=this.convexHullPts[0],this.minBaseSeg.p0=this.convexHullPts[0],this.minBaseSeg.p1=this.convexHullPts[0]):this.convexHullPts.length===2||this.convexHullPts.length===3?(this.minWidth=0,this.minWidthPt=this.convexHullPts[0],this.minBaseSeg.p0=this.convexHullPts[0],this.minBaseSeg.p1=this.convexHullPts[1]):this.computeConvexRingMinDiameter(this.convexHullPts)},computeConvexRingMinDiameter:function(e){this.minWidth=te.MAX_VALUE;for(var r=1,u=new Sn,g=0;g<e.length-1;g++)u.p0=e[g],u.p1=e[g+1],r=this.findMaxPerpDistance(e,u,r)},computeMinimumDiameter:function(){if(this.minWidthPt!==null)return null;if(this.isConvex)this.computeWidthConvex(this.inputGeom);else{var e=new ao(this.inputGeom).getConvexHull();this.computeWidthConvex(e)}},getLength:function(){return this.computeMinimumDiameter(),this.minWidth},findMaxPerpDistance:function(e,r,u){for(var g=r.distancePerpendicular(e[u]),w=g,O=u,H=O;w>=g;)g=w,O=H,H=Zr.nextIndex(e,O),w=r.distancePerpendicular(e[H]);return g<this.minWidth&&(this.minPtIndex=O,this.minWidth=g,this.minWidthPt=e[this.minPtIndex],this.minBaseSeg=new Sn(r)),O},getMinimumRectangle:function(){if(this.computeMinimumDiameter(),this.minWidth===0)return this.minBaseSeg.p0.equals2D(this.minBaseSeg.p1)?this.inputGeom.getFactory().createPoint(this.minBaseSeg.p0):this.minBaseSeg.toGeometry(this.inputGeom.getFactory());for(var e=this.minBaseSeg.p1.x-this.minBaseSeg.p0.x,r=this.minBaseSeg.p1.y-this.minBaseSeg.p0.y,u=te.MAX_VALUE,g=-te.MAX_VALUE,w=te.MAX_VALUE,O=-te.MAX_VALUE,H=0;H<this.convexHullPts.length;H++){var Q=Zr.computeC(e,r,this.convexHullPts[H]);Q>g&&(g=Q),u>Q&&(u=Q);var ye=Zr.computeC(-r,e,this.convexHullPts[H]);ye>O&&(O=ye),w>ye&&(w=ye)}var Ue=Zr.computeSegmentForLine(-e,-r,O),ct=Zr.computeSegmentForLine(-e,-r,w),yt=Zr.computeSegmentForLine(-r,e,g),Ft=Zr.computeSegmentForLine(-r,e,u),sn=yt.lineIntersection(Ue),Tn=Ft.lineIntersection(Ue),Pn=Ft.lineIntersection(ct),Ai=yt.lineIntersection(ct),er=this.inputGeom.getFactory().createLinearRing([sn,Tn,Pn,Ai,sn]);return this.inputGeom.getFactory().createPolygon(er,null)},interfaces_:function(){return[]},getClass:function(){return Zr}}),Zr.nextIndex=function(e,r){return r++,r>=e.length&&(r=0),r},Zr.computeC=function(e,r,u){return e*u.y-r*u.x},Zr.getMinimumDiameter=function(e){return new Zr(e).getDiameter()},Zr.getMinimumRectangle=function(e){return new Zr(e).getMinimumRectangle()},Zr.computeSegmentForLine=function(e,r,u){var g=null,w=null;return Math.abs(r)>Math.abs(e)?(g=new ve(0,u/r),w=new ve(1,u/r-e/r)):(g=new ve(u/e,0),w=new ve(u/e-r/e,1)),new Sn(g,w)};var Wl=Object.freeze({Centroid:mr,CGAlgorithms:zt,ConvexHull:ao,InteriorPointArea:Ls,InteriorPointLine:mu,InteriorPointPoint:ws,RobustLineIntersector:pr,MinimumBoundingCircle:Yo,MinimumDiameter:Zr});N(kr.prototype,{getResultGeometry:function(){return new gu(this.distanceTolerance).transform(this.inputGeom)},setDistanceTolerance:function(e){if(0>=e)throw new X;this.distanceTolerance=e},interfaces_:function(){return[]},getClass:function(){return kr}}),kr.densifyPoints=function(e,r,u){for(var g=new Sn,w=new ft,O=0;O<e.length-1;O++){g.p0=e[O],g.p1=e[O+1],w.add(g.p0,!1);var H=g.getLength(),Q=Math.trunc(H/r)+1;if(Q>1)for(var ye=H/Q,Ue=1;Q>Ue;Ue++){var ct=Ue*ye/H,yt=g.pointAlong(ct);u.makePrecise(yt),w.add(yt,!1)}}return w.add(e[e.length-1],!1),w.toCoordinateArray()},kr.densify=function(e,r){var u=new kr(e);return u.setDistanceTolerance(r),u.getResultGeometry()},Te(gu,qr),N(gu.prototype,{transformMultiPolygon:function(e,r){var u=qr.prototype.transformMultiPolygon.call(this,e,r);return this.createValidArea(u)},transformPolygon:function(e,r){var u=qr.prototype.transformPolygon.call(this,e,r);return r instanceof Oe?u:this.createValidArea(u)},transformCoordinates:function(e,r){var u=e.toCoordinateArray(),g=kr.densifyPoints(u,this.distanceTolerance,r.getPrecisionModel());return r instanceof Fn&&g.length===1&&(g=new Array(0).fill(null)),this.factory.getCoordinateSequenceFactory().create(g)},createValidArea:function(e){return e.buffer(0)},interfaces_:function(){return[]},getClass:function(){return gu}}),kr.DensifyTransformer=gu;var fc=Object.freeze({Densifier:kr});N(co.prototype,{find:function(e){var r=this;do{if(r===null)return null;if(r.dest().equals2D(e))return r;r=r.oNext()}while(r!==this);return null},dest:function(){return this._sym._orig},oNext:function(){return this._sym._next},insert:function(e){if(this.oNext()===this)return this.insertAfter(e),null;var r=this.compareTo(e),u=this;do{var g=u.oNext(),w=g.compareTo(e);if(w!==r||g===this)return u.insertAfter(e),null;u=g}while(u!==this);Pe.shouldNeverReachHere()},insertAfter:function(e){Pe.equals(this._orig,e.orig());var r=this.oNext();this._sym.setNext(e),e.sym().setNext(r)},degree:function(){var r=0,u=this;do r++,u=u.oNext();while(u!==this);return r},equals:function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return this._orig.equals2D(e)&&this._sym._orig.equals(r)}},deltaY:function(){return this._sym._orig.y-this._orig.y},sym:function(){return this._sym},prev:function(){return this._sym.next()._sym},compareAngularDirection:function(e){var r=this.deltaX(),u=this.deltaY(),g=e.deltaX(),w=e.deltaY();if(r===g&&u===w)return 0;var O=Qn.quadrant(r,u),H=Qn.quadrant(g,w);return O>H?1:H>O?-1:zt.computeOrientation(e._orig,e.dest(),this.dest())},prevNode:function(){for(var e=this;e.degree()===2;)if(e=e.prev(),e===this)return null;return e},compareTo:function(e){var r=e,u=this.compareAngularDirection(r);return u},next:function(){return this._next},setSym:function(e){this._sym=e},orig:function(){return this._orig},toString:function(){return"HE("+this._orig.x+" "+this._orig.y+", "+this._sym._orig.x+" "+this._sym._orig.y+")"},setNext:function(e){this._next=e},init:function(e){this.setSym(e),e.setSym(this),this.setNext(e),e.setNext(this)},deltaX:function(){return this._sym._orig.x-this._orig.x},interfaces_:function(){return[]},getClass:function(){return co}}),co.init=function(e,r){if(e._sym!==null||r._sym!==null||e._next!==null||r._next!==null)throw new IllegalStateException("Edges are already initialized");return e.init(r),e},co.create=function(e,r){var u=new co(e),g=new co(r);return u.init(g),u},Te(ds,co),N(ds.prototype,{mark:function(){this._isMarked=!0},setMark:function(e){this._isMarked=e},isMarked:function(){return this._isMarked},interfaces_:function(){return[]},getClass:function(){return ds}}),ds.setMarkBoth=function(e,r){e.setMark(r),e.sym().setMark(r)},ds.isMarked=function(e){return e.isMarked()},ds.setMark=function(e,r){e.setMark(r)},ds.markBoth=function(e){e.mark(),e.sym().mark()},ds.mark=function(e){e.mark()},N(xa.prototype,{insert:function(e,r,u){var g=this.create(e,r);u!==null?u.insert(g):this.vertexMap.put(e,g);var w=this.vertexMap.get(r);return w!==null?w.insert(g.sym()):this.vertexMap.put(r,g.sym()),g},create:function(e,r){var u=this.createEdge(e),g=this.createEdge(r);return co.init(u,g),u},createEdge:function(e){return new co(e)},addEdge:function(e,r){if(!xa.isValidEdge(e,r))return null;var u=this.vertexMap.get(e),g=null;if(u!==null&&(g=u.find(r)),g!==null)return g;var w=this.insert(e,r,u);return w},getVertexEdges:function(){return this.vertexMap.values()},findEdge:function(e,r){var u=this.vertexMap.get(e);return u===null?null:u.find(r)},interfaces_:function(){return[]},getClass:function(){return xa}}),xa.isValidEdge=function(e,r){var u=r.compareTo(e);return u!==0},Te(Zu,ds),N(Zu.prototype,{setStart:function(){this._isStart=!0},isStart:function(){return this._isStart},interfaces_:function(){return[]},getClass:function(){return Zu}}),Te(Wu,xa),N(Wu.prototype,{createEdge:function(e){return new Zu(e)},interfaces_:function(){return[]},getClass:function(){return Wu}}),N(_u.prototype,{addLine:function(e){this.lines.add(this.factory.createLineString(e.toCoordinateArray()))},updateRingStartEdge:function(e){return e.isStart()||(e=e.sym(),e.isStart())?this.ringStartEdge===null?(this.ringStartEdge=e,null):void(e.orig().compareTo(this.ringStartEdge.orig())<0&&(this.ringStartEdge=e)):null},getResult:function(){return this.result===null&&this.computeResult(),this.result},process:function(e){var r=e.prevNode();r===null&&(r=e),this.stackEdges(r),this.buildLines()},buildRing:function(e){var r=new ft,u=e;for(r.add(u.orig().copy(),!1);u.sym().degree()===2;){var g=u.next();if(g===e)break;r.add(g.orig().copy(),!1),u=g}r.add(u.dest().copy(),!1),this.addLine(r)},buildLine:function(e){var r=new ft,u=e;for(this.ringStartEdge=null,ds.markBoth(u),r.add(u.orig().copy(),!1);u.sym().degree()===2;){this.updateRingStartEdge(u);var g=u.next();if(g===e)return this.buildRing(this.ringStartEdge),null;r.add(g.orig().copy(),!1),u=g,ds.markBoth(u)}r.add(u.dest().copy(),!1),this.stackEdges(u.sym()),this.addLine(r)},stackEdges:function(e){var r=e;do ds.isMarked(r)||this.nodeEdgeStack.add(r),r=r.oNext();while(r!==e)},computeResult:function(){for(var e=this.graph.getVertexEdges(),r=e.iterator();r.hasNext();){var u=r.next();ds.isMarked(u)||this.process(u)}this.result=this.factory.buildGeometry(this.lines)},buildLines:function(){for(;!this.nodeEdgeStack.empty();){var e=this.nodeEdgeStack.pop();ds.isMarked(e)||this.buildLine(e)}},add:function(){if(arguments[0]instanceof Jt){var e=arguments[0];e.apply({interfaces_:function(){return[es]},filter:function(ye){ye instanceof Fn&&this.add(ye)}})}else if(kt(arguments[0],Bt))for(var r=arguments[0],u=r.iterator();u.hasNext();){var g=u.next();this.add(g)}else if(arguments[0]instanceof Fn){var w=arguments[0];this.factory===null&&(this.factory=w.getFactory());for(var O=w.getCoordinateSequence(),H=!1,u=1;u<O.size();u++){var Q=this.graph.addEdge(O.getCoordinate(u-1),O.getCoordinate(u));Q!==null&&(H||(Q.setStart(),H=!0))}}},interfaces_:function(){return[]},getClass:function(){return _u}}),_u.dissolve=function(e){var r=new _u;return r.add(e),r.getResult()};var Fc=Object.freeze({LineDissolver:_u});N(ho.prototype,{hasChildren:function(){for(var e=0;4>e;e++)if(this.subnode[e]!==null)return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(e){e.addAll(this.items);for(var r=0;4>r;r++)this.subnode[r]!==null&&this.subnode[r].addAllItems(e);return e},getNodeCount:function(){for(var e=0,r=0;4>r;r++)this.subnode[r]!==null&&(e+=this.subnode[r].size());return e+1},size:function(){for(var e=0,r=0;4>r;r++)this.subnode[r]!==null&&(e+=this.subnode[r].size());return e+this.items.size()},addAllItemsFromOverlapping:function(e,r){if(!this.isSearchMatch(e))return null;r.addAll(this.items);for(var u=0;4>u;u++)this.subnode[u]!==null&&this.subnode[u].addAllItemsFromOverlapping(e,r)},visitItems:function(e,r){for(var u=this.items.iterator();u.hasNext();)r.visitItem(u.next())},hasItems:function(){return!this.items.isEmpty()},remove:function(e,r){if(!this.isSearchMatch(e))return!1;for(var u=!1,g=0;4>g;g++)if(this.subnode[g]!==null&&(u=this.subnode[g].remove(e,r))){this.subnode[g].isPrunable()&&(this.subnode[g]=null);break}return u||(u=this.items.remove(r))},visit:function(e,r){if(!this.isSearchMatch(e))return null;this.visitItems(e,r);for(var u=0;4>u;u++)this.subnode[u]!==null&&this.subnode[u].visit(e,r)},getItems:function(){return this.items},depth:function(){for(var e=0,r=0;4>r;r++)if(this.subnode[r]!==null){var u=this.subnode[r].depth();u>e&&(e=u)}return e+1},isEmpty:function(){var r=!0;this.items.isEmpty()||(r=!1);for(var u=0;4>u;u++)this.subnode[u]!==null&&(this.subnode[u].isEmpty()||(r=!1));return r},add:function(e){this.items.add(e)},interfaces_:function(){return[xe]},getClass:function(){return ho}}),ho.getSubnodeIndex=function(e,r,u){var g=-1;return e.getMinX()>=r&&(e.getMinY()>=u&&(g=3),e.getMaxY()<=u&&(g=1)),e.getMaxX()<=r&&(e.getMinY()>=u&&(g=2),e.getMaxY()<=u&&(g=0)),g},ba.exponent=function(e){return Rh(64,e)-1023},ba.powerOf2=function(e){return Math.pow(2,e)},N(wa.prototype,{getLevel:function(){return this.level},computeKey:function(){if(arguments.length===1){var e=arguments[0];for(this.level=wa.computeQuadLevel(e),this.env=new et,this.computeKey(this.level,e);!this.env.contains(e);)this.level+=1,this.computeKey(this.level,e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1],g=ba.powerOf2(r);this.pt.x=Math.floor(u.getMinX()/g)*g,this.pt.y=Math.floor(u.getMinY()/g)*g,this.env.init(this.pt.x,this.pt.x+g,this.pt.y,this.pt.y+g)}},getEnvelope:function(){return this.env},getCentre:function(){return new ve((this.env.getMinX()+this.env.getMaxX())/2,(this.env.getMinY()+this.env.getMaxY())/2)},getPoint:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return wa}}),wa.computeQuadLevel=function(e){var r=e.getWidth(),u=e.getHeight(),g=r>u?r:u,w=ba.exponent(g)+1;return w},Te(fo,ho),N(fo.prototype,{find:function(e){var r=ho.getSubnodeIndex(e,this.centrex,this.centrey);if(r===-1)return this;if(this.subnode[r]!==null){var u=this.subnode[r];return u.find(e)}return this},isSearchMatch:function(e){return this.env.intersects(e)},getSubnode:function(e){return this.subnode[e]===null&&(this.subnode[e]=this.createSubnode(e)),this.subnode[e]},getEnvelope:function(){return this.env},getNode:function(e){var r=ho.getSubnodeIndex(e,this.centrex,this.centrey);if(r!==-1){var u=this.getSubnode(r);return u.getNode(e)}return this},createSubnode:function(e){var r=0,u=0,g=0,w=0;switch(e){case 0:r=this.env.getMinX(),u=this.centrex,g=this.env.getMinY(),w=this.centrey;break;case 1:r=this.centrex,u=this.env.getMaxX(),g=this.env.getMinY(),w=this.centrey;break;case 2:r=this.env.getMinX(),u=this.centrex,g=this.centrey,w=this.env.getMaxY();break;case 3:r=this.centrex,u=this.env.getMaxX(),g=this.centrey,w=this.env.getMaxY()}var O=new et(r,u,g,w),H=new fo(O,this.level-1);return H},insertNode:function(e){Pe.isTrue(this.env===null||this.env.contains(e.env));var r=ho.getSubnodeIndex(e.env,this.centrex,this.centrey);if(e.level===this.level-1)this.subnode[r]=e;else{var u=this.createSubnode(r);u.insertNode(e),this.subnode[r]=u}},interfaces_:function(){return[]},getClass:function(){return fo}}),fo.createNode=function(e){var r=new wa(e),u=new fo(r.getEnvelope(),r.getLevel());return u},fo.createExpanded=function(e,r){var u=new et(r);e!==null&&u.expandToInclude(e.env);var g=fo.createNode(u);return e!==null&&g.insertNode(e),g},N(po.prototype,{interfaces_:function(){return[]},getClass:function(){return po}}),po.isZeroWidth=function(e,r){var u=r-e;if(u===0)return!0;var g=Math.max(Math.abs(e),Math.abs(r)),w=u/g,O=ba.exponent(w);return O<=po.MIN_BINARY_EXPONENT},po.MIN_BINARY_EXPONENT=-50,Te(mo,ho),N(mo.prototype,{insert:function(e,r){var u=ho.getSubnodeIndex(e,mo.origin.x,mo.origin.y);if(u===-1)return this.add(r),null;var g=this.subnode[u];if(g===null||!g.getEnvelope().contains(e)){var w=fo.createExpanded(g,e);this.subnode[u]=w}this.insertContained(this.subnode[u],e,r)},isSearchMatch:function(e){return!0},insertContained:function(e,r,u){Pe.isTrue(e.getEnvelope().contains(r));var g=po.isZeroWidth(r.getMinX(),r.getMaxX()),w=po.isZeroWidth(r.getMinY(),r.getMaxY()),O=null;O=g||w?e.find(r):e.getNode(r),O.add(u)},interfaces_:function(){return[]},getClass:function(){return mo}}),mo.origin=new ve(0,0),N(go.prototype,{size:function(){return this.root!==null?this.root.size():0},insert:function(e,r){this.collectStats(e);var u=go.ensureExtent(e,this.minExtent);this.root.insert(u,r)},query:function(){if(arguments.length===1){var e=arguments[0],r=new Ol;return this.query(e,r),r.getItems()}if(arguments.length===2){var u=arguments[0],g=arguments[1];this.root.visit(u,g)}},queryAll:function(){var e=new ze;return this.root.addAllItems(e),e},remove:function(e,r){var u=go.ensureExtent(e,this.minExtent);return this.root.remove(u,r)},collectStats:function(e){var r=e.getWidth();r<this.minExtent&&r>0&&(this.minExtent=r);var u=e.getHeight();u<this.minExtent&&u>0&&(this.minExtent=u)},depth:function(){return this.root!==null?this.root.depth():0},isEmpty:function(){return this.root===null},interfaces_:function(){return[ya,xe]},getClass:function(){return go}}),go.ensureExtent=function(e,r){var u=e.getMinX(),g=e.getMaxX(),w=e.getMinY(),O=e.getMaxY();return u!==g&&w!==O?e:(u===g&&(u-=r/2,g=u+r/2),w===O&&(w-=r/2,O=w+r/2),new et(u,g,w,O))},go.serialVersionUID=-7461163625812743e3;var Dh=Object.freeze({Quadtree:go}),sa=Object.freeze({STRtree:cn}),Rs=Object.freeze({quadtree:Dh,strtree:sa}),Oh=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];N(yu.prototype,{read:function(e){var r=void 0;r=typeof e=="string"?JSON.parse(e):e;var u=r.type;if(!Cs[u])throw new Error("Unknown GeoJSON type: "+r.type);return Oh.indexOf(u)!==-1?Cs[u].apply(this,[r.coordinates]):u==="GeometryCollection"?Cs[u].apply(this,[r.geometries]):Cs[u].apply(this,[r])},write:function(e){var r=e.getGeometryType();if(!ni[r])throw new Error("Geometry is not supported");return ni[r].apply(this,[e])}});var Cs={Feature:function(e){var r={};for(var u in e)r[u]=e[u];if(e.geometry){var g=e.geometry.type;if(!Cs[g])throw new Error("Unknown GeoJSON type: "+e.type);r.geometry=this.read(e.geometry)}return e.bbox&&(r.bbox=Cs.bbox.apply(this,[e.bbox])),r},FeatureCollection:function(e){var r={};if(e.features){r.features=[];for(var u=0;u<e.features.length;++u)r.features.push(this.read(e.features[u]))}return e.bbox&&(r.bbox=this.parse.bbox.apply(this,[e.bbox])),r},coordinates:function(r){for(var u=[],g=0;g<r.length;++g){var w=r[g];u.push(new ve(w[0],w[1]))}return u},bbox:function(e){return this.geometryFactory.createLinearRing([new ve(e[0],e[1]),new ve(e[2],e[1]),new ve(e[2],e[3]),new ve(e[0],e[3]),new ve(e[0],e[1])])},Point:function(e){var r=new ve(e[0],e[1]);return this.geometryFactory.createPoint(r)},MultiPoint:function(e){for(var r=[],u=0;u<e.length;++u)r.push(Cs.Point.apply(this,[e[u]]));return this.geometryFactory.createMultiPoint(r)},LineString:function(e){var r=Cs.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(r)},MultiLineString:function(e){for(var r=[],u=0;u<e.length;++u)r.push(Cs.LineString.apply(this,[e[u]]));return this.geometryFactory.createMultiLineString(r)},Polygon:function(e){for(var r=Cs.coordinates.apply(this,[e[0]]),u=this.geometryFactory.createLinearRing(r),g=[],w=1;w<e.length;++w){var O=e[w],H=Cs.coordinates.apply(this,[O]),Q=this.geometryFactory.createLinearRing(H);g.push(Q)}return this.geometryFactory.createPolygon(u,g)},MultiPolygon:function(e){for(var r=[],u=0;u<e.length;++u){var g=e[u];r.push(Cs.Polygon.apply(this,[g]))}return this.geometryFactory.createMultiPolygon(r)},GeometryCollection:function(e){for(var r=[],u=0;u<e.length;++u){var g=e[u];r.push(this.read(g))}return this.geometryFactory.createGeometryCollection(r)}},ni={coordinate:function(e){return[e.x,e.y]},Point:function(e){var r=ni.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:r}},MultiPoint:function(e){for(var r=[],u=0;u<e.geometries.length;++u){var g=e.geometries[u],w=ni.Point.apply(this,[g]);r.push(w.coordinates)}return{type:"MultiPoint",coordinates:r}},LineString:function(e){for(var r=[],u=e.getCoordinates(),g=0;g<u.length;++g){var w=u[g];r.push(ni.coordinate.apply(this,[w]))}return{type:"LineString",coordinates:r}},MultiLineString:function(e){for(var r=[],u=0;u<e.geometries.length;++u){var g=e.geometries[u],w=ni.LineString.apply(this,[g]);r.push(w.coordinates)}return{type:"MultiLineString",coordinates:r}},Polygon:function(e){var r=[],u=ni.LineString.apply(this,[e.shell]);r.push(u.coordinates);for(var g=0;g<e.holes.length;++g){var w=e.holes[g],O=ni.LineString.apply(this,[w]);r.push(O.coordinates)}return{type:"Polygon",coordinates:r}},MultiPolygon:function(e){for(var r=[],u=0;u<e.geometries.length;++u){var g=e.geometries[u],w=ni.Polygon.apply(this,[g]);r.push(w.coordinates)}return{type:"MultiPolygon",coordinates:r}},GeometryCollection:function(e){for(var r=[],u=0;u<e.geometries.length;++u){var g=e.geometries[u],w=g.getGeometryType();r.push(ni[w].apply(this,[g]))}return{type:"GeometryCollection",geometries:r}}};N(Ea.prototype,{read:function(e){var r=this.parser.read(e);return this.precisionModel.getType()===oi.FIXED&&this.reducePrecision(r),r},reducePrecision:function(e){var r,u;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(r=0,u=e.points.length;u>r;r++)this.precisionModel.makePrecise(e.points[r]);else if(e.geometries)for(r=0,u=e.geometries.length;u>r;r++)this.reducePrecision(e.geometries[r])}}),N(Ia.prototype,{write:function(e){return this.parser.write(e)}}),N(qn.prototype,{read:function(e){var r=this.parser.read(e);return this.precisionModel.getType()===oi.FIXED&&this.reducePrecision(r),r},reducePrecision:function(e){if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(var r=0,u=e.points.coordinates.length;u>r;r++)this.precisionModel.makePrecise(e.points.coordinates[r]);else if(e.geometries)for(var g=0,w=e.geometries.length;w>g;g++)this.reducePrecision(e.geometries[g])}}),N(vu.prototype,{read:function(e){return e instanceof ol.geom.Point?this.convertFromPoint(e):e instanceof ol.geom.LineString?this.convertFromLineString(e):e instanceof ol.geom.LinearRing?this.convertFromLinearRing(e):e instanceof ol.geom.Polygon?this.convertFromPolygon(e):e instanceof ol.geom.MultiPoint?this.convertFromMultiPoint(e):e instanceof ol.geom.MultiLineString?this.convertFromMultiLineString(e):e instanceof ol.geom.MultiPolygon?this.convertFromMultiPolygon(e):e instanceof ol.geom.GeometryCollection?this.convertFromCollection(e):void 0},convertFromPoint:function(e){var r=e.getCoordinates();return this.geometryFactory.createPoint(new ve(r[0],r[1]))},convertFromLineString:function(e){return this.geometryFactory.createLineString(e.getCoordinates().map(function(r){return new ve(r[0],r[1])}))},convertFromLinearRing:function(e){return this.geometryFactory.createLinearRing(e.getCoordinates().map(function(r){return new ve(r[0],r[1])}))},convertFromPolygon:function(e){for(var r=e.getLinearRings(),u=null,g=[],w=0;w<r.length;w++){var O=this.convertFromLinearRing(r[w]);w===0?u=O:g.push(O)}return this.geometryFactory.createPolygon(u,g)},convertFromMultiPoint:function(e){var r=e.getPoints().map(function(u){return this.convertFromPoint(u)},this);return this.geometryFactory.createMultiPoint(r)},convertFromMultiLineString:function(e){var r=e.getLineStrings().map(function(u){return this.convertFromLineString(u)},this);return this.geometryFactory.createMultiLineString(r)},convertFromMultiPolygon:function(e){var r=e.getPolygons().map(function(u){return this.convertFromPolygon(u)},this);return this.geometryFactory.createMultiPolygon(r)},convertFromCollection:function(e){var r=e.getGeometries().map(function(u){return this.read(u)},this);return this.geometryFactory.createGeometryCollection(r)},write:function(e){return e.getGeometryType()==="Point"?this.convertToPoint(e.getCoordinate()):e.getGeometryType()==="LineString"?this.convertToLineString(e):e.getGeometryType()==="LinearRing"?this.convertToLinearRing(e):e.getGeometryType()==="Polygon"?this.convertToPolygon(e):e.getGeometryType()==="MultiPoint"?this.convertToMultiPoint(e):e.getGeometryType()==="MultiLineString"?this.convertToMultiLineString(e):e.getGeometryType()==="MultiPolygon"?this.convertToMultiPolygon(e):e.getGeometryType()==="GeometryCollection"?this.convertToCollection(e):void 0},convertToPoint:function(e){return new ol.geom.Point([e.x,e.y])},convertToLineString:function(e){var r=e.points.coordinates.map(Jo);return new ol.geom.LineString(r)},convertToLinearRing:function(e){var r=e.points.coordinates.map(Jo);return new ol.geom.LinearRing(r)},convertToPolygon:function(e){for(var r=[e.shell.points.coordinates.map(Jo)],u=0;u<e.holes.length;u++)r.push(e.holes[u].points.coordinates.map(Jo));return new ol.geom.Polygon(r)},convertToMultiPoint:function(e){return new ol.geom.MultiPoint(e.getCoordinates().map(Jo))},convertToMultiLineString:function(e){for(var r=[],u=0;u<e.geometries.length;u++)r.push(this.convertToLineString(e.geometries[u]).getCoordinates());return new ol.geom.MultiLineString(r)},convertToMultiPolygon:function(e){for(var r=[],u=0;u<e.geometries.length;u++)r.push(this.convertToPolygon(e.geometries[u]).getCoordinates());return new ol.geom.MultiPolygon(r)},convertToCollection:function(e){for(var r=[],u=0;u<e.geometries.length;u++){var g=e.geometries[u];r.push(this.write(g))}return new ol.geom.GeometryCollection(r)}});var ei=Object.freeze({GeoJSONReader:Ea,GeoJSONWriter:Ia,OL3Parser:vu,WKTReader:qn,WKTWriter:Er});N(Qa.prototype,{rescale:function(){if(kt(arguments[0],Bt))for(var e=arguments[0],r=e.iterator();r.hasNext();){var u=r.next();this.rescale(u.getCoordinates())}else if(arguments[0]instanceof Array){var g=arguments[0];g.length===2&&(new ve(g[0]),new ve(g[1]));for(var r=0;r<g.length;r++)g[r].x=g[r].x/this.scaleFactor+this.offsetX,g[r].y=g[r].y/this.scaleFactor+this.offsetY;g.length===2&&g[0].equals2D(g[1])&&xi.out.println(g)}},scale:function(){if(kt(arguments[0],Bt)){for(var e=arguments[0],r=new ze,u=e.iterator();u.hasNext();){var g=u.next();r.add(new rr(this.scale(g.getCoordinates()),g.getData()))}return r}if(arguments[0]instanceof Array){for(var w=arguments[0],O=new Array(w.length).fill(null),u=0;u<w.length;u++)O[u]=new ve(Math.round((w[u].x-this.offsetX)*this.scaleFactor),Math.round((w[u].y-this.offsetY)*this.scaleFactor),w[u].z);var H=bn.removeRepeatedPoints(O);return H}},isIntegerPrecision:function(){return this.scaleFactor===1},getNodedSubstrings:function(){var e=this.noder.getNodedSubstrings();return this.isScaled&&this.rescale(e),e},computeNodes:function(e){var r=e;this.isScaled&&(r=this.scale(e)),this.noder.computeNodes(r)},interfaces_:function(){return[Bs]},getClass:function(){return Qa}});var Nh=Object.freeze({MCIndexNoder:Or,ScaledNoder:Qa,SegmentString:Al});N(Ta.prototype,{isSimpleMultiPoint:function(e){if(e.isEmpty())return!0;for(var r=new dr,u=0;u<e.getNumGeometries();u++){var g=e.getGeometryN(u),w=g.getCoordinate();if(r.contains(w))return this.nonSimpleLocation=w,!1;r.add(w)}return!0},isSimplePolygonal:function(e){for(var r=Fr.getLines(e),u=r.iterator();u.hasNext();){var g=u.next();if(!this.isSimpleLinearGeometry(g))return!1}return!0},hasClosedEndpointIntersection:function(e){for(var r=new nn,u=e.getEdgeIterator();u.hasNext();){var g=u.next(),w=(g.getMaximumSegmentIndex(),g.isClosed()),O=g.getCoordinate(0);this.addEndpoint(r,O,w);var H=g.getCoordinate(g.getNumPoints()-1);this.addEndpoint(r,H,w)}for(var u=r.values().iterator();u.hasNext();){var Q=u.next();if(Q.isClosed&&Q.degree!==2)return this.nonSimpleLocation=Q.getCoordinate(),!0}return!1},getNonSimpleLocation:function(){return this.nonSimpleLocation},isSimpleLinearGeometry:function(e){if(e.isEmpty())return!0;var r=new li(0,e),u=new pr,g=r.computeSelfNodes(u,!0);return g.hasIntersection()?g.hasProperIntersection()?(this.nonSimpleLocation=g.getProperIntersectionPoint(),!1):this.hasNonEndpointIntersection(r)?!1:!this.isClosedEndpointsInInterior||!this.hasClosedEndpointIntersection(r):!0},hasNonEndpointIntersection:function(e){for(var r=e.getEdgeIterator();r.hasNext();)for(var u=r.next(),g=u.getMaximumSegmentIndex(),w=u.getEdgeIntersectionList().iterator();w.hasNext();){var O=w.next();if(!O.isEndPoint(g))return this.nonSimpleLocation=O.getCoordinate(),!0}return!1},addEndpoint:function(e,r,u){var g=e.get(r);g===null&&(g=new Sa(r),e.put(r,g)),g.addEndpoint(u)},computeSimple:function(e){return this.nonSimpleLocation=null,e.isEmpty()?!0:e instanceof Fn?this.isSimpleLinearGeometry(e):e instanceof fr?this.isSimpleLinearGeometry(e):e instanceof oe?this.isSimpleMultiPoint(e):kt(e,Ke)?this.isSimplePolygonal(e):e instanceof jn?this.isSimpleGeometryCollection(e):!0},isSimple:function(){return this.nonSimpleLocation=null,this.computeSimple(this.inputGeom)},isSimpleGeometryCollection:function(e){for(var r=0;r<e.getNumGeometries();r++){var u=e.getGeometryN(r);if(!this.computeSimple(u))return!1}return!0},interfaces_:function(){return[]},getClass:function(){return Ta}}),N(Sa.prototype,{addEndpoint:function(e){this.degree++,this.isClosed|=e},getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return Sa}}),Ta.EndpointInfo=Sa,N(dn.prototype,{getEndCapStyle:function(){return this.endCapStyle},isSingleSided:function(){return this._isSingleSided},setQuadrantSegments:function(e){this.quadrantSegments=e,this.quadrantSegments===0&&(this.joinStyle=dn.JOIN_BEVEL),this.quadrantSegments<0&&(this.joinStyle=dn.JOIN_MITRE,this.mitreLimit=Math.abs(this.quadrantSegments)),0>=e&&(this.quadrantSegments=1),this.joinStyle!==dn.JOIN_ROUND&&(this.quadrantSegments=dn.DEFAULT_QUADRANT_SEGMENTS)},getJoinStyle:function(){return this.joinStyle},setJoinStyle:function(e){this.joinStyle=e},setSimplifyFactor:function(e){this.simplifyFactor=0>e?0:e},getSimplifyFactor:function(){return this.simplifyFactor},getQuadrantSegments:function(){return this.quadrantSegments},setEndCapStyle:function(e){this.endCapStyle=e},getMitreLimit:function(){return this.mitreLimit},setMitreLimit:function(e){this.mitreLimit=e},setSingleSided:function(e){this._isSingleSided=e},interfaces_:function(){return[]},getClass:function(){return dn}}),dn.bufferDistanceError=function(e){var r=Math.PI/2/e;return 1-Math.cos(r/2)},dn.CAP_ROUND=1,dn.CAP_FLAT=2,dn.CAP_SQUARE=3,dn.JOIN_ROUND=1,dn.JOIN_MITRE=2,dn.JOIN_BEVEL=3,dn.DEFAULT_QUADRANT_SEGMENTS=8,dn.DEFAULT_MITRE_LIMIT=5,dn.DEFAULT_SIMPLIFY_FACTOR=.01,N($u.prototype,{getCoordinate:function(){return this.minCoord},getRightmostSide:function(e,r){var u=this.getRightmostSideOfSegment(e,r);return 0>u&&(u=this.getRightmostSideOfSegment(e,r-1)),0>u&&(this.minCoord=null,this.checkForRightmostCoordinate(e)),u},findRightmostEdgeAtVertex:function(){var e=this.minDe.getEdge().getCoordinates();Pe.isTrue(this.minIndex>0&&this.minIndex<e.length,"rightmost point expected to be interior vertex of edge");var r=e[this.minIndex-1],u=e[this.minIndex+1],g=zt.computeOrientation(this.minCoord,u,r),w=!1;(r.y<this.minCoord.y&&u.y<this.minCoord.y&&g===zt.COUNTERCLOCKWISE||r.y>this.minCoord.y&&u.y>this.minCoord.y&&g===zt.CLOCKWISE)&&(w=!0),w&&(this.minIndex=this.minIndex-1)},getRightmostSideOfSegment:function(e,r){var u=e.getEdge(),g=u.getCoordinates();if(0>r||r+1>=g.length||g[r].y===g[r+1].y)return-1;var w=At.LEFT;return g[r].y<g[r+1].y&&(w=At.RIGHT),w},getEdge:function(){return this.orientedDe},checkForRightmostCoordinate:function(e){for(var r=e.getEdge().getCoordinates(),u=0;u<r.length-1;u++)(this.minCoord===null||r[u].x>this.minCoord.x)&&(this.minDe=e,this.minIndex=u,this.minCoord=r[u])},findRightmostEdgeAtNode:function(){var e=this.minDe.getNode(),r=e.getEdges();this.minDe=r.getRightmostEdge(),this.minDe.isForward()||(this.minDe=this.minDe.getSym(),this.minIndex=this.minDe.getEdge().getCoordinates().length-1)},findEdge:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();u.isForward()&&this.checkForRightmostCoordinate(u)}Pe.isTrue(this.minIndex!==0||this.minCoord.equals(this.minDe.getCoordinate()),"inconsistency in rightmost processing"),this.minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.orientedDe=this.minDe;var g=this.getRightmostSide(this.minDe,this.minIndex);g===At.LEFT&&(this.orientedDe=this.minDe.getSym())},interfaces_:function(){return[]},getClass:function(){return $u}}),Xu.prototype.addLast=function(e){this.array_.push(e)},Xu.prototype.removeFirst=function(){return this.array_.shift()},Xu.prototype.isEmpty=function(){return this.array_.length===0},N(Yu.prototype,{clearVisitedEdges:function(){for(var e=this.dirEdgeList.iterator();e.hasNext();){var r=e.next();r.setVisited(!1)}},getRightmostCoordinate:function(){return this.rightMostCoord},computeNodeDepth:function(e){for(var r=null,u=e.getEdges().iterator();u.hasNext();){var g=u.next();if(g.isVisited()||g.getSym().isVisited()){r=g;break}}if(r===null)throw new $i("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(r);for(var u=e.getEdges().iterator();u.hasNext();){var g=u.next();g.setVisited(!0),this.copySymDepths(g)}},computeDepth:function(e){this.clearVisitedEdges();var r=this.finder.getEdge();r.getNode(),r.getLabel(),r.setEdgeDepths(At.RIGHT,e),this.copySymDepths(r),this.computeDepths(r)},create:function(e){this.addReachable(e),this.finder.findEdge(this.dirEdgeList),this.rightMostCoord=this.finder.getCoordinate()},findResultEdges:function(){for(var e=this.dirEdgeList.iterator();e.hasNext();){var r=e.next();r.getDepth(At.RIGHT)>=1&&r.getDepth(At.LEFT)<=0&&!r.isInteriorAreaEdge()&&r.setInResult(!0)}},computeDepths:function(e){var r=new pn,u=new Xu,g=e.getNode();for(u.addLast(g),r.add(g),e.setVisited(!0);!u.isEmpty();){var w=u.removeFirst();r.add(w),this.computeNodeDepth(w);for(var O=w.getEdges().iterator();O.hasNext();){var H=O.next(),Q=H.getSym();if(!Q.isVisited()){var ye=Q.getNode();r.contains(ye)||(u.addLast(ye),r.add(ye))}}}},compareTo:function(e){var r=e;return this.rightMostCoord.x<r.rightMostCoord.x?-1:this.rightMostCoord.x>r.rightMostCoord.x?1:0},getEnvelope:function(){if(this.env===null){for(var e=new et,r=this.dirEdgeList.iterator();r.hasNext();)for(var u=r.next(),g=u.getEdge().getCoordinates(),w=0;w<g.length-1;w++)e.expandToInclude(g[w]);this.env=e}return this.env},addReachable:function(e){var r=new Ir;for(r.add(e);!r.empty();){var u=r.pop();this.add(u,r)}},copySymDepths:function(e){var r=e.getSym();r.setDepth(At.LEFT,e.getDepth(At.RIGHT)),r.setDepth(At.RIGHT,e.getDepth(At.LEFT))},add:function(e,r){e.setVisited(!0),this.nodes.add(e);for(var u=e.getEdges().iterator();u.hasNext();){var g=u.next();this.dirEdgeList.add(g);var w=g.getSym(),O=w.getNode();O.isVisited()||r.push(O)}},getNodes:function(){return this.nodes},getDirectedEdges:function(){return this.dirEdgeList},interfaces_:function(){return[a]},getClass:function(){return Yu}}),N(br.prototype,{isDeletable:function(e,r,u,g){var w=this.inputLine[e],O=this.inputLine[r],H=this.inputLine[u];return this.isConcave(w,O,H)&&this.isShallow(w,O,H,g)?this.isShallowSampled(w,O,e,u,g):!1},deleteShallowConcavities:function(){for(var e=1,r=(this.inputLine.length-1,this.findNextNonDeletedIndex(e)),u=this.findNextNonDeletedIndex(r),g=!1;u<this.inputLine.length;){var w=!1;this.isDeletable(e,r,u,this.distanceTol)&&(this.isDeleted[r]=br.DELETE,w=!0,g=!0),e=w?u:r,r=this.findNextNonDeletedIndex(e),u=this.findNextNonDeletedIndex(r)}return g},isShallowConcavity:function(e,r,u,g){var w=zt.computeOrientation(e,r,u),O=w===this.angleOrientation;if(!O)return!1;var H=zt.distancePointLine(r,e,u);return g>H},isShallowSampled:function(e,r,u,g,w){var O=Math.trunc((g-u)/br.NUM_PTS_TO_CHECK);0>=O&&(O=1);for(var H=u;g>H;H+=O)if(!this.isShallow(e,r,this.inputLine[H],w))return!1;return!0},isConcave:function(r,u,g){var w=zt.computeOrientation(r,u,g),O=w===this.angleOrientation;return O},simplify:function(e){this.distanceTol=Math.abs(e),0>e&&(this.angleOrientation=zt.CLOCKWISE),this.isDeleted=new Array(this.inputLine.length).fill(null);var r=!1;do r=this.deleteShallowConcavities();while(r);return this.collapseLine()},findNextNonDeletedIndex:function(e){for(var r=e+1;r<this.inputLine.length&&this.isDeleted[r]===br.DELETE;)r++;return r},isShallow:function(e,r,u,g){var w=zt.distancePointLine(r,e,u);return g>w},collapseLine:function(){for(var e=new ft,r=0;r<this.inputLine.length;r++)this.isDeleted[r]!==br.DELETE&&e.add(this.inputLine[r]);return e.toCoordinateArray()},interfaces_:function(){return[]},getClass:function(){return br}}),br.simplify=function(e,r){var u=new br(e);return u.simplify(r)},br.INIT=0,br.DELETE=1,br.KEEP=1,br.NUM_PTS_TO_CHECK=10,N(Ca.prototype,{getCoordinates:function(){var e=this.ptList.toArray(Ca.COORDINATE_ARRAY_TYPE);return e},setPrecisionModel:function(e){this.precisionModel=e},addPt:function(e){var r=new ve(e);return this.precisionModel.makePrecise(r),this.isRedundant(r)?null:void this.ptList.add(r)},reverse:function(){},addPts:function(e,r){if(r)for(var u=0;u<e.length;u++)this.addPt(e[u]);else for(var u=e.length-1;u>=0;u--)this.addPt(e[u])},isRedundant:function(e){if(this.ptList.size()<1)return!1;var r=this.ptList.get(this.ptList.size()-1),u=e.distance(r);return u<this.minimimVertexDistance},toString:function(){var e=new Zn,r=e.createLineString(this.getCoordinates());return r.toString()},closeRing:function(){if(this.ptList.size()<1)return null;var e=new ve(this.ptList.get(0)),r=this.ptList.get(this.ptList.size()-1);return this.ptList.size()>=2&&this.ptList.get(this.ptList.size()-2),e.equals(r)?null:void this.ptList.add(e)},setMinimumVertexDistance:function(e){this.minimimVertexDistance=e},interfaces_:function(){return[]},getClass:function(){return Ca}}),Ca.COORDINATE_ARRAY_TYPE=new Array(0).fill(null),N(_o.prototype,{addNextSegment:function(e,r){if(this.s0=this.s1,this.s1=this.s2,this.s2=e,this.seg0.setCoordinates(this.s0,this.s1),this.computeOffsetSegment(this.seg0,this.side,this.distance,this.offset0),this.seg1.setCoordinates(this.s1,this.s2),this.computeOffsetSegment(this.seg1,this.side,this.distance,this.offset1),this.s1.equals(this.s2))return null;var u=zt.computeOrientation(this.s0,this.s1,this.s2),g=u===zt.CLOCKWISE&&this.side===At.LEFT||u===zt.COUNTERCLOCKWISE&&this.side===At.RIGHT;u===0?this.addCollinear(r):g?this.addOutsideTurn(u,r):this.addInsideTurn(u,r)},addLineEndCap:function(e,r){var u=new Sn(e,r),g=new Sn;this.computeOffsetSegment(u,At.LEFT,this.distance,g);var w=new Sn;this.computeOffsetSegment(u,At.RIGHT,this.distance,w);var O=r.x-e.x,H=r.y-e.y,Q=Math.atan2(H,O);switch(this.bufParams.getEndCapStyle()){case dn.CAP_ROUND:this.segList.addPt(g.p1),this.addFilletArc(r,Q+Math.PI/2,Q-Math.PI/2,zt.CLOCKWISE,this.distance),this.segList.addPt(w.p1);break;case dn.CAP_FLAT:this.segList.addPt(g.p1),this.segList.addPt(w.p1);break;case dn.CAP_SQUARE:var ye=new ve;ye.x=Math.abs(this.distance)*Math.cos(Q),ye.y=Math.abs(this.distance)*Math.sin(Q);var Ue=new ve(g.p1.x+ye.x,g.p1.y+ye.y),ct=new ve(w.p1.x+ye.x,w.p1.y+ye.y);this.segList.addPt(Ue),this.segList.addPt(ct)}},getCoordinates:function(){var e=this.segList.getCoordinates();return e},addMitreJoin:function(e,r,u,g){var w=!0,O=null;try{O=hr.intersection(r.p0,r.p1,u.p0,u.p1);var H=0>=g?1:O.distance(e)/Math.abs(g);H>this.bufParams.getMitreLimit()&&(w=!1)}catch(Q){if(!(Q instanceof it))throw Q;O=new ve(0,0),w=!1}finally{}w?this.segList.addPt(O):this.addLimitedMitreJoin(r,u,g,this.bufParams.getMitreLimit())},addFilletCorner:function(e,r,u,g,w){var O=r.x-e.x,H=r.y-e.y,Q=Math.atan2(H,O),ye=u.x-e.x,Ue=u.y-e.y,ct=Math.atan2(Ue,ye);g===zt.CLOCKWISE?ct>=Q&&(Q+=2*Math.PI):Q>=ct&&(Q-=2*Math.PI),this.segList.addPt(r),this.addFilletArc(e,Q,ct,g,w),this.segList.addPt(u)},addOutsideTurn:function(e,r){return this.offset0.p1.distance(this.offset1.p0)<this.distance*_o.OFFSET_SEGMENT_SEPARATION_FACTOR?(this.segList.addPt(this.offset0.p1),null):void(this.bufParams.getJoinStyle()===dn.JOIN_MITRE?this.addMitreJoin(this.s1,this.offset0,this.offset1,this.distance):this.bufParams.getJoinStyle()===dn.JOIN_BEVEL?this.addBevelJoin(this.offset0,this.offset1):(r&&this.segList.addPt(this.offset0.p1),this.addFilletCorner(this.s1,this.offset0.p1,this.offset1.p0,e,this.distance),this.segList.addPt(this.offset1.p0)))},createSquare:function(e){this.segList.addPt(new ve(e.x+this.distance,e.y+this.distance)),this.segList.addPt(new ve(e.x+this.distance,e.y-this.distance)),this.segList.addPt(new ve(e.x-this.distance,e.y-this.distance)),this.segList.addPt(new ve(e.x-this.distance,e.y+this.distance)),this.segList.closeRing()},addSegments:function(e,r){this.segList.addPts(e,r)},addFirstSegment:function(){this.segList.addPt(this.offset1.p0)},addLastSegment:function(){this.segList.addPt(this.offset1.p1)},initSideSegments:function(e,r,u){this.s1=e,this.s2=r,this.side=u,this.seg1.setCoordinates(e,r),this.computeOffsetSegment(this.seg1,u,this.distance,this.offset1)},addLimitedMitreJoin:function(e,r,u,g){var w=this.seg0.p1,O=On.angle(w,this.seg0.p0),H=(On.angle(w,this.seg1.p1),On.angleBetweenOriented(this.seg0.p0,w,this.seg1.p1)),Q=H/2,ye=On.normalize(O+Q),Ue=On.normalize(ye+Math.PI),ct=g*u,yt=ct*Math.abs(Math.sin(Q)),Ft=u-yt,sn=w.x+ct*Math.cos(Ue),Tn=w.y+ct*Math.sin(Ue),Pn=new ve(sn,Tn),Ai=new Sn(w,Pn),er=Ai.pointAlongOffset(1,Ft),Ds=Ai.pointAlongOffset(1,-Ft);this.side===At.LEFT?(this.segList.addPt(er),this.segList.addPt(Ds)):(this.segList.addPt(Ds),this.segList.addPt(er))},computeOffsetSegment:function(e,r,u,g){var w=r===At.LEFT?1:-1,O=e.p1.x-e.p0.x,H=e.p1.y-e.p0.y,Q=Math.sqrt(O*O+H*H),ye=w*u*O/Q,Ue=w*u*H/Q;g.p0.x=e.p0.x-Ue,g.p0.y=e.p0.y+ye,g.p1.x=e.p1.x-Ue,g.p1.y=e.p1.y+ye},addFilletArc:function(e,r,u,g,w){var O=g===zt.CLOCKWISE?-1:1,H=Math.abs(r-u),Q=Math.trunc(H/this.filletAngleQuantum+.5);if(1>Q)return null;var ye=null,Ue=null;ye=0,Ue=H/Q;for(var ct=ye,yt=new ve;H>ct;){var Ft=r+O*ct;yt.x=e.x+w*Math.cos(Ft),yt.y=e.y+w*Math.sin(Ft),this.segList.addPt(yt),ct+=Ue}},addInsideTurn:function(e,r){if(this.li.computeIntersection(this.offset0.p0,this.offset0.p1,this.offset1.p0,this.offset1.p1),this.li.hasIntersection())this.segList.addPt(this.li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this.offset0.p1.distance(this.offset1.p0)<this.distance*_o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.segList.addPt(this.offset0.p1);else{if(this.segList.addPt(this.offset0.p1),this.closingSegLengthFactor>0){var u=new ve((this.closingSegLengthFactor*this.offset0.p1.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset0.p1.y+this.s1.y)/(this.closingSegLengthFactor+1));this.segList.addPt(u);var g=new ve((this.closingSegLengthFactor*this.offset1.p0.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset1.p0.y+this.s1.y)/(this.closingSegLengthFactor+1));this.segList.addPt(g)}else this.segList.addPt(this.s1);this.segList.addPt(this.offset1.p0)}},createCircle:function(e){var r=new ve(e.x+this.distance,e.y);this.segList.addPt(r),this.addFilletArc(e,0,2*Math.PI,-1,this.distance),this.segList.closeRing()},addBevelJoin:function(e,r){this.segList.addPt(e.p1),this.segList.addPt(r.p0)},init:function(e){this.distance=e,this.maxCurveSegmentError=e*(1-Math.cos(this.filletAngleQuantum/2)),this.segList=new Ca,this.segList.setPrecisionModel(this.precisionModel),this.segList.setMinimumVertexDistance(e*_o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},addCollinear:function(e){this.li.computeIntersection(this.s0,this.s1,this.s1,this.s2);var r=this.li.getIntersectionNum();r>=2&&(this.bufParams.getJoinStyle()===dn.JOIN_BEVEL||this.bufParams.getJoinStyle()===dn.JOIN_MITRE?(e&&this.segList.addPt(this.offset0.p1),this.segList.addPt(this.offset1.p0)):this.addFilletCorner(this.s1,this.offset0.p1,this.offset1.p0,zt.CLOCKWISE,this.distance))},closeRing:function(){this.segList.closeRing()},hasNarrowConcaveAngle:function(){return this._hasNarrowConcaveAngle},interfaces_:function(){return[]},getClass:function(){return _o}}),_o.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,_o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,_o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,_o.MAX_CLOSING_SEG_LEN_FACTOR=80,N(xu.prototype,{getOffsetCurve:function(e,r){if(this.distance=r,r===0)return null;var u=0>r,g=Math.abs(r),w=this.getSegGen(g);e.length<=1?this.computePointCurve(e[0],w):this.computeOffsetCurve(e,u,w);var O=w.getCoordinates();return u&&bn.reverse(O),O},computeSingleSidedBufferCurve:function(e,r,u){var g=this.simplifyTolerance(this.distance);if(r){u.addSegments(e,!0);var w=br.simplify(e,-g),O=w.length-1;u.initSideSegments(w[O],w[O-1],At.LEFT),u.addFirstSegment();for(var H=O-2;H>=0;H--)u.addNextSegment(w[H],!0)}else{u.addSegments(e,!1);var Q=br.simplify(e,g),ye=Q.length-1;u.initSideSegments(Q[0],Q[1],At.LEFT),u.addFirstSegment();for(var H=2;ye>=H;H++)u.addNextSegment(Q[H],!0)}u.addLastSegment(),u.closeRing()},computeRingBufferCurve:function(e,r,u){var g=this.simplifyTolerance(this.distance);r===At.RIGHT&&(g=-g);var w=br.simplify(e,g),O=w.length-1;u.initSideSegments(w[O-1],w[0],r);for(var H=1;O>=H;H++){var Q=H!==1;u.addNextSegment(w[H],Q)}u.closeRing()},computeLineBufferCurve:function(e,r){var u=this.simplifyTolerance(this.distance),g=br.simplify(e,u),w=g.length-1;r.initSideSegments(g[0],g[1],At.LEFT);for(var O=2;w>=O;O++)r.addNextSegment(g[O],!0);r.addLastSegment(),r.addLineEndCap(g[w-1],g[w]);var H=br.simplify(e,-u),Q=H.length-1;r.initSideSegments(H[Q],H[Q-1],At.LEFT);for(var O=Q-2;O>=0;O--)r.addNextSegment(H[O],!0);r.addLastSegment(),r.addLineEndCap(H[1],H[0]),r.closeRing()},computePointCurve:function(e,r){switch(this.bufParams.getEndCapStyle()){case dn.CAP_ROUND:r.createCircle(e);break;case dn.CAP_SQUARE:r.createSquare(e)}},getLineCurve:function(e,r){if(this.distance=r,0>r&&!this.bufParams.isSingleSided()||r===0)return null;var u=Math.abs(r),g=this.getSegGen(u);if(e.length<=1)this.computePointCurve(e[0],g);else if(this.bufParams.isSingleSided()){var w=0>r;this.computeSingleSidedBufferCurve(e,w,g)}else this.computeLineBufferCurve(e,g);var O=g.getCoordinates();return O},getBufferParameters:function(){return this.bufParams},simplifyTolerance:function(e){return e*this.bufParams.getSimplifyFactor()},getRingCurve:function(e,r,u){if(this.distance=u,e.length<=2)return this.getLineCurve(e,u);if(u===0)return xu.copyCoordinates(e);var g=this.getSegGen(u);return this.computeRingBufferCurve(e,r,g),g.getCoordinates()},computeOffsetCurve:function(e,r,u){var g=this.simplifyTolerance(this.distance);if(r){var w=br.simplify(e,-g),O=w.length-1;u.initSideSegments(w[O],w[O-1],At.LEFT),u.addFirstSegment();for(var H=O-2;H>=0;H--)u.addNextSegment(w[H],!0)}else{var Q=br.simplify(e,g),ye=Q.length-1;u.initSideSegments(Q[0],Q[1],At.LEFT),u.addFirstSegment();for(var H=2;ye>=H;H++)u.addNextSegment(Q[H],!0)}u.addLastSegment()},getSegGen:function(e){return new _o(this.precisionModel,this.bufParams,e)},interfaces_:function(){return[]},getClass:function(){return xu}}),xu.copyCoordinates=function(e){for(var r=new Array(e.length).fill(null),u=0;u<r.length;u++)r[u]=new ve(e[u]);return r},N(Ju.prototype,{findStabbedSegments:function(){if(arguments.length===1){for(var e=arguments[0],r=new ze,u=this.subgraphs.iterator();u.hasNext();){var g=u.next(),w=g.getEnvelope();e.y<w.getMinY()||e.y>w.getMaxY()||this.findStabbedSegments(e,g.getDirectedEdges(),r)}return r}if(arguments.length===3){if(kt(arguments[2],Ae)&&arguments[0]instanceof ve&&arguments[1]instanceof zr)for(var O=arguments[0],H=arguments[1],Q=arguments[2],ye=H.getEdge().getCoordinates(),u=0;u<ye.length-1;u++){this.seg.p0=ye[u],this.seg.p1=ye[u+1],this.seg.p0.y>this.seg.p1.y&&this.seg.reverse();var Ue=Math.max(this.seg.p0.x,this.seg.p1.x);if(!(Ue<O.x||this.seg.isHorizontal()||O.y<this.seg.p0.y||O.y>this.seg.p1.y||zt.computeOrientation(this.seg.p0,this.seg.p1,O)===zt.RIGHT)){var ct=H.getDepth(At.LEFT);this.seg.p0.equals(ye[u])||(ct=H.getDepth(At.RIGHT));var yt=new Ma(this.seg,ct);Q.add(yt)}}else if(kt(arguments[2],Ae)&&arguments[0]instanceof ve&&kt(arguments[1],Ae))for(var Ft=arguments[0],sn=arguments[1],Tn=arguments[2],u=sn.iterator();u.hasNext();){var Pn=u.next();Pn.isForward()&&this.findStabbedSegments(Ft,Pn,Tn)}}},getDepth:function(e){var r=this.findStabbedSegments(e);if(r.size()===0)return 0;var u=Hs.min(r);return u.leftDepth},interfaces_:function(){return[]},getClass:function(){return Ju}}),N(Ma.prototype,{compareTo:function(e){var r=e;if(this.upwardSeg.minX()>=r.upwardSeg.maxX())return 1;if(this.upwardSeg.maxX()<=r.upwardSeg.minX())return-1;var u=this.upwardSeg.orientationIndex(r.upwardSeg);return u!==0?u:(u=-1*r.upwardSeg.orientationIndex(this.upwardSeg),u!==0?u:this.upwardSeg.compareTo(r.upwardSeg))},compareX:function(e,r){var u=e.p0.compareTo(r.p0);return u!==0?u:e.p1.compareTo(r.p1)},toString:function(){return this.upwardSeg.toString()},interfaces_:function(){return[a]},getClass:function(){return Ma}}),Ju.DepthSegment=Ma,N(Pc.prototype,{addPoint:function(e){if(this.distance<=0)return null;var r=e.getCoordinates(),u=this.curveBuilder.getLineCurve(r,this.distance);this.addCurve(u,le.EXTERIOR,le.INTERIOR)},addPolygon:function(e){var r=this.distance,u=At.LEFT;this.distance<0&&(r=-this.distance,u=At.RIGHT);var g=e.getExteriorRing(),w=bn.removeRepeatedPoints(g.getCoordinates());if(this.distance<0&&this.isErodedCompletely(g,this.distance)||this.distance<=0&&w.length<3)return null;this.addPolygonRing(w,r,u,le.EXTERIOR,le.INTERIOR);for(var O=0;O<e.getNumInteriorRing();O++){var H=e.getInteriorRingN(O),Q=bn.removeRepeatedPoints(H.getCoordinates());this.distance>0&&this.isErodedCompletely(H,-this.distance)||this.addPolygonRing(Q,r,At.opposite(u),le.INTERIOR,le.EXTERIOR)}},isTriangleErodedCompletely:function(e,r){var u=new Ii(e[0],e[1],e[2]),g=u.inCentre(),w=zt.distancePointLine(g,u.p0,u.p1);return w<Math.abs(r)},addLineString:function(e){if(this.distance<=0&&!this.curveBuilder.getBufferParameters().isSingleSided())return null;var r=bn.removeRepeatedPoints(e.getCoordinates()),u=this.curveBuilder.getLineCurve(r,this.distance);this.addCurve(u,le.EXTERIOR,le.INTERIOR)},addCurve:function(e,r,u){if(e===null||e.length<2)return null;var g=new rr(e,new Mi(0,le.BOUNDARY,r,u));this.curveList.add(g)},getCurves:function(){return this.add(this.inputGeom),this.curveList},addPolygonRing:function(e,r,u,g,w){if(r===0&&e.length<ge.MINIMUM_VALID_SIZE)return null;var O=g,H=w;e.length>=ge.MINIMUM_VALID_SIZE&&zt.isCCW(e)&&(O=w,H=g,u=At.opposite(u));var Q=this.curveBuilder.getRingCurve(e,u,r);this.addCurve(Q,O,H)},add:function(e){if(e.isEmpty())return null;if(e instanceof ne)this.addPolygon(e);else if(e instanceof Fn)this.addLineString(e);else if(e instanceof Fi)this.addPoint(e);else if(e instanceof oe)this.addCollection(e);else if(e instanceof fr)this.addCollection(e);else if(e instanceof Oe)this.addCollection(e);else{if(!(e instanceof jn))throw new UnsupportedOperationException(e.getClass().getName());this.addCollection(e)}},isErodedCompletely:function(e,r){var u=e.getCoordinates();if(u.length<4)return 0>r;if(u.length===4)return this.isTriangleErodedCompletely(u,r);var g=e.getEnvelopeInternal(),w=Math.min(g.getHeight(),g.getWidth());return 0>r&&2*Math.abs(r)>w},addCollection:function(e){for(var r=0;r<e.getNumGeometries();r++){var u=e.getGeometryN(r);this.add(u)}},interfaces_:function(){return[]},getClass:function(){return Pc}}),N(Ku.prototype,{isTrivialIntersection:function(e,r,u,g){if(e===u&&this.li.getIntersectionNum()===1){if(Ku.isAdjacentSegments(r,g))return!0;if(e.isClosed()){var w=e.size()-1;if(r===0&&g===w||g===0&&r===w)return!0}}return!1},getProperIntersectionPoint:function(){return this.properIntersectionPoint},hasProperInteriorIntersection:function(){return this.hasProperInterior},getLineIntersector:function(){return this.li},hasProperIntersection:function(){return this.hasProper},processIntersections:function(e,r,u,g){if(e===u&&r===g)return null;this.numTests++;var w=e.getCoordinates()[r],O=e.getCoordinates()[r+1],H=u.getCoordinates()[g],Q=u.getCoordinates()[g+1];this.li.computeIntersection(w,O,H,Q),this.li.hasIntersection()&&(this.numIntersections++,this.li.isInteriorIntersection()&&(this.numInteriorIntersections++,this.hasInterior=!0),this.isTrivialIntersection(e,r,u,g)||(this._hasIntersection=!0,e.addIntersections(this.li,r,0),u.addIntersections(this.li,g,1),this.li.isProper()&&(this.numProperIntersections++,this.hasProper=!0,this.hasProperInterior=!0)))},hasIntersection:function(){return this._hasIntersection},isDone:function(){return!1},hasInteriorIntersection:function(){return this.hasInterior},interfaces_:function(){return[hu]},getClass:function(){return Ku}}),Ku.isAdjacentSegments=function(e,r){return Math.abs(e-r)===1},N(el.prototype,{setWorkingPrecisionModel:function(e){this.workingPrecisionModel=e},insertUniqueEdge:function(e){var r=this.edgeList.findEqualEdge(e);if(r!==null){var u=r.getLabel(),g=e.getLabel();r.isPointwiseEqual(e)||(g=new Mi(e.getLabel()),g.flip()),u.merge(g);var w=el.depthDelta(g),O=r.getDepthDelta(),H=O+w;r.setDepthDelta(H)}else this.edgeList.add(e),e.setDepthDelta(el.depthDelta(e.getLabel()))},buildSubgraphs:function(e,r){for(var u=new ze,g=e.iterator();g.hasNext();){var w=g.next(),O=w.getRightmostCoordinate(),H=new Ju(u),Q=H.getDepth(O);w.computeDepth(Q),w.findResultEdges(),u.add(w),r.add(w.getDirectedEdges(),w.getNodes())}},createSubgraphs:function(e){for(var r=new ze,u=e.getNodes().iterator();u.hasNext();){var g=u.next();if(!g.isVisited()){var w=new Yu;w.create(g),r.add(w)}}return Hs.sort(r,Hs.reverseOrder()),r},createEmptyResultGeometry:function(){var e=this.geomFact.createPolygon();return e},getNoder:function(e){if(this.workingNoder!==null)return this.workingNoder;var r=new Or,u=new pr;return u.setPrecisionModel(e),r.setSegmentIntersector(new Ku(u)),r},buffer:function(e,r){var u=this.workingPrecisionModel;u===null&&(u=e.getPrecisionModel()),this.geomFact=e.getFactory();var g=new xu(u,this.bufParams),w=new Pc(e,r,g),O=w.getCurves();if(O.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(O,u),this.graph=new Vs(new Po),this.graph.addEdges(this.edgeList.getEdges());var H=this.createSubgraphs(this.graph),Q=new ju(this.geomFact);this.buildSubgraphs(H,Q);var ye=Q.getPolygons();if(ye.size()<=0)return this.createEmptyResultGeometry();var Ue=this.geomFact.buildGeometry(ye);return Ue},computeNodedEdges:function(e,r){var u=this.getNoder(r);u.computeNodes(e);for(var g=u.getNodedSubstrings(),w=g.iterator();w.hasNext();){var O=w.next(),H=O.getCoordinates();if(H.length!==2||!H[0].equals2D(H[1])){var Q=O.getData(),ye=new Cr(O.getCoordinates(),new Mi(Q));this.insertUniqueEdge(ye)}}},setNoder:function(e){this.workingNoder=e},interfaces_:function(){return[]},getClass:function(){return el}}),el.depthDelta=function(e){var r=e.getLocation(0,At.LEFT),u=e.getLocation(0,At.RIGHT);return r===le.INTERIOR&&u===le.EXTERIOR?1:r===le.EXTERIOR&&u===le.INTERIOR?-1:0},el.convertSegStrings=function(e){for(var r=new Zn,u=new ze;e.hasNext();){var g=e.next(),w=r.createLineString(g.getCoordinates());u.add(w)}return r.buildGeometry(u)},N(Qu.prototype,{checkEndPtVertexIntersections:function(){if(arguments.length===0)for(var e=this.segStrings.iterator();e.hasNext();){var r=e.next(),u=r.getCoordinates();this.checkEndPtVertexIntersections(u[0],this.segStrings),this.checkEndPtVertexIntersections(u[u.length-1],this.segStrings)}else if(arguments.length===2){for(var g=arguments[0],w=arguments[1],e=w.iterator();e.hasNext();)for(var r=e.next(),u=r.getCoordinates(),O=1;O<u.length-1;O++)if(u[O].equals(g))throw new Se("found endpt/interior pt intersection at index "+O+" :pt "+g)}},checkInteriorIntersections:function(){if(arguments.length===0)for(var e=this.segStrings.iterator();e.hasNext();)for(var r=e.next(),u=this.segStrings.iterator();u.hasNext();){var g=u.next();this.checkInteriorIntersections(r,g)}else if(arguments.length===2)for(var w=arguments[0],O=arguments[1],H=w.getCoordinates(),Q=O.getCoordinates(),ye=0;ye<H.length-1;ye++)for(var Ue=0;Ue<Q.length-1;Ue++)this.checkInteriorIntersections(w,ye,O,Ue);else if(arguments.length===4){var ct=arguments[0],yt=arguments[1],Ft=arguments[2],sn=arguments[3];if(ct===Ft&&yt===sn)return null;var Tn=ct.getCoordinates()[yt],Pn=ct.getCoordinates()[yt+1],Ai=Ft.getCoordinates()[sn],er=Ft.getCoordinates()[sn+1];if(this.li.computeIntersection(Tn,Pn,Ai,er),this.li.hasIntersection()&&(this.li.isProper()||this.hasInteriorIntersection(this.li,Tn,Pn)||this.hasInteriorIntersection(this.li,Ai,er)))throw new Se("found non-noded intersection at "+Tn+"-"+Pn+" and "+Ai+"-"+er)}},checkValid:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},checkCollapses:function(){if(arguments.length===0)for(var e=this.segStrings.iterator();e.hasNext();){var r=e.next();this.checkCollapses(r)}else if(arguments.length===1)for(var u=arguments[0],g=u.getCoordinates(),e=0;e<g.length-2;e++)this.checkCollapse(g[e],g[e+1],g[e+2])},hasInteriorIntersection:function(e,r,u){for(var g=0;g<e.getIntersectionNum();g++){var w=e.getIntersection(g);if(!w.equals(r)&&!w.equals(u))return!0}return!1},checkCollapse:function(e,r,u){if(e.equals(u))throw new Se("found non-noded collapse at "+Qu.fact.createLineString([e,r,u]))},interfaces_:function(){return[]},getClass:function(){return Qu}}),Qu.fact=new Zn,N(tl.prototype,{intersectsScaled:function(e,r){var u=Math.min(e.x,r.x),g=Math.max(e.x,r.x),w=Math.min(e.y,r.y),O=Math.max(e.y,r.y),H=this.maxx<u||this.minx>g||this.maxy<w||this.miny>O;if(H)return!1;var Q=this.intersectsToleranceSquare(e,r);return Pe.isTrue(!(H&&Q),"Found bad envelope test"),Q},initCorners:function(e){var r=.5;this.minx=e.x-r,this.maxx=e.x+r,this.miny=e.y-r,this.maxy=e.y+r,this.corner[0]=new ve(this.maxx,this.maxy),this.corner[1]=new ve(this.minx,this.maxy),this.corner[2]=new ve(this.minx,this.miny),this.corner[3]=new ve(this.maxx,this.miny)},intersects:function(e,r){return this.scaleFactor===1?this.intersectsScaled(e,r):(this.copyScaled(e,this.p0Scaled),this.copyScaled(r,this.p1Scaled),this.intersectsScaled(this.p0Scaled,this.p1Scaled))},scale:function(e){return Math.round(e*this.scaleFactor)},getCoordinate:function(){return this.originalPt},copyScaled:function(e,r){r.x=this.scale(e.x),r.y=this.scale(e.y)},getSafeEnvelope:function(){if(this.safeEnv===null){var e=tl.SAFE_ENV_EXPANSION_FACTOR/this.scaleFactor;this.safeEnv=new et(this.originalPt.x-e,this.originalPt.x+e,this.originalPt.y-e,this.originalPt.y+e)}return this.safeEnv},intersectsPixelClosure:function(e,r){return this.li.computeIntersection(e,r,this.corner[0],this.corner[1]),this.li.hasIntersection()?!0:(this.li.computeIntersection(e,r,this.corner[1],this.corner[2]),this.li.hasIntersection()?!0:(this.li.computeIntersection(e,r,this.corner[2],this.corner[3]),this.li.hasIntersection()?!0:(this.li.computeIntersection(e,r,this.corner[3],this.corner[0]),!!this.li.hasIntersection())))},intersectsToleranceSquare:function(e,r){var u=!1,g=!1;return this.li.computeIntersection(e,r,this.corner[0],this.corner[1]),this.li.isProper()?!0:(this.li.computeIntersection(e,r,this.corner[1],this.corner[2]),this.li.isProper()?!0:(this.li.hasIntersection()&&(u=!0),this.li.computeIntersection(e,r,this.corner[2],this.corner[3]),this.li.isProper()?!0:(this.li.hasIntersection()&&(g=!0),this.li.computeIntersection(e,r,this.corner[3],this.corner[0]),this.li.isProper()||u&&g||e.equals(this.pt)?!0:!!r.equals(this.pt))))},addSnappedNode:function(e,r){var u=e.getCoordinate(r),g=e.getCoordinate(r+1);return this.intersects(u,g)?(e.addIntersection(this.getCoordinate(),r),!0):!1},interfaces_:function(){return[]},getClass:function(){return tl}}),tl.SAFE_ENV_EXPANSION_FACTOR=.75,N(Ko.prototype,{select:function(){if(arguments.length!==1){if(arguments.length===2){var e=arguments[0],r=arguments[1];e.getLineSegment(r,this.selectedSegment),this.select(this.selectedSegment)}}},interfaces_:function(){return[]},getClass:function(){return Ko}}),N(bu.prototype,{snap:function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}if(arguments.length===3){var r=arguments[0],u=arguments[1],g=arguments[2],w=r.getSafeEnvelope(),O=new zl(r,u,g);return this.index.query(w,{interfaces_:function(){return[ks]},visitItem:function(H){var Q=H;Q.select(w,O)}}),O.isNodeAdded()}},interfaces_:function(){return[]},getClass:function(){return bu}}),Te(zl,Ko),N(zl.prototype,{isNodeAdded:function(){return this._isNodeAdded},select:function(){if(arguments.length!==2)return Ko.prototype.select.apply(this,arguments);var e=arguments[0],r=arguments[1],u=e.getContext();return this.parentEdge!==null&&u===this.parentEdge&&r===this.hotPixelVertexIndex?null:void(this._isNodeAdded=this.hotPixel.addSnappedNode(u,r))},interfaces_:function(){return[]},getClass:function(){return zl}}),bu.HotPixelSnapAction=zl,N(Lc.prototype,{processIntersections:function(e,r,u,g){if(e===u&&r===g)return null;var w=e.getCoordinates()[r],O=e.getCoordinates()[r+1],H=u.getCoordinates()[g],Q=u.getCoordinates()[g+1];if(this.li.computeIntersection(w,O,H,Q),this.li.hasIntersection()&&this.li.isInteriorIntersection()){for(var ye=0;ye<this.li.getIntersectionNum();ye++)this.interiorIntersections.add(this.li.getIntersection(ye));e.addIntersections(this.li,r,0),u.addIntersections(this.li,g,1)}},isDone:function(){return!1},getInteriorIntersections:function(){return this.interiorIntersections},interfaces_:function(){return[hu]},getClass:function(){return Lc}}),N(Rc.prototype,{checkCorrectness:function(e){var r=rr.getNodedSubstrings(e),u=new Qu(r);try{u.checkValid()}catch(g){if(!(g instanceof ht))throw g;g.printStackTrace()}finally{}},getNodedSubstrings:function(){return rr.getNodedSubstrings(this.nodedSegStrings)},snapRound:function(e,r){var u=this.findInteriorIntersections(e,r);this.computeIntersectionSnaps(u),this.computeVertexSnaps(e)},findInteriorIntersections:function(e,r){var u=new Lc(r);return this.noder.setSegmentIntersector(u),this.noder.computeNodes(e),u.getInteriorIntersections()},computeVertexSnaps:function(){if(kt(arguments[0],Bt))for(var e=arguments[0],r=e.iterator();r.hasNext();){var u=r.next();this.computeVertexSnaps(u)}else if(arguments[0]instanceof rr)for(var g=arguments[0],w=g.getCoordinates(),O=0;O<w.length;O++){var H=new tl(w[O],this.scaleFactor,this.li),Q=this.pointSnapper.snap(H,g,O);Q&&g.addIntersection(w[O],O)}},computeNodes:function(e){this.nodedSegStrings=e,this.noder=new Or,this.pointSnapper=new bu(this.noder.getIndex()),this.snapRound(e,this.li)},computeIntersectionSnaps:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next(),g=new tl(u,this.scaleFactor,this.li);this.pointSnapper.snap(g)}},interfaces_:function(){return[Bs]},getClass:function(){return Rc}}),N(Wr.prototype,{bufferFixedPrecision:function(e){var r=new Qa(new Rc(new oi(1)),e.getScale()),u=new el(this.bufParams);u.setWorkingPrecisionModel(e),u.setNoder(r),this.resultGeometry=u.buffer(this.argGeom,this.distance)},bufferReducedPrecision:function(){if(arguments.length===0){for(var e=Wr.MAX_PRECISION_DIGITS;e>=0;e--){try{this.bufferReducedPrecision(e)}catch(w){if(!(w instanceof $i))throw w;this.saveException=w}finally{}if(this.resultGeometry!==null)return null}throw this.saveException}if(arguments.length===1){var r=arguments[0],u=Wr.precisionScaleFactor(this.argGeom,this.distance,r),g=new oi(u);this.bufferFixedPrecision(g)}},computeGeometry:function(){if(this.bufferOriginalPrecision(),this.resultGeometry!==null)return null;var e=this.argGeom.getFactory().getPrecisionModel();e.getType()===oi.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()},setQuadrantSegments:function(e){this.bufParams.setQuadrantSegments(e)},bufferOriginalPrecision:function(){try{var e=new el(this.bufParams);this.resultGeometry=e.buffer(this.argGeom,this.distance)}catch(r){if(!(r instanceof Se))throw r;this.saveException=r}finally{}},getResultGeometry:function(e){return this.distance=e,this.computeGeometry(),this.resultGeometry},setEndCapStyle:function(e){this.bufParams.setEndCapStyle(e)},interfaces_:function(){return[]},getClass:function(){return Wr}}),Wr.bufferOp=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],u=new Wr(e),g=u.getResultGeometry(r);return g}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Jt&&typeof arguments[1]=="number"){var w=arguments[0],O=arguments[1],H=arguments[2],Q=new Wr(w);Q.setQuadrantSegments(H);var g=Q.getResultGeometry(O);return g}if(arguments[2]instanceof dn&&arguments[0]instanceof Jt&&typeof arguments[1]=="number"){var ye=arguments[0],Ue=arguments[1],ct=arguments[2],Q=new Wr(ye,ct),g=Q.getResultGeometry(Ue);return g}}else if(arguments.length===4){var yt=arguments[0],Ft=arguments[1],sn=arguments[2],Tn=arguments[3],Q=new Wr(yt);Q.setQuadrantSegments(sn),Q.setEndCapStyle(Tn);var g=Q.getResultGeometry(Ft);return g}},Wr.precisionScaleFactor=function(e,r,u){var g=e.getEnvelopeInternal(),w=zn.max(Math.abs(g.getMaxX()),Math.abs(g.getMaxY()),Math.abs(g.getMinX()),Math.abs(g.getMinY())),O=r>0?r:0,H=w+2*O,Q=Math.trunc(Math.log(H)/Math.log(10)+1),ye=u-Q,Ue=Math.pow(10,ye);return Ue},Wr.CAP_ROUND=dn.CAP_ROUND,Wr.CAP_BUTT=dn.CAP_FLAT,Wr.CAP_FLAT=dn.CAP_FLAT,Wr.CAP_SQUARE=dn.CAP_SQUARE,Wr.MAX_PRECISION_DIGITS=12;var ml=Object.freeze({BufferOp:Wr,BufferParameters:dn});N(Ro.prototype,{filter:function(e){e instanceof ne&&this.comps.add(e)},interfaces_:function(){return[Fs]},getClass:function(){return Ro}}),Ro.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Ro.getPolygons(e,new ze)}if(arguments.length===2){var r=arguments[0],u=arguments[1];return r instanceof ne?u.add(r):r instanceof jn&&r.apply(new Ro(u)),u}},N($r.prototype,{isInsideArea:function(){return this.segIndex===$r.INSIDE_AREA},getCoordinate:function(){return this.pt},getGeometryComponent:function(){return this.component},getSegmentIndex:function(){return this.segIndex},interfaces_:function(){return[]},getClass:function(){return $r}}),$r.INSIDE_AREA=-1,N(nl.prototype,{filter:function(e){e instanceof Fi&&this.pts.add(e)},interfaces_:function(){return[Fs]},getClass:function(){return nl}}),nl.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof Fi?Hs.singletonList(e):nl.getPoints(e,new ze)}if(arguments.length===2){var r=arguments[0],u=arguments[1];return r instanceof Fi?u.add(r):r instanceof jn&&r.apply(new nl(u)),u}},N(fs.prototype,{filter:function(e){(e instanceof Fi||e instanceof Fn||e instanceof ne)&&this.locations.add(new $r(e,0,e.getCoordinate()))},interfaces_:function(){return[Fs]},getClass:function(){return fs}}),fs.getLocations=function(e){var r=new ze;return e.apply(new fs(r)),r},N(Gs.prototype,{computeContainmentDistance:function(){if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this.minDistance<=this.terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var r=arguments[0],u=arguments[1],g=1-r,w=Ro.getPolygons(this.geom[r]);if(w.size()>0){var O=fs.getLocations(this.geom[g]);if(this.computeContainmentDistance(O,w,u),this.minDistance<=this.terminateDistance)return this.minDistanceLocation[g]=u[0],this.minDistanceLocation[r]=u[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&kt(arguments[0],Ae)&&kt(arguments[1],Ae)){for(var H=arguments[0],Q=arguments[1],ye=arguments[2],Ue=0;Ue<H.size();Ue++)for(var ct=H.get(Ue),yt=0;yt<Q.size();yt++)if(this.computeContainmentDistance(ct,Q.get(yt),ye),this.minDistance<=this.terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof $r&&arguments[1]instanceof ne){var Ft=arguments[0],sn=arguments[1],Tn=arguments[2],Pn=Ft.getCoordinate();if(le.EXTERIOR!==this.ptLocator.locate(Pn,sn))return this.minDistance=0,Tn[0]=Ft,Tn[1]=new $r(sn,Pn),null}}},computeMinDistanceLinesPoints:function(e,r,u){for(var g=0;g<e.size();g++)for(var w=e.get(g),O=0;O<r.size();O++){var H=r.get(O);if(this.computeMinDistance(w,H,u),this.minDistance<=this.terminateDistance)return null}},computeFacetDistance:function(){var e=new Array(2).fill(null),r=Fr.getLines(this.geom[0]),u=Fr.getLines(this.geom[1]),g=nl.getPoints(this.geom[0]),w=nl.getPoints(this.geom[1]);return this.computeMinDistanceLines(r,u,e),this.updateMinDistance(e,!1),this.minDistance<=this.terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(r,w,e),this.updateMinDistance(e,!1),this.minDistance<=this.terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(u,g,e),this.updateMinDistance(e,!0),this.minDistance<=this.terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistancePoints(g,w,e),void this.updateMinDistance(e,!1))))},nearestLocations:function(){return this.computeMinDistance(),this.minDistanceLocation},updateMinDistance:function(e,r){return e[0]===null?null:void(r?(this.minDistanceLocation[0]=e[1],this.minDistanceLocation[1]=e[0]):(this.minDistanceLocation[0]=e[0],this.minDistanceLocation[1]=e[1]))},nearestPoints:function(){this.computeMinDistance();var e=[this.minDistanceLocation[0].getCoordinate(),this.minDistanceLocation[1].getCoordinate()];return e},computeMinDistance:function(){if(arguments.length===0){if(this.minDistanceLocation!==null||(this.minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this.minDistance<=this.terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Fn&&arguments[1]instanceof Fi){var e=arguments[0],r=arguments[1],u=arguments[2];if(e.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this.minDistance)return null;for(var g=e.getCoordinates(),w=r.getCoordinate(),O=0;O<g.length-1;O++){var H=zt.distancePointLine(w,g[O],g[O+1]);if(H<this.minDistance){this.minDistance=H;var Q=new Sn(g[O],g[O+1]),ye=Q.closestPoint(w);u[0]=new $r(e,O,ye),u[1]=new $r(r,0,w)}if(this.minDistance<=this.terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Fn&&arguments[1]instanceof Fn){var Ue=arguments[0],ct=arguments[1],yt=arguments[2];if(Ue.getEnvelopeInternal().distance(ct.getEnvelopeInternal())>this.minDistance)return null;for(var g=Ue.getCoordinates(),Ft=ct.getCoordinates(),O=0;O<g.length-1;O++)for(var sn=0;sn<Ft.length-1;sn++){var H=zt.distanceLineLine(g[O],g[O+1],Ft[sn],Ft[sn+1]);if(H<this.minDistance){this.minDistance=H;var Tn=new Sn(g[O],g[O+1]),Pn=new Sn(Ft[sn],Ft[sn+1]),Ai=Tn.closestPoints(Pn);yt[0]=new $r(Ue,O,Ai[0]),yt[1]=new $r(ct,sn,Ai[1])}if(this.minDistance<=this.terminateDistance)return null}}}},computeMinDistancePoints:function(e,r,u){for(var g=0;g<e.size();g++)for(var w=e.get(g),O=0;O<r.size();O++){var H=r.get(O),Q=w.getCoordinate().distance(H.getCoordinate());if(Q<this.minDistance&&(this.minDistance=Q,u[0]=new $r(w,0,w.getCoordinate()),u[1]=new $r(H,0,H.getCoordinate())),this.minDistance<=this.terminateDistance)return null}},distance:function(){if(this.geom[0]===null||this.geom[1]===null)throw new X;return this.geom[0].isEmpty()||this.geom[1].isEmpty()?0:(this.computeMinDistance(),this.minDistance)},computeMinDistanceLines:function(e,r,u){for(var g=0;g<e.size();g++)for(var w=e.get(g),O=0;O<r.size();O++){var H=r.get(O);if(this.computeMinDistance(w,H,u),this.minDistance<=this.terminateDistance)return null}},interfaces_:function(){return[]},getClass:function(){return Gs}}),Gs.distance=function(e,r){var u=new Gs(e,r);return u.distance()},Gs.isWithinDistance=function(e,r,u){var g=new Gs(e,r,u);return g.distance()<=u},Gs.nearestPoints=function(e,r){var u=new Gs(e,r);return u.nearestPoints()};var kc=Object.freeze({DistanceOp:Gs});N(wu.prototype,{getCoordinates:function(){if(this.coordinates===null){for(var e=0,r=0,u=new ft,g=this.directedEdges.iterator();g.hasNext();){var w=g.next();w.getEdgeDirection()?e++:r++,u.add(w.getEdge().getLine().getCoordinates(),!1,w.getEdgeDirection())}this.coordinates=u.toCoordinateArray(),r>e&&bn.reverse(this.coordinates)}return this.coordinates},toLineString:function(){return this.factory.createLineString(this.getCoordinates())},add:function(e){this.directedEdges.add(e)},interfaces_:function(){return[]},getClass:function(){return wu}}),N(Es.prototype,{setVisited:function(e){this._isVisited=e},isMarked:function(){return this._isMarked},setData:function(e){this.data=e},getData:function(){return this.data},setMarked:function(e){this._isMarked=e},getContext:function(){return this.data},isVisited:function(){return this._isVisited},setContext:function(e){this.data=e},interfaces_:function(){return[]},getClass:function(){return Es}}),Es.getComponentWithVisitedState=function(e,r){for(;e.hasNext();){var u=e.next();if(u.isVisited()===r)return u}return null},Es.setVisited=function(e,r){for(;e.hasNext();){var u=e.next();u.setVisited(r)}},Es.setMarked=function(e,r){for(;e.hasNext();){var u=e.next();u.setMarked(r)}},Te(Is,Es),N(Is.prototype,{isRemoved:function(){return this.parentEdge===null},compareDirection:function(e){return this.quadrant>e.quadrant?1:this.quadrant<e.quadrant?-1:zt.computeOrientation(e.p0,e.p1,this.p1)},getCoordinate:function(){return this.from.getCoordinate()},print:function(e){var r=this.getClass().getName(),u=r.lastIndexOf("."),g=r.substring(u+1);e.print("  "+g+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+this.angle)},getDirectionPt:function(){return this.p1},getAngle:function(){return this.angle},compareTo:function(e){var r=e;return this.compareDirection(r)},getFromNode:function(){return this.from},getSym:function(){return this.sym},setEdge:function(e){this.parentEdge=e},remove:function(){this.sym=null,this.parentEdge=null},getEdge:function(){return this.parentEdge},getQuadrant:function(){return this.quadrant},setSym:function(e){this.sym=e},getToNode:function(){return this.to},getEdgeDirection:function(){return this.edgeDirection},interfaces_:function(){return[a]},getClass:function(){return Is}}),Is.toEdges=function(e){for(var r=new ze,u=e.iterator();u.hasNext();)r.add(u.next().parentEdge);return r},Te(Fl,Is),N(Fl.prototype,{getNext:function(){return this.getToNode().getDegree()!==2?null:this.getToNode().getOutEdges().getEdges().get(0)===this.getSym()?this.getToNode().getOutEdges().getEdges().get(1):(Pe.isTrue(this.getToNode().getOutEdges().getEdges().get(1)===this.getSym()),this.getToNode().getOutEdges().getEdges().get(0))},interfaces_:function(){return[]},getClass:function(){return Fl}}),Te(qs,Es),N(qs.prototype,{isRemoved:function(){return this.dirEdge===null},setDirectedEdges:function(e,r){this.dirEdge=[e,r],e.setEdge(this),r.setEdge(this),e.setSym(r),r.setSym(e),e.getFromNode().addOutEdge(e),r.getFromNode().addOutEdge(r)},getDirEdge:function(){if(Number.isInteger(arguments[0])){var e=arguments[0];return this.dirEdge[e]}if(arguments[0]instanceof js){var r=arguments[0];return this.dirEdge[0].getFromNode()===r?this.dirEdge[0]:this.dirEdge[1].getFromNode()===r?this.dirEdge[1]:null}},remove:function(){this.dirEdge=null},getOppositeNode:function(e){return this.dirEdge[0].getFromNode()===e?this.dirEdge[0].getToNode():this.dirEdge[1].getFromNode()===e?this.dirEdge[1].getToNode():null},interfaces_:function(){return[]},getClass:function(){return qs}}),N(ec.prototype,{getNextEdge:function(e){var r=this.getIndex(e);return this.outEdges.get(this.getIndex(r+1))},getCoordinate:function(){var e=this.iterator();if(!e.hasNext())return null;var r=e.next();return r.getCoordinate()},iterator:function(){return this.sortEdges(),this.outEdges.iterator()},sortEdges:function(){this.sorted||(Hs.sort(this.outEdges),this.sorted=!0)},remove:function(e){this.outEdges.remove(e)},getEdges:function(){return this.sortEdges(),this.outEdges},getNextCWEdge:function(e){var r=this.getIndex(e);return this.outEdges.get(this.getIndex(r-1))},getIndex:function(){if(arguments[0]instanceof qs){var e=arguments[0];this.sortEdges();for(var r=0;r<this.outEdges.size();r++){var u=this.outEdges.get(r);if(u.getEdge()===e)return r}return-1}if(arguments[0]instanceof Is){var g=arguments[0];this.sortEdges();for(var r=0;r<this.outEdges.size();r++){var u=this.outEdges.get(r);if(u===g)return r}return-1}if(Number.isInteger(arguments[0])){var w=arguments[0],O=w%this.outEdges.size();return 0>O&&(O+=this.outEdges.size()),O}},add:function(e){this.outEdges.add(e),this.sorted=!1},getDegree:function(){return this.outEdges.size()},interfaces_:function(){return[]},getClass:function(){return ec}}),Te(js,Es),N(js.prototype,{isRemoved:function(){return this.pt===null},addOutEdge:function(e){this.deStar.add(e)},getCoordinate:function(){return this.pt},getOutEdges:function(){return this.deStar},remove:function(){if(arguments.length===0)this.pt=null;else if(arguments.length===1){var e=arguments[0];this.deStar.remove(e)}},getIndex:function(e){return this.deStar.getIndex(e)},getDegree:function(){return this.deStar.getDegree()},interfaces_:function(){return[]},getClass:function(){return js}}),js.getEdgesBetween=function(e,r){var u=Is.toEdges(e.getOutEdges().getEdges()),g=new pn(u),w=Is.toEdges(r.getOutEdges().getEdges());return g.retainAll(w),g},Te(kl,qs),N(kl.prototype,{getLine:function(){return this.line},interfaces_:function(){return[]},getClass:function(){return kl}}),N(tc.prototype,{find:function(e){return this.nodeMap.get(e)},iterator:function(){return this.nodeMap.values().iterator()},remove:function(e){return this.nodeMap.remove(e)},values:function(){return this.nodeMap.values()},add:function(e){return this.nodeMap.put(e.getCoordinate(),e),e},interfaces_:function(){return[]},getClass:function(){return tc}}),N(Bl.prototype,{findNodesOfDegree:function(e){for(var r=new ze,u=this.nodeIterator();u.hasNext();){var g=u.next();g.getDegree()===e&&r.add(g)}return r},dirEdgeIterator:function(){return this.dirEdges.iterator()},edgeIterator:function(){return this.edges.iterator()},remove:function(){if(arguments[0]instanceof qs){var e=arguments[0];this.remove(e.getDirEdge(0)),this.remove(e.getDirEdge(1)),this.edges.remove(e),e.remove()}else if(arguments[0]instanceof Is){var r=arguments[0],u=r.getSym();u!==null&&u.setSym(null),r.getFromNode().remove(r),r.remove(),this.dirEdges.remove(r)}else if(arguments[0]instanceof js){for(var g=arguments[0],w=g.getOutEdges().getEdges(),O=w.iterator();O.hasNext();){var H=O.next(),u=H.getSym();u!==null&&this.remove(u),this.dirEdges.remove(H);var Q=H.getEdge();Q!==null&&this.edges.remove(Q)}this.nodeMap.remove(g.getCoordinate()),g.remove()}},findNode:function(e){return this.nodeMap.find(e)},getEdges:function(){return this.edges},nodeIterator:function(){return this.nodeMap.iterator()},contains:function(){if(arguments[0]instanceof qs){var e=arguments[0];return this.edges.contains(e)}if(arguments[0]instanceof Is){var r=arguments[0];return this.dirEdges.contains(r)}},add:function(){if(arguments[0]instanceof js){var e=arguments[0];this.nodeMap.add(e)}else if(arguments[0]instanceof qs){var r=arguments[0];this.edges.add(r),this.add(r.getDirEdge(0)),this.add(r.getDirEdge(1))}else if(arguments[0]instanceof Is){var u=arguments[0];this.dirEdges.add(u)}},getNodes:function(){return this.nodeMap.values()},interfaces_:function(){return[]},getClass:function(){return Bl}}),Te(Aa,Bl),N(Aa.prototype,{addEdge:function(e){if(e.isEmpty())return null;var r=bn.removeRepeatedPoints(e.getCoordinates());if(r.length<=1)return null;var u=r[0],g=r[r.length-1],w=this.getNode(u),O=this.getNode(g),H=new Fl(w,O,r[1],!0),Q=new Fl(O,w,r[r.length-2],!1),ye=new kl(e);ye.setDirectedEdges(H,Q),this.add(ye)},getNode:function(e){var r=this.findNode(e);return r===null&&(r=new js(e),this.add(r)),r},interfaces_:function(){return[]},getClass:function(){return Aa}}),N(uh.prototype,{buildEdgeStringsForUnprocessedNodes:function(){for(var e=this.graph.getNodes().iterator();e.hasNext();){var r=e.next();r.isMarked()||(Pe.isTrue(r.getDegree()===2),this.buildEdgeStringsStartingAt(r),r.setMarked(!0))}},buildEdgeStringsForNonDegree2Nodes:function(){for(var e=this.graph.getNodes().iterator();e.hasNext();){var r=e.next();r.getDegree()!==2&&(this.buildEdgeStringsStartingAt(r),r.setMarked(!0))}},buildEdgeStringsForObviousStartNodes:function(){this.buildEdgeStringsForNonDegree2Nodes()},getMergedLineStrings:function(){return this.merge(),this.mergedLineStrings},buildEdgeStringsStartingAt:function(e){for(var r=e.getOutEdges().iterator();r.hasNext();){var u=r.next();u.getEdge().isMarked()||this.edgeStrings.add(this.buildEdgeStringStartingWith(u))}},merge:function(){if(this.mergedLineStrings!==null)return null;Es.setMarked(this.graph.nodeIterator(),!1),Es.setMarked(this.graph.edgeIterator(),!1),this.edgeStrings=new ze,this.buildEdgeStringsForObviousStartNodes(),this.buildEdgeStringsForIsolatedLoops(),this.mergedLineStrings=new ze;for(var e=this.edgeStrings.iterator();e.hasNext();){var r=e.next();this.mergedLineStrings.add(r.toLineString())}},buildEdgeStringStartingWith:function(e){var r=new wu(this.factory),u=e;do r.add(u),u.getEdge().setMarked(!0),u=u.getNext();while(u!==null&&u!==e);return r},add:function(){if(arguments[0]instanceof Jt){var e=arguments[0];e.apply({interfaces_:function(){return[es]},filter:function(O){O instanceof Fn&&this.add(O)}})}else if(kt(arguments[0],Bt)){var r=arguments[0];this.mergedLineStrings=null;for(var u=r.iterator();u.hasNext();){var g=u.next();this.add(g)}}else if(arguments[0]instanceof Fn){var w=arguments[0];this.factory===null&&(this.factory=w.getFactory()),this.graph.addEdge(w)}},buildEdgeStringsForIsolatedLoops:function(){this.buildEdgeStringsForUnprocessedNodes()},interfaces_:function(){return[]},getClass:function(){return uh}});var Ou=Object.freeze({LineMerger:uh}),hh=Object.freeze({OverlayOp:fn});Te(Eu,Is),N(Eu.prototype,{getNext:function(){return this.next},isInRing:function(){return this.edgeRing!==null},setRing:function(e){this.edgeRing=e},setLabel:function(e){this.label=e},getLabel:function(){return this.label},setNext:function(e){this.next=e},getRing:function(){return this.edgeRing},interfaces_:function(){return[]},getClass:function(){return Eu}}),Te(nc,qs),N(nc.prototype,{getLine:function(){return this.line},interfaces_:function(){return[]},getClass:function(){return nc}}),N(ps.prototype,{isIncluded:function(){return this._isIncluded},getCoordinates:function(){if(this.ringPts===null){for(var e=new ft,r=this.deList.iterator();r.hasNext();){var u=r.next(),g=u.getEdge();ps.addEdge(g.getLine().getCoordinates(),u.getEdgeDirection(),e)}this.ringPts=e.toCoordinateArray()}return this.ringPts},isIncludedSet:function(){return this._isIncludedSet},isValid:function(){return this.getCoordinates(),this.ringPts.length<=3?!1:(this.getRing(),this.ring.isValid())},build:function(e){var r=e;do this.add(r),r.setRing(this),r=r.getNext(),Pe.isTrue(r!==null,"found null DE in ring"),Pe.isTrue(r===e||!r.isInRing(),"found DE already in ring");while(r!==e)},isOuterHole:function(){return this._isHole?!this.hasShell():!1},getPolygon:function(){var e=null;if(this.holes!==null){e=new Array(this.holes.size()).fill(null);for(var r=0;r<this.holes.size();r++)e[r]=this.holes.get(r)}var u=this.factory.createPolygon(this.ring,e);return u},isHole:function(){return this._isHole},isProcessed:function(){return this._isProcessed},addHole:function(){if(arguments[0]instanceof ge){var e=arguments[0];this.holes===null&&(this.holes=new ze),this.holes.add(e)}else if(arguments[0]instanceof ps){var r=arguments[0];r.setShell(this);var u=r.getRing();this.holes===null&&(this.holes=new ze),this.holes.add(u)}},setIncluded:function(e){this._isIncluded=e,this._isIncludedSet=!0},getOuterHole:function(){if(this.isHole())return null;for(var e=0;e<this.deList.size();e++){var r=this.deList.get(e),u=r.getSym().getRing();if(u.isOuterHole())return u}return null},computeHole:function(){var e=this.getRing();this._isHole=zt.isCCW(e.getCoordinates())},hasShell:function(){return this.shell!==null},isOuterShell:function(){return this.getOuterHole()!==null},getLineString:function(){return this.getCoordinates(),this.factory.createLineString(this.ringPts)},toString:function(){return Er.toLineString(new st(this.getCoordinates()))},getShell:function(){return this.isHole()?this.shell:this},add:function(e){this.deList.add(e)},getRing:function(){if(this.ring!==null)return this.ring;this.getCoordinates(),this.ringPts.length<3&&xi.out.println(this.ringPts);try{this.ring=this.factory.createLinearRing(this.ringPts)}catch(e){if(!(e instanceof ht))throw e;xi.out.println(this.ringPts)}finally{}return this.ring},updateIncluded:function(){if(this.isHole())return null;for(var e=0;e<this.deList.size();e++){var r=this.deList.get(e),u=r.getSym().getRing().getShell();if(u!==null&&u.isIncludedSet())return this.setIncluded(!u.isIncluded()),null}},setShell:function(e){this.shell=e},setProcessed:function(e){this._isProcessed=e},interfaces_:function(){return[]},getClass:function(){return ps}}),ps.findDirEdgesInRing=function(e){var r=e,u=new ze;do u.add(r),r=r.getNext(),Pe.isTrue(r!==null,"found null DE in ring"),Pe.isTrue(r===e||!r.isInRing(),"found DE already in ring");while(r!==e);return u},ps.addEdge=function(e,r,u){if(r)for(var g=0;g<e.length;g++)u.add(e[g],!1);else for(var g=e.length-1;g>=0;g--)u.add(e[g],!1)},ps.findEdgeRingContaining=function(e,r){for(var u=e.getRing(),g=u.getEnvelopeInternal(),w=u.getCoordinateN(0),O=null,H=null,Q=r.iterator();Q.hasNext();){var ye=Q.next(),Ue=ye.getRing(),ct=Ue.getEnvelopeInternal();if(!ct.equals(g)&&ct.contains(g)){w=bn.ptNotInList(u.getCoordinates(),Ue.getCoordinates());var yt=!1;zt.isPointInRing(w,Ue.getCoordinates())&&(yt=!0),yt&&(O===null||H.contains(ct))&&(O=ye,H=O.getRing().getEnvelopeInternal())}}return O},N(Dc.prototype,{compare:function(e,r){var u=e,g=r;return u.getRing().getEnvelope().compareTo(g.getRing().getEnvelope())},interfaces_:function(){return[me]},getClass:function(){return Dc}}),ps.EnvelopeComparator=Dc,Te(gr,Bl),N(gr.prototype,{findEdgeRing:function(e){var r=new ps(this.factory);return r.build(e),r},computeDepthParity:function(){if(arguments.length===0)for(;;){var e=null;if(e===null)return null;this.computeDepthParity(e)}},computeNextCWEdges:function(){for(var e=this.nodeIterator();e.hasNext();){var r=e.next();gr.computeNextCWEdges(r)}},addEdge:function(e){if(e.isEmpty())return null;var r=bn.removeRepeatedPoints(e.getCoordinates());if(r.length<2)return null;var u=r[0],g=r[r.length-1],w=this.getNode(u),O=this.getNode(g),H=new Eu(w,O,r[1],!0),Q=new Eu(O,w,r[r.length-2],!1),ye=new nc(e);ye.setDirectedEdges(H,Q),this.add(ye)},deleteCutEdges:function(){this.computeNextCWEdges(),gr.findLabeledEdgeRings(this.dirEdges);for(var e=new ze,r=this.dirEdges.iterator();r.hasNext();){var u=r.next();if(!u.isMarked()){var g=u.getSym();if(u.getLabel()===g.getLabel()){u.setMarked(!0),g.setMarked(!0);var w=u.getEdge();e.add(w.getLine())}}}return e},getEdgeRings:function(){this.computeNextCWEdges(),gr.label(this.dirEdges,-1);var e=gr.findLabeledEdgeRings(this.dirEdges);this.convertMaximalToMinimalEdgeRings(e);for(var r=new ze,u=this.dirEdges.iterator();u.hasNext();){var g=u.next();if(!g.isMarked()&&!g.isInRing()){var w=this.findEdgeRing(g);r.add(w)}}return r},getNode:function(e){var r=this.findNode(e);return r===null&&(r=new js(e),this.add(r)),r},convertMaximalToMinimalEdgeRings:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next(),g=u.getLabel(),w=gr.findIntersectionNodes(u,g);if(w!==null)for(var O=w.iterator();O.hasNext();){var H=O.next();gr.computeNextCCWEdges(H,g)}}},deleteDangles:function(){for(var e=this.findNodesOfDegree(1),r=new pn,u=new Ir,g=e.iterator();g.hasNext();)u.push(g.next());for(;!u.isEmpty();){var w=u.pop();gr.deleteAllEdges(w);for(var O=w.getOutEdges().getEdges(),g=O.iterator();g.hasNext();){var H=g.next();H.setMarked(!0);var Q=H.getSym();Q!==null&&Q.setMarked(!0);var ye=H.getEdge();r.add(ye.getLine());var Ue=H.getToNode();gr.getDegreeNonDeleted(Ue)===1&&u.push(Ue)}}return r},interfaces_:function(){return[]},getClass:function(){return gr}}),gr.findLabeledEdgeRings=function(e){for(var r=new ze,u=1,g=e.iterator();g.hasNext();){var w=g.next();if(!(w.isMarked()||w.getLabel()>=0)){r.add(w);var O=ps.findDirEdgesInRing(w);gr.label(O,u),u++}}return r},gr.getDegreeNonDeleted=function(e){for(var r=e.getOutEdges().getEdges(),u=0,g=r.iterator();g.hasNext();){var w=g.next();w.isMarked()||u++}return u},gr.deleteAllEdges=function(e){for(var r=e.getOutEdges().getEdges(),u=r.iterator();u.hasNext();){var g=u.next();g.setMarked(!0);var w=g.getSym();w!==null&&w.setMarked(!0)}},gr.label=function(e,r){for(var u=e.iterator();u.hasNext();){var g=u.next();g.setLabel(r)}},gr.computeNextCWEdges=function(e){for(var r=e.getOutEdges(),u=null,g=null,w=r.getEdges().iterator();w.hasNext();){var O=w.next();if(!O.isMarked()){if(u===null&&(u=O),g!==null){var H=g.getSym();H.setNext(O)}g=O}}if(g!==null){var H=g.getSym();H.setNext(u)}},gr.computeNextCCWEdges=function(e,r){for(var u=e.getOutEdges(),g=null,w=null,O=u.getEdges(),H=O.size()-1;H>=0;H--){var Q=O.get(H),ye=Q.getSym(),Ue=null;Q.getLabel()===r&&(Ue=Q);var ct=null;ye.getLabel()===r&&(ct=ye),Ue===null&&ct===null||(ct!==null&&(w=ct),Ue!==null&&(w!==null&&(w.setNext(Ue),w=null),g===null&&(g=Ue)))}w!==null&&(Pe.isTrue(g!==null),w.setNext(g))},gr.getDegree=function(e,r){for(var u=e.getOutEdges().getEdges(),g=0,w=u.iterator();w.hasNext();){var O=w.next();O.getLabel()===r&&g++}return g},gr.findIntersectionNodes=function(e,r){var u=e,g=null;do{var w=u.getFromNode();gr.getDegree(w,r)>1&&(g===null&&(g=new ze),g.add(w)),u=u.getNext(),Pe.isTrue(u!==null,"found null DE in ring"),Pe.isTrue(u===e||!u.isInRing(),"found DE already in ring")}while(u!==e);return g},N(ms.prototype,{getGeometry:function(){return this.geomFactory===null&&(this.geomFactory=new Zn),this.polygonize(),this.extractOnlyPolygonal?this.geomFactory.buildGeometry(this.polyList):this.geomFactory.createGeometryCollection(Zn.toGeometryArray(this.polyList))},getInvalidRingLines:function(){return this.polygonize(),this.invalidRingLines},findValidRings:function(e,r,u){for(var g=e.iterator();g.hasNext();){var w=g.next();w.isValid()?r.add(w):u.add(w.getLineString())}},polygonize:function(){if(this.polyList!==null||(this.polyList=new ze,this.graph===null))return null;this.dangles=this.graph.deleteDangles(),this.cutEdges=this.graph.deleteCutEdges();var e=this.graph.getEdgeRings(),r=new ze;this.invalidRingLines=new ze,this.isCheckingRingsValid?this.findValidRings(e,r,this.invalidRingLines):r=e,this.findShellsAndHoles(r),ms.assignHolesToShells(this.holeList,this.shellList),Hs.sort(this.shellList,new ps.EnvelopeComparator);var u=!0;this.extractOnlyPolygonal&&(ms.findDisjointShells(this.shellList),u=!1),this.polyList=ms.extractPolygons(this.shellList,u)},getDangles:function(){return this.polygonize(),this.dangles},getCutEdges:function(){return this.polygonize(),this.cutEdges},getPolygons:function(){return this.polygonize(),this.polyList},add:function(){if(kt(arguments[0],Bt))for(var e=arguments[0],r=e.iterator();r.hasNext();){var u=r.next();this.add(u)}else if(arguments[0]instanceof Fn){var g=arguments[0];this.geomFactory=g.getFactory(),this.graph===null&&(this.graph=new gr(this.geomFactory)),this.graph.addEdge(g)}else if(arguments[0]instanceof Jt){var w=arguments[0];w.apply(this.lineStringAdder)}},setCheckRingsValid:function(e){this.isCheckingRingsValid=e},findShellsAndHoles:function(e){this.holeList=new ze,this.shellList=new ze;for(var r=e.iterator();r.hasNext();){var u=r.next();u.computeHole(),u.isHole()?this.holeList.add(u):this.shellList.add(u)}},interfaces_:function(){return[]},getClass:function(){return ms}}),ms.findOuterShells=function(e){for(var r=e.iterator();r.hasNext();){var u=r.next(),g=u.getOuterHole();g===null||g.isProcessed()||(u.setIncluded(!0),g.setProcessed(!0))}},ms.extractPolygons=function(e,r){for(var u=new ze,g=e.iterator();g.hasNext();){var w=g.next();(r||w.isIncluded())&&u.add(w.getPolygon())}return u},ms.assignHolesToShells=function(e,r){for(var u=e.iterator();u.hasNext();){var g=u.next();ms.assignHoleToShell(g,r)}},ms.assignHoleToShell=function(e,r){var u=ps.findEdgeRingContaining(e,r);u!==null&&u.addHole(e)},ms.findDisjointShells=function(e){ms.findOuterShells(e);var r=null;do{r=!1;for(var u=e.iterator();u.hasNext();){var g=u.next();g.isIncludedSet()||(g.updateIncluded(),g.isIncludedSet()||(r=!0))}}while(r)},N(il.prototype,{filter:function(e){e instanceof Fn&&this.p.add(e)},interfaces_:function(){return[es]},getClass:function(){return il}}),ms.LineStringAdder=il;var pc=Object.freeze({Polygonizer:ms});N(Vl.prototype,{createEdgeEndForNext:function(e,r,u,g){var w=u.segmentIndex+1;if(w>=e.getNumPoints()&&g===null)return null;var O=e.getCoordinate(w);g!==null&&g.segmentIndex===u.segmentIndex&&(O=g.coord);var H=new uo(e,u.coord,O,new Mi(e.getLabel()));r.add(H)},createEdgeEndForPrev:function(e,r,u,g){var w=u.segmentIndex;if(u.dist===0){if(w===0)return null;w--}var O=e.getCoordinate(w);g!==null&&g.segmentIndex>=w&&(O=g.coord);var H=new Mi(e.getLabel());H.flip();var Q=new uo(e,u.coord,O,H);r.add(Q)},computeEdgeEnds:function(){if(arguments.length===1){for(var e=arguments[0],r=new ze,u=e;u.hasNext();){var g=u.next();this.computeEdgeEnds(g,r)}return r}if(arguments.length===2){var w=arguments[0],O=arguments[1],H=w.getEdgeIntersectionList();H.addEndpoints();var Q=H.iterator(),ye=null,Ue=null;if(!Q.hasNext())return null;var ct=Q.next();do ye=Ue,Ue=ct,ct=null,Q.hasNext()&&(ct=Q.next()),Ue!==null&&(this.createEdgeEndForPrev(w,O,Ue,ye),this.createEdgeEndForNext(w,O,Ue,ct));while(Ue!==null)}},interfaces_:function(){return[]},getClass:function(){return Vl}}),Te(Qo,uo),N(Qo.prototype,{insert:function(e){this.edgeEnds.add(e)},print:function(e){e.println("EdgeEndBundle--> Label: "+this.label);for(var r=this.iterator();r.hasNext();){var u=r.next();u.print(e),e.println()}},iterator:function(){return this.edgeEnds.iterator()},getEdgeEnds:function(){return this.edgeEnds},computeLabelOn:function(e,r){for(var u=0,g=!1,w=this.iterator();w.hasNext();){var O=w.next(),H=O.getLabel().getLocation(e);H===le.BOUNDARY&&u++,H===le.INTERIOR&&(g=!0)}var H=le.NONE;g&&(H=le.INTERIOR),u>0&&(H=li.determineBoundary(r,u)),this.label.setLocation(e,H)},computeLabelSide:function(e,r){for(var u=this.iterator();u.hasNext();){var g=u.next();if(g.getLabel().isArea()){var w=g.getLabel().getLocation(e,r);if(w===le.INTERIOR)return this.label.setLocation(e,r,le.INTERIOR),null;w===le.EXTERIOR&&this.label.setLocation(e,r,le.EXTERIOR)}}},getLabel:function(){return this.label},computeLabelSides:function(e){this.computeLabelSide(e,At.LEFT),this.computeLabelSide(e,At.RIGHT)},updateIM:function(e){Cr.updateIM(this.label,e)},computeLabel:function(e){for(var r=!1,u=this.iterator();u.hasNext();){var g=u.next();g.getLabel().isArea()&&(r=!0)}r?this.label=new Mi(le.NONE,le.NONE,le.NONE):this.label=new Mi(le.NONE);for(var w=0;2>w;w++)this.computeLabelOn(w,e),r&&this.computeLabelSides(w)},interfaces_:function(){return[]},getClass:function(){return Qo}}),Te(ic,Xs),N(ic.prototype,{updateIM:function(e){for(var r=this.iterator();r.hasNext();){var u=r.next();u.updateIM(e)}},insert:function(e){var r=this.edgeMap.get(e);r===null?(r=new Qo(e),this.insertEdgeEnd(e,r)):r.insert(e)},interfaces_:function(){return[]},getClass:function(){return ic}}),Te(Iu,rs),N(Iu.prototype,{updateIMFromEdges:function(e){this.edges.updateIM(e)},computeIM:function(e){e.setAtLeastIfValid(this.label.getLocation(0),this.label.getLocation(1),0)},interfaces_:function(){return[]},getClass:function(){return Iu}}),Te(Ul,Dl),N(Ul.prototype,{createNode:function(e){return new Iu(e,new ic)},interfaces_:function(){return[]},getClass:function(){return Ul}}),N(Tu.prototype,{insertEdgeEnds:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();this.nodes.add(u)}},computeProperIntersectionIM:function(e,r){var u=this.arg[0].getGeometry().getDimension(),g=this.arg[1].getGeometry().getDimension(),w=e.hasProperIntersection(),O=e.hasProperInteriorIntersection();u===2&&g===2?w&&r.setAtLeast("212101212"):u===2&&g===1?(w&&r.setAtLeast("FFF0FFFF2"),O&&r.setAtLeast("1FFFFF1FF")):u===1&&g===2?(w&&r.setAtLeast("F0FFFFFF2"),O&&r.setAtLeast("1F1FFFFFF")):u===1&&g===1&&O&&r.setAtLeast("0FFFFFFFF")},labelIsolatedEdges:function(e,r){for(var u=this.arg[e].getEdgeIterator();u.hasNext();){var g=u.next();g.isIsolated()&&(this.labelIsolatedEdge(g,r,this.arg[r].getGeometry()),this.isolatedEdges.add(g))}},labelIsolatedEdge:function(e,r,u){if(u.getDimension()>0){var g=this.ptLocator.locate(e.getCoordinate(),u);e.getLabel().setAllLocations(r,g)}else e.getLabel().setAllLocations(r,le.EXTERIOR)},computeIM:function(){var e=new Jn;if(e.set(le.EXTERIOR,le.EXTERIOR,2),!this.arg[0].getGeometry().getEnvelopeInternal().intersects(this.arg[1].getGeometry().getEnvelopeInternal()))return this.computeDisjointIM(e),e;this.arg[0].computeSelfNodes(this.li,!1),this.arg[1].computeSelfNodes(this.li,!1);var r=this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!1);this.computeIntersectionNodes(0),this.computeIntersectionNodes(1),this.copyNodesAndLabels(0),this.copyNodesAndLabels(1),this.labelIsolatedNodes(),this.computeProperIntersectionIM(r,e);var u=new Vl,g=u.computeEdgeEnds(this.arg[0].getEdgeIterator());this.insertEdgeEnds(g);var w=u.computeEdgeEnds(this.arg[1].getEdgeIterator());return this.insertEdgeEnds(w),this.labelNodeEdges(),this.labelIsolatedEdges(0,1),this.labelIsolatedEdges(1,0),this.updateIM(e),e},labelNodeEdges:function(){for(var e=this.nodes.iterator();e.hasNext();){var r=e.next();r.getEdges().computeLabelling(this.arg)}},copyNodesAndLabels:function(e){for(var r=this.arg[e].getNodeIterator();r.hasNext();){var u=r.next(),g=this.nodes.addNode(u.getCoordinate());g.setLabel(e,u.getLabel().getLocation(e))}},labelIntersectionNodes:function(e){for(var r=this.arg[e].getEdgeIterator();r.hasNext();)for(var u=r.next(),g=u.getLabel().getLocation(e),w=u.getEdgeIntersectionList().iterator();w.hasNext();){var O=w.next(),H=this.nodes.find(O.coord);H.getLabel().isNull(e)&&(g===le.BOUNDARY?H.setLabelBoundary(e):H.setLabel(e,le.INTERIOR))}},labelIsolatedNode:function(e,r){var u=this.ptLocator.locate(e.getCoordinate(),this.arg[r].getGeometry());e.getLabel().setAllLocations(r,u)},computeIntersectionNodes:function(e){for(var r=this.arg[e].getEdgeIterator();r.hasNext();)for(var u=r.next(),g=u.getLabel().getLocation(e),w=u.getEdgeIntersectionList().iterator();w.hasNext();){var O=w.next(),H=this.nodes.addNode(O.coord);g===le.BOUNDARY?H.setLabelBoundary(e):H.getLabel().isNull(e)&&H.setLabel(e,le.INTERIOR)}},labelIsolatedNodes:function(){for(var e=this.nodes.iterator();e.hasNext();){var r=e.next(),u=r.getLabel();Pe.isTrue(u.getGeometryCount()>0,"node with empty label found"),r.isIsolated()&&(u.isNull(0)?this.labelIsolatedNode(r,0):this.labelIsolatedNode(r,1))}},updateIM:function(e){for(var r=this.isolatedEdges.iterator();r.hasNext();){var u=r.next();u.updateIM(e)}for(var g=this.nodes.iterator();g.hasNext();){var w=g.next();w.updateIM(e),w.updateIMFromEdges(e)}},computeDisjointIM:function(e){var r=this.arg[0].getGeometry();r.isEmpty()||(e.set(le.INTERIOR,le.EXTERIOR,r.getDimension()),e.set(le.BOUNDARY,le.EXTERIOR,r.getBoundaryDimension()));var u=this.arg[1].getGeometry();u.isEmpty()||(e.set(le.EXTERIOR,le.INTERIOR,u.getDimension()),e.set(le.EXTERIOR,le.BOUNDARY,u.getBoundaryDimension()))},interfaces_:function(){return[]},getClass:function(){return Tu}}),N(Do.prototype,{isContainedInBoundary:function(e){if(e instanceof ne)return!1;if(e instanceof Fi)return this.isPointContainedInBoundary(e);if(e instanceof Fn)return this.isLineStringContainedInBoundary(e);for(var r=0;r<e.getNumGeometries();r++){var u=e.getGeometryN(r);if(!this.isContainedInBoundary(u))return!1}return!0},isLineSegmentContainedInBoundary:function(e,r){if(e.equals(r))return this.isPointContainedInBoundary(e);if(e.x===r.x){if(e.x===this.rectEnv.getMinX()||e.x===this.rectEnv.getMaxX())return!0}else if(e.y===r.y&&(e.y===this.rectEnv.getMinY()||e.y===this.rectEnv.getMaxY()))return!0;return!1},isLineStringContainedInBoundary:function(e){for(var r=e.getCoordinateSequence(),u=new ve,g=new ve,w=0;w<r.size()-1;w++)if(r.getCoordinate(w,u),r.getCoordinate(w+1,g),!this.isLineSegmentContainedInBoundary(u,g))return!1;return!0},isPointContainedInBoundary:function(){if(arguments[0]instanceof Fi){var e=arguments[0];return this.isPointContainedInBoundary(e.getCoordinate())}if(arguments[0]instanceof ve){var r=arguments[0];return r.x===this.rectEnv.getMinX()||r.x===this.rectEnv.getMaxX()||r.y===this.rectEnv.getMinY()||r.y===this.rectEnv.getMaxY()}},contains:function(e){return this.rectEnv.contains(e.getEnvelopeInternal())?!this.isContainedInBoundary(e):!1},interfaces_:function(){return[]},getClass:function(){return Do}}),Do.contains=function(e,r){var u=new Do(e);return u.contains(r)},N(Oc.prototype,{intersects:function(e,r){var u=new et(e,r);if(!this.rectEnv.intersects(u))return!1;if(this.rectEnv.intersects(e)||this.rectEnv.intersects(r))return!0;if(e.compareTo(r)>0){var g=e;e=r,r=g}var w=!1;return r.y>e.y&&(w=!0),w?this.li.computeIntersection(e,r,this.diagDown0,this.diagDown1):this.li.computeIntersection(e,r,this.diagUp0,this.diagUp1),!!this.li.hasIntersection()},interfaces_:function(){return[]},getClass:function(){return Oc}}),N(Ts.prototype,{applyTo:function(e){for(var r=0;r<e.getNumGeometries()&&!this._isDone;r++){var u=e.getGeometryN(r);if(u instanceof jn)this.applyTo(u);else if(this.visit(u),this.isDone())return this._isDone=!0,null}},interfaces_:function(){return[]},getClass:function(){return Ts}}),N(Pa.prototype,{intersects:function(e){if(!this.rectEnv.intersects(e.getEnvelopeInternal()))return!1;var r=new ea(this.rectEnv);if(r.applyTo(e),r.intersects())return!0;var u=new rc(this.rectangle);if(u.applyTo(e),u.containsPoint())return!0;var g=new Su(this.rectangle);return g.applyTo(e),!!g.intersects()},interfaces_:function(){return[]},getClass:function(){return Pa}}),Pa.intersects=function(e,r){var u=new Pa(e);return u.intersects(r)},Te(ea,Ts),N(ea.prototype,{isDone:function(){return this._intersects===!0},visit:function(e){var r=e.getEnvelopeInternal();return this.rectEnv.intersects(r)?this.rectEnv.contains(r)?(this._intersects=!0,null):r.getMinX()>=this.rectEnv.getMinX()&&r.getMaxX()<=this.rectEnv.getMaxX()?(this._intersects=!0,null):r.getMinY()>=this.rectEnv.getMinY()&&r.getMaxY()<=this.rectEnv.getMaxY()?(this._intersects=!0,null):void 0:null},intersects:function(){return this._intersects},interfaces_:function(){return[]},getClass:function(){return ea}}),Te(rc,Ts),N(rc.prototype,{isDone:function(){return this._containsPoint===!0},visit:function(e){if(!(e instanceof ne))return null;var r=e.getEnvelopeInternal();if(!this.rectEnv.intersects(r))return null;for(var u=new ve,g=0;4>g;g++)if(this.rectSeq.getCoordinate(g,u),r.contains(u)&&ss.containsPointInPolygon(u,e))return this._containsPoint=!0,null},containsPoint:function(){return this._containsPoint},interfaces_:function(){return[]},getClass:function(){return rc}}),Te(Su,Ts),N(Su.prototype,{intersects:function(){return this.hasIntersection},isDone:function(){return this.hasIntersection===!0},visit:function(e){var r=e.getEnvelopeInternal();if(!this.rectEnv.intersects(r))return null;var u=Fr.getLines(e);this.checkIntersectionWithLineStrings(u)},checkIntersectionWithLineStrings:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();if(this.checkIntersectionWithSegments(u),this.hasIntersection)return null}},checkIntersectionWithSegments:function(e){for(var r=e.getCoordinateSequence(),u=1;u<r.size();u++)if(r.getCoordinate(u-1,this.p0),r.getCoordinate(u,this.p1),this.rectIntersector.intersects(this.p0,this.p1))return this.hasIntersection=!0,null},interfaces_:function(){return[]},getClass:function(){return Su}}),Te(ci,Xo),N(ci.prototype,{getIntersectionMatrix:function(){return this._relate.computeIM()},interfaces_:function(){return[]},getClass:function(){return ci}}),ci.covers=function(e,r){return e.getEnvelopeInternal().covers(r.getEnvelopeInternal())?e.isRectangle()?!0:ci.relate(e,r).isCovers():!1},ci.intersects=function(e,r){return e.getEnvelopeInternal().intersects(r.getEnvelopeInternal())?e.isRectangle()?Pa.intersects(e,r):r.isRectangle()?Pa.intersects(r,e):ci.relate(e,r).isIntersects():!1},ci.touches=function(e,r){return e.getEnvelopeInternal().intersects(r.getEnvelopeInternal())?ci.relate(e,r).isTouches(e.getDimension(),r.getDimension()):!1},ci.within=function(e,r){return r.contains(e)},ci.coveredBy=function(e,r){return ci.covers(r,e)},ci.relate=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],u=new ci(e,r),g=u.getIntersectionMatrix();return g}if(arguments.length===3){if(typeof arguments[2]=="string"&&arguments[0]instanceof Jt&&arguments[1]instanceof Jt){var w=arguments[0],O=arguments[1],H=arguments[2];return ci.relateWithCheck(w,O).matches(H)}if(kt(arguments[2],tr)&&arguments[0]instanceof Jt&&arguments[1]instanceof Jt){var Q=arguments[0],ye=arguments[1],Ue=arguments[2],u=new ci(Q,ye,Ue),g=u.getIntersectionMatrix();return g}}},ci.overlaps=function(e,r){return e.getEnvelopeInternal().intersects(r.getEnvelopeInternal())?ci.relate(e,r).isOverlaps(e.getDimension(),r.getDimension()):!1},ci.disjoint=function(e,r){return!e.intersects(r)},ci.relateWithCheck=function(e,r){return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(r),ci.relate(e,r)},ci.crosses=function(e,r){return e.getEnvelopeInternal().intersects(r.getEnvelopeInternal())?ci.relate(e,r).isCrosses(e.getDimension(),r.getDimension()):!1},ci.contains=function(e,r){return e.getEnvelopeInternal().contains(r.getEnvelopeInternal())?e.isRectangle()?Do.contains(e,r):ci.relate(e,r).isContains():!1};var za=Object.freeze({RelateOp:ci});N(Ss.prototype,{extractElements:function(e,r){if(e===null)return null;for(var u=0;u<e.getNumGeometries();u++){var g=e.getGeometryN(u);this.skipEmpty&&g.isEmpty()||r.add(g)}},combine:function(){for(var e=new ze,r=this.inputGeoms.iterator();r.hasNext();){var u=r.next();this.extractElements(u,e)}return e.size()===0?this.geomFactory!==null?this.geomFactory.createGeometryCollection(null):null:this.geomFactory.buildGeometry(e)},interfaces_:function(){return[]},getClass:function(){return Ss}}),Ss.combine=function(){if(arguments.length===1){var e=arguments[0],r=new Ss(e);return r.combine()}if(arguments.length===2){var u=arguments[0],g=arguments[1],r=new Ss(Ss.createList(u,g));return r.combine()}if(arguments.length===3){var w=arguments[0],O=arguments[1],H=arguments[2],r=new Ss(Ss.createList(w,O,H));return r.combine()}},Ss.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()},Ss.createList=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],u=new ze;return u.add(e),u.add(r),u}if(arguments.length===3){var g=arguments[0],w=arguments[1],O=arguments[2],u=new ze;return u.add(g),u.add(w),u.add(O),u}},N(Cu.prototype,{union:function(){for(var e=new _a,r=new dr,u=0;u<this.pointGeom.getNumGeometries();u++){var g=this.pointGeom.getGeometryN(u),w=g.getCoordinate(),O=e.locate(w,this.otherGeom);O===le.EXTERIOR&&r.add(w)}if(r.size()===0)return this.otherGeom;var H=null,Q=bn.toCoordinateArray(r);return H=Q.length===1?this.geomFact.createPoint(Q[0]):this.geomFact.createMultiPointFromCoords(Q),Ss.combine(H,this.otherGeom)},interfaces_:function(){return[]},getClass:function(){return Cu}}),Cu.union=function(e,r){var u=new Cu(e,r);return u.union()},N(ta.prototype,{filter:function(e){this.sortIndex!==-1&&e.getSortIndex()!==this.sortIndex||this.comps.add(e)},interfaces_:function(){return[Fs]},getClass:function(){return ta}}),ta.extract=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];return ta.extract(e,r,new ze)}if(arguments.length===3){var u=arguments[0],g=arguments[1],w=arguments[2];return u.getSortIndex()===g?w.add(u):u instanceof jn&&u.apply(new ta(g,w)),w}},N(gs.prototype,{reduceToGeometries:function(e){for(var r=new ze,u=e.iterator();u.hasNext();){var g=u.next(),w=null;kt(g,Ae)?w=this.unionTree(g):g instanceof Jt&&(w=g),r.add(w)}return r},extractByEnvelope:function(e,r,u){for(var g=new ze,w=0;w<r.getNumGeometries();w++){var O=r.getGeometryN(w);O.getEnvelopeInternal().intersects(e)?g.add(O):u.add(O)}return this.geomFactory.buildGeometry(g)},unionOptimized:function(e,r){var u=e.getEnvelopeInternal(),g=r.getEnvelopeInternal();if(!u.intersects(g)){var w=Ss.combine(e,r);return w}if(e.getNumGeometries()<=1&&r.getNumGeometries()<=1)return this.unionActual(e,r);var O=u.intersection(g);return this.unionUsingEnvelopeIntersection(e,r,O)},union:function(){if(this.inputPolys===null)throw new IllegalStateException("union() method cannot be called twice");if(this.inputPolys.isEmpty())return null;this.geomFactory=this.inputPolys.iterator().next().getFactory();for(var e=new cn(gs.STRTREE_NODE_CAPACITY),r=this.inputPolys.iterator();r.hasNext();){var u=r.next();e.insert(u.getEnvelopeInternal(),u)}this.inputPolys=null;var g=e.itemsTree(),w=this.unionTree(g);return w},binaryUnion:function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}if(arguments.length===3){var r=arguments[0],u=arguments[1],g=arguments[2];if(1>=g-u){var O=gs.getGeometry(r,u);return this.unionSafe(O,null)}if(g-u===2)return this.unionSafe(gs.getGeometry(r,u),gs.getGeometry(r,u+1));var w=Math.trunc((g+u)/2),O=this.binaryUnion(r,u,w),H=this.binaryUnion(r,w,g);return this.unionSafe(O,H)}},repeatedUnion:function(e){for(var r=null,u=e.iterator();u.hasNext();){var g=u.next();r=r===null?g.copy():r.union(g)}return r},unionSafe:function(e,r){return e===null&&r===null?null:e===null?r.copy():r===null?e.copy():this.unionOptimized(e,r)},unionActual:function(e,r){return gs.restrictToPolygons(e.union(r))},unionTree:function(e){var r=this.reduceToGeometries(e),u=this.binaryUnion(r);return u},unionUsingEnvelopeIntersection:function(e,r,u){var g=new ze,w=this.extractByEnvelope(u,e,g),O=this.extractByEnvelope(u,r,g),H=this.unionActual(w,O);g.add(H);var Q=Ss.combine(g);return Q},bufferUnion:function(){if(arguments.length===1){var e=arguments[0],r=e.get(0).getFactory(),u=r.buildGeometry(e),g=u.buffer(0);return g}if(arguments.length===2){var w=arguments[0],O=arguments[1],r=w.getFactory(),u=r.createGeometryCollection([w,O]),g=u.buffer(0);return g}},interfaces_:function(){return[]},getClass:function(){return gs}}),gs.restrictToPolygons=function(e){if(kt(e,Ke))return e;var r=Ro.getPolygons(e);return r.size()===1?r.get(0):e.getFactory().createMultiPolygon(Zn.toPolygonArray(r))},gs.getGeometry=function(e,r){return r>=e.size()?null:e.get(r)},gs.union=function(e){var r=new gs(e);return r.union()},gs.STRTREE_NODE_CAPACITY=4,N(rl.prototype,{unionNoOpt:function(e){var r=this.geomFact.createPoint();return or.overlayOp(e,r,fn.UNION)},unionWithNull:function(e,r){return e===null&&r===null?null:r===null?e:e===null?r:e.union(r)},extract:function(){if(kt(arguments[0],Bt))for(var e=arguments[0],r=e.iterator();r.hasNext();){var u=r.next();this.extract(u)}else if(arguments[0]instanceof Jt){var g=arguments[0];this.geomFact===null&&(this.geomFact=g.getFactory()),ta.extract(g,Jt.SORTINDEX_POLYGON,this.polygons),ta.extract(g,Jt.SORTINDEX_LINESTRING,this.lines),ta.extract(g,Jt.SORTINDEX_POINT,this.points)}},union:function(){if(this.geomFact===null)return null;var r=null;if(this.points.size()>0){var u=this.geomFact.buildGeometry(this.points);r=this.unionNoOpt(u)}var g=null;if(this.lines.size()>0){var w=this.geomFact.buildGeometry(this.lines);g=this.unionNoOpt(w)}var O=null;this.polygons.size()>0&&(O=gs.union(this.polygons));var H=this.unionWithNull(g,O),Q=null;return Q=r===null?H:H===null?r:Cu.union(r,H),Q===null?this.geomFact.createGeometryCollection():Q},interfaces_:function(){return[]},getClass:function(){return rl}}),rl.union=function(){if(arguments.length===1){if(kt(arguments[0],Bt)){var e=arguments[0],r=new rl(e);return r.union()}if(arguments[0]instanceof Jt){var u=arguments[0],r=new rl(u);return r.union()}}else if(arguments.length===2){var g=arguments[0],w=arguments[1],r=new rl(g,w);return r.union()}};var gl=Object.freeze({UnaryUnionOp:rl});N(sc.prototype,{visitInteriorRing:function(e,r){var u=e.getCoordinates(),g=u[0],w=sc.findDifferentPoint(u,g),O=r.findEdgeInSameDirection(g,w),H=r.findEdgeEnd(O),Q=null;H.getLabel().getLocation(0,At.RIGHT)===le.INTERIOR?Q=H:H.getSym().getLabel().getLocation(0,At.RIGHT)===le.INTERIOR&&(Q=H.getSym()),Pe.isTrue(Q!==null,"unable to find dirEdge with Interior on RHS"),this.visitLinkedDirectedEdges(Q)},visitShellInteriors:function(e,r){if(e instanceof ne){var u=e;this.visitInteriorRing(u.getExteriorRing(),r)}if(e instanceof Oe)for(var g=e,w=0;w<g.getNumGeometries();w++){var u=g.getGeometryN(w);this.visitInteriorRing(u.getExteriorRing(),r)}},getCoordinate:function(){return this.disconnectedRingcoord},setInteriorEdgesInResult:function(e){for(var r=e.getEdgeEnds().iterator();r.hasNext();){var u=r.next();u.getLabel().getLocation(0,At.RIGHT)===le.INTERIOR&&u.setInResult(!0)}},visitLinkedDirectedEdges:function(e){var r=e,u=e;do Pe.isTrue(u!==null,"found null Directed Edge"),u.setVisited(!0),u=u.getNext();while(u!==r)},buildEdgeRings:function(e){for(var r=new ze,u=e.iterator();u.hasNext();){var g=u.next();if(g.isInResult()&&g.getEdgeRing()===null){var w=new Mo(g,this.geometryFactory);w.linkDirectedEdgesForMinimalEdgeRings();var O=w.buildMinimalRings();r.addAll(O)}}return r},hasUnvisitedShellEdge:function(e){for(var r=0;r<e.size();r++){var u=e.get(r);if(!u.isHole()){var g=u.getEdges(),w=g.get(0);if(w.getLabel().getLocation(0,At.RIGHT)===le.INTERIOR){for(var O=0;O<g.size();O++)if(w=g.get(O),!w.isVisited())return this.disconnectedRingcoord=w.getCoordinate(),!0}}}return!1},isInteriorsConnected:function(){var e=new ze;this.geomGraph.computeSplitEdges(e);var r=new Vs(new Po);r.addEdges(e),this.setInteriorEdgesInResult(r),r.linkResultDirectedEdges();var u=this.buildEdgeRings(r.getEdgeEnds());return this.visitShellInteriors(this.geomGraph.getGeometry(),r),!this.hasUnvisitedShellEdge(u)},interfaces_:function(){return[]},getClass:function(){return sc}}),sc.findDifferentPoint=function(e,r){for(var u=0;u<e.length;u++)if(!e[u].equals(r))return e[u];return null},N(Js.prototype,{hasChildren:function(){for(var e=0;2>e;e++)if(this.subnode[e]!==null)return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(e){e.addAll(this.items);for(var r=0;2>r;r++)this.subnode[r]!==null&&this.subnode[r].addAllItems(e);return e},size:function(){for(var e=0,r=0;2>r;r++)this.subnode[r]!==null&&(e+=this.subnode[r].size());return e+this.items.size()},addAllItemsFromOverlapping:function(e,r){return e===null||this.isSearchMatch(e)?(r.addAll(this.items),this.subnode[0]!==null&&this.subnode[0].addAllItemsFromOverlapping(e,r),void(this.subnode[1]!==null&&this.subnode[1].addAllItemsFromOverlapping(e,r))):null},hasItems:function(){return!this.items.isEmpty()},remove:function(e,r){if(!this.isSearchMatch(e))return!1;for(var u=!1,g=0;2>g;g++)if(this.subnode[g]!==null&&(u=this.subnode[g].remove(e,r))){this.subnode[g].isPrunable()&&(this.subnode[g]=null);break}return u||(u=this.items.remove(r))},getItems:function(){return this.items},depth:function(){for(var e=0,r=0;2>r;r++)if(this.subnode[r]!==null){var u=this.subnode[r].depth();u>e&&(e=u)}return e+1},nodeSize:function(){for(var e=0,r=0;2>r;r++)this.subnode[r]!==null&&(e+=this.subnode[r].nodeSize());return e+1},add:function(e){this.items.add(e)},interfaces_:function(){return[]},getClass:function(){return Js}}),Js.getSubnodeIndex=function(e,r){var u=-1;return e.min>=r&&(u=1),e.max<=r&&(u=0),u},N(na.prototype,{expandToInclude:function(e){e.max>this.max&&(this.max=e.max),e.min<this.min&&(this.min=e.min)},getWidth:function(){return this.max-this.min},overlaps:function(){if(arguments.length===1){var e=arguments[0];return this.overlaps(e.min,e.max)}if(arguments.length===2){var r=arguments[0],u=arguments[1];return!(this.min>u||this.max<r)}},getMin:function(){return this.min},toString:function(){return"["+this.min+", "+this.max+"]"},contains:function(){if(arguments.length===1){if(arguments[0]instanceof na){var e=arguments[0];return this.contains(e.min,e.max)}if(typeof arguments[0]=="number"){var r=arguments[0];return r>=this.min&&r<=this.max}}else if(arguments.length===2){var u=arguments[0],g=arguments[1];return u>=this.min&&g<=this.max}},init:function(e,r){this.min=e,this.max=r,e>r&&(this.min=r,this.max=e)},getMax:function(){return this.max},interfaces_:function(){return[]},getClass:function(){return na}}),N(Gl.prototype,{getInterval:function(){return this.interval},getLevel:function(){return this.level},computeKey:function(e){for(this.level=Gl.computeLevel(e),this.interval=new na,this.computeInterval(this.level,e);!this.interval.contains(e);)this.level+=1,this.computeInterval(this.level,e)},computeInterval:function(e,r){var u=ba.powerOf2(e);this.pt=Math.floor(r.getMin()/u)*u,this.interval.init(this.pt,this.pt+u)},getPoint:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return Gl}}),Gl.computeLevel=function(e){var r=e.getWidth(),u=ba.exponent(r)+1;return u},Te(yo,Js),N(yo.prototype,{getInterval:function(){return this.interval},find:function(e){var r=Js.getSubnodeIndex(e,this.centre);if(r===-1)return this;if(this.subnode[r]!==null){var u=this.subnode[r];return u.find(e)}return this},insert:function(e){Pe.isTrue(this.interval===null||this.interval.contains(e.interval));var r=Js.getSubnodeIndex(e.interval,this.centre);if(e.level===this.level-1)this.subnode[r]=e;else{var u=this.createSubnode(r);u.insert(e),this.subnode[r]=u}},isSearchMatch:function(e){return e.overlaps(this.interval)},getSubnode:function(e){return this.subnode[e]===null&&(this.subnode[e]=this.createSubnode(e)),this.subnode[e]},getNode:function(e){var r=Js.getSubnodeIndex(e,this.centre);if(r!==-1){var u=this.getSubnode(r);return u.getNode(e)}return this},createSubnode:function(e){var r=0,u=0;switch(e){case 0:r=this.interval.getMin(),u=this.centre;break;case 1:r=this.centre,u=this.interval.getMax()}var g=new na(r,u),w=new yo(g,this.level-1);return w},interfaces_:function(){return[]},getClass:function(){return yo}}),yo.createNode=function(e){var r=new Gl(e),u=new yo(r.getInterval(),r.getLevel());return u},yo.createExpanded=function(e,r){var u=new na(r);e!==null&&u.expandToInclude(e.interval);var g=yo.createNode(u);return e!==null&&g.insert(e),g},Te(Oo,Js),N(Oo.prototype,{insert:function(e,r){var u=Js.getSubnodeIndex(e,Oo.origin);if(u===-1)return this.add(r),null;var g=this.subnode[u];if(g===null||!g.getInterval().contains(e)){var w=yo.createExpanded(g,e);this.subnode[u]=w}this.insertContained(this.subnode[u],e,r)},isSearchMatch:function(e){return!0},insertContained:function(e,r,u){Pe.isTrue(e.getInterval().contains(r));var g=po.isZeroWidth(r.getMin(),r.getMax()),w=null;w=g?e.find(r):e.getNode(r),w.add(u)},interfaces_:function(){return[]},getClass:function(){return Oo}}),Oo.origin=0,N(La.prototype,{size:function(){return this.root!==null?this.root.size():0},insert:function(e,r){this.collectStats(e);var u=La.ensureExtent(e,this.minExtent);this.root.insert(u,r)},query:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];return this.query(new na(e,e))}if(arguments[0]instanceof na){var r=arguments[0],u=new ze;return this.query(r,u),u}}else if(arguments.length===2){var g=arguments[0],w=arguments[1];this.root.addAllItemsFromOverlapping(g,w)}},iterator:function(){var e=new ze;return this.root.addAllItems(e),e.iterator()},remove:function(e,r){var u=La.ensureExtent(e,this.minExtent);return this.root.remove(u,r)},collectStats:function(e){var r=e.getWidth();r<this.minExtent&&r>0&&(this.minExtent=r)},depth:function(){return this.root!==null?this.root.depth():0},nodeSize:function(){return this.root!==null?this.root.nodeSize():0},interfaces_:function(){return[]},getClass:function(){return La}}),La.ensureExtent=function(e,r){var u=e.getMin(),g=e.getMax();return u!==g?e:(u===g&&(u-=r/2,g=u+r/2),new na(u,g))},N(ql.prototype,{isInside:function(e){},interfaces_:function(){return[]},getClass:function(){return ql}}),N(ia.prototype,{testLineSegment:function(e,r){var u=null,g=null,w=null,O=null,H=null,Q=r.p0,ye=r.p1;g=Q.x-e.x,w=Q.y-e.y,O=ye.x-e.x,H=ye.y-e.y,(w>0&&0>=H||H>0&&0>=w)&&(u=so.signOfDet2x2(g,w,O,H)/(H-w),u>0&&this.crossings++)},buildIndex:function(){this.tree=new La;for(var e=bn.removeRepeatedPoints(this.ring.getCoordinates()),r=cs.getChains(e),u=0;u<r.size();u++){var g=r.get(u),w=g.getEnvelope();this.interval.min=w.getMinY(),this.interval.max=w.getMaxY(),this.tree.insert(this.interval,g)}},testMonotoneChain:function(e,r,u){u.select(e,r)},isInside:function(e){this.crossings=0;var r=new et(te.NEGATIVE_INFINITY,te.POSITIVE_INFINITY,e.y,e.y);this.interval.min=e.y,this.interval.max=e.y;for(var u=this.tree.query(this.interval),g=new sl(this,e),w=u.iterator();w.hasNext();){var O=w.next();this.testMonotoneChain(r,g,O)}return this.crossings%2===1},interfaces_:function(){return[ql]},getClass:function(){return ia}}),Te(sl,Ko),N(sl.prototype,{select:function(){if(arguments.length!==1)return Ko.prototype.select.apply(this,arguments);var e=arguments[0];this.mcp.testLineSegment(this.p,e)},interfaces_:function(){return[]},getClass:function(){return sl}}),ia.MCSelecter=sl,N(Mu.prototype,{insertEdgeEnds:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();this.nodes.add(u)}},getNodeIterator:function(){return this.nodes.iterator()},copyNodesAndLabels:function(e,r){for(var u=e.getNodeIterator();u.hasNext();){var g=u.next(),w=this.nodes.addNode(g.getCoordinate());w.setLabel(r,g.getLabel().getLocation(r))}},build:function(e){this.computeIntersectionNodes(e,0),this.copyNodesAndLabels(e,0);var r=new Vl,u=r.computeEdgeEnds(e.getEdgeIterator());this.insertEdgeEnds(u)},computeIntersectionNodes:function(e,r){for(var u=e.getEdgeIterator();u.hasNext();)for(var g=u.next(),w=g.getLabel().getLocation(r),O=g.getEdgeIntersectionList().iterator();O.hasNext();){var H=O.next(),Q=this.nodes.addNode(H.coord);w===le.BOUNDARY?Q.setLabelBoundary(r):Q.getLabel().isNull(r)&&Q.setLabel(r,le.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return Mu}}),N(oc.prototype,{isNodeEdgeAreaLabelsConsistent:function(){for(var e=this.nodeGraph.getNodeIterator();e.hasNext();){var r=e.next();if(!r.getEdges().isAreaLabelsConsistent(this.geomGraph))return this.invalidPoint=r.getCoordinate().copy(),!1}return!0},getInvalidPoint:function(){return this.invalidPoint},hasDuplicateRings:function(){for(var e=this.nodeGraph.getNodeIterator();e.hasNext();)for(var r=e.next(),u=r.getEdges().iterator();u.hasNext();){var g=u.next();if(g.getEdgeEnds().size()>1)return this.invalidPoint=g.getEdge().getCoordinate(0),!0}return!1},isNodeConsistentArea:function(){var e=this.geomGraph.computeSelfNodes(this.li,!0,!0);return e.hasProperIntersection()?(this.invalidPoint=e.getProperIntersectionPoint(),!1):(this.nodeGraph.build(this.geomGraph),this.isNodeEdgeAreaLabelsConsistent())},interfaces_:function(){return[]},getClass:function(){return oc}}),N(ac.prototype,{buildIndex:function(){this.index=new cn;for(var e=0;e<this.rings.size();e++){var r=this.rings.get(e),u=r.getEnvelopeInternal();this.index.insert(u,r)}},getNestedPoint:function(){return this.nestedPt},isNonNested:function(){this.buildIndex();for(var e=0;e<this.rings.size();e++)for(var r=this.rings.get(e),u=r.getCoordinates(),g=this.index.query(r.getEnvelopeInternal()),w=0;w<g.size();w++){var O=g.get(w),H=O.getCoordinates();if(r!==O&&r.getEnvelopeInternal().intersects(O.getEnvelopeInternal())){var Q=Xr.findPtNotNode(u,O,this.graph);if(Q!==null){var ye=zt.isPointInRing(Q,H);if(ye)return this.nestedPt=Q,!1}}}return!0},add:function(e){this.rings.add(e),this.totalEnv.expandToInclude(e.getEnvelopeInternal())},interfaces_:function(){return[]},getClass:function(){return ac}}),N(hi.prototype,{getErrorType:function(){return this.errorType},getMessage:function(){return hi.errMsg[this.errorType]},getCoordinate:function(){return this.pt},toString:function(){var e="";return this.pt!==null&&(e=" at or near point "+this.pt),this.getMessage()+e},interfaces_:function(){return[]},getClass:function(){return hi}}),hi.ERROR=0,hi.REPEATED_POINT=1,hi.HOLE_OUTSIDE_SHELL=2,hi.NESTED_HOLES=3,hi.DISCONNECTED_INTERIOR=4,hi.SELF_INTERSECTION=5,hi.RING_SELF_INTERSECTION=6,hi.NESTED_SHELLS=7,hi.DUPLICATE_RINGS=8,hi.TOO_FEW_POINTS=9,hi.INVALID_COORDINATE=10,hi.RING_NOT_CLOSED=11,hi.errMsg=["Topology Validation Error","Repeated Point","Hole lies outside shell","Holes are nested","Interior is disconnected","Self-intersection","Ring Self-intersection","Nested shells","Duplicate Rings","Too few distinct points in geometry component","Invalid Coordinate","Ring is not closed"],N(Xr.prototype,{checkInvalidCoordinates:function(){if(arguments[0]instanceof Array){for(var e=arguments[0],r=0;r<e.length;r++)if(!Xr.isValid(e[r]))return this.validErr=new hi(hi.INVALID_COORDINATE,e[r]),null}else if(arguments[0]instanceof ne){var u=arguments[0];if(this.checkInvalidCoordinates(u.getExteriorRing().getCoordinates()),this.validErr!==null)return null;for(var r=0;r<u.getNumInteriorRing();r++)if(this.checkInvalidCoordinates(u.getInteriorRingN(r).getCoordinates()),this.validErr!==null)return null}},checkHolesNotNested:function(e,r){for(var u=new ac(r),g=0;g<e.getNumInteriorRing();g++){var w=e.getInteriorRingN(g);u.add(w)}var O=u.isNonNested();O||(this.validErr=new hi(hi.NESTED_HOLES,u.getNestedPoint()))},checkConsistentArea:function(e){var r=new oc(e),u=r.isNodeConsistentArea();return u?void(r.hasDuplicateRings()&&(this.validErr=new hi(hi.DUPLICATE_RINGS,r.getInvalidPoint()))):(this.validErr=new hi(hi.SELF_INTERSECTION,r.getInvalidPoint()),null)},isValid:function(){return this.checkValid(this.parentGeometry),this.validErr===null},checkShellInsideHole:function(e,r,u){var g=e.getCoordinates(),w=r.getCoordinates(),O=Xr.findPtNotNode(g,r,u);if(O!==null){var H=zt.isPointInRing(O,w);if(!H)return O}var Q=Xr.findPtNotNode(w,e,u);if(Q!==null){var ye=zt.isPointInRing(Q,g);return ye?Q:null}return Pe.shouldNeverReachHere("points in shell and hole appear to be equal"),null},checkNoSelfIntersectingRings:function(e){for(var r=e.getEdgeIterator();r.hasNext();){var u=r.next();if(this.checkNoSelfIntersectingRing(u.getEdgeIntersectionList()),this.validErr!==null)return null}},checkConnectedInteriors:function(e){var r=new sc(e);r.isInteriorsConnected()||(this.validErr=new hi(hi.DISCONNECTED_INTERIOR,r.getCoordinate()))},checkNoSelfIntersectingRing:function(e){for(var r=new dr,u=!0,g=e.iterator();g.hasNext();){var w=g.next();if(u)u=!1;else{if(r.contains(w.coord))return this.validErr=new hi(hi.RING_SELF_INTERSECTION,w.coord),null;r.add(w.coord)}}},checkHolesInShell:function(e,r){for(var u=e.getExteriorRing(),g=new ia(u),w=0;w<e.getNumInteriorRing();w++){var O=e.getInteriorRingN(w),H=Xr.findPtNotNode(O.getCoordinates(),u,r);if(H===null)return null;var Q=!g.isInside(H);if(Q)return this.validErr=new hi(hi.HOLE_OUTSIDE_SHELL,H),null}},checkTooFewPoints:function(e){return e.hasTooFewPoints()?(this.validErr=new hi(hi.TOO_FEW_POINTS,e.getInvalidPoint()),null):void 0},getValidationError:function(){return this.checkValid(this.parentGeometry),this.validErr},checkValid:function(){if(arguments[0]instanceof Fi){var e=arguments[0];this.checkInvalidCoordinates(e.getCoordinates())}else if(arguments[0]instanceof oe){var r=arguments[0];this.checkInvalidCoordinates(r.getCoordinates())}else if(arguments[0]instanceof ge){var u=arguments[0];if(this.checkInvalidCoordinates(u.getCoordinates()),this.validErr!==null||(this.checkClosedRing(u),this.validErr!==null))return null;var g=new li(0,u);if(this.checkTooFewPoints(g),this.validErr!==null)return null;var w=new pr;g.computeSelfNodes(w,!0,!0),this.checkNoSelfIntersectingRings(g)}else if(arguments[0]instanceof Fn){var O=arguments[0];if(this.checkInvalidCoordinates(O.getCoordinates()),this.validErr!==null)return null;var g=new li(0,O);this.checkTooFewPoints(g)}else if(arguments[0]instanceof ne){var H=arguments[0];if(this.checkInvalidCoordinates(H),this.validErr!==null||(this.checkClosedRings(H),this.validErr!==null))return null;var g=new li(0,H);if(this.checkTooFewPoints(g),this.validErr!==null||(this.checkConsistentArea(g),this.validErr!==null)||!this.isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(g),this.validErr!==null)||(this.checkHolesInShell(H,g),this.validErr!==null)||(this.checkHolesNotNested(H,g),this.validErr!==null))return null;this.checkConnectedInteriors(g)}else if(arguments[0]instanceof Oe){for(var Q=arguments[0],ye=0;ye<Q.getNumGeometries();ye++){var Ue=Q.getGeometryN(ye);if(this.checkInvalidCoordinates(Ue),this.validErr!==null||(this.checkClosedRings(Ue),this.validErr!==null))return null}var g=new li(0,Q);if(this.checkTooFewPoints(g),this.validErr!==null||(this.checkConsistentArea(g),this.validErr!==null)||!this.isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(g),this.validErr!==null))return null;for(var ye=0;ye<Q.getNumGeometries();ye++){var Ue=Q.getGeometryN(ye);if(this.checkHolesInShell(Ue,g),this.validErr!==null)return null}for(var ye=0;ye<Q.getNumGeometries();ye++){var Ue=Q.getGeometryN(ye);if(this.checkHolesNotNested(Ue,g),this.validErr!==null)return null}if(this.checkShellsNotNested(Q,g),this.validErr!==null)return null;this.checkConnectedInteriors(g)}else if(arguments[0]instanceof jn)for(var ct=arguments[0],ye=0;ye<ct.getNumGeometries();ye++){var yt=ct.getGeometryN(ye);if(this.checkValid(yt),this.validErr!==null)return null}else if(arguments[0]instanceof Jt){var Ft=arguments[0];if(this.validErr=null,Ft.isEmpty())return null;if(Ft instanceof Fi)this.checkValid(Ft);else if(Ft instanceof oe)this.checkValid(Ft);else if(Ft instanceof ge)this.checkValid(Ft);else if(Ft instanceof Fn)this.checkValid(Ft);else if(Ft instanceof ne)this.checkValid(Ft);else if(Ft instanceof Oe)this.checkValid(Ft);else{if(!(Ft instanceof jn))throw new UnsupportedOperationException(Ft.getClass().getName());this.checkValid(Ft)}}},setSelfTouchingRingFormingHoleValid:function(e){this.isSelfTouchingRingFormingHoleValid=e},checkShellNotNested:function(e,r,u){var g=e.getCoordinates(),w=r.getExteriorRing(),O=w.getCoordinates(),H=Xr.findPtNotNode(g,w,u);if(H===null)return null;var Q=zt.isPointInRing(H,O);if(!Q)return null;if(r.getNumInteriorRing()<=0)return this.validErr=new hi(hi.NESTED_SHELLS,H),null;for(var ye=null,Ue=0;Ue<r.getNumInteriorRing();Ue++){var ct=r.getInteriorRingN(Ue);if(ye=this.checkShellInsideHole(e,ct,u),ye===null)return null}this.validErr=new hi(hi.NESTED_SHELLS,ye)},checkClosedRings:function(e){if(this.checkClosedRing(e.getExteriorRing()),this.validErr!==null)return null;for(var r=0;r<e.getNumInteriorRing();r++)if(this.checkClosedRing(e.getInteriorRingN(r)),this.validErr!==null)return null},checkClosedRing:function(e){if(!e.isClosed()){var r=null;e.getNumPoints()>=1&&(r=e.getCoordinateN(0)),this.validErr=new hi(hi.RING_NOT_CLOSED,r)}},checkShellsNotNested:function(e,r){for(var u=0;u<e.getNumGeometries();u++)for(var g=e.getGeometryN(u),w=g.getExteriorRing(),O=0;O<e.getNumGeometries();O++)if(u!==O){var H=e.getGeometryN(O);if(this.checkShellNotNested(w,H,r),this.validErr!==null)return null}},interfaces_:function(){return[]},getClass:function(){return Xr}}),Xr.findPtNotNode=function(e,r,u){for(var g=u.findEdge(r),w=g.getEdgeIntersectionList(),O=0;O<e.length;O++){var H=e[O];if(!w.isIntersection(H))return H}return null},Xr.isValid=function(){if(arguments[0]instanceof Jt){var e=arguments[0],r=new Xr(e);return r.isValid()}if(arguments[0]instanceof ve){var u=arguments[0];return te.isNaN(u.x)||te.isInfinite(u.x)||te.isNaN(u.y)?!1:!te.isInfinite(u.y)}};var Fa=Object.freeze({IsValidOp:Xr}),Bc=Object.freeze({BoundaryOp:Ms,IsSimpleOp:Ta,buffer:ml,distance:kc,linemerge:Ou,overlay:hh,polygonize:pc,relate:za,union:gl,valid:Fa});Te(al,Ce.CoordinateOperation),N(al.prototype,{editCoordinates:function(e,r){if(e.length===0)return null;for(var u=new Array(e.length).fill(null),g=0;g<e.length;g++){var w=new ve(e[g]);this.targetPM.makePrecise(w),u[g]=w}var O=new ft(u,!1),H=O.toCoordinateArray(),Q=0;r instanceof Fn&&(Q=2),r instanceof ge&&(Q=4);var ye=u;return this.removeCollapsed&&(ye=null),H.length<Q?ye:H},interfaces_:function(){return[]},getClass:function(){return al}}),N(Gt.prototype,{fixPolygonalTopology:function(e){var r=e;this.changePrecisionModel||(r=this.changePM(e,this.targetPM));var u=r.buffer(0),g=u;return this.changePrecisionModel||(g=e.getFactory().createGeometry(u)),g},reducePointwise:function(e){var r=null;if(this.changePrecisionModel){var u=this.createFactory(e.getFactory(),this.targetPM);r=new Ce(u)}else r=new Ce;var g=this.removeCollapsed;e.getDimension()>=2&&(g=!0);var w=r.edit(e,new al(this.targetPM,g));return w},changePM:function(e,r){var u=this.createEditor(e.getFactory(),r);return u.edit(e,new Ce.NoOpGeometryOperation)},setRemoveCollapsedComponents:function(e){this.removeCollapsed=e},createFactory:function(e,r){var u=new Zn(r,e.getSRID(),e.getCoordinateSequenceFactory());return u},setChangePrecisionModel:function(e){this.changePrecisionModel=e},reduce:function(e){var r=this.reducePointwise(e);return this.isPointwise?r:kt(r,Ke)?r.isValid()?r:this.fixPolygonalTopology(r):r},setPointwise:function(e){this.isPointwise=e},createEditor:function(e,r){if(e.getPrecisionModel()===r)return new Ce;var u=this.createFactory(e,r),g=new Ce(u);return g},interfaces_:function(){return[]},getClass:function(){return Gt}}),Gt.reduce=function(e,r){var u=new Gt(r);return u.reduce(e)},Gt.reducePointwise=function(e,r){var u=new Gt(r);return u.setPointwise(!0),u.reduce(e)};var mc=Object.freeze({GeometryPrecisionReducer:Gt});N(ll.prototype,{simplifySection:function(e,r){if(e+1===r)return null;this.seg.p0=this.pts[e],this.seg.p1=this.pts[r];for(var u=-1,g=e,w=e+1;r>w;w++){var O=this.seg.distance(this.pts[w]);O>u&&(u=O,g=w)}if(u<=this.distanceTolerance)for(var w=e+1;r>w;w++)this.usePt[w]=!1;else this.simplifySection(e,g),this.simplifySection(g,r)},setDistanceTolerance:function(e){this.distanceTolerance=e},simplify:function(){this.usePt=new Array(this.pts.length).fill(null);for(var e=0;e<this.pts.length;e++)this.usePt[e]=!0;this.simplifySection(0,this.pts.length-1);for(var r=new ft,e=0;e<this.pts.length;e++)this.usePt[e]&&r.add(new ve(this.pts[e]));return r.toCoordinateArray()},interfaces_:function(){return[]},getClass:function(){return ll}}),ll.simplify=function(e,r){var u=new ll(e);return u.setDistanceTolerance(r),u.simplify()},N(ul.prototype,{setEnsureValid:function(e){this.isEnsureValidTopology=e},getResultGeometry:function(){return this.inputGeom.isEmpty()?this.inputGeom.copy():new No(this.isEnsureValidTopology,this.distanceTolerance).transform(this.inputGeom)},setDistanceTolerance:function(e){if(0>e)throw new X;this.distanceTolerance=e},interfaces_:function(){return[]},getClass:function(){return ul}}),ul.simplify=function(e,r){var u=new ul(e);return u.setDistanceTolerance(r),u.getResultGeometry()},Te(No,qr),N(No.prototype,{transformPolygon:function(e,r){if(e.isEmpty())return null;var u=qr.prototype.transformPolygon.call(this,e,r);return r instanceof Oe?u:this.createValidArea(u)},createValidArea:function(e){return this.isEnsureValidTopology?e.buffer(0):e},transformCoordinates:function(e,r){var u=e.toCoordinateArray(),g=null;return g=u.length===0?new Array(0).fill(null):ll.simplify(u,this.distanceTolerance),this.factory.getCoordinateSequenceFactory().create(g)},transformMultiPolygon:function(e,r){var u=qr.prototype.transformMultiPolygon.call(this,e,r);return this.createValidArea(u)},transformLinearRing:function(e,r){var u=r instanceof ne,g=qr.prototype.transformLinearRing.call(this,e,r);return!u||g instanceof ge?g:null},interfaces_:function(){return[]},getClass:function(){return No}}),ul.DPTransformer=No,Te(os,Sn),N(os.prototype,{getIndex:function(){return this.index},getParent:function(){return this.parent},interfaces_:function(){return[]},getClass:function(){return os}}),N(Yt.prototype,{addToResult:function(e){this.resultSegs.add(e)},asLineString:function(){return this.parentLine.getFactory().createLineString(Yt.extractCoordinates(this.resultSegs))},getResultSize:function(){var e=this.resultSegs.size();return e===0?0:e+1},getParent:function(){return this.parentLine},getSegment:function(e){return this.segs[e]},getParentCoordinates:function(){return this.parentLine.getCoordinates()},getMinimumSize:function(){return this.minimumSize},asLinearRing:function(){return this.parentLine.getFactory().createLinearRing(Yt.extractCoordinates(this.resultSegs))},getSegments:function(){return this.segs},init:function(){var e=this.parentLine.getCoordinates();this.segs=new Array(e.length-1).fill(null);for(var r=0;r<e.length-1;r++){var u=new os(e[r],e[r+1],this.parentLine,r);this.segs[r]=u}},getResultCoordinates:function(){return Yt.extractCoordinates(this.resultSegs)},interfaces_:function(){return[]},getClass:function(){return Yt}}),Yt.extractCoordinates=function(e){for(var r=new Array(e.size()+1).fill(null),u=null,g=0;g<e.size();g++)u=e.get(g),r[g]=u.p0;return r[r.length-1]=u.p1,r},N(cl.prototype,{remove:function(e){this.index.remove(new et(e.p0,e.p1),e)},add:function(){if(arguments[0]instanceof Yt)for(var e=arguments[0],r=e.getSegments(),u=0;u<r.length;u++){var g=r[u];this.add(g)}else if(arguments[0]instanceof Sn){var w=arguments[0];this.index.insert(new et(w.p0,w.p1),w)}},query:function(e){var r=new et(e.p0,e.p1),u=new Nc(e);this.index.query(r,u);var g=u.getItems();return g},interfaces_:function(){return[]},getClass:function(){return cl}}),N(Nc.prototype,{visitItem:function(e){var r=e;et.intersects(r.p0,r.p1,this.querySeg.p0,this.querySeg.p1)&&this.items.add(e)},getItems:function(){return this.items},interfaces_:function(){return[ks]},getClass:function(){return Nc}}),N(lc.prototype,{flatten:function(e,r){var u=this.linePts[e],g=this.linePts[r],w=new Sn(u,g);return this.remove(this.line,e,r),this.outputIndex.add(w),w},hasBadIntersection:function(e,r,u){return this.hasBadOutputIntersection(u)?!0:!!this.hasBadInputIntersection(e,r,u)},setDistanceTolerance:function(e){this.distanceTolerance=e},simplifySection:function(e,r,u){u+=1;var g=new Array(2).fill(null);if(e+1===r){var w=this.line.getSegment(e);return this.line.addToResult(w),null}var O=!0;if(this.line.getResultSize()<this.line.getMinimumSize()){var H=u+1;H<this.line.getMinimumSize()&&(O=!1)}var Q=new Array(1).fill(null),ye=this.findFurthestPoint(this.linePts,e,r,Q);Q[0]>this.distanceTolerance&&(O=!1);var Ue=new Sn;if(Ue.p0=this.linePts[e],Ue.p1=this.linePts[r],g[0]=e,g[1]=r,this.hasBadIntersection(this.line,g,Ue)&&(O=!1),O){var w=this.flatten(e,r);return this.line.addToResult(w),null}this.simplifySection(e,ye,u),this.simplifySection(ye,r,u)},hasBadOutputIntersection:function(e){for(var r=this.outputIndex.query(e),u=r.iterator();u.hasNext();){var g=u.next();if(this.hasInteriorIntersection(g,e))return!0}return!1},findFurthestPoint:function(e,r,u,g){var w=new Sn;w.p0=e[r],w.p1=e[u];for(var O=-1,H=r,Q=r+1;u>Q;Q++){var ye=e[Q],Ue=w.distance(ye);Ue>O&&(O=Ue,H=Q)}return g[0]=O,H},simplify:function(e){this.line=e,this.linePts=e.getParentCoordinates(),this.simplifySection(0,this.linePts.length-1,0)},remove:function(e,r,u){for(var g=r;u>g;g++){var w=e.getSegment(g);this.inputIndex.remove(w)}},hasInteriorIntersection:function(e,r){return this.li.computeIntersection(e.p0,e.p1,r.p0,r.p1),this.li.isInteriorIntersection()},hasBadInputIntersection:function(e,r,u){for(var g=this.inputIndex.query(u),w=g.iterator();w.hasNext();){var O=w.next();if(this.hasInteriorIntersection(O,u)){if(lc.isInLineSection(e,r,O))continue;return!0}}return!1},interfaces_:function(){return[]},getClass:function(){return lc}}),lc.isInLineSection=function(e,r,u){if(u.getParent()!==e.getParent())return!1;var g=u.getIndex();return g>=r[0]&&g<r[1]},N(hl.prototype,{setDistanceTolerance:function(e){this.distanceTolerance=e},simplify:function(e){for(var r=e.iterator();r.hasNext();)this.inputIndex.add(r.next());for(var r=e.iterator();r.hasNext();){var u=new lc(this.inputIndex,this.outputIndex);u.setDistanceTolerance(this.distanceTolerance),u.simplify(r.next())}},interfaces_:function(){return[]},getClass:function(){return hl}}),N(Ra.prototype,{getResultGeometry:function(){if(this.inputGeom.isEmpty())return this.inputGeom.copy();this.linestringMap=new Ji,this.inputGeom.apply(new uc(this)),this.lineSimplifier.simplify(this.linestringMap.values());var e=new Da(this.linestringMap).transform(this.inputGeom);return e},setDistanceTolerance:function(e){if(0>e)throw new X;this.lineSimplifier.setDistanceTolerance(e)},interfaces_:function(){return[]},getClass:function(){return Ra}}),Ra.simplify=function(e,r){var u=new Ra(e);return u.setDistanceTolerance(r),u.getResultGeometry()},Te(Da,qr),N(Da.prototype,{transformCoordinates:function(e,r){if(e.size()===0)return null;if(r instanceof Fn){var u=this.linestringMap.get(r);return this.createCoordinateSequence(u.getResultCoordinates())}return qr.prototype.transformCoordinates.call(this,e,r)},interfaces_:function(){return[]},getClass:function(){return Da}}),N(uc.prototype,{filter:function(e){if(e instanceof Fn){var r=e;if(r.isEmpty())return null;var u=r.isClosed()?4:2,g=new Yt(r,u);this.tps.linestringMap.put(r,g)}},interfaces_:function(){return[es]},getClass:function(){return uc}}),Ra.LineStringTransformer=Da,Ra.LineStringMapBuilderFilter=uc;var Nu=Object.freeze({DouglasPeuckerSimplifier:ul,TopologyPreservingSimplifier:Ra});N(Au.prototype,{splitAt:function(){if(arguments.length===1){var e=arguments[0],r=this.minimumLen/this.segLen;if(e.distance(this.seg.p0)<this.minimumLen)return this.splitPt=this.seg.pointAlong(r),null;if(e.distance(this.seg.p1)<this.minimumLen)return this.splitPt=Au.pointAlongReverse(this.seg,r),null;this.splitPt=e}else if(arguments.length===2){var u=arguments[0],g=arguments[1],w=this.getConstrainedLength(u),O=w/this.segLen;g.equals2D(this.seg.p0)?this.splitPt=this.seg.pointAlong(O):this.splitPt=Au.pointAlongReverse(this.seg,O)}},setMinimumLength:function(e){this.minimumLen=e},getConstrainedLength:function(e){return e<this.minimumLen?this.minimumLen:e},getSplitPoint:function(){return this.splitPt},interfaces_:function(){return[]},getClass:function(){return Au}}),Au.pointAlongReverse=function(e,r){var u=new ve;return u.x=e.p1.x-r*(e.p1.x-e.p0.x),u.y=e.p1.y-r*(e.p1.y-e.p0.y),u},N(cc.prototype,{findSplitPoint:function(e,r){},interfaces_:function(){return[]},getClass:function(){return cc}}),N(Oa.prototype,{findSplitPoint:function(e,r){var u=e.getLineSegment(),g=u.getLength(),w=g/2,O=new Au(u),H=Oa.projectedSplitPoint(e,r),Q=2*H.distance(r)*.8,ye=Q;return ye>w&&(ye=w),O.setMinimumLength(ye),O.splitAt(H),O.getSplitPoint()},interfaces_:function(){return[cc]},getClass:function(){return Oa}}),Oa.projectedSplitPoint=function(e,r){var u=e.getLineSegment(),g=u.project(r);return g},N(Ri.prototype,{interfaces_:function(){return[]},getClass:function(){return Ri}}),Ri.triArea=function(e,r,u){return(r.x-e.x)*(u.y-e.y)-(r.y-e.y)*(u.x-e.x)},Ri.isInCircleDDNormalized=function(e,r,u,g){var w=dt.valueOf(e.x).selfSubtract(g.x),O=dt.valueOf(e.y).selfSubtract(g.y),H=dt.valueOf(r.x).selfSubtract(g.x),Q=dt.valueOf(r.y).selfSubtract(g.y),ye=dt.valueOf(u.x).selfSubtract(g.x),Ue=dt.valueOf(u.y).selfSubtract(g.y),ct=w.multiply(Q).selfSubtract(H.multiply(O)),yt=H.multiply(Ue).selfSubtract(ye.multiply(Q)),Ft=ye.multiply(O).selfSubtract(w.multiply(Ue)),sn=w.multiply(w).selfAdd(O.multiply(O)),Tn=H.multiply(H).selfAdd(Q.multiply(Q)),Pn=ye.multiply(ye).selfAdd(Ue.multiply(Ue)),Ai=sn.selfMultiply(yt).selfAdd(Tn.selfMultiply(Ft)).selfAdd(Pn.selfMultiply(ct)),er=Ai.doubleValue()>0;return er},Ri.checkRobustInCircle=function(e,r,u,g){var w=Ri.isInCircleNonRobust(e,r,u,g),O=Ri.isInCircleDDSlow(e,r,u,g),H=Ri.isInCircleCC(e,r,u,g),Q=Ii.circumcentre(e,r,u);xi.out.println("p radius diff a = "+Math.abs(g.distance(Q)-e.distance(Q))/e.distance(Q)),w===O&&w===H||(xi.out.println("inCircle robustness failure (double result = "+w+", DD result = "+O+", CC result = "+H+")"),xi.out.println(Er.toLineString(new st([e,r,u,g]))),xi.out.println("Circumcentre = "+Er.toPoint(Q)+" radius = "+e.distance(Q)),xi.out.println("p radius diff a = "+Math.abs(g.distance(Q)/e.distance(Q)-1)),xi.out.println("p radius diff b = "+Math.abs(g.distance(Q)/r.distance(Q)-1)),xi.out.println("p radius diff c = "+Math.abs(g.distance(Q)/u.distance(Q)-1)),xi.out.println())},Ri.isInCircleDDFast=function(e,r,u,g){var w=dt.sqr(e.x).selfAdd(dt.sqr(e.y)).selfMultiply(Ri.triAreaDDFast(r,u,g)),O=dt.sqr(r.x).selfAdd(dt.sqr(r.y)).selfMultiply(Ri.triAreaDDFast(e,u,g)),H=dt.sqr(u.x).selfAdd(dt.sqr(u.y)).selfMultiply(Ri.triAreaDDFast(e,r,g)),Q=dt.sqr(g.x).selfAdd(dt.sqr(g.y)).selfMultiply(Ri.triAreaDDFast(e,r,u)),ye=w.selfSubtract(O).selfAdd(H).selfSubtract(Q),Ue=ye.doubleValue()>0;return Ue},Ri.isInCircleCC=function(e,r,u,g){var w=Ii.circumcentre(e,r,u),O=e.distance(w),H=g.distance(w)-O;return 0>=H},Ri.isInCircleNormalized=function(e,r,u,g){var w=e.x-g.x,O=e.y-g.y,H=r.x-g.x,Q=r.y-g.y,ye=u.x-g.x,Ue=u.y-g.y,ct=w*Q-H*O,yt=H*Ue-ye*Q,Ft=ye*O-w*Ue,sn=w*w+O*O,Tn=H*H+Q*Q,Pn=ye*ye+Ue*Ue,Ai=sn*yt+Tn*Ft+Pn*ct;return Ai>0},Ri.isInCircleDDSlow=function(e,r,u,g){var w=dt.valueOf(g.x),O=dt.valueOf(g.y),H=dt.valueOf(e.x),Q=dt.valueOf(e.y),ye=dt.valueOf(r.x),Ue=dt.valueOf(r.y),ct=dt.valueOf(u.x),yt=dt.valueOf(u.y),Ft=H.multiply(H).add(Q.multiply(Q)).multiply(Ri.triAreaDDSlow(ye,Ue,ct,yt,w,O)),sn=ye.multiply(ye).add(Ue.multiply(Ue)).multiply(Ri.triAreaDDSlow(H,Q,ct,yt,w,O)),Tn=ct.multiply(ct).add(yt.multiply(yt)).multiply(Ri.triAreaDDSlow(H,Q,ye,Ue,w,O)),Pn=w.multiply(w).add(O.multiply(O)).multiply(Ri.triAreaDDSlow(H,Q,ye,Ue,ct,yt)),Ai=Ft.subtract(sn).add(Tn).subtract(Pn),er=Ai.doubleValue()>0;return er},Ri.isInCircleNonRobust=function(e,r,u,g){var w=(e.x*e.x+e.y*e.y)*Ri.triArea(r,u,g)-(r.x*r.x+r.y*r.y)*Ri.triArea(e,u,g)+(u.x*u.x+u.y*u.y)*Ri.triArea(e,r,g)-(g.x*g.x+g.y*g.y)*Ri.triArea(e,r,u)>0;return w},Ri.isInCircleRobust=function(e,r,u,g){return Ri.isInCircleNormalized(e,r,u,g)},Ri.triAreaDDSlow=function(e,r,u,g,w,O){return u.subtract(e).multiply(O.subtract(r)).subtract(g.subtract(r).multiply(w.subtract(e)))},Ri.triAreaDDFast=function(e,r,u){var g=dt.valueOf(r.x).selfSubtract(e.x).selfMultiply(dt.valueOf(u.y).selfSubtract(e.y)),w=dt.valueOf(r.y).selfSubtract(e.y).selfMultiply(dt.valueOf(u.x).selfSubtract(e.x));return g.selfSubtract(w)},N(wi.prototype,{circleCenter:function(e,r){var u=new wi(this.getX(),this.getY()),g=this.bisector(u,e),w=this.bisector(e,r),O=new hr(g,w),H=null;try{H=new wi(O.getX(),O.getY())}catch(Q){if(!(Q instanceof it))throw Q;xi.err.println("a: "+u+"  b: "+e+"  c: "+r),xi.err.println(Q)}finally{}return H},dot:function(e){return this.p.x*e.getX()+this.p.y*e.getY()},magn:function(){return Math.sqrt(this.p.x*this.p.x+this.p.y*this.p.y)},getZ:function(){return this.p.z},bisector:function(e,r){var u=r.getX()-e.getX(),g=r.getY()-e.getY(),w=new hr(e.getX()+u/2,e.getY()+g/2,1),O=new hr(e.getX()-g+u/2,e.getY()+u+g/2,1);return new hr(w,O)},equals:function(){if(arguments.length===1){var e=arguments[0];return this.p.x===e.getX()&&this.p.y===e.getY()}if(arguments.length===2){var r=arguments[0],u=arguments[1];return this.p.distance(r.getCoordinate())<u}},getCoordinate:function(){return this.p},isInCircle:function(e,r,u){return Ri.isInCircleRobust(e.p,r.p,u.p,this.p)},interpolateZValue:function(e,r,u){var g=e.getX(),w=e.getY(),O=r.getX()-g,H=u.getX()-g,Q=r.getY()-w,ye=u.getY()-w,Ue=O*ye-H*Q,ct=this.getX()-g,yt=this.getY()-w,Ft=(ye*ct-H*yt)/Ue,sn=(-Q*ct+O*yt)/Ue,Tn=e.getZ()+Ft*(r.getZ()-e.getZ())+sn*(u.getZ()-e.getZ());return Tn},midPoint:function(e){var r=(this.p.x+e.getX())/2,u=(this.p.y+e.getY())/2,g=(this.p.z+e.getZ())/2;return new wi(r,u,g)},rightOf:function(e){return this.isCCW(e.dest(),e.orig())},isCCW:function(e,r){return(e.p.x-this.p.x)*(r.p.y-this.p.y)-(e.p.y-this.p.y)*(r.p.x-this.p.x)>0},getX:function(){return this.p.x},crossProduct:function(e){return this.p.x*e.getY()-this.p.y*e.getX()},setZ:function(e){this.p.z=e},times:function(e){return new wi(e*this.p.x,e*this.p.y)},cross:function(){return new wi(this.p.y,-this.p.x)},leftOf:function(e){return this.isCCW(e.orig(),e.dest())},toString:function(){return"POINT ("+this.p.x+" "+this.p.y+")"},sub:function(e){return new wi(this.p.x-e.getX(),this.p.y-e.getY())},getY:function(){return this.p.y},classify:function(e,r){var u=this,g=r.sub(e),w=u.sub(e),O=g.crossProduct(w);return O>0?wi.LEFT:0>O?wi.RIGHT:g.getX()*w.getX()<0||g.getY()*w.getY()<0?wi.BEHIND:g.magn()<w.magn()?wi.BEYOND:e.equals(u)?wi.ORIGIN:r.equals(u)?wi.DESTINATION:wi.BETWEEN},sum:function(e){return new wi(this.p.x+e.getX(),this.p.y+e.getY())},distance:function(e,r){return Math.sqrt(Math.pow(r.getX()-e.getX(),2)+Math.pow(r.getY()-e.getY(),2))},circumRadiusRatio:function(e,r){var u=this.circleCenter(e,r),g=this.distance(u,e),w=this.distance(this,e),O=this.distance(e,r);return w>O&&(w=O),O=this.distance(r,this),w>O&&(w=O),g/w},interfaces_:function(){return[]},getClass:function(){return wi}}),wi.interpolateZ=function(){if(arguments.length===3){var e=arguments[0],r=arguments[1],u=arguments[2],g=r.distance(u),w=e.distance(r),O=u.z-r.z,H=r.z+O*(w/g);return H}if(arguments.length===4){var Q=arguments[0],ye=arguments[1],Ue=arguments[2],ct=arguments[3],yt=ye.x,Ft=ye.y,sn=Ue.x-yt,Tn=ct.x-yt,Pn=Ue.y-Ft,Ai=ct.y-Ft,er=sn*Ai-Tn*Pn,Ds=Q.x-yt,oa=Q.y-Ft,gc=(Ai*Ds-Tn*oa)/er,$l=(-Pn*Ds+sn*oa)/er,_l=ye.z+gc*(Ue.z-ye.z)+$l*(ct.z-ye.z);return _l}},wi.LEFT=0,wi.RIGHT=1,wi.BEYOND=2,wi.BEHIND=3,wi.BETWEEN=4,wi.ORIGIN=5,wi.DESTINATION=6,Te(ar,wi),N(ar.prototype,{getConstraint:function(){return this.constraint},setOnConstraint:function(e){this._isOnConstraint=e},merge:function(e){e._isOnConstraint&&(this._isOnConstraint=!0,this.constraint=e.constraint)},isOnConstraint:function(){return this._isOnConstraint},setConstraint:function(e){this._isOnConstraint=!0,this.constraint=e},interfaces_:function(){return[]},getClass:function(){return ar}}),N(pi.prototype,{equalsNonOriented:function(e){return this.equalsOriented(e)?!0:!!this.equalsOriented(e.sym())},toLineSegment:function(){return new Sn(this.vertex.getCoordinate(),this.dest().getCoordinate())},dest:function(){return this.sym().orig()},oNext:function(){return this.next},equalsOriented:function(e){return!(!this.orig().getCoordinate().equals2D(e.orig().getCoordinate())||!this.dest().getCoordinate().equals2D(e.dest().getCoordinate()))},dNext:function(){return this.sym().oNext().sym()},lPrev:function(){return this.next.sym()},rPrev:function(){return this.sym().oNext()},rot:function(){return this._rot},oPrev:function(){return this._rot.next._rot},sym:function(){return this._rot._rot},setOrig:function(e){this.vertex=e},lNext:function(){return this.invRot().oNext().rot()},getLength:function(){return this.orig().getCoordinate().distance(this.dest().getCoordinate())},invRot:function(){return this._rot.sym()},setDest:function(e){this.sym().setOrig(e)},setData:function(e){this.data=e},getData:function(){return this.data},delete:function(){this._rot=null},orig:function(){return this.vertex},rNext:function(){return this._rot.next.invRot()},toString:function(){var e=this.vertex.getCoordinate(),r=this.dest().getCoordinate();return Er.toLineString(e,r)},isLive:function(){return this._rot!==null},getPrimary:function(){return this.orig().getCoordinate().compareTo(this.dest().getCoordinate())<=0?this:this.sym()},dPrev:function(){return this.invRot().oNext().invRot()},setNext:function(e){this.next=e},interfaces_:function(){return[]},getClass:function(){return pi}}),pi.makeEdge=function(e,r){var u=new pi,g=new pi,w=new pi,O=new pi;u._rot=g,g._rot=w,w._rot=O,O._rot=u,u.setNext(u),g.setNext(O),w.setNext(w),O.setNext(g);var H=u;return H.setOrig(e),H.setDest(r),H},pi.swap=function(e){var r=e.oPrev(),u=e.sym().oPrev();pi.splice(e,r),pi.splice(e.sym(),u),pi.splice(e,r.lNext()),pi.splice(e.sym(),u.lNext()),e.setOrig(r.dest()),e.setDest(u.dest())},pi.splice=function(e,r){var u=e.oNext().rot(),g=r.oNext().rot(),w=r.oNext(),O=e.oNext(),H=g.oNext(),Q=u.oNext();e.setNext(w),r.setNext(O),u.setNext(H),g.setNext(Q)},pi.connect=function(e,r){var u=pi.makeEdge(e.dest(),r.orig());return pi.splice(u,e.lNext()),pi.splice(u.sym(),r),u},N(Pu.prototype,{insertSite:function(e){var r=this.subdiv.locate(e);if(this.subdiv.isVertexOfEdge(r,e))return r;this.subdiv.isOnEdge(r,e.getCoordinate())&&(r=r.oPrev(),this.subdiv.delete(r.oNext()));var u=this.subdiv.makeEdge(r.orig(),e);pi.splice(u,r);var g=u;do u=this.subdiv.connect(r,u.sym()),r=u.oPrev();while(r.lNext()!==g);for(;;){var w=r.oPrev();if(w.dest().rightOf(r)&&e.isInCircle(r.orig(),w.dest(),r.dest()))pi.swap(r),r=r.oPrev();else{if(r.oNext()===g)return u;r=r.oNext().lPrev()}}},insertSites:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();this.insertSite(u)}},interfaces_:function(){return[]},getClass:function(){return Pu}}),N(hc.prototype,{locate:function(e){},interfaces_:function(){return[]},getClass:function(){return hc}}),N(Lu.prototype,{init:function(){this.lastEdge=this.findEdge()},locate:function(e){this.lastEdge.isLive()||this.init();var r=this.subdiv.locateFromEdge(e,this.lastEdge);return this.lastEdge=r,r},findEdge:function(){var e=this.subdiv.getEdges();return e.iterator().next()},interfaces_:function(){return[hc]},getClass:function(){return Lu}}),Te(dl,Se),N(dl.prototype,{getSegment:function(){return this.seg},interfaces_:function(){return[]},getClass:function(){return dl}}),dl.msgWithSpatial=function(e,r){return r!==null?e+" [ "+r+" ]":e},N(jl.prototype,{visit:function(e){},interfaces_:function(){return[]},getClass:function(){return jl}}),N(nr.prototype,{getTriangleVertices:function(e){var r=new Ru;return this.visitTriangles(r,e),r.getTriangleVertices()},isFrameVertex:function(e){return e.equals(this.frameVertex[0])||e.equals(this.frameVertex[1])?!0:!!e.equals(this.frameVertex[2])},isVertexOfEdge:function(e,r){return!(!r.equals(e.orig(),this.tolerance)&&!r.equals(e.dest(),this.tolerance))},connect:function(e,r){var u=pi.connect(e,r);return this.quadEdges.add(u),u},getVoronoiCellPolygon:function(e,r){var u=new ze,g=e;do{var w=e.rot().orig().getCoordinate();u.add(w),e=e.oPrev()}while(e!==g);var O=new ft;O.addAll(u,!1),O.closeRing(),O.size()<4&&(xi.out.println(O),O.add(O.get(O.size()-1),!0));var H=O.toCoordinateArray(),Q=r.createPolygon(r.createLinearRing(H),null),ye=g.orig();return Q.setUserData(ye.getCoordinate()),Q},setLocator:function(e){this.locator=e},initSubdiv:function(){var e=this.makeEdge(this.frameVertex[0],this.frameVertex[1]),r=this.makeEdge(this.frameVertex[1],this.frameVertex[2]);pi.splice(e.sym(),r);var u=this.makeEdge(this.frameVertex[2],this.frameVertex[0]);return pi.splice(r.sym(),u),pi.splice(u.sym(),e),e},isFrameBorderEdge:function(e){var r=new Array(3).fill(null);nr.getTriangleEdges(e,r);var u=new Array(3).fill(null);nr.getTriangleEdges(e.sym(),u);var g=e.lNext().dest();if(this.isFrameVertex(g))return!0;var w=e.sym().lNext().dest();return!!this.isFrameVertex(w)},makeEdge:function(e,r){var u=pi.makeEdge(e,r);return this.quadEdges.add(u),u},visitTriangles:function(e,r){this.visitedKey++;var u=new Ir;u.push(this.startingEdge);for(var g=new pn;!u.empty();){var w=u.pop();if(!g.contains(w)){var O=this.fetchTriangleToVisit(w,u,r,g);O!==null&&e.visit(O)}}},isFrameEdge:function(e){return!(!this.isFrameVertex(e.orig())&&!this.isFrameVertex(e.dest()))},isOnEdge:function(e,r){this.seg.setCoordinates(e.orig().getCoordinate(),e.dest().getCoordinate());var u=this.seg.distance(r);return u<this.edgeCoincidenceTolerance},getEnvelope:function(){return new et(this.frameEnv)},createFrame:function(e){var r=e.getWidth(),u=e.getHeight(),g=0;g=r>u?10*r:10*u,this.frameVertex[0]=new wi((e.getMaxX()+e.getMinX())/2,e.getMaxY()+g),this.frameVertex[1]=new wi(e.getMinX()-g,e.getMinY()-g),this.frameVertex[2]=new wi(e.getMaxX()+g,e.getMinY()-g),this.frameEnv=new et(this.frameVertex[0].getCoordinate(),this.frameVertex[1].getCoordinate()),this.frameEnv.expandToInclude(this.frameVertex[2].getCoordinate())},getTriangleCoordinates:function(e){var r=new dc;return this.visitTriangles(r,e),r.getTriangles()},getVertices:function(e){for(var r=new pn,u=this.quadEdges.iterator();u.hasNext();){var g=u.next(),w=g.orig();!e&&this.isFrameVertex(w)||r.add(w);var O=g.dest();!e&&this.isFrameVertex(O)||r.add(O)}return r},fetchTriangleToVisit:function(e,r,u,g){var w=e,O=0,H=!1;do{this.triEdges[O]=w,this.isFrameEdge(w)&&(H=!0);var Q=w.sym();g.contains(Q)||r.push(Q),g.add(w),O++,w=w.lNext()}while(w!==e);return H&&!u?null:this.triEdges},getEdges:function(){if(arguments.length===0)return this.quadEdges;if(arguments.length===1){for(var e=arguments[0],r=this.getPrimaryEdges(!1),u=new Array(r.size()).fill(null),g=0,w=r.iterator();w.hasNext();){var O=w.next();u[g++]=e.createLineString([O.orig().getCoordinate(),O.dest().getCoordinate()])}return e.createMultiLineString(u)}},getVertexUniqueEdges:function(e){for(var r=new ze,u=new pn,g=this.quadEdges.iterator();g.hasNext();){var w=g.next(),O=w.orig();u.contains(O)||(u.add(O),!e&&this.isFrameVertex(O)||r.add(w));var H=w.sym(),Q=H.orig();u.contains(Q)||(u.add(Q),!e&&this.isFrameVertex(Q)||r.add(H))}return r},getTriangleEdges:function(e){var r=new Hl;return this.visitTriangles(r,e),r.getTriangleEdges()},getPrimaryEdges:function(e){this.visitedKey++;var r=new ze,u=new Ir;u.push(this.startingEdge);for(var g=new pn;!u.empty();){var w=u.pop();if(!g.contains(w)){var O=w.getPrimary();!e&&this.isFrameEdge(O)||r.add(O),u.push(w.oNext()),u.push(w.sym().oNext()),g.add(w),g.add(w.sym())}}return r},delete:function(e){pi.splice(e,e.oPrev()),pi.splice(e.sym(),e.sym().oPrev());var r=e.sym(),u=e.rot(),g=e.rot().sym();this.quadEdges.remove(e),this.quadEdges.remove(r),this.quadEdges.remove(u),this.quadEdges.remove(g),e.delete(),r.delete(),u.delete(),g.delete()},locateFromEdge:function(e,r){for(var u=0,g=this.quadEdges.size(),w=r;;){if(u++,u>g)throw new dl(w.toLineSegment());if(e.equals(w.orig())||e.equals(w.dest()))break;if(e.rightOf(w))w=w.sym();else if(e.rightOf(w.oNext())){if(e.rightOf(w.dPrev()))break;w=w.dPrev()}else w=w.oNext()}return w},getTolerance:function(){return this.tolerance},getVoronoiCellPolygons:function(e){this.visitTriangles(new Ui,!0);for(var r=new ze,u=this.getVertexUniqueEdges(!1),g=u.iterator();g.hasNext();){var w=g.next();r.add(this.getVoronoiCellPolygon(w,e))}return r},getVoronoiDiagram:function(e){var r=this.getVoronoiCellPolygons(e);return e.createGeometryCollection(Zn.toGeometryArray(r))},getTriangles:function(e){for(var r=this.getTriangleCoordinates(!1),u=new Array(r.size()).fill(null),g=0,w=r.iterator();w.hasNext();){var O=w.next();u[g++]=e.createPolygon(e.createLinearRing(O),null)}return e.createGeometryCollection(u)},insertSite:function(e){var r=this.locate(e);if(e.equals(r.orig(),this.tolerance)||e.equals(r.dest(),this.tolerance))return r;var u=this.makeEdge(r.orig(),e);pi.splice(u,r);var g=u;do u=this.connect(r,u.sym()),r=u.oPrev();while(r.lNext()!==g);return g},locate:function(){if(arguments.length===1){if(arguments[0]instanceof wi){var e=arguments[0];return this.locator.locate(e)}if(arguments[0]instanceof ve){var r=arguments[0];return this.locator.locate(new wi(r))}}else if(arguments.length===2){var u=arguments[0],g=arguments[1],w=this.locator.locate(new wi(u));if(w===null)return null;var O=w;w.dest().getCoordinate().equals2D(u)&&(O=w.sym());var H=O;do{if(H.dest().getCoordinate().equals2D(g))return H;H=H.oNext()}while(H!==O);return null}},interfaces_:function(){return[]},getClass:function(){return nr}}),nr.getTriangleEdges=function(e,r){if(r[0]=e,r[1]=r[0].lNext(),r[2]=r[1].lNext(),r[2].lNext()!==r[0])throw new X},N(Ui.prototype,{visit:function(e){for(var r=e[0].orig().getCoordinate(),u=e[1].orig().getCoordinate(),g=e[2].orig().getCoordinate(),w=Ii.circumcentre(r,u,g),O=new wi(w),H=0;3>H;H++)e[H].rot().setOrig(O)},interfaces_:function(){return[jl]},getClass:function(){return Ui}}),N(Hl.prototype,{getTriangleEdges:function(){return this.triList},visit:function(e){this.triList.add(e.clone())},interfaces_:function(){return[jl]},getClass:function(){return Hl}}),N(Ru.prototype,{visit:function(e){this.triList.add([e[0].orig(),e[1].orig(),e[2].orig()])},getTriangleVertices:function(){return this.triList},interfaces_:function(){return[jl]},getClass:function(){return Ru}}),N(dc.prototype,{checkTriangleSize:function(e){e.length>=2?Er.toLineString(e[0],e[1]):e.length>=1&&Er.toPoint(e[0])},visit:function(e){this.coordList.clear();for(var r=0;3>r;r++){var u=e[r].orig();this.coordList.add(u.getCoordinate())}if(this.coordList.size()>0){this.coordList.closeRing();var g=this.coordList.toCoordinateArray();if(g.length!==4)return null;this.triCoords.add(g)}},getTriangles:function(){return this.triCoords},interfaces_:function(){return[jl]},getClass:function(){return dc}}),nr.TriangleCircumcentreVisitor=Ui,nr.TriangleEdgesListVisitor=Hl,nr.TriangleVertexListVisitor=Ru,nr.TriangleCoordinatesVisitor=dc,nr.EDGE_COINCIDENCE_TOL_FACTOR=1e3,N(fl.prototype,{getLineSegment:function(){return this.ls},getEndZ:function(){var e=this.ls.getCoordinate(1);return e.z},getStartZ:function(){var e=this.ls.getCoordinate(0);return e.z},intersection:function(e){return this.ls.intersection(e.getLineSegment())},getStart:function(){return this.ls.getCoordinate(0)},getEnd:function(){return this.ls.getCoordinate(1)},getEndY:function(){var e=this.ls.getCoordinate(1);return e.y},getStartX:function(){var e=this.ls.getCoordinate(0);return e.x},equalsTopo:function(e){return this.ls.equalsTopo(e.getLineSegment())},getStartY:function(){var e=this.ls.getCoordinate(0);return e.y},setData:function(e){this.data=e},getData:function(){return this.data},getEndX:function(){var e=this.ls.getCoordinate(1);return e.x},toString:function(){return this.ls.toString()},interfaces_:function(){return[]},getClass:function(){return fl}}),N(Du.prototype,{visit:function(e){},interfaces_:function(){return[]},getClass:function(){return Du}}),N(zc.prototype,{isRepeated:function(){return this.count>1},getRight:function(){return this.right},getCoordinate:function(){return this.p},setLeft:function(e){this.left=e},getX:function(){return this.p.x},getData:function(){return this.data},getCount:function(){return this.count},getLeft:function(){return this.left},getY:function(){return this.p.y},increment:function(){this.count=this.count+1},setRight:function(e){this.right=e},interfaces_:function(){return[]},getClass:function(){return zc}}),N(vo.prototype,{insert:function(){if(arguments.length===1){var e=arguments[0];return this.insert(e,null)}if(arguments.length===2){var r=arguments[0],u=arguments[1];if(this.root===null)return this.root=new zc(r,u),this.root;if(this.tolerance>0){var g=this.findBestMatchNode(r);if(g!==null)return g.increment(),g}return this.insertExact(r,u)}},query:function(){var e=arguments,r=this;if(arguments.length===1){var u=arguments[0],g=new ze;return this.query(u,g),g}if(arguments.length===2){if(arguments[0]instanceof et&&kt(arguments[1],Ae))(function(){var H=e[0],Q=e[1];r.queryNode(r.root,H,!0,{interfaces_:function(){return[Du]},visit:function(ye){Q.add(ye)}})})();else if(arguments[0]instanceof et&&kt(arguments[1],Du)){var w=arguments[0],O=arguments[1];this.queryNode(this.root,w,!0,O)}}},queryNode:function(e,r,u,g){if(e===null)return null;var w=null,O=null,H=null;u?(w=r.getMinX(),O=r.getMaxX(),H=e.getX()):(w=r.getMinY(),O=r.getMaxY(),H=e.getY());var Q=H>w,ye=O>=H;Q&&this.queryNode(e.getLeft(),r,!u,g),r.contains(e.getCoordinate())&&g.visit(e),ye&&this.queryNode(e.getRight(),r,!u,g)},findBestMatchNode:function(e){var r=new Na(e,this.tolerance);return this.query(r.queryEnvelope(),r),r.getNode()},isEmpty:function(){return this.root===null},insertExact:function(e,r){for(var u=this.root,g=this.root,w=!0,O=!0;u!==null;){if(u!==null){var H=e.distance(u.getCoordinate())<=this.tolerance;if(H)return u.increment(),u}O=w?e.x<u.getX():e.y<u.getY(),g=u,u=O?u.getLeft():u.getRight(),w=!w}this.numberOfNodes=this.numberOfNodes+1;var Q=new zc(e,r);return O?g.setLeft(Q):g.setRight(Q),Q},interfaces_:function(){return[]},getClass:function(){return vo}}),vo.toCoordinates=function(){if(arguments.length===1){var e=arguments[0];return vo.toCoordinates(e,!1)}if(arguments.length===2){for(var r=arguments[0],u=arguments[1],g=new ft,w=r.iterator();w.hasNext();)for(var O=w.next(),H=u?O.getCount():1,Q=0;H>Q;Q++)g.add(O.getCoordinate(),!0);return g.toCoordinateArray()}},N(Na.prototype,{visit:function(e){var r=this.p.distance(e.getCoordinate()),u=r<=this.tolerance;if(!u)return null;var g=!1;(this.matchNode===null||r<this.matchDist||this.matchNode!==null&&r===this.matchDist&&e.getCoordinate().compareTo(this.matchNode.getCoordinate())<1)&&(g=!0),g&&(this.matchNode=e,this.matchDist=r)},queryEnvelope:function(){var e=new et(this.p);return e.expandBy(this.tolerance),e},getNode:function(){return this.matchNode},interfaces_:function(){return[Du]},getClass:function(){return Na}}),vo.BestMatchVisitor=Na,N(It.prototype,{getInitialVertices:function(){return this.initialVertices},getKDT:function(){return this.kdt},enforceConstraints:function(){this.addConstraintVertices();var e=0,r=0;do r=this.enforceGabriel(this.segments),e++;while(r>0&&e<It.MAX_SPLIT_ITER)},insertSites:function(e){for(var r=e.iterator();r.hasNext();){var u=r.next();this.insertSite(u)}},getVertexFactory:function(){return this.vertexFactory},getPointArray:function(){for(var e=new Array(this.initialVertices.size()+this.segVertices.size()).fill(null),r=0,u=this.initialVertices.iterator();u.hasNext();){var g=u.next();e[r++]=g.getCoordinate()}for(var w=this.segVertices.iterator();w.hasNext();){var g=w.next();e[r++]=g.getCoordinate()}return e},setConstraints:function(e,r){this.segments=e,this.segVertices=r},computeConvexHull:function(){var e=new Zn,r=this.getPointArray(),u=new ao(r,e);this.convexHull=u.getConvexHull()},addConstraintVertices:function(){this.computeConvexHull(),this.insertSites(this.segVertices)},findNonGabrielPoint:function(e){var r=e.getStart(),u=e.getEnd(),g=new ve((r.x+u.x)/2,(r.y+u.y)/2),w=r.distance(g),O=new et(g);O.expandBy(w);for(var H=this.kdt.query(O),Q=null,ye=te.MAX_VALUE,Ue=H.iterator();Ue.hasNext();){var ct=Ue.next(),yt=ct.getCoordinate();if(!yt.equals2D(r)&&!yt.equals2D(u)){var Ft=g.distance(yt);if(w>Ft){var sn=Ft;(Q===null||ye>sn)&&(Q=yt,ye=sn)}}}return Q},getConstraintSegments:function(){return this.segments},setSplitPointFinder:function(e){this.splitFinder=e},getConvexHull:function(){return this.convexHull},getTolerance:function(){return this.tolerance},enforceGabriel:function(e){for(var r=new ze,u=0,g=new ze,w=e.iterator();w.hasNext();){var O=w.next(),H=this.findNonGabrielPoint(O);if(H!==null){this.splitPt=this.splitFinder.findSplitPoint(O,H);var Q=this.createVertex(this.splitPt,O),ye=(this.insertSite(Q),new fl(O.getStartX(),O.getStartY(),O.getStartZ(),Q.getX(),Q.getY(),Q.getZ(),O.getData())),Ue=new fl(Q.getX(),Q.getY(),Q.getZ(),O.getEndX(),O.getEndY(),O.getEndZ(),O.getData());r.add(ye),r.add(Ue),g.add(O),u+=1}}return e.removeAll(g),e.addAll(r),u},createVertex:function(){if(arguments.length===1){var e=arguments[0],r=null;return r=this.vertexFactory!==null?this.vertexFactory.createVertex(e,null):new ar(e)}if(arguments.length===2){var u=arguments[0],g=arguments[1],r=null;return r=this.vertexFactory!==null?this.vertexFactory.createVertex(u,g):new ar(u),r.setOnConstraint(!0),r}},getSubdivision:function(){return this.subdiv},computeBoundingBox:function(){var e=It.computeVertexEnvelope(this.initialVertices),r=It.computeVertexEnvelope(this.segVertices),u=new et(e);u.expandToInclude(r);var g=.2*u.getWidth(),w=.2*u.getHeight(),O=Math.max(g,w);this.computeAreaEnv=new et(u),this.computeAreaEnv.expandBy(O)},setVertexFactory:function(e){this.vertexFactory=e},formInitialDelaunay:function(){this.computeBoundingBox(),this.subdiv=new nr(this.computeAreaEnv,this.tolerance),this.subdiv.setLocator(new Lu(this.subdiv)),this.incDel=new Pu(this.subdiv),this.insertSites(this.initialVertices)},insertSite:function(){if(arguments[0]instanceof ar){var e=arguments[0],r=this.kdt.insert(e.getCoordinate(),e);if(r.isRepeated()){var u=r.getData();return u.merge(e),u}return this.incDel.insertSite(e),e}if(arguments[0]instanceof ve){var g=arguments[0];this.insertSite(this.createVertex(g))}},interfaces_:function(){return[]},getClass:function(){return It}}),It.computeVertexEnvelope=function(e){for(var r=new et,u=e.iterator();u.hasNext();){var g=u.next();r.expandToInclude(g.getCoordinate())}return r},It.MAX_SPLIT_ITER=99,N(Ht.prototype,{create:function(){if(this.subdiv!==null)return null;var e=Ht.envelope(this.siteCoords),r=Ht.toVertices(this.siteCoords);this.subdiv=new nr(e,this.tolerance);var u=new Pu(this.subdiv);u.insertSites(r)},setTolerance:function(e){this.tolerance=e},setSites:function(){if(arguments[0]instanceof Jt){var e=arguments[0];this.siteCoords=Ht.extractUniqueCoordinates(e)}else if(kt(arguments[0],Bt)){var r=arguments[0];this.siteCoords=Ht.unique(bn.toCoordinateArray(r))}},getEdges:function(e){return this.create(),this.subdiv.getEdges(e)},getSubdivision:function(){return this.create(),this.subdiv},getTriangles:function(e){return this.create(),this.subdiv.getTriangles(e)},interfaces_:function(){return[]},getClass:function(){return Ht}}),Ht.extractUniqueCoordinates=function(e){if(e===null)return new ft;var r=e.getCoordinates();return Ht.unique(r)},Ht.envelope=function(e){for(var r=new et,u=e.iterator();u.hasNext();){var g=u.next();r.expandToInclude(g)}return r},Ht.unique=function(e){var r=bn.copyDeep(e);ir.sort(r);var u=new ft(r,!1);return u},Ht.toVertices=function(e){for(var r=new ze,u=e.iterator();u.hasNext();){var g=u.next();r.add(new wi(g))}return r},N(zo.prototype,{createSiteVertices:function(e){for(var r=new ze,u=e.iterator();u.hasNext();){var g=u.next();this.constraintVertexMap.containsKey(g)||r.add(new ar(g))}return r},create:function(){if(this.subdiv!==null)return null;var e=Ht.envelope(this.siteCoords),r=new ze;this.constraintLines!==null&&(e.expandToInclude(this.constraintLines.getEnvelopeInternal()),this.createVertices(this.constraintLines),r=zo.createConstraintSegments(this.constraintLines));var u=this.createSiteVertices(this.siteCoords),g=new It(u,this.tolerance);g.setConstraints(r,new ze(this.constraintVertexMap.values())),g.formInitialDelaunay(),g.enforceConstraints(),this.subdiv=g.getSubdivision()},setTolerance:function(e){this.tolerance=e},setConstraints:function(e){this.constraintLines=e},setSites:function(e){this.siteCoords=Ht.extractUniqueCoordinates(e)},getEdges:function(e){return this.create(),this.subdiv.getEdges(e)},getSubdivision:function(){return this.create(),this.subdiv},getTriangles:function(e){return this.create(),this.subdiv.getTriangles(e)},createVertices:function(e){for(var r=e.getCoordinates(),u=0;u<r.length;u++){var g=new ar(r[u]);this.constraintVertexMap.put(r[u],g)}},interfaces_:function(){return[]},getClass:function(){return zo}}),zo.createConstraintSegments=function(){if(arguments.length===1){for(var e=arguments[0],r=Fr.getLines(e),u=new ze,g=r.iterator();g.hasNext();){var w=g.next();zo.createConstraintSegments(w,u)}return u}if(arguments.length===2)for(var O=arguments[0],H=arguments[1],Q=O.getCoordinates(),g=1;g<Q.length;g++)H.add(new fl(Q[g-1],Q[g]))},N(Ei.prototype,{create:function(){if(this.subdiv!==null)return null;var e=Ht.envelope(this.siteCoords);this.diagramEnv=e;var r=Math.max(this.diagramEnv.getWidth(),this.diagramEnv.getHeight());this.diagramEnv.expandBy(r),this.clipEnv!==null&&this.diagramEnv.expandToInclude(this.clipEnv);var u=Ht.toVertices(this.siteCoords);this.subdiv=new nr(e,this.tolerance);var g=new Pu(this.subdiv);g.insertSites(u)},getDiagram:function(e){this.create();var r=this.subdiv.getVoronoiDiagram(e);return Ei.clipGeometryCollection(r,this.diagramEnv)},setTolerance:function(e){this.tolerance=e},setSites:function(){if(arguments[0]instanceof Jt){var e=arguments[0];this.siteCoords=Ht.extractUniqueCoordinates(e)}else if(kt(arguments[0],Bt)){var r=arguments[0];this.siteCoords=Ht.unique(bn.toCoordinateArray(r))}},setClipEnvelope:function(e){this.clipEnv=e},getSubdivision:function(){return this.create(),this.subdiv},interfaces_:function(){return[]},getClass:function(){return Ei}}),Ei.clipGeometryCollection=function(e,r){for(var u=e.getFactory().toGeometry(r),g=new ze,w=0;w<e.getNumGeometries();w++){var O=e.getGeometryN(w),H=null;r.contains(O.getEnvelopeInternal())?H=O:r.intersects(O.getEnvelopeInternal())&&(H=u.intersection(O),H.setUserData(O.getUserData())),H===null||H.isEmpty()||g.add(H)}return e.getFactory().createGeometryCollection(Zn.toGeometryArray(g))};var dh=Object.freeze({ConformingDelaunayTriangulationBuilder:zo,DelaunayTriangulationBuilder:Ht,VoronoiDiagramBuilder:Ei});N($e.prototype,{interfaces_:function(){return[]},getClass:function(){return $e}}),$e.union=function(e,r){if(e.isEmpty()||r.isEmpty()){if(e.isEmpty()&&r.isEmpty())return fn.createEmptyResult(fn.UNION,e,r,e.getFactory());if(e.isEmpty())return r.copy();if(r.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(r),or.overlayOp(e,r,fn.UNION)},N(Jt.prototype,{equalsTopo:function(e){return this.getEnvelopeInternal().equals(e.getEnvelopeInternal())?ci.relate(this,e).isEquals(this.getDimension(),e.getDimension()):!1},union:function(){if(arguments.length===0)return rl.union(this);if(arguments.length===1){var e=arguments[0];return $e.union(this,e)}},isValid:function(){return Xr.isValid(this)},intersection:function(e){if(this.isEmpty()||e.isEmpty())return fn.createEmptyResult(fn.INTERSECTION,this,e,this.factory);if(this.isGeometryCollection()){var r=e;return vs.map(this,{interfaces_:function(){return[MapOp]},map:function(u){return u.intersection(r)}})}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(e),or.overlayOp(this,e,fn.INTERSECTION)},covers:function(e){return ci.covers(this,e)},coveredBy:function(e){return ci.coveredBy(this,e)},touches:function(e){return ci.touches(this,e)},intersects:function(e){return ci.intersects(this,e)},within:function(e){return ci.within(this,e)},overlaps:function(e){return ci.overlaps(this,e)},disjoint:function(e){return ci.disjoint(this,e)},crosses:function(e){return ci.crosses(this,e)},buffer:function(){if(arguments.length===1){var e=arguments[0];return Wr.bufferOp(this,e)}if(arguments.length===2){var r=arguments[0],u=arguments[1];return Wr.bufferOp(this,r,u)}if(arguments.length===3){var g=arguments[0],w=arguments[1],O=arguments[2];return Wr.bufferOp(this,g,w,O)}},convexHull:function(){return new ao(this).getConvexHull()},relate:function(){for(var e=arguments.length,r=Array(e),u=0;e>u;u++)r[u]=arguments[u];return ci.relate.apply(ci,[this].concat(r))},getCentroid:function(){if(this.isEmpty())return this.factory.createPoint();var e=mr.getCentroid(this);return this.createPointFromInternalCoord(e,this)},getInteriorPoint:function(){if(this.isEmpty())return this.factory.createPoint();var e=null,r=this.getDimension();if(r===0){var u=new ws(this);e=u.getInteriorPoint()}else if(r===1){var u=new mu(this);e=u.getInteriorPoint()}else{var u=new Ls(this);e=u.getInteriorPoint()}return this.createPointFromInternalCoord(e,this)},symDifference:function(e){if(this.isEmpty()||e.isEmpty()){if(this.isEmpty()&&e.isEmpty())return fn.createEmptyResult(fn.SYMDIFFERENCE,this,e,this.factory);if(this.isEmpty())return e.copy();if(e.isEmpty())return this.copy()}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(e),or.overlayOp(this,e,fn.SYMDIFFERENCE)},createPointFromInternalCoord:function(e,r){return r.getPrecisionModel().makePrecise(e),r.getFactory().createPoint(e)},toText:function(){var e=new Er;return e.write(this)},toString:function(){this.toText()},contains:function(e){return ci.contains(this,e)},difference:function(e){return this.isEmpty()?fn.createEmptyResult(fn.DIFFERENCE,this,e,this.factory):e.isEmpty()?this.copy():(this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(e),or.overlayOp(this,e,fn.DIFFERENCE))},isSimple:function(){var e=new Ta(this);return e.isSimple()},isWithinDistance:function(e,r){var u=this.getEnvelopeInternal().distance(e.getEnvelopeInternal());return u>r?!1:Gs.isWithinDistance(this,e,r)},distance:function(e){return Gs.distance(this,e)},isEquivalentClass:function(e){return this.getClass()===e.getClass()}});var fh="1.1.2 (248dab8)";z.version=fh,z.algorithm=Wl,z.densify=fc,z.dissolve=Fc,z.geom=ch,z.index=Rs,z.io=ei,z.noding=Nh,z.operation=Bc,z.precision=mc,z.simplify=Nu,z.triangulate=dh})})(Gg,Gg.exports);var qp=Gg.exports,rx=qp,T1=function(S,R){var z=new rx.io.GeoJSONReader,N=z.read(JSON.stringify(S.geometry)),W=z.read(JSON.stringify(R.geometry)),X=N.union(W),te=new rx.io.GeoJSONWriter;return X=te.write(X),{type:"Feature",geometry:X,properties:S.properties}},ET=a_,IT=T1,xg=ja;function TT(S,R,z){if(typeof R!="number")throw new Error("maxEdge parameter is required");if(typeof z!="string")throw new Error("units parameter is required");var N=ET(S),W=N.features.filter(X);N.features=W;function X(te){var a=te.geometry.coordinates[0][0],_e=te.geometry.coordinates[0][1],me=te.geometry.coordinates[0][2],xe=xg(a,_e,z),Se=xg(_e,me,z),Te=xg(a,me,z);return xe<=R&&Se<=R&&Te<=R}return ST(N)}function ST(S){for(var R=JSON.parse(JSON.stringify(S.features[0])),z=S.features,N=0,W=z.length;N<W;N++){var X=z[N];X.geometry&&(R=IT(R,X))}return R}var CT=TT,sx=qp,MT=function(S,R){var z=JSON.parse(JSON.stringify(S)),N=JSON.parse(JSON.stringify(R));z.type!=="Feature"&&(z={type:"Feature",properties:{},geometry:z}),N.type!=="Feature"&&(N={type:"Feature",properties:{},geometry:N});var W=new sx.io.GeoJSONReader,X=W.read(JSON.stringify(z.geometry)),te=W.read(JSON.stringify(N.geometry)),a=X.difference(te);if(!a.isEmpty()){var _e=new sx.io.GeoJSONWriter,me=_e.write(a);return z.geometry=a,{type:"Feature",properties:z.properties,geometry:me}}},AT=cd,PT=function(R,z,N,W){return R.features.forEach(function(X){var te=z.features.filter(function(a){return AT(a,X)}).map(function(a){return a.properties[N]});X.properties||(X.properties={}),X.properties[W]=te}),R},LT=Il.coordEach,RT=function(R){return R=JSON.parse(JSON.stringify(R)),LT(R,function(z){z.reverse()}),R},S1={exports:{}};(function(S){(function(){function R(a,_e){var me=a.x-_e.x,xe=a.y-_e.y;return me*me+xe*xe}function z(a,_e,me){var xe=_e.x,Se=_e.y,Te=me.x-xe,Qe=me.y-Se;if(Te!==0||Qe!==0){var Pe=((a.x-xe)*Te+(a.y-Se)*Qe)/(Te*Te+Qe*Qe);Pe>1?(xe=me.x,Se=me.y):Pe>0&&(xe+=Te*Pe,Se+=Qe*Pe)}return Te=a.x-xe,Qe=a.y-Se,Te*Te+Qe*Qe}function N(a,_e){for(var me=a[0],xe=[me],Se,Te=1,Qe=a.length;Te<Qe;Te++)Se=a[Te],R(Se,me)>_e&&(xe.push(Se),me=Se);return me!==Se&&xe.push(Se),xe}function W(a,_e,me,xe,Se){for(var Te=xe,Qe,Pe=_e+1;Pe<me;Pe++){var ve=z(a[Pe],a[_e],a[me]);ve>Te&&(Qe=Pe,Te=ve)}Te>xe&&(Qe-_e>1&&W(a,_e,Qe,xe,Se),Se.push(a[Qe]),me-Qe>1&&W(a,Qe,me,xe,Se))}function X(a,_e){var me=a.length-1,xe=[a[0]];return W(a,0,me,_e,xe),xe.push(a[me]),xe}function te(a,_e,me){if(a.length<=2)return a;var xe=_e!==void 0?_e*_e:1;return a=me?a:N(a,xe),a=X(a,xe),a}S.exports=te,S.exports.default=te})()})(S1);var DT=S1.exports,qg=DT,ox=["LineString","MultiLineString","Polygon","MultiPolygon"],OT=function(S,R,z){return S.type==="Feature"?ax(bg(S,R,z),S.properties):S.type==="FeatureCollection"?{type:"FeatureCollection",features:S.features.map(function(N){var W=bg(N,R,z);return ox.indexOf(W.type)>-1?ax(W,N.properties):W})}:S.type==="GeometryCollection"?{type:"GeometryCollection",geometries:S.geometries.map(function(N){return ox.indexOf(N.type)>-1?bg({type:"Feature",geometry:N},R,z):N})}:S};function bg(S,R,z){return S.geometry.type==="LineString"?{type:"LineString",coordinates:lx(S.geometry.coordinates,R,z)}:S.geometry.type==="MultiLineString"?{type:"MultiLineString",coordinates:S.geometry.coordinates.map(function(N){return lx(N,R,z)})}:S.geometry.type==="Polygon"?{type:"Polygon",coordinates:ux(S.geometry.coordinates,R,z)}:S.geometry.type==="MultiPolygon"?{type:"MultiPolygon",coordinates:S.geometry.coordinates.map(function(N){return ux(N,R,z)})}:S}function NT(S){return S.length<3?!1:!(S.length===3&&S[2][0]===S[0][0]&&S[2][1]===S[0][1])}function ax(S,R){return{type:"Feature",geometry:S,properties:R}}function lx(S,R,z){return qg(S.map(function(N){return{x:N[0],y:N[1]}}),R,z).map(function(N){return[N.x,N.y]})}function ux(S,R,z){return S.map(function(N){var W=N.map(function(te){return{x:te[0],y:te[1]}});if(W.length<4)throw new Error("Invalid polygon");for(var X=qg(W,R,z).map(function(te){return[te.x,te.y]});!NT(X);)R-=R*.01,X=qg(W,R,z).map(function(te){return[te.x,te.y]});return(X[X.length-1][0]!==X[0][0]||X[X.length-1][1]!==X[0][1])&&X.push(X[0]),X})}var jp=function(S){this.points=S.points||[],this.duration=S.duration||1e4,this.sharpness=S.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=S.stepLength||60,this.length=this.points.length,this.delay=0;for(var R=0;R<this.length;R++)this.points[R].z=this.points[R].z||0;for(var R=0;R<this.length-1;R++){var z=this.points[R],N=this.points[R+1];this.centers.push({x:(z.x+N.x)/2,y:(z.y+N.y)/2,z:(z.z+N.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(var R=0;R<this.centers.length-1;R++){var z=this.centers[R],N=this.centers[R+1],W=this.points[R+1].x-(this.centers[R].x+this.centers[R+1].x)/2,X=this.points[R+1].y-(this.centers[R].y+this.centers[R+1].y)/2,te=this.points[R+1].z-(this.centers[R].y+this.centers[R+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[R+1].x+this.sharpness*(this.centers[R].x+W),y:(1-this.sharpness)*this.points[R+1].y+this.sharpness*(this.centers[R].y+X),z:(1-this.sharpness)*this.points[R+1].z+this.sharpness*(this.centers[R].z+te)},{x:(1-this.sharpness)*this.points[R+1].x+this.sharpness*(this.centers[R+1].x+W),y:(1-this.sharpness)*this.points[R+1].y+this.sharpness*(this.centers[R+1].y+X),z:(1-this.sharpness)*this.points[R+1].z+this.sharpness*(this.centers[R+1].z+te)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};jp.prototype.cacheSteps=function(S){var R=[],z=this.pos(0);R.push(0);for(var N=0;N<this.duration;N+=10){var W=this.pos(N),X=Math.sqrt((W.x-z.x)*(W.x-z.x)+(W.y-z.y)*(W.y-z.y)+(W.z-z.z)*(W.z-z.z));X>S&&(R.push(N),z=W)}return R};jp.prototype.vector=function(S){var R=this.pos(S+10),z=this.pos(S-10);return{angle:180*Math.atan2(R.y-z.y,R.x-z.x)/3.14,speed:Math.sqrt((z.x-R.x)*(z.x-R.x)+(z.y-R.y)*(z.y-R.y)+(z.z-R.z)*(z.z-R.z))}};jp.prototype.pos=function(S){function R(te,a,_e,me,xe){var Se=function(Pe){var ve=Pe*Pe,Nt=ve*Pe;return[Nt,3*ve*(1-Pe),3*Pe*(1-Pe)*(1-Pe),(1-Pe)*(1-Pe)*(1-Pe)]},Te=Se(te),Qe={x:xe.x*Te[0]+me.x*Te[1]+_e.x*Te[2]+a.x*Te[3],y:xe.y*Te[0]+me.y*Te[1]+_e.y*Te[2]+a.y*Te[3],z:xe.z*Te[0]+me.z*Te[1]+_e.z*Te[2]+a.z*Te[3]};return Qe}var z=S-this.delay;z<0&&(z=0),z>this.duration&&(z=this.duration-1);var N=z/this.duration;if(N>=1)return this.points[this.length-1];var W=Math.floor((this.points.length-1)*N),X=(this.length-1)*N-W;return R(X,this.points[W],this.controls[W][1],this.controls[W+1][0],this.points[W+1])};var zT=jp,FT=ii.lineString,kT=zT,BT=function(S,R,z){var N=FT([]);N.properties=S.properties;for(var W=new kT({points:S.geometry.coordinates.map(function(a){return{x:a[0],y:a[1]}}),duration:R,sharpness:z}),X=0;X<W.duration;X+=10){var te=W.pos(X);Math.floor(X/100)%2===0&&N.geometry.coordinates.push([te.x,te.y])}return N},VT=cd,UT=function(S,R,z,N){return S=JSON.parse(JSON.stringify(S)),R=JSON.parse(JSON.stringify(R)),S.features.forEach(function(W){W.properties||(W.properties={}),R.features.forEach(function(X){if(W.properties[N]===void 0){var te=VT(W,X);te&&(W.properties[N]=X.properties[z])}})}),S},GT=ii.featureCollection,qT=function(S,R){var z=GT(jT(S.features,R));return z};function jT(S,R){for(var z=S.slice(0),N=S.length,W=N-R,X,te;N-- >W;)te=Math.floor((N+1)*Math.random()),X=z[te],z[te]=z[N],z[N]=X;return z.slice(W)}var HT=ii.polygon,C1=function(S){var R=[S[0],S[1]],z=[S[0],S[3]],N=[S[2],S[3]],W=[S[2],S[1]];return HT([[R,W,N,z,R]])},ZT=Up,WT=C1,$T=function(S){return WT(ZT(S))},cx=lh.getCoord,Hp=function(S,R){var z=Math.PI/180,N=180/Math.PI,W=cx(S),X=cx(R),te=z*W[0],a=z*X[0],_e=z*W[1],me=z*X[1],xe=Math.sin(a-te)*Math.cos(me),Se=Math.cos(_e)*Math.sin(me)-Math.sin(_e)*Math.cos(me)*Math.cos(a-te),Te=N*Math.atan2(xe,Se);return Te},XT=lh.getCoord,M1=ii,YT=M1.point,JT=M1.distanceToRadians,Zp=function(S,R,z,N){var W=Math.PI/180,X=180/Math.PI,te=XT(S),a=W*te[0],_e=W*te[1],me=W*z,xe=JT(R,N),Se=Math.asin(Math.sin(_e)*Math.cos(xe)+Math.cos(_e)*Math.sin(xe)*Math.cos(me)),Te=a+Math.atan2(Math.sin(me)*Math.sin(xe)*Math.cos(_e),Math.cos(xe)-Math.sin(_e)*Math.sin(Se));return YT([X*Te,X*Se])},KT=Hp,QT=Zp,eS=ja,tS=function(S,R){var z=eS(S,R,"miles"),N=KT(S,R),W=QT(S,z/2,N,"miles");return W},nS=rS,iS={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function rS(S){if(!S||!S.type)return null;var R=iS[S.type];if(!R)return null;if(R==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:S}]};if(R==="feature")return{type:"FeatureCollection",features:[S]};if(R==="featurecollection")return S}var A1=ii,sS=A1.featureCollection,hx=qp,dx=nS,oS=function(S,R,z){var N=A1.distanceToDegrees(R,z),W=dx(S),X=dx(sS(W.features.map(function(te){return aS(te,N)})));if(X.features.length>1)return X;if(X.features.length===1)return X.features[0]};function aS(S,R){var z=new hx.io.GeoJSONReader,N=z.read(S.geometry),W=N.buffer(R),X=new hx.io.GeoJSONWriter;return W=X.write(W),{type:"Feature",geometry:W,properties:{}}}var lS=Up,uS=ii.point,P1=function(S){var R=lS(S),z=(R[0]+R[2])/2,N=(R[1]+R[3])/2;return uS([z,N])},cS=Il.coordEach,hS=ii.point,dS=function(S){var R=0,z=0,N=0;return cS(S,function(W){R+=W[0],z+=W[1],N++},!0),hS([R/N,z/N])},fS=Il,pS=function(S){var R={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},z=Object.keys(R).reduce(function(W,X){return W[X.replace("Multi","")]=X,W},{});function N(W,X,te){te?R[X].coordinates=R[X].coordinates.concat(W.geometry.coordinates):R[X].coordinates.push(W.geometry.coordinates),R[X].properties.push(W.properties)}return fS.featureEach(S,function(W){W.geometry&&(R[W.geometry.type]?N(W,W.geometry.type,!0):z[W.geometry.type]&&N(W,z[W.geometry.type],!1))}),{type:"FeatureCollection",features:Object.keys(R).filter(function(W){return R[W].coordinates.length}).sort().map(function(W){return{type:"Feature",properties:{collectedProperties:R[W].properties},geometry:{type:W,coordinates:R[W].coordinates}}})}},mS=ii.featureCollection,gS=Il.coordEach,_S=ii.point,L1=function(S){var R=[];return gS(S,function(z){R.push(_S(z))}),mS(R)},p_={exports:{}};p_.exports=Wp;p_.exports.default=Wp;function Wp(S,R,z){z=z||2;var N=R&&R.length,W=N?R[0]*z:S.length,X=R1(S,0,W,z,!0),te=[];if(!X||X.next===X.prev)return te;var a,_e,me,xe,Se,Te,Qe;if(N&&(X=wS(S,R,X,z)),S.length>80*z){a=me=S[0],_e=xe=S[1];for(var Pe=z;Pe<W;Pe+=z)Se=S[Pe],Te=S[Pe+1],Se<a&&(a=Se),Te<_e&&(_e=Te),Se>me&&(me=Se),Te>xe&&(xe=Te);Qe=Math.max(me-a,xe-_e),Qe=Qe!==0?32767/Qe:0}return df(X,te,z,a,_e,Qe,0),te}function R1(S,R,z,N,W){var X,te;if(W===Zg(S,R,z,N)>0)for(X=R;X<z;X+=N)te=fx(X,S[X],S[X+1],te);else for(X=z-N;X>=R;X-=N)te=fx(X,S[X],S[X+1],te);return te&&$p(te,te.next)&&(pf(te),te=te.next),te}function Mh(S,R){if(!S)return S;R||(R=S);var z=S,N;do if(N=!1,!z.steiner&&($p(z,z.next)||Qr(z.prev,z,z.next)===0)){if(pf(z),z=R=z.prev,z===z.next)break;N=!0}else z=z.next;while(N||z!==R);return R}function df(S,R,z,N,W,X,te){if(S){!te&&X&&CS(S,N,W,X);for(var a=S,_e,me;S.prev!==S.next;){if(_e=S.prev,me=S.next,X?vS(S,N,W,X):yS(S)){R.push(_e.i/z|0),R.push(S.i/z|0),R.push(me.i/z|0),pf(S),S=me.next,a=me.next;continue}if(S=me,S===a){te?te===1?(S=xS(Mh(S),R,z),df(S,R,z,N,W,X,2)):te===2&&bS(S,R,z,N,W,X):df(Mh(S),R,z,N,W,X,1);break}}}}function yS(S){var R=S.prev,z=S,N=S.next;if(Qr(R,z,N)>=0)return!1;for(var W=R.x,X=z.x,te=N.x,a=R.y,_e=z.y,me=N.y,xe=W<X?W<te?W:te:X<te?X:te,Se=a<_e?a<me?a:me:_e<me?_e:me,Te=W>X?W>te?W:te:X>te?X:te,Qe=a>_e?a>me?a:me:_e>me?_e:me,Pe=N.next;Pe!==R;){if(Pe.x>=xe&&Pe.x<=Te&&Pe.y>=Se&&Pe.y<=Qe&&id(W,a,X,_e,te,me,Pe.x,Pe.y)&&Qr(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.next}return!0}function vS(S,R,z,N){var W=S.prev,X=S,te=S.next;if(Qr(W,X,te)>=0)return!1;for(var a=W.x,_e=X.x,me=te.x,xe=W.y,Se=X.y,Te=te.y,Qe=a<_e?a<me?a:me:_e<me?_e:me,Pe=xe<Se?xe<Te?xe:Te:Se<Te?Se:Te,ve=a>_e?a>me?a:me:_e>me?_e:me,Nt=xe>Se?xe>Te?xe:Te:Se>Te?Se:Te,wt=jg(Qe,Pe,R,z,N),Bt=jg(ve,Nt,R,z,N),je=S.prevZ,Ae=S.nextZ;je&&je.z>=wt&&Ae&&Ae.z<=Bt;){if(je.x>=Qe&&je.x<=ve&&je.y>=Pe&&je.y<=Nt&&je!==W&&je!==te&&id(a,xe,_e,Se,me,Te,je.x,je.y)&&Qr(je.prev,je,je.next)>=0||(je=je.prevZ,Ae.x>=Qe&&Ae.x<=ve&&Ae.y>=Pe&&Ae.y<=Nt&&Ae!==W&&Ae!==te&&id(a,xe,_e,Se,me,Te,Ae.x,Ae.y)&&Qr(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;je&&je.z>=wt;){if(je.x>=Qe&&je.x<=ve&&je.y>=Pe&&je.y<=Nt&&je!==W&&je!==te&&id(a,xe,_e,Se,me,Te,je.x,je.y)&&Qr(je.prev,je,je.next)>=0)return!1;je=je.prevZ}for(;Ae&&Ae.z<=Bt;){if(Ae.x>=Qe&&Ae.x<=ve&&Ae.y>=Pe&&Ae.y<=Nt&&Ae!==W&&Ae!==te&&id(a,xe,_e,Se,me,Te,Ae.x,Ae.y)&&Qr(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function xS(S,R,z){var N=S;do{var W=N.prev,X=N.next.next;!$p(W,X)&&D1(W,N,N.next,X)&&ff(W,X)&&ff(X,W)&&(R.push(W.i/z|0),R.push(N.i/z|0),R.push(X.i/z|0),pf(N),pf(N.next),N=S=X),N=N.next}while(N!==S);return Mh(N)}function bS(S,R,z,N,W,X){var te=S;do{for(var a=te.next.next;a!==te.prev;){if(te.i!==a.i&&PS(te,a)){var _e=O1(te,a);te=Mh(te,te.next),_e=Mh(_e,_e.next),df(te,R,z,N,W,X,0),df(_e,R,z,N,W,X,0);return}a=a.next}te=te.next}while(te!==S)}function wS(S,R,z,N){var W=[],X,te,a,_e,me;for(X=0,te=R.length;X<te;X++)a=R[X]*N,_e=X<te-1?R[X+1]*N:S.length,me=R1(S,a,_e,N,!1),me===me.next&&(me.steiner=!0),W.push(AS(me));for(W.sort(ES),X=0;X<W.length;X++)z=IS(W[X],z);return z}function ES(S,R){return S.x-R.x}function IS(S,R){var z=TS(S,R);if(!z)return R;var N=O1(z,S);return Mh(N,N.next),Mh(z,z.next)}function TS(S,R){var z=R,N=S.x,W=S.y,X=-1/0,te;do{if(W<=z.y&&W>=z.next.y&&z.next.y!==z.y){var a=z.x+(W-z.y)*(z.next.x-z.x)/(z.next.y-z.y);if(a<=N&&a>X&&(X=a,te=z.x<z.next.x?z:z.next,a===N))return te}z=z.next}while(z!==R);if(!te)return null;var _e=te,me=te.x,xe=te.y,Se=1/0,Te;z=te;do N>=z.x&&z.x>=me&&N!==z.x&&id(W<xe?N:X,W,me,xe,W<xe?X:N,W,z.x,z.y)&&(Te=Math.abs(W-z.y)/(N-z.x),ff(z,S)&&(Te<Se||Te===Se&&(z.x>te.x||z.x===te.x&&SS(te,z)))&&(te=z,Se=Te)),z=z.next;while(z!==_e);return te}function SS(S,R){return Qr(S.prev,S,R.prev)<0&&Qr(R.next,S,S.next)<0}function CS(S,R,z,N){var W=S;do W.z===0&&(W.z=jg(W.x,W.y,R,z,N)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==S);W.prevZ.nextZ=null,W.prevZ=null,MS(W)}function MS(S){var R,z,N,W,X,te,a,_e,me=1;do{for(z=S,S=null,X=null,te=0;z;){for(te++,N=z,a=0,R=0;R<me&&(a++,N=N.nextZ,!!N);R++);for(_e=me;a>0||_e>0&&N;)a!==0&&(_e===0||!N||z.z<=N.z)?(W=z,z=z.nextZ,a--):(W=N,N=N.nextZ,_e--),X?X.nextZ=W:S=W,W.prevZ=X,X=W;z=N}X.nextZ=null,me*=2}while(te>1);return S}function jg(S,R,z,N,W){return S=(S-z)*W|0,R=(R-N)*W|0,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,R=(R|R<<8)&16711935,R=(R|R<<4)&252645135,R=(R|R<<2)&858993459,R=(R|R<<1)&1431655765,S|R<<1}function AS(S){var R=S,z=S;do(R.x<z.x||R.x===z.x&&R.y<z.y)&&(z=R),R=R.next;while(R!==S);return z}function id(S,R,z,N,W,X,te,a){return(W-te)*(R-a)>=(S-te)*(X-a)&&(S-te)*(N-a)>=(z-te)*(R-a)&&(z-te)*(X-a)>=(W-te)*(N-a)}function PS(S,R){return S.next.i!==R.i&&S.prev.i!==R.i&&!LS(S,R)&&(ff(S,R)&&ff(R,S)&&RS(S,R)&&(Qr(S.prev,S,R.prev)||Qr(S,R.prev,R))||$p(S,R)&&Qr(S.prev,S,S.next)>0&&Qr(R.prev,R,R.next)>0)}function Qr(S,R,z){return(R.y-S.y)*(z.x-R.x)-(R.x-S.x)*(z.y-R.y)}function $p(S,R){return S.x===R.x&&S.y===R.y}function D1(S,R,z,N){var W=Tp(Qr(S,R,z)),X=Tp(Qr(S,R,N)),te=Tp(Qr(z,N,S)),a=Tp(Qr(z,N,R));return!!(W!==X&&te!==a||W===0&&Ip(S,z,R)||X===0&&Ip(S,N,R)||te===0&&Ip(z,S,N)||a===0&&Ip(z,R,N))}function Ip(S,R,z){return R.x<=Math.max(S.x,z.x)&&R.x>=Math.min(S.x,z.x)&&R.y<=Math.max(S.y,z.y)&&R.y>=Math.min(S.y,z.y)}function Tp(S){return S>0?1:S<0?-1:0}function LS(S,R){var z=S;do{if(z.i!==S.i&&z.next.i!==S.i&&z.i!==R.i&&z.next.i!==R.i&&D1(z,z.next,S,R))return!0;z=z.next}while(z!==S);return!1}function ff(S,R){return Qr(S.prev,S,S.next)<0?Qr(S,R,S.next)>=0&&Qr(S,S.prev,R)>=0:Qr(S,R,S.prev)<0||Qr(S,S.next,R)<0}function RS(S,R){var z=S,N=!1,W=(S.x+R.x)/2,X=(S.y+R.y)/2;do z.y>X!=z.next.y>X&&z.next.y!==z.y&&W<(z.next.x-z.x)*(X-z.y)/(z.next.y-z.y)+z.x&&(N=!N),z=z.next;while(z!==S);return N}function O1(S,R){var z=new Hg(S.i,S.x,S.y),N=new Hg(R.i,R.x,R.y),W=S.next,X=R.prev;return S.next=R,R.prev=S,z.next=W,W.prev=z,N.next=z,z.prev=N,X.next=N,N.prev=X,N}function fx(S,R,z,N){var W=new Hg(S,R,z);return N?(W.next=N.next,W.prev=N,N.next.prev=W,N.next=W):(W.prev=W,W.next=W),W}function pf(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function Hg(S,R,z){this.i=S,this.x=R,this.y=z,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Wp.deviation=function(S,R,z,N){var W=R&&R.length,X=W?R[0]*z:S.length,te=Math.abs(Zg(S,0,X,z));if(W)for(var a=0,_e=R.length;a<_e;a++){var me=R[a]*z,xe=a<_e-1?R[a+1]*z:S.length;te-=Math.abs(Zg(S,me,xe,z))}var Se=0;for(a=0;a<N.length;a+=3){var Te=N[a]*z,Qe=N[a+1]*z,Pe=N[a+2]*z;Se+=Math.abs((S[Te]-S[Pe])*(S[Qe+1]-S[Te+1])-(S[Te]-S[Qe])*(S[Pe+1]-S[Te+1]))}return te===0&&Se===0?0:Math.abs((Se-te)/te)};function Zg(S,R,z,N){for(var W=0,X=R,te=z-N;X<z;X+=N)W+=(S[te]-S[X])*(S[X+1]+S[te+1]),te=X;return W}Wp.flatten=function(S){for(var R=S[0][0].length,z={vertices:[],holes:[],dimensions:R},N=0,W=0;W<S.length;W++){for(var X=0;X<S[W].length;X++)for(var te=0;te<R;te++)z.vertices.push(S[W][X][te]);W>0&&(N+=S[W-1].length,z.holes.push(N))}return z};var DS=p_.exports,OS=ii.polygon,NS=DS,zS=function(S){if(!S.geometry||S.geometry.type!=="Polygon"&&S.geometry.type!=="MultiPolygon")throw new Error("input must be a Polygon or MultiPolygon");var R={type:"FeatureCollection",features:[]};return S.geometry.type==="Polygon"?R.features=px(S.geometry.coordinates):S.geometry.coordinates.forEach(function(z){R.features=R.features.concat(px(z))}),R};function px(S){var R=FS(S),z=2,N=NS(R.vertices,R.holes,z),W=[],X=[];N.forEach(function(_e,me){var xe=N[me];X.push([R.vertices[xe*z],R.vertices[xe*z+1]])});for(var te=0;te<X.length;te+=3){var a=X.slice(te,te+3);a.push(X[te]),W.push(OS([a]))}return W}function FS(S){for(var R=S[0][0].length,z={vertices:[],holes:[],dimensions:R},N=0,W=0;W<S.length;W++){for(var X=0;X<S[W].length;X++)for(var te=0;te<R;te++)z.vertices.push(S[W][X][te]);W>0&&(N+=S[W-1].length,z.holes.push(N))}return z}var mx=qp,kS=function(R,z){var N,W;R.type==="Feature"?N=R.geometry:N=R,z.type==="Feature"?W=z.geometry:W=z;var X=new mx.io.GeoJSONReader,te=X.read(JSON.stringify(N)),a=X.read(JSON.stringify(W)),_e=te.intersection(a);if(!_e.isEmpty()){var me=new mx.io.GeoJSONWriter,xe=me.write(_e);return{type:"Feature",properties:{},geometry:xe}}},BS=ja,VS=function(S,R){for(var z,N=1/0,W=0;W<R.features.length;W++){var X=BS(S,R.features[W],"miles");X<N&&(z=R.features[W],N=X)}return z},Ef={exports:{}};Ef.exports=function(){throw new Error("call .point() or .polygon() instead")};function m_(S){return S?GS(S):[z1(),F1()]}Ef.exports.position=m_;Ef.exports.point=function(S,R){var z=[];for(i=0;i<S;i++)z.push(k1(R?gx(m_(R)):gx()));return B1(z)};Ef.exports.polygon=function(S,R,z,N){typeof R!="number"&&(R=10),typeof z!="number"&&(z=10);var W=[];for(i=0;i<S;i++){var X=[],te=Array.apply(null,new Array(R+1)).map(Math.random);te.forEach(a),te.forEach(_e),X[X.length-1]=X[0],X=X.map(US(m_(N))),W.push(k1(qS([X])))}function a(me,xe,Se){Se[xe]=xe>0?me+Se[xe-1]:me}function _e(me,xe){me=me*2*Math.PI/te[te.length-1];var Se=Math.random();X.push([Se*z*Math.sin(me),Se*z*Math.cos(me)])}return B1(W)};function US(S){return function(R,z){return[R[0]+S[0],R[1]+S[1]]}}function N1(){return Math.random()-.5}function z1(){return N1()*360}function F1(){return N1()*180}function gx(S){return{type:"Point",coordinates:S||[z1(),F1()]}}function GS(S){return[Math.random()*(S[2]-S[0])+S[0],Math.random()*(S[3]-S[1])+S[1]]}function qS(S){return{type:"Polygon",coordinates:S}}function k1(S){return{type:"Feature",geometry:S,properties:{}}}function B1(S){return{type:"FeatureCollection",features:S}}var jS=Ef.exports,_x=jS,HS=function(S,R,z){switch(z=z||{},R=R||1,S){case"point":case"points":case void 0:return _x.point(R,z.bbox);case"polygon":case"polygons":return _x.polygon(R,z.num_vertices,z.max_radial_length,z.bbox);default:throw new Error("Unknown type given: valid options are points and polygons")}},ZS=ii.point,WS=function(S){var R,z={type:"FeatureCollection",features:[]};return S.type==="Feature"?R=S.geometry:R=S,R.coordinates.forEach(function(N){R.coordinates.forEach(function(W){for(var X=0;X<N.length-1;X++)for(var te=0;te<W.length-1;te++)if(!(N===W&&(Math.abs(X-te)===1||Math.abs(X-te)===N.length-2))){var a=$S(N[X][0],N[X][1],N[X+1][0],N[X+1][1],W[te][0],W[te][1],W[te+1][0],W[te+1][1]);a&&z.features.push(ZS([a[0],a[1]]))}})}),z};function $S(S,R,z,N,W,X,te,a){var _e,me,xe,Se,Te,Qe={x:null,y:null,onLine1:!1,onLine2:!1};return _e=(a-X)*(z-S)-(te-W)*(N-R),_e===0?Qe.x!==null&&Qe.y!==null?Qe:!1:(me=R-X,xe=S-W,Se=(te-W)*me-(a-X)*xe,Te=(z-S)*me-(N-R)*xe,me=Se/_e,xe=Te/_e,Qe.x=S+me*(z-S),Qe.y=R+me*(N-R),me>=0&&me<=1&&(Qe.onLine1=!0),xe>=0&&xe<=1&&(Qe.onLine2=!0),Qe.onLine1&&Qe.onLine2?[Qe.x,Qe.y]:!1)}var yx=ii.featureCollection,XS=P1,YS=ja,JS=cd,KS=L1;function QS(S){S.type!=="FeatureCollection"&&(S.type!=="Feature"&&(S={type:"Feature",geometry:S,properties:{}}),S=yx([S]));for(var R=XS(S),z=!1,N=0;!z&&N<S.features.length;){var W=S.features[N].geometry,X,te,a,_e,me,xe,Se,Te=!1;if(W.type==="Point")R.geometry.coordinates[0]===W.coordinates[0]&&R.geometry.coordinates[1]===W.coordinates[1]&&(z=!0);else if(W.type==="MultiPoint"){var Qe=!1;for(Se=0;!Qe&&Se<W.coordinates.length;)R.geometry.coordinates[0]===W.coordinates[Se][0]&&R.geometry.coordinates[1]===W.coordinates[Se][1]&&(z=!0,Qe=!0),Se++}else if(W.type==="LineString")for(Se=0;!Te&&Se<W.coordinates.length-1;)X=R.geometry.coordinates[0],te=R.geometry.coordinates[1],a=W.coordinates[Se][0],_e=W.coordinates[Se][1],me=W.coordinates[Se+1][0],xe=W.coordinates[Se+1][1],vx(X,te,a,_e,me,xe)&&(Te=!0,z=!0),Se++;else if(W.type==="MultiLineString")for(var Pe=0;Pe<W.coordinates.length;){Te=!1,Se=0;for(var ve=W.coordinates[Pe];!Te&&Se<ve.length-1;)X=R.geometry.coordinates[0],te=R.geometry.coordinates[1],a=ve[Se][0],_e=ve[Se][1],me=ve[Se+1][0],xe=ve[Se+1][1],vx(X,te,a,_e,me,xe)&&(Te=!0,z=!0),Se++;Pe++}else if(W.type==="Polygon"||W.type==="MultiPolygon"){var Nt={type:"Feature",geometry:W,properties:{}};JS(R,Nt)&&(z=!0)}N++}if(z)return R;var wt=yx([]);for(N=0;N<S.features.length;N++)wt.features=wt.features.concat(KS(S.features[N]).features);var Bt,je=1/0;for(N=0;N<wt.features.length;N++){var Ae=YS(R,wt.features[N],"miles");Ae<je&&(je=Ae,Bt=wt.features[N])}return Bt}function vx(S,R,z,N,W,X){var te=Math.sqrt((W-z)*(W-z)+(X-N)*(X-N)),a=Math.sqrt((S-z)*(S-z)+(R-N)*(R-N)),_e=Math.sqrt((W-S)*(W-S)+(X-R)*(X-R));if(te===a+_e)return!0}var eC=QS,g_={},Xp={};Xp.RADIUS=6378137;Xp.FLATTENING=1/298.257223563;Xp.POLAR_RADIUS=63567523142e-4;var xx=Xp;g_.geometry=V1;g_.ring=Wg;function V1(S){var R=0,z;switch(S.type){case"Polygon":return bx(S.coordinates);case"MultiPolygon":for(z=0;z<S.coordinates.length;z++)R+=bx(S.coordinates[z]);return R;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(z=0;z<S.geometries.length;z++)R+=V1(S.geometries[z]);return R}}function bx(S){var R=0;if(S&&S.length>0){R+=Math.abs(Wg(S[0]));for(var z=1;z<S.length;z++)R-=Math.abs(Wg(S[z]))}return R}function Wg(S){var R,z,N,W,X,te,a=0,_e=S.length;if(_e>2){for(i=0;i<_e;i++)i===_e-2?(W=_e-2,X=_e-1,te=0):i===_e-1?(W=_e-1,X=0,te=1):(W=i,X=i+1,te=i+2),R=S[W],z=S[X],N=S[te],a+=(wg(N[0])-wg(R[0]))*Math.sin(wg(z[1]));a=a*xx.RADIUS*xx.RADIUS/2}return a}function wg(S){return S*Math.PI/180}var Eg=g_.geometry;function tC(S){if(S.type==="FeatureCollection"){for(var R=0,z=0;R<S.features.length;R++)S.features[R].geometry&&(z+=Eg(S.features[R].geometry));return z}else return S.type==="Feature"?Eg(S.geometry):Eg(S)}var nC=tC,iC=ja,wx=ii.point,rC=Hp,sC=Zp,oC=function(S,R,z){var N;if(S.type==="Feature")N=S.geometry.coordinates;else if(S.type==="LineString")N=S.coordinates;else throw new Error("input must be a LineString Feature or Geometry");for(var W=0,X=0;X<N.length&&!(R>=W&&X===N.length-1);X++)if(W>=R){var te=R-W;if(te){var a=rC(N[X],N[X-1])-180,_e=sC(N[X],te,a,z);return _e}else return wx(N[X])}else W+=iC(N[X],N[X+1],z);return wx(N[N.length-1])},aC=ja,Ex=ii.point,lC=function S(R,z){if(R.type==="FeatureCollection")return R.features.reduce(function(a,_e){return a+S(_e,z)},0);var N=R.type==="Feature"?R.geometry:R,W,X;if(N.type==="LineString")return Ig(N.coordinates,z);if(N.type==="Polygon"||N.type==="MultiLineString"){for(W=0,X=0;X<N.coordinates.length;X++)W+=Ig(N.coordinates[X],z);return W}else if(R.type==="MultiPolygon"){for(W=0,X=0;X<N.coordinates.length;X++)for(var te=0;te<N.coordinates[X].length;te++)W+=Ig(N.coordinates[X][te],z);return W}else throw new Error("input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry (or a FeatureCollection containing only those types)")};function Ig(S,R){for(var z=0,N=Ex(S[0]),W=Ex(S[0]),X,te=1;te<S.length;te++)W.geometry.coordinates=S[te],z+=aC(N,W,R),X=N,N=W,W=X;return z}var Tg=ja,Sp=ii.point,uC=Hp,Ix=Zp,U1=function(S,R){var z;if(S.type==="Feature")z=S.geometry.coordinates;else if(S.type==="LineString")z=S.coordinates;else throw new Error("input must be a LineString Feature or Geometry");return cC(R,z)};function cC(S,R){for(var z="miles",N=Sp([1/0,1/0],{dist:1/0}),W=0;W<R.length-1;W++){var X=Sp(R[W]),te=Sp(R[W+1]);X.properties.dist=Tg(S,X,z),te.properties.dist=Tg(S,te,z);var a=Math.max(X.properties.dist,te.properties.dist),_e=uC(X,te),me=Ix(S,a,_e+90,z),xe=Ix(S,a,_e-90,z),Se=hC(me.geometry.coordinates[0],me.geometry.coordinates[1],xe.geometry.coordinates[0],xe.geometry.coordinates[1],X.geometry.coordinates[0],X.geometry.coordinates[1],te.geometry.coordinates[0],te.geometry.coordinates[1]),Te;Se&&(Te=Sp(Se),Te.properties.dist=Tg(S,Te,z)),X.properties.dist<N.properties.dist&&(N=X,N.properties.index=W),te.properties.dist<N.properties.dist&&(N=te,N.properties.index=W),Te&&Te.properties.dist<N.properties.dist&&(N=Te,N.properties.index=W)}return N}function hC(S,R,z,N,W,X,te,a){var _e,me,xe,Se,Te,Qe={x:null,y:null,onLine1:!1,onLine2:!1};return _e=(a-X)*(z-S)-(te-W)*(N-R),_e===0?Qe.x!==null&&Qe.y!==null?Qe:!1:(me=R-X,xe=S-W,Se=(te-W)*me-(a-X)*xe,Te=(z-S)*me-(N-R)*xe,me=Se/_e,xe=Te/_e,Qe.x=S+me*(z-S),Qe.y=R+me*(N-R),me>0&&me<1&&(Qe.onLine1=!0),xe>0&&xe<1&&(Qe.onLine2=!0),Qe.onLine1&&Qe.onLine2?[Qe.x,Qe.y]:!1)}var dC=ii.lineString,Tx=U1,fC=function(R,z,N){var W;if(N.type==="Feature")W=N.geometry.coordinates;else if(N.type==="LineString")W=N.coordinates;else throw new Error("input must be a LineString Feature or Geometry");var X=Tx(N,R),te=Tx(N,z),a;X.properties.index<=te.properties.index?a=[X,te]:a=[te,X];for(var _e=dC([a[0].geometry.coordinates],{}),me=a[0].properties.index+1;me<a[1].properties.index+1;me++)_e.geometry.coordinates.push(W[me]);return _e.geometry.coordinates.push(a[1].geometry.coordinates),_e},rf=ii.point,pC=ii.featureCollection,Sx=ja,mC=function(R,z,N){for(var W=pC([]),X=z/Sx(rf([R[0],R[1]]),rf([R[2],R[1]]),N),te=X*(R[2]-R[0]),a=z/Sx(rf([R[0],R[1]]),rf([R[0],R[3]]),N),_e=a*(R[3]-R[1]),me=R[0];me<=R[2];){for(var xe=R[1];xe<=R[3];)W.features.push(rf([me,xe])),xe+=_e;me+=te}return W},gC=ii.featureCollection,Cp=ii.point,_C=ii.polygon,Cx=ja,yC=function(R,z,N){for(var W=gC([]),X=z/Cx(Cp([R[0],R[1]]),Cp([R[2],R[1]]),N),te=X*(R[2]-R[0]),a=z/Cx(Cp([R[0],R[1]]),Cp([R[0],R[3]]),N),_e=a*(R[3]-R[1]),me=R[0];me<=R[2];){for(var xe=R[1];xe<=R[3];){var Se=_C([[[me,xe],[me,xe+_e],[me+te,xe+_e],[me+te,xe],[me,xe]]]);W.features.push(Se),xe+=_e}me+=te}return W},vC=ii.featureCollection,eh=ii.polygon,Mx=ja,xC=function(S,R,z){for(var N=vC([]),W=R/Mx([S[0],S[1]],[S[2],S[1]],z),X=W*(S[2]-S[0]),te=R/Mx([S[0],S[1]],[S[0],S[3]],z),a=te*(S[3]-S[1]),_e=0,me=S[0];me<=S[2];){for(var xe=0,Se=S[1];Se<=S[3];)_e%2===0&&xe%2===0?N.features.push(eh([[[me,Se],[me,Se+a],[me+X,Se],[me,Se]]]),eh([[[me,Se+a],[me+X,Se+a],[me+X,Se],[me,Se+a]]])):_e%2===0&&xe%2===1?N.features.push(eh([[[me,Se],[me+X,Se+a],[me+X,Se],[me,Se]]]),eh([[[me,Se],[me,Se+a],[me+X,Se+a],[me,Se]]])):xe%2===0&&_e%2===1?N.features.push(eh([[[me,Se],[me,Se+a],[me+X,Se+a],[me,Se]]]),eh([[[me,Se],[me+X,Se+a],[me+X,Se],[me,Se]]])):xe%2===1&&_e%2===1&&N.features.push(eh([[[me,Se],[me,Se+a],[me+X,Se],[me,Se]]]),eh([[[me,Se+a],[me+X,Se+a],[me+X,Se],[me,Se+a]]])),Se+=a,xe++;_e++,me+=X}return N},Mp=ii.point,G1=ii.polygon,Ax=ja,bC=ii.featureCollection,Op=[],Np=[];for(var Sg=0;Sg<6;Sg++){var Px=2*Math.PI/6*Sg;Op.push(Math.cos(Px)),Np.push(Math.sin(Px))}var wC=function(R,z,N,W){var X=z/Ax(Mp([R[0],R[1]]),Mp([R[2],R[1]]),N),te=X*(R[2]-R[0]),a=z/Ax(Mp([R[0],R[1]]),Mp([R[0],R[3]]),N),_e=a*(R[3]-R[1]),me=te/2,xe=me*2,Se=Math.sqrt(3)/2*_e,Te=R[2]-R[0],Qe=R[3]-R[1],Pe=3/4*xe,ve=Se,Nt=Te/(xe-me/2),wt=Math.ceil(Nt);Math.round(Nt)===wt&&wt++;var Bt=(wt*Pe-me/2-Te)/2-me/2,je=Math.ceil(Qe/Se),Ae=(Qe-je*Se)/2,pt=je*Se-Qe>Se/2;pt&&(Ae-=Se/4);for(var en=bC([]),ze=0;ze<wt;ze++)for(var ft=0;ft<=je;ft++){var et=ze%2===1;if(!(ft===0&&et)&&!(ft===0&&pt)){var ht=ze*Pe+R[0]-Bt,it=ft*ve+R[1]+Ae;et&&(it-=Se/2),W?en.features.push.apply(en.features,IC([ht,it],te/2,_e/2)):en.features.push(EC([ht,it],te/2,_e/2))}}return en};function EC(S,R,z){for(var N=[],W=0;W<6;W++){var X=S[0]+R*Op[W],te=S[1]+z*Np[W];N.push([X,te])}return N.push(N[0]),G1([N])}function IC(S,R,z){for(var N=[],W=0;W<6;W++){var X=[];X.push(S),X.push([S[0]+R*Op[W],S[1]+z*Np[W]]),X.push([S[0]+R*Op[(W+1)%6],S[1]+z*Np[(W+1)%6]]),X.push(S),N.push(G1([X]))}return N}lu.exports={isolines:vI,convex:vT,within:wT,concave:CT,difference:MT,collect:PT,flip:RT,simplify:OT,bezier:BT,tag:UT,sample:qT,envelope:$T,square:m1,midpoint:tS,buffer:oS,center:P1,centroid:dS,combine:pS,distance:ja,explode:L1,bbox:Up,tesselate:zS,bboxPolygon:C1,inside:cd,intersect:kS,nearest:VS,planepoint:p1,random:HS,tin:a_,union:T1,bearing:Hp,destination:Zp,kinks:WS,pointOnSurface:eC,area:nC,along:oC,lineDistance:lC,lineSlice:fC,pointOnLine:U1,pointGrid:mC,squareGrid:yC,triangleGrid:xC,hexGrid:wC};var Ec=ii;lu.exports.point=Ec.point;lu.exports.polygon=Ec.polygon;lu.exports.lineString=Ec.lineString;lu.exports.multiPoint=Ec.multiPoint;lu.exports.multiPolygon=Ec.multiPolygon;lu.exports.multiLineString=Ec.multiLineString;lu.exports.feature=Ec.feature;lu.exports.featureCollection=Ec.featureCollection;lu.exports.geometryCollection=Ec.geometryCollection;var TC=lu.exports;const SC=c1(TC);var Cg=O2(()=>G2),CC=Lh('<div class="overlay svelte-3nrxz2"><button class="remove-overlay svelte-3nrxz2">Click to Interact</button></div>'),MC=Lh('<div class="map-container svelte-3nrxz2"><div id="map" class="svelte-3nrxz2"></div> <!></div>');function AC(S,R){r_(R,!1);let z=F2(R,"all_polygons",8),N=ih(),W=ih(),X=ih(!0),te=ih(null);const a=["Burkina Faso","Central African Republic","Democratic Republic of Congo","Ethiopia","Libya","Mali","Mozambique","Nigeria","Somalia","South Sudan","Sudan","Western Sahara","Colombia","Haiti","Afghanistan","Myanmar","Pakistan","Philippines","Azerbaijan","Russia","Ukraine","Iraq","Israel","Syria","Turkey","Yemen"];function _e(){let Pe=vi(W).getCenter();window.innerWidth<=750?vi(W).flyTo({center:[Pe.lng,Pe.lat],zoom:.8}):window.innerWidth<=900?vi(W).flyTo({center:[Pe.lng,Pe.lat],zoom:1.1}):window.innerWidth<=1050?vi(W).flyTo({center:[Pe.lng,Pe.lat],zoom:1.3}):vi(W).flyTo({center:[Pe.lng,Pe.lat],zoom:1.5})}function me(){qa(X,!1)}l1(()=>{Cg(Cg().accessToken="pk.eyJ1Ijoic2FzaGFnYXJpYmFsZHkiLCJhIjoiY2xyajRlczBlMDhqMTJpcXF3dHJhdTVsNyJ9.P_6mX_qbcbxLDS1o_SxpFg"),qa(W,new(Cg()).Map({container:vi(W),attributionControl:!1,style:"mapbox://styles/sashagaribaldy/cm4aigyc400qc01s6bzp76jjf",center:[10,15],zoom:1.5,projection:"naturalEarth",maxZoom:5})),window.addEventListener("resize",_e),_e()});function xe(Pe){let ve;if(Pe=="Russia")ve=[68.1434025400001,86.74555084800015,97.36225305200006,35.49540557900009];else if(Pe=="United States of America")ve=[-160.3688042289999,24.546282924364334,-36.7005916009999,32.71283640500015];else if(Pe=="France")ve=[-8.691314256999902,40.909613348000065,12.771169467000021,50.84788646];else{let wt=z().features.find(function(Bt){return Bt.properties.ADMIN==Pe});ve=SC.bbox(wt)}ve&&vi(W).fitBounds(ve,{padding:50})}t2(()=>(s1(z()),vi(W),vi(te)),()=>{z()&&vi(W)&&vi(W).on("load",()=>{vi(W).addSource("countries",{type:"geojson",data:z(),generateId:!0}),vi(W).addLayer({id:"countries_fill",type:"fill",source:"countries",paint:{"fill-color":"#3DB049","fill-opacity":.7},filter:["in",["get","ADMIN"],["literal",a]]}),vi(W).addLayer({id:"countries_outline",type:"line",source:"countries",layout:{},paint:{"line-color":"black","line-width":["case",["boolean",["feature-state","hover"],!1],1,0]},filter:["in",["get","ADMIN"],["literal",a]]}),vi(W).on("mousemove","countries_fill",Pe=>{vi(W).getCanvas().style.cursor="pointer",Pe.features.length>0&&(vi(te)!==null&&vi(W).setFeatureState({source:"countries",id:vi(te)},{hover:!1}),qa(te,Pe.features[0].id),vi(W).setFeatureState({source:"countries",id:vi(te)},{hover:!0}))}),vi(W).on("mouseleave","countries_fill",()=>{vi(W).getCanvas().style.cursor="",vi(te)!==null&&vi(W).setFeatureState({source:"countries",id:vi(te)},{hover:!1}),qa(te,null)}),vi(W).on("click","countries_fill",Pe=>{let ve=Pe.features[0].properties.ADMIN;xe(ve)})})}),n2(),a1();var Se=MC(),Te=bc(Se);D2(Te,Pe=>qa(W,Pe),()=>vi(W));var Qe=Bu(Te,2);Fg(Qe,()=>vi(X),Pe=>{var ve=CC(),Nt=bc(ve);td("click",Nt,me),Ch(Pe,ve)}),Bg(Se,"clientHeight",Pe=>qa(N,Pe)),Ch(S,Se),s_()}var PC=Lh('<li class="svelte-tr7loh"> </li>'),LC=Lh('<ul class="dropdown svelte-tr7loh"></ul>'),RC=Lh('<img alt="Research image" class="svelte-tr7loh">'),DC=Lh('<button id="scrollToTop" aria-label="Scroll to top" class="svelte-tr7loh"><i class="fa fa-arrow-up svelte-tr7loh" style="color: yellow;" aria-hidden="true"></i></button>'),OC=Lh(`<div id="wrapper" class="svelte-tr7loh"><div id="home" class="svelte-tr7loh"><img id="intro_logo_usa" alt="University of St Andrews Logo" src="uosa.png" class="svelte-tr7loh"> <img id="intro_logo_uoe" alt="University of St Andrews Logo" src="uoe_white.png" class="svelte-tr7loh"> <div id="navigation" class="svelte-tr7loh"><i class="fa fa-bars svelte-tr7loh" aria-hidden="true"></i> <!></div> <h1 class="svelte-tr7loh">Global Fragmentation</h1> <h3 class="svelte-tr7loh">Understanding shifts in the geopolitical context of peace and transition
      processes</h3></div> <div id="research" class="svelte-tr7loh"><h3 style="width: 90px; background-color: red; border-radius: 2px" class="svelte-tr7loh">Research</h3> <div class="gallery-container svelte-tr7loh"><button class="arrow left svelte-tr7loh" aria-label="Scroll left"><i class="fa fa-arrow-left" style="color: yellow;" aria-hidden="true"></i></button> <div class="image-row svelte-tr7loh"></div> <button class="arrow right svelte-tr7loh" aria-label="Scroll right"><i class="fa fa-arrow-right" style="color: yellow;" aria-hidden="true"></i></button></div></div> <div id="people" class="svelte-tr7loh"><h3 style="width: 70px; background-color: red; border-radius: 2px" class="svelte-tr7loh">People</h3></div> <main id="map" style="height: calc(var(--vh, 1vh) * 100);" class="svelte-tr7loh"><h3 style="width: 90px; height: 25px; z-index: 5; position: absolute; background-color: red; border-radius: 2px" class="svelte-tr7loh">Map</h3> <!></main> <!></div>`);function NC(S,R){r_(R,!1);let z=ih(),N=ih(),W=["./img/c1.png","./img/c2.png","./img/c3.png","./img/c4.png","./img/c5.png","./img/m1.png","./img/m2.png","./img/m4.png","./img/m5.png"],X;const te=it=>{if(X){const le=X.offsetWidth/5;X.scrollBy({left:it*le,behavior:"smooth"})}};V2("/data/country_polygons.json").then(it=>{qa(N,it)});const _e=it=>{const le=document.getElementById(it);le&&le.scrollIntoView({behavior:"smooth"})},me=[{id:"home",name:"Home"},{id:"research",name:"Research"},{id:"people",name:"People"},{id:"map",name:"Map"}];let xe=ih(!1),Se=ih(!1);const Te=()=>{window.scrollTo({top:0,behavior:"smooth"})},Qe=()=>{qa(Se,window.scrollY>300)};l1(()=>("scrollRestoration"in history&&(history.scrollRestoration="manual"),window.scrollTo({top:0,behavior:"auto"}),window.addEventListener("scroll",Qe),X=document.querySelector(".image-row"),()=>{window.removeEventListener("scroll",Qe)})),a1();var Pe=OC(),ve=bc(Pe),Nt=Bu(bc(ve),4),wt=bc(Nt),Bt=Bu(wt,2);Fg(Bt,()=>vi(xe),it=>{var le=LC();jv(le,5,()=>me,T2,(kt,zn)=>{var Qt=PC(),ri=bc(Qt);Bv(()=>w2(ri,vi(zn).name)),td("click",Qt,()=>_e(vi(zn).id)),Ch(kt,Qt)}),Ch(it,le)});var je=Bu(ve,2),Ae=Bu(bc(je),2),pt=bc(Ae),en=Bu(pt,2);jv(en,5,()=>W,it=>it,(it,le)=>{var kt=RC();Bv(()=>P2(kt,"src",vi(le))),Ch(it,kt)});var ze=Bu(en,2),ft=Bu(je,4),et=Bu(bc(ft),2);AC(et,{get all_polygons(){return vi(N)}});var ht=Bu(ft,2);Fg(ht,()=>vi(Se),it=>{var le=DC();td("click",le,Te),Ch(it,le)}),td("click",wt,()=>qa(xe,!vi(xe))),td("click",pt,()=>te(-1)),td("click",ze,()=>te(1)),Bg(ft,"clientWidth",it=>qa(z,it)),Bg(Pe,"clientWidth",it=>qa(z,it)),Ch(S,Pe),s_()}E2(NC,{target:document.getElementById("app")});
